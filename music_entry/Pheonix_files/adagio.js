/*!
 * Copyright (c) 2017 Flat <hello@flat.io> - https://flat.io
 * Package: adagio - 20.24.1
 */

var Adagio=Adagio||{};(function(){"use strict";Adagio.document=null,Adagio.setDocument=function(a){Adagio.document=a},Adagio.warn=function(){}}).call(this),function(){"use strict";Adagio.edit={}}.call(this),function(){"use strict";Adagio.edit.action={}}.call(this),function(){"use strict";Adagio.edit.common={}}.call(this),function(){"use strict";Adagio.edit.values={}}.call(this),function(){"use strict";Adagio.edit.primitive={}}.call(this),function(){"use strict";Adagio.edit.composite={}}.call(this),function(){"use strict";Adagio.Error={}}.call(this),function(){"use strict";Adagio.Error.client={}}.call(this),function(){"use strict";Adagio.Error.display={}}.call(this),function(){"use strict";Adagio.Error.font={}}.call(this),function(){"use strict";Adagio.Error.import={}}.call(this),function(){"use strict";Adagio.Error.value={}}.call(this),function(){"use strict";Adagio.Error.lock={}}.call(this),function(){"use strict";Adagio.Error.noChange={}}.call(this),function(){"use strict";Adagio.export={}}.call(this),function(){"use strict";Adagio.export.common={}}.call(this),function(){"use strict";Adagio.font={}}.call(this),function(){"use strict";Adagio.getter={}}.call(this),function(){"use strict";Adagio.import={}}.call(this),function(){"use strict";Adagio.import.ties={}}.call(this),function(){"use strict";Adagio.import.hammerOnPullOffs={}}.call(this),function(){"use strict";Adagio.import.glissandos={}}.call(this),function(){"use strict";Adagio.import.voiceMapping={}}.call(this),function(){"use strict";Adagio.import.staffMapping={}}.call(this),function(){"use strict";Adagio.import.wedge={}}.call(this),function(){"use strict";Adagio.import.beam={}}.call(this),function(){"use strict";Adagio.import.metadata={}}.call(this),function(){"use strict";Adagio.import.attributes={}}.call(this),function(){"use strict";Adagio.import.harmony={}}.call(this),function(){"use strict";Adagio.import.common={}}.call(this),function(){"use strict";Adagio.import.dynamic={}}.call(this),function(){"use strict";Adagio.import.emptyStaves={}}.call(this),function(){"use strict";Adagio.import.pizzicato={}}.call(this),function(){"use strict";Adagio.import.word={}}.call(this),function(){"use strict";Adagio.import.pedal={}}.call(this),function(){"use strict";Adagio.import.alignNotes={}}.call(this),function(){"use strict";Adagio.import.alignNotes.tuplet={}}.call(this),function(){"use strict";Adagio.import.lyricLevel={}}.call(this),function(){"use strict";Adagio.import.octaveShift={}}.call(this),function(){"use strict";Adagio.import.tempoChange={}}.call(this),Adagio.Brush={SvgElement:{},CanvasElement:{}},function(){"use strict";Adagio.page={}}.call(this),function(){"use strict";Adagio.page.formatter={}}.call(this),function(){"use strict";Adagio.embed={}}.call(this),function(){"use strict";Adagio.Utils={}}.call(this),function(){"use strict";Adagio.Utils.attributeWrapper={}}.call(this),function(){"use strict";Adagio.Utils.direction={}}.call(this),function(){"use strict";Adagio.Utils.note={}}.call(this),function(){"use strict";Adagio.Utils.notations={}}.call(this),function(){"use strict";Adagio.Utils.measure={}}.call(this),function(){"use strict";Adagio.Values={}}.call(this),function(){"use strict";Adagio.Drawer={}}.call(this),function(){"use strict";Adagio.Drawer.time={}}.call(this),function(){"use strict";Adagio.Drawer.barline={}}.call(this),function(){"use strict";Adagio.Drawer.tie={}}.call(this),function(){"use strict";Adagio.Drawer.wedge={}}.call(this),function(){"use strict";Adagio.Drawer.tuplet={}}.call(this),function(){"use strict";Adagio.Drawer.formatter={}}.call(this),function(){"use strict";Adagio.Drawer.formatter.sequential={}}.call(this),function(){"use strict";Adagio.Drawer.formatter.linear={}}.call(this),function(){"use strict";Adagio.Drawer.slur={}}.call(this),function(){"use strict";Adagio.Drawer.ctx={}}.call(this),function(){"use strict";Adagio.Drawer.chord={}}.call(this),function(){"use strict";Adagio.Drawer.metronome={}}.call(this),function(){"use strict";Adagio.Drawer.ending={}}.call(this),function(){"use strict";Adagio.Drawer.glissando={}}.call(this),function(){"use strict";Adagio.Drawer.mmr={}}.call(this),function(){"use strict";Adagio.Drawer.octaveShift={}}.call(this),function(){"use strict";Adagio.Drawer.hammerOnPullOff={}}.call(this),function(){"use strict";Adagio.Drawer.hyphen={}}.call(this),function(){"use strict";Adagio.Drawer.tempoChange={}}.call(this),function(){"use strict";Adagio.Drawer.rehearsal={}}.call(this),function(){"use strict";Adagio.updater={}}.call(this),function(){"use strict";Adagio.updater.replayFilter={}}.call(this),function(){"use strict";Adagio.updater.page={}}.call(this),function(){"use strict";Adagio.updater.page.measureColumns={}}.call(this),function(){"use strict";Adagio.updater.track={}}.call(this),function(){"use strict";Adagio.updater.cancelStack={}}.call(this),function(){"use strict";Adagio.undo={}}.call(this),function(){"use strict";Adagio.undo.safe={}}.call(this),function(){"use strict";Adagio.formatter={}}.call(this),function(){"use strict";Adagio.formatter.horizontal={}}.call(this),function(){"use strict";Adagio.formatter.vertical={}}.call(this),function(){"use strict";Adagio.math={}}.call(this),function(){"use strict";Adagio.math.grahamScan={}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError=function(a,b){"string"!=typeof b&&(b=a);var c=Error.call(this,b);return this.name=c.name="InternalError",this.stack=c.stack,this.message=c.message,this.code=a,this};Adagio.Error.InternalError.prototype=Object.create(Error.prototype,{constructor:{value:a}}),Adagio.Error.InternalError.toString=function(){return"["+this.code+"] "+this.message}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError;Adagio.math.grahamScan.searchInitialPoint=function(a){var c=a.reduce(b),d=a.indexOf(c);return a.splice(d,1),c};var b=function(b,c){var d=b.y-c.y;if(d>0)return c;if(d<0)return b;var e=b.x-c.x;if(e>0)return c;if(e<0)return b;throw new a("TwoSamePoints","There are two points with the exact same coordinates.")}}.call(this),function(){"use strict";Adagio.math.calcVector=function(a,b){return{x:b.x-a.x,y:b.y-a.y}}}.call(this),function(){"use strict";Adagio.math.calcNorm=function(a){return Math.sqrt(a.x*a.x+a.y*a.y)}}.call(this),function(){"use strict";Adagio.math.grahamScan.isAboutSame=function(b,c){return b===c||a(b,c)<1e-9};var a=function(a,c){return Math.abs(a-c)/b(a,c)},b=function(a,b){var c=b-a,d=a+c/2;return Math.abs(d)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.math.calcVector,c=Adagio.math.calcNorm,d=Adagio.math.grahamScan.isAboutSame;Adagio.math.grahamScan.sortPoints=function(a,b){var c=b.map(e);return c.forEach(f,a),c.sort(g),b=c.map(h),b.unshift(a),b};var e=function(a){return{point:a}},f=function(a){var d=this,e=a.point,f=b(d,e),g=c(f),h=f.x/g;a.tangent=h},g=function(b,c){if(!d(b.tangent,c.tangent)){return b.tangent-c.tangent}var e=b.point.x-c.point.x;if(0!==e)return-e;var f=b.point.y-c.point.y;if(0!==f)return f;throw new a("TwoSamePoints","There are two points with the exact same coordinates.")},h=function(a){return a.point}}.call(this),function(){"use strict";Adagio.math.calcCrossProductZ=function(a,b){return a.x*b.y-a.y*b.x}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.math.calcVector,c=Adagio.math.calcCrossProductZ;Adagio.math.grahamScan.filterPoints=function(b){if(b.length<=2){throw new a("NotEnoughPoints","The algorithm only supports a number of points >= 3.")}var c=new d(b);return c.filter(),c.getFilteredPoints()};var d=function(a){this.init(a)},e=d.prototype;e.init=function(a){this.srcPoints=a.slice(2),this.filteredPoints=a.slice(0,2)},e.filter=function(){this.srcPoints.forEach(this.addPoint,this)},e.addPoint=function(a){this.excludePoints(a),this.filteredPoints.push(a)},e.excludePoints=function(a){for(;this.canExclude(a);)this.filteredPoints.pop()},e.canExclude=function(a){return this.filteredPoints.length>2&&this.shouldExclude(a)},e.shouldExclude=function(a){var b=this.getBeforeLastPoint(),c=this.getLastPoint(),d=f(b,c,a);return!g(d)},e.getBeforeLastPoint=function(){var a=this.filteredPoints.length-2;return this.filteredPoints[a]},e.getLastPoint=function(){var a=this.filteredPoints.length-1;return this.filteredPoints[a]};var f=function(a,d,e){var f=b(a,d),g=b(a,e);return c(f,g)},g=function(a){return a<=0};e.getFilteredPoints=function(){return this.filteredPoints}}.call(this),function(){"use strict";var a=Adagio.math.grahamScan.searchInitialPoint,b=Adagio.math.grahamScan.sortPoints,c=Adagio.math.grahamScan.filterPoints;Adagio.math.grahamScan.grahamScan=function(d){var e=a(d),f=b(e,d);return c(f)}}.call(this),function(){"use strict";Adagio.math.calcConvexPolygonArea={}}.call(this),function(){"use strict";Adagio.math.cubicBezier={}}.call(this),function(){"use strict";Adagio.settings={}}.call(this),function(){"use strict";Adagio.track={}}.call(this),function(){"use strict";Adagio.cursor={}}.call(this),function(){"use strict";Adagio.scale={}}.call(this),function(){"use strict";Adagio.smufl={}}.call(this),function(){"use strict";Adagio.history={}}.call(this),function(){"use strict";Adagio.history.note={}}.call(this),function(){"use strict";Adagio.marker={}}.call(this),function(){"use strict";Adagio.fix={}}.call(this),function(){"use strict";Adagio.Data=function(){this.init.apply(this,arguments)}}.call(this),function(){"use strict";Adagio.Data.direction={}}.call(this),function(){"use strict";Adagio.Data.tuplet={}}.call(this),function(){"use strict";Adagio.Data.wedge={}}.call(this),function(){"use strict";Adagio.Data.common={}}.call(this),function(){"use strict";Adagio.Data.beam={}}.call(this),function(){"use strict";Adagio.Data.pedal={}}.call(this),function(){"use strict";Adagio.Data.octaveShift={}}.call(this),function(){"use strict";Adagio.Data.tempoChange={}}.call(this),function(){"use strict";var a=Adagio.Error.MusicXMLFeatureNotSupportedError,b=Adagio.Data,c=b.prototype;c.checkMusicXMLFeatures=function(){this.checkAllVoiceStaffUnicity()},c.checkAllVoiceStaffUnicity=function(){this.forEachMeasure(function(a){this.checkVoiceStaffUnicity(a)},this)},c.checkVoiceStaffUnicity=function(a){new d(a).check()};var d=function(a){this.notes=a.note,this.voicesMap={}};d.prototype.check=function(){for(var b=0;b<this.notes.length;b++){var c=this.notes[b],d=e(c),g=f(c);if(void 0===this.voicesMap[d])this.voicesMap[d]=g;else if(this.voicesMap[d]!==g){var h="Voices with notes over several staves are not supported";throw new a(h)}}};var e=function(a){return void 0!==a.voice?a.voice:"1"},f=function(a){return void 0!==a.staff?a.staff:"1"}}.call(this),function(){"use strict";var a=Adagio.Utils.attributeUtils={};a.hasStaffIdx=function(a){return void 0!==a.$number},a.setStaffIdx=function(a,b){a.$number=(b+1).toString()},a.getStaffIdx=function(a){return parseInt(a.$number,10)-1},a.removeStaffIdx=function(a){delete a.$number},a.isGlobal=function(b){return!a.hasStaffIdx(b)}}.call(this),function(){"use strict";Adagio.Utils.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError;Adagio.Utils.clone=function(c){if(void 0===c||null===c){throw new a("unexpected","Cannot clone null or undefined object")}return b(c)};var b=function(a){if("undefined"!=typeof angular&&void 0!==angular.copy)return angular.copy(a);var c=Adagio.Utils.isArray(a)?[]:{};for(var d in a)a.hasOwnProperty(d)&&(a[d]&&"object"==typeof a[d]?c[d]=b(a[d]):c[d]=a[d]);return c};Adagio.Utils.cloneEpure$adagio=function(a){var b=Adagio.Utils.isArray(a)?[]:{};for(var c in a)a.hasOwnProperty(c)&&"$adagio"!==c&&(a[c]&&"object"==typeof a[c]?b[c]=Adagio.Utils.cloneEpure$adagio(a[c]):b[c]=a[c]);return b}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError=function(a,b){var c=Error.call(this,a);return this.name=c.name="ClientError",this.stack=c.stack,this.message=c.message,void 0!==b&&(this.code=b),this};a.prototype=Object.create(Error.prototype,{constructor:{value:a}})}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.RemoveLastError=function(b){var c="Cannot remove the last "+b,d=a.call(this,c);return this.name=d.name="RemoveLastError",this.stack=d.stack,this.message=d.message,this.entity=b,this};b.MEASURE="measure",b.PART="part",b.STAFF="staff",b.DISPLAYED_VOICE="displayed voice",b.VOICE="voice",b.prototype=Object.create(a.prototype,{constructor:{value:b}})}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Error.client.RemoveLastError,c=Adagio.Utils.attributeWrapper.NbStaves=function(a){this.init(a)},d=c.prototype;d.init=function(b){if(b<0)throw new a("BadStaffNumber","bad number of staves: ["+b+"]. ");this.nbStaves=b},d.checkStaffIdx=function(b){if(b<0||b>=this.nbStaves||"number"!=typeof b){var c="the staffIdx "+b+" is out of bound [0 : "+this.nbStaves+"[";throw new a("BadStaffIdx",c)}},d.checkStaffInsertionIdx=function(b){if(b<0||b>this.nbStaves||"number"!=typeof b){var c="the staffIdx "+b+" is out of bound [0 : "+this.nbStaves+"]";throw new a("BadStaffIdx",c)}},d.increase=function(){this.nbStaves++},d.decrease=function(){this.checkRemoveLast(),this.nbStaves--},d.checkRemoveLast=function(){if(1===this.nbStaves)throw new b(b.STAFF)},d.get=function(){return this.nbStaves}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.attributeWrapper.EmptyAttribute=function(a,b){this.init(a,b)},c=b.prototype;c.init=function(a,b){this.nbStaves=a,this.utils=b},c.getEntry=function(a){return this.nbStaves.checkStaffIdx(a),null},c.getAnyEntry=function(){return null},c.hasEntry=function(a){return this.nbStaves.checkStaffIdx(a),!1},c.insertEntry=function(a,b){this.nbStaves.checkStaffInsertionIdx(b),this.checkCanHandle(a),this.nbStaves.increase()},c.setEntry=function(a,b){this.nbStaves.checkStaffIdx(b),this.checkCanHandle(a)},c.checkCanHandle=function(b){if(!this.canHandleEntry(b)){throw new a("OperationImpossible","cannot add a non null entry to an EmptyAttribute")}},c.canHandleEntry=function(a){return null===a},c.removeEntry=function(a){this.nbStaves.checkStaffIdx(a),this.nbStaves.decrease()},c.dumpAttribute=function(){return[]}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.attributeUtils,c=Adagio.Utils.attributeWrapper.GlobalAttribute=function(a,b){this.init(a,b)},d=c.prototype;d.init=function(a,b){this.nbStaves=a,this.utils=b,this.entry=null},d.addGlobalEntry=function(c){if(this.hasEntry()){throw new a("OperationImpossible","cannot add two global attribute values")}b.removeStaffIdx(c),this.entry=c},d.getEntry=function(a){return this.nbStaves.checkStaffIdx(a),this.checkHasEntry(),this.entry},d.getAnyEntry=function(){return this.checkHasEntry(),this.entry},d.hasEntry=function(a){return this.nbStaves.checkStaffIdx(a),!0},d.insertEntry=function(a,b){this.nbStaves.checkStaffInsertionIdx(b),this.checkHasEntry(),this.checkCanHandle(a),this.nbStaves.increase()},d.setEntry=function(a,b){this.nbStaves.checkStaffIdx(b),this.checkHasEntry(),this.checkCanHandle(a)},d.removeEntry=function(a){this.nbStaves.checkStaffIdx(a),this.checkHasEntry(),this.nbStaves.decrease()},d.dumpAttribute=function(){return[this.entry]},d.checkCanHandle=function(b){if(!this.canHandleEntry(b)){throw new a("OperationImpossible","the added entry must be equal to the global entry")}},d.canHandleEntry=function(a){if(null===a)return!1;this.checkHasEntry();var b=this.entry;return this.utils.isSame(b,a)},d.checkHasEntry=function(){if(!this.hasEntry()){throw new a("OperationImpossible","an entry must be added before using addGlobalEntry()")}},d.hasEntry=function(){return null!==this.entry}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.typeUtils={};b.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)},b.makeArray=function(a){return b.isArray(a)?a:[a]},b.isObject=function(a){return"[object Object]"===Object.prototype.toString.call(a)},b.fillObject=function(a,b){for(var c in b)a[c]=b[c];return a},b.isObjectEmpty=function(a){for(var b in a)return!1;return!0},b.getAnyKey=function(b){for(var c in b)return c;throw new a("EmptyObject")},b.arrayToSet=function(a){var b={};return a.forEach(function(a){b[a]=!0}),b},b.filterObjectWhiteList=function(a,b){var c={};return b.forEach(function(b){void 0!==a[b]&&(c[b]=a[b])}),c},b.filterObjectBlackMap=function(a,b){var c={};for(var d in a)void 0===b[d]&&(c[d]=a[d]);return c},b.isTruthy=function(a){return!!a},b.listToMap=function(b,c){var d={};return b.forEach(function(b){var e=c(b);if(void 0!==d[e]){throw new a("IdNotUnique","The id ["+e+"] appears twice while converting list to map.")}d[e]=b}),d},b.identity=function(a){return a},b.pairsToMap=function(a){var b={};return a.forEach(c,b),b};var c=function(a){this[a.key]=a.value};b.hasStringOrContent=function(a){return"string"==typeof a||!(!b.isObject(a)||"string"!=typeof a.content)},b.stringOrContent=function(c){if("string"==typeof c)return c;if(b.isObject(c)&&"string"==typeof c.content)return c.content;if(!0===c)return"";throw new a("Unexpected","Bad value for MusicXML object content: ["+c+"].")},b.reverseMap=function(a){var b={};for(var c in a){b[a[c]]=c}return b},b.getArray=function(a,c){return void 0===a[c]?[]:b.makeArray(a[c])},b.setArray=function(a,b,c){0===c.length?delete a[b]:1===c.length?a[b]=c[0]:a[b]=c}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.attributeUtils,c=Adagio.Utils.typeUtils,d=Adagio.Utils.attributeWrapper.SpecificAttribute=function(a,b){this.init(a,b)},e=d.prototype;e.init=function(a,b){this.nbStaves=a,this.utils=b,this.map={}},e.addSpecificEntry=function(b,c){if(this.nbStaves.checkStaffIdx(c),this.hasEntry(c)){throw new a("OperationImpossible","cannot add two times the same entry")}null!==b&&this.setSpecificEntry(b,c)},e.setSpecificEntry=function(a,c){this.nbStaves.checkStaffIdx(c),b.setStaffIdx(a,c),this.map[c]=a},e.removeSpecificEntry=function(a){this.nbStaves.checkStaffIdx(a),this.hasEntry(a)&&delete this.map[a]},e.getEntry=function(a){return this.nbStaves.checkStaffIdx(a),this.hasEntry(a)?this.map[a]:null},e.getAnyEntry=function(){return this.getEntry(0)},e.insertEntry=function(a,b){this.nbStaves.checkStaffInsertionIdx(b),this.nbStaves.increase(),this.increaseEntriesAfter(b-1),this.addSpecificEntry(a,b)},e.setEntry=function(a,b){this.nbStaves.checkStaffIdx(b),null===a?this.removeSpecificEntry(b):this.setSpecificEntry(a,b)},e.canHandleEntry=function(){return!0},e.removeEntry=function(a){this.nbStaves.checkStaffIdx(a),this.nbStaves.checkRemoveLast(),this.removeSpecificEntry(a),this.decreaseEntriesAfter(a),this.nbStaves.decrease()},e.dumpAttribute=function(){for(var a=[],b=0;b<this.getNbStaves();b++)if(this.hasEntry(b)){var c=this.getEntry(b);a.push(c)}return a},e.isAllSame=function(){if(this.isEmpty())return!1;for(var a=null,b=0;b<this.getNbStaves();b++){if(!this.hasEntry(b))return!1;var c=this.getEntry(b);if(null===a)a=c;else if(!this.utils.isSame(c,a))return!1}return!0},e.increaseEntriesAfter=function(a){for(var b=this.getNbStaves()-1;b>a;b--)if(this.hasEntry(b)){var c=this.getEntry(b);this.removeSpecificEntry(b),this.addSpecificEntry(c,b+1)}},e.decreaseEntriesAfter=function(a){for(var b=a+1;b<this.getNbStaves();b++)if(this.hasEntry(b)){var c=this.getEntry(b);this.removeSpecificEntry(b),this.addSpecificEntry(c,b-1)}},e.hasEntry=function(a){return this.nbStaves.checkStaffIdx(a),void 0!==this.map[a]},e.isEmpty=function(){return c.isObjectEmpty(this.map)},e.getNbStaves=function(){return this.nbStaves.get()}}.call(this),function(){"use strict";var a=Adagio.Utils.attributeUtils,b=Adagio.Utils.clone,c=Adagio.Utils.attributeWrapper.NbStaves,d=Adagio.Utils.attributeWrapper.EmptyAttribute,e=Adagio.Utils.attributeWrapper.GlobalAttribute,f=Adagio.Utils.attributeWrapper.SpecificAttribute,g=Adagio.Utils.attributeWrapper.AttributeWrapper=function(a,b,c){this.init(a,b,c)};g.isSame=function(a,b){g.checkCanCompare(a,b);for(var c=function(b,c){return null===b&&null===c||null!==b&&null!==c&&a.utils.isSame(b,c)},d=0;d<a.getNbStaves();d++){if(!c(a.getEntry(d),b.getEntry(d)))return!1}return!0},g.checkCanCompare=function(a,b){if(a.getNbStaves()!==b.getNbStaves())throw new Error("comparing attributes of different size");if(a.utils!==b.utils)throw new Error("comparing attributes of different types")};var h=g.prototype;h.init=function(a,b,d){this.nbStaves=new c(b),this.utils=d,this.attr=null,this.initEntries(a)},h.initEntries=function(a){0===a.length?this.createEmpty():(a.forEach(this.initEntry,this),this.isSpecific()&&this.mergeIfPossible())},h.initEntry=function(b){if(a.hasStaffIdx(b)){var c=a.getStaffIdx(b);this.hasAttr()||this.createSpecific(),this.addSpecificEntry(b,c)}else this.hasAttr()||this.createGlobal(),this.addGlobalEntry(b)},h.createEmpty=function(){this.attr=new d(this.nbStaves,this.utils)},h.hasAttr=function(){return null!==this.attr},h.createSpecific=function(){this.attr=new f(this.nbStaves,this.utils)},h.createGlobal=function(){this.attr=new e(this.nbStaves,this.utils)},h.addSpecificEntry=function(a,b){this.attr.addSpecificEntry(a,b)},h.addGlobalEntry=function(a){this.attr.addGlobalEntry(a)},h.hasEntry=function(a){return this.attr.hasEntry(a)},h.getEntry=function(a){return this.attr.getEntry(a)},h.getAnyEntry=function(){return this.attr.getAnyEntry()},h.insertEntry=function(a,b){this.checkStaffInsertionIdx(b),this.canHandleEntry(a)||this.changeToSpecific(),this.attr.insertEntry(a,b)},h.setEntry=function(a,b){this.nbStaves.checkStaffIdx(b),this.canHandleEntry(a)||this.changeToSpecific(),this.attr.setEntry(a,b),this.isSpecific()&&this.mergeIfPossible()},h.checkStaffInsertionIdx=function(a){return this.nbStaves.checkStaffInsertionIdx(a)},h.canHandleEntry=function(a){return this.attr.canHandleEntry(a)},h.removeEntry=function(a){this.attr.removeEntry(a),this.isSpecific()&&this.mergeIfPossible()},h.isSpecific=function(){return this.attr instanceof f},h.changeToSpecific=function(){for(var a=new f(this.nbStaves,this.utils),c=0;c<this.getNbStaves();c++){var d=this.getEntry(c);null!==d&&(d=b(d)),a.addSpecificEntry(d,c)}this.attr=a},h.mergeIfPossible=function(){if(this.attr.isAllSame()){var a=b(this.getEntry(0)),c=new e(this.nbStaves,this.utils);c.addGlobalEntry(a),this.attr=c}else if(this.attr.isEmpty()){var f=new d(this.nbStaves,this.utils);this.attr=f}},h.dumpAttribute=function(){return this.attr.dumpAttribute()},h.getNbStaves=function(){return this.nbStaves.get()},h.getDiffWith=function(b){g.checkCanCompare(b,this);for(var c=[],d=0;d<this.getNbStaves();d++){var e=b.getEntry(d),f=this.getEntry(d);if(!this.utils.isSame(e,f)){var h=this.utils.makeDiff(e,f);a.setStaffIdx(h,d),c.push(h)}}return c},h.replaceWith=function(a){g.checkCanCompare(a,this);for(var c=0;c<this.getNbStaves();c++)if(a.hasEntry(c)){var d=b(a.getEntry(c));this.setEntry(d,c)}}}.call(this),function(){"use strict";[].includes||(Array.prototype.includes=function(a){if(void 0===this||null===this)throw new TypeError("Cannot convert this value to object");var b=Object(this),c=parseInt(b.length)||0;if(0===c)return!1;var d,e=parseInt(arguments[1])||0;for(e>=0?d=e:(d=c+e)<0&&(d=0);d<c;){var f=b[d];if(a===f||a!==a&&f!==f)return!0;d++}return!1})}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Values.BeamType={BEGIN:"begin",CONTINUE:"continue",END:"end",FORWARD:"forward hook",BACKWARD:"backward hook"},c=[b.BEGIN,b.CONTINUE,b.END,b.FORWARD,b.BACKWARD];b.assert=function(a){b.isValid(a)||b.raiseError(a)},b.isValid=function(a){return c.includes(a)},b.raiseError=function(b){throw new a("BadBeamType","The beam type ["+b+"] is invalid.")}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Values.BeamType,c=Adagio.Utils.beamUtils={};c.hasBackward=function(a){return c.isContinue(a)||c.isEnd(a)},c.hasForward=function(a){return c.isContinue(a)||c.isBegin(a)},c.isFirst=function(a){return 0===c.getNumber(a)},c.getNumber=function(a){return parseInt(a.$number,10)-1},c.isBegin=function(a){return c.getType(a)===b.BEGIN},c.isContinue=function(a){return c.getType(a)===b.CONTINUE},c.isEnd=function(a){return c.getType(a)===b.END},c.getType=function(a){return a.content},c.createBegin=function(a){return c.create(a,b.BEGIN)},c.createContinue=function(a){return c.create(a,b.CONTINUE)},c.createEnd=function(a){return c.create(a,b.END)},c.copy=function(a){var b=c.getNumber(a),d=c.getType(a);return c.create(b,d)},c.compare=function(a,b){return c.getNumber(a)-c.getNumer(b)},c.create=function(a,c){return b.assert(c),{$number:(a+1).toString(),content:c}},c.isTopConsistent=function(a){var d=c.getType(a);return d===b.BEGIN||d===b.CONTINUE||d===b.END||d!==b.FORWARD&&d!==b.BACKWARD&&void b.raiseError(d)},c.isConsistentWithUpper=function(a,d){var e=c.getType(a),f=c.getType(d);return b.assert(f),f===b.BEGIN?e===b.BEGIN||e===b.FORWARD:f===b.FORWARD?e===b.FORWARD:f===b.END?e===b.END||e===b.BACKWARD:f===b.BACKWARD?e===b.BACKWARD:f===b.CONTINUE||void b.raiseError(f)},c.isConsistentBegin=function(a){var d=c.getType(a);return d===b.BEGIN||d===b.FORWARD},c.isConsistentEnd=function(a){var d=c.getType(a);return d===b.END||d===b.BACKWARD},c.isConsistentWithLeft=function(a,d){var e;null!==a?(e=c.getType(a),b.assert(e)):e=null;var f=null===d?null:c.getType(d);return null===f||f===b.FORWARD||f===b.BACKWARD||f===b.END?null===e||e===b.BEGIN||e===b.FORWARD||e===b.BACKWARD:f===b.BEGIN?e===b.END||e===b.CONTINUE:f===b.CONTINUE?e===b.CONTINUE||e===b.END:void b.raiseError(f)},c.compareSafe=function(b,d){var e=c.compare(b,d);if(0===e){throw new a("Unexpected","There should not be two beams with the same number.")}return e},c.compare=function(a,b){return c.getNumber(a)-c.getNumber(b)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.math={};b.isNumber=function(a){return"number"==typeof a&&!isNaN(a)},b.floatPart=function(a){return a-b.intPart(a)},b.intPart=function(a){return parseInt(a,10)},b.isInteger=function(a){return Math.round(a)===a},b.isNumber=function(a){return"number"==typeof a&&!isNaN(a)},b.isPowerOfTwo=function(c){if(!b.isInteger(c))throw new a("Unexpected","math.isPowerOfTwo() only take integer. given: <"+c+">");return 0!==c&&0==(c&c-1)},b.isFloatPowerOfTwo=function(a){var c=b.log(a,2);return b.isInteger(c)},b.log=function(a,b){return Math.log(a)/Math.log(b)},b.toInt=function(a){return"number"==typeof a?a:parseInt(a,10)},b.lcm=function(a,b){c(a),c(b);for(var d=a>b?a:b,e=a>b?b:a,f=1;f<=e;f++)if(d*f%e==0)return d*f;return e},b.gcd=function(a,b){for(c(a),c(b);0!==b;){var d=a%b;a=b,b=d}return a};var c=function(a){if("number"!=typeof a||isNaN(a)||!isFinite(a))throw new Error("the value ["+a+"] must be a number.")};b.simplifyFraction=function(a){var c=b.gcd(a.numerator,a.denominator);return{numerator:a.numerator/c,denominator:a.denominator/c}},b.solveLinearA=function(a,b,c,d){return(d-b)/(c-a)},b.solveLinearB=function(a,b,c){return b-c*a},b.max2=function(a,b){return Math.max(a,b)},b.min2=function(a,b){return Math.min(a,b)},b.cmp=function(a,b){return a-b},b.cmpReverse=function(a,b){return b-a},b.isEven=function(a){return a%2==0},b.add=function(a,b){return a+b},b.sub=function(a,b){return a-b},b.isMultipleOf=function(a,c){return b.gcd(a,c)===c},b.removeFactorOfTwo=function(a){for(c(a);0!==a&&a%2==0;)a/=2;return a},b.gradiansToDegrees=function(a){return 180*a/Math.PI},b.degreesToGradians=function(a){return a*Math.PI/180}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.beamUtils,c=Adagio.Utils.math,d=Adagio.Utils.beamsUtils={};d.hasFirstBeam=function(a){return a.some(b.isFirst)},d.hasForward=function(a){var c=d.getFirst(a);return b.hasForward(c)},d.hasBackward=function(a){var c=d.getFirst(a);return b.hasBackward(c)},d.isBegin=function(a){var c=d.getFirst(a);return b.isBegin(c)},d.isContinue=function(a){var c=d.getFirst(a);return b.isContinue(c)},d.isEnd=function(a){var c=d.getFirst(a);return b.isEnd(c)},d.getFirst=function(a){return a.find(b.isFirst)},d.getLastType=function(a){var c=d.getLast(a);return b.getType(c)},d.getLast=function(a){return a.reduce(d.max)},d.max=function(c,d){var e=b.compare(c,d);if(e>0)return c;if(e<0)return d;throw new a("Unexpected","There should not be two beams with the same number.")},d.createBegin=function(a){return d.createBeams(b.createBegin,a)},d.createContinue=function(a){return d.createBeams(b.createContinue,a)},d.createEnd=function(a){return d.createBeams(b.createEnd,a)},d.createBeams=function(a,b){for(var c=[],d=0;d<b;d++){var e=a(d);c.push(e)}return c},d.durationToNbBeams=function(a){return-Math.floor(c.log(a,2))},d.getNb=function(a){return a.length},d.getOrderedBeams=function(a){return a=a.slice(),a.sort(b.compareSafe),a}}.call(this),function(){"use strict";var a=Adagio.Values.timeValues={};a.MAX_BEATS=64,a.MAX_BEAT_TYPE=64,a.SYMBOLS_LIST=["common","cut","normal","single-number","note","dotted-note"],a.SUPPORTED_SYMBOLS=["common","cut","normal","single-number"],a.DEFAULT_SYMBOL="normal",a.SEPARATORS_LIST=["none","horizontal","diagonal","vertical","adjacent"],a.DEFAULT_SEPARATOR="none"}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError=function(a,b){var c=Error.call(this,a);return this.name=c.name="ValueError",this.stack=c.stack,this.message=c.message,void 0!==b&&(this.code=b),this};a.prototype=Object.create(Error.prototype,{constructor:{value:a}})}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Values.timeValues,c=Adagio.Error.value.BadTimeSymbolError=function(b){var c=d(b),e=a.call(this,c);return this.name=e.name="BadTimeSymbolError",this.stack=e.stack,this.message=e.message,this.symbol=b,this};c.prototype=Object.create(a.prototype,{constructor:{value:c}});var d=function(a){return"time signature symbol value ["+a+"] is invalid. It has to be one of these values: ["+b.SYMBOLS_LIST.join(", ")+"]. "}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Values.timeValues,c=Adagio.Error.value.BadTimeSeparatorError=function(b){var c=d(b),e=a.call(this,c);return this.name=e.name="BadTimeSeparatorError",this.stack=e.stack,this.message=e.message,this.separator=b,this};c.prototype=Object.create(a.prototype,{constructor:{value:c}});var d=function(a){return"time signature separator value ["+a+"] is invalid. It has to be one of these values: ["+b.SEPATATORS_LIST.join(", ")+"]. "}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Values.timeValues,c=Adagio.Error.value.BadBeatsError=function(b,c){var e=c||d(b),f=a.call(this,e);return this.name=f.name="BadBeatsError",this.stack=f.stack,this.message=f.message,this.beats=b,this};c.prototype=Object.create(a.prototype,{constructor:{value:c}});var d=function(a){return"beats value ["+a+"] is invalid. It has to be a positive non null integer between [1 and "+b.MAX_BEATS+"]. "}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Values.timeValues,c=Adagio.Error.value.BadBeatTypeError=function(b,c){var e=c||d(b),f=a.call(this,e);return this.name=f.name="BadBeatTypeError",this.stack=f.stack,this.message=f.message,this.beatType=b,this};c.prototype=Object.create(a.prototype,{constructor:{value:c}});var d=function(a){return"beat type value "+a+" is invalid. It has to be a power of two, and up to "+b.MAX_BEAT_TYPE+". "}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.TimeSignatureInconsistent=function(){var b=c(),d=a.call(this,b);return this.name=d.name="TimeSignatureInconsistent",this.stack=d.stack,this.message=d.message,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(){return"the time signature is inconsistent."}}.call(this),function(){"use strict"
;var a=Adagio.Values.timeValues,b=Adagio.Utils.clone,c=Adagio.Utils.math,d=Adagio.Error.InternalError,e=Adagio.Error.value.BadTimeSymbolError,f=Adagio.Error.value.BadTimeSeparatorError,g=Adagio.Error.value.BadBeatsError,h=Adagio.Error.value.BadBeatTypeError,i=Adagio.Error.value.TimeSignatureInconsistent,j=Adagio.Utils.timeUtils={};j.getSymbol=function(b){return j.hasSymbol(b)?b.$symbol:a.DEFAULT_SYMBOL},j.hasSymbol=function(a){return void 0!==a.$symbol},j.getSeparator=function(b){return j.hasSeparator(b)?b.$separator:a.DEFAULT_SEPARATOR},j.hasSeparator=function(a){return void 0!==a.$separator},j.getBeats=function(a){return parseInt(a.beats)},j.getBeatType=function(a){return parseInt(a["beat-type"])},j.check=function(a){j.checkBeats(a),j.checkBeatType(a),j.hasSymbol(a)&&j.checkSupportedSymbol(a),j.hasSeparator(a)&&j.checkSeparator(a),j.checkConsistent(a)},j.checkBeats=function(a){var b=j.getBeats(a),c=j.getBeatType(a);if(!j.isValidBeats(b,c))throw new g(a.beats)},j.isValidBeats=function(b,d){var e=Math.max(a.MAX_BEATS,4*d);return c.isInteger(b)&&b>0&&b<=e},j.checkBeatType=function(a){var b=j.getBeatType(a);if(!j.isValidBeatType(b))throw new h(a["beat-type"])},j.isValidBeatType=function(b){return c.isInteger(b)&&b>0&&b<=a.MAX_BEAT_TYPE&&c.isPowerOfTwo(b)},j.checkSymbol=function(a){var b=j.getSymbol(a);if(!j.isValidSymbol(b))throw new e(b)},j.isValidSymbol=function(b){return a.SYMBOLS_LIST.includes(b)},j.checkSupportedSymbol=function(a){var b=j.getSymbol(a);if(!j.isSupportedSymbol(b))throw new e(b)},j.isSupportedSymbol=function(b){return a.SUPPORTED_SYMBOLS.includes(b)},j.checkSeparator=function(a){var b=j.getSeparator(a);if(!j.isValidSeparator(b))throw new f(b)},j.isValidSeparator=function(b){return a.SEPARATORS_LIST.includes(b)},j.isSame=function(a,b){return j.getBeats(a)===j.getBeats(b)&&j.getBeatType(a)===j.getBeatType(b)&&j.getSymbol(a)===j.getSymbol(b)},j.copy=function(a){var b=j.getBeats(a),c=j.getBeatType(a),d=j.getSymbol(a);return j.isSupportedSymbol(d)||(d=void 0),j.create(b,c,d)},j.create=function(b,c,e){var f={beats:b.toString(),"beat-type":c.toString()};void 0!==e&&e!==a.DEFAULT_SYMBOL&&(f.$symbol=e);var g;if(!j.isValidBeatType(c))throw g="The following beat type value ["+c+"] is not valid.",new d("Unexpected",g);if(!j.isValidBeats(b,c))throw g="The following beats value ["+b+"] is not valid.",new d("Unexpected",g);return f},j.removeDefault=function(b){j.getSymbol(b)===a.DEFAULT_SYMBOL&&delete b.$symbol},j.makeDiff=function(a,c){return b(c)},j.checkCommonConsistent=function(a){var b=j.getBeats(a),c=j.getBeatType(a);if(4!==b||4!==c)throw new i},j.checkCutConsistent=function(a){var b=j.getBeats(a),c=j.getBeatType(a);if(2!==b||2!==c)throw new i},j.checkSingleCommon=function(a){if(j.getBeats(a)!==j.getBeatType(a))throw new i},j.checkNormalConsistent=function(){};var k={common:j.checkCommonConsistent,cut:j.checkCutConsistent,normal:j.checkNormalConsistent,"single-number":j.checkSingleCommon};j.checkConsistent=function(a){var b=j.getSymbol(a),c=k[b];if(void 0===c){throw new d("Unexpected","The symbol ["+b+"] is not supported.")}c(a)},j.getNbRealBeats=function(a){var b=j.getBeats(a);return j.isCompound(a)&&(b/=3),b},j.isCompound=function(a){var b=j.getBeats(a);return j.isBeatsCompound(b)},j.isBeatsCompound=function(a){return 6===a||9===a||12===a}}.call(this),function(){"use strict";var a=Adagio.Utils.math,b=Adagio.Utils.Fraction=function(a,b){this.init(a,b)},c=b.prototype;c.init=function(a,b){this.numerator=a,this.denominator=b},c.reverse=function(){var a=this.numerator;this.numerator=this.denominator,this.denominator=a},c.simplify=function(){var b=a.gcd(this.numerator,this.denominator);this.numerator/=b,this.denominator/=b},c.divideWith=function(a){this.numerator*=a.denominator,this.denominator*=a.numerator},c.getDenominator=function(){return this.denominator},c.getNumerator=function(){return this.numerator}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.math,c=Adagio.Utils.Fraction,d=Adagio.Utils.timeModifUtils={};d.createDefault=function(){return d.create(1,1)},d.create=function(a,b){return{"actual-notes":a.toString(),"normal-notes":b.toString()}},d.getActual=function(a){return parseInt(a["actual-notes"],10)},d.getNormal=function(a){return parseInt(a["normal-notes"],10)},d.isSame=function(a,b){return d.getActual(a)===d.getActual(b)&&d.getNormal(a)===d.getNormal(b)},d.copy=function(a){var b=d.getActual(a),c=d.getNormal(a);return d.create(b,c)},d.isNormal=function(a){return d.getActual(a)===d.getNormal(a)},d.combine=function(a,b){var c=d.getActual(a),e=d.getActual(b),f=d.getNormal(a),g=d.getNormal(b);return d.create(c*e,f*g)},d.getShiftToShardDurationType=function(a){var c=d.getNormal(a),e=b.log(c,2);return Math.floor(e)},d.getShiftToWholeDurationType=function(a){var c=d.getNormal(a),e=b.log(c,2);return-Math.floor(e)},d.getWholeNbDots=function(a){var c=d.getNormal(a);return b.isMultipleOf(c,3)?1:0},d.getFraction=function(a){var b=d.getActual(a),e=d.getNormal(a);return new c(b,e)},d.subtract=function(a,b){var c=d.getActual(a),e=d.getActual(b),f=d.getNormal(a),g=d.getNormal(b);return d.create(c/e,f/g)},d.isCompatible=function(a,b){var c=d.getNormal(a),f=d.getNormal(b);if(!e(c,f))return!1;var g=d.getActual(a),h=d.getActual(b);return e(g,h)},d.stringify=function(a){return d.getActual(a)+"/"+d.getNormal(a)};var e=function(a,c){return a=b.removeFactorOfTwo(a),c=b.removeFactorOfTwo(c),a===c};d.getBinaryCoeff=function(b){if(d.isNormalBinary(b))return 1;if(d.isNormalTernary(b))return 3;throw new a("Unexpected")},d.isNormalBinary=function(a){var c=d.getNormal(a);return b.isPowerOfTwo(c)},d.isNormalTernary=function(a){return d.getNormal(a)%3==0}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadDurationTypeError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadDurationTypeError",this.stack=e.stack,this.message=e.message,this.durationType=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"the duration type value ["+a+"] is invalid."}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Error.value.BadDurationTypeError,c=Adagio.Utils.math,d=Adagio.Utils.typeUtils,e=Adagio.Values.DurationType={FULL:1,HALF:2,QUARTER:3,EIGHT:4,SIXTEENTH:5,THIRTY_SECOND:6,SIXTY_FOURTH:7},f=d.pairsToMap([{key:e.FULL,value:"whole"},{key:e.HALF,value:"half"},{key:e.QUARTER,value:"quarter"},{key:e.EIGHT,value:"eighth"},{key:e.SIXTEENTH,value:"16th"},{key:e.THIRTY_SECOND,value:"32nd"},{key:e.SIXTY_FOURTH,value:"64th"}]),g=d.reverseMap(f);e.MAX_VALUE=e.SIXTY_FOURTH,e.MIN_VALUE=e.FULL,e.check=function(a){if(!e.isValid(a))throw new b(a)},e.isValid=function(a){return c.isInteger(a)&&e.MIN_VALUE<=a&&a<=e.MAX_VALUE},e.toQuarterDuration=function(b){if(e.isValid(b))return b=parseInt(b,10),4/Math.pow(2,b-1);throw new a("BadDurationType","The duration type ["+b+"] is invalid.")},e.quarterToDurationType=function(b){if(0===b)return null;var d=c.log(4/b,2)+1;if(e.isValid(d))return d;throw new a("BadQuarterDuration","quarter duration ["+b+"] is not convertible to a DurationType")},e.toRoomForDots=function(a){return e.MAX_VALUE-a},e.fromMxl=function(b){if(void 0!==g[b])return parseInt(g[b],10);throw new a("InvalidMxlType","The MusicXML note-type value ["+b+"] is not supported.")},e.toMxl=function(b){if(void 0!==f[b])return f[b];throw new a("InvalidDurationType","The duration type ["+b+"] is not convertible to a MusicXML note-type.")},e.raiseError=function(b){throw new a("InvalidDurationType","The duration type ["+b+"] is invalid.")}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.math,c=Adagio.Utils.timeUtils,d=Adagio.Utils.timeModifUtils,e=Adagio.Utils.Fraction,f=Adagio.Values.DurationType,g=Adagio.Utils.durationUtils={},h=4;g.isNbDotsValid=function(a){return b.isInteger(a)&&a>=0&&a<=2},g.divisionsToQuarter=function(a,b){return a/b},g.quarterToDuration=function(a,b){return g.quarterToDivisions(a,b)},g.quarterToDivisions=function(a,b){return a*b},g.isBaseDuration=function(a){return g.extractBaseDuration(a)===a},g.extractBaseDuration=function(c){if(0===c)throw new a("Unexpected","quarter duration cannot be 0");var d=b.log(c,2);return d=Math.floor(d),Math.pow(2,d)},g.extractSmallestBaseDuration=function(a){var b;do{b=g.extractBaseDuration(a),a-=b}while(a>0);return b},g.quarterToNbFlags=function(a){var c=f.toQuarterDuration(f.EIGHT);return a>c?0:b.log(c/a,2)+1},g.durationOptsToQuarter=function(a){g.fillDefaultOpts(a);var b=f.toQuarterDuration(a.durationType);return b=g.applyDotsToDuration(b,a.nbDots)},g.durationOptsToDuration=function(a,b){g.fillDefaultOpts(a);var c=f.toQuarterDuration(a.durationType),d=c*b;return d=g.applyDotsToDuration(d,a.nbDots)},g.actualDivisionsToDurationOpts=function(a,b,c){var d=g.actualToNormal(a,c),e=g.divisionsToQuarter(d,b);return g.quarterToDurationOpts(e)},g.applyDotsToDuration=function(a,b){for(var c=a,d=0;d<b;d++)a/=2,c+=a;return c},g.durationOptsToDivisions=function(a,b){g.fillDefaultOpts(a);var c=f.toQuarterDuration(a.durationType);return c=g.getSmallestDotDuration(c,a.nbDots),g.getQuarterRequiredDpq(c,b)},g.getQuarterRequiredDpq=function(a,b){a=g.extractSmallestBaseDuration(a);var c;c=a<1?new e(1,1/a):new e(a,1);var f=d.getFraction(b);return c.divideWith(f),c.simplify(),c.getDenominator()},g.getSmallestDotDuration=function(a,b){for(var c=0;c<b;c++)a/=2;return a},g.fillDefaultOpts=function(a){a.nbDots=a.nbDots||0},g.durationToFractionString=function(a,c){var d={numerator:a,denominator:c};return d=b.simplifyFraction(d),1===d.denominator?d.numerator+"":d.numerator+"/"+d.denominator},g.extractQuarterPossibleDuration=function(a){var b=g.extractBaseDuration(a);b=Math.min(b,h);var c=b;a-=b,b/=2;for(var d=0;a>=b&&d<2;)c+=b,a-=b,b/=2,d++;return c},g.quarterToDurationOpts=function(a){var b=g.extractBaseDuration(a);return{durationType:f.quarterToDurationType(b),nbDots:g.extractNbDots(a)}},g.extractNbDots=function(a){for(var b=g.extractBaseDuration(a),c=0,d=b,e=b;e<a;)c++,d/=2,e+=d;return c},g.timeToDivisions=function(a,b){var c=g.timeToQuarter(a);return g.quarterToDuration(c,b)},g.timeToQuarter=function(a){var b=c.getBeatType(a),d=g.beatTypeToQuarter(b);return c.getBeats(a)*d},g.beatTypeToDivisions=function(a,b){var c=g.beatTypeToQuarter(a);return g.quarterToDuration(c,b)},g.isQuarterValidNoteDuration=function(a){for(var b=null;a>0;){var c=g.extractBaseDuration(a);if(null!==b&&c!==b/2)return!1;if(c>h)return!1;a-=c,b=c}return!0},g.beatTypeToQuarter=function(a){return 4/a},g.quarterToBeatType=function(a){return 4/a},g.actualToNormal=function(a,b){var c=d.getNormal(b);return a*d.getActual(b)/c},g.normalToActual=function(a,b){return a*d.getNormal(b)/d.getActual(b)},g.nbDotsToShards=function(a){if(0===a)return 2;for(var b=1,c=0,d=0;d<=a;d++)c+=b,b++;return c},g.quarterDurationToRequiredDpq=function(a){return g.quarterToRequiredDivisions(a)},g.quarterToRequiredDivisions=function(a){if(0===a)return 1;var b=g.extractSmallestBaseDuration(a);return b>1?1:1/b},g.isValidQuarter=function(a){if(!b.isNumber(a))return!1;if(a<0)return!1;for(;a>0;){var c=g.extractBaseDuration(a);if((c=Math.min(c,h))<.0625)return!1;a-=c}return!0},g.getBeatQuarterDuration=function(a){var b=c.getBeatType(a),d=g.beatTypeToQuarter(b);return c.isCompound(a)&&(d*=3),d},g.isValidTupletDuration=function(a,c){return a/=d.getBinaryCoeff(c),b.isFloatPowerOfTwo(a)}}.call(this),function(){"use strict";var a=Adagio.Utils.tieUtils={};a.isStart=function(b){return"start"===a.getType(b)},a.isStop=function(b){return"stop"===a.getType(b)},a.getType=function(a){return a.$type},a.createStart=function(){return{$type:"start"}},a.createStop=function(){return{$type:"stop"}}}.call(this),function(){"use strict";var a=Adagio.Utils.tieUtils,b=Adagio.Utils.tiesUtils={};b.hasStart=function(b){return b.some(a.isStart)},b.hasStop=function(b){return b.some(a.isStop)},b.addStop=function(b){var c=a.createStop();b.unshift(c)},b.addStart=function(b){var c=a.createStart();b.push(c)},b.addTie=function(a,b){a.push(b)},b.removeStart=function(b){var c=b.findIndex(a.isStart);c>=0&&b.splice(c,1)},b.removeStop=function(b){var c=b.findIndex(a.isStop);c>=0&&b.splice(c,1)}}.call(this),function(){"use strict";var a=Adagio.Error.PitchRangeError=function(a){a=a||"The pitch setted is outside authorized range";var b=Error.call(this,a);return this.name=b.name="PitchRangeError",this.stack=b.stack,this.message=b.message,this};a.prototype=Object.create(Error.prototype,{constructor:{value:a}})}.call(this),function(){"use strict";var a=Adagio.Error.PitchRangeError,b=Adagio.Error.OctaveRangeError=function(b){var c="octave value "+b+" is outside authorized range",d=a.call(this,c);return this.name=d.name="OctaveRangeError",this.stack=d.stack,this.message=d.message,this.octave=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}})}.call(this),function(){"use strict";var a=Adagio.Error.PitchRangeError,b=Adagio.Error.AlterRangeError=function(b){var c="alter value "+b+" is outside authorized range",d=a.call(this,c);return this.name=d.name="AlterRangeError",this.stack=d.stack,this.message=d.message,this.alter=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}})}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadStepError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadStepError",this.stack=e.stack,this.message=e.message,this.step=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"the step value ["+a+"] is invalid."}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadOctaveError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadOctaveError",this.stack=e.stack,this.message=e.message,this.octave=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"the octave value ["+a+"] is invalid."}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadAlterError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadAlterError",this.stack=e.stack,this.message=e.message,this.alter=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"the alter value ["+a+"] is invalid."}}.call(this),function(){"use strict";var a=Adagio.Utils.math,b=Adagio.Values.Octave={};b.MIN=0,b.MAX=9,b.isValid=function(c){return a.isInteger(c)&&b.MIN<=c&&c<=b.MAX}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Values.Clef={};b.values={C:{octave:4,step:"C"},G:{octave:4,step:"G"},F:{octave:3,step:"F"},percussion:{octave:4,step:"G"},TAB:{octave:4,step:"G"}},b.getOctave=function(c){if(void 0===b.values[c]){throw new a("InvalidClefSign","Invalid clef sign: ["+c+"].")}return b.values[c].octave}}.call(this),function(){"use strict";Adagio.Values.Step={};var a=Adagio.Values.Step;a.values=["C","D","E","F","G","A","B"],a.idx={},a.MIN_IDX=0,a.MAX_IDX=a.values.length-1;for(var b=0;b<a.values.length;b++)a.idx[a.values[b]]=b;a.isValid=function(b){return b in a.idx},a.octaveSize=a.values.length,a.getStepIdx=function(b){return a.idx[b]},a.idxToStep=function(b){return a.values[b]},a.getSize=function(){return a.values.length}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadAccidentalError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadAccidentalError",this.stack=e.stack,this.message=e.message,this.accidental=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"the accidental style ["+a+"] is invalid."}}.call(this),function(){"use strict";var a=Adagio.Utils.math,b=Adagio.Error.InternalError,c=Adagio.Error.value.BadAccidentalError,d=Adagio.Values.AccidentalStyle={SHARP:"sharp",NATURAL:"natural",FLAT:"flat",DOUBLESHARP:"double-sharp",SHARPSHARP:"sharp-sharp",FLATFLAT:"flat-flat",NATURALSHARP:"natural-sharp",NATURALFLAT:"natural-flat",QUARTERFLAT:"quarter-flat",QUARTERSHARP:"quarter-sharp",THREEQUARTERFLAT:"three-quarters-flat",THREEQUARTERSHARP:"three-quarters-sharp",SHARPDOOWN:"sharp-down",SHARPUP:"sharp-up",NATURALDOWN:"natural-down",NATURALUP:"natural-up",FLATDOWN:"flat-down",FLATUP:"flat-up",TRIPLESHARP:"triple-sharp",TRIPLEFLAT:"triple-flat",SLASHQUARTERSHARP:"slash-quarter-sharp",SHLASHSHARP:"slash-sharp",SLASHFLAT:"slash-flat",DOUBLESLASHFLAT:"double-slash-flat",SHARP1:"sharp-1",SHARP2:"sharp-2",SHARP3:"sharp-3",SHARP5:"sharp-5",FLAT1:"flat-1",FLAT2:"flat-2",FLAT3:"flat-3",FLAT4:"flat-4",SORI:"sori",KORON:"koron"},e=[d.SHARP,d.NATURAL,d.FLAT,d.SHARPSHARP,d.DOUBLESHARP,d.FLATFLAT];d.isSupportedStyle=function(a){return-1!==e.indexOf(a)},d.isSupportedAlter=function(b){return a.isInteger(b)&&-2<=b&&b<=2},d.raiseError=function(a){throw new b("BadAccidentalValue","The accidental value: ["+a+"] is invalid")},d.check=function(a){if(!d.isSupportedStyle(a))throw new c(a)}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadClefLineError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadClefLineError",this.stack=e.stack,this.message=e.message,this.line=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"line value "+a+" is invalid. It has to be a positive integer between [0 and 6]"}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadClefSignError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadClefSignError",this.stack=e.stack,this.message=e.message,this.sign=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"sign value "+a+" is invalid. Suported clefs signs are C, G, F and TAB"}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadOctaveChangeError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadOctaveChangeError",this.stack=e.stack,this.message=e.message,this.octaveChange=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"octave change value "+a+" is invalid. It has to be a positive integer between [-3 and 3]"}}.call(this),function(){"use strict";var a=Adagio.Error.value.BadClefLineError,b=Adagio.Error.value.BadClefSignError,c=Adagio.Error.value.BadOctaveChangeError,d=Adagio.Error.InternalError,e=Adagio.Utils.clone,f=Adagio.Utils.math,g=Adagio.Values.Clef,h=Adagio.Values.Step,i=Adagio.Utils.clefUtils={},j="percussion",k="TAB",l="G",m="G",n=0,o=2,p=2,q=3,r=3,s=4,t=3,u=5,v={C:t,F:s,G:o,percussion:p,TAB:u},w={C:t,F:s,G:o,percussion:q,TAB:r};i.create=function(a,b){var c={sign:a};return"number"==typeof b&&i.setLine(c,b),i.check(c),c},i.getOctaveChange=function(a){return i.hasOctaveChange(a)?parseInt(a["clef-octave-change"],10):n},i.setOctaveChange=function(a,b){b===n?delete a["clef-octave-change"]:a["clef-octave-change"]=b.toString()},i.hasOctaveChange=function(a){return void 0!==a["clef-octave-change"]},i.getLine=function(a){if(i.hasLine(a))return parseInt(a.line,10);var b=i.getSign(a),c=v[b];if(void 0===c){throw new d("NoClefLineError","There is no default line for the clef sign ["+b+"].")}return c},i.getDisplayLine=function(a){if(i.isPercussion(a))return q;if(i.hasLine(a))return parseInt(a.line,10);if(i.isTab(a))return r;var b=i.getSign(a),c=w[b];if(void 0===c){throw new d("NoClefLineError","There is no default line for the clef sign ["+b+"].")}return c},i.hasLine=function(a){return void 0!==a.line},i.getSign=function(a){return a.sign},i.setSign=function(a,b){a.sign=b},i.isSame=function(a,b){return i.getLine(a)===i.getLine(b)&&i.getSign(a)===i.getSign(b)&&i.getOctaveChange(a)===i.getOctaveChange(b)},i.copy=function(a){var b=i.getLine(a),c=i.getSign(a),d=i.create(c,b),e=i.getOctaveChange(a);return i.setOctaveChange(d,e),d},i.removeDefault=function(a){i.getOctaveChange(a)===n&&delete a["clef-octave-change"]},i.makeDiff=function(a,b){return e(b)},i.check=function(a){i.checkLine(a),i.checkSign(a),i.hasOctaveChange(a)&&i.checkOctaveChange(a)},i.checkLine=function(b){if(!i.isLineValid(b))throw new a(b.line)},i.isLineValid=function(a){var b=i.getLine(a);return f.isInteger(b)&&b>=0&&b<=10},i.checkSign=function(a){if(!i.isSignValid(a))throw new b(a.sign)},i.makeLineExplicit=function(a){if(!i.hasLine(a)){var b=i.getSign(a),c=v[b];i.setLine(a,c)}},i.setLine=function(a,b){a.line=b.toString()};var x=["G","F","C",j,"TAB"];i.isSignValid=function(a){var b=i.getSign(a);return x.includes(b)},i.checkOctaveChange=function(a){if(!i.isOctaveChangeValid(a))throw new c(a["clef-octave-change"])},i.isOctaveChangeValid=function(a){var b=i.getOctaveChange(a);return!isNaN(b)&&-3<=b&&b<=3},i.createPercussion=function(){return{sign:j}},i.isPercussion=function(a){return i.getSign(a)===j},i.isTab=function(a){return i.getSign(a)===k},i.getBaseOctave=function(a){var b=i.getSign(a);return g.getOctave(b)},i.getOctave=function(a){return i.getBaseOctave(a)+i.getOctaveChange(a)},i.getStepIdx=function(a){var b=i.getStep(a);return h.getStepIdx(b)},i.getStep=function(a){return i.isPercussion(a)?l:i.isTab(a)?m:i.getSign(a)}}.call(this),function(){"use strict";var a=[2,2,1,2,2,2,1],b=Adagio.Values.Step,c=Adagio.Utils.math,d=Adagio.Error.InternalError,e=Adagio.Utils.intervalUtils={};e.getChromaticShift=function(a,b){return b>0?f(a,b):b<0?g(a,b):0};var f=function(d,e){var f=b.getStepIdx(d),g=[],h=f+e,i=b.getSize(),j=Math.min(i,h),k=Math.max(0,h-i);return Array.prototype.push.apply(g,a.slice(f,j)),Array.prototype.push.apply(g,a.slice(0,k)),g.reduce(c.add,0)},g=function(d,e){var f=b.getStepIdx(d),g=[],h=f+e,i=Math.max(0,h),j=b.getSize(),k=Math.min(j,h+j);return Array.prototype.push.apply(g,a.slice(i,f)),Array.prototype.push.apply(g,a.slice(k,j)),-g.reduce(c.add,0)};e.searchDiatonic=function(a,b,c){return b>0?h(a,b,c):b<0?i(a,b,c):0};var h=function(a,b,c){if(c(b))return 0;for(var e=k(a),f=0;f<e.length&&b>=0;f++){var g=e[f],h=f+1;if(b-=g,c(b))return h}throw new d("DiatonicNotFound")},i=function(a,b,c){if(c(b))return 0;for(var e=j(a),f=0;f<e.length&&b<=0;f++){var g=e[f],h=-f-1;if(b+=g,c(b))return h}throw new d("DiatonicNotFound")},j=function(a){var b=k(a);return b.reverse(),b},k=function(c){var d=b.getStepIdx(c),e=[];return Array.prototype.push.apply(e,a.slice(d)),Array.prototype.push.apply(e,a.slice(0,d)),e}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadOctaveChangeTransposeError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadOctaveChangeTransposeError",this.stack=e.stack,this.message=e.message,this.octaveChange=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"octaveChange transpose value "+a+" is invalid. It MUST be an integer between [-4 and 4]"}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadChromaticTransposeError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadChromaticTransposeError",this.stack=e.stack,this.message=e.message,this.chromatic=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"chromatic transpose value "+a+" is invalid. It MUST be an integer between [-11 and 11]"}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadDiatonicTransposeError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadDiatonicTransposeError",this.stack=e.stack,this.message=e.message,this.diatonic=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"diatonic transpose value "+a+" is invalid. It MUST be an integer between [-6 and 6]"}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadDoubleTransposeError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadDoubleTransposeError",this.stack=e.stack,this.message=e.message,this.double=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"double transpose value "+a+" is invalid. It MUST be an empty object"}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.ChromaticComplianceError=function(b,d){var e=c(b,d),f=a.call(this,e);return this.name=f.name="ChromaticComplianceError",this.stack=f.stack,this.message=f.message,this.chromatic=b,this.diatonic=d,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a,b){return"The chromatic value ["+a+"] is not in the acceptable range for the diatonic ["+b+"]."}}.call(this),function(){"use strict";var a=Adagio.Utils.clone,b=Adagio.Utils.math,c=Adagio.Utils.typeUtils,d=Adagio.Error.value.BadOctaveChangeTransposeError,e=Adagio.Error.value.BadChromaticTransposeError,f=Adagio.Error.value.BadDiatonicTransposeError,g=Adagio.Error.value.BadDoubleTransposeError,h=Adagio.Error.value.ChromaticComplianceError,i=Adagio.Utils.transposeUtils={};i.DEFAULT_DIATONIC=0,i.DEFAULT_OCTAVE_CHANGE=0,i.DEFAULT_CHROMATIC=0,i.NB_CHROMATIC=12,i.NB_DIATONIC=7,i.getDiatonic=function(a){return i.hasDiatonic(a)?parseInt(a.diatonic,10):i.DEFAULT_DIATONIC},i.hasDiatonic=function(a){return void 0!==a.diatonic},i.getOctaveChange=function(a){return i.hasOctaveChange(a)?parseInt(a["octave-change"],10):i.DEFAULT_OCTAVE_CHANGE},i.hasOctaveChange=function(a){return void 0!==a["octave-change"]},i.getChromatic=function(a){return parseInt(a.chromatic,10)},i.hasDouble=function(a){return void 0!==a.double},i.createDefault=function(){return i.createIdentity()},i.createIdentity=function(){return i.create(i.DEFAULT_CHROMATIC)},i.create=function(a){return{chromatic:a.toString()}},i.isSame=function(a,b){return i.hasDouble(a)===i.hasDouble(b)&&i.getOctaveChange(a)===i.getOctaveChange(b)&&i.getChromatic(a)===i.getChromatic(b)&&i.getDiatonic(a)===i.getDiatonic(b)},i.removeDefault=function(a){i.hasDiatonic(a)&&i.getDiatonic(a)===i.DEFAULT_DIATONIC&&i.removeDiatonic(a),i.hasOctaveChange(a)&&i.getOctaveChange(a)===i.DEFAULT_OCTAVE_CHANGE&&i.removeOctaveChange(a)},i.removeDiatonic=function(a){delete a.diatonic},i.removeOctaveChange=function(a){delete a["octave-change"]},i.isDefault=function(a){return!i.hasDouble(a)&&i.getChromatic(a)===i.DEFAULT_CHROMATIC&&i.getDiatonic(a)===i.DEFAULT_DIATONIC&&i.getOctaveChange(a)===i.DEFAULT_OCTAVE_CHANGE},i.makeDiff=function(b,c){return a(c)},i.check=function(a){i.checkChromatic(a),i.hasDiatonic(a)&&i.checkDiatonic(a),i.hasOctaveChange(a)&&i.checkOctaveChange(a),i.hasDouble(a)&&i.checkDouble(a),i.checkChromaticValidForDiatonic(a)},i.checkChromatic=function(a){var b=i.getChromatic(a);if(!i.isChromaticValid(b))throw new e(a.chromatic)},i.isChromaticValid=function(a){return!isNaN(a)&&a>=-11&&a<=11},i.checkDiatonic=function(a){var b=i.getDiatonic(a);if(!i.isDiatonicValid(b))throw new f(a.diatonic)},i.isDiatonicValid=function(a){return!isNaN(a)&&a>=-6&&a<=6},i.checkOctaveChange=function(a){var b=i.getOctaveChange(a);if(!i.isOctaveChangeValid(b))throw new d(a["octave-change"])},i.isOctaveChangeValid=function(a){return!isNaN(a)&&a>=-4&&a<=4},i.checkDouble=function(a){var b=a.double;if(i.isDoubleValid(b))throw new g(b)},i.isDoubleValid=function(a){return j(a)},i.checkChromaticValidForDiatonic=function(a){if(!i.isChromaticValidForDiatonic(a)){var b=i.getChromatic(a),c=i.getDiatonic(a);throw new h(b,c)}},i.isChromaticValidForDiatonic=function(a){var b=i.getChromatic(a),c=i.getDiatonic(a);return!(b>0&&c<0||b<0&&c>0)};var j=function(a){return c.isObject(a)&&c.isObjectEmpty(a)};i.fillEmptyEntriesWithDefault=function(a){for(var b=a.getNbStaves(),c=0;c<b;c++)a.hasEntry(c)||a.setEntry(i.createDefault(),c)},i.setChromatic=function(a,b){a.chromatic=b.toString()},i.setDiatonic=function(a,b){b===i.DEFAULT_DIATONIC?i.removeDiatonic(a):a.diatonic=b.toString()},i.setOctaveChange=function(a,b){b===i.DEFAULT_OCTAVE_CHANGE?i.removeOctaveChange(a):a["octave-change"]=b},i.getReverse=function(a){var b=i.getChromatic(a),c=i.getDiatonic(a),d=i.getOctaveChange(a),e=i.create(-b);return i.setDiatonic(e,-c),i.setOctaveChange(e,-d),e},i.isIdentity=function(a){return 0===i.getOctaveChange(a)&&0===i.getChromatic(a)&&0===i.getDiatonic(a)},i.isEnharmonic=function(a){return 0===i.getOctaveChange(a)&&0===i.getChromatic(a)},i.isUnison=function(a){return 0===i.getDiatonic(a)&&0===i.getChromatic(a)},i.isUpward=function(a){return i.getDiatonic(a)>0||i.getChromatic(a)>0},i.isSimilar=function(a,b){return i.isSame(a,b)||i.isSame(a,i.getOctaveEnharmonic(b))},i.getOctaveEnharmonic=function(a){var b=i.getChromatic(a);if(a=i.copy(a),0===b)return a;var c=i.getDiatonic(a),d=i.getOctaveChange(a);return b>0?(b-=i.NB_CHROMATIC,c-=i.NB_DIATONIC,d+=1):(b+=i.NB_CHROMATIC,c+=i.NB_DIATONIC,d-=1),i.setChromatic(a,b),i.setDiatonic(a,c),i.setOctaveChange(a,d),a},i.copy=function(a){var b=i.getChromatic(a),c=i.create(b),d=i.getDiatonic(a);i.setDiatonic(c,d);var e=i.getOctaveChange(a);return i.setOctaveChange(c,e),c},i.getDiff=function(a,c){return k(a,c,b.sub)},i.add=function(a,c){return k(a,c,b.add)};var k=function(a,b,c){var d=i.getOctaveChange(a),e=i.getOctaveChange(b),f=c(d,e),g=i.getDiatonic(a),h=i.getDiatonic(b),j=c(g,h),k=i.getChromatic(a),o=i.getChromatic(b),p=c(k,o),q=l(p,j),r=m(p,j);f+=n(p,j);var s=i.create(r);return i.setDiatonic(s,q),i.setOctaveChange(s,f),s},l=function(a,b){return p(a,b)?b+i.NB_DIATONIC:o(a,b)?b-i.NB_DIATONIC:b},m=function(a,b){return p(a,b)?a+i.NB_CHROMATIC:o(a,b)?a-i.NB_CHROMATIC:a},n=function(a,b){return p(a,b)?-1:o(a,b)?1:0},o=function(a,b){return a>=i.NB_CHROMATIC||b>=i.NB_DIATONIC},p=function(a,b){return a<=-i.NB_CHROMATIC||b<=-i.NB_DIATONIC};i.stringify=function(a){var b=i.getDiatonic(a),c=i.getChromatic(a);return"oct["+i.getOctaveChange(a)+"], diat["+b+"], chr["+c+"]."}}.call(this),function(){"use strict";var a=Adagio.Utils.clefUtils,b=Adagio.Utils.math,c=Adagio.Values.Step,d=Adagio.Utils.pitchLineUtils={};d.toPitch=function(b,c,f){var g=e(f),h=a.getLine(f),i=c-h+g;return d.absoluteLineToPitch(b,i)},d.toLine=function(b,c,f){var g=d.pitchToAbsoluteLine(b,c),h=e(f);return g+a.getLine(f)-h};var e=function(b){return d.pitchToAbsoluteLine(a,b)};d.pitchToAbsoluteLine=function(a,b){var d=a.getStepIdx(b),e=a.getOctave(b),f=e*c.octaveSize;return(f+=d)/2},d.absoluteLineToPitch=function(a,d){var e=2*d,f=e%c.octaveSize;f<0&&(f+=c.octaveSize,e-=c.octaveSize);var g=c.idxToStep(f),h=b.intPart(e/c.octaveSize);return a.create(h,g)},d.isValidLine=function(a){return"number"==typeof a&&b.isInteger(2*a)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Error.OctaveRangeError,c=Adagio.Error.AlterRangeError,d=Adagio.Error.value.BadStepError,e=Adagio.Error.value.BadOctaveError,f=Adagio.Error.value.BadAlterError,g=Adagio.Values.Octave,h=Adagio.Values.Step,i=Adagio.Values.AccidentalStyle,j=Adagio.Utils.intervalUtils,k=Adagio.Utils.transposeUtils,l=Adagio.Utils.math,m=Adagio.Utils.pitchLineUtils,n=Adagio.Utils.pitchUtils={};n.MAX_LINE=12.5,n.MIN_LINE=-6.5,n.lineToPitch=function(a,b){return m.toPitch(n,a,b)},n.pitchToLine=function(a,b){return m.toLine(n,a,b)},n.isSamePitch=function(a,b){return n.getAlter(a)===n.getAlter(b)&&(n.getStep(a)===n.getStep(b)&&n.getOctave(a)===n.getOctave(b))},n.naiveComparePitch=function(a,b){var c=n.compareLine(a,b);if(0!==c)return c;var d=n.getAlter(a),e=n.getAlter(b);return n.compareAlter(d,e)},n.compareAlter=function(a,b){return a-b},n.compareLine=function(a,b){var c=n.getOctave(a),d=n.getOctave(b),e=n.compareOctave(c,d);if(0!==e)return e;var f=n.getStep(a),g=n.getStep(b);return n.compareStep(f,g)},n.compareOctave=function(a,b){return a-b},n.compareStep=function(a,b){return h.idx[a]-h.idx[b]},n.isSameLine=function(a,b){return n.getOctave(a)===n.getOctave(b)&&n.getStep(a)===n.getStep(b)},n.getAlter=function(a){return void 0!==a.alter?l.toInt(a.alter):0},n.setAlter=function(a,b){0!==b?a.alter=b.toString():delete a.alter},n.getStep=function(a){return a.step},
n.getStepIdx=function(a){var b=n.getStep(a);return h.getStepIdx(b)},n.getOctave=function(a){return l.toInt(a.octave)};var o=["F","C","G","D","A","E","B"],p=["B","E","A","D","G","C","F"];n.stepToAlter=function(a,b){return b>0&&o.indexOf(a)<b?1:b<0&&p.indexOf(a)<-b?-1:0},n.stringify=function(a){var b="";return b+=n.getStep(a),b+="/",b+=n.getOctave(a),b+="/",b+=n.getAlter(a)},n.alterToAccidental=function(b){if(2===b)return i.DOUBLESHARP;if(1===b)return i.SHARP;if(0===b)return i.NATURAL;if(-1===b)return i.FLAT;if(-2===b)return i.FLATFLAT;throw new a("pitchUtils.alterToAccidental","invalid alter value: "+b)},n.accidentalToAlter=function(a){return a===i.SHARPSHARP||a===i.DOUBLESHARP?2:a===i.SHARP?1:a===i.NATURAL?0:a===i.FLAT?-1:a===i.FLATFLAT?-2:void i.raiseError(a)},n.check=function(a){var b=n.getOctave(a);if(!g.isValid(b))throw new e(a.octave);var c=n.getAlter(a);if(!n.isValidAlter(c))throw new f(a.alter);if(!h.isValid(a.step))throw new d(a.step)},n.shiftOctave=function(a,b){var c=n.getOctave(a),d=c+b;n.setOctave(a,d)};var q=function(a,b){var c=n.getOctave(a);r(a,c+b)};n.setOctave=function(a,b){n.checkOctave(b),r(a,b)},n.checkOctave=function(a){if(!g.isValid(a))throw new b(a)};var r=function(a,b){a.octave=b.toString()};n.shiftStepUnsafe=function(a,b){var c=s(a,b);q(a,c);var d=t(a,b),e=h.idxToStep(d);n.setStep(a,e)};var s=function(a,b){var c=n.getStepIdx(a);c+=b;var d=h.getSize();return c<0?-1:c>=d?1:0},t=function(a,b){var c=n.getStepIdx(a);c+=b;var d=h.getSize();return c<0?c+d:c>=d?c-d:c};n.setStep=function(a,b){a.step=b.toString()},n.shiftAlter=function(a,b){var c=n.getAlter(a);n.setAlter(a,c+b)},n.setAlter=function(a,b){n.checkAlter(b),0===b?delete a.alter:a.alter=b.toString()},n.checkAlter=function(a){if(!n.isValidAlter(a))throw new c(a)},n.isValidAlter=function(a){return-2<=a&&a<=2},n.hasDoubleAccidental=function(a){var b=n.getAlter(a);return-2===b||2===b},n.transpose=function(a,b,c){a=u(a,b,c);var d=n.getOctave(a);return n.checkOctave(d),a},n.willOverflow=function(a,b,c){a=u(a,b,c);var d=n.getOctave(a);return!g.isValid(d)};var u=function(b,c,d){b=n.copy(b),c=k.copy(c);var e=d?n.doubleAccidentalRange:n.simpleAccidentalRange;if(v(b,c),w(b,c),x(b,c,e),w(b,c),y(b,c),!k.isIdentity(c)){var f="at this point, transpose should be an identity",g=new a("TransposeFailed",f);throw g.pitch=b,g.transpose=c,g}return b};n.simpleAccidentalRange=function(a){return-1<=a&&a<=1},n.doubleAccidentalRange=function(a){return-2<=a&&a<=2};var v=function(a,b){var c=k.getOctaveChange(b);q(a,c),k.setOctaveChange(b,0)},w=function(a,b){var c=n.getStep(a),d=k.getDiatonic(b),e=k.getChromatic(b),f=j.getChromaticShift(c,d);n.shiftStepUnsafe(a,d),k.setDiatonic(b,0),k.setChromatic(b,e-f)},x=function(a,b,c){var d=n.getStep(a),e=n.getAlter(a),f=k.getChromatic(b),g=j.searchDiatonic(d,e+f,c);k.setDiatonic(b,g)},y=function(a,b){var c=k.getChromatic(b);n.shiftAlter(a,c),k.setChromatic(b,0)};n.getTransposeDiff=function(a,b){var c=n.getOctave(a)-n.getOctave(b),d=n.getStepIdx(a)-n.getStepIdx(b),e=h.getSize();c>0&&d<0?(c--,d+=e):c<0&&d>0&&(c++,d-=e);var f=n.getStep(b),g=j.getChromaticShift(f,d);g+=n.getAlter(a)-n.getAlter(b);var i=k.create(g);return k.setDiatonic(i,d),k.setOctaveChange(i,c),i},n.copy=function(a){var b=n.getOctave(a),c=n.getStep(a),d=n.getAlter(a),e=n.create(b,c);return n.setAlter(e,d),e},n.copyWithoutAlter=function(a){var b=n.getOctave(a),c=n.getStep(a);return n.create(b,c)},n.create=function(a,b,c){var d={octave:a.toString(),step:b.toString()};return c=c||0,n.setAlter(d,c),d}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadUnpitchedStrError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadUnpitchedStrError",this.stack=e.stack,this.message=e.message,this.unpitchedStr=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"The unpitched string "+a+" is invalid. "}}.call(this),function(){"use strict";var a=Adagio.Error.value.BadUnpitchedStrError,b=Adagio.Values.Step,c=Adagio.Values.Octave,d=Adagio.Utils.unpitchedUtils={};d.getStep=function(a){return a["display-step"]},d.getOctave=function(a){return parseInt(a["display-octave"],10)},d.create=function(a,b){return{"display-step":b,"display-octave":a.toString()}},d.getStepIdx=function(a){var c=d.getStep(a);return b.getStepIdx(c)},d.stringify=function(a){var b="u";return b+=d.getStep(a),b+="/",b+=d.getOctave(a)},d.parse=function(e){var f=e;if("u"!==f[0])throw new a(e);f=f.substr(1);var g=f.split("/"),h=g[0];if(!b.isValid(h))throw new a(e);var i=g[1],j=parseInt(i,0);if(!c.isValid(j))throw new a(e);return d.create(j,h)},d.isSame=function(a,b){return d.getOctave(a)===d.getOctave(b)&&d.getStep(a)===d.getStep(b)},d.isSameLine=function(a,b){return d.isSame(a,b)},d.compare=function(a,b){var c=e(a,b);return 0!==c?c:f(a,b)};var e=function(a,b){return d.getOctave(a)-d.getOctave(b)},f=function(a,b){return d.getStepIdx(a)-d.getStepIdx(b)};d.copy=function(a){var b=d.getOctave(a),c=d.getStep(a);return d.create(b,c)}}.call(this),function(){"use strict";var a=Adagio.Values.SyllabicType={SINGLE:"single",BEGIN:"begin",END:"end",MIDDLE:"middle"};a.values=[a.SINGLE,a.BEGIN,a.END,a.MIDDLE],a.isValid=function(b){return a.values.includes(b)},a.hasRightConnection=function(b){return b===a.MIDDLE||b===a.BEGIN},a.hasLeftConnection=function(b){return b===a.MIDDLE||b===a.END},a.hasConnection=function(b){return b===a.MIDDLE||b===a.BEGIN||b===a.END}}.call(this),function(){"use strict";var a=Adagio.Utils.typeUtils,b=Adagio.Utils.math,c=Adagio.Error.InternalError,d=Adagio.Utils.mxlUtils={};d.getWrappedString=function(b){if("string"==typeof b)return{content:b};if(a.isObject(b)&&"string"==typeof b.content)return b;throw new c("Unexpected","Bad value for MusicXML object content: ["+b+"].")},d.hasNumberOrContent=function(c){return!!b.isNumber(parseInt(c,10))||!(!a.isObject(c)||!b.isNumber(parseInt(c.content,10)))},d.floatOrContent=function(d){var e=parseFloat(d);if(b.isNumber(e))return e;if(a.isObject(d)&&(e=parseFloat(d.content),b.isNumber(e)))return e;throw new c("Unexpected","Bad value for MusicXML object content: ["+d+"].")},d.numberOrContent=function(e){var f=parseInt(e,10);if(b.isNumber(f))return f;if(a.isObject(e)&&(f=parseInt(e.content,10),b.isNumber(f)))return f;if(a.isArray(e))return d.numberOrContentArray(e);throw new c("Unexpected","Bad value for MusicXML object content: ["+e+"].")},d.numberOrContentArray=function(a){for(var b=0;b<a.length;b++){var e=a[b];if(d.hasNumberOrContent(e))return d.numberOrContent(e)}throw new c("Unexpected","Bad value for MusicXML object content: ["+a+"].")},d.hasStringOrContent=function(b){return"string"==typeof b&&""!==b.trim()||!(!a.isObject(b)||"string"!=typeof b.content||""===b.content.trim())},d.hasArrayNotEmpty=function(b,c){return void 0!==b[c]&&(!a.isArray(b[c])||b[c].length>0)},d.stringOrContent=function(b){if("string"==typeof b)return b;if(!a.isObject(b)||"string"!=typeof b.content&&"number"!=typeof b.content){if(!0===b)return"";if(a.isArray(b))return d.stringOrContentArray(b);throw new c("Unexpected","Bad value for MusicXML object content: ["+b+"].")}return b.content},d.stringOrContentArray=function(a){for(var b=0;b<a.length;b++){var e=a[b];if(d.hasStringOrContent(e))return d.stringOrContent(e)}throw new c("Unexpected","Bad value for MusicXML object content: ["+a+"].")},d.getArray=function(b,c){return void 0===b[c]?[]:a.makeArray(b[c])},d.setArray=function(a,b,c){0===c.length?delete a[b]:1===c.length?a[b]=c[0]:a[b]=c},d.setArrayStrict=function(a,b,c){0===c.length?delete a[b]:a[b]=c},d.getSingle=function(b,d){var e=b[d];if(a.isArray(e))return e[0];if(void 0!==e)return e;throw new c("MissingeValue","There is no value for the property ["+d+"]. Did you forgot to call the hasSomething method?")},d.setObject=function(b,c,d){a.isObjectEmpty(d)?delete b[c]:b[c]=d},d.getObject=function(a,b){return void 0!==a[b]?a[b]:{}}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Values.SyllabicType,c=Adagio.Utils.typeUtils,d=Adagio.Utils.mxlUtils,e=Adagio.Utils.lyricUtils={};e.copy=function(a){var b=e.getText(a),c=e.getSyllabic(a),d=e.create(b,c);if(e.hasLevel(a)){var f=e.getLevel(a);e.setLevel(d,f)}return d},e.create=function(a,b){return{text:a,syllabic:b}},e.setText=function(b,c){if("string"!=typeof c)throw new a("unexpected",c);b.text=c},e.getText=function(a){var b=d.getSingle(a,"text");return d.stringOrContent(b)},e.setSyllabic=function(c,d){if(!b.isValid(d))throw new a("unexpected",d);c.syllabic=d},e.hasText=function(a){return c.hasStringOrContent(a.text)},e.hasRightConnection=function(a){var c=e.getSyllabic(a);return b.hasRightConnection(c)},e.hasLeftConnection=function(a){var c=e.getSyllabic(a);return b.hasLeftConnection(c)},e.hasConnection=function(a){var c=e.getSyllabic(a);return b.hasConnection(c)},e.getSyllabic=function(a){return e.hasSyllabic(a)?a.syllabic:b.SINGLE},e.hasSyllabic=function(a){return void 0!==a.syllabic},e.setLevel=function(a,b){a.$number=(b+1).toString()},e.compare=function(a,b){return e.getLevel(a)-e.getLevel(b)},e.getLevel=function(a){return e.hasLevel(a)?parseInt(a.$number,10)-1:0},e.getRawLevel=function(a){return e.hasLevel(a)?a.$number:"1"},e.hasLevel=function(a){return void 0!==a.$number},e.isSame=function(a,b){return e.getText(a)===e.getText(b)&&e.getSyllabic(a)===e.getSyllabic(b)&&e.getLevel(a)===e.getLevel(b)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Values.SlurType={START:"start",STOP:"stop",CONTINUE:"continue"};b.values=[b.START,b.STOP,b.CONTINUE],b.internalValues=[b.START,b.STOP],b.isValid=function(a){return b.values.includes(a)},b.isValidInternal=function(a){return b.internalValues.includes(a)},b.assert=function(c){if(!b.isValid(c)){throw new a("SlurType","Invalid value for slur type: ["+c+"].")}},b.assertInternal=function(a){b.isValidInternal(a)||b.raiseError(a)},b.raiseError=function(b){throw new a("SlurType","Invalid internal value for slur type: ["+b+"].")}}.call(this),function(){"use strict";var a=Adagio.Values.SlurType,b=Adagio.Utils.slurUtils={};b.copy=function(a){var c=b.getType(a),d=b.create(c),e=b.getLevel(a);return b.setLevel(d,e),d},b.create=function(b){return a.assertInternal(b),{$type:b}},b.setLevel=function(a,b){a.$number=b.toString()},b.getLevel=function(a){return b.hasLevel(a)?parseInt(a.$number,10):1},b.hasLevel=function(a){return void 0!==a.$number},b.isStart=function(c){return b.getType(c)===a.START},b.isStop=function(c){return b.getType(c)===a.STOP},b.getType=function(a){return a.$type},b.isCrossMeasure=function(a){return!!b.has$adagio(a)&&!!a.$adagio.isCrossMeasure},b.addCrossMeasure=function(a){b.create$adagioIfNeeded(a),a.$adagio.isCrossMeasure=!0},b.removeCrossMeasure=function(a){b.has$adagio(a)&&(a.$adagio.isCrossMeasure=!1)},b.create$adagioIfNeeded=function(a){b.has$adagio(a)||b.create$adagio(a)},b.has$adagio=function(a){return void 0!==a.$adagio},b.create$adagio=function(a){a.$adagio={}}}.call(this),function(){"use strict";var a=Adagio.Utils.mapUtils={};a.every=function(a,b,c){for(var d in a)if(a.hasOwnProperty(d)){var e=a[d];if(!b.call(c,d,e))return!1}return!0},a.forEach=function(a,b,c){for(var d in a)if(a.hasOwnProperty(d)){var e=a[d];b.call(c,d,e,a)}},a.getSize=function(a){return Object.keys(a).length},a.map=function(a,b,c){var d={};for(var e in a)if(a.hasOwnProperty(e)){var f=a[e],g=b.call(c,e,f,a);d[e]=g}return d},a.filter=function(a,b,c){var d={};for(var e in a){var f=a[e];b.call(c,e,f)&&(d[e]=a[e])}return d},a.toPairs=function(a){return Object.keys(a).map(b,a)};var b=function(a){return{key:a,value:this[a]}};a.fromPairs=function(a){var b={};return a.forEach(c,b),b};var c=function(a){this[a.key]=a.value};a.fromList=function(a,b){var c={},e={map:c,getId:b};return a.forEach(d,e),c};var d=function(a){var b=this.getId(a);this.map[b]=a};a.toList=function(a){return Object.keys(a).map(e,a)};var e=function(a){return this[a]};a.isEmpty=function(a){for(var b in a)return!1;return!0},a.isEqual=function(b,c,d){return!!a.isEqualLeft(b,c,d)&&!a.isEqualLeft(c,b,d)},a.isEqualLeft=function(a,b,c){for(var d in a){if(void 0===b[d])return!1;if(!c(a[d],b[d]))return!1}return!0},a.getValues=function(a){return Object.keys(a).map(f,a)};var f=function(a){return this[a]}}.call(this),function(){"use strict";var a=Adagio.Utils.restUtils={},b="yes";a.setFullMeasure=function(a,c){c?a.$measure=b:delete a.$measure},a.isFullMeasure=function(a){return a.$measure===b}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadNoteheadError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadNoteheadError",this.stack=e.stack,this.message=e.message,this.notehead=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"The note head value "+a+" is invalid. "}}.call(this),function(){"use strict";var a=Adagio.Error.value.BadNoteheadError,b=Adagio.Values.Notehead={};b.NORMAL="normal",b.X="x",b.X_CIRCLE="circle-x",b.DIAMOND="diamond",b.SLASH="slash",b.TRIANGLE="triangle",b.BACK_SLASHED="back slashed",b.values=[b.NORMAL,b.X,b.X_CIRCLE,b.DIAMOND,b.SLASH,b.TRIANGLE,b.BACK_SLASHED];var c=[b.NORMAL,b.X,b.X_CIRCLE,b.DIAMOND,b.SLASH,b.TRIANGLE,b.BACK_SLASHED];b.isValid=function(a){return b.values.includes(a)},b.checkPercu=function(c){if(!b.isValidPercu(c))throw new a(c)},b.isValidPercu=function(a){return c.includes(a)},b.getNoteHeadIdx=function(a){return b.values.indexOf(a)}}.call(this),function(){"use strict";var a=Adagio.Values.ArticulationType={STACCATO:"staccato",TENUTO:"tenuto",STACCATO_TENUTO:"detached-legato",ACCENT:"accent",STRONG:"strong-accent",STACCATISSIMO:"staccatissimo",BREATHMARK:"breath-mark",CAESURA:"caesura",DOIT:"doit",FALLOFF:"falloff",PLOP:"plop",SCOOP:"scoop"};a.values=[a.STACCATO,a.TENUTO,a.STACCATO_TENUTO,a.ACCENT,a.STRONG,a.STACCATISSIMO,a.BREATHMARK,a.CAESURA,a.DOIT,a.FALLOFF,a.PLOP,a.SCOOP],a.isValid=function(b){return a.values.includes(b)}}.call(this),function(){"use strict";var a=Adagio.Values.TechnicalType={UPBOW:"up-bow",DOWNBOW:"down-bow",FRET:"fret",STRING:"string",HAMMER_ON:"hammer-on",PULL_OFF:"pull-off",SNAP_PIZZICATO:"snap-pizzicato",FINGERING:"fingering"};a.values=[a.UPBOW,a.DOWNBOW,a.FRET,a.STRING,a.HAMMER_ON,a.PULL_OFF,a.SNAP_PIZZICATO],a.commonValues=[a.UPBOW,a.DOWNBOW,a.SNAP_PIZZICATO],a.isValid=function(b){return a.values.includes(b)},a.isCommonValid=function(b){return a.commonValues.includes(b)}}.call(this),function(){"use strict";var a=Adagio.Values.NotationType={FERMATA:"fermata"};a.values=[a.FERMATA],a.isValid=function(b){return a.values.includes(b)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Values.ArticulationType,c=Adagio.Utils.typeUtils,d=c.pairsToMap([{key:b.STACCATO,value:[b.TENUTO,b.STACCATISSIMO,b.STACCATO_TENUTO]},{key:b.TENUTO,value:[b.STACCATO,b.STACCATISSIMO,b.STACCATO_TENUTO]},{key:b.STACCATISSIMO,value:[b.TENUTO,b.STACCATO,b.STACCATO_TENUTO]},{key:b.STACCATO_TENUTO,value:[b.TENUTO,b.STACCATO,b.STACCATISSIMO]},{key:b.ACCENT,value:[b.STRONG]},{key:b.STRONG,value:[b.ACCENT]},{key:b.BREATHMARK,value:[b.TENUTO,b.STACCATO,b.CAESURA]},{key:b.CAESURA,value:[b.TENUTO,b.STACCATO,b.BREATHMARK]},{key:b.DOIT,value:[b.FALLOFF]},{key:b.FALLOFF,value:[b.DOIT]},{key:b.PLOP,value:[b.SCOOP]},{key:b.SCOOP,value:[b.PLOP]}]),e=[b.STACCATO,b.TENUTO,b.STACCATISSIMO],f=[b.TENUTO,b.ACCENT],g=Adagio.Utils.articulationsUtils={};g.addArticulation=function(c,e){if(void 0===d[e])throw new a("unexpected",e);if(d[e].forEach(function(a){c.hasOwnProperty(a)&&g.removeArticulation(c,a)}),!b.isValid(e))throw new a("unexpected",e);c[e]={}},g.removeArticulation=function(c,d){if(!b.isValid(d))throw new a("unexpected",d);delete c[d]},g.isLowerArticulation=function(a){return e.includes(a)},g.isCenteredArticulation=function(a){return f.includes(a)},g.hasArticulation=function(a,b){return void 0!==a[b]},g.hasIncompatibleArticulations=function(b,c){if(void 0===d[c])throw new a("unexpected",c);return d[c].some(function(a){return b.hasOwnProperty(a)})},g.getIncompatibleArticulations=function(a,b){return d[b].filter(function(b){return a.hasOwnProperty(b)})}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadOrnamentTypeError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadOrnamentTypeError",this.stack=e.stack,this.message=e.message,this.type=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"Ornament "+a+" is invalid."}}.call(this),function(){"use strict";var a=Adagio.Values.OrnamentType={TRILLMARK:"trill-mark",TREMOLO:"tremolo",TREMOLO1:"tremolo1",TREMOLO2:"tremolo2",TREMOLO3:"tremolo3",TREMOLO4:"tremolo4",TREMOLO5:"tremolo5",BUZZ:"$adagio-buzz",MORDENT:"mordent",INVERTED_MORDENT:"inverted-mordent",LONG_MORDENT:"long-mordent",LONG_INVERTED_MORDENT:"long-inverted-mordent",ABOVE_APPROACH_MORDENT:"above-approach-mordent",BELOW_APPROACH_MORDENT:"below-approach-mordent",ABOVE_APPROACH_INVERTED_MORDENT:"above-approach-inverted-mordent",BELOW_APPROACH_INVERTED_MORDENT:"below-approach-inverted-mordent",ABOVE_DEPARTURE_INVERTED_MORDENT:"above-departure-inverted-mordent",BELOW_DEPARTURE_INVERTED_MORDENT:"below-departure-inverted-mordent",TURN:"turn",INVERTED_TURN:"inverted-turn"};a.values=[a.TRILLMARK,a.TREMOLO,a.MORDENT,a.INVERTED_MORDENT,a.TURN,a.INVERTED_TURN,a.BUZZ],a.isValid=function(b){return a.values.includes(b)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Error.value.BadOrnamentTypeError,c=Adagio.Values.OrnamentType,d=Adagio.Utils.typeUtils,e=Adagio.Utils.mxlUtils,f=[c.MORDENT,c.INVERTED_MORDENT,c.TRILLMARK,c.TREMOLO,c.TURN,c.INVERTED_TURN,c.BUZZ],g=d.pairsToMap([{key:c.TRILLMARK,value:f},{key:c.TREMOLO,value:f},{key:c.MORDENT,value:f},{key:c.INVERTED_MORDENT,value:f},{key:c.TURN,value:f},{key:c.INVERTED_TURN,value:f},{key:c.BUZZ,value:f}]),h=Adagio.Utils.ornamentsUtils={};h.hasOrnament=function(a,b,d){if(!h.hasOrnamentType(a,b))return!1;var f=e.getSingle(a,b);switch(b){case c.TREMOLO:var g=e.stringOrContent(f);return(g=parseInt(g,10))===parseInt(d.nbBeam,10);case c.MORDENT:case c.INVERTED_MORDENT:return f.$long===d.long&&f.$departure===d.departure&&f.$approach===d.approach}return!0},h.hasOrnamentType=function(a,b){return void 0!==a[b]},h.getList=function(a){var b=Object.keys(a);return b=b.filter(c.isValid)},h.addOrnament=function(b,d,e){switch(d){case c.TREMOLO:b[d]={content:e.nbBeam.toString()};break;case c.MORDENT:case c.INVERTED_MORDENT:var f={};void 0!==e&&(void 0!==e.long&&(f.$long=e.long),void 0!==e.approach&&(f.$approach=e.approach),void 0!==e.departure&&(f.$departure=e.departure)),b[d]=f;break;case c.TRILLMARK:case c.TURN:case c.INVERTED_TURN:case c.BUZZ:b[d]={};break;default:throw new a("unexpected","The ornament type ["+d+"] is not supported.")}},h.getOrnamentsWithOpts=function(a){var b={};for(var d in a)if(c.isValid(d)){var e=h.getOrnamentOpts(a,d);b[d]=e}return b},h.getOrnamentOpts=function(b,d){if(!h.hasOrnamentType(b,d))throw new a("Unexpected","There is no ornament ["+d+"] in this note.");var f={},g=e.getSingle(b,d);switch(d){case c.TREMOLO:var i=e.stringOrContent(g);return i=parseInt(i,10),f.nbBeam=i,f;case c.TRILLMARK:case c.TURN:case c.INVERTED_TURN:case c.BUZZ:return f;case c.MORDENT:case c.INVERTED_MORDENT:var j=g;return void 0!==j.$long&&(f.long=j.$long),void 0!==j.$approach&&(f.approach=j.$approach),void 0!==j.$departure&&(f.departure=j.$departure),f;default:throw new a("Unexpected","The ornament type ["+d+"] is not supported.")}},h.removeOrnament=function(b,d){if(!c.isValid(d))throw new a("unexpected",d);delete b[d]},h.hasIncompatibleOrnaments=function(a,b){return g[b].some(i,a)},h.getIncompatibleOrnaments=function(a,b){var c=g[b];return c=c.filter(i,a)};var i=function(a){var b=this;return h.hasOrnamentType(b,a)};h.ornamentToNbLines=function(a){switch(a){case c.TRILLMARK:case c.TURN:case c.INVERTED_TURN:case c.MORDENT:case c.INVERTED_MORDENT:case c.LONG_MORDENT:case c.LONG_INVERTED_MORDENT:case c.ABOVE_APPROACH_MORDENT:case c.BELOW_APPROACH_MORDENT:case c.ABOVE_APPROACH_INVERTED_MORDENT:case c.BELOW_APPROACH_INVERTED_MORDENT:case c.ABOVE_DEPARTURE_INVERTED_MORDENT:case c.BELOW_DEPARTURE_INVERTED_MORDENT:return 0;case c.BUZZ:case c.TREMOLO1:return 1;case c.TREMOLO2:return 2;case c.TREMOLO3:return 3;case c.TREMOLO4:return 4;case c.TREMOLO5:return 5;default:if(!c.isValid(a))throw new b(a);return 0}},h.isTremoloType=function(a){switch(a){case c.TREMOLO:case c.TREMOLO1:case c.TREMOLO2:case c.TREMOLO3:case c.TREMOLO4:case c.TREMOLO5:case c.BUZZ:return!0;case c.LONG_MORDENT:case c.LONG_INVERTED_MORDENT:case c.ABOVE_APPROACH_MORDENT:case c.BELOW_APPROACH_MORDENT:case c.ABOVE_APPROACH_INVERTED_MORDENT:case c.BELOW_APPROACH_INVERTED_MORDENT:case c.ABOVE_DEPARTURE_INVERTED_MORDENT:case c.BELOW_DEPARTURE_INVERTED_MORDENT:return!1;default:if(!c.isValid(a))throw new b(a);return!1}}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadGlissandoTypeError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadGlissandoTypeError",this.stack=e.stack,this.message=e.message,this.type=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"The glissando type ["+a+"] is invalid."}}.call(this),function(){"use strict";var a=Adagio.Error.value.BadGlissandoTypeError,b=Adagio.Values.GlissandoType={START:"start",STOP:"stop"};b.values=[b.START,b.STOP],b.isValid=function(a){return b.values.includes(a)},b.check=function(c){if(!b.isValid(c))throw new a(c)},b.isStart=function(a){return a===b.START},b.isStop=function(a){return a===b.STOP}}.call(this),function(){"use strict";var a=Adagio.Values.GlissandoType,b=Adagio.Utils.glissandoUtils={};b.hasType=function(a){return void 0!==a.$type},b.setType=function(b,c){a.check(c),b.$type=c},b.getType=function(a){return a.$type},b.hasNumber=function(a){return void 0!==a.$number},b.setNumber=function(a,b){a.$number=b+""},b.getNumber=function(a){return b.hasNumber(a)?parseInt(a.$number,10):1},b.create=function(a,c){var d={"$line-type":"wavy"};return b.setType(d,a),b.setNumber(d,c),d},b.isStart=function(c){var d=b.getType(c);return a.isStart(d)},b.isStop=function(c){var d=b.getType(c);return a.isStop(d)},b.isSame=function(a,c){return b.getNumber(a)===b.getNumber(c)&&b.getType(a)===b.getType(c)}}.call(this),function(){"use strict";var a=Adagio.Utils.glissandoUtils,b=Adagio.Utils.glissandosUtils={};b.hasGlissando=function(b,d,e){var f=a.create(d,e);return b.some(c,f)},b.hasGlissandoType=function(b,c){return b.some(function(b){return a.getType(b)===c})},b.getGlissando=function(b,d,e){var f=a.create(d,e);return b.find(c,f)},b.getGlissandosType=function(b,c){return b.filter(function(b){return a.getType(b)===c})},b.removeGlissando=function(a,b){var d=a.findIndex(c,b);d>-1&&a.splice(d,1)};var c=function(b){var c=this;return a.isSame(b,c)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Values.BooleanType={YES:"yes",NO:"no"};b.values=[b.YES,b.NO],b.isValid=function(a){return b.values.includes(a)},b.raiseError=function(b){throw new a("BadBooleanTypeError","Invalid value for boolean: ["+b+"].")}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadPlacementDirectionError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadPlacementDirectionError",this.stack=e.stack,this.message=e.message,this.placement=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"Placement "+a+" is invalid."}}.call(this),function(){"use strict";var a=Adagio.Error.value.BadPlacementDirectionError,b=Adagio.Values.DirectionPlacement={ABOVE:"above",BELOW:"below"};b.values=[b.ABOVE,b.BELOW],b.isValid=function(a){return b.values.includes(a)},b.check=function(c){if(!b.isValid(c))throw new a(c)}}.call(this),function(){"use strict";Array.prototype.find||Object.defineProperty(Array.prototype,"find",{enumerable:!1,configurable:!0,writable:!0,value:function(a){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof a)throw new TypeError("predicate must be a function");for(var b,c=Object(this),d=c.length>>>0,e=arguments[1],f=0;f<d;f++)if(f in c&&(b=c[f],a.call(e,b,f,c)))return b}})}.call(this),function(){"use strict";var a=Adagio.Values.DurationType,b=Adagio.Utils.typeUtils,c=Adagio.Utils.tupletPortionUtils={};c.hasDurationType=function(a){return b.hasStringOrContent(a["tuplet-type"])},c.getDurationType=function(c){var d=b.stringOrContent(c["tuplet-type"]);return a.fromMxl(d)},c.setDurationType=function(b,c){var d=a.toMxl(c);b["tuplet-type"]=d},c.createActual=function(a,b){var d={"tuplet-number":a.toString()};return c.setDurationType(d,b),d},c.createNormal=function(a){return{"tuplet-number":a.toString()}},c.getNumber=function(a){return parseInt(a["tuplet-number"],10)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.tupletPortionUtils,c=Adagio.Utils.timeModifUtils,d="start",e="stop",f=1,g=Adagio.Utils.tupletBoundUtils={};g.createStart=function(a,e,f){var g=c.getActual(e),h=c.getNormal(e),i=b.createActual(g,f),j=b.createNormal(h);return{$type:d,$number:a.toString(),"tuplet-actual":i,"tuplet-normal":j}},g.createNakedStart=function(a){return void 0===a&&(a=f),{$type:d,$number:a.toString()}},g.setTupletActual=function(a,b){a["tuplet-actual"]=b},g.setTupletNormal=function(a,b){a["tuplet-normal"]=b},g.hasDurationType=function(a){if(g.hasActual(a)){var c=g.getActual(a);return b.hasDurationType(c)}return!1},g.getDurationType=function(a){var c=g.getActual(a);return b.getDurationType(c)},g.getTimeModif=function(a){var d=g.getActual(a),e=b.getNumber(d),f=g.getNormal(a),h=b.getNumber(f);return c.create(e,h)},g.getNbActual=function(a){var c=g.getActual(a);return b.getNumber(c)},g.hasActual=function(a){return void 0!==a["tuplet-actual"]},g.getActual=function(a){return a["tuplet-actual"]},g.hasNormal=function(a){return void 0!==a["tuplet-normal"]},g.getNbNormal=function(a){var c=g.getNormal(a);return b.getNumber(c)},g.getNormal=function(a){return a["tuplet-normal"]},g.createStop=function(a){return void 0===a&&(a=f),{$type:e,$number:a.toString()}},g.isStart=function(a){return g.getType(a)===d},g.isStop=function(a){return g.getType(a)===e},g.getType=function(a){return a.$type},g.getLevel=function(a){return g.hasLevel(a)?parseInt(a.$number,10):f},g.hasLevel=function(a){return void 0!==a.$number},g.isStopAndWithinLevel=function(a,b){return g.isStop(a)&&g.isWithinLevel(a,b)},g.isStartAndWithinLevel=function(a,b){return g.isStart(a)&&g.isWithinLevel(a,b)},g.isWithinLevel=function(a,b){return g.getLevel(a)<=b},g.isOutsideLevel=function(a,b){return g.getLevel(a)>b},g.stringify=function(b){var c=g.getLevel(b),f=g.getType(b);if(f===d)return"start-"+c;if(f===e)return"stop-"+c;throw new a("Unexpected","Unexpected tuplet type: ["+f+"].")}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.typeUtils,c=Adagio.Utils.tupletBoundUtils,d=Adagio.Utils.math,e=Adagio.Utils.tupletBoundsUtils={};e.getTupletStartsWithin=function(a,b){return a.filter(f,b)};var f=function(a){var b=this.valueOf();return c.isStartAndWithinLevel(a,b)};e.removeTupletStartsWithin=function(a,b){return a.filter(g,b)};var g=function(a){var b=this.valueOf();return!c.isStartAndWithinLevel(a,b)};e.getTupletStopsWithin=function(a,b){return a.filter(h,b)};var h=function(a){var b=this.valueOf();return c.isStopAndWithinLevel(a,b)};e.removeTupletStopsWithin=function(a,b){return a.filter(i,b)};var i=function(a){var b=this.valueOf();return!c.isStopAndWithinLevel(a,b)};e.addBounds=function(b,c){if(e.isColliding(b,c)){throw new a("CollidingTupletBound","Some tuplet bounds are colliding.")}return b.concat(c)},e.isColliding=function(a,d){var e=b.listToMap(a,c.stringify);return d.some(j,e)};var j=function(a){return void 0!==this[c.stringify(a)]};e.hasStart=function(a){return a.some(c.isStart)},e.hasStop=function(a){return a.some(c.isStop)},e.getStartLevel=function(a){return a.filter(c.isStart).map(c.getLevel).reduce(d.max2)},e.getStopLevel=function(a){return a.filter(c.isStop).map(c.getLevel).reduce(d.min2)},e.removeLevelAndOutside=function(a,b){return a.filter(k,b)};var k=function(a){var b=this.valueOf();return c.getLevel(a)<b};e.getStarts=function(a){return a.filter(c.isStart)},e.getStart=function(a,b){return a.find(l,b)},e.getStops=function(a){return a.filter(c.isStop)};var l=function(a){if(c.isStop(a))return!1;var b=this.valueOf();return c.getLevel(a)===b};e.getStop=function(a,b){return a.find(m,b)};var m=function(a){if(c.isStart(a))return!1;var b=this.valueOf();return c.getLevel(a)===b}}.call(this);(function(){"use strict";var a=Adagio.Utils.typeUtils,b=Adagio.Utils.tupletBoundsUtils;Adagio.Utils.notations.notationsUtils_tuplet=function(c){c.hasTupletBounds=function(a){return void 0!==a.tuplet},c.getTupletBounds=function(b){return void 0===b.tuplet?[]:a.isArray(b.tuplet)?b.tuplet:[b.tuplet]},c.setTupletBounds=function(a,b){0===b.length?delete a.tuplet:1===b.length?a.tuplet=b[0]:a.tuplet=b},c.getTupletStartsWithin=function(a,d){var e=c.getTupletBounds(a);return b.getTupletStartsWithin(e,d)},c.removeTupletStartsWithin=function(a,d){var e=c.getTupletBounds(a);e=b.removeTupletStartsWithin(e,d),c.setTupletBounds(a,e)},c.getTupletStopsWithin=function(a,d){var e=c.getTupletBounds(a);return b.getTupletStopsWithin(e,d)},c.removeTupletStopsWithin=function(a,d){var e=c.getTupletBounds(a);e=b.removeTupletStopsWithin(e,d),c.setTupletBounds(a,e)},c.addTupletBounds=function(a,d){var e=c.getTupletBounds(a);e=b.addBounds(e,d),c.setTupletBounds(a,e)},c.hasTupletStart=function(a){if(c.hasTupletBounds(a)){var d=c.getTupletBounds(a);return b.hasStart(d)}return!1},c.hasTupletStop=function(a){if(c.hasTupletBounds(a)){var d=c.getTupletBounds(a);return b.hasStop(d)}return!1},c.getTupletStartLevel=function(a){var d=c.getTupletBounds(a);return b.getStartLevel(d)},c.getTupletStopLevel=function(a){var d=c.getTupletBounds(a);return b.getStopLevel(d)},c.removeTupletLevelAndOutside=function(a,d){var e=c.getTupletBounds(a);e=b.removeLevelAndOutside(e,d),c.setTupletBounds(a,e)},c.getTupletStarts=function(a){var d=c.getTupletBounds(a);return b.getStarts(d)},c.getTupletStart=function(a,d){var e=c.getTupletBounds(a);return b.getStart(e,d)},c.getTupletStops=function(a){var d=c.getTupletBounds(a);return b.getStops(d)},c.getTupletStop=function(a,d){var e=c.getTupletBounds(a);return b.getStop(e,d)},c.removeTupletBounds=function(a){c.setTupletBounds(a,[])}}}).call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.typeUtils,c=Adagio.Utils.slurUtils;Adagio.Utils.notations.notationsUtils_slur=function(d){d.hasIntraMeasureSlur=function(a){if(d.hasSlur(a)){var b=d.getSlur(a);return!c.isCrossMeasure(b)}return!1},d.hasSlurStart=function(a){if(d.hasSlur(a)){var b=d.getSlur(a);return c.isStart(b)}return!1},d.hasSlurStop=function(a){if(d.hasSlur(a)){var b=d.getSlur(a);return c.isStop(b)}return!1},d.hasSlur=function(a){return void 0!==a.slur},d.setSlur=function(a,b){a.slur=b},d.getSlurType=function(a){var b=d.getSlur(a);return c.getType(b)},d.getSlur=function(c){if(b.isArray(c.slur))return c.slur[0];if(void 0!==c.slur)return c.slur;throw new a("Unexpected")},d.removeSlur=function(a){delete a.slur}}}.call(this),function(){"use strict";var a=Adagio.Values.FretType={FRET0:"fret0",FRET1:"fret1",FRET2:"fret2",FRET3:"fret3",FRET4:"fret4",FRET5:"fret5",FRET6:"fret6",FRET7:"fret7",FRET8:"fret8",FRET9:"fret9"};a.values=[a.FRET0,a.FRET1,a.FRET2,a.FRET3,a.FRET4,a.FRET5,a.FRET6,a.FRET7,a.FRET8,a.FRET9],a.isValid=function(b){return a.values.includes(b)}}.call(this),function(){"use strict";var a=Adagio.Values.FretType;(Adagio.Utils.fretUtils={}).digitToType=function(b){switch(parseInt(b,10)){case 0:return a.FRET0;case 1:return a.FRET1;case 2:return a.FRET2;case 3:return a.FRET3;case 4:return a.FRET4;case 5:return a.FRET5;case 6:return a.FRET6;case 7:return a.FRET7;case 8:return a.FRET8;case 9:
return a.FRET9;default:return null}}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Values.HammerOnPullOffType={START:"start",STOP:"stop"};b.values=[b.START,b.STOP],b.check=function(a){b.isValid(a)||b.raiseError(a)},b.isValid=function(a){return b.values.includes(a)},b.raiseError=function(b){throw new a("BadHammerOnPullOffTypeError","Invalid value for hammer-on pull-off type: ["+b+"].")}}.call(this),function(){"use strict";var a=Adagio.Values.HammerOnPullOffType,b=Adagio.Utils.hammerOnPullOffUtils={};b.create=function(a){return{$type:a}},b.check=function(c){var d=b.getType(c);a.check(d)},b.isSame=function(a,c){return b.getType(a)===b.getType(c)},b.getType=function(a){return a.$type}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadFingeringError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadFingeringError",this.stack=e.stack,this.message=e.message,this.fingering=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"The fingering value ["+a+"] is invalid. It must be an integer between 1 and 5."}}.call(this),function(){"use strict";var a=Adagio.Utils.math,b=Adagio.Error.value.BadFingeringError,c=Adagio.Values.Fingering={MAX:5,MIN:1};c.check=function(a){if(!c.isValid(a))throw new b(a)},c.isValid=function(b){return a.isInteger(b)&&c.MIN<=b&&b<=c.MAX}}.call(this),function(){"use strict";var a=Adagio.Values.Fingering,b="yes",c=Adagio.Utils.fingeringUtils={};c.hasValidValue=function(b){var d=c.getValue(b);return a.isValid(d)},c.getValue=function(a){return parseInt(a.content)},c.isNormal=function(a){return!c.isSubstitution(a)&&!c.isAlternate(a)},c.isSubstitution=function(a){return a.$substitution===b},c.isAlternate=function(a){return a.$alternate===b}}.call(this),function(){"use strict";var a=Adagio.Utils.fingeringUtils,b=Adagio.Error.InternalError,c=Adagio.Utils.fingeringsUtils={};c.getValue=function(b){var d=c.getValueHolder(b);return a.getValue(d)},c.getValueHolder=function(d){if(d=d.filter(a.hasValidValue),c.hasNormalValue(d))return c.getNormalValue(d);if(c.hasAlternateValue(d))return c.getAlternateValue(d);if(c.hasSubstitutionValue(d))return c.getSubstitutionValue(d);throw new b("Unexpected","There is no acceptable fingering value.")},c.hasValidValue=function(b){return b.some(a.hasValidValue)},c.hasNormalValue=function(b){return b.some(a.isNormal)},c.getNormalValue=function(b){return b.find(a.isNormal)},c.hasAlternateValue=function(b){return b.some(a.isAlternate)},c.getAlternateValue=function(b){return b.find(a.isAlternate)},c.hasSubstitutionValue=function(b){return b.some(a.isSubstitution)},c.getSubstitutionValue=function(b){return b.find(a.isSubstitution)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Values.TechnicalType,c=Adagio.Utils.typeUtils,d=Adagio.Utils.mxlUtils,e=Adagio.Utils.fretUtils,f=Adagio.Utils.hammerOnPullOffUtils,g=Adagio.Utils.fingeringsUtils,h=Adagio.Utils.technicalUtils={},i=c.pairsToMap([{key:b.UPBOW,value:[b.DOWNBOW,b.SNAP_PIZZICATO]},{key:b.DOWNBOW,value:[b.UPBOW,b.SNAP_PIZZICATO]},{key:b.SNAP_PIZZICATO,value:[b.UPBOW,b.DOWNBOW]},{key:b.FRET,value:[]},{key:b.STRING,value:[]},{key:b.HAMMER_ON,value:[]},{key:b.PULL_OFF,value:[]},{key:b.FINGERING,value:[]}]);h.addTechnical=function(c,d,e){if(void 0===i[d])throw new a("unexpected",d);if(i[d].forEach(function(a){c.hasOwnProperty(a)&&h.removeTechnical(c,a)}),!b.isValid(d))throw new a("unexpected",d);if(void 0!==e)switch(d){case b.FRET:c[d]=e.fret.toString();break;case b.STRING:c[d]=e.string.toString();break;case b.HAMMER_ON:case b.PULL_OFF:var f=h.getTechnicalContent(c,d);f.push(e.hammerOnPullOff),c[d]=f;break;default:c[d]={}}else c[d]={}},h.removeTechnical=function(d,e,g){if(!b.isValid(e))throw new a("unexpected",e);switch(e){case b.HAMMER_ON:case b.PULL_OFF:if(void 0!==g&&h.hasTechnical(d,e,g)){var i=c.makeArray(d[e]),j=i.findIndex(function(a){return f.isSame(a,g.hammerOnPullOff)});i.splice(j,1),0===i.length?delete d[e]:d[e]=i}else delete d[e];break;default:delete d[e]}},h.hasTechnical=function(a,d,e){if(void 0!==e)switch(d){case b.FRET:return void 0!==a[d]&&a[d]===e.fret.toString();case b.STRING:return void 0!==a[d]&&a[d]===e.string.toString();case b.HAMMER_ON:case b.PULL_OFF:return void 0!==a[d]&&c.makeArray(a[d]).some(function(a){return f.isSame(a,e.hammerOnPullOff)})}return void 0!==a[d]},h.hasIncompatibleTechnical=function(c,d,e){if(void 0===i[d])throw new a("unexpected",d);if(void 0!==e)switch(d){case b.FRET:return c.hasOwnProperty(d)&&h.getTechnicalContent(c,d)!==e.fret;case b.STRING:return c.hasOwnProperty(d)&&h.getTechnicalContent(c,d)!==e.string}return i[d].some(function(a){return c.hasOwnProperty(a)})},h.getIncompatibleTechnical=function(c,d,e){if(void 0===i[d])throw new a("unexpected",d);if(void 0!==e)switch(d){case b.FRET:return h.hasIncompatibleTechnical(c,d,e)?[b.FRET]:[];case b.STRING:return h.hasIncompatibleTechnical(c,d,e)?[b.STRING]:[]}return i[d].filter(function(a){return c.hasOwnProperty(a)})},h.getTechnicalContent=function(c,e){if(!b.isValid(e))throw new a("unexpected",e);switch(e){case b.FRET:case b.STRING:if(d.hasStringOrContent(c[e]))return parseInt(d.stringOrContent(c[e]),10);if(d.hasNumberOrContent(c[e]))return parseInt(d.numberOrContent(c[e]),10);break;case b.HAMMER_ON:case b.PULL_OFF:return d.getArray(c,e)}return{}},h.getTechnicalOpts=function(e,f){var g={};if(!b.isValid(f))throw new a("unexpected",f);switch(f){case b.FRET:case b.STRING:return d.hasStringOrContent(e[f])&&(g[f]=parseInt(d.stringOrContent(e[f]),10)),d.hasNumberOrContent(e[f])&&(g[f]=d.numberOrContent(e[f])),g;case b.HAMMER_ON:case b.PULL_OFF:return g[f]=c.isArray(e[f])?e[f]:[],g}return g},h.getFretListForDrawer=function(a){var c=[];return Object.keys(a).forEach(function(d){switch(d){case b.FRET:for(var f=h.getTechnicalContent(a,d)+"",g=0;g<f.length;g++){var i=e.digitToType(f[g]);c.push(i)}}}),c},h.hasFingering=function(a){var b=h.getFingerings(a);return g.hasValidValue(b)},h.getFingering=function(a){var b=h.getFingerings(a);return g.getValue(b)},h.getFingerings=function(a){var b=d.getArray(a,"fingering");return b=b.map(d.getWrappedString)},h.setFingering=function(a,b){a.fingering=b.toString()},h.removeFingering=function(a){delete a.fingering},h.hasString=function(a){return d.hasNumberOrContent(a.string)},h.getString=function(a){return d.numberOrContent(a.string)},h.hasFret=function(a){return d.hasNumberOrContent(a.fret)},h.getFret=function(a){return d.numberOrContent(a.fret)},h.hasTabData=function(a){return h.hasString(a)&&h.hasFret(a)},h.getTabData=function(a){return{string:h.getString(a),fret:h.getFret(a)}}}.call(this),function(){"use strict";var a=Adagio.Utils.typeUtils,b=Adagio.Utils.technicalUtils,c=Adagio.Values.TechnicalType;Adagio.Utils.notations.notationsUtils_technical=function(d){d.hasTechnicals=function(a){return void 0!==a.technical},d.hasTechnical=function(a,c,e){var f=d.getTechnical(a);return b.hasTechnical(f,c,e)},d.hasIncompatibleTechnical=function(a,c,e){var f=d.getTechnical(a);return b.hasIncompatibleTechnical(f,c,e)},d.getIncompatibleTechnical=function(a,c,e){var f=d.getTechnical(a);return b.getIncompatibleTechnical(f,c,e)},d.addTechnical=function(a,c,e){var f=d.getTechnical(a);b.addTechnical(f,c,e),d.setTechnical(a,f)},d.removeTechnical=function(a,c,e){var f=d.getTechnical(a);b.removeTechnical(f,c,e),d.setTechnical(a,f)},d.removeAllTechnicals=function(b,c){if(a.isArray(c)){var e=d.getTechnical(b);Object.keys(e).forEach(function(a){c.includes(a)||d.removeTechnical(b,a)})}else d.setTechnical(b,{})},d.setTechnical=function(b,c){a.isObjectEmpty(c)?delete b.technical:b.technical=c},d.getTechnical=function(a){return d.hasTechnicals(a)?a.technical:{}},d.getTechnicalOpts=function(a,c){var e=d.getTechnical(a);return b.getTechnicalOpts(e,c)},d.getTechnicalContent=function(a,c){var e=d.getTechnical(a);return b.getTechnicalContent(e,c)},d.getTechnicalFullList=function(a){var b=d.getTechnical(a);return Object.keys(b)},d.getTechnicalList=function(a){return d.getTechnicalFullList(a).filter(c.isCommonValid)},d.hasFingering=function(a){if(d.hasTechnicals(a)){var c=d.getTechnical(a);return b.hasFingering(c)}return!1},d.getFingering=function(a){var c=d.getTechnical(a);return b.getFingering(c)},d.setFingering=function(a,c){var e=d.getTechnical(a);b.setFingering(e,c),d.setTechnical(a,e)},d.removeFingering=function(a){var c=d.getTechnical(a);b.removeFingering(c),d.setTechnical(a,c)},d.getFretListForDrawer=function(a){var c=d.getTechnical(a);return b.getFretListForDrawer(c)},d.hasString=function(a){if(d.hasTechnicals(a)){var c=d.getTechnical(a);return b.hasString(c)}return!1},d.getString=function(a){var c=d.getTechnical(a);return b.getString(c)},d.hasTabData=function(a){if(d.hasTechnicals(a)){var c=d.getTechnical(a);return b.hasTabData(c)}return!1},d.getTabData=function(a){var c=d.getTechnical(a);return b.getTabData(c)}}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.articulationsUtils,c=Adagio.Utils.ornamentsUtils,d=Adagio.Utils.glissandosUtils,e=Adagio.Utils.typeUtils,f=Adagio.Utils.mxlUtils,g=Adagio.Values.ArticulationType,h=Adagio.Values.NotationType,i=Adagio.Values.OrnamentType,j=Adagio.Values.BooleanType,k=Adagio.Values.DirectionPlacement,l=Adagio.Utils.notations.notationsUtils_tuplet,m=Adagio.Utils.notations.notationsUtils_slur,n=Adagio.Utils.notations.notationsUtils_technical,o=e.pairsToMap([{key:h.FERMATA,value:[g.TENUTO,g.STACCATO,g.STACCATISSIMO,g.STACCATO_TENUTO]}]),p=e.pairsToMap([{key:h.FERMATA,value:2},{key:g.ACCENT,value:1},{key:g.STRONG,value:1},{key:g.STACCATO,value:0},{key:g.STACCATISSIMO,value:0},{key:g.TENUTO,value:0},{key:g.STACCATO_TENUTO,value:0},{key:g.BREATHMARK,value:0},{key:g.CAESURA,value:0},{key:g.DOIT,value:0},{key:g.FALLOFF,value:0},{key:g.PLOP,value:0},{key:g.SCOOP,value:0}]),q=Adagio.Utils.notationsUtils={};l(q),m(q),n(q),q.addNotation=function(b,c){if(void 0===o[c])throw new a("unexpected",c);if(o[c].forEach(function(a){q.hasArticulation(b,a)&&q.removeArticulation(b,a)}),c!==h.FERMATA)throw new a("unexpected",c);b.fermata={}},q.removeNotation=function(b,c){if(c!==h.FERMATA)throw new a("unexpected",c);delete b.fermata},q.hasNotationIncompatibleArticulations=function(a){var b=this.getArticulations(a);return o[h.FERMATA].some(function(a){return b.hasOwnProperty(a)})},q.getNotationIncompatibleArticulations=function(a){var b=this.getArticulations(a);return o[h.FERMATA].filter(function(a){return b.hasOwnProperty(a)})},q.addArticulation=function(a,c){if(q.hasArticulations(a)){Object.keys(o).forEach(function(b){o[b].includes(c)&&q.removeNotation(a,b)})}var d=q.getArticulations(a);b.addArticulation(d,c),q.setArticulations(a,d)},q.removeArticulation=function(a,c){var d=q.getArticulations(a);b.removeArticulation(d,c),q.setArticulations(a,d)},q.removeAllArticulations=function(a){q.setArticulations(a,{})},q.removeAllOrnaments=function(a){q.setOrnaments(a,{})},q.isArticulationCompatibleWithNotation=function(a,b){return o[h.FERMATA].some(function(a){return b===a})},q.setArticulations=function(a,b){e.isObjectEmpty(b)?delete a.articulations:a.articulations=b},q.getArticulations=function(a){return q.hasArticulations(a)?a.articulations:{}},q.getArticulationsList=function(a){var b=q.getArticulations(a);return Object.keys(b)},q.getFullArticulationsList=function(a){var b=q.getArticulations(a),c=Object.keys(b);return q.hasNotation(a,h.FERMATA)&&!c.includes(h.FERMATA)&&c.push(h.FERMATA),c},q.sortArticulationsList=function(a){a.sort(q.compareArticulations)},q.compareArticulations=function(b,c){if(void 0===p[b])throw new a("unexpected",b);if(void 0===p[c])throw new a("unexpected",c);return p[b]-p[c]},q.hasArticulations=function(a){return void 0!==a.articulations},q.hasArticulation=function(a,c){var d=q.getArticulations(a);return b.hasArticulation(d,c)},q.hasIncompatibleArticulations=function(a,c){var d=q.getArticulations(a);return b.hasIncompatibleArticulations(d,c)},q.getIncompatibleArticulations=function(a,c){var d=q.getArticulations(a);return b.getIncompatibleArticulations(d,c)},q.hasNotation=function(a,b){return void 0!==a[b]},q.isValidArticulation=function(a){return g.values.includes(a)||a===h.FERMATA},q.hasOrnaments=function(a){return void 0!==a.ornaments},q.getOrnaments=function(a){return q.hasOrnaments(a)?a.ornaments:{}},q.hasOrnament=function(a,b,d){var e=q.getOrnaments(a);return c.hasOrnament(e,b,d)},q.hasOrnamentType=function(a,b){var d=q.getOrnaments(a);return c.hasOrnamentType(d,b)},q.addOrnament=function(a,b,d){var e=q.getOrnaments(a);c.addOrnament(e,b,d),q.setOrnaments(a,e)},q.setOrnaments=function(a,b){e.isObjectEmpty(b)?delete a.ornaments:a.ornaments=b},q.removeOrnament=function(a,b){var d=q.getOrnaments(a);c.removeOrnament(d,b),q.setOrnaments(a,d)},q.getOrnamentsList=function(a){var b=q.getOrnaments(a);return c.getList(b)},q.getOrnamentsWithOpts=function(a){var b=q.getOrnaments(a);return c.getOrnamentsWithOpts(b)},q.getOrnamentOpts=function(a,b){var d=q.getOrnaments(a);return c.getOrnamentOpts(d,b)},q.getOrnamentsListForDrawer=function(b){var c=[],d=q.getOrnaments(b);return Object.keys(d).forEach(function(b){switch(b){case i.TREMOLO:var e=f.getSingle(d,i.TREMOLO),g=f.stringOrContent(e);switch(g=parseInt(g,10)){case 1:c.push(i.TREMOLO1);break;case 2:c.push(i.TREMOLO2);break;case 3:c.push(i.TREMOLO3);break;case 4:c.push(i.TREMOLO4);break;case 5:c.push(i.TREMOLO5);break;default:throw new a("Unexpected","Bad number of tremolo ["+g+"].")}break;case i.MORDENT:case i.INVERTED_MORDENT:var h=f.getSingle(d,b),l=b;void 0!==h.$long&&h.$long===j.YES?(l=b===i.MORDENT?i.LONG_MORDENT:i.LONG_INVERTED_MORDENT,void 0!==h.$approach&&h.$approach===k.BELOW?l=b===i.MORDENT?i.BELOW_APPROACH_MORDENT:i.BELOW_APPROACH_INVERTED_MORDENT:void 0!==h.$approach&&h.$approach===k.ABOVE&&(l=b===i.MORDENT?i.ABOVE_APPROACH_MORDENT:i.ABOVE_APPROACH_INVERTED_MORDENT),b===i.INVERTED_MORDENT&&void 0!==h.$departure&&h.$departure===k.BELOW?l=i.BELOW_DEPARTURE_INVERTED_MORDENT:b===i.INVERTED_MORDENT&&void 0!==h.$departure&&h.$departure===k.ABOVE&&(l=i.ABOVE_DEPARTURE_INVERTED_MORDENT),c.push(l)):c.push(b);break;default:i.isValid(b)&&c.push(b)}}),c},q.hasIncompatibleOrnaments=function(a,b){var d=q.getOrnaments(a);return c.hasIncompatibleOrnaments(d,b)},q.getIncompatibleOrnaments=function(a,b){var d=q.getOrnaments(a);return c.getIncompatibleOrnaments(d,b)},q.setArpeggiate=function(a,b){a.arpeggiate=b},q.hasArpeggiate=function(a){return void 0!==a.arpeggiate},q.removeArpeggiate=function(a){delete a.arpeggiate},q.getArpeggiate=function(a){return a.arpeggiate},q.setGlissandos=function(a,b){f.setArray(a,"glissando",b)},q.hasGlissandos=function(a){return void 0!==a.glissando},q.removeGlissandos=function(a){delete a.glissando},q.getGlissandos=function(a){return q.hasGlissandos(a)?e.makeArray(a.glissando):[]},q.hasGlissando=function(a,b,c){if(!q.hasGlissandos(a))return!1;var e=q.getGlissandos(a);return d.hasGlissando(e,b,c)},q.hasGlissandoType=function(a,b){if(!q.hasGlissandos(a))return!1;var c=q.getGlissandos(a);return d.hasGlissandoType(c,b)},q.addGlissando=function(a,b){var c=q.getGlissandos(a);c.push(b),q.setGlissandos(a,c)},q.removeGlissando=function(a,b){var c=q.getGlissandos(a);d.removeGlissando(c,b),q.setGlissandos(a,c)},q.getGlissando=function(a,b,c){var e=q.getGlissandos(a);return d.getGlissando(e,b,c)},q.getGlissandosType=function(a,b){var c=q.getGlissandos(a);return d.getGlissandosType(c,b)}}.call(this),function(){"use strict";var a=Adagio.Utils.notationsUtils;Adagio.Utils.note.noteUtils_tuplet=function(b){b.hasTupletBounds=function(c){if(b.hasNotations(c)){var d=b.getNotation(c);return a.hasTupletBounds(d)}return!1},b.getTupletStartsWithin=function(c,d){var e=b.getNotation(c);return a.getTupletStartsWithin(e,d)},b.removeTupletStartsWithin=function(c,d){var e=b.getNotation(c);a.removeTupletStartsWithin(e,d),b.setNotation(c,e)},b.getTupletStopsWithin=function(c,d){var e=b.getNotation(c);return a.getTupletStopsWithin(e,d)},b.removeTupletStopsWithin=function(c,d){var e=b.getNotation(c);a.removeTupletStopsWithin(e,d),b.setNotation(c,e)},b.addTupletBounds=function(c,d){var e=b.getNotation(c);a.addTupletBounds(e,d),b.setNotation(c,e)},b.hasTupletStart=function(c){if(b.hasNotations(c)){var d=b.getNotation(c);return a.hasTupletStart(d)}return!1},b.hasTupletStop=function(c){if(b.hasNotations(c)){var d=b.getNotation(c);return a.hasTupletStop(d)}return!1},b.getTupletStartLevel=function(c){var d=b.getNotation(c);return a.getTupletStartLevel(d)},b.getTupletStopLevel=function(c){var d=b.getNotation(c);return a.getTupletStopLevel(d)},b.removeTupletLevelAndOutside=function(c,d){var e=b.getNotation(c);a.removeTupletLevelAndOutside(e,d),b.setNotation(c,e)},b.getTupletStarts=function(c){var d=b.getNotation(c);return a.getTupletStarts(d)},b.getTupletStart=function(c,d){var e=b.getNotation(c);return a.getTupletStart(e,d)},b.getTupletStops=function(c){var d=b.getNotation(c);return a.getTupletStops(d)},b.getTupletStop=function(c,d){var e=b.getNotation(c);return a.getTupletStop(e,d)},b.getTupletBounds=function(c){var d=b.getNotation(c);return a.getTupletBounds(d)},b.removeTupletBounds=function(c){var d=b.getNotation(c);a.removeTupletBounds(d),b.setNotation(c,d)}}}.call(this),function(){"use strict";var a=Adagio.Utils.notationsUtils;Adagio.Utils.note.noteUtils_slur=function(b){b.hasIntraMeasureSlur=function(c){if(b.hasNotations(c)){var d=b.getNotations(c);return a.hasIntraMeasureSlur(d)}return!1},b.getSlur=function(c){var d=b.getNotations(c);return a.getSlur(d)},b.hasSlurStart=function(c){if(b.hasNotations(c)){var d=b.getNotations(c);return a.hasSlurStart(d)}return!1},b.hasSlurStop=function(c){if(b.hasNotations(c)){var d=b.getNotations(c);return a.hasSlurStop(d)}return!1},b.hasSlur=function(c){if(b.hasNotations(c)){var d=b.getNotations(c);return a.hasSlur(d)}return!1},b.setSlur=function(c,d){var e=b.getNotations(c);a.setSlur(e,d),b.setNotations(c,e)},b.getSlurType=function(c){var d=b.getNotations(c);return a.getSlurType(d)},b.removeSlur=function(c){var d=b.getNotations(c);a.removeSlur(d),b.setNotations(c,d)}}}.call(this),function(){"use strict";var a=Adagio.Utils.notationsUtils,b=Adagio.Utils.typeUtils,c=Adagio.Values.GlissandoType;Adagio.Utils.note.noteUtils_notations=function(d){d.addNotation=function(b,c){var e=d.getNotation(b);a.addNotation(e,c),d.setNotation(b,e)},d.addArticulation=function(b,c){var e=d.getNotation(b);a.addArticulation(e,c),d.setNotation(b,e)},d.hasNotations=function(a){var c=a.notations;return b.isArray(c)&&(c=c[0]),b.isObject(c)},d.hasNotation=function(b,c){var e=d.getNotation(b);return a.hasNotation(e,c)},d.getNotation=function(a){return d.getNotations(a)},d.getNotations=function(a){return d.hasNotations(a)?a.notations:{}},d.setNotation=function(a,b){d.setNotations(a,b)},d.setNotations=function(a,c){b.isObjectEmpty(c)?delete a.notations:a.notations=c},d.removeNotation=function(b,c){var e=d.getNotation(b);a.removeNotation(e,c),d.setNotation(b,e)},d.hasNotationIncompatibleArticulations=function(b){var c=d.getNotation(b);return a.hasNotationIncompatibleArticulations(c)},d.getNotationIncompatibleArticulations=function(b){var c=d.getNotation(b);return a.getNotationIncompatibleArticulations(c)},d.isArticulationCompatibleWithNotation=function(b,c){var e=d.getNotation(b);return a.isArticulationCompatibleWithNotation(e,c)},d.removeArticulation=function(b,c){var e=d.getNotation(b);a.removeArticulation(e,c),d.setNotation(b,e)},d.removeAllArticulations=function(b){var c=d.getNotation(b);a.removeAllArticulations(c),d.setNotation(b,c)},d.hasArticulation=function(b,c){var e=d.getNotation(b);return a.hasArticulation(e,c)},d.hasArticulations=function(b){var c=d.getNotation(b);return a.hasArticulations(c)},d.hasIncompatibleArticulations=function(b,c){var e=d.getNotation(b);return a.hasIncompatibleArticulations(e,c)},d.getIncompatibleArticulations=function(b,c){var e=d.getNotation(b);return a.getIncompatibleArticulations(e,c)},d.getArticulations=function(b){var c=d.getNotation(b);return a.getArticulations(c)},d.getArticulationsList=function(b){var c=d.getNotation(b);return a.getArticulationsList(c)},d.getFullArticulationsList=function(b){var c=d.getNotation(b);return a.getFullArticulationsList(c)},d.isValidArticulation=function(b){return a.isValidArticulation(b)},d.hasOrnaments=function(b){var c=d.getNotation(b);return a.hasOrnaments(c)},d.hasOrnament=function(b,c,e){var f=d.getNotation(b);return a.hasOrnament(f,c,e)},d.hasOrnamentType=function(b,c){var e=d.getNotation(b);return a.hasOrnamentType(e,c)},d.addOrnament=function(b,c,e){var f=d.getNotation(b);a.addOrnament(f,c,e),d.setNotation(b,f)},d.removeOrnament=function(b,c){var e=d.getNotation(b);a.removeOrnament(e,c),d.setNotation(b,e)},d.removeAllOrnaments=function(b){var c=d.getNotation(b);a.removeAllOrnaments(c),d.setNotation(b,c)},d.getOrnamentsList=function(b){var c=d.getNotation(b);return a.getOrnamentsList(c)},d.getOrnamentsWithOpts=function(b){var c=d.getNotations(b);return a.getOrnamentsWithOpts(c)},d.getOrnamentOpts=function(b,c){var e=d.getNotations(b);return a.getOrnamentOpts(e,c)},d.getOrnamentsListForDrawer=function(b){var c=d.getNotation(b);return a.getOrnamentsListForDrawer(c)},d.hasIncompatibleOrnaments=function(b,c){var e=d.getNotation(b);return a.hasIncompatibleOrnaments(e,c)},d.getIncompatibleOrnaments=function(b,c){var e=d.getNotation(b);return a.getIncompatibleOrnaments(e,c)},d.getOrnaments=function(b){var c=d.getNotation(b);return a.getOrnaments(c)},d.hasArpeggiate=function(b){if(d.hasNotations(b)){var c=d.getNotation(b);return a.hasArpeggiate(c)}return!1},d.setArpeggiate=function(b,c){var e=d.getNotation(b);a.setArpeggiate(e,c),d.setNotation(b,e)},d.removeArpeggiate=function(b){var c=d.getNotation(b);a.removeArpeggiate(c),d.setNotation(b,c)},d.getArpeggiate=function(b){var c=d.getNotation(b);return a.getArpeggiate(c)},d.setGlissandos=function(b,c){var e=d.getNotation(b);a.setGlissandos(e,c),d.setNotation(b,e)},d.hasGlissandos=function(b){if(d.hasNotations(b)){var c=d.getNotation(b);return a.hasGlissandos(c)}return!1},d.removeGlissandos=function(b){var c=d.getNotation(b);a.removeGlissandos(c),d.setNotation(b,c)},d.getGlissandos=function(b){var c=d.getNotation(b);return a.getGlissandos(c)},d.hasGlissando=function(b,c,e){var f=d.getNotation(b);return a.hasGlissando(f,c,e)},d.hasGlissandoStart=function(a){return d.hasGlissandoType(a,c.START)},d.hasGlissandoStop=function(a){return d.hasGlissandoType(a,c.STOP)},d.hasGlissandoType=function(b,c){var e=d.getNotation(b);return a.hasGlissandoType(e,c)},d.addGlissando=function(b,c){var e=d.getNotation(b);a.addGlissando(e,c),d.setNotation(b,e)},d.removeGlissando=function(b,c){var e=d.getNotation(b);a.removeGlissando(e,c),d.setNotation(b,e)},d.getGlissando=function(b,c,e){var f=d.getNotation(b);return a.getGlissando(f,c,e)},d.getGlissandosType=function(b,c){var e=d.getNotation(b);return a.getGlissandosType(e,c)}}}.call(this),function(){"use strict";var a=Adagio.Utils.notationsUtils,b=Adagio.Utils.hammerOnPullOffUtils,c=Adagio.Values.TechnicalType,d=Adagio.Values.HammerOnPullOffType;Adagio.Utils.note.noteUtils_technical=function(e){e.addTechnical=function(b,c,d){var f=e.getNotations(b);a.addTechnical(f,c,d),e.setNotations(b,f)},e.removeTechnical=function(b,c,d){var f=e.getNotations(b);a.removeTechnical(f,c,d),e.setNotations(b,f)},e.removeAllTechnicals=function(b,c){var d=e.getNotations(b);a.removeAllTechnicals(d,c)},e.hasTechnical=function(b,c,d){var f=e.getNotations(b);return a.hasTechnical(f,c,d)},e.hasTechnicals=function(b){var c=e.getNotations(b);return a.hasTechnicals(c)},e.hasIncompatibleTechnical=function(b,c,d){var f=e.getNotations(b);return a.hasIncompatibleTechnical(f,c,d)},e.getIncompatibleTechnical=function(b,c,d){var f=e.getNotations(b);return a.getIncompatibleTechnical(f,c,d)},e.getTechnical=function(b){var c=e.getNotations(b);return a.getTechnical(c)},e.getTechnicalOpts=function(b,c){var d=e.getNotations(b);return a.getTechnicalOpts(d,c)},e.getTechnicalContent=function(b,c){var d=e.getNotations(b);return a.getTechnicalContent(d,c)},e.getTechnicalList=function(b){var c=e.getNotations(b);return a.getTechnicalList(c)},e.removeHammerOnPullOff=function(a){e.removeHammerOnPullOffStart(a),e.removeHammerOnPullOffStop(a)},e.removeHammerOnPullOffStart=function(a){var f={hammerOnPullOff:b.create(d.START)};e.hasTechnical(a,c.HAMMER_ON,f)&&e.removeTechnical(a,c.HAMMER_ON,f),e.hasTechnical(a,c.PULL_OFF,f)&&e.removeTechnical(a,c.PULL_OFF,f)},e.removeHammerOnPullOffStop=function(a){var f={hammerOnPullOff:b.create(d.STOP)};e.hasTechnical(a,c.HAMMER_ON,f)&&e.removeTechnical(a,c.HAMMER_ON,f),e.hasTechnical(a,c.PULL_OFF,f)&&e.removeTechnical(a,c.PULL_OFF,f)},e.hasHammerOnPullOffStart=function(a){return e.hasHammerOnStart(a)||e.hasPullOffStart(a)},e.hasHammerOnStart=function(a){var f={hammerOnPullOff:b.create(d.START)};return e.hasTechnical(a,c.HAMMER_ON,f)},e.hasPullOffStart=function(a){var f={hammerOnPullOff:b.create(d.START)};return e.hasTechnical(a,c.PULL_OFF,f)},e.hasHammerOnPullOffStop=function(a){return e.hasHammerOnStop(a)||e.hasPullOffStop(a)},e.hasHammerOnStop=function(a){var f={hammerOnPullOff:b.create(d.STOP)};return e.hasTechnical(a,c.HAMMER_ON,f)},e.hasPullOffStop=function(a){var f={hammerOnPullOff:b.create(d.STOP)};return e.hasTechnical(a,c.PULL_OFF,f)},e.hasFingering=function(b){if(e.hasNotations(b)){var c=e.getNotations(b);return a.hasFingering(c)}return!1},e.getFingering=function(b){var c=e.getNotations(b);return a.getFingering(c)},e.setFingering=function(b,c){var d=e.getNotations(b);a.setFingering(d,c),e.setNotations(b,d)},e.removeFingering=function(b){var c=e.getNotations(b);a.removeFingering(c),e.setNotations(b,c)},e.getFretListForDrawer=function(b){var c=e.getNotations(b);return a.getFretListForDrawer(c)},e.hasString=function(b){if(e.hasNotations(b)){var c=e.getNotations(b);return a.hasString(c)}return!1},e.getString=function(b){var c=e.getNotations(b);return a.getString(c)},e.hasTabData=function(a){return e.hasFretData(a)},e.hasFretData=function(b){if(e.hasNotations(b)){var c=e.getNotations(b);return a.hasTabData(c)}return!1},e.getTabData=function(a){return e.getFretData(a)},e.getFretData=function(b){var c=e.getNotations(b);return a.getTabData(c)}}}.call(this),function(){"use strict";var a=Adagio.Utils.mxlUtils,b=Adagio.Utils.lyricUtils,c=Adagio.Utils.mapUtils;Adagio.Utils.note.noteUtils_lyrics=function(d){d.hasLyrics=function(a){return void 0!==a.lyric},d.removeLyrics=function(a){delete a.lyric},d.hasTimeModif=function(a){return void 0!==a["time-modification"]},d.addLyric=function(a,c){var e=b.getLevel(c),f=d.getLyricsMap(a);f[e]=c,d.setLyricsMap(a,f)},d.removeLyricAtLevel=function(a,b){var c=d.getLyricsMap(a);delete c[b],d.setLyricsMap(a,c)},d.getLyricAtLevel=function(a,b){return d.getLyricsMap(a)[b]},d.hasLyricAtLevel=function(a,b){return void 0!==d.getLyricsMap(a)[b]},d.getLyricsMap=function(a){var e=d.getLyrics(a);return c.fromList(e,b.getLevel)},d.setLyricsMap=function(a,b){var e=c.toList(b);d.setLyrics(a,e)},d.getLyrics=function(b){return a.getArray(b,"lyric")},d.setLyrics=function(b,c){a.setArray(b,"lyric",c)}}}.call(this),function(){"use strict";var a=Adagio.Utils.setUtils={};a.fromList=function(a){var c={};return a.forEach(b,c),c},a.merge=function(a,c){var d={};return Object.keys(a).forEach(b,d),Object.keys(c).forEach(b,d),d};var b=function(a){this[a]=!0};a.haveInter=function(a,b){return!!c(a,b)||!!c(b,a)};var c=function(a,b){for(var c in a)if(void 0!==b[c])return!0;return!1};a.toList=function(a){return Object.keys(a)},a.copy=function(a){var b={};for(var c in a)b[c]=!0;return b},a.isSame=function(a,b){return!!d(a,b)&&!!d(b,a)};var d=function(a,b){for(var c in a)if(void 0===b[c])return!1;return!0}}.call(this),function(){"use strict";var a=Adagio.Utils.setUtils,b=Adagio.history.note.headUtils={};b.setHeadCssClassesSet=function(a,b){a.headCssClassesSet=b},b.hasHeadCssClassesSet=function(a){return void 0!==a.headCssClassesSet},b.getHeadCssClassesStr=function(c){if(b.hasHeadCssClassesSet(c)){var d=c.headCssClassesSet;return a.toList(d).join("")}return""}}.call(this),function(){"use strict";var a=Adagio.Utils.setUtils,b=Adagio.history.note.commonUtils={};b.setGlobalCssClassesSet=function(a,b){a.globalCssClassesSet=b},b.hasGlobalCssClassesSet=function(a){return void 0!==a.globalCssClassesSet},b.getGlobalCssClassesStr=function(c){if(b.hasGlobalCssClassesSet(c)){var d=c.globalCssClassesSet;return a.toList(d).join("")}return""}}.call(this),function(){"use strict";var a=Adagio.history.note.headUtils,b=Adagio.history.note.commonUtils,c=Adagio.Utils.typeUtils,d=Adagio.history.note.historyUtils={};d.setHeadCssClassesSet=function(b,c){var e=d.getHead(b);a.setHeadCssClassesSet(e,c),d.setHead(b,e)},d.getHeadCssClassesStr=function(b){var c=d.getHead(b);return a.getHeadCssClassesStr(c)},d.setHead=function(a,b){c.isObjectEmpty(b)?delete a.head:a.head=b},d.hasHead=function(a){return void 0!==a.head},d.getHead=function(a){return d.hasHead(a)?a.head:{}},d.setGlobalCssClassesSet=function(a,c){var e=d.getCommon(a);b.setGlobalCssClassesSet(e,c),d.setCommon(a,e)},d.getGlobalCssClassesStr=function(a){var c=d.getCommon(a);return b.getGlobalCssClassesStr(c)},d.setCommon=function(a,b){c.isObjectEmpty(b)?delete a.common:a.common=b},d.hasCommon=function(a){return void 0!==a.common},d.getCommon=function(a){return d.hasCommon(a)?a.common:{}}}.call(this),function(){"use strict";var a=Adagio.Utils.typeUtils,b=Adagio.history.note.historyUtils,c=Adagio.history.note.noteHistoryUtils={};c.setHeadCssClassesSet=function(a,d){var e=c.getHistory(a);b.setHeadCssClassesSet(e,d),c.setHistory(a,e)},c.getHeadCssClassesStr=function(a){var d=c.getHistory(a);return b.getHeadCssClassesStr(d)},c.setGlobalCssClassesSet=function(a,d){var e=c.getHistory(a);b.setGlobalCssClassesSet(e,d),c.setHistory(a,e)},c.getGlobalCssClassesStr=function(a){var d=c.getHistory(a);return b.getGlobalCssClassesStr(d)},c.setHistory=function(b,d){c.create$adagioIfNeeded(b),a.isObjectEmpty(d)?delete b.$adagio.history:b.$adagio.history=d},c.hasHistory=function(a){return!!c.has$adagio(a)&&void 0!==a.$adagio.history},c.getHistory=function(a){return c.hasHistory(a)?a.$adagio.history:{}},c.create$adagioIfNeeded=function(a){c.has$adagio(a)||c.create$adagio(a)},c.has$adagio=function(a){return void 0!==a.$adagio},c.create$adagio=function(a){a.$adagio={}}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.typeUtils,c=Adagio.Utils.beamsUtils,d=Adagio.Utils.durationUtils,e=Adagio.Utils.tiesUtils,f=Adagio.Utils.pitchUtils,g=Adagio.Utils.lyricUtils,h=Adagio.Utils.unpitchedUtils,i=Adagio.Utils.timeModifUtils,j=Adagio.Utils.slurUtils,k=Adagio.Utils.math,l=Adagio.Utils.mxlUtils,m=Adagio.Utils.mapUtils,n=Adagio.Utils.restUtils,o=Adagio.Values.Notehead,p=Adagio.Values.ArticulationType,q=Adagio.Values.TechnicalType,r=Adagio.Values.NotationType,s=Adagio.Values.AccidentalStyle,t=Adagio.Values.DurationType,u=Adagio.Utils.note.noteUtils_tuplet,v=Adagio.Utils.note.noteUtils_slur,w=Adagio.Utils.note.noteUtils_notations,x=Adagio.Utils.note.noteUtils_technical,y=Adagio.Utils.note.noteUtils_lyrics,z=Adagio.history.note.noteHistoryUtils,A=o.NORMAL,B="$adagio-courtesyAccidental",C=Adagio.Utils.noteUtils={};w(C),u(C),v(C),x(C),y(C),C.getNormalQuarterDuration=function(a,b){var c=C.getNormalDuration(a);return d.divisionsToQuarter(c,b)},C.hasDuration=function(a){var b=parseInt(a.duration,10);return k.isInteger(b)},C.getQuarterDuration=function(a,b){var c=C.getDuration(a);return d.divisionsToQuarter(c,b)},C.getNormalDuration=function(a){var b=C.getTimeModif(a),c=C.getDuration(a);return d.actualToNormal(c,b)},C.getDuration=function(b){if(!C.hasDuration(b))throw new a("InvalidDuration");return parseInt(b.duration,10)},C.setDuration=function(b,c){if(!k.isInteger(c)||c<0){throw new a("Unexpected","The note duration ["+c+"] is invalid.")}b.duration=c.toString()},C.setFloatingDuration=function(a,b){a.duration=b.toString()},C.getFloatingDuration=function(b){
if(!C.hasDuration(b))throw new a("InvalidDuration");return parseFloat(b.duration,10)},C.setDurationType=function(a,b){var c=t.toMxl(b);a.type=c},C.getDurationType=function(a){var b=l.stringOrContent(a.type);return t.fromMxl(b)},C.isRest=function(a){return void 0!==a.rest},C.isFullMeasureRest=function(a){if(C.isRest(a)){var b=C.getRest(a);return n.isFullMeasure(b)}return!1},C.setFullMeasureRest=function(a,b){var c=C.getRest(a);n.setFullMeasure(c,b),C.setRest(a,c)},C.getRest=function(a){return b.isObject(a.rest)?a.rest:{}},C.setRest=function(a,b){a.rest=b},C.createRest=function(){return{rest:{}}},C.hasStem=function(a){return void 0!==a.stem},C.getStem=function(a){var b=a.stem;return"string"==typeof b?b:b.content},C.hasBeam=function(a){return void 0!==a.beam},C.getStaffIdx=function(a){return void 0!==a.staff?parseInt(a.staff,10)-1:0},C.setStaffIdx=function(b,c){if(!k.isInteger(c))throw new a("Unexpected","Bad staff: ["+c+"]");b.staff=C.staffIdxToNote(c)},C.staffIdxToNote=function(a){return a+1+""},C.setVoiceIdx=function(b,c){if(!k.isInteger(c))throw new a("Unexpected","Bad voiceIdx: ["+c+"]");b.voice=C.voiceIdxToNote(c)},C.voiceIdxToNote=function(a){return a+1+""},C.getVoiceIdx=function(a){var b=C.getVoiceId(a);return parseInt(b,10)-1},C.getVoiceId=function(a){return C.hasVoiceIdx(a)?a.voice:"1"},C.hasVoiceIdx=function(a){return void 0!==a.voice},C.voiceIdxToNote=function(a){return a+1+""},C.getUnpitched=function(a){return a.unpitched},C.setUnpitched=function(a,b){a.unpitched=b},C.hasPitch=function(a){return void 0!==a.pitch},C.hasUnpitched=function(a){return void 0!==a.unpitched},C.getPitch=function(a){return a.pitch},C.getPitchStr=function(a){var b=C.getPitch(a);return f.stringify(b)},C.getUnpitchedStr=function(a){var b=C.getUnpitched(a);return h.stringify(b)},C.getAlter=function(a){var b=C.getPitch(a);return f.getAlter(b)},C.setAlter=function(a,b){var c=C.getPitch(a);f.setAlter(c,b)},C.hasAccidental=function(a){return b.hasStringOrContent(a.accidental)},C.getAccidental=function(a){var c=C.getRawAccidental(a);return c=b.stringOrContent(c),c===s.SHARPSHARP?s.DOUBLESHARP:c},C.getRawAccidental=function(a){return a.accidental},C.removeAccidental=function(a){delete a.accidental},C.setAccidental=function(b,c){if(!s.isSupportedStyle(c)){throw new a("BadAccidental","Bad accidental value: ["+c+"]")}b.accidental=c},C.hasDot=function(a){return void 0!==a.dot},C.getNbDots=function(a){return C.hasDot(a)?b.isArray(a.dot)?a.dot.length:1:0},C.setNbDots=function(b,c){if(0===c)delete b.dot;else if(1===c)b.dot={};else{if(!(c>1))throw new a("unreachable");b.dot=D(c)}};var D=function(a){for(var b=[],c=0;c<a;c++)b.push({});return b};C.isChord=function(a){return void 0!==a.chord},C.canHoldFlag=function(a,b){return!C.isRest(a)&&C.hasDuration(a)&&C.isNormalBelowQuarter(a,b)},C.isNormalBelowQuarter=function(a,b){return C.getNormalQuarterDuration(a,b)<1},C.hasFirstBeam=function(a){var b=C.getBeams(a);return c.hasFirstBeam(b)},C.hasBackwardBeam=function(a){if(!C.hasBeam(a))return!1;var b=C.getBeams(a);return c.hasBackward(b)},C.hasForwardBeam=function(a){if(!C.hasBeam(a))return!1;var b=C.getBeams(a);return c.hasForward(b)},C.isBeamBegin=function(a){if(!C.hasBeam(a))return!1;var b=C.getBeams(a);return c.isBegin(b)},C.isBeamContinue=function(a){if(!C.hasBeam(a))return!1;var b=C.getBeams(a);return c.isContinue(b)},C.isBeamEnd=function(a){if(!C.hasBeam(a))return!1;var b=C.getBeams(a);return c.isEnd(b)},C.getOrderedBeams=function(a){var b=C.getBeams(a);return c.getOrderedBeams(b)},C.getLastBeamType=function(a){var b=C.getBeams(a);return c.getLastType(b)},C.getBeams=function(a){return b.getArray(a,"beam")},C.setBeams=function(a,c){b.setArray(a,"beam",c)},C.makeBeamBegin=function(a,b){var d=C.calcNbBeams(a,b),e=c.createBegin(d);C.setBeams(a,e)},C.makeBeamContinue=function(a,b){var d=C.calcNbBeams(a,b),e=c.createContinue(d);C.setBeams(a,e)},C.makeBeamEnd=function(a,b){var d=C.calcNbBeams(a,b),e=c.createEnd(d);C.setBeams(a,e)},C.calcNbBeams=function(a,b){var e=C.getNormalQuarterDuration(a,b),f=d.extractBaseDuration(f);return c.durationToNbBeams(e)},C.makeUnbeamed=function(a){delete a.beam},C.getNbBeams=function(a){var b=C.getBeams(a);return c.getNb(b)},C.removeChordData=function(a){var b={};if(void 0!==a.beam&&(b.beam=a.beam,delete a.beam),C.hasTupletBounds(a)&&(b.tupletBounds=C.getTupletBounds(a),C.removeTupletBounds(a)),b.articulations=C.getFullArticulationsList(a),b.technical=C.getTechnicalList(a),b.ornaments=C.getOrnamentsWithOpts(a),b.articulations.includes(r.FERMATA)&&C.removeNotation(a,r.FERMATA),C.hasLyrics(a)){var c=C.getLyrics(a);b.lyrics=c.map(g.copy),C.removeLyrics(a)}return C.removeAllArticulations(a),C.removeAllOrnaments(a),C.removeAllTechnicals(a,[q.STRING,q.FRET,q.HAMMER_ON,q.PULL_OFF]),C.hasSlur(a)&&(b.slur=C.getSlur(a),C.removeSlur(a)),C.isSlashedGrace(a)&&(b.isSlashedGrace=!0),b.history=z.getHistory(a),b},C.addChordData=function(a,b){if(void 0!==b.beam&&(a.beam=b.beam),b.articulations.forEach(function(b){p.isValid(b)?C.addArticulation(a,b):b===r.FERMATA&&C.addNotation(a,b)}),b.technical.forEach(function(b){q.isCommonValid(b)&&b!==q.HAMMER_ON&&b!==q.PULL_OFF&&C.addTechnical(a,b)}),m.map(b.ornaments,function(b,c){C.addOrnament(a,b,c)}),void 0!==b.tupletBounds&&C.addTupletBounds(a,b.tupletBounds),void 0!==b.lyrics){var c=b.lyrics.map(g.copy);C.setLyrics(a,c)}if(void 0!==b.slur){var d=j.copy(b.slur);C.setSlur(a,d)}b.isSlashedGrace&&C.makeSlashedGrace(a),b.history=z.setHistory(a,b.history)},C.hasTieStart=function(a){if(!C.hasTie(a))return!1;var b=C.getTies(a);return e.hasStart(b)},C.hasTieStop=function(a){if(!C.hasTie(a))return!1;var b=C.getTies(a);return e.hasStop(b)},C.hasTie=function(a){return void 0!==a.tie},C.addTieStart=function(a){var b=C.getTies(a);e.addStart(b),C.setTies(a,b)},C.addTieStop=function(a){var b=C.getTies(a);e.addStop(b),C.setTies(a,b)},C.removeTieStart=function(a){var b=C.getTies(a);e.removeStart(b),C.setTies(a,b)},C.removeTieStop=function(a){var b=C.getTies(a);e.removeStop(b),C.setTies(a,b)},C.removeTie=function(a){C.setTies(a,[])},C.getTies=function(a){return C.hasTie(a)?b.makeArray(a.tie):[]},C.setTies=function(a,b){b.length>1?a.tie=b:1===b.length?a.tie=b[0]:delete a.tie},C.setPitch=function(a,b){a.pitch=b},C.getBackupDuration=function(a){return C.getBackups(a).map(E).reduce(k.add)},C.getBackups=function(a){return C.hasBackup(a)?b.isArray(a.backup)?a.backup:[a.backup]:[]},C.removeTimeJumps=function(a){C.removeBackup(a),C.removeForward(a)},C.hasBackup=function(a){return void 0!==a.backup},C.removeBackup=function(a){delete a.backup},C.addBackup=function(a,b){a.backup={duration:b}},C.getForwardDuration=function(a){return C.getForwards(a).map(E).reduce(k.add)},C.getForwards=function(a){return C.hasForward(a)?b.isArray(a.forward)?a.forward:[a.forward]:[]},C.hasForward=function(a){return void 0!==a.forward};var E=function(a){return parseInt(a.duration,10)};C.removeForward=function(a){delete a.forward},C.addForward=function(a,b){a.forward={duration:b}},C.isGraceNote=function(a){return void 0!==a.grace},C.makeGrace=function(a){a.grace={}},C.makeSlashedGrace=function(a){a.grace={$slash:"yes"}},C.isSlashedGrace=function(a){if(!C.isGraceNote(a))return!1;var c=a.grace;return!!b.isObject(c)&&"yes"===c.$slash},C.updateInstrumentId=function(a,b){if(C.hasInstrumentId(a)){var c=C.getInstrumentId(a),d=b[c];void 0!==d&&C.setInstrumentId(a,d)}},C.hasInstrumentId=function(a){return void 0!==a.instrument&&void 0!==a.instrument.$id},C.getInstrumentId=function(a){return a.instrument.$id},C.setInstrumentId=function(a,b){void 0===a.instrument&&(a.instrument={}),a.instrument.$id=b},C.hasHeadParentheses=function(a){var c=C.getRawHead(a);return!!b.isObject(c)&&"yes"===c.$parentheses},C.addHeadParentheses=function(a){var b=C.getHead(a),c={content:b,$parentheses:"yes"};C.setHead(a,c)},C.removeHeadParentheses=function(a){var b=C.getHead(a);C.setHead(a,b)},C.getRawHead=function(a){return a.notehead},C.getHead=function(a){return C.hasHead(a)?l.stringOrContent(a.notehead):A},C.hasHead=function(a){return l.hasStringOrContent(a.notehead)},C.setHead=function(a,b){b===A?delete a.notehead:a.notehead=b},C.hasNormalTimeModif=function(a){if(C.hasTimeModif(a)){var b=C.getTimeModif(a);return i.isNormal(b)}return!0},C.getTimeModif=function(a){return C.hasTimeModif(a)?a["time-modification"]:i.createDefault()},C.setTimeModif=function(a,b){i.isNormal(b)?delete a["time-modification"]:a["time-modification"]=b},C.needRestLock=function(a){return!!C.isRest(a)&&(!!C.hasLyrics(a)||!!C.hasNotation(a,r.FERMATA))},C.hasAccidentalWithParentheses=function(a){if(!C.hasAccidental(a))return!1;var c=C.getRawAccidental(a);return!!b.isObject(c)&&"yes"===c.$parentheses},C.addCourtesyAccidental=function(a){a[B]=!0},C.removeCourtesyAccidental=function(a){delete a[B]},C.hasCourtesyAccidental=function(a){return!0===a[B]}}.call(this),function(){"use strict";var a=Adagio.Utils.pitchUtils,b=Adagio.Utils.clone,c=Adagio.Utils.scaleUtils={},d=7,e=7,f=5,g={};(function(){g[0]={octave:"0",step:"C"},function(){for(var b={diatonic:"4",chromatic:e.toString()},c=1;c<=d;c++){var f=g[c-1],h=a.transpose(f,b);a.getOctave(h)&&a.setOctave(h,0),g[c]=h}}.call(this),function(){for(var b={diatonic:"3",chromatic:f.toString()},c=-1;c>=-d;c--){var e=g[c+1],h=a.transpose(e,b);a.getOctave(h)&&a.setOctave(h,0),g[c]=h}}.call(this)}).call(this);var h={};(function(){for(var b in g){var c=g[b],d=a.stringify(c);h[d]=b}}).call(this),c.fifthsToTonic=function(a){return b(g[a])},c.isValidTonic=function(a){return c.hasFifthsForTonic(a)},c.hasFifthsForTonic=function(b){var c=a.stringify(b);return void 0!==h[c]},c.getFifthsForTonic=function(b){var c=a.stringify(b);return h[c]}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadFifthsError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadFifthsError",this.stack=e.stack,this.message=e.message,this.fifths=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"fifths value "+a+" is invalid. It has to be a positive integer between [-7 and 7]"}}.call(this),function(){"use strict";var a=Adagio.Utils.clone,b=Adagio.Utils.transposeUtils,c=Adagio.Utils.scaleUtils,d=Adagio.Utils.pitchUtils,e=Adagio.Utils.mxlUtils,f=Adagio.Error.InternalError,g=Adagio.Error.value.BadFifthsError,h=Adagio.Utils.keyUtils={},i="major",j=0;h.removeCustom=function(a){delete a["key-alter"],delete a["key-accidental"],delete a["key-step"]},h.getCustomAlters=function(a){var b=e.getArray(a,"key-alter");return b=b.map(parseFloat)},h.hasFifths=function(a){return void 0!==a.fifths},h.getFifths=function(a){return parseInt(a.fifths,10)},h.setFifths=function(a,b){a.fifths=b.toString()},h.getMode=function(a){return h.hasMode(a)?a.mode:i},h.hasMode=function(a){return void 0!==a.mode},h.isSame=function(a,b){return!(h.hasCancel(a)&&(!h.hasCancel(b)||h.getCancel(a)!==h.getCancel(b)))&&(h.getFifths(a)===h.getFifths(b)&&h.getMode(a)===h.getMode(b))},h.hasCancel=function(a){return void 0!==a.cancel},h.removeCancel=function(a){delete a.cancel},h.setCancel=function(a,b){a.cancel=b.toString()},h.isSignChange=function(a){var b=h.getFifths(a),c=h.getPreviousFifths(a);return c>0&&b<0||c<0&&b>0},h.isBackToZero=function(a){var b=h.getFifths(a);return 0!==h.getPreviousFifths(a)&&0===b},h.getPreviousFifths=function(a){return h.hasPreviousFifths(a)?a.$adagio.previousFifths:0},h.hasPreviousFifths=function(a){return void 0!==a.$adagio&&void 0!==a.$adagio.previousFifths},h.setPreviousFifths=function(a,b){void 0===a.$adagio&&(a.$adagio={}),a.$adagio.previousFifths=b},h.getCancel=function(a){return parseInt(a.cancel,10)},h.needCancel=function(a,b){var c=h.getFifths(b),d=h.getFifths(a);return 0!==d&&(d<0&&c>d||d>0&&c<d)},h.copy=function(a){var b=h.getFifths(a),c=h.create(b);if(h.hasMode(a)){var d=h.getMode(a);c.mode=d}return c},h.removeDefault=function(a){h.getMode(a)===i&&delete a.mode},h.makeDiff=function(b,c){var d=a(c),e=h.getFifths(b);return h.setPreviousFifths(d,e),d},h.check=function(a){h.checkFifths(a)},h.checkFifths=function(a){if(!h.isFifthsValid(a))throw new g(a.fifths)},h.isFifthsValid=function(a){var b=h.getFifths(a);return!isNaN(b)&&-7<=b&&b<=7},h.getTonic=function(a){var b=h.getFifths(a);return c.fifthsToTonic(b)},h.create=function(a){return{fifths:a.toString()}},h.getUpTransposeDiff=function(a,b){var c=h.getTonic(a),e=h.getTonic(b);return d.naiveComparePitch(c,e)<0&&d.shiftOctave(c,1),d.getTransposeDiff(c,e)},h.getDownTransposeDiff=function(a,b){var c=h.getTonic(a),e=h.getTonic(b);return d.naiveComparePitch(c,e)>0&&d.shiftOctave(e,1),d.getTransposeDiff(c,e)},h.reverseTranspose=function(a,c){return c=b.getReverse(c),a=h.transpose(a,c)},h.transpose=function(a,b){b=k(b);var c=h.getTonic(a);return d.setOctave(c,1),c=d.transpose(c,b),d.setOctave(c,0),h.fromTonic(c)};var k=function(a){return 0===b.getOctaveChange(a)?a:(a=b.copy(a),b.setOctaveChange(a,0),a)};h.fromTonic=function(a){a=h.getValidTonicEnharmonic(a);var b=c.getFifthsForTonic(a);return h.create(b)},h.getValidTonicEnharmonic=function(a){return c.isValidTonic(a)?a:l(a)};var l=function(a){a=d.copy(a),d.setOctave(a,1);var c,e=b.create(0),g=d.getAlter(a);if(1===g)c=1;else{if(-1!==g)throw new f("Unreachable");c=-1}return b.setDiatonic(e,c),a=d.transpose(a,e),d.setOctave(a,0),a};h.isC=function(a){return h.getFifths(a)===j},h.createC=function(){return h.create(j)},h.createDefault=function(){return h.createC()}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadStaffTuningLineError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadStaffTuningLineError",this.stack=e.stack,this.message=e.message,this.line=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"line value "+a+" is invalid. It has to be a positive integer between [1 and 6]"}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadStaffTuningTuningStep=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadStaffTuningTuningStep",this.stack=e.stack,this.message=e.message,this.tuningStep=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"tuning-step value "+a+" is invalid. It has to be a letter in the following range [A, B, C, D, E, F, G]"}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadStaffTuningTuningOctave=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadStaffTuningTuningOctave",this.stack=e.stack,this.message=e.message,this.tuningOctave=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"tuning-octave value "+a+" is invalid. It has to be a positive integer between the following values [0, 9]"}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadStaffTuningTuningAlter=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadStaffTuningTuningAlter",this.stack=e.stack,this.message=e.message,this.tuningAlter=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"tuning-alter value "+a+" is invalid. It has to be an integer between the following values [-2, 2]"}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.pitchUtils,c=Adagio.Utils.keyUtils,d=Adagio.Utils.transposeUtils,e=Adagio.Utils.intervalUtils,f=Adagio.Values.Step,g=Adagio.Utils.pitchShift={};g.switchEnharmonic=function(a,c){var e=g.normalize(a,c);if(!b.isSamePitch(a,e))return e;var f=g.getAlterDiff(a,c);if(0!==f){var j=d.createDefault();return d.setDiatonic(j,f),a=b.transpose(a,j,!0)}var k=b.getStep(a),l=g.getChromaticShift(k,1,c);return 1===l?a=h(a):(l=g.getChromaticShift(k,-1,c),-1===l&&(a=i(a)),a)},g.shiftDiatonicUp=function(a,c){var e=b.getStep(a),f=g.getChromaticShift(e,1,c),h=g.getAlterDiff(a,c),i=d.create(f-h);return d.setDiatonic(i,1),a=b.transpose(a,i,!0)},g.shiftDiatonicDown=function(a,c){var e=b.getStep(a),f=g.getChromaticShift(e,-1,c),h=g.getAlterDiff(a,c),i=d.create(f-h);return d.setDiatonic(i,-1),a=b.transpose(a,i,!0)},g.shiftHalfToneUp=function(a,c){a=g.normalize(a,c);var e=g.getAlterDiff(a,c);e++;var f=d.create(1),h=b.getStep(a);return e>=g.getChromaticShift(h,1,c)&&d.setDiatonic(f,1),a=b.transpose(a,f,!0)},g.shiftHalfToneDown=function(a,c){a=g.normalize(a,c);var e=g.getAlterDiff(a,c);e--;var f=d.create(-1),h=b.getStep(a);return e<=g.getChromaticShift(h,-1,c)&&d.setDiatonic(f,-1),a=b.transpose(a,f,!0)},g.getChromaticShift=function(a,d,g){var h=c.getTonic(g),i=b.getStep(h),j=f.getStepIdx(a);j-=f.getStepIdx(i);var k=f.getSize();return j<0&&(j+=k),a=f.idxToStep(j),e.getChromaticShift(a,d)},g.normalize=function(a,b){return a=g.normalizeFromKey(a,b),a=g.normalizeFromInterval(a,b)},g.normalizeFromKey=function(a,b){var c=g.getAlterDiff(a,b);return c>1?a=h(a):c<-1&&(a=i(a)),c=g.getAlterDiff(a,b),c>1?a=h(a):c<-1&&(a=i(a)),a},g.normalizeFromInterval=function(c,d){var e,f=g.getAlterDiff(c,d),j=b.getStep(c);if(1===f)return e=g.getChromaticShift(j,1,d),1===e&&(c=h(c)),c;if(-1===f)return e=g.getChromaticShift(j,-1,d),-1===e&&(c=i(c)),c;if(0===f)return c;throw new a("Unexpected")},g.getAlterDiff=function(a,d){var e=b.getStep(a),f=c.getFifths(d),g=b.stepToAlter(e,f);return b.getAlter(a)-g};var h=function(a){var c=d.createDefault();return d.setDiatonic(c,1),a=b.transpose(a,c,!0)},i=function(a){var c=d.createDefault();return d.setDiatonic(c,-1),a=b.transpose(a,c,!0)}}.call(this),function(){"use strict";var a=Adagio.Error.value.BadStaffTuningLineError,b=Adagio.Error.value.BadStaffTuningTuningStep,c=Adagio.Error.value.BadStaffTuningTuningOctave,d=Adagio.Error.value.BadStaffTuningTuningAlter,e=Adagio.Utils.pitchUtils,f=Adagio.Utils.pitchShift,g=Adagio.Utils.keyUtils,h=Adagio.Utils.staffTuningUtils={},i=["A","B","C","D","E","F","G"],j=g.createC();h.applyCapo=function(a,b){for(var c=h.toPitch(a),d=0;d<b;d++)c=f.shiftHalfToneUp(c,j);return a=h.fromPitch(c)},h.hasLine=function(a){return void 0!==a.$line},h.hasTuningStep=function(a){return h.hasStep(a)},h.hasTuningOctave=function(a){return h.hasOctave(a)},h.hasTuningAlter=function(a){return h.hasAlter(a)},h.hasStep=function(a){return void 0!==a["tuning-step"]},h.hasOctave=function(a){return void 0!==a["tuning-octave"]},h.hasAlter=function(a){return void 0!==a["tuning-alter"]},h.getLine=function(a){return parseInt(a.$line,10)-1},h.getTuningStep=function(a){return h.getStep(a)},h.getTuningOctave=function(a){return h.getOctave(a)},h.getTuningAlter=function(a){return h.getAlter(a)},h.getStep=function(a){return a["tuning-step"]},h.getOctave=function(a){return parseInt(a["tuning-octave"],10)},h.getAlter=function(a){return parseInt(a["tuning-alter"],10)||0},h.setLine=function(a,b){a.$line=b+1+""},h.setTuningStep=function(a,b){a["tuning-step"]=b},h.setTuningOctave=function(a,b){a["tuning-octave"]=b},h.setTuningAlter=function(a,b){a["tuning-alter"]=b},h.create=function(a,b,c){var d={"tuning-step":a,"tuning-octave":b},e=c||0;return h.setTuningAlter(d,e),d},h.copy=function(a){var b=h.getStep(a),c=h.getOctave(a),d=h.getAlter(a);return h.create(b,c,d)},h.isSame=function(a,b){return h.getStep(a)===h.getStep(b)&&h.getOctave(a)===h.getOctave(b)&&h.getAlter(a)===h.getAlter(b)},h.check=function(a){h.hasLine(a)&&h.checkLine(a),h.hasAlter(a)&&h.checkTuningAlter(a),h.checkTuningStep(a),h.checkTuningOctave(a)},h.checkTuningOctave=function(a){var b=h.getOctave(a);if(!h.isTuningOctaveValid(b))throw new c(b)},h.checkTuningStep=function(a){var c=h.getStep(a);if(!i.includes(c))throw new b(c)},h.checkLine=function(b){var c=h.getLine(b);if(!h.isLineValid(c))throw new a(c+1)},h.checkTuningAlter=function(a){var b=h.getAlter(a);if(!h.isTuningAlterValid(b))throw new d(b)},h.isTuningOctaveValid=function(a){return!isNaN(a)&&a>=0&&a<=9},h.isLineValid=function(a){return!isNaN(a)&&a>=0&&a<=5},h.isTuningAlterValid=function(a){return!isNaN(a)&&a>=-2&&a<=2},h.toPitch=function(a){var b=h.getOctave(a),c=h.getStep(a),d=h.getAlter(a);return e.create(b,c,d)},h.fromPitch=function(a){var b=e.getStep(a),c=e.getOctave(a),d=e.getAlter(a);return h.create(b,c,d)}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadTabCapoError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadTabCapoError",this.stack=e.stack,this.message=e.message,this.tabCapo=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"The capo position ["+a+"] is invalid. It must be a number between 0 and 12."}}.call(this),function(){"use strict";var a=Adagio.Error.value.BadTabCapoError,b=Adagio.Utils.math,c=Adagio.Values.TabCapo={MIN:0,MAX:12,DEFAULT:0};c.check=function(b){if(!c.isValid(b))throw new a(b)},c.isDefault=function(a){return a===c.DEFAULT},c.isValid=function(a){return b.isNumber(a)&&c.MIN<=a&&a<=c.MAX}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadNbStaffLinesError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadNbStaffLinesError",this.stack=e.stack,this.message=e.message,this.nbStaffLines=b,this};b.protonbStaffLines=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"The number of staff lines ["+a+"] is invalid."}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadStaffTuningLengthError=function(b,d){var e=c(b,d),f=a.call(this,e);return this.name=f.name="BadStaffTuningNumberError",this.stack=f.stack,this.message=f.message,this.staffTuningLength=b,this.staffLines=d,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a,b){return"The following length of staff-tuning ["+a+"] doest not match the number of staff-lines ["+b+"]"}}.call(this),function(){"use strict";var a=Adagio.Utils.staffTuningUtils,b=Adagio.Utils.typeUtils,c=Adagio.Utils.clefUtils,d=Adagio.Utils.math,e=Adagio.Values.TabCapo,f=Adagio.Error.value.BadNbStaffLinesError,g=Adagio.Error.value.BadStaffTuningLengthError,h=Adagio.Error.InternalError,i=Adagio.Utils.staffDetailsUtils={};i.DEFAULT_NB_STAFF_LINES=5,i.hasStaffLines=function(a){return void 0!==a["staff-lines"]},i.hasStaffTuning=function(a){return void 0!==a["staff-tuning"]},i.getStaffLines=function(a){return i.getNbStaffLines(a)},i.getNbStaffLines=function(a){return i.hasStaffLines(a)?parseInt(a["staff-lines"],10):i.DEFAULT_NB_STAFF_LINES},i.getShiftedTuningByString=function(a,b){return i.createShiftedTunings(a),void 0===a.$adagio.shiftedTunings[b]&&i.initShiftedTuningByString(a,b),a.$adagio.shiftedTunings[b]},i.createShiftedTunings=function(a){i.create$adagioIfNeeded(a),void 0===a.$adagio.shiftedTunings&&(a.$adagio.shiftedTunings={})},i.initShiftedTuningByString=function(b,c){var d=i.getStaffTuningByString(b,c),e=i.getCapo(b);e>0&&(d=a.applyCapo(d,e)),b.$adagio.shiftedTunings[c]=d},i.create$adagioIfNeeded=function(a){i.has$adagio(a)||i.create$adagio(a)},i.has$adagio=function(a){return void 0!==a.$adagio},i.create$adagio=function(a){a.$adagio={}},i.getStaffTuningByString=function(a,b){if(!i.hasStaffTuning(a))throw new h("Unexpected","No tuning in staff details");var c=i.getStaffTuningsLength(a);if(b<1||b>c)throw new h("Unexpected","The string number ["+b+"] is invalid");var d=c-b;return i.getStaffTunings(a)[d]},i.getStaffTuning=function(a,b){return i.getStaffTunings(a)[b]},i.getStaffTuningsLength=function(a){return i.hasStaffTuning(a)?i.getStaffTunings(a).length:0},i.getStaffTunings=function(a){var c=a["staff-tuning"];return void 0!==c?b.makeArray(c):c},i.setNbStaffLines=function(a,b){a["staff-lines"]=b},i.setStaffTunings=function(a,b){a["staff-tuning"]=b},i.setCapo=function(a,b){e.isDefault(b)?delete a.capo:a.capo=b.toString()},i.isSame=function(b,c){if(i.getNbStaffLines(b)!==i.getNbStaffLines(c))return!1;if(i.getCapo(b)!==i.getCapo(c))return!1;if(i.hasStaffTuning(b)&&i.hasStaffTuning(c)){if(i.getStaffTuningsLength(b)!==i.getStaffTuningsLength(c))return!1;for(var d=0;d<i.getStaffTuningsLength(b);d++)if(!a.isSame(i.getStaffTuning(b,d),i.getStaffTuning(c,d)))return!1;return!0}return i.hasStaffTuning(b)===i.hasStaffTuning(c)},i.createDefault=function(){return i.create(i.DEFAULT_NB_STAFF_LINES)},i.create=function(a,b,c){var d={"staff-lines":a};return void 0!==b&&i.setStaffTunings(d,b),void 0!==c&&i.setCapo(d,c),i.check(d),d},i.check=function(b){if(i.hasStaffLines(b)&&i.checkStaffLines(b),i.hasCapo(b)&&i.checkCapo(b),i.hasStaffTuning(b)){var c=i.getStaffTuningsLength(b),d=i.getNbStaffLines(b);if(c!==d)throw new g(c,d);i.getStaffTunings(b).forEach(a.check)}},i.checkCapo=function(a){var b=i.getCapo(a);e.check(b)},i.checkStaffLines=function(a){i.checkNbStaffLines(a)},i.checkNbStaffLines=function(a){var b=i.getNbStaffLines(a);if(!i.isStaffLinesValid(b))throw new f(b)},i.isStaffLinesValid=function(a){return i.isNbStaffLinesValid(a)},i.isNbStaffLinesValid=function(a){return d.isInteger(a)&&a>=0&&a<=12},i.copy=function(b){var c,d=i.getStaffLines(b);if(i.hasStaffTuning(b)){var e=i.getStaffTunings(b),f=e.map(a.copy),g=i.getCapo(b);c=i.create(d,f,g)}else c=i.create(d);return c},i.fillEmptyEntriesWithDefault=function(a){for(var b=a.getNbStaves(),c=0;c<b;c++)a.hasEntry(c)||a.setEntry(i.createDefault(),c)},i.toClef=function(a){var b=i.getNbStaffLines(a),d="G";4===b&&(d="F");var e=c.create(d);return c.setOctaveChange(e,-1),e},i.toTabClef=function(a){return i.getNbStaffLines(a)<6?c.create("TAB",4):c.create("TAB",5)},i.getCapo=function(a){return i.hasCapo(a)?parseInt(a.capo,10):e.DEFAULT},i.hasCapo=function(a){return void 0!==a.capo}}.call(this),function(){"use strict";var a=Adagio.Utils.timeUtils,b=Adagio.Utils.clefUtils,c=Adagio.Utils.keyUtils,d=Adagio.Utils.typeUtils,e=Adagio.Utils.transposeUtils,f=Adagio.Utils.staffDetailsUtils,g=Adagio.Utils.attributeWrapper.AttributeWrapper,h=Adagio.Utils.attributesUtils={};h.DEFAULT_DIVISIONS=1,h.DEFAULT_NB_STAVES=1,h.markOwn=function(a){a.noteBefore=-1},h.isEmpty=function(a){return!(h.hasDivisions(a)||h.hasNbStaves(a)||h.hasTime(a)||h.hasClef(a)||h.hasKey(a)||h.hasStaffDetails(a)||h.hasTranspose(a))},h.getNbStaves=function(a){return h.hasNbStaves(a)?parseInt(a.staves,10):h.DEFAULT_NB_STAVES},h.setNbStaves=function(a,b){a.staves=b.toString()},h.hasNbStaves=function(a){return void 0!==a.staves},h.hasStaffDetails=function(a){return void 0!==a["staff-details"]},h.setStaffDetails=function(a,b){h.setAttribute(a,"staff-details",b)},h.getStaffDetails=function(a){return h.hasStaffDetails(a)?d.makeArray(a["staff-details"]):[]},h.getWrappedStaffDetails=function(a,b){void 0===b&&(b=h.getNbStaves(a));var c=h.getStaffDetails(a);return new g(c,b,f)},h.getWrappedStaffDetailsOrDefault=function(a,b){void 0===b&&(b=h.getNbStaves(a));var c=h.getStaffDetails(a),d=new g(c,b,f);return f.fillEmptyEntriesWithDefault(d),d},h.getDivisions=function(a){return h.getDivisionsPerQuarter(a)},h.getDivisionsPerQuarter=function(a){return h.getDpq(a)},h.getDpq=function(a){return h.hasDivisions(a)?parseInt(a.divisions,10):h.DEFAULT_DIVISIONS},h.setDpq=function(a,b){a.divisions=b.toString()},h.hasDivisions=function(a){return h.hasDpq(a)},h.hasDpq=function(a){return void 0!==a.divisions},h.setDivisions=function(a,b){a.divisions=b.toString()},h.mergeIfSame=function(a,b){if(h.isAllSame(a,b)){var c=a[0];return delete c.$number,c}return a},h.isAllSame=function(a,b){if(1===a.length)return!0;for(var c=0;c<a.length-1;c++){if(!b(a[c],a[c+1]))return!1}return!0},h.removeDefault=function(d){h.getNbStaves(d)===h.DEFAULT_NB_STAVES&&delete d.staves,h.getClef(d).forEach(b.removeDefault),h.getTime(d).forEach(a.removeDefault),h.getKey(d).forEach(c.removeDefault);var f=h.getTranspose(d).filter(i);f.forEach(e.removeDefault),h.setTranspose(d,f)};var i=function(a){return!e.isDefault(a)};h.getAnyTime=function(a){return h.getTime(a)[0]},h.getTime=function(a){return h.hasTime(a)?d.makeArray(a.time):[]},h.hasTime=function(a){return void 0!==a.time},h.setTime=function(a,b){h.setAttribute(a,"time",b)},h.getKey=function(a){return h.hasKey(a)?d.makeArray(a.key):[]},h.hasKey=function(a){return void 0!==a.key},h.setKey=function(a,b){h.setAttribute(a,"key",b)},h.getClef=function(a){return h.hasClef(a)?d.makeArray(a.clef):[]},h.hasClef=function(a){return void 0!==a.clef},h.setClef=function(a,b){h.setAttribute(a,"clef",b)},h.isTransposing=function(a){for(var b=h.getWrappedTransposeOrDefault(a),c=h.getNbStaves(a),d=0;d<c;d++){var f=b.getEntry(d);if(!e.isIdentity(f))return!0}return!1},h.getTranspose=function(a){return h.hasTranspose(a)?d.makeArray(a.transpose):[]},h.getTransposeOrDefault=function(a){return h.hasTranspose(a)?d.makeArray(a.transpose):[e.createDefault()]},h.hasTranspose=function(a){return void 0!==a.transpose},h.setTranspose=function(a,b){h.setAttribute(a,"transpose",b)},h.removeTranspose=function(a){delete a.transpose},h.removeClef=function(a){delete a.clef},h.setAttribute=function(a,b,c){0===c.length?delete a[b]:1===c.length?a[b]=c[0]:a[b]=c},h.getAnyTime=function(a){return h.getTime(a)[0]},h.getWrappedTime=function(b,c){void 0===c&&(c=h.getNbStaves(b));var d=h.getTime(b);return new g(d,c,a)},h.getWrappedKey=function(a,b){void 0===b&&(b=h.getNbStaves(a));var d=h.getKey(a);return new g(d,b,c)},h.getWrappedClef=function(a,c){void 0===c&&(c=h.getNbStaves(a));var d=h.getClef(a);return new g(d,c,b)},h.getWrappedTranspose=function(a,b){void 0===b&&(b=h.getNbStaves(a));var c=h.getTranspose(a);return new g(c,b,e)},h.getWrappedTransposeOrDefault=function(a,b){void 0===b&&(b=h.getNbStaves(a));var c=h.getTransposeOrDefault(a),d=new g(c,b,e);return e.fillEmptyEntriesWithDefault(d),d}}.call(this),function(){"use strict";var a=Adagio.Utils.typeUtils,b=Adagio.Utils.attributesUtils,c=Adagio.Utils.durationUtils,d=Adagio.Utils.staffDetailsUtils;Adagio.Utils.measure.measureUtils_attrs=function(e){e.getAllRawAttributes=function(b){return a.isArray(b.attributes)?b.attributes:void 0===b.attributes?[]:[b.attributes]},e.clearRawAttributes=function(a){delete a.attributes},e.hasOwnNbStaves=function(a){if(!e.hasOwnAttributes(a))return!1;var c=e.getOwnAttributes(a);return b.hasNbStaves(c)},e.getOwnNbStaves=function(a){if(e.hasOwnNbStaves(a)){var c=e.getOwnAttributes(a);return b.getNbStaves(c)}return b.DEFAULT_NB_STAVES},e.setOwnNbStaves=function(a,c){e.setNbStaves(a,c);var d=e.getOwnAttributes(a);b.setNbStaves(d,c),e.setOwnAttributes(a,d)},e.getNbStaves=function(a){var c=e.getAttributes(a);return b.getNbStaves(c)},e.setNbStaves=function(a,c){var d=e.getAttributes(a);b.setNbStaves(d,c)},e.getWrappedOwnStaffDetails=function(a){var c=e.getNbStaves(a),d=e.getOwnAttributes(a);return b.getWrappedStaffDetails(d,c)},e.getWrappedOwnStaffDetailsOrDefault=function(a){var c=e.getNbStaves(a),d=e.getOwnAttributes(a);return b.getWrappedStaffDetailsOrDefault(d,c)},e.setOwnStaffDetails=function(a,c){var d=e.getOwnAttributes(a);b.setStaffDetails(d,c),e.setOwnAttributes(a,d)},e.getWrappedStaffDetailsOrDefault=function(a){var c=e.getNbStaves(a),d=e.getAttributes(a);return b.getWrappedStaffDetailsOrDefault(d,c)},e.getWrappedStaffDetails=function(a){var c=e.getAttributes(a);return b.getWrappedStaffDetails(c)},e.getStaffDetails=function(a){var c=e.getAttributes(a);return b.getStaffDetails(c)},e.setStaffDetails=function(a,c){var d=e.getAttributes(a);b.setStaffDetails(d,c)},e.getNbDivisions=function(a){var b=e.getQuarterDuration(a),d=e.getDpq(a);return c.quarterToDivisions(b,d)},e.getQuarterDuration=function(a){var b=e.getAnyTime(a);return c.timeToQuarter(b)},e.getDivisions=function(a){return e.getDivisionsPerQuarter(a)},e.getDpq=function(a){return e.getDivisionsPerQuarter(a)},e.getDivisionsPerQuarter=function(a){var c=e.getAttributes(a);return b.getDivisions(c)},e.hasOwnDivisions=function(a){var c=e.getOwnAttributes(a);return b.hasDivisions(c)},e.getOwnDivisions=function(a){var c=e.getOwnAttributes(a);return b.getDivisions(c)},e.hasOwnTime=function(a){var c=e.getOwnAttributes(a);return b.hasTime(c)},e.getWrappedOwnTime=function(a){var c=e.getNbStaves(a),d=e.getOwnAttributes(a);return b.getWrappedTime(d,c)},
e.setOwnTime=function(a,c){var d=e.getOwnAttributes(a);b.setTime(d,c),e.setOwnAttributes(a,d)},e.getAnyOwnTime=function(a){var c=e.getOwnAttributes(a);return b.getAnyTime(c)},e.getAnyTime=function(a){var c=e.getAttributes(a);return b.getAnyTime(c)},e.getWrappedTime=function(a){var c=e.getAttributes(a);return b.getWrappedTime(c)},e.setTime=function(a,c){var d=e.getAttributes(a);b.setTime(d,c)},e.getWrappedOwnClef=function(a){var c=e.getNbStaves(a),d=e.getOwnAttributes(a);return b.getWrappedClef(d,c)},e.setOwnClef=function(a,c){var d=e.getOwnAttributes(a);b.setClef(d,c),e.setOwnAttributes(a,d)},e.getWrappedClef=function(a){var c=e.getAttributes(a);return b.getWrappedClef(c)},e.getClef=function(a){var c=e.getAttributes(a);return b.getClef(c)},e.setClef=function(a,c){var d=e.getAttributes(a);b.setClef(d,c)},e.getWrappedOwnKey=function(a){var c=e.getNbStaves(a),d=e.getOwnAttributes(a);return b.getWrappedKey(d,c)},e.setOwnKey=function(a,c){var d=e.getOwnAttributes(a);b.setKey(d,c),e.setOwnAttributes(a,d)},e.getWrappedKey=function(a){var c=e.getAttributes(a);return b.getWrappedKey(c)},e.setKey=function(a,c){var d=e.getAttributes(a);b.setKey(d,c)},e.getWrappedOwnTranspose=function(a){var c=e.getNbStaves(a),d=e.getOwnAttributes(a);return b.getWrappedTranspose(d,c)},e.getWrappedOwnTransposeOrDefault=function(a){var c=e.getNbStaves(a),d=e.getOwnAttributes(a);return b.getWrappedTransposeOrDefault(d,c)},e.setOwnTranspose=function(a,c){var d=e.getOwnAttributes(a);b.setTranspose(d,c),e.setOwnAttributes(a,d)},e.getWrappedTranspose=function(a){var c=e.getAttributes(a);return b.getWrappedTranspose(c)},e.setTranspose=function(a,c){var d=e.getAttributes(a);b.setTranspose(d,c)},e.getTranspose=function(a){var c=e.getAttributes(a);return b.getTranspose(c)},e.hasOwnAttributes=function(a){return void 0!==a.attributes},e.getOwnAttributes=function(b){return e.hasOwnAttributes(b)?a.isArray(b.attributes)?b.attributes[0]:b.attributes:{}},e.setOwnAttributes=function(a,c){b.isEmpty(c)?delete a.attributes:(b.markOwn(c),a.attributes=[c])},e.hasAttributes=function(a){return void 0!==a.$adagio&&void 0!==a.$adagio.attributes},e.getAttributes=function(a){return a.$adagio.attributes},e.setAttributes=function(a,b){e.create$adagioIfNeeded(a),a.$adagio.attributes=b},e.isTab=function(a){var b=e.getStaffDetails(a);return d.hasStaffTuning(b[0])}}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadTempoError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadTempoError",this.stack=e.stack,this.message=e.message,this.tempo=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"The tempo value ["+a+"] is not valid. The tempo should be a positive non null integer"}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadSwingRatioError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadSwingRatioError",this.stack=e.stack,this.message=e.message,this.ratio=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"The swing ratio value "+a+" is invalid. "}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Error.value.BadSwingRatioError,c=Adagio.Utils.math,d=Adagio.Values.SwingRatio={};d.assert=function(a){d.isValid(a)||d.raiseError(a)},d.raiseError=function(b){throw new a("BadSwingRatio","The swing ratio ["+b+"] is invalid.")},d.check=function(a){if(!d.isValid(a))throw new b(a)},d.isValid=function(a){return c.isNumber(a)&&a>=0&&a<=100}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Values.SwingRatio,c=Adagio.Utils.swingUtils={};c.check=function(a){if(c.isSwinging(a)){var d=c.getRatio(a);b.check(d)}},c.createDefault=function(){return c.createNoSwing()},c.createNoSwing=function(){return{swing:!1}},c.createSwing=function(a){return b.assert(a),{swing:!0,ratio:a}},c.isSame=function(a,b){if(c.isSwinging(a)!==c.isSwinging(b))return!1;if(c.isSwinging(a)&&c.isSwinging(b)){return c.getRatio(a)===c.getRatio(b)}return!0},c.isSwinging=function(a){return a.swing},c.getRatio=function(b){if(c.isSwinging(b))return parseInt(b.ratio);throw new a("NoSwing","Cannot retrieve a ratio when there is no swing.")},c.isSame=function(a,b){var d=c.isSwinging(a);if(d!==c.isSwinging(b))return!1;if(!0===d){return c.getRatio(a)===c.getRatio(b)}return!0},c.copy=function(a){if(c.isSwinging(a)){var b=c.getRatio(a);return c.createSwing(b)}return c.createNoSwing()}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadSoundTypeError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadSoundTypeError",this.stack=e.stack,this.message=e.message,this.type=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"The sound type ["+a+"] is invalid."}}.call(this),function(){"use strict";var a=Adagio.Error.value.BadSoundTypeError,b=Adagio.Values.SoundType={SEGNO:"segno",CODA:"coda",DALSEGNO:"dalsegno",DACAPO:"dacapo",FINE:"fine",TOCODA:"tocoda"};b.values=[b.SEGNO,b.DALSEGNO,b.CODA,b.DACAPO,b.FINE,b.TOCODA],b.tagValues=[b.SEGNO,b.CODA],b.callValues=[b.DALSEGNO,b.DACAPO,b.FINE,b.TOCODA],b.isValid=function(a){return b.values.includes(a)},b.isTagValid=function(a){return b.tagValues.includes(a)},b.isCallValid=function(a){return b.callValues.includes(a)},b.check=function(c){if(!b.isValid(c))throw new a(c)},b.tagCheck=function(c){if(!b.isTagValid(c))throw new a(c)},b.callCheck=function(c){if(!b.isCallValid(c))throw new a(c)}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadPizzicatoTypeError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadPizzicatoTypeError",this.stack=e.stack,this.message=e.message,this.type=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"The pizzicato type ["+a+"] is invalid."}}.call(this),function(){"use strict";var a=Adagio.Utils.mapUtils,b=Adagio.Error.value.BadPizzicatoTypeError,c=Adagio.Values.PizzicatoType={PIZZICATO:"yes",ARCO:"no"};c.values=[c.PIZZICATO,c.ARCO];var d=a.fromPairs([{key:c.PIZZICATO,value:"pizz."},{key:c.ARCO,value:"arco"}]);c.check=function(a){if(!c.isValid(a))throw new b(a)},c.isValid=function(a){return c.values.includes(a)},c.getText=function(a){return d[a]}}.call(this),function(){"use strict";var a=Adagio.Error.value.BadTempoError,b=Adagio.Utils.math,c=Adagio.Utils.typeUtils,d=Adagio.Utils.swingUtils,e=Adagio.Values.SoundType,f=Adagio.Values.PizzicatoType,g=Adagio.Utils.soundUtils={};g.DEFAULT_TEMPO=80,g.MAX_DYNAMIC=140,g.getTempoOrDefault=function(a){return g.hasTempo(a)?g.getTempo(a):g.DEFAULT_TEMPO},g.hasTempo=function(a){return void 0!==a.$tempo},g.setTempo=function(a,b){a.$tempo=b.toString()},g.getTempo=function(a){return parseFloat(a.$tempo)},g.removeTempo=function(a){delete a.$tempo},g.getSwingOrDefault=function(a){return g.hasSwing(a)?g.getSwing(a):d.createDefault()},g.hasSwing=function(a){return void 0!==a["$adagio-swing"]},g.setSwing=function(a,b){a["$adagio-swing"]=b},g.getSwing=function(a){return a["$adagio-swing"]},g.removeSwing=function(a){delete a["$adagio-swing"]},g.setDynamic=function(a,b){a.$dynamics=b.toString()},g.getDynamic=function(a){return parseFloat(a.$dynamics)},g.hasDynamic=function(a){return void 0!==a.$dynamics},g.isValidDynamic=function(a){return"number"==typeof a&&a>=0&&a<=g.MAX_DYNAMIC},g.checkTempo=function(b){if(!g.isValidTempo(b))throw new a(b)},g.isValidTempo=function(a){return b.isInteger(a)&&a>0},g.removeTempo=function(a){delete a.$tempo},g.isNotEmpty=function(a){return!g.isEmpty(a)},g.isEmpty=function(a){return c.isObjectEmpty(a)},g.hasSegno=function(a){return void 0!==a.$segno},g.createSegno=function(a){a.$segno=e.SEGNO},g.deleteSegno=function(a){delete a.$segno},g.hasCoda=function(a){return void 0!==a.$coda},g.createCoda=function(a){a.$coda=e.CODA},g.deleteCoda=function(a){delete a.$coda},g.hasDalsegno=function(a){return void 0!==a.$dalsegno},g.createDalsegno=function(a){a.$dalsegno=e.SEGNO},g.deleteDalsegno=function(a){delete a.$dalsegno},g.hasDacapo=function(a){return void 0!==a.$dacapo},g.createDacapo=function(a){a.$dacapo="yes"},g.deleteDacapo=function(a){delete a.$dacapo},g.hasFine=function(a){return void 0!==a.$fine},g.createFine=function(a){a.$fine="yes"},g.deleteFine=function(a){delete a.$fine},g.hasToCoda=function(a){return void 0!==a.$tocoda},g.createToCoda=function(a){a.$tocoda=e.CODA},g.deleteToCoda=function(a){delete a.$tocoda},g.hasPizzicato=function(a){return void 0!==a.$pizzicato},g.hasValidPizzicato=function(a){var b=g.getPizzicato(a);return f.isValid(b)},g.getPizzicato=function(a){return a.$pizzicato},g.setPizzicato=function(a,b){a.$pizzicato=b}}.call(this),function(){"use strict";var a=Adagio.Utils.typeUtils,b=Adagio.Utils.soundUtils;Adagio.Utils.measure.measureUtils_sound=function(c){c.hasOwnTempo=function(a){if(!c.hasOwnSound(a))return!1;var d=c.getOwnSound(a);return b.hasTempo(d)},c.getOwnTempo=function(a){var d=c.getOwnSound(a);return b.getTempo(d)},c.setOwnTempo=function(a,d){c.createOwnSoundIfNeeded(a);var e=c.getOwnSound(a);b.setTempo(e,d),c.setTempo(a,d)},c.hasTempo=function(a){if(!c.hasSound(a))return!1;var d=c.getSound(a);return b.hasTempo(d)},c.removeOwnTempo=function(a){var d=c.getOwnSound(a);b.removeTempo(d),c.removeOwnSoundIfEmpty(a)},c.getTempoOrDefault=function(a){var d=c.getSound(a);return b.getTempoOrDefault(d)},c.getTempo=function(a){var d=c.getSound(a);return b.getTempo(d)},c.setTempo=function(a,d){var e=c.getSound(a);b.setTempo(e,d)},c.removeTempo=function(a){var d=c.getSound(a);b.removeTempo(d)},c.createOwnSoundIfNeeded=function(a){c.hasOwnSound(a)||c.createOwnSound(a)},c.hasOwnSound=function(a){return void 0!==a.sound},c.createOwnSound=function(a){a.sound={}},c.removeOwnSoundIfEmpty=function(b){var d=c.getOwnSound(b);a.isObjectEmpty(d)&&c.removeOwnSound(b)},c.getOwnSound=function(a){return a.sound},c.removeOwnSound=function(a){delete a.sound},c.hasSound=function(a){return c.has$adagio(a)&&void 0!==a.$adagio.sound},c.createSound=function(){c.$adagio.sound={}},c.getSound=function(a){return a.$adagio.sound},c.setSound=function(a,b){a.$adagio.sound=b}}}.call(this),function(){"use strict";var a=Adagio.Utils.repeatUtils={};a.DIRECTION_FORWARD="forward",a.DIRECTION_BACKWARD="backward",a.isValidDirection=function(b){return b===a.DIRECTION_BACKWARD||b===a.DIRECTION_FORWARD},a.isForward=function(b){return a.getDirection(b)===a.DIRECTION_FORWARD},a.isBackward=function(b){return a.getDirection(b)===a.DIRECTION_BACKWARD},a.getDirection=function(a){return a.$direction},a.createRepeat=function(a,b){return a.repeat={$direction:b,$times:1,$winged:"none"},a}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadEndingNumberError=function(b){var d=c(),e=a.call(this,d);return this.name=e.name="BadEndingNumberError",this.stack=e.stack,this.message=e.message,this.numbers=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(){return"Ending numbers must be an array of strictly positive integers."}}.call(this),function(){"use strict";var a=Adagio.Error.value.BadEndingNumberError,b=Adagio.Utils.mxlUtils,c=Adagio.Utils.math,d=Adagio.Utils.endingUtils={};d.getType=function(a){return a.$type},d.create=function(a,b){return{$number:d.numbersToRaw(b),$type:a}},d.getValue=function(a){return b.stringOrContent(a)},d.getNumbers=function(a){var b=d.getRawNumbers(a);return d.parseRaw(b)},d.setRawNumbers=function(a,b){a.$number=b},d.getRawNumbers=function(a){return a.$number},d.checkNumbers=function(b){if(1!==b.length)throw new a(b);b.forEach(function(d){if(!c.isInteger(d)||d<=0)throw new a(b)})},d.parseRaw=function(a){var b=a.split(",");return b=b.map(e),b.map(c.intPart)};var e=function(a){return a.trim()};d.numbersToRaw=function(a){return a.map(f).join(", ")},d.numbersToText=function(a){var b=a.map(f);return b=b.map(g),b.join(", ")};var f=function(a){return a.toString()},g=function(a){return a+"."}}.call(this),function(){"use strict";var a=Adagio.Utils.repeatUtils,b=Adagio.Utils.endingUtils,c=Adagio.Utils.barlineUtils={};c.validStyle=["regular","dotted","dashed","heavy","light-light","light-heavy","heavy-light","heavy-heavy","tick","none"],c.validSingleStyles=["regular","dotted","dashed","heavy","light","tick","none"],c.supportedSingleStyles=["regular","heavy","light","tick"],c.supportedDoubleStyles=["light-light","light-heavy","heavy-light","heavy-heavy"],c.validLocation=["left","right","middle"],c.RIGHT="right",c.LEFT="left",c.DEFAULT_LOCATION=c.RIGHT,c.DEFAULT_STYLE="regular",c.POS_FIRST="first",c.POS_SECOND="second",c.BACKWARD="light-heavy",c.FORWARD="heavy-light",c.DOUBLE_LIGHT="light-light",c.FINAL="light-heavy",c.isValidStyle=function(a){return c.validStyle.indexOf(a)>=0},c.isSupportedStyle=function(a){return c.supportedSingleStyles.includes(a)||c.supportedDoubleStyles.includes(a)},c.isValidLocation=function(a){return c.validLocation.indexOf(a)>=0},c.getLocation=function(a){return c.hasLocation(a)?a.$location:c.DEFAULT_LOCATION},c.hasLocation=function(a){return void 0!==a.$location},c.isSpecific=function(a){return c.getStyle(a)!==c.DEFAULT_STYLE},c.getStyle=function(a){return c.hasStyle(a)?a["bar-style"]:c.DEFAULT_STYLE},c.hasStyle=function(a){return void 0!==a["bar-style"]},c.setStyle=function(a,b){a["bar-style"]=b},c.createDefaultBarline=function(){var a=c.DEFAULT_LOCATION,b=c.DEFAULT_STYLE;return c.createBarline(a,b)},c.createBackwardRepeat=function(){var b=c.RIGHT,d=c.BACKWARD,e=c.createBarline(b,d);return a.createRepeat(e,a.DIRECTION_BACKWARD)},c.createForwardRepeat=function(){var b=c.LEFT,d=c.FORWARD,e=c.createBarline(b,d);return a.createRepeat(e,a.DIRECTION_FORWARD)},c.createFinalBarline=function(){var a=c.RIGHT;return c.createBarline(a,"light-heavy")},c.create=function(a,b){return c.createBarline(a,b)},c.createBarline=function(a,b){return{$location:a,"bar-style":b}},c.isRight=function(a){return c.getLocation(a)===c.RIGHT},c.isLeft=function(a){return c.getLocation(a)===c.LEFT},c.hasRepeatForward=function(b){if(c.hasRepeat(b)){var d=c.getRepeat(b);return a.isForward(d)}return!1},c.hasRepeatBackward=function(b){if(c.hasRepeat(b)){var d=c.getRepeat(b);return a.isBackward(d)}return!1},c.hasRepeat=function(a){return void 0!==a.repeat},c.getRepeat=function(a){return a.repeat},c.hasEnding=function(a){return void 0!==a.ending},c.removeEnding=function(a){delete a.ending},c.getEndingNumbers=function(a){var d=c.getEnding(a);return b.getNumbers(d)},c.getEnding=function(a){return a.ending},c.setEnding=function(a,b){a.ending=b}}.call(this),function(){"use strict";Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{enumerable:!1,configurable:!0,writable:!0,value:function(a){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof a)throw new TypeError("predicate must be a function");for(var b,c=Object(this),d=c.length>>>0,e=arguments[1],f=0;f<d;f++)if(f in c&&(b=c[f],a.call(e,b,f,c)))return f;return-1}})}.call(this),function(){"use strict";var a=Adagio.Utils.barlineUtils,b=Adagio.Utils.barlinesUtils={};b.hasLeftEnding=function(c){if(b.hasLeft(c)){var d=b.getLeft(c);return a.hasEnding(d)}return!1},b.getLeftEndingNumbers=function(c){var d=b.getLeft(c);return a.getEndingNumbers(d)},b.getLeftEnding=function(c){var d=b.getLeft(c);return a.getEnding(d)},b.hasRightEnding=function(c){if(b.hasRight(c)){var d=b.getRight(c);return a.hasEnding(d)}return!1},b.getRightEndingNumbers=function(c){var d=b.getRight(c);return a.getEndingNumbers(d)},b.getRightEnding=function(c){var d=b.getRight(c);return a.getEnding(d)},b.addBarline=function(a,b){a.push(b)},b.hasRightSpecific=function(c){if(b.hasRight(c)){var d=b.getRight(c);return a.isSpecific(d)}return!1},b.hasRight=function(b){return b.some(a.isRight)},b.getRight=function(b){return b.find(a.isRight)},b.hasRepeatBackward=function(b){return b.some(a.hasRepeatBackward)},b.hasRepeatForward=function(b){return b.some(a.hasRepeatForward)},b.hasLeft=function(b){return b.some(a.isLeft)},b.getLeft=function(b){return b.find(a.isLeft)},b.removeRight=function(b){for(var c=b.findIndex(a.isRight);-1!==c;)b.splice(c,1),c=b.findIndex(a.isRight)},b.removeLeft=function(b){for(var c=b.findIndex(a.isLeft);-1!==c;)b.splice(c,1),c=b.findIndex(a.isLeft)},b.getRightStyle=function(c){var d=b.getRight(c);return a.getStyle(d)},b.getLeftStyle=function(c){var d=b.getLeft(c);return a.getStyle(d)}}.call(this),function(){"use strict";var a=Adagio.Utils.typeUtils,b=Adagio.Utils.barlinesUtils,c=Adagio.Utils.barlineUtils;Adagio.Utils.measure.measureUtils_barlines=function(d){d.hasLeftEnding=function(a){var c=d.getBarlines(a);return b.hasLeftEnding(c)},d.getLeftEndingNumbers=function(a){var c=d.getBarlines(a);return b.getLeftEndingNumbers(c)},d.getLeftEnding=function(a){var c=d.getBarlines(a);return b.getLeftEnding(c)},d.hasRightEnding=function(a){var c=d.getBarlines(a);return b.hasRightEnding(c)},d.getRightEndingNumbers=function(a){var c=d.getBarlines(a);return b.getRightEndingNumbers(c)},d.getRightEnding=function(a){var c=d.getBarlines(a);return b.getRightEnding(c)},d.hasRepeatBackward=function(a){var c=d.getBarlines(a);return b.hasRepeatBackward(c)},d.hasRepeatForward=function(a){var c=d.getBarlines(a);return b.hasRepeatForward(c)},d.hasLeftBarline=function(a){var c=d.getBarlines(a);return b.hasLeft(c)},d.getLeftBarlineStyle=function(a){var c=d.getBarlines(a);return b.getLeftStyle(c)},d.getLeftBarline=function(a){var c=d.getBarlines(a);return b.getLeft(c)},d.removeLeftBarline=function(a){var c=d.getBarlines(a);b.removeLeft(c),d.setBarlines(a,c)},d.hasRightSpecificBarline=function(a){var c=d.getBarlines(a);return b.hasRightSpecific(c)},d.hasRightBarline=function(a){var c=d.getBarlines(a);return b.hasRight(c)},d.getRightBarlineStyle=function(a){var c=d.getBarlines(a);return b.getRightStyle(c)},d.getRightBarline=function(a){var c=d.getBarlines(a);return b.getRight(c)},d.removeRightBarline=function(a){var c=d.getBarlines(a);b.removeRight(c),d.setBarlines(a,c)},d.hasFinalBarline=function(a){return!!d.hasRightBarline(a)&&("light-heavy"===d.getRightBarlineStyle(a)&&!d.hasRepeatBackward(a))},d.addFinalBarlines=function(a){var e=d.getBarlines(a),f=c.createBarline("right","light-heavy");b.addBarline(e,f),d.setBarlines(a,e)},d.hasBarlines=function(a){return void 0!==a.barline},d.getBarlines=function(b){return d.hasBarlines(b)?a.isArray(b.barline)?b.barline:[b.barline]:[]},d.addBarline=function(a,c){var e=d.getBarlines(a);b.addBarline(e,c),d.setBarlines(a,e)},d.setBarlines=function(a,b){0===b.length?delete a.barline:1===b.length?a.barline=b[0]:a.barline=b}}}.call(this),function(){"use strict";var a=Adagio.Utils.typeUtils;Adagio.Utils.measure.measureUtils_staffSides=function(b){b.hasLeftStaff=function(a,c){if(b.hasLeftStaffMap(a)){return void 0!==b.getLeftStaffMap(a)[c]}return!1},b.getLeftStaff=function(a,c){var d=b.getLeftStaffMap(a);return void 0!==d[c]?d[c]:{}},b.setLeftStaff=function(c,d,e){var f=b.getLeftStaffMap(c);a.isObjectEmpty(e)?delete f[d]:f[d]=e,b.setLeftStaffMap(c,f)},b.getLeftStaffMap=function(a){return b.hasLeftStaffMap(a)?a.$adagio.leftStaffMap:{}},b.hasLeftStaffMap=function(a){return!!b.has$adagio(a)&&void 0!==a.$adagio.leftStaffMap},b.setLeftStaffMap=function(a,c){b.create$adagioIfNeeded(a),a.$adagio.leftStaffMap=c},b.hasRightStaff=function(a,c){if(b.hasRightStaffMap(a)){return void 0!==b.getRightStaffMap(a)[c]}return!1},b.getRightStaff=function(a,c){var d=b.getRightStaffMap(a);return void 0!==d[c]?d[c]:{}},b.setRightStaff=function(c,d,e){var f=b.getRightStaffMap(c);a.isObjectEmpty(e)?delete f[d]:f[d]=e,b.setRightStaffMap(c,f)},b.getRightStaffMap=function(a){return b.hasRightStaffMap(a)?a.$adagio.rightStaffMap:{}},b.hasRightStaffMap=function(a){return!!b.has$adagio(a)&&void 0!==a.$adagio.rightStaffMap},b.setRightStaffMap=function(a,c){b.create$adagioIfNeeded(a),a.$adagio.rightStaffMap=c}}}.call(this),function(){"use strict";Adagio.Values.DirectionType={DYNAMIC:"dynamic",WEDGE:"wedge",SEGNO:"segno",CODA:"coda",WORDS:"words",PEDAL:"pedal",OCTAVE_SHIFT:"octave-shift",TEMPO_CHANGE:"$adagio-tempoChange",REHEARSAL:"rehearsal",METRONOME:"metronome",OTHER:"other"}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Values.DirectionType,c=Adagio.Utils.typeUtils,d=Adagio.Utils.mxlUtils,e=Adagio.Utils.directionTypeUtils={},f={dynamics:b.DYNAMIC,wedge:b.WEDGE,words:b.WORDS,segno:b.SEGNO,coda:b.CODA,pedal:b.PEDAL,"octave-shift":b.OCTAVE_SHIFT,"$adagio-tempoChange":b.TEMPO_CHANGE,rehearsal:b.REHEARSAL,metronome:b.METRONOME};e.getType=function(b){var c,d=Object.keys(b);if(0===d.length)throw c="a direction-type should have one value.",new a("Unexpected",c);return g(d[0])};var g=function(a){return void 0!==f[a]?f[a]:b.OTHER};e.createWord=function(a){var b={};return b.words=a,b},e.isValidWord=function(a){var b=d.getSingle(a,"words");return d.hasStringOrContent(b)},e.getWordText=function(a){var b=d.getSingle(a,"words");return d.stringOrContent(b)},e.createDynamic=function(a){var b={};return b.dynamics=a,b},e.getDynamic=function(b){if(c.isArray(b.dynamics))return b.dynamics[0];if(c.isObject(b.dynamics))return b.dynamics;throw new a("NotDynamic")},e.isDynamic=function(a){return e.getType(a)===b.DYNAMIC},e.isWord=function(a){return e.getType(a)===b.WORDS},e.createMetronome=function(a){var b={};return b.metronome=a,b},e.isMetronome=function(a){return e.getType(a)===b.METRONOME},e.getMetronome=function(d){if(c.isObject(d[b.METRONOME]))return d[b.METRONOME];throw new a("NotMetronome")},e.isWedge=function(a){return e.getType(a)===b.WEDGE},e.hasWedge=function(a){return void 0!==a.wedge},e.createWedge=function(a){var b={};return b.wedge=a,b},e.getWedge=function(b){if(c.isObject(b.wedge))return b.wedge;throw new a("NotWedge")},e.isPedal=function(a){return e.getType(a)===b.PEDAL},e.hasPedal=function(a){return void 0!==a.pedal},e.createPedal=function(a){var c={};return c[b.PEDAL]=a,c},e.getPedal=function(d){if(c.isObject(d[b.PEDAL]))return d[b.PEDAL];throw new a("NotPedal")},e.isRehearsal=function(a){return e.getType(a)===b.REHEARSAL},e.getRehearsal=function(a){var c=a[b.REHEARSAL];return c=d.getWrappedString(c)},e.createRehearsal=function(a){var c={};return c[b.REHEARSAL]=a,c},e.isSegno=function(a){return e.getType(a)===b.SEGNO},e.isOctaveShift=function(a){return e.getType(a)===b.OCTAVE_SHIFT},e.getOctaveShift=function(a){return e.hasOctaveShift(a)?a[b.OCTAVE_SHIFT]:{}},e.hasOctaveShift=function(a){return void 0!==a[b.OCTAVE_SHIFT]},e.createOctaveShift=function(a){var c={};return c[b.OCTAVE_SHIFT]=a,c},e.isTempoChange=function(a){return e.getType(a)===b.TEMPO_CHANGE},e.getTempoChange=function(a){return e.hasTempoChange(a)?a[b.TEMPO_CHANGE]:{}},e.hasTempoChange=function(a){return void 0!==a[b.TEMPO_CHANGE]},e.createTempoChange=function(a){var c={};return c[b.TEMPO_CHANGE]=a,c}}.call(this),function(){"use strict";String.prototype.startsWith||(String.prototype.startsWith=function(a,b){return b=b||0,this.lastIndexOf(a,b)===b})}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=["ppp","pp","p","mp","mf","f","ff","fff","sfz","rfz","pf","fp"],c={ppp:16,pp:33,p:49,mp:64,mf:84,f:90,ff:112,fff:126,sfz:112,rfz:112,fp:49,pf:90},d=Adagio.Utils.dynamicDisplayUtils={};d.isValidStyle=function(a){return b.includes(a)},d.getDefaultIntensityForStyle=function(b){if(void 0!==c[b])return c[b];throw new a("MissingDefault","There is no default intensities for the style ["+b+"].")},d.create=function(a){var b={};return b[a]={},b},d.getStyle=function(b){var c=Object.keys(b);c=c.filter(e);var d;if(c.length>1)throw d="There should be only one value for dynamic.",new a("MultipleValue",d);if(0===c.length)throw d="There should be one value for dynamic.",new a("NoValue",d);return c[0]};var e=function(a){return!a.startsWith("$")};d.copy=function(a){var b=d.getStyle(a);return d.create(b)}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadPedalTypeError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadPedalTypeError",this.stack=e.stack,this.message=e.message,this.type=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"The pedal type ["+a+"] is invalid."}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Error.value.BadPedalTypeError,c=Adagio.Values.PedalType={START:"start",STOP:"stop",CHANGE:"change",CONTINUE:"continue"};c.values=[c.START,c.STOP,c.CHANGE,c.CONTINUE],c.internalValues=[c.START,c.STOP],c.isValid=function(a){return c.values.includes(a)},c.isValidInternal=function(a){return c.internalValues.includes(a)},c.isStart=function(a){return a===c.START},c.isStop=function(a){return a===c.STOP},c.assert=function(b){if(!c.isValid(b)){throw new a("PedalType","Invalid value for pedal type: ["+b+"].")}},c.assertInternal=function(b){if(!c.isValidInternal(b)){throw new a("PedalType","Invalid internal value for pedal type: ["+b+"].")}},c.check=function(a){if(!c.isValid(a))throw new b(a)}}.call(this),function(){"use strict";var a=Adagio.Values.PedalType,b=Adagio.Utils.pedalDisplayUtils={};b.create=function(a){var c={$type:a,$line:"yes"};return b.check(c),c},b.check=function(c){var d=b.getType(c);a.check(d)},b.getType=function(a){return a.$type},b.copy=function(a){var c=b.getType(a);return b.create(c)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Values.OctaveShiftType={UP:"up",DOWN:"down",STOP:"stop",CONTINUE:"continue"};b.values=[b.UP,b.DOWN,b.STOP,b.CONTINUE],b.internalValues=[b.UP,b.DOWN],b.isStart=function(a){return a===b.UP||a===b.DOWN},b.isStop=function(a){return a===b.STOP},b.isValid=function(a){return b.values.includes(a)},b.isValidInternal=function(a){return b.internalValues.includes(a)},b.assert=function(c){if(!b.isValid(c)){throw new a("OctaveShiftType","Invalid value for octave shift type: ["+c+"].")}},b.assertInternal=function(c){if(!b.isValidInternal(c)){throw new a("OctaveShiftType","Invalid internal value for octave shift type: ["+c+"].")}}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadOctaveShiftSizeError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadOctaveShiftSizeError",this.stack=e.stack,this.message=e.message,this.size=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"The octave shift size ["+a+"] is invalid."}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Error.value.BadOctaveShiftSizeError,c=Adagio.Values.OctaveShiftSize={EIGHT:8,FIFTEEN:15,TWENTY_TWO:22};c.values=[c.EIGHT,c.FIFTEEN,c.TWENTY_TWO],c.isValid=function(a){return c.values.includes(a)},c.assert=function(b){if(!c.isValid(b)){throw new a("OctaveShiftSize","Invalid value for octave shift size: ["+b+"].")}},c.check=function(a){if(!c.isValid(a))throw new b(a)},c.sizeToOctaveShift=function(a){switch(c.check(a),a){case c.EIGHT:return 1;case c.FIFTEEN:return 2;case c.TWENTY_TWO:return 3}}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Values.OctaveShiftLocation={LEFT:"left",RIGHT:"right"};b.values=[b.LEFT,b.RIGHT],b.isValid=function(a){return b.values.includes(a)},b.assert=function(a){b.isValid(a)||b.raiseError(a)},b.isLeft=function(a){return a===b.LEFT},b.isRight=function(a){return a===b.RIGHT},b.raiseError=function(b){throw new a("BadOctaveShiftLocation","The octave shift location ["+b+"] is invalid.")}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadOctaveShiftNumberError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadOctaveShiftNumberError",this.stack=e.stack,this.message=e.message,this.number=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"The octave shift number ["+a+"] is invalid."}}.call(this),function(){"use strict";var a=(Adagio.Values.OctaveShiftType,Adagio.Values.OctaveShiftSize),b=(Adagio.Values.OctaveShiftLocation,Adagio.Error.value.BadOctaveShiftNumberError,Adagio.Utils.octaveShiftDisplayUtils={}),c=1,d=a.EIGHT;b.create=function(a,c,d,e){var f={$type:a};return b.setSize(f,c),b.setNumber(f,e),void 0!==d&&b.setLocation(f,d),f},b.getSize=function(a){return b.hasSize(a)?parseInt(a.$size,10):d},b.getType=function(a){return a.$type},b.getNumber=function(a){return b.hasNumber(a)?parseInt(a.$number,10):c},b.getLocation=function(a){if(b.has$adagio(a)){return b.get$adagio(a).location}},b.setSize=function(a,b){a.$size=void 0!==b?b+"":d},b.setNumber=function(a,b){a.$number=void 0!==b?b+"":c},b.setType=function(a,b){a.$type=b},b.setLocation=function(a,c){b.has$adagio(a)||b.create$adagio(a),b.get$adagio(a).location=c},b.get$adagio=function(a){return a.$adagio},b.create$adagio=function(a){a.$adagio={}},b.hasLocation=function(a){return b.has$adagio(a)&&void 0!==a.$adagio.location},b.has$adagio=function(a){return void 0!==a.$adagio},b.hasType=function(a){return void 0!==a.$type},b.hasSize=function(a){return void 0!==a.$size},b.hasNumber=function(a){return void 0!==a.$number},b.isNumberValid=function(a){return a>0}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadTempoChangeTypeError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadTempoChangeTypeError",this.stack=e.stack,this.message=e.message,this.type=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"The tempo change type ["+a+"] is invalid."}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Error.value.BadTempoChangeTypeError,c=Adagio.Values.TempoChangeType={RITARDANDO:"ritardando",ACCELERANDO:"accelerando",STOP:"stop",CONTINUE:"continue"};c.values=[c.RITARDANDO,c.ACCELERANDO,c.STOP,c.CONTINUE],c.internalValues=[c.RITARDANDO,c.ACCELERANDO,c.STOP],c.isValid=function(a){return c.values.includes(a)},c.isValidInternal=function(a){return c.internalValues.includes(a)},c.assert=function(b){if(!c.isValid(b)){throw new a("TempoChangeType","Invalid value for tempo change type: ["+b+"].")}},c.assertInternal=function(b){if(!c.isValidInternal(b)){throw new a("TempoChangeType","Invalid internal value for tempo change type: ["+b+"].")}},c.check=function(a){if(!c.isValid(a))throw new b(a)},c.isStart=function(a){return a===c.ACCELERANDO||a===c.RITARDANDO},c.isStop=function(a){return a===c.STOP}}.call(this),function(){"use strict";var a=Adagio.Values.TempoChangeType,b=Adagio.Utils.tempoChangeUtils={};b.create=function(a,c){var d={$type:a};return b.check(d),void 0!==c&&b.setLocation(d,c),d},b.check=function(c){var d=b.getType(c);a.check(d)},b.copy=function(a){var c=b.getType(a),d=b.getLocation(a);return b.create(c,d)},b.getType=function(a){return a.$type},b.setLocation=function(a,b){a.$location=b},b.getLocation=function(a){return a.$location},b.hasLocation=function(a){return void 0!==a.$location}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.typeUtils,c="yes",d=Adagio.Utils.offsetUtils={};d.isSound=function(d){if(!b.isObject(d))return!1;if("string"!=typeof d.$sound)return!1;var e=d.$sound;if(e===c)return!0;if("no"===e)return!1;throw new a("BadOffsetSound","Invalid value for offset.$sound: ["+e+"].")},d.create=function(a,b){return b?{content:a.toString(),$sound:c}:a.toString()}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Values.DirectionType,c=Adagio.Utils.directionTypeUtils,d=Adagio.Utils.dynamicDisplayUtils,e=Adagio.Utils.pedalDisplayUtils,f=Adagio.Utils.octaveShiftDisplayUtils,g=Adagio.Utils.tempoChangeUtils,h=Adagio.Utils.soundUtils,i=Adagio.Utils.typeUtils,j=Adagio.Utils.mxlUtils,k=Adagio.Utils.math,l=Adagio.Utils.offsetUtils,m=Adagio.Utils.directionUtils={};m.setStaffIdx=function(a,b){a.staff=(b+1).toString()},m.getStaffIdx=function(a){return void 0===a.staff?0:parseInt(a.staff,10)-1},m.hasDisplayDynamics=function(a){
return m.hasType(a,b.DYNAMIC)},m.hasWedge=function(a){return m.hasType(a,b.WEDGE)},m.hasMetronome=function(a){return m.hasType(a,b.METRONOME)},m.hasType=function(a,b){return m.getTypes(a).includes(b)},m.getTypes=function(a){return m.getEntries(a).map(c.getType)},m.getType=function(b){var c=m.getTypes(b);if(c.length>1)throw new a("DirectionNotSingle");if(0===c.length)throw new a("EmptyDirection");return c[0]},m.extractCanvas=function(a){var b=m.getTimePos(a),c=m.getStaffIdx(a),d=m.getPlacement(a),e={};return m.setTimePos(e,b),m.setStaffIdx(e,c),m.setPlacement(e,d),e},m.setPlacement=function(a,b){a.$placement=b},m.getPlacement=function(a){return a.$placement},m.hasPlacement=function(a){return void 0!==a.$placement},m.hasSoundDynamic=function(a){if(m.hasSound(a)){var b=m.getSound(a);return h.hasDynamic(b)}return!1},m.getSoundDynamic=function(a){var b=m.getSound(a);return h.getDynamic(b)},m.getSound=function(a){return m.hasSound(a)?a.sound:{}},m.getMetronome=function(a){var b=m.getMetronomeEntry(a);return c.getMetronome(b)},m.getMetronomeEntry=function(a){return m.getEntries(a).find(c.isMetronome)},m.getWedges=function(a){return m.getEntries(a).filter(c.isWedge).map(c.getWedge)},m.getWedge=function(a){var b=m.getWedgeEntry(a);return c.getWedge(b)},m.getWedgeEntry=function(a){return m.getEntries(a).find(c.isWedge)},m.hasSound=function(a){return void 0!==a.sound},m.setSoundDynamic=function(a,b){var c=m.getSound(a);h.setDynamic(c,b),m.setSound(a,c)},m.setSound=function(a,b){i.isObjectEmpty(b)?delete a.sound:a.sound=b},m.getPosTime=function(a){return m.getTimePos(a)},m.getTimePos=function(b){if("number"!=typeof b.$adagio.timePos)throw new a("Unexpected");return b.$adagio.timePos},m.getDpq=function(a){return a.$adagio.dpq},m.setPosTime=function(a,b){m.setTimePos(a,b)},m.setTimePos=function(a,b){m.add$adagioIfNeeded(a),a.$adagio.timePos=b},m.setDpq=function(a,b){m.add$adagioIfNeeded(a),a.$adagio.dpq=b},m.add$adagioIfNeeded=function(a){m.has$adagio(a)||(a.$adagio={})},m.setEntry=function(a,b){m.setEntries(a,[b])},m.setEntries=function(a,b){j.setArray(a,"direction-type",b)},m.hasContent=function(a){return m.getEntries(a).length>0},m.getEntries=function(a){return void 0===a["direction-type"]?[]:i.isArray(a["direction-type"])?a["direction-type"]:i.isObject(a["direction-type"])?[a["direction-type"]]:[]},m.getDisplayDynamicStyle=function(a){var b=m.getDisplayDynamic(a);return d.getStyle(b)},m.getDisplayDynamic=function(a){var b=m.getDisplayDynamicEntry(a);return c.getDynamic(b)},m.getDisplayDynamicEntry=function(a){return m.getEntries(a).find(c.isDynamic)},m.hasValidWord=function(a){var b=m.getWordEntry(a);return void 0!==b&&c.isValidWord(b)},m.hasWord=function(a){return m.getEntries(a).some(c.isWord)},m.getWordText=function(a){var b=m.getWordEntry(a);return c.getWordText(b)},m.getWordEntry=function(a){return m.getEntries(a).find(c.isWord)},m.getDisplayOctaveShiftType=function(a){var b=m.getDisplayOctaveShift(a);return f.getType(b)},m.getDisplayOctaveShiftSize=function(a){var b=m.getDisplayOctaveShift(a);return f.getSize(b)},m.getDisplayOctaveShiftLocation=function(a){var b=m.getDisplayOctaveShift(a);return f.getLocation(b)},m.getDisplayOctaveShiftNumber=function(a){var b=m.getDisplayOctaveShift(a);return f.getNumber(b)},m.getDisplayOctaveShift=function(a){var b=m.getDisplayOctaveShiftEntry(a);return c.getOctaveShift(b)},m.getDisplayOctaveShiftEntry=function(a){return m.getEntries(a).find(c.isOctaveShift)},m.addEntry=function(a,b){var c=m.getEntries(a);c.push(b),m.setEntries(a,c)},m.setNoteBefore=function(a,b){a.noteBefore=b},m.getNoteBefore=function(a){return k.toInt(a.noteBefore)},m.isSameVerticalPos=function(a,b){return m.getStaffIdx(a)===m.getStaffIdx(b)&&m.getPlacement(a)===m.getPlacement(b)},m.remove$adagio=function(a){delete a.$adagio},m.has$adagio=function(a){return void 0!==a.$adagio},m.compareTimePos=function(a,b){return m.compareTimePosInc(a,b)},m.compareTimePosInc=function(a,b){return m.getTimePos(a)-m.getTimePos(b)},m.hasOffset=function(a){return void 0!==a.offset},m.getOffsetValue=function(a){var b=m.getOffset(a);if(j.hasStringOrContent(b)){var c=j.stringOrContent(b);return c=parseInt(c,10)}return 0},m.getOffset=function(a){return a.offset},m.setOffset=function(a,b){if(0===b)delete a.offset;else{a.offset=l.create(b,!0)}},m.hasSoundSegno=function(a){if(m.hasSound(a)){var b=m.getSound(a);return h.hasSegno(b)}return!1},m.hasTypeSegno=function(a){return m.hasType(a,b.SEGNO)},m.hasSegno=function(a){return m.hasTypeSegno(a)||m.hasSoundSegno(a)},m.hasSoundCoda=function(a){if(m.hasSound(a)){var b=m.getSound(a);return h.hasCoda(b)}return!1},m.hasTypeCoda=function(a){return m.hasType(a,b.CODA)},m.hasCoda=function(a){return m.hasTypeCoda(a)||m.hasSoundCoda(a)},m.hasSoundDalsegno=function(a){if(m.hasSound(a)){var b=m.getSound(a);return h.hasDalsegno(b)}return!1},m.hasDalsegno=function(a){return m.hasSoundDalsegno(a)},m.hasSoundDacapo=function(a){if(m.hasSound(a)){var b=m.getSound(a);return h.hasDacapo(b)}return!1},m.hasDacapo=function(a){return m.hasSoundDacapo(a)},m.hasSoundFine=function(a){if(m.hasSound(a)){var b=m.getSound(a);return h.hasFine(b)}return!1},m.hasFine=function(a){return m.hasSoundFine(a)},m.hasSoundToCoda=function(a){if(m.hasSound(a)){var b=m.getSound(a);return h.hasToCoda(b)}return!1},m.hasToCoda=function(a){return m.hasSoundToCoda(a)},m.hasPedal=function(a){return m.hasType(a,b.PEDAL)},m.getPedals=function(a){return m.getEntries(a).filter(c.isPedal).map(c.getPedal)},m.getPedalType=function(a){var b=m.getPedal(a);return e.getType(b)},m.getPedal=function(a){var b=m.getPedalEntry(a);return c.getPedal(b)},m.getPedalEntry=function(a){return m.getEntries(a).find(c.isPedal)},m.getPedalType=function(a){var b=m.getPedal(a);return e.getType(b)},m.hasTempoChange=function(a){return m.hasType(a,b.TEMPO_CHANGE)},m.getTempoChanges=function(a){return m.getEntries(a).filter(c.isTempoChange).map(c.getTempoChange)},m.getTempoChange=function(a){var b=m.getTempoChangeEntry(a);return c.getTempoChange(b)},m.getTempoChangeEntry=function(a){return m.getEntries(a).find(c.isTempoChange)},m.getTempoChangeType=function(a){var b=m.getTempoChange(a);return g.getType(b)},m.getTempoChangeLocation=function(a){var b=m.getTempoChange(a);return g.getLocation(b)}}.call(this),function(){"use strict";var a=Adagio.Utils.crossMeasureUtils={};a.hasWedge=function(a){return void 0!==a.wedge},a.getWedge=function(a){return a.wedge},a.setWedge=function(a,b){a.wedge=b},a.removeWedge=function(a){delete a.wedge},a.hasSlur=function(a){return void 0!==a.slur},a.getSlur=function(a){return a.slur},a.setSlur=function(a,b){a.slur=b},a.removeSlur=function(a){delete a.slur},a.hasPedal=function(a){return void 0!==a.pedal},a.getPedal=function(a){return a.pedal},a.setPedal=function(a,b){a.pedal=b},a.removePedal=function(a){delete a.pedal},a.hasOctaveShift=function(a){return void 0!==a.octaveShift},a.getOctaveShift=function(a){return a.octaveShift},a.setOctaveShift=function(a,b){a.octaveShift=b},a.removeOctaveShift=function(a){delete a.octaveShift}}.call(this),function(){"use strict";var a=Adagio.Utils.mxlUtils,b=Adagio.Utils.intraMeasureUtils={};b.hasDynamics=function(b){return a.hasArrayNotEmpty(b,"dynamics")},b.getDynamics=function(b){return a.getArray(b,"dynamics")},b.setDynamics=function(b,c){return a.setArrayStrict(b,"dynamics",c)},b.removeDynamics=function(a){delete a.dynamics},b.hasPizzicatos=function(b){return a.hasArrayNotEmpty(b,"pizzicatos")},b.getPizzicatos=function(b){return a.getArray(b,"pizzicatos")},b.setPizzicatos=function(b,c){return a.setArrayStrict(b,"pizzicatos",c)},b.removePizzicatos=function(a){delete a.pizzicatos},b.hasWords=function(b){return a.hasArrayNotEmpty(b,"words")},b.getWords=function(b){return a.getArray(b,"words")},b.setWords=function(b,c){return a.setArrayStrict(b,"words",c)},b.removeWords=function(a){delete a.words},b.hasPedals=function(b){return a.hasArrayNotEmpty(b,"pedals")},b.getPedals=function(b){return a.getArray(b,"pedals")},b.setPedals=function(b,c){return a.setArrayStrict(b,"pedals",c)},b.hasOctaveShifts=function(b){return a.hasArrayNotEmpty(b,"octaveShifts")},b.getOctaveShifts=function(b){return a.getArray(b,"octaveShifts")},b.setOctaveShifts=function(b,c){return a.setArrayStrict(b,"octaveShifts",c)},b.removeOctaveShifts=function(a){delete a.octaveShifts}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadRehearsalTypeError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadRehearsalTypeError",this.stack=e.stack,this.message=e.message,this.type=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"The rebearsal type ["+a+"] is invalid."}}.call(this),function(){"use strict";var a=Adagio.Error.value.BadRehearsalTypeError,b=Adagio.Error.InternalError,c=Adagio.Values.RehearsalType={AUTO:"auto",MEASURE_NUMBER:"measure-number"};c.DEFAULT=c.AUTO,c.values=[c.AUTO,c.MEASURE_NUMBER],c.raiseError=function(a){throw new b("BadRehearsalType","The rehearsal type value: ["+a+"] is invalid")},c.check=function(b){if(!c.isValid(b))throw new a(b)},c.isValid=function(a){return c.values.includes(a)}}.call(this),function(){"use strict";var a=Adagio.Values.RehearsalType,b=Adagio.Utils.rehearsalUtils={},c="$adagio-type";b.copy=function(a){var c=b.getText(a),d=b.getType(a);return b.create(c,d)},b.createWithDefaultType=function(c){return b.create(c,a.DEFAULT)},b.create=function(a,b){var d={content:a};return d[c]=b,d},b.isSame=function(a,c){var d=b.getText(a),e=b.getText(c);return b.getType(a)===b.getType(c)&&d===e},b.getText=function(a){return a.content},b.isAuto=function(c){return b.getType(c)===a.AUTO},b.isMeasureNumber=function(c){return b.getType(c)===a.MEASURE_NUMBER},b.getType=function(b){return void 0===b[c]?a.DEFAULT:b[c]}}.call(this),function(){"use strict";var a=Adagio.Utils.directionUtils,b=Adagio.Utils.directionTypeUtils,c=Adagio.Utils.rehearsalUtils,d=Adagio.Values.DirectionPlacement,e=Adagio.Utils.direction.rehearsalDirectionUtils={};e.create=function(e,f){var g={};a.setPlacement(g,d.ABOVE),a.setStaffIdx(g,0),a.setTimePos(g,0);var h=c.create(e,f),i=b.createRehearsal(h);return a.setEntry(g,i),g},e.getRehearsal=function(c){var d=a.getEntries(c),e=d.find(b.isRehearsal);return b.getRehearsal(e)},e.isInstanceOf=function(c){return a.getEntries(c).some(b.isRehearsal)}}.call(this),function(){"use strict";var a=Adagio.Utils.directionUtils,b=Adagio.Utils.directionTypeUtils,c=Adagio.Utils.tempoChangeUtils,d=Adagio.Utils.durationUtils,e=Adagio.Values.TempoChangeType,f=Adagio.Utils.direction.tempoChangeDirectionUtils={};f.create=function(d,e,f,g){if(arguments.length<3)throw new Error("DPQ missing");var h={};a.setTimePos(h,d),a.setDpq(h,e);var i=c.create(f,g),j=b.createTempoChange(i);return a.setEntry(h,j),h},f.compare=function(a,b){var c=f.getQuarterPos(a),d=f.getQuarterPos(b),e=c-d;if(0!==e)return e;var h=f.getType(a),i=f.getType(b);return g(h,i)};var g=function(a,b){return e.isStart(a)&&b===e.STOP?1:a===e.STOP&&e.isStart(b)?-1:0};f.isSame=function(a,b){return!!f.isSamePayload(a,b)&&f.getQuarterPos(a)===f.getQuarterPos(b)},f.isSamePayload=function(a,b){var c=f.getType(a),d=f.getType(b),e=f.getLocation(a),g=f.getLocation(b);return c===d&&e===g},f.getQuarterPos=function(a){var b=f.getTimePos(a),c=f.getDpq(a);return d.divisionsToQuarter(b,c)},f.getTimePos=function(b){return a.getTimePos(b)},f.getDpq=function(b){return a.getDpq(b)},f.getType=function(b){return a.getTempoChangeType(b)},f.isStart=function(a){var b=f.getType(a);return e.isStart(b)},f.isStop=function(a){var b=f.getType(a);return e.isStop(b)},f.getLocation=function(b){return a.getTempoChangeLocation(b)},f.isInstanceOf=function(b){return a.getEntries(b).some(h)};var h=function(a){if(!b.isTempoChange(a))return!1;var d=b.getTempoChange(a),f=c.getType(d);return e.isValidInternal(f)}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadNbDotsError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadNbDotsError",this.stack=e.stack,this.message=e.message,this.nbDots=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"the number of dots ["+a+"] is invalid."}}.call(this),function(){"use strict";var a=Adagio.Error.value.BadNbDotsError,b=Adagio.Error.value.BadDurationTypeError,c=Adagio.Utils.soundUtils,d=Adagio.Utils.math,e=Adagio.Utils.durationUtils,f=Adagio.Values.DurationType,g=Adagio.Utils.tempoUtils={};g.MIN_DURATION_TYPE=f.FULL,g.MAX_DURATION_TYPE=f.SIXTEENTH,g.DEFAULT_DURATION_TYPE=f.QUARTER,g.DEFAULT_NB_DOTS=0,g.createDefault=function(){var a=c.DEFAULT_TEMPO;return g.createWithDefaultDisplay(a)},g.createWithDefaultDisplay=function(a){return g.createWithNote(a,g.DEFAULT_DURATION_TYPE,g.DEFAULT_NB_DOTS)},g.copy=function(a){var b=g.getQpm(a),c=g.getDurationType(a),d=g.getNbDots(a),e=g.getBpm(a);return g.createWithNote(b,c,d,e)},g.createWithNote=function(a,b,c,d){return void 0===d&&(d=g.qpmToBpm(a,b,c)),{qpm:a,durationType:b,nbDots:c,bpm:d}},g.isSame=function(a,b){var c=g.getQpm(a),d=g.getQpm(b),e=g.getDurationType(a),f=g.getDurationType(b),h=g.getNbDots(a),i=g.getNbDots(b),j=g.getBpm(a),k=g.getBpm(b);return c===d&&e===f&&h===i&&j===k},g.check=function(a){var b=g.getQpm(a);c.checkTempo(b);var d=g.getBpm(a);c.checkTempo(d);var e=g.getNbDots(a);g.checkNbDots(e);var f=g.getDurationType(a);g.checkDurationType(f)},g.checkNbDots=function(b){if(!g.isValidNbDots(b))throw new a(b)},g.isValidNbDots=function(a){return d.isInteger(a)&&a>=0&&a<=1},g.checkDurationType=function(a){if(!g.isValidDurationType(a))throw new b(a)},g.isValidDurationType=function(a){return f.isValid(a)&&g.MIN_DURATION_TYPE<=a&&a<=g.MAX_DURATION_TYPE},g.qpmToBpm=function(a,b,c){var d={durationType:b,nbDots:c},f=e.durationOptsToQuarter(d),g=a/f;return Math.round(g)},g.bpmToQpm=function(a,b,c){var d={durationType:b,nbDots:c},f=e.durationOptsToQuarter(d),g=a*f;return g=Math.round(g)},g.getQpm=function(a){return a.qpm},g.getDurationType=function(a){return a.durationType},g.getNbDots=function(a){return a.nbDots},g.getBpm=function(a){return a.bpm}}.call(this),function(){"use strict";var a=Adagio.Values.DurationType,b=Adagio.Utils.tempoUtils,c=Adagio.Utils.soundUtils,d=Adagio.Utils.typeUtils,e=Adagio.Utils.mapUtils,f=Adagio.Utils.mxlUtils,g="beat-unit-dot",h="beat-unit",i="per-minute",j=Adagio.Utils.tempoMetronomeUtils={};j.create=function(b,c,d){var f=a.toMxl(c),g=e.fromPairs([{key:i,value:b.toString()},{key:h,value:f}]);return k(g,d),g};var k=function(a,b){1===b?a[g]={}:b>1&&(a[g]=l(b))},l=function(a){for(var b=[],c=0;c<a;c++)b.push({});return b};j.isValid=function(a){return!!j.hasValidNbDots(a)&&(!!j.hasValidDurationType(a)&&!!j.hasValidBpm(a))},j.hasValidNbDots=function(a){var c=j.getNbDots(a);return b.isValidNbDots(c)},j.getNbDots=function(a){return j.hasDot(a)?d.isArray(a[g])?a[g].length:1:0},j.hasDot=function(a){return void 0!==a[g]},j.hasValidDurationType=function(a){if(!j.hasDurationType(a))return!1;var c=j.getDurationType(a);return b.isValidDurationType(c)},j.getDurationType=function(b){var c=b[h];return c=f.stringOrContent(c),a.fromMxl(c)},j.hasDurationType=function(a){return void 0!==a[h]},j.hasValidBpm=function(a){if(!j.hasBpm(a))return!1;var b=j.getBpm(a);return c.isValidTempo(b)},j.getBpm=function(a){var b=a[i];return parseInt(b,10)},j.hasBpm=function(a){return void 0!==a[i]}}.call(this),function(){"use strict";var a=Adagio.Utils.directionUtils,b=Adagio.Utils.directionTypeUtils,c=Adagio.Utils.tempoMetronomeUtils,d=Adagio.Values.DirectionPlacement,e=Adagio.Utils.direction.tempoMetronomeDirectionUtils={};e.create=function(e,f,g){var h={};a.setPlacement(h,d.ABOVE),a.setStaffIdx(h,0),a.setTimePos(h,0);var i=c.create(e,f,g),j=b.createMetronome(i);return a.setEntry(h,j),h},e.isInstanceOf=function(b){if(!a.hasMetronome(b))return!1;var d=a.getMetronome(b);return!!c.isValid(d)},e.getMetronome=function(b){return a.getMetronome(b)}}.call(this),function(){"use strict";var a=Adagio.Values.DirectionType,b=Adagio.Utils.mxlUtils,c=Adagio.Utils.directionUtils,d=Adagio.Utils.crossMeasureUtils,e=Adagio.Utils.intraMeasureUtils,f=Adagio.Utils.direction.rehearsalDirectionUtils,g=Adagio.Utils.direction.tempoChangeDirectionUtils,h=Adagio.Utils.direction.tempoMetronomeDirectionUtils;Adagio.Utils.measure.measureUtils_directions=function(i){i.getPedalDirections=function(b){return i.getDirectionsWithType(b,a.PEDAL)},i.hasPedals=function(a,b){if(i.hasStaffContent(a,b)){var c=i.getStaffContent(a,b);return e.hasPedals(c)}return!1},i.getPedals=function(a,b){var c=i.getStaffContent(a,b);return e.getPedals(c)},i.setPedals=function(a,b,c){var d=i.getStaffContent(a,b);e.setPedals(d,c),i.setStaffContent(a,b,d)},i.hasLeftPedal=function(a,b){if(i.hasLeftStaff(a,b)){var c=i.getLeftStaff(a,b);return d.hasPedal(c)}return!1},i.getLeftPedal=function(a,b){var c=i.getLeftStaff(a,b);return d.getPedal(c)},i.setLeftPedal=function(a,b,c){var e=i.getLeftStaff(a,b);d.setPedal(e,c),i.setLeftStaff(a,b,e)},i.removeLeftPedal=function(a,b){var c=i.getLeftStaff(a,b);d.removePedal(c),i.setLeftStaff(a,b,c)},i.hasRightPedal=function(a,b){if(i.hasRightStaff(a,b)){var c=i.getRightStaff(a,b);return d.hasPedal(c)}return!1},i.getRightPedal=function(a,b){var c=i.getRightStaff(a,b);return d.getPedal(c)},i.setRightPedal=function(a,b,c){var e=i.getRightStaff(a,b);d.setPedal(e,c),i.setRightStaff(a,b,e)},i.removeRightPedal=function(a,b){var c=i.getRightStaff(a,b);d.removePedal(c),i.setRightStaff(a,b,c)},i.hasRightWedge=function(a,b){if(i.hasRightStaff(a,b)){var c=i.getRightStaff(a,b);return d.hasWedge(c)}return!1},i.getRightWedge=function(a,b){var c=i.getRightStaff(a,b);return d.getWedge(c)},i.setRightWedge=function(a,b,c){var e=i.getRightStaff(a,b);d.setWedge(e,c),i.setRightStaff(a,b,e)},i.removeRightWedge=function(a,b){var c=i.getRightStaff(a,b);d.removeWedge(c),i.setRightStaff(a,b,c)},i.getWedgeDirections=function(b){return i.getDirectionsWithType(b,a.WEDGE)},i.hasLeftWedge=function(a,b){if(i.hasLeftStaff(a,b)){var c=i.getLeftStaff(a,b);return d.hasWedge(c)}return!1},i.getLeftWedge=function(a,b){var c=i.getLeftStaff(a,b);return d.getWedge(c)},i.setLeftWedge=function(a,b,c){var e=i.getLeftStaff(a,b);d.setWedge(e,c),i.setLeftStaff(a,b,e)},i.removeLeftWedge=function(a,b){var c=i.getLeftStaff(a,b);d.removeWedge(c),i.setLeftStaff(a,b,c)},i.hasRightWedge=function(a,b){if(i.hasRightStaff(a,b)){var c=i.getRightStaff(a,b);return d.hasWedge(c)}return!1},i.getRightWedge=function(a,b){var c=i.getRightStaff(a,b);return d.getWedge(c)},i.setRightWedge=function(a,b,c){var e=i.getRightStaff(a,b);d.setWedge(e,c),i.setRightStaff(a,b,e)},i.removeRightWedge=function(a,b){var c=i.getRightStaff(a,b);d.removeWedge(c),i.setRightStaff(a,b,c)},i.hasPizzicatos=function(a,b){if(i.hasStaffContent(a,b)){var c=i.getStaffContent(a,b);return e.hasPizzicatos(c)}return!1},i.getPizzicatos=function(a,b){var c=i.getStaffContent(a,b);return e.getPizzicatos(c)},i.setPizzicatos=function(a,b,c){var d=i.getStaffContent(a,b);e.setPizzicatos(d,c),i.setStaffContent(a,b,d)},i.hasWords=function(a,b){if(i.hasStaffContent(a,b)){var c=i.getStaffContent(a,b);return e.hasWords(c)}return!1},i.getWords=function(a,b){var c=i.getStaffContent(a,b);return e.getWords(c)},i.setWords=function(a,b,c){var d=i.getStaffContent(a,b);e.setWords(d,c),i.setStaffContent(a,b,d)},i.hasDynamics=function(a,b){if(i.hasStaffContent(a,b)){var c=i.getStaffContent(a,b);return e.hasDynamics(c)}return!1},i.getDynamics=function(a,b){var c=i.getStaffContent(a,b);return e.getDynamics(c)},i.setDynamics=function(a,b,c){var d=i.getStaffContent(a,b);e.setDynamics(d,c),i.setStaffContent(a,b,d)},i.hasOctaveShifts=function(a,b){if(i.hasStaffContent(a,b)){var c=i.getStaffContent(a,b);return e.hasOctaveShifts(c)}return!1},i.getOctaveShifts=function(a,b){var c=i.getStaffContent(a,b);return e.getOctaveShifts(c)},i.setOctaveShifts=function(a,b,c){var d=i.getStaffContent(a,b);e.setOctaveShifts(d,c),i.setStaffContent(a,b,d)},i.hasLeftOctaveShift=function(a,b){if(i.hasLeftStaff(a,b)){var c=i.getLeftStaff(a,b);return d.hasOctaveShift(c)}return!1},i.getLeftOctaveShift=function(a,b){var c=i.getLeftStaff(a,b);return d.getOctaveShift(c)},i.setLeftOctaveShift=function(a,b,c){var e=i.getLeftStaff(a,b);d.setOctaveShift(e,c),i.setLeftStaff(a,b,e)},i.removeLeftOctaveShift=function(a,b){var c=i.getLeftStaff(a,b);d.removeOctaveShift(c),i.setLeftStaff(a,b,c)},i.hasRightOctaveShift=function(a,b){if(i.hasRightStaff(a,b)){var c=i.getRightStaff(a,b);return d.hasOctaveShift(c)}return!1},i.getRightOctaveShift=function(a,b){var c=i.getRightStaff(a,b);return d.getOctaveShift(c)},i.setRightOctaveShift=function(a,b,c){var e=i.getRightStaff(a,b);d.setOctaveShift(e,c),i.setRightStaff(a,b,e)},i.removeRightOctaveShift=function(a,b){var c=i.getRightStaff(a,b);d.removeOctaveShift(c),i.setRightStaff(a,b,c)},i.hasDirections=function(a){return b.hasArrayNotEmpty(a,"direction")},i.hasDirectionType=function(a,b){return i.getDirectionsWithType(a,b).length>0},i.getRawDirections=function(a){return b.getArray(a,"direction")},i.getAllDirections=function(a){for(var b=i.getWedgeDirections(a).slice(),c=i.getNbStaves(a),d=0;d<c;d++){var e=i.getDynamics(a,d);Array.prototype.push.apply(b,e);var f=i.getPizzicatos(a,d);Array.prototype.push.apply(b,f);var g=i.getWords(a,d);Array.prototype.push.apply(b,g);var h=i.getPedals(a,d);Array.prototype.push.apply(b,h);var j=i.getOctaveShifts(a,d);Array.prototype.push.apply(b,j)}var k=i.getCommonContentDirections(a);return Array.prototype.push.apply(b,k),b},i.getCommonContentDirections=function(a){var b=i.getRawDirections(a);return b=b.filter(j)};var j=function(a){return f.isInstanceOf(a)||g.isInstanceOf(a)||h.isInstanceOf(a)};i.getDirectionsWithType=function(a,b){return i.getRawDirections(a).filter(k,b)};var k=function(a){var b=this.valueOf();return c.hasType(a,b)};i.setDirections=function(a,b){0===b.length?delete a.direction:a.direction=b},i.addDirection=function(a,b){void 0===a.direction&&(a.direction=[]),a.direction.push(b)},i.eraseDirection=function(a,b){var c=a.direction.indexOf(b);a.direction.splice(c,1)}}}.call(this),function(){"use strict";var a=Adagio.Utils.typeUtils;Adagio.Utils.measure.measureUtils_voiceSides=function(b){b.hasLeftVoice=function(a,c){if(b.hasLeftVoiceMap(a)){return void 0!==b.getLeftVoiceMap(a)[c]}return!1},b.getLeftVoice=function(a,c){var d=b.getLeftVoiceMap(a);return void 0!==d[c]?d[c]:{}},b.setLeftVoice=function(c,d,e){var f=b.getLeftVoiceMap(c);a.isObjectEmpty(e)?delete f[d]:f[d]=e,b.setLeftVoiceMap(c,f)},b.getLeftVoiceMap=function(a){return b.hasLeftVoiceMap(a)?a.$adagio.leftVoiceMap:{}},b.hasLeftVoiceMap=function(a){return!!b.has$adagio(a)&&void 0!==a.$adagio.leftVoiceMap},b.setLeftVoiceMap=function(a,c){b.create$adagioIfNeeded(a),a.$adagio.leftVoiceMap=c},b.hasRightVoice=function(a,c){if(b.hasRightVoiceMap(a)){return void 0!==b.getRightVoiceMap(a)[c]}return!1},b.getRightVoice=function(a,c){var d=b.getRightVoiceMap(a);return void 0!==d[c]?d[c]:{}},b.setRightVoice=function(c,d,e){var f=b.getRightVoiceMap(c);a.isObjectEmpty(e)?delete f[d]:f[d]=e,b.setRightVoiceMap(c,f)},b.getRightVoiceMap=function(a){return b.hasRightVoiceMap(a)?a.$adagio.rightVoiceMap:{}},b.hasRightVoiceMap=function(a){return!!b.has$adagio(a)&&void 0!==a.$adagio.rightVoiceMap},b.setRightVoiceMap=function(a,c){b.create$adagioIfNeeded(a),a.$adagio.rightVoiceMap=c}}}.call(this),function(){"use strict";var a=Adagio.Utils.crossMeasureUtils;Adagio.Utils.measure.measureUtils_slurs=function(b){b.hasLeftSlur=function(c,d){if(b.hasLeftVoice(c,d)){var e=b.getLeftVoice(c,d);return a.hasSlur(e)}return!1},b.getLeftSlur=function(c,d){var e=b.getLeftVoice(c,d);return a.getSlur(e)},b.setLeftSlur=function(c,d,e){var f=b.getLeftVoice(c,d);a.setSlur(f,e),b.setLeftVoice(c,d,f)},b.removeLeftSlur=function(c,d){var e=b.getLeftVoice(c,d);a.removeSlur(e),b.setLeftVoice(c,d,e)},b.hasRightSlur=function(c,d){if(b.hasRightVoice(c,d)){var e=b.getRightVoice(c,d);return a.hasSlur(e)}return!1},b.getRightSlur=function(c,d){var e=b.getRightVoice(c,d);return a.getSlur(e)},b.setRightSlur=function(c,d,e){var f=b.getRightVoice(c,d);a.setSlur(f,e),b.setRightVoice(c,d,f)},b.removeRightSlur=function(c,d){var e=b.getRightVoice(c,d);a.removeSlur(e),b.setRightVoice(c,d,e)}}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadChordKindError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadChordKindError",this.stack=e.stack,this.message=e.message,this.chordKind=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"The chord kind value ["+a+"] is invalid."}}.call(this),function(){"use strict";var a=Adagio.Error.value.BadChordKindError,b=Adagio.Values.ChordKind={MAJOR:"major",MINOR:"minor",AUGMENTED:"augmented",DIMINISHED:"diminished",DOMINANT:"dominant",MAJOR_6:"major-sixth",MINOR_6:"minor-sixth",MAJOR_7:"major-seventh",MINOR_7:"minor-seventh",DIMINISHED_7:"diminished-seventh",AUGMENTED_7:"augmented-seventh",HALF_DIMINISHED:"half-diminished",MAJOR_MINOR:"major-minor",DOMINANT_9:"dominant-ninth",MAJOR_9:"major-ninth",MINOR_9:"minor-ninth",DOMINANT_11:"dominant-11th",MAJOR_11:"major-11th",MINOR_11:"minor-11th",DOMINANT_13:"dominant-13th",MAJOR_13:"major-13th",MINOR_13:"minor-13th",SUS_4:"suspended-fourth",SUS_2:"suspended-second"};b.values=[b.MAJOR,b.MINOR,b.AUGMENTED,b.DIMINISHED,b.DOMINANT,b.MAJOR_6,b.MINOR_6,b.MAJOR_7,b.MINOR_7,b.DIMINISHED_7,b.AUGMENTED_7,b.HALF_DIMINISHED,b.MAJOR_MINOR,b.DOMINANT_9,b.MAJOR_9,b.MINOR_9,b.DOMINANT_11,b.MAJOR_11,b.MINOR_11,b.DOMINANT_13,b.MAJOR_13,b.MINOR_13,b.SUS_2,b.SUS_4],b.check=function(c){if(!b.isSupported(c))throw new a(c)},b.isSupported=function(a){return b.isValid(a)},b.isValid=function(a){return b.values.includes(a)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Values.Placement={ABOVE:"above",BELOW:"below"};b.values=[b.ABOVE,b.BELOW],b.isValid=function(a){return b.values.includes(a)},b.raiseError=function(b){throw new a("BadPlacementError","Invalid value for placement: ["+b+"].")}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadRootStepError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadRootStepError",this.stack=e.stack,this.message=e.message,this.step=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"The root step value ["+a+"] is invalid. "}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadRootAlterError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadRootAlterError",this.stack=e.stack,this.message=e.message,this.alter=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"The root alter value ["+a+"] is invalid. It must be an integer between [-1 and 1]."}}.call(this),function(){"use strict";var a=Adagio.Error.value.BadRootStepError,b=Adagio.Error.value.BadRootAlterError,c=Adagio.Values.Step,d=Adagio.Utils.mxlUtils,e=Adagio.Utils.math,f=Adagio.Utils.pitchUtils,g=Adagio.Utils.rootUtils={},h=0;g.check=function(c){var d=g.getStep(c);if(!g.isValidStep(d))throw new a(c["root-step"]);var e=g.getAlter(c);if(!g.isValidAlter(e))throw new b(c["root-alter"])},g.isValidStep=function(a){return c.isValid(a)},g.isValidAlter=function(a){return e.isInteger(a)&&a>=-2&&a<=2},g.isSame=function(a,b){return g.getStep(a)===g.getStep(b)&&g.getAlter(a)===g.getAlter(b)},g.copy=function(a){var b=g.getStep(a),c=g.getAlter(a);return g.create(b,c)},g.transpose=function(a,b){var c=g.getStep(a),d=g.getAlter(a),e=4,h=f.create(e,c,d),i=f.transpose(h,b),j=f.getStep(i),k=f.getAlter(i);return g.create(j,k)},g.getStep=function(a){var b=a["root-step"];return d.stringOrContent(b)},g.getAlter=function(a){var b=a["root-alter"];return d.hasStringOrContent(b)?(b=d.stringOrContent(b),b=parseInt(b,10)):h},g.create=function(a,b){var c={"root-step":a};return b!==h&&void 0!==b&&(c["root-alter"]=b.toString()),c}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadBassStepError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadBassStepError",this.stack=e.stack,this.message=e.message,this.step=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"The bass step value ["+a+"] is invalid. "}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadBassAlterError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadBassAlterError",this.stack=e.stack,this.message=e.message,this.alter=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"The bass alter value ["+a+"] is invalid. It must be an integer between [-1 and 1]."}}.call(this),function(){"use strict";var a=Adagio.Error.value.BadBassStepError,b=Adagio.Error.value.BadBassAlterError,c=Adagio.Values.Step,d=Adagio.Utils.mxlUtils,e=Adagio.Utils.math,f=Adagio.Utils.pitchUtils,g=Adagio.Utils.bassUtils={},h=0;g.check=function(c){var d=g.getStep(c);if(!g.isValidStep(d))throw new a(c["bass-step"]);var e=g.getAlter(c);if(!g.isValidAlter(e))throw new b(c["bass-alter"])},g.isValidStep=function(a){return c.isValid(a)},g.isValidAlter=function(a){return e.isInteger(a)&&a>=-2&&a<=2},g.isSame=function(a,b){return g.getStep(a)===g.getStep(b)&&g.getAlter(a)===g.getAlter(b)},g.copy=function(a){var b=g.getStep(a),c=g.getAlter(a);return g.create(b,c)},g.transpose=function(a,b){var c=g.getStep(a),d=g.getAlter(a),e=4,h=f.create(e,c,d),i=f.transpose(h,b),j=f.getStep(i),k=f.getAlter(i);return g.create(j,k)},g.getStep=function(a){var b=a["bass-step"];return d.stringOrContent(b)},g.getAlter=function(a){var b=a["bass-alter"];return d.hasStringOrContent(b)?(b=d.stringOrContent(b),b=parseInt(b,10)):h},g.create=function(a,b){var c={"bass-step":a};return b!==h&&void 0!==b&&(c["bass-alter"]=b.toString()),c}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.DegreeDuplicateError=function(){var b=c(),d=a.call(this,b);return this.name=d.name="DegreeDuplicateError",this.stack=d.stack,this.message=d.message,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(){return"There are duplicates in the chord degrees."}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadDegreeValueError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadDegreeValueError",this.stack=e.stack,this.message=e.message,this.value=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"The degree value ["+a+"] is invalid.It must be an integer between 2 and 13."}}.call(this),function(){"use strict";var a=Adagio.Error.value.BadDegreeValueError,b=Adagio.Error.InternalError,c=Adagio.Utils.math,d=Adagio.Values.DegreeValue={};d.check=function(b){if(!d.isValid(b))throw new a(b)},d.assert=function(a){d.isValid(a)||d.raiseError(a)},d.raiseError=function(a){throw new b("BadDegreeValue","The degree value ["+a+"] is invalid.")},d.isValid=function(a){return c.isInteger(a)&&a>=2&&a<=13}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadDegreeTypeError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadDegreeTypeError",this.stack=e.stack,this.message=e.message,this.type=b,this};b.prototype=Object.create(a.prototype,{constructor:{type:b}});var c=function(a){return"The degree type ["+a+"] is invalid."}}.call(this),function(){"use strict";var a=Adagio.Error.value.BadDegreeTypeError,b=Adagio.Error.InternalError,c=Adagio.Values.DegreeType={ADD:"add",ALTER:"alter",SUBTRACT:"subtract"},d=[c.ADD,c.ALTER,c.SUBTRACT];c.check=function(b){if(!c.isValid(b))throw new a(b)},c.assert=function(a){c.isValid(a)||c.raiseError(a)},c.raiseError=function(a){throw new b("BadDegreeType","The degree type ["+a+"] is invalid.")},c.isValid=function(a){return d.includes(a)}}.call(this),function(){
"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadDegreeAlterError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadDegreeAlterError",this.stack=e.stack,this.message=e.message,this.alter=b,this};b.prototype=Object.create(a.prototype,{constructor:{alter:b}});var c=function(a){return"The degree alter ["+a+"] is invalid.It must be an integer between -1 and 1."}}.call(this),function(){"use strict";var a=Adagio.Error.value.BadDegreeAlterError,b=Adagio.Error.InternalError,c=Adagio.Utils.math,d=Adagio.Values.DegreeAlter={};d.check=function(b){if(!d.isValid(b))throw new a(b)},d.assert=function(a){d.isValid(a)||d.raiseError(a)},d.raiseError=function(a){throw new b("BadDegreeAlter","The degree alter ["+a+"] is invalid.")},d.isValid=function(a){return c.isInteger(a)&&-1<=a&&a<=1}}.call(this),function(){"use strict";var a=Adagio.Values.DegreeValue,b=Adagio.Values.DegreeType,c=Adagio.Values.DegreeAlter,d=Adagio.Utils.mxlUtils,e=Adagio.Utils.degreeUtils={};e.check=function(d){var f=e.getValue(d);a.check(f);var g=e.getType(d);b.check(g);var h=e.getAlter(d);c.check(h)},e.isValid=function(d){var f=e.getValue(d);if(!a.isValid(f))return!1;var g=e.getType(d);if(!b.isValid(g))return!1;var h=e.getAlter(d);return!!c.isValid(h)},e.isSame=function(a,b){return e.getValue(a)===e.getValue(b)&&e.getAlter(a)===e.getAlter(b)&&e.getType(a)===e.getType(b)},e.copy=function(a){var b=e.getValue(a),c=e.getAlter(a),d=e.getType(a);return e.create(b,d,c)},e.create=function(d,e,f){return f=f||0,a.assert(d),b.assert(e),c.assert(f),{"degree-value":d,"degree-alter":f,"degree-type":e}},e.compare=function(a,b){return e.getValue(a)-e.getValue(b)},e.getValue=function(a){return d.numberOrContent(a["degree-value"])},e.getType=function(a){return a["degree-type"]},e.getAlter=function(a){return d.numberOrContent(a["degree-alter"])}}.call(this),function(){"use strict";var a=Adagio.Error.value.DegreeDuplicateError,b=Adagio.Utils.degreeUtils,c=Adagio.Utils.degreesUtils={};c.copy=function(a){return a.map(b.copy)},c.check=function(d){if(c.sort(d),c.hasDuplicate(d))throw new a;d.forEach(b.check)},c.isValid=function(a){return c.sort(a),!c.hasDuplicate(a)&&!!a.every(b.isValid)},c.sort=function(a){a.sort(b.compare)},c.hasDuplicate=function(a){for(var c=a.length,d=0;d+1<c;d++){var e=a[d],f=a[d+1];if(b.getValue(e)===b.getValue(f))return!0}return!1}}.call(this),function(){"use strict";var a=Adagio.Values.ChordKind,b=Adagio.Values.Placement,c=Adagio.Utils.offsetUtils,d=Adagio.Utils.mxlUtils,e=Adagio.Utils.rootUtils,f=Adagio.Utils.bassUtils,g=Adagio.Utils.degreesUtils,h=b.ABOVE,i=Adagio.Utils.harmonyUtils={};i.create=function(a,b){return{root:a,kind:b}},i.setBass=function(a,b){a.bass=b},i.setDegrees=function(a,b){d.setArray(a,"degree",b)},i.compareTimePos=function(a,b){return i.getTimePos(a)-i.getTimePos(b)},i.getTimePos=function(a){return a.$adagio.timePos},i.setTimePos=function(a,b){i.create$adagioIfNeeded(a),a.$adagio.timePos=b},i.create$adagioIfNeeded=function(a){void 0===a.$adagio&&(a.$adagio={})},i.setNoteBefore=function(a,b){a.noteBefore=b},i.getNoteBefore=function(a){return parseInt(a.noteBefore,10)},i.cleanRaw=function(a){delete a.noteBefore,delete a.offset,a.staff="1",a.$placement=b.ABOVE},i.cleanNoteBefore=function(a){a.forEach(function(a){delete a.noteBefore})},i.hasSoundOffset=function(a){if(!i.hasOffset(a))return!1;var b=i.getOffset(a);return c.isSound(b)},i.setOffset=function(a,b){if(0===b)delete a.offset;else{a.offset=c.create(b,!0)}},i.hasOffset=function(a){return void 0!==a.offset},i.getOffsetValue=function(a){var b=i.getOffset(a);if(d.hasStringOrContent(b)){var c=d.stringOrContent(b);return c=parseInt(c,10)}return 0},i.getOffset=function(a){return a.offset},i.getRoot=function(a){return a.root},i.isSupported=function(a){if(!i.hasRoot(a))return!1;if(i.hasInversion(a))return!1;var b=i.getDegrees(a);return!!g.isValid(b)&&!!i.hasSupportedKind(a)},i.getDegrees=function(a){return d.getArray(a,"degree")},i.hasRoot=function(a){return void 0!==a.root},i.hasInversion=function(a){return void 0!==a.inversion},i.hasBass=function(a){return void 0!==a.bass},i.hasSupportedKind=function(b){var c=i.getKindValue(b);return a.isSupported(c)},i.getKindValue=function(a){var b=i.getKind(a);return d.stringOrContent(b)},i.getKind=function(a){return a.kind},i.getPlacement=function(a){return void 0===a.$placement?h:a.$placement},i.getBass=function(a){return a.bass},i.getStaffIdx=function(a){return void 0===a.staff?0:parseInt(a.staff,10)-1},i.transpose=function(a,b){var c=i.getRoot(a),d=e.transpose(c,b),h=i.getKind(a),j=i.create(d,h),k=i.getTimePos(a);if(i.setTimePos(j,k),i.hasBass(a)){var l=i.getBass(a),m=f.transpose(l,b);i.setBass(j,m)}var n=i.getDegrees(a);return n=g.copy(n),i.setDegrees(j,n),j}}.call(this),function(){"use strict";var a=Adagio.Utils.attributesUtils,b=Adagio.Utils.noteUtils,c=Adagio.Utils.pitchUtils,d=Adagio.Utils.harmonyUtils,e=Adagio.Utils.keyUtils,f=Adagio.Utils.transposeUtils,g=Adagio.Utils.clone;Adagio.Utils.measure.measureUtils_transpose=function(h){h.getConcertNotes=function(a){var b=h.getNotes(a);if(h.isTransposing(a)){var c=h.getWrappedTranspose(a);return i(b,c)}return b};var i=function(a,b){return a.map(j,b)},j=function(a){if(!b.hasPitch(a))return a;var d=b.getStaffIdx(a),e=this,h=e.getEntry(d);if(f.isIdentity(h))return a;a=g(a);var i=b.getPitch(a),j=!0,k=c.transpose(i,h,j);if(b.hasAccidental(a)){var l=c.getAlter(k),m=c.alterToAccidental(l);b.setAccidental(a,m)}return b.setPitch(a,k),a};h.getConcertHarmonies=function(a){var b=h.getHarmonies(a);if(h.isTransposing(a)){var c=h.getWrappedTranspose(a);return k(b,c)}return b};var k=function(a,b){return a.map(l,b)},l=function(a){var b=this,c=b.getAnyEntry();return f.isIdentity(c)?a:d.transpose(a,c)};h.getConcertKeys=function(a){var b=h.getWrappedTranspose(a),c=h.getAttributes(a);return m(c,b)};var m=function(b,c){for(var d=a.getWrappedKey(b),g=a.getNbStaves(b),h=!1,i=0;i<g;i++){var j=c.getEntry(i);if(!f.isUnison(j)){h=!0;var k=d.getEntry(i),l=e.transpose(k,j);d.setEntry(l,i)}}if(h){return d.dumpAttribute()}return a.getKey(b)};h.isTransposing=function(b){var c=h.getAttributes(b);return a.isTransposing(c)}}}.call(this),function(){"use strict";var a=Adagio.Utils.directionUtils,b=Adagio.Utils.soundUtils;Adagio.Utils.measure.measureUtils_jumps=function(c){c.hasSegno=function(d){var e=c.getRawDirections(d),f=c.getSounds(d);return e.some(a.hasSegno)||f.some(b.hasSegno)},c.hasCoda=function(d){var e=c.getRawDirections(d),f=c.getSounds(d);return e.some(a.hasCoda)||f.some(b.hasCoda)},c.hasDalsegno=function(d){var e=c.getRawDirections(d),f=c.getSounds(d);return e.some(a.hasDalsegno)||f.some(b.hasDalsegno)},c.hasDacapo=function(d){var e=c.getRawDirections(d),f=c.getSounds(d);return e.some(a.hasDacapo)||f.some(b.hasDacapo)},c.hasFine=function(d){var e=c.getRawDirections(d),f=c.getSounds(d);return e.some(a.hasFine)||f.some(b.hasFine)},c.hasToCoda=function(d){var e=c.getRawDirections(d),f=c.getSounds(d);return e.some(a.hasToCoda)||f.some(b.hasToCoda)}}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils;Adagio.Utils.measure.measureUtils_import=function(a){a.getImportMapping=function(b){return a.hasImportMapping(b)||a.createImportMapping(b),b.$adagio.importMapping},a.hasImportMapping=function(b){return!!a.has$adagio(b)&&void 0!==b.$adagio.importMapping},a.createImportMapping=function(c){var d=a.getNotes(c),e=new b,f=e.map(d);c.$adagio.importMapping=f}};var b=function(){},c=b.prototype;c.map=function(a){return this.reset(),a.forEach(this.addNote,this),this.positionMap},c.reset=function(){this.timePos=0,this.positionMap={}},c.addNote=function(b,c){if(a.hasBackup(b)&&(this.timePos-=a.getBackupDuration(b)),a.hasForward(b)&&(this.timePos+=a.getForwardDuration(b)),this.addEntry(c),!a.isChord(b)&&a.hasDuration(b)){var d=a.getDuration(b);this.timePos+=d}},c.getTimePos=function(a){return void 0===this.voices[a]&&(this.voices[a]=0),this.voices[a]},c.addEntry=function(a){this.positionMap[a]=this.timePos}}.call(this),function(){"use strict";var a=Adagio.Utils.orderedUtils={};a.mergeInto=function(b,c,d){for(var e=0,f=c.length,g=0;g<f;g++){var h=c[g];e=a.searchFirstInsertionIdx(b,h,d,e);var i=b[e];void 0!==i&&0===d(i,h)||b.splice(e,0,h)}},a.searchFirstInsertionIdx=function(a,b,c,d){for(var e=d||0,f=a.length;e<f;e++){if(c(a[e],b)>=0)return e}return e}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.orderedUtils;Adagio.Utils.measure.measureUtils_export=function(a){a.clearExportMapping=function(b){a.has$adagio(b)&&delete b.$adagio.exportMapping},a.getStaffExportMapping=function(b,c,d){return a.getExportMapping(b,d)[c]},a.getExportMapping=function(b,c){return a.hasExportMapping(b)||a.createExportMapping(b,c),b.$adagio.exportMapping},a.hasExportMapping=function(b){return!!a.has$adagio(b)&&void 0!==b.$adagio.exportMapping},a.createExportMapping=function(b,c){a.create$adagioIfNeeded(b);var d=a.getNotes(b),e=n(),f=e.map(d,c);b.$adagio.exportMapping=f}};var c=function(){},d=c.prototype;d.map=function(a,b){this.reset(),a.forEach(this.processNote,this),this.createStaves(b);var c=this.staves;return this.staves=null,this.voices=null,c},d.reset=function(){this.voices={},this.staves={}},d.processNote=function(b,c){if(!a.isChord(b)){var d=a.getVoiceIdx(b),h=this.getVoice(d);e(h)&&f(h,c),g(h,b)}},d.getVoice=function(a){return void 0===this.voices[a]&&(this.voices[a]={refs:[],timePos:0}),this.voices[a]};var e=function(a){if(0===a.refs.length)return!0;var b=a.refs.length-1,c=a.refs[b];return a.timePos>c.timePos},f=function(a,b){var c={noteBefore:b-1,timePos:a.timePos};a.refs.push(c)},g=function(b,c){if(a.hasDuration(c)){var d=a.getDuration(c);b.timePos+=d}};d.createStaves=function(a){a.forEach(this.createStaff,this)},d.createStaff=function(a,b){var c=a.voices.map(this.getVoice,this),d=c.map(h),e=d.reduce(j,[]),f=i(e);this.staves[b]={orderedRefs:e,indexedRefs:f}};var h=function(a){return a.refs},i=function(a){var b={};return a.forEach(l,b),b},j=function(a,c){return b.mergeInto(a,c,k),a},k=function(a,b){return a.timePos-b.timePos},l=function(a){this[a.timePos]=a.noteBefore},m=null,n=function(){return null===m&&(m=new c),m}}.call(this),function(){"use strict";var a=Adagio.Utils.typeUtils;Adagio.Utils.measure.measureUtils_staffContent=function(b){b.hasStaffContent=function(a,c){if(b.hasStaffContentMap(a)){return void 0!==b.getStaffContentMap(a)[c]}return!1},b.getStaffContent=function(a,c){var d=b.getStaffContentMap(a);return void 0!==d[c]?d[c]:{}},b.setStaffContent=function(c,d,e){var f=b.getStaffContentMap(c);a.isObjectEmpty(e)?delete f[d]:f[d]=e,b.setStaffContentMap(c,f)},b.getStaffContentMap=function(a){return b.hasStaffContentMap(a)?a.$adagio.staffContentMap:{}},b.hasStaffContentMap=function(a){return!!b.has$adagio(a)&&void 0!==a.$adagio.staffContentMap},b.setStaffContentMap=function(a,c){b.create$adagioIfNeeded(a),a.$adagio.staffContentMap=c}}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.mxlUtils,c=Adagio.Utils.measure.measureUtils_attrs,d=Adagio.Utils.measure.measureUtils_sound,e=Adagio.Utils.measure.measureUtils_barlines,f=Adagio.Utils.measure.measureUtils_staffSides,g=Adagio.Utils.measure.measureUtils_directions,h=Adagio.Utils.measure.measureUtils_voiceSides,i=Adagio.Utils.measure.measureUtils_slurs,j=Adagio.Utils.measure.measureUtils_transpose,k=Adagio.Utils.measure.measureUtils_jumps,l=Adagio.Utils.measure.measureUtils_import,m=Adagio.Utils.measure.measureUtils_export,n=Adagio.Utils.measure.measureUtils_staffContent,o=Adagio.Utils.measureUtils={};c(o),d(o),e(o),f(o),g(o),h(o),i(o),j(o),k(o),l(o),n(o),m(o),o.create$adagioIfNeeded=function(a){o.has$adagio(a)||o.create$adagio(a)},o.has$adagio=function(a){return void 0!==a.$adagio},o.create$adagio=function(a){a.$adagio={}},o.getNumber=function(a){return parseInt(a.$number,10)},o.setNumber=function(a,b){a.$number=b.toString()},o.getNbNotes=function(a){return o.getNotes(a).length},o.getNotes=function(a){return o.hasNotes(a)?a.note:[]},o.hasNotes=function(a){return void 0!==a.note},o.setNotes=function(a,b){a.note=b},o.getInstrumentContext=function(a){return{nbStaves:o.getOwnNbStaves(a)}},o.updateInstrumentsIds=function(b,c){o.getNotes(b).forEach(function(b){a.updateInstrumentId(b,c)})},o.hasHarmonies=function(a){return o.getNbHarmonies(a)>0},o.getNbHarmonies=function(a){return o.getHarmonies(a).length},o.getHarmonies=function(a){return b.getArray(a,"harmony")},o.setHarmonies=function(a,b){a.harmony=b},o.getSounds=function(a){return b.getArray(a,"sound")},o.setSounds=function(a,c){b.setArray(a,"sound",c)}}.call(this),function(){"use strict";var a=Adagio.Utils.durationUtils,b=Adagio.Utils.measureUtils,c=Adagio.Utils.noteUtils;Adagio.Data.prototype.restoreBackup=function(){this.forEachMeasure(d)};var d=function(a){var c={measure:a,measureDivisions:null};b.getNotes(a).forEach(e,c)},e=function(a,b,d){if(c.removeForward(a),g(a,b,d)){var e=this,h=f(e);c.addBackup(a,h)}else c.removeBackup(a)},f=function(c){if(null===c.measureDivisions){var d=b.getWrappedTime(c.measure),e=d.getAnyEntry(),f=a.timeToQuarter(e),g=b.getDpq(c.measure);c.measureDivisions=a.quarterToDuration(f,g)}return c.measureDivisions},g=function(a,b,d){if(0===b)return!1;var e=d[b-1],f=c.getVoiceIdx(a);return c.getVoiceIdx(e)!==f}}.call(this),function(){"use strict";var a=Adagio.Utils.typeUtils;Adagio.Utils.epureAttributes=function(a){c(a),b(a)};var b=function(b){for(var c in b){var d=b[c];a.isArray(d)&&(1===d.length?b[c]=d[0]:0===d.length&&delete b[c])}},c=function(a){for(var b in a)d(a,b)},d=function(a,b){var c=a[b];null===c||void 0===c?delete a[b]:g(a,b)},e=function(a){for(var b=0;b<a.length;b++)f(a,b)},f=function(a,b){g(a,b)},g=function(a,b){var d=a[b];"number"==typeof d?a[b]=d.toString():h(d)?e(d):i(d)&&c(d)},h=function(a){return"[object Array]"===Object.prototype.toString.call(a)},i=function(a){return"[object Object]"===Object.prototype.toString.call(a)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.partContentUtils={};b.getNbStaves=function(c){var d=b.getFirstMeasure(c);return a.has$adagio(d)?a.getNbStaves(d):a.getOwnNbStaves(d)},b.getWrappedStaffDetailsOrDefault=function(c){var d=b.getFirstMeasure(c);return a.getWrappedStaffDetailsOrDefault(d)},b.getWrappedClef=function(c){var d=b.getFirstMeasure(c);return a.getWrappedClef(d)},b.getFirstMeasure=function(a){return b.getMeasures(a)[0]},b.getNbMeasures=function(a){return b.getMeasures(a).length},b.getMeasures=function(a){return a.measure},b.getMeasure=function(a,b){return a.measure[b]},b.updateInstrumentsIds=function(c,d){b.getMeasures(c).forEach(function(b){a.updateInstrumentsIds(b,d)})},b.getInstrumentContext=function(c){var d=b.getMeasures(c),e=d[0];return a.getInstrumentContext(e)},b.getId=function(a){return a.$id},b.setId=function(a,b){a.$id=b},b.hasUuid=function(a){return void 0!==a.uuid},b.setUuid=function(a,b){a.uuid=b},b.getUuid=function(a){return a.uuid},b.isTab=function(c){var d=b.getFirstMeasure(c);return a.isTab(d)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.noteUtils,c=Adagio.Utils.slurUtils;Adagio.export.fillMeasureSlursLevels=function(c){var e=a.getNotes(c);e=e.filter(b.hasSlur),e.forEach(d)};var d=function(a){var d=b.getVoiceIdx(a),e=b.getSlur(a),f=d+1;c.setLevel(e,f)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.noteUtils,c=Adagio.Utils.durationUtils,d=Adagio.Values.DurationType;Adagio.export.fillMeasureDurationTypes=function(b){var c=a.getNotes(b),d=a.getDpq(b);c=c.forEach(e,d)};var e=function(a){if(!b.isGraceNote(a)){var e=this.valueOf(),f=b.getNormalQuarterDuration(a,e),g=c.extractBaseDuration(f),h=d.quarterToDurationType(g);b.setDurationType(a,h)}}}.call(this),function(){"use strict";var a=Adagio.Utils.cloneEpure$adagio,b=Adagio.Utils.measureUtils,c=Adagio.Utils.attributesUtils,d=Adagio.Utils.timeUtils,e=Adagio.Utils.attributeWrapper.AttributeWrapper;Adagio.export.restoreAttributes=function(e){var g=e.getCommonContent(),h=g.getDisplayedTime(0);e.forEachPart(function(e){var i=e.measure,j=i[0],k=b.getAttributes(j),l=a(k),m=d.copy(h);c.setTime(l,[m]),c.removeDefault(l),b.setOwnAttributes(j,l),i.slice(1).reduce(function(a,b,c){return c++,f(a,b,c,g)},j)})};var f=function(f,h,i,j){var k={},l=b.getDivisions(f),m=b.getDivisions(h);m!==l&&c.setDivisions(k,m);var n=j.getDisplayedTime(i-1),o=new e([n],1,d),p=j.getDisplayedTime(i),q=new e([p],1,d),r=g(o,q);c.setTime(k,r);var s=b.getWrappedClef(f),t=b.getWrappedClef(h),u=g(s,t);c.setClef(k,u);var v=b.getWrappedKey(f),w=b.getWrappedKey(h),x=g(v,w);c.setKey(k,x);var y=b.getWrappedTranspose(f),z=b.getWrappedTranspose(h),A=g(y,z);return c.setTranspose(k,A),b.setOwnAttributes(h,a(k)),h},g=function(a,b){var c=b.getDiffWith(a);return c=new e(c,a.getNbStaves(),a.utils).dumpAttribute()}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils;Adagio.export.restoreMeasuresNumbers=function(a){a.forEachPart(b)};var b=function(a){a.measure.forEach(c)},c=function(b,c){a.setNumber(b,c+1)}}.call(this),function(){"use strict";var a=Adagio.Utils.orderedUtils;Adagio.export.timePosToExportLocation=function(c,d){var e,f=0;if(void 0!==c.indexedRefs[d])e=c.indexedRefs[d];else{var g={timePos:d},h=a.searchFirstInsertionIdx(c.orderedRefs,g,b);g=c.orderedRefs[h-1],e=g.noteBefore,f=d-g.timePos}return{noteBefore:e,offset:f}};var b=function(a,b){return a.timePos-b.timePos}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.directionUtils,c=Adagio.export.timePosToExportLocation;Adagio.export.shiftDirectionsNotesRefs=function(b,c){var e=a.getAllDirections(b);if(e.length>0){var f=a.getExportMapping(b,c);e.forEach(d,f),a.setDirections(b,e)}};var d=function(a){var d=this,e=b.getTimePos(a),f=b.getStaffIdx(a),g=c(d[f],e);b.setNoteBefore(a,g.noteBefore),b.setOffset(a,g.offset)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.harmonyUtils,c=Adagio.export.timePosToExportLocation;Adagio.export.restoreMeasureHarmonies=function(b,c){if(a.hasHarmonies(b)){var e=0,f=a.getStaffExportMapping(b,e,c);a.getHarmonies(b).forEach(d,f)}};var d=function(a){var d=this,e=b.getTimePos(a),f=c(d,e);b.setNoteBefore(a,f.noteBefore),b.setOffset(a,f.offset)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.harmonyUtils;Adagio.export.cleanMeasureHarmonies=function(c){a.getHarmonies(c).forEach(b.cleanRaw)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.soundUtils,c=Adagio.Utils.tempoUtils,d=Adagio.Utils.partContentUtils;Adagio.export.restoreTempo=function(a){var b=a.getPartContent(0),c=d.getMeasures(b),f=a.getCommonContent();c.forEach(e,f)};var e=function(a,b){var d=this;if(d.hasOwnTempo(b)){var e=d.getOwnTempo(b),g=c.getQpm(e);f(a,g)}},f=function(c,d){var e,f=a.getSounds(c);0===f.length?(e={},f.push(e)):e=f[0],b.setTempo(e,d),a.setSounds(c,f)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.soundUtils,c=Adagio.Utils.partContentUtils;Adagio.export.restoreSwing=function(a){var b=a.getPartContent(0),e=c.getMeasures(b),f=a.getCommonContent();e.forEach(d,f)};var d=function(a,b){var c=this;if(c.hasOwnSwing(b)){var d=c.getOwnSwing(b);e(a,d)}},e=function(c,d){var e,f=a.getSounds(c);0===f.length?(e={},f.push(e)):e=f[0],b.setSwing(e,d),a.setSounds(c,f)}}.call(this),function(){"use strict";Adagio.Values.EndingType={START:"start",STOP:"stop",DISCONTINUE:"discontinue"}}.call(this),function(){"use strict";var a=Adagio.Values.EndingType,b=Adagio.Utils.measureUtils,c=Adagio.Utils.barlineUtils,d=Adagio.Utils.endingUtils,e=Adagio.Utils.partContentUtils;Adagio.export.restoreScoreEndings=function(a){var b=a.getCommonContent();a.getPartsContents().forEach(f,b)};var f=function(a){var b=this;e.getMeasures(a).forEach(g,b)},g=function(a,b){var c=this;if(c.hasEnding(b)){var d=c.getEnding(b);h(a,d),i(a,d)}},h=function(e,f){var g;b.hasLeftBarline(e)||(g=c.create(c.LEFT,c.DEFAULT_STYLE),b.addBarline(e,g)),g=b.getLeftBarline(e);var h=d.create(a.START,f);c.setEnding(g,h)},i=function(a,e){var f;b.hasRightBarline(a)||(f=c.create(c.RIGHT,c.DEFAULT_STYLE),b.addBarline(a,f)),f=b.getRightBarline(a);var g=j(a),h=d.create(g,e);c.setEnding(f,h)},j=function(c){return b.hasRightSpecificBarline(c)?a.STOP:a.DISCONTINUE}}.call(this),function(){"use strict";var a=Adagio.Utils.partContentUtils,b=Adagio.Utils.measureUtils,c=Adagio.Utils.soundUtils,d=Adagio.Values.SoundType,e=Adagio.Error.InternalError;Adagio.export.restoreJumps=function(b){var c=b.getCommonContent(),d=b.getPartContent(0);a.getMeasures(d).forEach(f,c)};var f=function(a,b){var c=this;c.hasJumpTag(b)&&i(a,c.getJumpTag(b)),c.hasJumpCall(b)&&j(a,c.getJumpCall(b))},g=function(a){var c=b.getSounds(a);return 0===c.length?{}:c[0]},h=function(a,c){var d=b.getSounds(a);0===d.length?d.push(c):d[0]=c,b.setSounds(a,d)},i=function(a,b){var f=g(a);switch(b){case d.SEGNO:c.createSegno(f);break;case d.CODA:c.createCoda(f);break;default:throw new e("unexpected","Bad Jump Tag type")}h(a,f)},j=function(a,b){var f=g(a);switch(b){case d.DALSEGNO:c.createDalsegno(f);break;case d.DACAPO:c.createDacapo(f);break;case d.FINE:c.createFine(f);break;case d.TOCODA:c.createToCoda(f);break;default:throw new e("unexpected","Bad Jump Call type")}h(a,f)}}.call(this),function(){"use strict";var a=Adagio.Utils.partContentUtils,b=Adagio.Utils.measureUtils,c=Adagio.Utils.clone;Adagio.export.restoreTempoChanges=function(b){var c=b.getCommonContent(),e=b.getPartContent(0);a.getMeasures(e).forEach(d,c)};var d=function(a,b){var c=this;c.hasTempoChanges(b)&&e(a,c.getTempoChanges(b))},e=function(a,d){d.forEach(function(d){d=c(d),b.addDirection(a,d)})}}.call(this),function(){"use strict";var a=Adagio.Values.RehearsalType,b=Adagio.Utils.partContentUtils,c=Adagio.Utils.measureUtils,d=Adagio.Utils.rehearsalUtils,e=Adagio.Utils.direction.rehearsalDirectionUtils;Adagio.export.restoreRehearsals=function(a){var c=a.getCommonContent(),d=a.getPartContent(0);b.getMeasures(d).forEach(f,c)};var f=function(a,b){var c=this;if(c.hasRehearsal(b)){var d=c.getRehearsal(b);g(a,d,b)}},g=function(b,f,g){var h,i=d.getType(f);h=i===a.MEASURE_NUMBER?(1+g).toString():d.getText(f);var j=e.create(h,i);c.addDirection(b,j)}}.call(this),function(){"use strict";var a=Adagio.Utils.partContentUtils,b=Adagio.Utils.measureUtils,c=Adagio.Utils.tempoUtils,d=Adagio.Utils.direction.tempoMetronomeDirectionUtils;Adagio.export.restoreMetronomes=function(b){var c=b.getCommonContent(),d=b.getPartContent(0);a.getMeasures(d).forEach(e,c)};var e=function(a,b){var d=this;if(d.hasOwnTempo(b)){var e=d.getOwnTempo(b),g=c.getDurationType(e),h=c.getNbDots(e),i=c.getBpm(e);f(a,i,g,h)}},f=function(a,c,e,f){var g=d.create(c,e,f);b.addDirection(a,g)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.barlineUtils;Adagio.export.cleanEnding=function(c){a.getBarlines(c).forEach(b.removeEnding)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.soundUtils;Adagio.import.common.cleanQpm=function(c){var d=a.getSounds(c);d.forEach(b.removeTempo),d=d.filter(b.isNotEmpty),a.setSounds(c,d)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.soundUtils;Adagio.import.common.cleanSwing=function(c){var d=a.getSounds(c);d.forEach(b.removeSwing),d=d.filter(b.isNotEmpty),a.setSounds(c,d)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.soundUtils;Adagio.import.common.cleanJumps=function(c){var d=a.getSounds(c);d.forEach(b.deleteSegno),d.forEach(b.deleteCoda),d.forEach(b.deleteDalsegno),d.forEach(b.deleteDacapo),d.forEach(b.deleteFine),d.forEach(b.deleteToCoda),d=d.filter(b.isNotEmpty),a.setSounds(c,d)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Values.DirectionType;Adagio.import.common.cleanTempoChanges=function(c){a.getDirectionsWithType(c,b.TEMPO_CHANGE).forEach(function(b){a.eraseDirection(c,b)})}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.directionUtils,c=Adagio.Utils.directionTypeUtils;Adagio.import.common.cleanRehearsal=function(c){var e=a.getRawDirections(c);e.forEach(d),e=e.filter(b.hasContent),a.setDirections(c,e)};var d=function(a){var c=b.getEntries(a);c=c.filter(e),b.setEntries(a,c)},e=function(a){return!c.isRehearsal(a)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.directionUtils,c=Adagio.Utils.directionTypeUtils;Adagio.import.common.cleanMetronome=function(c){var e=a.getRawDirections(c);e.forEach(d),e=e.filter(b.hasContent),a.setDirections(c,e)};var d=function(a){var c=b.getEntries(a);c=c.filter(e),b.setEntries(a,c)},e=function(a){return!c.isMetronome(a)}}.call(this),function(){"use strict";var a=Adagio.export.restoreTempo,b=Adagio.export.restoreSwing,c=Adagio.export.restoreScoreEndings,d=Adagio.export.restoreJumps,e=Adagio.export.restoreTempoChanges,f=Adagio.export.restoreRehearsals,g=Adagio.export.restoreMetronomes,h=Adagio.export.cleanEnding,i=Adagio.import.common.cleanQpm,j=Adagio.import.common.cleanSwing,k=Adagio.import.common.cleanJumps,l=Adagio.import.common.cleanTempoChanges,m=Adagio.import.common.cleanRehearsal,n=Adagio.import.common.cleanMetronome;Adagio.export.restoreCommonContent=function(o){o.forEachMeasure(i),o.forEachMeasure(j),o.forEachMeasure(h),o.forEachMeasure(k),o.forEachMeasure(l),o.forEachMeasure(m),o.forEachMeasure(n),a(o),b(o),c(o),d(o),e(o),f(o),g(o)}}.call(this),function(){"use strict";var a=Adagio.Utils.math,b=Adagio.Utils.direction.tempoChangeDirectionUtils;Adagio.export.common.getCommonContentDpq=function(c,d){var e=c.getTempoChanges(d),f=e.map(b.getDpq),g=1;return g=f.reduce(a.lcm,g)}}.call(this),function(){"use strict";var a=Adagio.Utils.directionUtils;Adagio.export.common.setCommonContentDpq=function(a,c,d){a.getTempoChanges(c).forEach(b,d)};var b=function(b){var c=this.valueOf(),d=a.getDpq(b),e=c/d,f=a.getTimePos(b);f*=e,a.setTimePos(b,f),a.setDpq(b,c)}}.call(this),function(){"use strict";var a=Adagio.Utils.math,b=Adagio.Utils.directionUtils;Adagio.export.common.simplifyCommonContentDpq=function(a,b){a.getTempoChanges(b).forEach(c)};var c=function(c){var d=b.getTimePos(c),e=b.getDpq(c),f=a.gcd(d,e);d/=f,e/=f,b.setTimePos(c,d),b.setDpq(c,e)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.math,c=Adagio.Utils.attributesUtils,d=Adagio.Utils.noteUtils,e=Adagio.Utils.measureUtils,f=Adagio.Utils.directionUtils,g=Adagio.Utils.harmonyUtils,h=function(a){this.measureJson=a,this.attributes=e.getAttributes(a),this.notes=e.getNotes(a)};Adagio.Data.Divisions=h;var i=h.prototype;i.getDivisions=function(){return c.getDivisions(this.attributes)},i.multiplyDivisions=function(b){if("number"!=typeof b){throw new a("Unexpected","coeff ["+b+"] should be a number")}var c=this.getDivisions();c*=b,this.setDivisions(c),this.notes.forEach(j,b),this.getDirections().forEach(k,{value:b,utils:f}),this.getHarmonies().forEach(k,{value:b,utils:g})};var j=function(a){var b=this.valueOf(),c=d.getDuration(a);if(d.setDuration(a,c*b),d.hasBackup(a)){var e=d.getBackupDuration(a);d.addBackup(a,e*b)}if(d.hasForward(a)){var f=d.getForwardDuration(a);d.addForward(a,f*b)}},k=function(a){var b=this.utils,c=this.value,d=b.getTimePos(a);b.setTimePos(a,d*c)};i.reduceDivisions=function(){var a=this.computeDivisor();l(a)&&this.applyDivisor(a)},i.computeDivisor=function(){for(var a=this.getDivisions(),c=0;c<this.notes.length&&l(a);c++){var e=this.notes[c],g=d.getDuration(e);a=b.gcd(a,g)}for(var h=this.getDirections(),i=h.length,j=0;j<i&&l(a);j++){var k=h[j],m=f.getTimePos(k);m>0&&(a=b.gcd(a,m))}return a};var l=function(a){return a>1};i.applyDivisor=function(a){var b=this.getDivisions();b/=a,this.setDivisions(b);for(var c=0;c<this.notes.length;c++){var e=this.notes[c],f=d.getDuration(e);d.setDuration(e,f/a)}},i.getHarmonies=function(){return e.getHarmonies(this.measureJson)},i.getDirections=function(){return e.getAllDirections(this.measureJson)},i.setDivisions=function(a){c.setDivisions(this.attributes,a)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.math,c=Adagio.export.common.getCommonContentDpq,d=Adagio.export.common.setCommonContentDpq,e=Adagio.export.common.simplifyCommonContentDpq,f=Adagio.Data.Divisions;Adagio.export.common.updateMeasureDpq=function(g,h,i){e(g,i);var j=c(g,i),k=a.getDpq(h),l=b.lcm(j,k),m=l/k;new f(h).multiplyDivisions(m),d(g,i,l)}}.call(this),function(){"use strict";var a=Adagio.export.common.updateMeasureDpq;Adagio.export.common.updateMeasuresDpq=function(a,c){c.forEach(b,a)};var b=function(b,c){a(this,b,c)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.barlineUtils;Adagio.fix.fixMeasureRepeat=function(b){a.getBarlines(b).forEach(c)};var c=function(a){if(b.hasRepeat(a)){var c=b.getRepeat(a);delete c.winged,delete c.$time}}}.call(this),function(){"use strict";var a=Adagio.Utils,b=Adagio.Utils.epureAttributes,c=Adagio.Utils.partContentUtils,d=Adagio.Utils.measureUtils,e=Adagio.export.fillMeasureSlursLevels,f=Adagio.export.fillMeasureDurationTypes,g=Adagio.export.restoreAttributes,h=Adagio.export.restoreMeasuresNumbers,i=Adagio.export.shiftDirectionsNotesRefs,j=Adagio.export.restoreMeasureHarmonies,k=Adagio.export.cleanMeasureHarmonies,l=Adagio.export.restoreCommonContent,m=Adagio.export.common.updateMeasuresDpq,n=Adagio.fix.fixMeasureRepeat,o=Adagio.Data.prototype;o.exportData=function(){this.updateCommonDpq(),this.forEachMeasure(d.clearExportMapping),this.forEachMeasure(k),this.forEachMeasure(e),this.forEachMeasure(f),this.forEachMeasure(n),l(this),this.getPartsContents().forEach(p,this),this.restoreBackup(),g(this),h(this);var b=a.cloneEpure$adagio(this.score);return s(b),r(b),b},o.updateCommonDpq=function(){var a=this.getPartContent(0),b=c.getMeasures(a),d=this.getCommonContent();m(d,b)};var p=function(a,b){var d=this,e=d.getPartStaffMapping(b);c.getMeasures(a).forEach(q,e)},q=function(a){var b=this;i(a,b),j(a,b)},r=function(b){for(var c=b["score-partwise"]["part-list"]["score-part"],d=0;d<c.length;d++){var e=c[d];for(var f in e){var g=a.minusToCamelCase(f);g!==f&&"undefined"!==e[g]&&delete e[g]}}},s=function(a){a["score-partwise"].part.forEach(function(a){a.measure.forEach(function(a){if(a.attributes&&a.attributes[0]){var c=a.attributes[0];b(c)}})})}}.call(this),function(){"use strict";var a=Adagio.Error.WTFError=function(a){var b=Error.call(this,a);return this.name=b.name="WTFError",this.stack=b.stack,this.message=b.message,this};a.prototype=Object.create(Error.prototype,{constructor:{value:a}})}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.WTFError,c=Adagio.Error.client.BadVoiceError=function(b,e){e=e||c.GET;var f=d(b,e),g=a.call(this,f);return this.name=g.name="BadVoiceError",this.stack=g.stack,this.message=g.message,this.voiceIdx=b,this.action=e,this};c.prototype=Object.create(a.prototype,{constructor:{value:c}});var d=function(a,d){if(d===c.GET)return"There is no voice at the index "+a+". ";if(d===c.INSERT)return"Cannot insert a voice at the index "+a+". ";var e="BadVoiceError: bad action value: "+d.toString()+". ";throw new b(e)};c.GET="get",c.INSERT="insert"}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.InvalidVoiceIdxError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="InvalidVoiceIdxError",this.stack=e.stack,this.message=e.message,this.voiceIdx=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"the voiceIdx value ["+a+"] is invalid."}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Error.value.InvalidVoiceIdxError,c=Adagio.Utils.math,d=Adagio.Values.VoiceIdx={};d.check=function(a){if(!d.isValid(a))throw new b(a)},d.assert=function(b){if(!d.isValid(b)){throw new a("InvalidVoiceIdx","The voiceIdx ["+b+"] is invalid.")}},d.isValid=function(a){return c.isInteger(a)&&a>=0}}.call(this),function(){"use strict"
;var a=Adagio.Error.client.BadVoiceError,b=Adagio.Error.InternalError,c=Adagio.Values.VoiceIdx,d=Adagio.Utils.measureUtils,e=Adagio.Utils.noteUtils,f=Adagio.Utils.math,g=Adagio.Data.VoicesList=function(a){this.notes=d.getNotes(a),this.voices=null},h=g.prototype;h.addNoteToVoice=function(a,c,d){var f=e.getVoiceIdx(a);if(f!==d){throw new b("BadNoteVoiceIdx","note voice idx ["+f+"] is different from the voice idx ["+d+"].")}var g=this.getVoice(d);i(g,c),g.splice(c,0,a);var h=e.getStaffIdx(a),j=this.calcInsertionIdx(c,d,h);this.notes.splice(j,0,a)};var i=function(a,c){var d=a.length;if(!f.isInteger(c)||c<0||c>d){throw new b("BadNoteInsertionIdx","Cannot insert note at the index ["+c+"].")}};h.calcInsertionIdx=function(a,b,c){var d=this.getVoice(b);return d.length>1?this.calcInsertionIdxFromCurrentVoice(a,d):this.calcInsertionIdxFromNotes(b,c)},h.calcInsertionIdxFromCurrentVoice=function(a,b){if(a===b.length-1){var c=b[b.length-2];return this.getIdxInNotes(c)+1}var d=b[a+1];return this.getIdxInNotes(d)},h.calcInsertionIdxFromNotes=function(a,c){var d,f=this.notes.length;for(d=0;d<f;d++){var g=this.notes[d],h=e.getStaffIdx(g);if(c<h)return d;if(!(c>h)){var i=e.getVoiceIdx(g);if(a<i)return d;if(i===a)throw new b("Unexpected")}}return d},h.removeNoteFromVoice=function(a,b){var c=this.getVoice(b);j(c,a);var d=c[a];c.splice(a,1);var e=this.getIdxInNotes(d);this.notes.splice(e,1)};var j=function(a,c){var d=a.length;if(!f.isInteger(c)||c<0||c>=d){throw new b("BadNoteIdx","There is no note at the index ["+c+"].")}};h.getIdxInNotes=function(a){return this.notes.indexOf(a)},h.checkVoiceIdx=function(b){if(!this.hasVoice(b))throw new a(b)},h.checkVoiceInsertionIdx=function(b){if(this.hasVoice(b))throw new a(b,a.INSERT)},h.insertVoice=function(a){c.assert(a),this.assertVoiceInsertionIdx(a),this.getVoices()[a]=[]},h.assertVoiceInsertionIdx=function(a){if(this.hasVoice(a)){throw new b("VoiceIdxAlreadyUsed","There is already a voice with the id ["+a+"].")}},h.removeVoice=function(a){this.assertVoiceIdx(a),this.dropVoiceNotes(a),delete this.getVoices()[a]},h.dropVoiceNotes=function(a){var b=this.getVoice(a),c=b.length;if(c>0){var d=b[0],e=this.getIdxInNotes(d);this.notes.splice(e,c),this.voices[a]=[]}},h.getVoice=function(a){return this.assertVoiceIdx(a),this.getVoices()[a]},h.assertVoiceIdx=function(a){var c;if(!f.isInteger(a))throw c="The voiceIdx value ["+a+"] is invalid.",new b("NotExpected",c);if(!this.hasVoice(a))throw c="There is no voices for the id ["+a+"].",new b("BadVoiceIdx",c)},h.hasVoice=function(a){return void 0!==this.getVoices()[a]},h.getVoicesIndexes=function(){var a=this.getVoices(),b=Object.keys(a);return b=b.map(f.intPart),b.sort(f.cmp),b},h.getVoices=function(){return null===this.voices&&this.fillVoices(),this.voices},h.fillVoices=function(){this.voices={},this.notes.forEach(k,this.voices)};var k=function(a){var b=this,c=e.getVoiceIdx(a);void 0===b[c]&&(b[c]=[]),b[c].push(a)}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.BadNoteIdxError=function(c,d){void 0===d&&(d=b.action.GET);var e=d.msgPrefix+" note at the index "+c,f=a.call(this,e);return this.name=f.name="BadNoteIdxError",this.stack=f.stack,this.message=f.message,this.noteIdx=c,this.action=d,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}}),b.action={INSERT:{msgPrefix:"Cannot insert"},GET:{msgPrefix:"There is no"}}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.BadGraceIdxError=function(c,d,e){void 0===e&&(e=b.action.GET);var f=e.msgPrefix+" grace note at the index ["+d+"] for note at index ["+c+"].",g=a.call(this,f);return this.name=g.name="BadGraceIdxError",this.stack=g.stack,this.message=g.message,this.noteIdx=c,this.graceIdx=d,this.action=e,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}}),b.INSERT={msgPrefix:"Cannot insert"},b.GET={msgPrefix:"There is no"}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.NotPossibleOnRestsError=function(){var b="This operation is not allowed on rests",c=a.call(this,b);return this.name=c.name="NotPossibleOnRestsError",this.stack=c.stack,this.message=c.message,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}})}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.NotPossibleOnNonRestsError=function(){var b="This operation is only allowed on rests",c=a.call(this,b);return this.name=c.name="NotPossibleOnNonRestsError",this.stack=c.stack,this.message=c.message,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}})}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.NotPossibleOnChordError=function(){var b="This operation is not allowed on chord notes.",c=a.call(this,b);return this.name=c.name="NotPossibleOnChordError",this.stack=c.stack,this.message=c.message,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}})}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.NotPossibleOnSingleNoteError=function(){var b="This operation is not allowed on single note.",c=a.call(this,b);return this.name=c.name="NotPossibleOnSingleNoteError",this.stack=c.stack,this.message=c.message,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}})}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.math,c=Adagio.Utils.timeModifUtils,d=Adagio.Error.InternalError,e=Adagio.Error.client.BadNoteIdxError,f=Adagio.Error.client.BadGraceIdxError,g=Adagio.Error.client.NotPossibleOnRestsError,h=Adagio.Error.client.NotPossibleOnNonRestsError,i=Adagio.Error.client.NotPossibleOnChordError,j=Adagio.Error.client.NotPossibleOnSingleNoteError,k=Adagio.Data.Voice=function(a){this.gracesList=a},l=k.prototype;l.insertNote=function(a,b){this.gracesList.insertNote(a,b)},l.removeNote=function(a,b){var c;c="number"==typeof a?a:this.indexOf(a),this.assertSameTimeModifAt(c,b),this.gracesList.removeNote(c)},l.assertSameTimeModifAt=function(a,b){if(!this.isSameTimeModifAt(a,b)){throw new d("SubTuplet","Cannot remove a note from a sub-tuplet.")}},l.indexOf=function(a){return this.gracesList.indexOf(a)},l.indexOfGrace=function(a,b){return this.gracesList.indexOfGrace(a,b)},l.removeNoteFromChord=function(a,b){this.gracesList.removeNoteFromChord(a,b)},l.addNoteToChord=function(a,b){this.gracesList.addNoteToChord(a,b)},l.insertGrace=function(a,b,c){this.gracesList.insertGrace(a,b,c)},l.removeGrace=function(a,b){this.gracesList.removeGrace(a,b)},l.addGraceToChord=function(a,b,c){this.gracesList.addGraceToChord(a,b,c)},l.removeGraceFromChord=function(a,b,c){this.gracesList.removeGraceFromChord(a,b,c)},l.assertNoteIdx=function(a){this.gracesList.assertNoteIdx(a)},l.assertInsertionIdx=function(a){this.gracesList.assertInsertionIdx(a)},l.assertGraceIdx=function(a,b){this.gracesList.assertGraceIdx(a,b)},l.checkInsertionIdx=function(a){var c=this.getNbNotes();if(!b.isNumber(a)||a<0||a>c)throw new e(a,e.action.INSERT)},l.checkGraceIdx=function(a,c){this.checkNoteIdx(a);var d=this.getNbGraces(a);if(!b.isNumber(c)||c<0||c>=d)throw new f(a,c,f.GET)},l.checkGraceInsertionIdx=function(a,c){this.checkNoteIdx(a);var d=this.getNbGraces(a);if(!b.isNumber(c)||c<0||c>d)throw new f(a,c,f.INSERT)},l.checkNoteIdx=function(a){var c=this.getNbNotes();if(!b.isNumber(a)||a<0||a>=c)throw new e(a)},l.checkNotRest=function(a){if(this.isRest(a))throw new g},l.checkRest=function(a){if(!this.isRest(a))throw new h},l.checkNotChord=function(a){if(this.isChord(a))throw new i},l.checkGraceNotChord=function(a,b){if(this.isGraceChord(a,b))throw new i},l.checkChord=function(a){if(!this.isChord(a))throw new j},l.checkGraceChord=function(a,b){if(!this.isGraceChord(a,b))throw new j},l.getSpaceFromIdx=function(a){var b=this.getNbNotes();return this.getRangeSpace(a,b)},l.getRangeSpace=function(b,c){for(var d=0,e=b;e<c;e++){var f=this.getNote(e);d+=a.getDuration(f)}return d},l.getAvailableSpaceAtIdx=function(a){var b=this.getNbNotes();return this.getAvailableSpaceLeftToRight(a,b)},l.getAvailableSpaceLeftToRight=function(b,c,d){for(var e=0,f=b;f<c;f++){if(this.isBlockingAdd(f,d))return e;var g=this.getNote(f);e+=a.getDuration(g)}return e},l.getAvailableSpaceAtEnd=function(a){var b=this.getNbNotes();return this.getAvailableSpaceRightToLeft(a,b)},l.getAvailableSpaceRightToLeft=function(b,c,d){for(var e=0,f=c-1;f>=b;f--){if(this.isBlockingAdd(f,d))return e;var g=this.getNote(f);e+=a.getDuration(g)}return e},l.isBlockingAdd=function(a,b){return!this.isRest(a)||!this.isSameTimeModifAt(a,b)},l.isSameTimeModifAt=function(a,b){var d=this.getTimeModifAt(a),e=this.timeModifOrOwn(b);return c.isSame(d,e)},l.getTimeModifAt=function(b){var c=this.getNote(b);return a.getTimeModif(c)},l.getNote=function(a){return this.gracesList.getNote(a)},l.isUnpitched=function(b){var c=this.getNote(b);return a.hasUnpitched(c)},l.isOnlyRests=function(){for(var a=this.getNbNotes(),b=0;b<a;b++)if(!this.isRest(b))return!1;return!0},l.isRest=function(b){if(this.isChord(b))return!1;var c=this.getNote(b);return a.isRest(c)},l.isChord=function(a){return this.gracesList.isChord(a)},l.getChord=function(a){return this.gracesList.getChord(a)},l.isGraceChord=function(a,b){return this.gracesList.isGraceChord(a,b)},l.getGrace=function(a,b){return this.gracesList.getGrace(a,b)},l.getGraceChord=function(a,b){return this.gracesList.getGraceChord(a,b)},l.hasGrace=function(a){return this.gracesList.hasGrace(a)},l.getNbGraces=function(a){return this.gracesList.getNbGraces(a)},l.getIdx=function(){return this.getVoiceIdx()},l.getVoiceIdx=function(){return this.gracesList.getVoiceIdx()},l.size=function(){return this.getNbNotes()},l.getNbNotes=function(){return this.gracesList.getNbNotes()},l.getTupletLevel=function(){return 0},l.timeModifOrOwn=function(a){return void 0!==a?a:this.getAbsoluteTimeModif()},l.getAbsoluteTimeModif=function(){return c.createDefault()},l.getLocalTimeModif=function(){return c.createDefault()},l.getStartNoteIdx=function(){return 0},l.getStopNoteIdx=function(){return this.getNbNotes()-1},l.isTuplet=function(){return!1}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.typeUtils,c=Adagio.Error.WTFError,d=Adagio.Error.InternalError,e=Adagio.Data.ChordsList=function(a,b){b=b||0,this.voicesList=null,this.notes=[],this.idx=b,this.init(a)};e.createFromVoicesList=function(a,b){var c=a.getVoice(b),d=new e(c,b);return d.setVoicesList(a),d};var f=e.prototype;f.init=function(a){a.forEach(this.initAddNote,this)},f.setVoicesList=function(a){this.voicesList=a},f.hasVoicesList=function(){return null!==this.voicesList},f.initAddNote=function(b){a.isChord(b)?this.initAddNoteToChord(b):this.notes.push(b)},f.initAddNoteToChord=function(a){if(0===this.notes.length){throw new c("try to create chord on en empty voice")}var b=this.notes.length-1;this.addNoteToChord(a,b,!0)},f.makeChord=function(a){var d=this.notes[a];if(b.isArray(d)){throw new c("note is already a chord")}this.notes[a]=[d]},f.getNote=function(a){return this.isChord(a)?this.notes[a][0]:this.notes[a]},f.insertNote=function(a,b){if(this.assertInsertionIdx(b),this.assertNoteVoiceIdx(a),this.notes.splice(b,0,a),this.hasVoicesList()){var c=this.getIdxInVoiceNotes(b);this.voicesList.addNoteToVoice(a,c,this.getVoiceIdx())}},f.removeNote=function(a){var b;if(b="number"==typeof a?a:this.indexOf(a),this.assertNoteIdx(b),this.isChord(b)){throw new c("Cannot remove note at idx "+b+" because it is a chord. Remove sub-notes first")}var d=this.getIdxInVoiceNotes(b);this.notes.splice(b,1),this.hasVoicesList()&&this.voicesList.removeNoteFromVoice(d,this.getVoiceIdx())},f.indexOf=function(a){return this.notes.indexOf(a)},f.removeNoteFromChord=function(b,d){if(this.checkIdxInChord(b,d),!this.isChord(b)){throw new c("Cannot remove chord note at idx "+b+" because it is not a chord. Use removeNote instead")}var e=this.getIdxInVoiceNotes(b,d),f=this.getChord(b);if(0===d){var g=a.removeChordData(f[0]);a.addChordData(f[1],g),i(f[1])}f.splice(d,1),1===f.length&&this.makeNote(b),this.hasVoicesList()&&this.voicesList.removeNoteFromVoice(e,this.getVoiceIdx())},f.addNoteToChord=function(b,c,d){this.assertNotRest(c),this.assertNoteVoiceIdx(b),this.isChord(c)||this.makeChord(c);var e=this.getChord(c),f=g(e,b);if(0===f){var i=e[0],j=a.removeChordData(i);a.addChordData(b,j),h(i)}else h(b);if(e.splice(f,0,b),!d&&this.hasVoicesList()){var k=this.getIdxInVoiceNotes(c,f);this.voicesList.addNoteToVoice(b,k,this.getVoiceIdx())}},f.getIdxInVoiceNotes=function(a,b){b=b||0;for(var c=0,d=0;d<a;d++)if(this.isChord(d)){var e=this.getChord(d);c+=e.length}else c++;return this.isChord(d)&&(c+=b),c};var g=function(a,b){for(var c=0;c<a.length;c++){if(a[c].duration<b.duration)return c}return c};f.assertNotRest=function(a){if(this.isRest(a)){var b="The operation on the note at index ["+a+"] is not possible on rests. ",c=new d("NotPossibleOnRests",b);throw c.noteIdx=a,c}},f.isRest=function(b){if(this.isChord(b))return!1;var c=this.getNote(b);return a.isRest(c)},f.checkIdxInChord=function(a,b){var e;if(!this.isChord(a))throw e="Trying to edit a note as a chord",new c(e);var f=this.getChord(a);if("number"!=typeof b||b<0||b>=f.length){e="Bad chord idx ["+b+"] for the note at idx ["+a+"].";var g=new d("BadChordIdx",e);throw g.noteIdx=a,g.chordIdx=b,g}},f.makeNote=function(a){var d=this.notes[a];if(!b.isArray(d)){throw new c("The chord is already a single note")}this.notes[a]=d[0]},f.assertNoteVoiceIdx=function(b){var c=a.getVoiceIdx(b),e=this.getVoiceIdx();if(c!==e){var f="The note voiceIdx ["+c+"] do not match the own voice voiceIdx ["+e+"]. ",g=new d("BadVoiceIdx",f);throw g.voiceIdx=c,g}},f.getVoiceIdx=function(){return this.idx},f.assertInsertionIdx=function(a){var b=this.getNbNotes();if("number"!=typeof a||a<0||a>b){var c="Invalid note idx for insertion: ["+a+"]. ",e=new d("BadInsertionNoteIdx",c);throw e.noteIdx=a,e}},f.isChord=function(a){return this.assertNoteIdx(a),b.isArray(this.notes[a])},f.getChord=function(a){return this.assertNoteIdx(a),this.notes[a]},f.assertNoteIdx=function(a){var b=this.getNbNotes();if("number"!=typeof a||a<0||a>=b){var c="Invalid note idx for get: ["+a+"]. ",e=new d("BadNoteIdx",c);throw e.noteIdx=a,e}},f.getNbNotes=function(){return this.notes.length};var h=function(a){a.chord={}},i=function(a){delete a.chord}}.call(this),function(){"use strict";var a=Adagio.Error.WTFError,b=Adagio.Error.InternalError,c=Adagio.Utils.noteUtils,d=Adagio.Utils.typeUtils,e=Adagio.Utils.math,f=Adagio.Data.GracesList=function(a){this.chordsList=a,this.notes=k(a)},g=f.prototype;g.getVoiceIdx=function(){return this.chordsList.getVoiceIdx()},g.getNote=function(a){return this.assertNoteIdx(a),this.isChord(a)?this.notes[a].note[0]:this.notes[a].note},g.isChord=function(a){return this.assertNoteIdx(a),d.isArray(this.notes[a].note)},g.getChord=function(a){return this.assertNoteIdx(a),this.notes[a].note},g.getGrace=function(a,b){return this.isGraceChord(a,b)?this.notes[a].graces[b][0]:this.notes[a].graces[b]},g.isGraceChord=function(a,b){return this.assertGraceIdx(a,b),d.isArray(this.notes[a].graces[b])},g.getGraceChord=function(a,b){return this.assertGraceIdx(a,b),this.notes[a].graces[b]},g.assertGraceIdx=function(a,c){var d=this.getNbGraces(a);if(!e.isNumber(c)||c<0||c>=d){var f="Invalid graceIdx for get: ["+c+"] at the noteIdx ["+a+"]. ",g=new b("BadGraceIdx",f);throw g.noteIdx=a,g.graceIdx=c,g}},g.insertNote=function(a,b){this.assertInsertionIdx(b);var c=this.getInsertIdxInChordsList(b);this.chordsList.insertNote(a,c);var d={note:a,graces:[]};this.notes.splice(b,0,d)},g.assertInsertionIdx=function(a){var c=this.getNbNotes();if(!e.isNumber(a)||a<0||a>c){var d="Invalid note idx for insertion: ["+a+"]. ",f=new b("BadInsertionNoteIdx",d);throw f.noteIdx=a,f}},g.getInsertIdxInChordsList=function(b){if(b>this.getNbNotes())throw new a;for(var c,d=0,e=0;e<b;e++)c=this.getNbGraces(e),d+=c,d++;return d},g.removeNote=function(a){var b;b="number"==typeof a?a:this.indexOf(a),this.assertNoteIdx(b),this.assertNoGrace(b);var c=this.getIdxInChordsList(b);this.chordsList.removeNote(c),this.notes.splice(b,1)},g.indexOf=function(a){return this.notes.findIndex(h,a)};var h=function(a){var b=this;return a.note===b};g.indexOfGrace=function(a,b){return this.assertNoteIdx(a),this.notes[a].graces.findIndex(i,b)};var i=function(a){return a===this};g.assertNoGrace=function(a){if(this.hasGrace(a)){var c="Cannot remove the note at idx ["+a+"] because it is has grace notes associated with. Remove grace notes first",d=new b("StillHasGrace",c);throw d.noteIdx=a,d}},g.hasGrace=function(a){return this.getNbGraces(a)>0},g.getNbGraces=function(a){return this.assertNoteIdx(a),this.notes[a].graces.length},g.removeNoteFromChord=function(a,b){this.assertNoteIdx(a);var c=this.getIdxInChordsList(a);this.chordsList.removeNoteFromChord(c,b),this.refreshNote(a,c)},g.addNoteToChord=function(a,b){this.assertNoteIdx(b);var c=this.getIdxInChordsList(b);this.chordsList.addNoteToChord(a,c),this.refreshNote(b,c)},g.assertNoteIdx=function(a){var c=this.getNbNotes();if(!e.isNumber(a)||a<0||a>=c){var d="Invalid note idx for get: ["+a+"]. ",f=new b("BadNoteIdx",d);throw f.noteIdx=a,f}},g.getIdxInChordsList=function(b){if(b>=this.getNbNotes())throw new a;for(var c,d=0,e=0;e<b;e++)c=this.getNbGraces(e),d+=c,d++;return c=this.getNbGraces(e),d+=c},g.refreshNote=function(a,b){var c=this.notes[a];this.chordsList.isChord(b)?c.note=this.chordsList.getChord(b):c.note=this.chordsList.getNote(b)},g.insertGrace=function(a,b,c){this.assertNotRest(b,c),this.assertGraceInsertionIdx(b,c);var d=this.getGraceIdxInChordsList(b,c);this.chordsList.insertNote(a,d),this.notes[b].graces.splice(c,0,a)},g.assertNotRest=function(a){if(this.isRest(a)){var c="The operation on the note at index ["+a+"] is not possible on rests. ",d=new b("NotPossibleOnRests",c);throw d.noteIdx=a,d}},g.isRest=function(a){if(this.isChord(a))return!1;var b=this.getNote(a);return c.isRest(b)},g.assertGraceInsertionIdx=function(a,c){var d=this.getNbGraces(a);if(!e.isNumber(c)||c<0||c>d){var f="Invalid graceIdx for insert: ["+c+"] at the noteIdx ["+a+"]. ",g=new b("BadGraceInsertionIdx",f);throw g.noteIdx=a,g.graceIdx=c,g}},g.removeGrace=function(a,b){this.assertGraceIdx(a,b);var c=this.getGraceIdxInChordsList(a,b);this.chordsList.removeNote(c),this.notes[a].graces.splice(b,1)},g.addGraceToChord=function(a,b,c){this.assertGraceIdx(b,c);var d=this.getGraceIdxInChordsList(b,c);this.chordsList.addNoteToChord(a,d),this.refreshGrace(b,c,d)},g.removeGraceFromChord=function(a,b,c){this.assertGraceIdx(a,b);var d=this.getGraceIdxInChordsList(a,b);this.chordsList.removeNoteFromChord(d,c),this.refreshGrace(a,b,d)},g.getGraceIdxInChordsList=function(b,c){if(b>=this.getNbNotes())throw new a;for(var d,e=0,f=0;f<b;f++)d=this.getNbGraces(f),e+=d,e++;if(d=this.getNbGraces(f),c>d)throw new a;return e+=c},g.refreshGrace=function(a,b,c){var d=this.notes[a];this.chordsList.isChord(c)?d.graces[b]=this.chordsList.getChord(c):d.graces[b]=this.chordsList.getNote(c)},g.getNbNotes=function(){return this.notes.length};var j=null,k=function(a){return l().build(a)},l=function(){return null===j&&(j=new m),j},m=function(){},n=m.prototype;n.build=function(a){this.chordsList=a,this.notes=[],this.noteContainer=null;for(var c=this.chordsList.getNbNotes(),d=0;d<c;d++)this.addNote(d);if(null!==this.noteContainer){throw new b("Unexpected","Some grace notes are not connected to any data")}return this.notes},n.addNote=function(a){var b=this.chordsList.getNote(a);c.isGraceNote(b)?this.addGraceNote(a):this.addStandardNote(a)},n.addGraceNote=function(a){var b=this.getNoteContainer(),c=this.getNoteData(a);b.graces.push(c)},n.addStandardNote=function(a){var b=this.getNoteContainer(),c=this.getNoteData(a);b.note=c,this.notes.push(b),this.noteContainer=null},n.getNoteContainer=function(){return null===this.noteContainer&&(this.noteContainer={note:null,graces:[]}),this.noteContainer},n.getNoteData=function(a){return this.chordsList.isChord(a)?this.chordsList.getChord(a):this.chordsList.getNote(a)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils;Adagio.Data.BarlineList=function(b){this.measure=b,this.barlinelist=a.getBarlines(b)};var b=Adagio.Data.BarlineList.prototype;b.getAtPos=function(a){for(var b=0;b<this.barlinelist.length;b++)if(this.barlinelist[b].$location===a)return this.barlinelist[b];return null},b.insertBarline=function(a){this.barlinelist.push(a)},b.removeBarline=function(a){var b=this.barlinelist.indexOf(a);this.barlinelist.splice(b,1)},b.commit=function(){a.setBarlines(this.measure,this.barlinelist)}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils;Adagio.Data.tuplet.getTupletLevel=function(b,c){for(var d=0,e=0;e<=c;e++){if(e>0){var f=b.getNote(e-1);a.hasTupletStop(f)&&(d=a.getTupletStopLevel(g)-1)}var g=b.getNote(e);a.hasTupletStart(g)&&(d=a.getTupletStartLevel(g))}return d}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.noteUtils,c="NoteIdxOutOfTuplet",d=Adagio.Data.tuplet.Tuplet=function(a,b,c,d){this.init(a,b,c,d)},e=d.prototype;e.init=function(a,b,c,d){this.voice=a,this.nbNotes=c,this.startNoteIdx=b,this.tupletLevel=d,this.localTimeModif=null,this.absoluteTimeModif=null,this.durationType=null,this.tupletBuffer=null},e.getNote=function(a){return this.assertNoteIdx(a),this.voice.getNote(a)},e.getTupletLevel=function(){return this.tupletLevel},e.insertNote=function(a,b){if(this.assertInsertionIdx(b),0===this.getNbNotes())this.tupletBufferToNote(a);else if(b===this.getStartNoteIdx()){var c=this.getStartNote();this.transfertTupletStarts(c,a)}else if(b===this.getStopNoteIdx()+1){var d=this.getStopNote();this.transfertTupletStops(d,a)}this.voice.insertNote(a,b),this.nbNotes++},e.removeNote=function(a){this.assertNoteIdx(a);var b=this.getAbsoluteTimeModif(),c=this.getNote(a);if(this.voice.removeNote(a,b),this.nbNotes--,0===this.getNbNotes())this.noteToTupletBuffer(c);else if(a===this.getStartNoteIdx()){var d=this.getStartNote();this.transfertTupletStarts(c,d)}else if(a===this.getStopNoteIdx()+1){var e=this.getStopNote();this.transfertTupletStops(c,e)}},e.transfertTupletStarts=function(a,c){var d=this.getTupletLevel(),e=b.getTupletStartsWithin(a,d);b.removeTupletStartsWithin(a,d),b.addTupletBounds(c,e)},e.transfertTupletStops=function(a,c){var d=this.getTupletLevel(),e=b.getTupletStopsWithin(a,d);b.removeTupletStopsWithin(a,d),b.addTupletBounds(c,e)},e.noteToTupletBuffer=function(c){if(null!==this.tupletBuffer){throw new a("TupletBufferFull","The tuplet buffer is already full.")}var d=b.getTupletBounds(c);b.removeTupletBounds(c),this.tupletBuffer=d},e.tupletBufferToNote=function(c){if(null===this.tupletBuffer){throw new a("TupletBufferEmpty","The tuplet buffer is empty.")}var d=this.tupletBuffer;b.addTupletBounds(c,d),this.tupletBuffer=null},e.isRest=function(a){return this.assertNoteIdx(a),this.voice.isRest(a)},e.getStartNote=function(){var a=this.getStartNoteIdx();return this.getNote(a)},e.getStartNoteIdx=function(){return this.startNoteIdx},e.getStopNote=function(){var a=this.getStopNoteIdx();return this.getNote(a)},e.getStopNoteIdx=function(){return this.getStartNoteIdx()+this.getNbNotes()-1},e.getIdx=function(){return this.voice.getIdx()},e.assertInsertionIdx=function(b){var d=this.getNbNotes,e=this.getStartNoteIdx(),f=e+d;if("number"!=typeof b||b<e||b>f){throw new a(c,"The note idx ["+b+"] is outside of the tuplet range.")}},e.assertNoteIdx=function(b){var d=this.getNbNotes,e=this.getStartNoteIdx(),f=e+d;if("number"!=typeof b||b<e||b>=f){throw new a(c,"The note idx ["+b+"] is outside of the tuplet range.")}},e.getSpaceFromIdx=function(a){var b=this.getStopNoteIdx()+1;return this.voice.getRangeSpace(a,b)},e.getAvailableSpaceAtIdx=function(a){var b=this.getStopNoteIdx()+1,c=this.getAbsoluteTimeModif();return this.voice.getAvailableSpaceLeftToRight(a,b,c)},e.getAvailableSpaceAtEnd=function(a){var b=this.getStopNoteIdx()+1,c=this.getAbsoluteTimeModif();return this.voice.getAvailableSpaceRightToLeft(a,b,c)},e.size=function(){return this.getNbNotes()},e.getNbNotes=function(){return this.nbNotes},e.getAbsoluteTimeModif=function(){return this.absoluteTimeModif},e.getLocalTimeModif=function(){return this.localTimeModif},e.getDurationType=function(){return this.durationType},e.isTuplet=function(){return!0},e.isOnlyRests=function(){for(var a=this.getStartNoteIdx(),b=this.getStopNoteIdx(),c=a;c<=b;c++)if(!this.isRest(c))return!1;return!0}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.noteUtils,c=Adagio.Utils.timeModifUtils,d=Adagio.Utils.tupletBoundUtils;Adagio.Data.tuplet.fillTimeModif=function(a){var b=a.getStartNote(),c=a.getTupletLevel(),d=e(b,c),g=f(b,c),i=h(b,c);a.localTimeModif=d,a.absoluteTimeModif=g,a.durationType=i};var e=function(a,c){var e=b.getTupletStart(a,c);return d.getTimeModif(e)},f=function(e,f){var h=b.getTupletStarts(e);h=h.slice(),h.sort(g);for(var i=h.length,j=b.getTimeModif(e),k=0;k<i;k++){var l=h[k];if(d.getLevel(l)===f)return j;var m=d.getTimeModif(j);j=c.removeLocal(j,m)}throw new a("Unexpected","was not able to find the absolute time modification.")},g=function(a,b){var c=d.getLevel(a);return d.getLevel(b)-c},h=function(a,c){var e=b.getTupletStart(a,c);return d.getDurationType(e)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.noteUtils,c=Adagio.Data.tuplet.Tuplet,d=Adagio.Data.tuplet.fillTimeModif;Adagio.Data.tuplet.createTupletView=function(b,c,f){if(b.isTuplet()){throw new a("AlreadyTuplet","Cannot extract a tuplet from a tuplet.")}if(0===f)return b;var g=new e(b,c,f);g.search();var h=g.create();return d(h),h};var e=function(a,b,c){this.init(a,b,c)},f=e.prototype;f.init=function(a,b,c){this.voice=a,this.selectedNoteIdx=b,this.selectedTupletLevel=c},f.search=function(){this.tupletLevel=0,this.searchLowerBound(),this.searchUpperBound()},f.searchLowerBound=function(){for(var c=0,d=0,e=0;e<=this.selectedNoteIdx;e++){if(e>0){var f=this.voice.getNote(e-1);b.hasTupletStop(f)&&(c=b.getTupletStopLevel(g)-1)}var g=this.voice.getNote(e);if(b.hasTupletStart(g)){var h=b.getTupletStartLevel(g);c<this.selectedTupletLevel&&h>=this.selectedTupletLevel&&(d=e),c=h}}if(c<this.selectedTupletLevel){var i="There are no tuplet of the level ["+this.selectedTupletLevel+"] for the note idx ["+this.selectedNoteIdx+"].";throw new a("NoTupletLevel",i)}this.lowBound=d,this.currentTupletLevel=c},f.searchUpperBound=function(){for(var a=this.currentTupletLevel,c=this.selectedNoteIdx;a>=this.selectedTupletLevel;c++){var d=this.voice.getNote(c);b.hasTupletStop(d)&&(a=b.getTupletStopLevel(d)-1)}this.tupletSize=c-this.lowBound},f.create=function(){return this.isVoice()?this.voice:this.createTuplet()},f.isVoice=function(){return 0===this.lowBound&&this.tupletSize===this.voice.getNbNotes()&&0===this.selectedTupletLevel},f.createTuplet=function(){return new c(this.voice,this.lowBound,this.tupletSize,this.currentTupletLevel)}}.call(this),function(){"use strict";var a=Adagio.Data.tuplet.getTupletLevel,b=Adagio.Data.tuplet.createTupletView,c=Adagio.Error.InternalError,d=Adagio.Data.tuplet.TupletCache=function(a){this.init(a)},e=d.prototype;e.init=function(a){this.voice=a,this.tuplet=null},e.initWithVoice=function(){this.tuplet=this.voice},e.getTupletForInsert=function(a){if(this.hasTuplet())return this.assertInsertionIdx(a),this.tuplet;throw new c("NoTuplet","Cannot create a tuplet when seeking the insertion point: there might be two possible tuplet for the note idx")},e.getTupletForGet=function(a){return this.hasTuplet()?(this.assertNoteIdx(a),this.tuplet):(this.createTuplet(a),this.tuplet)},e.clear=function(){this.tuplet=null},e.hasTuplet=function(){return null!==this.tuplet},e.assertInsertionIdx=function(a){this.tuplet.assertInsertionIdx(a)},e.assertNoteIdx=function(a){this.tuplet.assertNoteIdx(a)},e.createTuplet=function(c){var d=a(this.voice,c);this.tuplet=b(this.voice,c,d)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Data.Divisions,c=Adagio.Data.VoicesList,d=Adagio.Data.Voice,e=Adagio.Data.ChordsList,f=Adagio.Data.GracesList,g=Adagio.Data.BarlineList,h=Adagio.Data.tuplet.TupletCache,i=Adagio.edit.common.MeasureData=function(a,b,c,d){this.init(a,b,c,d)},j=i.prototype;j.init=function(a,b,c,d){this.data=a,this.idx=b,this.scroller=c||null,this.scoreData=d||null,this.divisions=null,this.voicesList=null,this.barlineList=null,this.voices={},this.tupletCaches={},this.clefs=null,this.staffsDetails=null,this.keys=null,this.times=null,this.transposes=null,null!==this.scroller&&this.scroller.registerMeasureData(this)},j.getIdx=function(){return this.idx},j.getDivisions=function(){return null===this.divisions&&(this.divisions=new b(this.data)),this.divisions},j.getDpqValue=function(){return this.getDivisionsPerQuarterValue()},j.getDivisionsPerQuarterValue=function(){return this.getDivisions().getDivisions()},j.checkVoiceIdx=function(a){this.getVoicesList().checkVoiceIdx(a)},j.getStaffNbVoices=function(a){var b=this.getScoreData(),c=this.getPartIdx(),d=b.getPartStaffVoicesIndexes(c,a);return d=d.filter(this.hasVoice,this),d.length},j.hasVoice=function(a){return this.getVoicesList().hasVoice(a)},j.getAnyVoice=function(){var a=this.getVoicesIndexes(),b=a[0];return this.getVoice(b)},j.getVoice=function(a){var b=this.voices[a];if(void 0===b){var c=this.getVoicesList(),g=e.createFromVoicesList(c,a),h=new f(g);b=new d(h),this.voices[a]=b}return b},j.removeVoice=function(a){this.getVoicesList().removeVoice(a),delete this.voices[a],delete this.tupletCaches[a]},j.clearVoicesCache=function(){this.voices={}},j.forEachVoice=function(a,b){for(var c=this.getVoicesIndexes(),d=c.length,e=0;e<d;e++){var f=c[e],g=this.getVoice(f);a.call(b,g,f)}},j.getVoicesIndexes=function(){return this.getVoicesList().getVoicesIndexes()},j.getVoicesList=function(){return null===this.voicesList&&(this.voicesList=new c(this.data)),this.voicesList},j.getNbStaves=function(){return a.getNbStaves(this.data)},j.getAttributes=function(){return a.getAttributes(this.data)},j.getClef=function(a){return this.getClefs().getEntry(a)},j.getClefs=function(){return null===this.clefs&&(this.clefs=a.getWrappedClef(this.data)),this.clefs},j.getStaffDetails=function(a){return this.getStaffsDetails().getEntry(a)},j.getStaffsDetails=function(){return null===this.staffsDetails&&(this.staffsDetails=a.getWrappedStaffDetailsOrDefault(this.data)),this.staffsDetails},j.getKey=function(a){return this.getKeys().getEntry(a)},j.getKeys=function(){return null===this.keys&&(this.keys=a.getWrappedKey(this.data)),this.keys},j.getAnyTime=function(){return this.getTimes().getAnyEntry()},j.getTime=function(a){return this.getTimes().getEntry(a)},j.getTimes=function(){return null===this.times&&(this.times=a.getWrappedTime(this.data)),this.times},j.getTranspose=function(a){return this.getTransposes().getEntry(a)},j.getTransposes=function(){return null===this.transposes&&(this.transposes=a.getWrappedTranspose(this.data)),this.transposes},j.getBarlineList=function(){return null===this.barlineList&&(this.barlineList=new g(this.data)),this.barlineList},j.getPreviousMeasure=function(){var a=this.idx-1;return this.scroller.getMeasureData(a)},j.hasPreviousMeasure=function(){return this.idx-1>=0},j.getNextMeasure=function(){var a=this.idx+1;return this.scroller.getMeasureData(a)},j.hasNextMeasure=function(){return this.idx+1<this.getNbMeasures()},j.getNbMeasures=function(){return this.scroller.getNbMeasures()},j.getPartIdx=function(){return this.scroller.getPartIdx()},j.searchUnpitchedInstrumentId=function(a){var b=this.getPartIdx();return this.scoreData.searchUnpitchedInstrumentId(b,a)},j.hasUnpitchedInstrument=function(a){var b=this.getPartIdx();return this.scoreData.hasUnpitchedInstrument(b,a)},j.isUnpitched=function(){var a=this.getPartIdx();return this.scoreData.isPartUnpitched(a)},j.initTupletCacheWithVoice=function(a){this.getTupletCache(a).initWithVoice()},
j.getVoiceOrTupletForInsert=function(a,b){return this.getTupletCache(a).getTupletForInsert(b)},j.getVoiceOrTupletForGet=function(a,b){return this.getTupletCache(a).getTupletForGet(b)},j.getTupletCache=function(a){if(void 0===this.tupletCaches[a]){var b=this.getVoice(a);this.tupletCaches[a]=new h(b)}return this.tupletCaches[a]},j.getDivisionsPerQuarterValue=function(){return this.getDivisions().getDivisions()},j.clearTupletCache=function(a){this.getTupletCache(a).clear()},j.getMeasure=function(){return this.data},j.getScoreData=function(){return this.scoreData},j.getMeasuresScroller=function(){return this.scroller},j.getVoiceMainStaffIdx=function(a){var b=this.getScoreData(),c=this.getPartIdx();return b.getPartVoiceMainStaffIdx(c,a)},j.getScoreData=function(){return this.scoreData}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.BadMeasureIdxError=function(d,e){void 0===e&&(e=b.GET);var f=c(d,e),g=a.call(this,f);return this.name=g.name="BadMeasureIdxError",this.stack=g.stack,this.message=g.message,this.measureIdx=d,this.action=e,this},c=function(a,b){return b.msgPrefix+" measure at the index ["+a+"<"+typeof a+">]."};b.prototype=Object.create(a.prototype,{constructor:{value:b}}),b.INSERT={msgPrefix:"Cannot insert"},b.GET={msgPrefix:"There is no"}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Error.client.BadMeasureIdxError,c=Adagio.edit.common.MeasureData,d=Adagio.Utils.math,e=Adagio.edit.common.MeasuresScroller=function(a,b,c){this.init(a,b,c)},f=e.prototype;f.init=function(a,b,c){this.measures=a,this.partIdx=b,this.scoreData=c||null,this.measureDataMap={}},f.registerMeasureData=function(b){var c=b.getIdx();if(this.checkMeasureIdx(c),this.hasMeasureData(c)){throw new a("MeasureIdxAlreadyUsed","the measure idx "+b+" is already used.")}this.hasMeasureData[c]=b},f.checkMeasureIdx=function(a){var c=this.getNbMeasures();if(!d.isInteger(a)||a<0||a>=c)throw new b(a)},f.getNbMeasures=function(){return this.measures.length},f.hasMeasureData=function(a){return void 0!==this.measureDataMap[a]},f.getMeasureData=function(a){if(this.checkMeasureIdx(a),this.hasMeasureData(a))return this.measureDataMap[a];var b=this.measures[a];return new c(b,a,this,this.scoreData)},f.getPartIdx=function(){return this.partIdx},f.hasScoreData=function(){return null!==this.scoreData},f.getScoreData=function(){return this.scoreData}}.call(this),function(){"use strict";var a=Adagio.Utils.partContentUtils,b=Adagio.edit.common.MeasureData,c=Adagio.edit.common.MeasuresScroller;Adagio.edit.common.createScrollableMeasureData=function(d,e,f){var g=d.getPartContent(e),h=a.getMeasures(g),i=new c(h,e,d),j=d.getMeasure(e,f);return new b(j,f,i,d)}}.call(this),function(){"use strict";var a=Adagio.edit.common.MeasureData,b=Adagio.edit.common.createScrollableMeasureData;Adagio.edit.common.initMeasureData=function(c,d){c instanceof a?(null!==c.scoreData&&(c.scoreData.checkPartIdx(d.partIdx),c.scoreData.checkMeasureIdx(d.measureIdx)),this.measureData=c):this.measureData=b(c,d.partIdx,d.measureIdx),this.attr=this.measureData.getAttributes(),this.opts=d}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Values.OctaveShiftSize,c=Adagio.Values.OctaveShiftType,d=Adagio.Utils.directionUtils,e=Adagio.Utils.directionTypeUtils,f=Adagio.Utils.octaveShiftDisplayUtils,g=Adagio.Utils.direction.octaveShiftDirectionUtils={},h=3.5;g.create=function(a,b,c,g,h,i,j){var k={};d.setPlacement(k,b),d.setStaffIdx(k,a),d.setTimePos(k,c);var l=f.create(g,h,i,j),m=e.createOctaveShift(l);return d.setEntry(k,m),k},g.isSame=function(a,b){var c=g.getTimePos(a),d=g.getTimePos(b),e=g.getStaffIdx(a),h=g.getStaffIdx(b),i=g.getPlacement(a),j=g.getPlacement(b),k=g.getType(a),l=g.getType(b),m=f.getSize(a),n=f.getSize(b),o=f.getLocation(b),p=f.getLocation(a),q=f.getNumber(a),r=f.getNumber(b);return c===d&&e===h&&i===j&&k===l&&m===n&&p===o&&q===r},g.getTimePos=function(a){return d.getTimePos(a)},g.getStaffIdx=function(a){return d.getStaffIdx(a)},g.getPlacement=function(a){return d.getPlacement(a)},g.getType=function(a){return d.getDisplayOctaveShiftType(a)},g.getSize=function(a){return d.getDisplayOctaveShiftSize(a)},g.getLocation=function(a){return d.getDisplayOctaveShiftLocation(a)},g.getNumber=function(a){return d.getDisplayOctaveShiftNumber(a)},g.isStart=function(a){var b=g.getType(a);return c.isStart(b)},g.isStop=function(a){var b=g.getType(a);return c.isStop(b)},g.applyShiftToLine=function(a,b){var c=g.getOctaveChange(a);return b-=h*c},g.removeShiftFromLine=function(a,b){var c=g.getOctaveChange(a);return b+=h*c},g.getOctaveChange=function(d){var e=g.getSize(d),f=g.getType(d),h=b.sizeToOctaveShift(e);if(f===c.DOWN)return h;if(f===c.UP)return-h;throw new a("Unexpected")}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.direction.octaveShiftDirectionUtils,c=Adagio.Values.OctaveShiftType;Adagio.Data.octaveShift.searchOctaveShift=function(a,b,c,e){b=b.sort(d);var g=new f(a,b,c,e);return g.search(),g.getOctaveShift()};var d=function(a,c){var d=b.getTimePos(a),f=b.getTimePos(c),g=d-f;if(0!==g)return g;var h=b.getType(a),i=b.getType(c);return e(h,i)},e=function(a,b){return a===c.UP||a===c.DOWN&&b===c.STOP?1:a===c.STOP&&b===c.UP||b===c.DOWN?-1:0},f=function(a,b,c,d){this.init(a,b,c,d)},g=f.prototype;g.init=function(a,b,c,d){this.currentOctaveShift=a,this.octaveShifts=b,this.searchedTimePosition=c,this.excludeBoundaries=!!d},g.search=function(){this.octaveShifts.some(this.analyzeOctaveShift,this)},g.analyzeOctaveShift=function(a){var d=b.getTimePos(a);if(d>this.searchedTimePosition)return!0;var e=b.getType(a);return e!==c.UP&&e!==c.DOWN||this.startOctaveShift(a),d===this.searchedTimePosition&&!this.excludeBoundaries||(e===c.STOP&&this.stopOctaveShift(),!1)},g.startOctaveShift=function(b){if(null!==this.currentOctaveShift)throw new a("Unexpected","There is already a octave shift");this.currentOctaveShift=b},g.stopOctaveShift=function(){if(null===this.currentOctaveShift){throw new a("Unexpected","There is no octave shift to stop.")}this.currentOctaveShift=null},g.getOctaveShift=function(){return this.currentOctaveShift}}.call(this),function(){"use strict";var a=Adagio.Utils.directionUtils,b=Adagio.Utils.directionTypeUtils,c=Adagio.Utils.pedalDisplayUtils,d=Adagio.Values.PedalType,e=Adagio.Utils.direction.pedalDirectionUtils={};e.create=function(d,e,f,g){var h={};a.setPlacement(h,e),a.setStaffIdx(h,d),a.setTimePos(h,f);var i=c.create(g),j=b.createPedal(i);return a.setEntry(h,j),h},e.isSame=function(a,b){var c=e.getTimePos(a),d=e.getTimePos(b),f=e.getStaffIdx(a),g=e.getStaffIdx(b),h=e.getPlacement(a),i=e.getPlacement(b),j=e.getType(a),k=e.getType(b);return c===d&&f===g&&h===i&&j===k},e.getTimePos=function(b){return a.getTimePos(b)},e.getStaffIdx=function(b){return a.getStaffIdx(b)},e.getPlacement=function(b){return a.getPlacement(b)},e.isStart=function(b){var c=a.getPedalType(b);return d.isStart(c)},e.isStop=function(b){var c=a.getPedalType(b);return d.isStop(c)},e.getType=function(b){return a.getPedalType(b)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.direction.pedalDirectionUtils,c=Adagio.Values.PedalType;Adagio.Data.pedal.searchPedal=function(a,b,c){b=b.sort(d);var e=new f(a,b,c);return e.search(),e.getPedal()};var d=function(a,c){var d=b.getTimePos(a),f=b.getTimePos(c),g=d-f;if(0!==g)return g;var h=b.getType(a),i=b.getType(c);return e(h,i)},e=function(a,b){return a===c.START&&b===c.STOP?1:a===c.STOP&&b===c.START?-1:0},f=function(a,b,c){this.init(a,b,c)},g=f.prototype;g.init=function(a,b,c){this.currentPedal=a,this.pedals=b,this.searchedTimePosition=c},g.search=function(){this.pedals.some(this.analyzePedal,this)},g.analyzePedal=function(a){var d=b.getTimePos(a);if(d>this.searchedTimePosition)return!0;var e=b.getType(a);return e===c.START&&this.startPedal(a),d===this.searchedTimePosition||(e===c.STOP&&this.stopPedal(),!1)},g.startPedal=function(b){if(null!==this.currentPedal)throw new a("Unexpected","There is already a pedal");this.currentPedal=b},g.stopPedal=function(){if(null===this.currentPedal){throw new a("Unexpected","There is no pedal to stop.")}this.currentPedal=null},g.getPedal=function(){return this.currentPedal}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.direction.tempoChangeDirectionUtils,c=Adagio.Utils.durationUtils,d=Adagio.Values.TempoChangeType;Adagio.Data.tempoChange.searchTempoChange=function(a,c,d,f){if(4!==arguments.length)throw new Error("DPQ missing");c=c.sort(b.compare);var g=new e(a,c,d,f);return g.search(),g.getTempoChange()};var e=function(a,b,c,d){this.init(a,b,c,d)},f=e.prototype;f.init=function(a,b,d,e){this.currentTempoChange=a,this.tempoChanges=b,this.searchedQuarterPos=c.divisionsToQuarter(d,e)},f.search=function(){this.tempoChanges.some(this.analyzeTempoChange,this)},f.analyzeTempoChange=function(a){var c=b.getQuarterPos(a);if(c>this.searchedQuarterPos)return!0;var e=b.getType(a);return d.isStart(e)&&this.startTempoChange(a),c===this.searchedQuarterPos||(e===d.STOP&&this.stopTempoChange(),!1)},f.startTempoChange=function(b){if(null!==this.currentTempoChange)throw new a("Unexpected","There is already a tempo change");this.currentTempoChange=b},f.stopTempoChange=function(){if(null===this.currentTempoChange){throw new a("Unexpected","There is no tempo change to stop.")}this.currentTempoChange=null},f.getTempoChange=function(){return this.currentTempoChange}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadTupletTypeError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadTupletTypeError",this.stack=e.stack,this.message=e.message,this.tupletType=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"The tuplet type ["+a+"] is invalid."}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Error.value.BadTupletTypeError,c=Adagio.Utils.timeModifUtils,d=Adagio.Utils.typeUtils,e=Adagio.Values.TupletType={DUPLET:"duplet",TRIPLET:"triplet",QUADRUPLET:"quadruplet",QUINTUPLET:"quintuplet",QUINTUPLET_COMPOUND:"quintuplet_compound",SEXTUPLET:"sextuplet",SEPTUPLET:"septuplet",SEPTUPLET_COMPOUND:"septuplet_compound",NONUPLET:"nonuplet",TUPLET_11:"tuplet_11"},f=d.pairsToMap([{key:e.DUPLET,value:{timeModif:c.create(2,3)}},{key:e.TRIPLET,value:{timeModif:c.create(3,2)}},{key:e.QUADRUPLET,value:{timeModif:c.create(4,6)}},{key:e.QUINTUPLET,value:{timeModif:c.create(5,4)}},{key:e.QUINTUPLET_COMPOUND,value:{timeModif:c.create(5,6)}},{key:e.SEXTUPLET,value:{timeModif:c.create(6,4)}},{key:e.SEPTUPLET,value:{timeModif:c.create(7,4)}},{key:e.SEPTUPLET_COMPOUND,value:{timeModif:c.create(7,6)}},{key:e.NONUPLET,value:{timeModif:c.create(9,8)}},{key:e.TUPLET_11,value:{timeModif:c.create(11,8)}}]),g=[e.DUPLET,e.TRIPLET,e.QUADRUPLET,e.QUINTUPLET,e.QUINTUPLET_COMPOUND,e.SEXTUPLET,e.SEPTUPLET,e.SEPTUPLET_COMPOUND,e.NONUPLET,e.TUPLET_11];e.check=function(a){if(!e.isValid(a))throw new b(a)},e.getValues=function(){return g.slice()},e.isValid=function(a){return g.includes(a)},e.getTimeModif=function(a){if(void 0!==f[a]){var b=f[a].timeModif;return c.copy(b)}h(a)},e.fromTimeModif=function(b){for(var d in f){var e=f[d].timeModif;if(c.isSame(b,e))return d}var g="This time modification ["+c.stringify(b)+"]is not supported.";throw new a("Unexpected",g)},e.isTimeModifSupported=function(a){for(var b in f){var d=f[b].timeModif;if(c.isSame(a,d))return!0}return!1};var h=function(b){throw new a("Unexpected","Invalid tuplet type: ["+b+"].")}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.unpitchedUtils,c=Adagio.Utils.pitchLineUtils,d=Adagio.Utils.clefUtils,e=Adagio.Utils.drumsetUtils={},f=d.createPercussion();e.lineToPitch=function(d,e){if(5===e);else if(3===e)d-=1;else{if(1!==e){var g="The number of staff lines ["+e+"] is not supported for unpitched staff.";throw new a("Unexpected",g)}d-=2}return c.toPitch(b,d,f)},e.pitchToLine=function(d,e){var g=c.toLine(b,d,f);if(5===e)return g;if(3===e)return g+1;if(1===e)return g+2;throw new a("Unexpected","The number of staff lines ["+e+"] is not supported for unpitched staff.")},e.hasMIDIUnpitched=function(a,c,d){var e=b.stringify(c);return void 0!==a[e]&&(void 0===d||void 0!==a[e][d])},e.getDefaultMIDIHead=function(c,d){var f;if(e.hasMIDIUnpitched(c,d))return f=b.stringify(d),c[f].default;throw f=b.stringify(d),new a("MIDIUnpitchedNotFound","There is no MIDI unpitched for the pitch ["+f+"].")},e.getMIDIUnpitched=function(c,d,f){var g;if(e.hasMIDIUnpitched(c,d,f))return g=b.stringify(d),c[g][f];throw g=b.stringify(d),new a("MIDIUnpitchedNotFound","There is no MIDI unpitched for the pitch ["+g+"] and notehead ["+f+"]")},e.getHeadsForLine=function(a,c,d){var f=e.lineToPitch(c,d);if(e.hasMIDIUnpitched(a,f)){var h=b.stringify(f),i=Object.keys(a[h]);return i=i.filter(g)}return[]};var g=function(a){return"default"!==a}}.call(this),function(){"use strict";var a=Adagio.Utils.directionUtils,b=Adagio.Utils.directionTypeUtils,c=Adagio.Utils.dynamicDisplayUtils,d=Adagio.Utils.direction.dynamicDirectionUtils={};d.create=function(d,e,f,g,h){var i={};a.setPlacement(i,e),a.setStaffIdx(i,d),a.setTimePos(i,f);var j=c.create(g),k=b.createDynamic(j);return a.setEntry(i,k),null!==h&&a.setSoundDynamic(i,h),i},d.isSame=function(a,b){var c=d.getTimePos(a),e=d.getTimePos(b),f=d.getStaffIdx(a),g=d.getStaffIdx(b),h=d.getPlacement(a),i=d.getPlacement(b),j=d.getStyle(a),k=d.getStyle(b),l=d.getSound(a),m=d.getSound(b);return c===e&&f===g&&h===i&&j===k&&l===m},d.getTimePos=function(b){return a.getTimePos(b)},d.getStaffIdx=function(b){return a.getStaffIdx(b)},d.getPlacement=function(b){return a.getPlacement(b)},d.getStyle=function(b){return a.getDisplayDynamicStyle(b)},d.hasSound=function(b){return a.hasSoundDynamic(b)},d.getSound=function(b){return a.getSoundDynamic(b)}}.call(this),function(){"use strict";var a=Adagio.Utils.directionUtils,b=Adagio.Utils.directionTypeUtils,c=Adagio.Utils.soundUtils,d=Adagio.Values.PizzicatoType,e=Adagio.Utils.direction.pizzicatoDirectionUtils={};e.create=function(e,f,g,h){var i={};a.setPlacement(i,f),a.setStaffIdx(i,e),a.setTimePos(i,g);var j=d.getText(h),k=b.createWord(j);a.setEntry(i,k);var l={};return c.setPizzicato(l,h),a.setSound(i,l),i},e.isSame=function(a,b){var c=e.getTimePos(a),d=e.getTimePos(b),f=e.getStaffIdx(a),g=e.getStaffIdx(b),h=e.getPlacement(a),i=e.getPlacement(b),j=e.getType(a),k=e.getType(b);return c===d&&f===g&&h===i&&j===k},e.getTimePos=function(b){return a.getTimePos(b)},e.getStaffIdx=function(b){return a.getStaffIdx(b)},e.getPlacement=function(b){return a.getPlacement(b)},e.getType=function(b){var d=a.getSound(b);return c.getPizzicato(d)}}.call(this),function(){"use strict";var a=Adagio.Utils.directionUtils,b=Adagio.Utils.directionTypeUtils,c=Adagio.Utils.direction.wordDirectionUtils={};c.create=function(c,d,e,f){var g={};a.setPlacement(g,d),a.setStaffIdx(g,c),a.setTimePos(g,e);var h=b.createWord(f);return a.setEntry(g,h),g},c.isSame=function(a,b){var d=c.getTimePos(a),e=c.getTimePos(b),f=c.getStaffIdx(a),g=c.getStaffIdx(b),h=c.getPlacement(a),i=c.getPlacement(b),j=c.getText(a),k=c.getText(b);return d===e&&f===g&&h===i&&j===k},c.getTimePos=function(b){return a.getTimePos(b)},c.getStaffIdx=function(b){return a.getStaffIdx(b)},c.getPlacement=function(b){return a.getPlacement(b)},c.getText=function(b){return a.getWordText(b)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Values.WedgeLocation={LEFT:"left",RIGHT:"right",LEFT_CONTINUE:"left-continue",RIGHT_CONTINUE:"right-continue"};b.values=[b.LEFT,b.LEFT_CONTINUE,b.RIGHT,b.RIGHT_CONTINUE],b.isValid=function(a){return b.values.includes(a)},b.assert=function(a){b.isValid(a)||b.raiseError(a)},b.isLeft=function(a){return a===b.LEFT||a===b.LEFT_CONTINUE},b.isRight=function(a){return a===b.RIGHT||a===b.RIGHT_CONTINUE},b.isMiddle=function(a){return a===b.LEFT||a===b.RIGHT},b.isContinue=function(a){return a===b.LEFT_CONTINUE||a===b.RIGHT_CONTINUE},b.raiseError=function(b){throw new a("BadWedgeLocation","The wedge location ["+b+"] is invalid.")}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadWedgeTypeError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadWedgeTypeError",this.stack=e.stack,this.message=e.message,this.type=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"The wedge type ["+a+"] is invalid."}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Error.value.BadWedgeTypeError,c=Adagio.Values.WedgeType={CRESCENDO:"crescendo",DIMINUENDO:"diminuendo",STOP:"stop",CONTINUE:"continue"};c.values=[c.CRESCENDO,c.DIMINUENDO,c.STOP,c.CONTINUE],c.internalValues=[c.CRESCENDO,c.DIMINUENDO],c.isValid=function(a){return c.values.includes(a)},c.isValidInternal=function(a){return c.internalValues.includes(a)},c.assert=function(b){if(!c.isValid(b)){throw new a("WedgeType","Invalid value for wedge type: ["+b+"].")}},c.assertInternal=function(a){c.isValidInternal(a)||c.raiseError(a)},c.raiseError=function(b){throw new a("WedgeType","Invalid internal value for wedge type: ["+b+"].")},c.check=function(a){if(!c.isValidInternal(a))throw new b(a)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Values.WedgeType,c=Adagio.Values.WedgeLocation,d=Adagio.Utils.wedgeUtils={},e=0;d.createStartTag=function(a,b){var e=c.LEFT,f=d.create(e,a);return h(f,b),f},d.createStopTag=function(a){var b=c.RIGHT;return d.create(b,a)},d.create=function(a,d){return c.assert(a),b.assertInternal(d),{$adagio:{location:a,type:d},$type:f(a,d)}},d.createRaw=function(a,c){b.assert(a);var e={$type:a};return d.setNumber(e,c),e};var f=function(a,d){return c.isContinue(a)?b.CONTINUE:a===c.LEFT?d:a===c.RIGHT?b.STOP:void c.raiseError(a)};d.fillStartTagInternalValues=function(a,b,d){var e=c.LEFT;g(a,e,b),h(a,d)},d.fillStopTagInternalValues=function(a,b){var d=c.RIGHT;g(a,d,b)};var g=function(e,f,g){c.assert(f),b.assertInternal(g);var h=d.getRawType(e),j=d.create$adagio(e);if(!i(h,f,g)){throw new a("Unexpected","the wedge type ["+g+"] with the location ["+f+"] is not compatible with the raw type ["+h+"].")}j.location=f,j.type=g},h=function(b,c){if("number"!=typeof c){throw new a("NotNumber","The wedge number of notes ["+c+"] is not a number.")}b.$adagio.nbNotes=c},i=function(a,d,e){return d===c.LEFT?a===e:d===c.RIGHT?a===b.STOP:c.isContinue(d)?a===b.CONTINUE:void c.raiseError(d)};d.getRawType=function(a){return a.$type},d.create$adagio=function(b){if(d.has$adagio(b)){throw new a("Already$adagio","The wedge has an unexpected $adagio.")}return b.$adagio={},b.$adagio},d.has$adagio=function(a){return void 0!==a.$adagio},d.isRight=function(a){var b=d.getLocation(a);return c.isRight(b)},d.isLeft=function(a){var b=d.getLocation(a);return c.isLeft(b)},d.isContinue=function(a){var b=d.getLocation(a);return c.isContinue(b)},d.getType=function(a){return d.get$adagio(a).type},d.getLocation=function(a){return d.get$adagio(a).location},d.getNbNotes=function(a){return d.get$adagio(a).nbNotes},d.get$adagio=function(a){return a.$adagio},d.getNumber=function(a){return d.hasNumber(a)?parseInt(a.$number,0)-1:e},d.hasNumber=function(a){return void 0!==a.$number},d.setNumber=function(a,b){b!==e?a.$number=(b+1).toString():delete a.$number},d.hasNbNotes=function(a){return void 0!==d.get$adagio(a).nbNotes},d.copy=function(a){var b;if(d.has$adagio(a)){var c=d.getType(a),e=d.getLocation(a);if(b=d.create(e,c),d.hasNbNotes(a)){var f=d.getNbNotes(a);h(b,f)}return b}var g=d.getRawType(a),i=d.getNumber(a);return b=d.createRaw(g,i)}}.call(this),function(){"use strict";var a=Adagio.Utils.directionUtils;Adagio.Data.wedge.wrappDirectionWedges=function(c){return a.getWedges(c).map(b,c)};var b=function(a){return{direction:this,wedge:a}}}.call(this),function(){"use strict";var a=Adagio.Data.wedge.wrappDirectionWedges;Adagio.Data.wedge.wrappDirectionsWedges=function(b){var c=b.map(a);return Array.prototype.concat.apply([],c)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Values.WedgeLocation,c=Adagio.Utils.directionUtils,d=Adagio.Utils.wedgeUtils;Adagio.Data.wedge.compareWrappedWedges=function(a,b){if(e(a,b),"number"===a.measureIdx){var h=a.measureIdx-b.measureIdx;if(0!==h)return h}var i=c.getTimePos(a.direction),j=c.getTimePos(b.direction),k=i-j;if(0!==k)return k;var l=a.wedge,m=b.wedge;if(f(l,m),d.has$adagio(l)){var n=g(l,m);if(0!==n)return n}return 0};var e=function(b,c){if("number"==typeof b.measureIdx&&"number"!=typeof c.measureIdx||"number"!=typeof b.measureIdx&&"number"==typeof c.measureIdx){throw new a("Unexpected","Cannot compare measureIdx with non measure idx")}},f=function(b,c){if(d.has$adagio(b)&&!d.has$adagio(c)||!d.has$adagio(b)&&d.has$adagio(c)){throw new a("Unexpected","Cannot compare filled with non filled.")}},g=function(c,e){var f=d.getLocation(c),g=d.getLocation(e);if(f===b.LEFT&&g===b.RIGHT)return 1;if(f===b.RIGHT&&g===b.LEFT)return-1;throw new a("Unexpected","Unexpected combination of left wedge location ["+f+"] and right wedge location: ["+g+"].")}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Values.WedgeLocation,c=Adagio.Utils.wedgeUtils,d=Adagio.Utils.directionUtils,e=Adagio.Data.wedge.wrappDirectionsWedges,f=Adagio.Data.wedge.compareWrappedWedges;Adagio.Data.wedge.searchWedgeType=function(a,b,c){var d=e(b);d.sort(f);var h=new g(a,d,c);return h.search(),h.getWedgeType()};var g=function(a,b,c){this.init(a,b,c)},h=g.prototype;h.init=function(a,b,c){this.currentWedge=a,this.wrappedWedges=b,this.searchedTimePosition=c},h.search=function(){this.wrappedWedges.some(this.analyzeWedge,this)},h.analyzeWedge=function(a){var e=d.getTimePos(a.direction);if(e>this.searchedTimePosition)return!0;var f=c.getLocation(a.wedge);return f===b.LEFT&&this.startWedge(a.wedge),e===this.searchedTimePosition||(f===b.RIGHT&&this.stopWedge(),!1)},h.startWedge=function(b){if(null!==this.currentWedge)throw new a("Unexpected","There is already a wedge");this.currentWedge=b},h.stopWedge=function(){if(null===this.currentWedge){throw new a("Unexpected","There is no wedge to stop.")}this.currentWedge=null},h.getWedgeType=function(){return null===this.currentWedge?null:c.getType(this.currentWedge)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.directionUtils,c=Adagio.Utils.direction.dynamicDirectionUtils,d=Adagio.Utils.direction.pizzicatoDirectionUtils,e=Adagio.Utils.direction.wordDirectionUtils,f=Adagio.Data.wedge.searchWedgeType;Adagio.getter.getDirectionAtTimePos=function(b,c){var d=c.partIdx,e=c.measureIdx,l=b.getMeasure(d,e),m=a.getWedgeDirections(l);m=m.filter(g,c.staffIdx);var n=h(l,c.voiceIdx,c.staffIdx),o=f(n,m,c.timePosition),p=a.getDynamics(l,c.staffIdx),q=i(p,c.timePosition),r=a.getPizzicatos(l,c.staffIdx),s=j(r,c.timePosition),t=a.getWords(l,c.staffIdx);return{wedgeType:o,dynamicData:q,pizzicatoData:s,wordData:k(t,c.timePosition)}};var g=function(a){var c=this.valueOf();return b.getStaffIdx(a)===c},h=function(c,d,e){if(!a.hasLeftWedge(c,e))return null;var f=a.getLeftWedge(c,e);return b.getWedge(f)},i=function(a,b){var d=a.findIndex(l,b);if(d>=0){var e=a[d];return{style:c.getStyle(e),idx:d}}return null},j=function(a,b){var c=a.findIndex(l,b);if(c>=0){var e=a[c];return{type:d.getType(e),idx:c}}return null},k=function(a,b){var c=a.findIndex(l,b);if(c>=0){var d=a[c];return{text:e.getText(d),idx:c,placement:e.getPlacement(d)}}return null},l=function(a){var c=this.valueOf();return b.getTimePos(a)===c}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.measureUtils;Adagio.edit.common.fetchSlurStart=function(c,d){for(var e=d.noteIdx,f=d.measureIdx;f>=0;f--){var g=c.getMeasureData(f);if(g.hasVoice(d.voiceIdx)){var h=g.getVoice(d.voiceIdx);if(-1===e){e=h.size()-1}for(;e>=0;e--){var i=h.getNote(e);if((e!==d.noteIdx||f!==d.measureIdx)&&a.hasSlurStop(i))return null;if(a.hasSlurStart(i)){return{measureIdx:f,noteIdx:e}}}var j=g.data;if(!b.hasLeftSlur(j,d.voiceIdx))return null}else e=-1}return null}}.call(this),function(){"use strict";var a=Adagio.Error.PitchRangeError,b=Adagio.edit.common.initMeasureData,c=Adagio.Data.octaveShift.searchOctaveShift,d=Adagio.Data.pedal.searchPedal,e=Adagio.Data.tempoChange.searchTempoChange,f=Adagio.Utils.typeUtils,g=Adagio.Utils.noteUtils,h=Adagio.Utils.pitchUtils,i=Adagio.Utils.attributesUtils,j=Adagio.Utils.timeModifUtils,k=Adagio.Utils.drumsetUtils,l=Adagio.Utils.durationUtils,m=Adagio.Utils.unpitchedUtils,n=Adagio.Utils.measureUtils,o=Adagio.Utils.harmonyUtils,p=Adagio.Utils.degreesUtils,q=Adagio.Utils.rootUtils,r=Adagio.Utils.bassUtils,s=Adagio.Utils.lyricUtils,t=Adagio.Utils.transposeUtils,u=Adagio.Utils.staffDetailsUtils,v=Adagio.Utils.direction.octaveShiftDirectionUtils,w=Adagio.Utils.direction.tempoChangeDirectionUtils,x=Adagio.Utils.direction.pedalDirectionUtils,y=Adagio.Utils.pitchShift,z=Adagio.Utils.hammerOnPullOffUtils,A=Adagio.Values.NotationType,B=Adagio.Values.TupletType,C=Adagio.Values.TechnicalType,D=Adagio.Values.HammerOnPullOffType,E=Adagio.Values.DurationType,F=Adagio.getter.getDirectionAtTimePos,G=Adagio.edit.common.fetchSlurStart;Adagio.getter.getNote=function(a,b){return new H(a,b).get()};var H=function(a,b){this.init(a,b)},I=H.prototype;I.init=function(a,b){this.scoreData=a,this.location=b,this.pitch=null,this.unpitched=null,this.octaveShifts={},this.timePos=null,this.actualDuration=null,this.availableDuration=null},I.get=function(){this.noteData={};var a={};b.call(a,this.scoreData,this.location),this.measureData=a.measureData,this.measureData.checkVoiceIdx(this.location.voiceIdx);var c=this.getVoice(),d=this.location.noteIdx;return c.checkNoteIdx(d),c.isRest(d)?this.extractRest():c.isUnpitched(d)?this.extractUnpitchedInstrument():this.extractPitched(),this.extractDirections(),this.extractIsInSlur(),this.extractHarmony(),this.noteData.nbGraces=c.getNbGraces(this.location.noteIdx),this.extractOctaveShift(),this.extractPedal(),this.extractTempoChange(),this.noteData},I.getVoice=function(){return this.measureData.getVoice(this.location.voiceIdx)},I.extractRest=function(){this.noteData.isRest=!0;var a=this.getVoice();this.baseNote=a.getNote(this.location.noteIdx),this.extractDuration(),this.extractArticulations(),this.noteData.technical=[],this.noteData.ornaments=[],this.extractLyrics()},I.extractUnpitchedInstrument=function(){this.noteData.isRest=!1;var a=this.getVoice(),b=a.getChord(this.location.noteIdx);b=f.makeArray(b).slice(),this.baseNote=b[0],b.sort(L),this.noteData.isTied=b.some(g.hasTieStart),this.noteData.noteheads=b.map(g.getHead),this.noteData.lines=b.map(this.extractUnpitchedLine,this),this.noteData.accidentals=b.map(J),this.noteData.courtesyAccidentals=b.map(K),this.noteData.ghostNotes=b.map(g.hasHeadParentheses),this.noteData.isChord=b.length>1,this.getUnpitchedInstruments(b),this.extractDuration(),this.extractArticulations(),this.extractTechnical(),this.extractOrnaments(),this.extractLyrics()};var J=function(){return null},K=function(){return!1},L=function(a,b){var c=g.getUnpitched(a),d=g.getUnpitched(b);return m.compare(c,d)};I.extractUnpitchedLine=function(a){var b=g.getUnpitched(a),c=g.getStaffIdx(a),d=this.measureData.getStaffDetails(c),e=u.getNbStaffLines(d);return k.pitchToLine(b,e)},I.getUnpitchedInstruments=function(a){this.noteData.unpitched=a.map(function(a){var b=g.getInstrumentId(a),c=this.location.partIdx;return{MIDIUnpitched:this.scoreData.searchInstrumentMIDIUnpitched(c,b)}},this)},I.extractPitched=function(){this.noteData.isRest=!1;var a=this.getVoice(),b=a.getChord(this.location.noteIdx);b=f.makeArray(b).slice(),this.baseNote=b[0],b.sort(M),this.noteData.isChord=b.length>1,this.noteData.isTied=b.some(g.hasTieStart),this.noteData.hasGlissando=b.some(g.hasGlissandoStart),this.noteData.ghostNotes=b.map(g.hasHeadParentheses),this.extractStaffIndexes(b),this.getPitches(b),this.isTab(b)&&this.getTabsData(b),this.getLines(b),this.extractAccidentals(b),this.extractCourtesyAccidentals(b),this.extractFingerings(b),this.extractArticulations(),this.extractTechnical(),this.extractOrnaments(),this.extractDuration(),this.extractLyrics(),this.extractHasArpeggio(),this.extractHammerOnPullOffs(b),this.shiftLinesIfNeeded()};var M=function(a,b){var c=g.getPitch(a),d=g.getPitch(b);return h.compareLine(c,d)};I.extractStaffIndexes=function(a){this.staffIndexes=a.map(g.getStaffIdx)},I.getPitches=function(a){var b=a.map(g.getPitch);this.noteData.canTryEnharmonicSwitch=b.map(this.checkEnharmonicSwitchTryiable,this),b=b.map(this.transposePitchIfNeeded,this),this.noteData.pitches=b.map(O)},I.getTabsData=function(a){var b=a.map(N);this.noteData.tabsData=b};var N=function(a){return g.hasTabData(a)?g.getTabData(a):null},O=function(a){return{step:h.getStep(a),octave:h.getOctave(a),alter:h.getAlter(a)}};I.isTab=function(a){var b=a[0],c=g.getStaffIdx(b),d=this.measureData.getStaffDetails(c);return u.hasStaffTuning(d)},I.transposePitchIfNeeded=function(a,b){if(!this.location.isConcertPitch)return a;var c=this.staffIndexes[b],d=this.getTranspose(c);return t.isIdentity(d)?a:a=h.transpose(a,d,!0)},I.getTranspose=function(a){return this.measureData.getTranspose(a)},I.checkEnharmonicSwitchTryiable=function(b,c){var d=this.staffIndexes[c],e=this.getKey(d);try{var f=y.switchEnharmonic(b,e);return!h.isSamePitch(b,f)}catch(b){if(b instanceof a)return!1;throw b}},I.getKey=function(a){return this.measureData.getKey(a)},I.getLines=function(){this.noteData.lines=this.noteData.pitches.map(this.pitchToLine,this)},I.pitchToLine=function(a,b){var c=this.staffIndexes[b],d=this.getClef(c);return h.pitchToLine(a,d)},I.getClef=function(a){return this.measureData.getClef(a)},I.extractAccidentals=function(a){this.noteData.accidentals=a.map(this.extractAccidental,this)},I.extractAccidental=function(a,b){if(g.hasAccidental(a)){var c=g.getPitch(a);c=this.transposePitchIfNeeded(c,b);var d=h.getAlter(c);return h.alterToAccidental(d)}return null},I.extractCourtesyAccidentals=function(a){this.noteData.courtesyAccidentals=a.map(g.hasCourtesyAccidental)},I.extractFingerings=function(a){this.noteData.fingerings=a.map(P)};var P=function(a){return g.hasFingering(a)?g.getFingering(a):null};I.extractArticulations=function(){g.hasArticulations(this.baseNote)?this.noteData.articulations=g.getArticulationsList(this.baseNote):this.noteData.articulations=[],g.hasNotation(this.baseNote,A.FERMATA)&&this.noteData.articulations.push(A.FERMATA)},I.extractTechnical=function(){g.hasTechnicals(this.baseNote)?this.noteData.technical=g.getTechnicalList(this.baseNote):this.noteData.technical=[]},I.extractOrnaments=function(){g.hasOrnaments(this.baseNote)?this.noteData.ornaments=g.getOrnamentsWithOpts(this.baseNote):this.noteData.ornaments=[]},I.extractDuration=function(){var a=this.getAttributes(),b=i.getDivisions(a),c=g.getNormalQuarterDuration(this.baseNote,b),d=l.quarterToDurationOpts(c),e=g.getTimeModif(this.baseNote);j.isNormal(e)?this.noteData.tupletType=null:this.noteData.tupletType=B.fromTimeModif(e),this.noteData.nbDots=d.nbDots,this.noteData.durationType=d.durationType,this.extractPossibleTuplet()},I.extractPossibleTuplet=function(){if(null!==this.noteData.tupletType)return this.noteData.possibleTuplets=[],void(this.noteData.possibleExpandedTuplets=[]);var a=B.getValues();this.noteData.possibleTuplets=a.filter(this.isTupletPossible,this),this.noteData.possibleExpandedTuplets=a.filter(this.isExpandedTupletPossible,this)},I.isTupletPossible=function(a){var b=B.getTimeModif(a);if(j.getWholeNbDots(b)!==this.noteData.nbDots)return!1;var c=j.getShiftToShardDurationType(b),d=this.noteData.durationType+c;return!!E.isValid(d)},I.isExpandedTupletPossible=function(a){var b=this.getAvailableDuration();return this.getExpandedTupletRequiredDuration(a)<=b},I.getAvailableDuration=function(){if(null===this.availableDuration){var a=this.getVoice(),b=a.getNbNotes();this.availableDuration=0
;for(var c=this.location.noteIdx;c<b;c++){var d=a.getNote(c),e=g.getDuration(d);this.availableDuration+=e}}return this.availableDuration},I.getExpandedTupletRequiredDuration=function(a){var b=this.getActualDuration(),c=B.getTimeModif(a);return b*j.getNormal(c)},I.getActualDuration=function(){if(null===this.actualDuration){var a=this.measureData.getDpqValue(),b=g.getQuarterDuration(this.baseNote,a);b=l.extractBaseDuration(b),this.actualDuration=l.quarterToDivisions(b,a)}return this.actualDuration},I.extractLyrics=function(){var a=g.getLyrics(this.baseNote).slice();a.sort(s.compare),this.noteData.lyrics=a.map(Q)};var Q=function(a){return{text:s.getText(a),hasRightConnection:s.hasRightConnection(a),level:s.getLevel(a)}};I.getAttributes=function(){return this.measureData.getAttributes()},I.extractDirections=function(){var a=g.getStaffIdx(this.baseNote),b=this.getTimePosition(),c=this.getDpq(),d={partIdx:this.location.partIdx,measureIdx:this.location.measureIdx,voiceIdx:this.location.voiceIdx,staffIdx:a,timePosition:b,dpq:c},e=F(this.scoreData,d);this.noteData.wedgeType=e.wedgeType,null!==e.dynamicData?(this.noteData.dynamicStyle=e.dynamicData.style,this.noteData.dynamicIdx=e.dynamicData.idx):this.noteData.dynamicStyle=null,null!==e.pizzicatoData&&(this.noteData.pizzicatoData=e.pizzicatoData),null!==e.wordData&&(this.noteData.wordData=e.wordData)},I.getTimePosition=function(){for(var a=this.getVoice(),b=0,c=0;c<this.location.noteIdx;c++){var d=a.getNote(c);b+=g.getDuration(d)}return b},I.getDpq=function(){return this.measureData.getDpqValue()},I.extractIsInSlur=function(){this.noteData.isInSlur=this.getIsInSlur()},I.getIsInSlur=function(){var a=this.measureData.scroller;return null!==G(a,this.location)},I.extractHarmony=function(){var a=this.getTimePosition(),b=this.measureData.getMeasure(),c=n.getHarmonies(b),d=c.findIndex(S,a);if(-1!==d){var e=c[d],f=o.getKindValue(e),g=o.getRoot(e);g=q.copy(g);var h=null;o.hasBass(e)&&(h=o.getBass(e),h=r.copy(h));var i=o.getDegrees(e);i=p.copy(i),this.noteData.harmony={kind:f,root:g,bass:h,degrees:i,idx:d},R(this.noteData.harmony,this.measureData,this.location.isConcertPitch)}else this.noteData.harmony=null};var R=function(a,b,c){if(c){var d=b.getTranspose(0);t.isUnison(d)||(a.root=q.transpose(a.root,d),null!==a.bass&&(a.bass=r.transpose(a.bass,d)))}},S=function(a){var b=this.valueOf();return o.getTimePos(a)===b};I.extractHasArpeggio=function(){this.noteData.hasArpeggio=g.hasArpeggiate(this.baseNote)},I.extractHammerOnPullOffs=function(a){this.noteData.hammerOnPullOffs=a.map(T)};var T=function(a){var b=z.create(D.START),c={hammerOnPullOff:b};return g.hasTechnical(a,C.HAMMER_ON,c)||g.hasTechnical(a,C.PULL_OFF,c)};I.shiftLinesIfNeeded=function(){void 0!==this.noteData.lines&&(this.noteData.lines=this.noteData.lines.map(this.shiftLineIfNeeded,this))},I.shiftLineIfNeeded=function(a,b){var c=this.staffIndexes[b],d=this.getOctaveShift(c);return null!==d&&(a=v.applyShiftToLine(d,a)),a},I.extractOctaveShift=function(){var a=this.getAnyOctaveShift();if(null!==a){var b=v.getStaffIdx(a),c=v.getType(a),d=v.getSize(a);this.noteData.octaveShift={staffIdx:b,type:c,size:d}}},I.getAnyOctaveShift=function(){var a=g.getStaffIdx(this.baseNote);return this.getOctaveShift(a)},I.getOctaveShift=function(a){return void 0===this.octaveShifts[a]&&this.initOctaveShift(a),this.octaveShifts[a]},I.initOctaveShift=function(a){var b=this.measureData.getMeasure(),d=U(b,a);if(null!==d||n.hasOctaveShifts(b,a)){var e=this.getTimePos(),f=n.getOctaveShifts(b,a),g=c(d,f,e,!0);this.octaveShifts[a]=g}else this.octaveShifts[a]=null};var U=function(a,b){return n.hasLeftOctaveShift(a,b)?n.getLeftOctaveShift(a,b):null};I.extractPedal=function(){var a=this.getPedal();if(null!==a){var b=x.getStaffIdx(a);this.noteData.pedal={staffIdx:b}}},I.getPedal=function(){return void 0===this.pedal&&this.initPedal(),this.pedal},I.initPedal=function(){var a=g.getStaffIdx(this.baseNote),b=this.measureData.getMeasure(),c=V(b,a);if(null!==c||n.hasPedals(b,a)){var e=this.getTimePos(),f=n.getPedals(b,a);this.pedal=d(c,f,e,!0)}else this.pedal=null};var V=function(a,b){return n.hasLeftPedal(a,b)?n.getLeftPedal(a,b):null};I.extractTempoChange=function(){var a=this.getTempoChange();if(null!==a){var b=w.getType(a);this.noteData.tempoChange={type:b}}},I.getTempoChange=function(){return void 0===this.tempoChange&&this.initTempoChange(),this.tempoChange},I.initTempoChange=function(){var a=this.scoreData.getCommonContent(),b=this.location.measureIdx,c=W(a,b);if(null!==c||a.hasTempoChanges(b)){var d=this.getTimePos(),f=this.measureData.getDpqValue(),g=a.getTempoChanges(b);this.tempoChange=e(c,g,d,f)}else this.tempoChange=null};var W=function(a,b){return a.hasLeftTempoChange(b)?a.getLeftTempoChange(b):null};I.getTimePos=function(){if(null===this.timePos){var a=this.measureData.getVoice(this.location.voiceIdx);this.timePos=a.getRangeSpace(0,this.location.noteIdx)}return this.timePos}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.BadPartIdxError=function(d,e){void 0===e&&(e=b.GET);var f=c(d,e),g=a.call(this,f);return this.name=g.name="BadPartIdxError",this.stack=g.stack,this.message=g.message,this.partIdx=d,this.action=e,this},c=function(a,b){return b.msgPrefix+" part at the index ["+a+"<"+typeof a+">]."};b.prototype=Object.create(a.prototype,{constructor:{value:b}}),b.INSERT={msgPrefix:"Cannot insert"},b.GET={msgPrefix:"There is no"}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.RevertRangeError=function(b,d,e){var f=c(b,d,e),g=a.call(this,f);return this.name=g.name="RevertRangeError",this.stack=g.stack,this.message=g.message,this.type=b,this.firstIdx=d,this.secondIdx=e,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a,b,c){return"The first "+a+" index provided ["+b+"] is higher than the second one ["+c+"]."};b.MEASURE="measure",b.NOTE="note",b.TIME_POS="time position"}.call(this);(function(){"use strict";var a=Adagio.Error.client.BadPartIdxError,b=Adagio.Error.client.BadMeasureIdxError,c=Adagio.Error.client.RevertRangeError,d=Adagio.edit.common.MeasureData,e=Adagio.Utils.setUtils,f=Adagio.Utils.typeUtils,g=Adagio.Utils.clone,h=Adagio.Utils.transposeUtils,i=Adagio.Utils.keyUtils,j=Adagio.Utils.staffDetailsUtils,k=Adagio.Utils.noteUtils,l=Adagio.Utils.pitchUtils,m=Adagio.Utils.tupletBoundUtils,n=Adagio.Utils.timeModifUtils,o=Adagio.Utils.durationUtils,p=Adagio.Utils.lyricUtils,q=Adagio.Utils.unpitchedUtils;Adagio.getter.getNotesRange=function(a,b,c){var d=u(),e=d.get(a,b,c);return d.cleanUp(),e};var r=function(){},s=r.prototype;s.get=function(a,b,c){return this.reset(a,b),this.checkLocation(c),this.searchTupletStart(),this.searchTupletStop(),this.extractAttributes(),this.isUnpitched=this.scoreData.isPartUnpitched(this.location.partIdx),this.extractNotes(),this.extractSlurs(),{isUnpitched:this.isUnpitched,notes:this.notes,ties:this.ties,slurs:this.slurs,attributes:this.attributes}},s.reset=function(a,b){this.scoreData=a,this.location=b,this.measureData=null,this.voice=null,this.dpq=null,this.attributes={},this.notes=[],this.ties=[],this.slurs=[],this.noteIdx=null,this.noteData=null,this.headData=null},s.checkLocation=function(e){if(void 0===e){var f=this.location.partIdx,g=this.scoreData.getNbParts();if(f<0||f>=g)throw new a(f,a.GET);var h=this.scoreData.getNbMeasures(),i=this.location.measureIdx;if(i<0||i>=h)throw new b(i,b.GET);var j=this.scoreData.getMeasure(f,i);e=new d(j),e.checkVoiceIdx(this.location.voiceIdx)}this.measureData=e;var k=e.getVoice(this.location.voiceIdx),l=this.location.startNoteIdx,m=this.location.stopNoteIdx;if(k.checkNoteIdx(l),k.checkNoteIdx(m),m<l)throw new c(c.NOTE,l,m);this.voice=k,this.dpq=e.getDpqValue()},s.searchTupletStart=function(){var a=this.location.startNoteIdx,b=this.voice.getNote(a);if(!k.hasNormalTimeModif(b)){for(;!k.hasTupletStart(b);)a--,b=this.voice.getNote(a);this.location.startNoteIdx=a}},s.searchTupletStop=function(){var a=this.location.stopNoteIdx,b=this.voice.getNote(a);if(!k.hasNormalTimeModif(b)){for(;!k.hasTupletStop(b);)a++,b=this.voice.getNote(a);this.location.stopNoteIdx=a}},s.extractAttributes=function(){var a=this.scoreData.getPartVoiceMainStaffIdx(this.location.partIdx,this.location.voiceIdx);this.attributes.transpose=h.copy(this.measureData.getTranspose(a)),this.attributes.staffDetails=j.copy(this.measureData.getStaffDetails(a)),this.attributes.key=i.copy(this.measureData.getKey(a))},s.extractNotes=function(){for(var a=this.location.startNoteIdx,b=this.location.stopNoteIdx,c=a;c<=b;c++)this.noteIdx=c,this.voice.isRest(c)?this.extractRest():this.extractChord()},s.extractRest=function(){var a={isRest:!0},b=this.voice.getNote(this.noteIdx);this.extractDuration(b,a),this.notes.push(a)},s.extractChord=function(){var a=this.voice.getNote(this.noteIdx);this.noteData={heads:[]},this.extractDuration(a,this.noteData),this.extractNoteLyrics(a),(k.hasNotations(a)||k.hasArticulations(a))&&(this.noteData.articulations=e.fromList(k.getFullArticulationsList(a))),k.hasOrnaments(a)&&(this.noteData.ornaments=k.getOrnamentsWithOpts(a)),k.hasTechnicals(a)&&(this.noteData.technicals=e.fromList(k.getTechnicalList(a))),f.makeArray(this.voice.getChord(this.noteIdx)).forEach(this.extractNoteHead,this),this.notes.push(this.noteData)},s.extractNoteLyrics=function(a){var b=k.getLyrics(a).slice();b.sort(p.compare);var c=b.map(t);this.noteData.lyrics=c};var t=function(a){return{text:p.getText(a),hasRightConnection:p.hasRightConnection(a),level:p.getLevel(a)}};s.extractDuration=function(a,b){var c=k.getNormalQuarterDuration(a,this.dpq),d=o.quarterToDurationOpts(c);if(b.nbDots=d.nbDots,b.durationType=d.durationType,k.hasTupletStart(a)){var e=1,f=k.getTupletStart(a,e),g=k.getTimeModif(a),h=m.getDurationType(f);b.tuplet={durationType:h,timeModif:n.copy(g)}}},s.extractNoteHead=function(a){this.headData={},this.isUnpitched?this.extractUnpitchedHead(a):this.extractPitchedHead(a),this.noteData.heads.push(this.headData)},s.extractUnpitchedHead=function(a){var b=k.getUnpitched(a);this.headData.unpitched=q.copy(b),this.headData.notehead=k.getHead(a);var c=k.getInstrumentId(a);this.headData.MIDIUnpitched=this.scoreData.searchInstrumentMIDIUnpitched(this.location.partIdx,c)},s.extractPitchedHead=function(a){var b=k.getPitch(a);this.headData.pitch=l.copy(b);var c;this.isFirstNote(this.noteIdx)&&k.hasTieStop(a)&&(c=l.copy(b),c.noteIdx=this.noteIdx-(1+this.location.startNoteIdx),this.ties.push(c)),!this.isLastNote()&&k.hasTieStart(a)&&(c=l.copy(b),c.noteIdx=this.noteIdx-this.location.startNoteIdx,this.ties.push(c)),k.hasTabData(a)&&(this.headData.fretData=k.getTabData(a))},s.isLastNote=function(){return this.noteIdx===this.location.stopNoteIdx},s.isFirstNote=function(){return this.noteIdx===this.location.startNoteIdx},s.extractSlurs=function(){for(var a=null,b=this.location.startNoteIdx,c=this.location.stopNoteIdx,d=b;d<=c;d++){var e=this.voice.getNote(d);k.hasSlurStart(e)?(a=g(this.location),a.startNoteIdx=d-this.location.startNoteIdx):k.hasSlurStop(e)&&null!==a&&(a.stopNoteIdx=d-this.location.startNoteIdx,this.slurs.push(a),a=null)}},s.cleanUp=function(){this.scoreData=null,this.location=null,this.measureData=null,this.voice=null,this.dpq=null,this.attributes=null,this.notes=null,this.ties=null,this.slurs=null,this.noteIdx=null,this.noteData=null,this.headData=null};var u=function(){return null===v&&(v=new r),v},v=null}).call(this),function(){"use strict";var a=Adagio.Error.client.BadPartIdxError,b=Adagio.Error.client.BadMeasureIdxError,c=Adagio.edit.common.MeasureData,d=Adagio.getter.getNotesRange;Adagio.getter.getVoiceData=function(e,f){var g=f.partIdx,h=e.getNbParts();if(g<0||g>=h)throw new a(g,a.GET);var i=e.getNbMeasures(),j=f.measureIdx;if(j<0||j>=i)throw new b(j,b.GET);var k=e.getMeasure(g,j),l=new c(k);l.checkVoiceIdx(f.voiceIdx);var m=l.getVoice(f.voiceIdx);return f.startNoteIdx=m.getStartNoteIdx(),f.stopNoteIdx=m.getStopNoteIdx(),d(e,f,l)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Data,c=Adagio.Utils.partContentUtils,d=Adagio.edit.common.MeasuresScroller,e=Adagio.edit.common.MeasureData;Adagio.edit.common.getMeasuresScroller=function(f,g){var h;if(f instanceof d)h=f;else if(f instanceof e){var i=f;h=i.getMeasuresScroller()}else{if(!(f instanceof b)){var j="Unsupported data type.";throw new a("BadDataType",j)}var k=f,l=g.partIdx,m=k.getPartContent(l),n=c.getMeasures(m);h=new d(n,l,k)}return h.hasScoreData()&&h.getScoreData().checkPartIdx(g.partIdx),h}}.call(this),function(){"use strict";var a=Adagio.edit.common.RedrawList=function(){this.init()},b=a.prototype;b.init=function(){this.completeRedraw=!1,this.action=null,this.addActions=[],this.payload=null},b.stateNeedCompleteRedraw=function(){this.completeRedraw=!0},b.needCompleteRedraw=function(){return this.completeRedraw},b.storeActionIfFirst=function(a){this.hasAction()||this.storeAction(a)},b.storeAddAction=function(a){this.addActions.push(a)},b.hasAction=function(){return null!==this.action},b.storeAction=function(a){this.action=a},b.getActions=function(){var a=this.addActions.slice();return null!==this.action&&a.push(this.action),a},b.getAction=function(){return this.action},b.resetAction=function(){this.action=null,this.addActions=[]},b.stateCompleteRedrawDone=function(){this.completeRedraw=!1},b.setPayload=function(a){this.payload=a},b.getPayload=function(){return this.payload},b.hasPayload=function(){return null!==this.payload}}.call(this),function(){"use strict";var a=Adagio.edit.common.RedrawList,b=Adagio.edit.common.CancelStack=function(a,b){this.init(a,b)};b.DEFAULT_NAME="ParentStack";var c=b.prototype;c.init=function(c,d){this.name=c||b.DEFAULT_NAME,this.redrawList=d||new a,this.stack=[]},c.push=function(a){this.stack.push(a)},c.createSubstack=function(a){var c=new b(a,this.redrawList);return this.push(c),c},c.getLast=function(){var a=this.stack.length-1;return this.stack[a]},c.stateNeedCompleteRedraw=function(){this.redrawList.stateNeedCompleteRedraw()},c.needCompleteRedraw=function(){return this.redrawList.needCompleteRedraw()},c.storePosition=function(a){this.redrawList.position=a},c.getPosition=function(){return this.redrawList.position},c.hasAction=function(){return this.redrawList.hasAction()},c.resetAction=function(){this.redrawList.resetAction()},c.storeAddAction=function(a){this.redrawList.storeAddAction(a)},c.storeAction=function(a){this.redrawList.storeAction(a)},c.storeActionIfFirst=function(a){this.redrawList.storeActionIfFirst(a)},c.getAction=function(){return this.redrawList.getAction()},c.getActions=function(){return this.redrawList.getActions()},c.stateCompleteRedrawDone=function(){this.redrawList.stateCompleteRedrawDone()},c.setPayload=function(a){this.redrawList.setPayload(a)},c.getPayload=function(){return this.redrawList.getPayload()},c.hasPayload=function(){return this.redrawList.hasPayload()}}.call(this),function(){"use strict";var a=Adagio.Error.noChange.NoChangeError=function(a){a=a||"This operation has no effect";var b=Error.call(this,a);return this.name=b.name="NoChangeError",this.stack=b.stack,this.message=b.message,this};a.prototype=Object.create(Error.prototype,{constructor:{value:a}})}.call(this),function(){"use strict";var a=Adagio.edit.common.initMeasureData,b=Adagio.edit.primitive.IncreaseDivisions=function(a,b,c){this.init(a,b,c)};b.NAME="primitive.IncreaseDivisions";var c=b.prototype;c.name=b.NAME,c.initMeasureData=a,c.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c},c.perform=function(){this.measureData.getDivisions().multiplyDivisions(this.opts.coeff),this.updateStack()},c.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,coeff:this.opts.coeff}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.Utils.clone,b=Adagio.Utils.durationUtils,c=Adagio.Utils.math,d=Adagio.edit.primitive.IncreaseDivisions,e=Adagio.edit.common.initMeasureData,f=Adagio.edit.composite.AdaptDpqToDuration=function(a,b,c){this.init(a,b,c)};f.NAME="composite.AdaptDpqToDuration";var g=f.prototype;g.initMeasureData=e,g.name=f.NAME,g.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},g.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a=b.durationOptsToDivisions(this.opts,this.opts.timeModif),d=this.measureData.getDivisions().getDivisions(),e=c.lcm(d,a);if(e>d){var f=e/d;this.increaseDivisions(f)}},g.increaseDivisions=function(b){var c=a(this.opts);c.coeff=b,new d(this.measureData,c,this.cancelStack).perform()}}.call(this),function(){"use strict";Adagio.edit.values.InsertMode={INSERT:"insert",REPLACE:"replace",REPLACE_LEFT:"replaceLeft"}}.call(this),function(){"use strict";var a=Adagio.Utils.durationUtils;Adagio.edit.common.calcDuration=function(b,c,d){var e=a.durationOptsToDuration(b,c);return a.normalToActual(e,d)}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.timeModifUtils,c=Adagio.edit.common.calcDuration,d=Adagio.edit.common.initMeasureData,e=Adagio.edit.primitive.AddRest=function(a,b,c){this.init(a,b,c)};e.NAME="primitive.AddRest";var f=e.prototype;f.name=e.NAME,f.initMeasureData=d,f.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},f.perform=function(){var a=this.getVoice(),c=b.copy(a.getAbsoluteTimeModif()),d=this.createRest(c);a.insertNote(d,this.opts.noteIdx),this.updateStack()},f.getVoice=function(){var a=this.opts.voiceIdx,b=this.opts.noteIdx;return this.measureData.getVoiceOrTupletForInsert(a,b)},f.createRest=function(b){var c=this.opts.nbDots||0,d={rest:{}};a.setVoiceIdx(d,this.opts.voiceIdx),a.setStaffIdx(d,this.opts.staffIdx),a.setNbDots(d,c);var e=this.getDuration();return a.setDuration(d,e),a.setTimeModif(d,b),d},f.getDuration=function(){var a=this.measureData.getDivisionsPerQuarterValue(),b=this.getVoice(),d=b.getAbsoluteTimeModif();return c(this.opts,a,d)},f.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,noteIdx:this.opts.noteIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,durationType:this.opts.durationType,nbDots:this.opts.nbDots}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.Utils.durationUtils,b=Adagio.Utils.Fraction,c=Adagio.Utils.timeModifUtils,d=Adagio.edit.common.RestDispatcherEnd=function(a,b,c,d){this.init(a,b,c,d)},e=d.prototype;e.init=function(a,b,c,d){this.timeToDispatch=a,this.timePerBeat=b,this.divisionsPerQuarter=c,this.timeModif=d,this.shards=[]},e.dispatch=function(){for(;this.timeToDispatch>0;)this.insertShard()},e.insertShard=function(){var a=this.timePerBeat;if(a>this.timeToDispatch)for(a=this.timeToDispatch;a>0;){var b=this.extractBaseSpace(a);a-=b,this.storeSpaceShard(b)}else this.storeSpaceShard(a)},e.extractBaseSpace=function(b){var c=a.actualToNormal(b,this.timeModif),d=a.divisionsToQuarter(c,this.divisionsPerQuarter),e=a.extractBaseDuration(d),f=a.quarterToDuration(e,this.divisionsPerQuarter),g=a.normalToActual(f,this.timeModif),h=this.getSubBeat();return g=Math.min(g,h)},e.getSubBeat=function(){return this.isCompound()?this.timePerBeat/3:this.timePerBeat/2},e.isCompound=function(){if(!c.isNormal(this.timeModif))return!1;var a=new b(this.timePerBeat,this.divisionsPerQuarter);return a.simplify(),a.getNumerator()%3==0},e.storeSpaceShard=function(a){this.timeToDispatch-=a,this.timePos+=a,this.shards.unshift(a)},e.getDispatchedRests=function(){return this.shards}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.durationUtils,c=Adagio.Utils.Fraction,d=Adagio.Utils.timeModifUtils,e=Adagio.edit.common.RestDispatcherLeft=function(a,b,c,d,e){this.init(a,b,c,d,e)},f=e.prototype;f.init=function(a,b,c,d,e){this.timePos=a,this.timeToDispatch=b,this.timePerBeat=c,this.divisionsPerQuarter=d,this.timeModif=e,this.shards=[]},f.dispatch=function(){for(;this.timeToDispatch>0;){this.timePos=this.timePos%this.timePerBeat;var a=this.seekShardSize();this.insertSpace(a)}},f.seekShardSize=function(){return this.isCompound()?this.seekShardSizeCompound(0,this.timePerBeat):this.seekShardSizeIter(0,this.timePerBeat)},f.seekShardSizeCompound=function(){if(0===this.timePos)return this.timePerBeat;var b=this.timePerBeat/3,c=2*b;if(0<=this.timePos&&this.timePos<b)return this.seekShardSizeIter(0,b);if(b<=this.timePos&&this.timePos<c)return this.seekShardSizeIter(b,c);if(c<=this.timePos&&this.timePos<this.timePerBeat)return this.seekShardSizeIter(c,this.timePerBeat);throw new a("Unreachable")},f.seekShardSizeIter=function(b,c){for(var d=c-b;b!==this.timePos;){var e=b+d/2;if(0<=this.timePos&&this.timePos<e)c=e;else{if(!(this.timePos<c))throw new a("Unreachable");b=e}d=c-b}return d},f.insertSpace=function(a){if(a>this.timeToDispatch)for(a=this.timeToDispatch;a>0;){var b=this.extractBaseSpace(a);a-=b,this.storeSpaceShard(b)}else this.storeSpaceShard(a)},f.extractBaseSpace=function(a){var c=b.actualToNormal(a,this.timeModif),d=b.divisionsToQuarter(c,this.divisionsPerQuarter),e=b.extractBaseDuration(d),f=b.quarterToDuration(e,this.divisionsPerQuarter),g=b.normalToActual(f,this.timeModif),h=this.getSubBeat();return g=Math.min(g,h)},f.getSubBeat=function(){return this.isCompound()?this.timePerBeat/3:this.timePerBeat/2},f.isCompound=function(){if(!d.isNormal(this.timeModif))return!1;var a=new c(this.timePerBeat,this.divisionsPerQuarter);return a.simplify(),a.getNumerator()%3==0},f.storeSpaceShard=function(a){this.timeToDispatch-=a,this.timePos+=a,this.shards.push(a)},f.getDispatchedRests=function(){return this.shards}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.noteUtils,c=Adagio.Utils.durationUtils,d=Adagio.Values.DurationType,e=Adagio.edit.values.InsertMode,f=Adagio.edit.primitive.AddRest,g=Adagio.edit.common.RestDispatcherEnd,h=Adagio.edit.common.RestDispatcherLeft,i=Adagio.edit.common.initMeasureData,j=Adagio.edit.composite.AddRests=function(a,b,c){this.init(a,b,c)};j.NAME="composite.AddRests";var k=j.prototype;k.name=j.NAME,k.initMeasureData=i,k.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},k.perform=function(){if(this.cancelStack=this.cancelStack.createSubstack(this.name),this.opts.insertMode===e.INSERT)this.addAtEnd();else{if(this.opts.insertMode!==e.REPLACE){var b="Unexpected insert mode: ["+this.opts.insertMode+"].";throw new a("Unexpected",b)}this.addAtIdx()}},k.addAtEnd=function(){var a=this.getVoiceOrTuplet(),b=this.opts.duration,c=this.getDivisionsPerBeat(),d=this.getDpq(),e=this.getAbsoluteTimeModif(),f=new g(b,c,d,e);f.dispatch();var h=f.getDispatchedRests();this.insertionIdx=a.getStopNoteIdx()+1,this.addRests(h)},k.addAtIdx=function(){var a=this.getTimePosition(),b=this.opts.duration,c=this.getDivisionsPerBeat(),d=this.getDpq(),e=this.getAbsoluteTimeModif(),f=new h(a,b,c,d,e);f.dispatch();var g=f.getDispatchedRests();this.insertionIdx=this.opts.noteIdx,this.addRests(g)},k.getTimePosition=function(){for(var a=this.getVoiceOrTuplet(),c=0,d=a.getStartNoteIdx();d<this.opts.noteIdx;d++){var e=a.getNote(d);c+=b.getDuration(e)}return c},k.getDivisionsPerBeat=function(){var a=this.getVoiceOrTuplet();return a.isTuplet()?this.getDivPerBeatFromTimeModif(a):this.getDivPerBeatFromTimeSignature()},k.getDivPerBeatFromTimeSignature=function(){var a=this.measureData.getAnyTime(),b=c.getBeatQuarterDuration(a),d=this.getDpq();return c.quarterToDuration(b,d)},k.getDivPerBeatFromTimeModif=function(a){var b=a.getAbsoluteTimeModif(),e=a.getDurationType(),f=this.getDpq(),g=d.toQuarterDuration(e),h=c.quarterToDuration(g,f);return c.normalToActual(h,b)},k.getDpq=function(){return this.measureData.getDpqValue()},k.getVoiceOrTuplet=function(){var a=this.opts.voiceIdx,b=this.opts.noteIdx;return this.measureData.getVoiceOrTupletForInsert(a,b)},k.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},k.addRests=function(a){a.forEach(this.addRest,this)},k.addRest=function(a,b){var c=b+this.insertionIdx,d=this.getDurationOpts(a),e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,noteIdx:c,durationType:d.durationType,nbDots:d.nbDots};new f(this.measureData,e,this.cancelStack).perform()},k.getDurationOpts=function(a){var b=this.getAbsoluteTimeModif(),d=this.getDpq();return c.actualDivisionsToDurationOpts(a,d,b)},k.getAbsoluteTimeModif=function(){return this.getVoiceOrTuplet().getAbsoluteTimeModif()}}.call(this),function(){"use strict";var a=Adagio.edit.composite.AdaptDpqToDuration,b=Adagio.edit.composite.AddRests,c=Adagio.Utils.durationUtils,d=Adagio.Utils.timeModifUtils,e=Adagio.edit.common.initMeasureData,f=Adagio.edit.common.CancelStack,g=Adagio.edit.values.InsertMode,h=Adagio.edit.composite.FillVoiceWithRests=function(a,b){this.init(a,b)};h.NAME="composite.FillVoiceWithRests";var i=h.prototype;i.name=h.NAME,i.initMeasureData=e,i.init=function(a,b){this.initMeasureData(a,b),this.cancelStack=new f,this.opts=b,this.durationOpts=null},i.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.adaptDpqToDuration(),this.addRests()},i.adaptDpqToDuration=function(){var b=this.getDurationOpts(),c=d.createDefault(),e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,durationType:b.durationType,nbDots:b.nbDots,timeModif:c};new a(this.measureData,e,this.cancelStack).perform()},i.getDurationOpts=function(){if(null===this.durationOpts){var a=this.measureData.getAnyTime(),b=c.getBeatQuarterDuration(a);this.durationOpts=c.quarterToDurationOpts(b)}return this.durationOpts},i.addRests=function(){var a=this.opts.voiceIdx;this.measureData.initTupletCacheWithVoice(a);var d=this.measureData.getAnyTime(),e=c.timeToQuarter(d),f=this.measureData.getDpqValue(),h=c.quarterToDuration(e,f),i=this.getStaffIdx(),j={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:i,voiceIdx:a,noteIdx:0,insertMode:g.INSERT,duration:h};new b(this.measureData,j,this.cancelStack).perform()},i.getStaffIdx=function(){return void 0!==this.opts.staffIdx?this.opts.staffIdx:this.measureData.getVoiceMainStaffIdx(this.opts.voiceIdx)}}.call(this),function(){"use strict";var a=Adagio.edit.composite.FillVoiceWithRests,b=Adagio.edit.common.initMeasureData,c=Adagio.edit.composite.ShowMeasureVoice=function(a,b,c){this.init(a,b,c)};c.NAME="composite.ShowMeasureVoice";var d=c.prototype;d.name=c.NAME,d.initMeasureData=b,d.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.createVoice(),this.addRests(),this.updateStack()},d.createVoice=function(){this.measureData.getVoicesList().insertVoice(this.opts.voiceIdx)},d.addRests=function(){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx};new a(this.measureData,b).perform()},d.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.BadPartUuidError=function(c,d){void 0===d&&(d=b.action.GET);var e=d.msgPrefix+" part with the following Uuid "+c,f=a.call(this,e);return this.name=f.name="BadPartUuidError",this.stack=f.stack,this.message=f.message,this.partUuid=c,this.action=d,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}}),b.INSERT={msgPrefix:"Cannot insert"},b.GET={msgPrefix:"There is no"}}.call(this),function(){"use strict";var a=Adagio.Utils.typeUtils,b=Adagio.Utils.scoreInstrumentUtils={};b.getName=function(b){return a.stringOrContent(b["instrument-name"])},b.setName=function(a,b){a["instrument-name"]=b},b.create=function(a){return{"instrument-name":a}},b.getId=function(a){return a.$id},b.setId=function(a,b){a.$id=b},b.updateId=function(a,c){var d=b.getId(a),e=c[d];void 0!==e&&b.setId(a,e)},b.hasAbbreviation=function(b){return a.hasStringOrContent(b["instrument-abbreviation"])},b.getAbbreviation=function(b){return a.stringOrContent(b["instrument-abbreviation"])},b.setAbbreviation=function(a,b){a["instrument-abbreviation"]=b}}.call(this),function(){"use strict";var a=Adagio.Utils.typeUtils,b=Adagio.Values.MIDIValues={};b.NB_MIDI_CHANNELS=16,b.NB_MIDI_PROGRAMS=168,b.PERCUSSION_CHANNEL="10",b.FALLBACK_CHANNEL="1",b.UNPITCHED_PROGRAM="1",b.getPitchedChannelsMap=function(){for(var a={},c=1;c<=b.NB_MIDI_CHANNELS;c++){var d=c.toString();d!==b.PERCUSSION_CHANNEL&&(a[d]=!0)}return a},b.useChannel=function(c){if(a.isObjectEmpty(c))return b.FALLBACK_CHANNEL;var d=a.getAnyKey(c);return delete c[d],d}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Values.MIDIValues,c=Adagio.Error.value.BadMIDIProgramError=function(b){var c=d(b),e=a.call(this,c);return this.name=e.name="BadMIDIProgramError",this.stack=e.stack,this.message=e.message,this.MIDIProgram=b,this};c.prototype=Object.create(a.prototype,{constructor:{value:c}});var d=function(a){return"MIDI program value "+a+" is invalid. It should be a positive integer between [1 and "+b.NB_MIDI_PROGRAMS+"]"}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Values.MIDIValues,c=Adagio.Error.value.BadMIDIChannelError=function(b){var c=d(b),e=a.call(this,c);return this.name=e.name="BadMIDIChannelError",this.stack=e.stack,this.message=e.message,this.MIDIChannel=b,this};c.prototype=Object.create(a.prototype,{constructor:{value:c}});var d=function(a){return"MIDI channel value "+a+" is invalid. It has to be a positive integer between [1 and "+b.NB_MIDI_CHANNELS+"]"}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadVolumeError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadVolumeError",this.stack=e.stack,this.message=e.message,this.volume=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"The volume ["+a+"] is invalid. It must be a number between 0 and 100."}}.call(this),function(){"use strict";var a=Adagio.Error.value.BadVolumeError,b=Adagio.Utils.math,c=Adagio.Values.Volume={MIN:0,MAX:100,DEFAULT:100};c.check=function(b){if(!c.isValid(b))throw new a(b)},c.isValid=function(a){return b.isNumber(a)&&c.MIN<=a&&a<=c.MAX}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadReverberationError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadReverberationError",this.stack=e.stack,this.message=e.message,this.reverberation=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"The reverberation ["+a+"] is invalid. It must be a number between 0 and 100."}}.call(this),function(){"use strict";var a=Adagio.Error.value.BadReverberationError,b=Adagio.Utils.math,c=Adagio.Values.Reverberation={MIN:0,MAX:100,DEFAULT:0};c.check=function(b){if(!c.isValid(b))throw new a(b)},c.isValid=function(a){return b.isNumber(a)&&c.MIN<=a&&a<=c.MAX}}.call(this),function(){"use strict";var a=Adagio.Error.value.BadMIDIProgramError,b=Adagio.Error.value.BadMIDIChannelError,c=Adagio.Values.MIDIValues,d=Adagio.Values.Volume,e=Adagio.Values.Reverberation,f=Adagio.Utils.mxlUtils,g="$adagio-reverberation",h=Adagio.Utils.MIDIInstrumentUtils={};h.setVolume=function(a,b){a.volume=b.toString()},h.getVolume=function(a){if(h.hasVolume(a)){var b=a.volume;return b=f.floatOrContent(b)}return d.DEFAULT},h.hasVolume=function(a){return void 0!==a.volume},h.setReverberation=function(a,b){a[g]=b},h.getReverberation=function(a){return h.hasReverberation(a)?a[g]:e.DEFAULT},h.hasReverberation=function(a){return void 0!==a[g]},h.hasMIDIProgram=function(a){return void 0!==a["midi-program"]},h.getMIDIProgram=function(a){return a["midi-program"]},h.setMIDIProgram=function(a,b){h.checkMIDIProgram(b),a["midi-program"]=b},h.checkMIDIProgram=function(b){if(!h.isValidMIDIProgram(b))throw new a(b)},h.isValidMIDIProgram=function(a){return a=parseInt(a,10),
!isNaN(a)&&a>=1},h.hasMIDIChannel=function(a){return void 0!==a["midi-channel"]},h.getMIDIChannel=function(a){return a["midi-channel"]},h.setMIDIChannel=function(a,b){h.checkMIDIChannel(b),a["midi-channel"]=b},h.removeMIDIChannel=function(a){delete a["midi-channel"]},h.checkMIDIChannel=function(a){if(!h.isValidMIDIChannel(a))throw new b(a)},h.isValidMIDIChannel=function(a){return a=parseInt(a,10),!isNaN(a)&&a>=1&&a<=c.NB_MIDI_CHANNELS},h.getId=function(a){return a.$id},h.setId=function(a,b){a.$id=b},h.createMIDIInstrument=function(a){return{"midi-program":a}},h.updateId=function(a,b,c){var d=h.getId(a),e=h.createId(a,b,c),f={};return e!==d&&(h.setId(a,e),f[d]=e),f},h.initId=function(a,b,c){var d=h.createId(a,b,c);h.setId(a,d)},h.createId=function(a,b,c){return b+"-"+h.getIdLetter(a)+(c+1)},h.getIdLetter=function(a){return h.hasUnpitched(a)?"X":"I"},h.hasUnpitched=function(a){return void 0!==a["midi-unpitched"]},h.getUnpitched=function(a){return a["midi-unpitched"]},h.setUnpitched=function(a,b){a["midi-unpitched"]=b},h.getUsedMIDIChannel=function(a){var b={};return h.hasMIDIChannel(a)&&!h.hasUnpitched(a)&&(b[h.getMIDIChannel(a)]=!0),b},h.fillMIDIChannel=function(a,b){if(h.hasUnpitched(a))h.setMIDIChannel(a,c.PERCUSSION_CHANNEL);else if(!h.hasMIDIChannel(a)){var d=c.useChannel(b);h.setMIDIChannel(a,d)}}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.scoreInstrumentUtils,c=Adagio.Utils.MIDIInstrumentUtils,d=Adagio.Utils.typeUtils,e=Adagio.Utils.math,f=Adagio.Utils.partHeaderUtils={};f.create=function(a){var b={};return f.setName(b,a),f.setVoiceMapping(b,{}),f.setStaffMapping(b,[]),b},f.hasUuid=function(a){return void 0!==a.uuid},f.setUuid=function(a,b){a.uuid=b},f.getUuid=function(a){return a.uuid},f.hasId=function(a){return void 0!==a.$id},f.setId=function(a,b){a.$id=b},f.getName=function(a){return d.stringOrContent(a["part-name"])},f.hasAbbreviation=function(a){return d.hasStringOrContent(a["part-abbreviation"])},f.getAbbreviation=function(a){return d.stringOrContent(a["part-abbreviation"])},f.inferAbbreviation=function(a){var b=f.getName(a);return""===b?"":b.charAt(0)+"."},f.setAbbreviation=function(a,b){a["part-abbreviation"]=b},f.removeAbbreviation=function(a){delete a["part-abbreviation"]},f.setName=function(a,b){a["part-name"]=b},f.getId=function(a){return a.$id},f.updateInstrumentsIds=function(a){var e=f.getId(a),g=f.getScoreInstruments(a);return f.getMIDIInstruments(a).reduce(function(a,f,h){var i=c.updateId(f,e,h),j=g[h];return b.updateId(j,i),d.fillObject(a,i),a},{})},f.initInstrumentsIds=function(a){var d=f.getId(a),e=f.getScoreInstruments(a);f.getMIDIInstruments(a).forEach(function(a,f){c.initId(a,d,f);var g=c.getId(a),h=e[f];b.setId(h,g)})},f.hasScoreInstruments=function(a){return void 0!==a["score-instrument"]&&(!d.isArray(a["score-instrument"])||a["score-instrument"].length>0)},f.getScoreInstruments=function(a){return f.hasScoreInstruments(a)?d.makeArray(a["score-instrument"]):[]},f.setScoreInstruments=function(a,b){b.length>1?a["score-instrument"]=b:1===b.length?a["score-instrument"]=b[0]:delete a["score-instrument"]},f.getGlobalVolume=function(a){var b=f.getMIDIInstruments(a),d=b[0];return c.getVolume(d)},f.setGlobalVolume=function(a,b){f.getMIDIInstruments(a).forEach(g,b)};var g=function(a){var b=this.valueOf();c.setVolume(a,b)};f.getGlobalReverberation=function(a){var b=f.getMIDIInstruments(a),d=b[0];return c.getReverberation(d)},f.setGlobalReverberation=function(a,b){f.getMIDIInstruments(a).forEach(h,b)};var h=function(a){var b=this.valueOf();c.setReverberation(a,b)};f.hasMIDIInstruments=function(a){return void 0!==a["midi-instrument"]&&(!d.isArray(a["midi-instrument"])||a["midi-instrument"].length>0)},f.getMIDIInstruments=function(a){return f.hasMIDIInstruments(a)?d.makeArray(a["midi-instrument"]):[]},f.setMIDIInstruments=function(a,b){b.length>1?a["midi-instrument"]=b:1===b.length?a["midi-instrument"]=b[0]:delete a["midi-instrument"]},f.setInstrument=function(a,b,c){f.setInstruments(a,[b],[c])},f.setInstruments=function(a,b,c){f.setScoreInstruments(a,b),f.setMIDIInstruments(a,c)},f.hasManyInstruments=function(a){return f.getNbInstruments(a)>1},f.getNbInstruments=function(a){return f.getScoreInstruments(a).length},f.hasUnpitched=function(a){return f.getMIDIInstruments(a).some(c.hasUnpitched)},f.isOnlyUnpitched=function(a){return f.getMIDIInstruments(a).every(c.hasUnpitched)},f.getScoreInstrumentsMap=function(a){var c=f.getScoreInstruments(a);return d.listToMap(c,b.getId)},f.getMIDIInstrumentsMap=function(a){var b=f.getMIDIInstruments(a);return d.listToMap(b,c.getId)},f.getUsedMIDIChannels=function(a){return f.getMIDIInstruments(a).map(c.getUsedMIDIChannel).reduce(d.fillObject,{})},f.fillMIDIChannels=function(a,b){f.getMIDIInstruments(a).forEach(i,b)};var i=function(a){var b=this;c.fillMIDIChannel(a,b)};f.hasInstrumentId=function(a,b){return f.getMIDIInstruments(a).some(j,b)},f.searchInstrumentMIDIUnpitched=function(b,d){var e,g=f.getMIDIInstruments(b),h=g.find(j,d);if(void 0===h)throw e="There is no instrument for the id ["+d+"].",new a("InstrumentNotFound",e);if(c.hasUnpitched(h))return c.getUnpitched(h);throw e="The instrument with the id ["+d+"] do not have midi-unpitched field.",new a("NoUnpitched",e)};var j=function(a){var b=this.valueOf();return c.getId(a)===b};f.hasVoiceIdx=function(a,b){return void 0!==f.getVoiceMapping(a)[b]},f.getVoiceMainStaffIdx=function(a,b){var c=f.getVoiceMapping(a);return k(c,b),c[b][0]};var k=function(b,c){if(void 0===b[c])throw new a("BadVoiceIdx","Invalid voiceIdx ["+c+"].")};f.getVoicesIndexes=function(a){var b=f.getVoiceMapping(a),c=Object.keys(b);return c=c.map(e.intPart)},f.getVoiceMapping=function(a){return a.voiceMapping},f.setVoiceMapping=function(a,b){a.voiceMapping=b},f.hasVoiceMapping=function(a){return void 0!==a.voiceMapping},f.getStaffNbVoices=function(a,b){var c=f.getStaffMapping(a);return l(c,b),c[b].voices.length},f.getStaffVoicesIndexes=function(a,b){var c=f.getStaffMapping(a);return l(c,b),c[b].voices},f.getStaffMainVoiceIdx=function(a,b){var c=f.getStaffMapping(a);return l(c,b),c[b].mainVoiceIdx};var l=function(b,c){var d=b.length;if(!e.isInteger(c)||c<0||c>=d)throw new a("BadStaffIdx","Invalid staffIdx ["+c+"].")};f.getStaffMapping=function(a){return a.staffMapping},f.setStaffMapping=function(a,b){a.staffMapping=b},f.hasStaffMapping=function(a){return void 0!==a.staffMapping},f.setPitchMapping=function(a,b){a.pitchMapping=b},f.getPitchMapping=function(a){return a.pitchMapping},f.getUnpitchedInstrumentsList=function(a){var d=[],e=f.getMIDIInstruments(a),g=f.getScoreInstruments(a);return e.forEach(function(a,e){var f=g[e],h=c.getUnpitched(a),i=c.getMIDIProgram(a),j=b.getName(f),k={name:j,unpitched:h,MIDIProgram:i};d.push(k)}),d},f.hasPitchMapping=function(a){return void 0!==a.pitchMapping}}.call(this),function(){"use strict";var a=Adagio.Utils.partHeaderUtils;Adagio.edit.common.hasPartIdxByUuid=function(b,c){return b.some(function(b){return a.getUuid(b)===c})}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.partHeaderUtils;Adagio.edit.common.partUuidToPartIdx=function(c,d){for(var e=-1,f=0;f<c.length;f++){if(b.getUuid(c[f])===d){e=f;break}}if(e<0){throw new a("Unexpected","There is no partIdx for partUuid ["+d+"].")}return e}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Data,c=Adagio.edit.common.MeasureData,d=Adagio.edit.common.MeasuresScroller;Adagio.edit.common.getScoreData=function(e){var f;if(e instanceof b)f=e;else{if(!(e instanceof c||e instanceof d)){throw new a("Unexpected","Data, MeasuresScroller or MeasureData instance expected. ")}f=e.getScoreData()}return f}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadPartUuidError,b=Adagio.edit.common.hasPartIdxByUuid,c=Adagio.edit.common.partUuidToPartIdx,d=Adagio.edit.common.getScoreData;Adagio.edit.common.convertPartUuidToGetPartIdx=function(a,b){void 0!==b.partUuid&&e(a,b)};var e=function(e,f){if(e=d(e),!b(e.getPartsHeaders(),f.partUuid))throw new a(f.partUuid,a.GET);f.partIdx=c(e.getPartsHeaders(),f.partUuid),delete f.partUuid}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.BadMeasureUuidError=function(c,d){void 0===d&&(d=b.GET);var e=d.msgPrefix+" measure with the following Uuid "+c,f=a.call(this,e);return this.name=f.name="BadMeasureUuidError",this.stack=f.stack,this.message=f.message,this.measureUuid=c,this.action=d,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}}),b.INSERT={msgPrefix:"Cannot insert"},b.GET={msgPrefix:"There is no"}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadUuidValueError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadUuidValueError",this.stack=e.stack,this.message=e.message,this.uuid=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"The value "+a+" does not seem to be a correct Uuid"}}.call(this),function(){"use strict";var a=Adagio.Error.value.BadUuidValueError,b=Adagio.Utils.uuidUtils={};b.generate=function(){function a(a){var b=(Math.random().toString(16)+"000000000").substr(2,8);return a?"-"+b.substr(0,4)+"-"+b.substr(4,4):b}return a()+a(!0)+a(!0)+a()},b.check=function(b){if(!b.isValid(b))throw new a(b)},b.isValid=function(a){return a.match(/^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureHeaderUtils={};a.create=function(a){return{uuid:a}},a.setUuid=function(a,b){a.uuid=b},a.getUuid=function(a){return a.uuid},a.hasUuid=function(a){return void 0!==a.uuid}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.measureHeaderUtils;Adagio.edit.common.measureUuidToMeasureIdx=function(c,d){for(var e=-1,f=0;f<c.length;f++){if(b.getUuid(c[f])===d){e=f;break}}if(e<0){throw new a("Unexpected","There is no measureIdx for measureUuid ["+d+"].")}return e}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadMeasureUuidError,b=Adagio.edit.common.measureUuidToMeasureIdx,c=Adagio.edit.common.getScoreData;Adagio.edit.common.convertMeasureUuidToGetMeasureIdx=function(a,b){void 0!==b.measureUuid&&d(a,b)};var d=function(d,e){if(d=c(d),!d.hasMeasureIdxByUuid(e.measureUuid))throw new a(e.measureUuid,a.GET);e.measureIdx=b(d.getMeasuresHeaders(),e.measureUuid),delete e.measureUuid}}.call(this),function(){"use strict";var a=Adagio.Error.noChange.NoChangeError,b=Adagio.Error.client.BadVoiceError,c=Adagio.edit.composite.ShowMeasureVoice,d=Adagio.edit.common.convertPartUuidToGetPartIdx,e=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,f=Adagio.edit.common.initMeasureData,g=Adagio.edit.action.ShowMeasureVoice=function(a,b,c){this.init(a,b,c)};g.NAME="action.ShowMeasureVoices";var h=g.prototype;h.name=g.NAME,h.initMeasureData=f,h.init=function(a,b,c){d(a,b),e(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.location=null},h.checkPreconditions=function(){if(!this.measureData.getScoreData().hasPartVoiceIdx(this.opts.partIdx,this.opts.voiceIdx))throw new b(this.opts.voiceIdx);if(this.measureData.hasVoice(this.opts.voiceIdx))throw new a},h.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.showMeasureVoice(),this.updateStack()},h.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx},c={actionName:this.name,opts:b};this.cancelStack.storeAction(c)}},h.showMeasureVoice=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx};new c(this.measureData,a,this.cancelStack).perform()},h.updateStack=function(){var a=this.getLocation(),b={partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx},c={type:this.name,noDraw:!0,opts:b};this.cancelStack.push(c)},h.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx);this.location={partUuid:b,measureUuid:c}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadPartIdxError,b=Adagio.Error.client.BadMeasureIdxError,c=Adagio.Error.client.RevertRangeError,d=Adagio.edit.common.getMeasuresScroller,e=Adagio.edit.common.MeasureData,f=Adagio.edit.common.CancelStack,g=Adagio.edit.action.ShowMeasureVoice,h=Adagio.Utils.setUtils,i=Adagio.Utils.typeUtils,j=Adagio.Utils.measureUtils,k=Adagio.Utils.attributesUtils,l=Adagio.Utils.transposeUtils,m=Adagio.Utils.timeUtils,n=Adagio.Utils.staffDetailsUtils,o=Adagio.Utils.noteUtils,p=Adagio.Utils.pitchUtils,q=Adagio.Utils.tupletBoundUtils,r=Adagio.Utils.timeModifUtils,s=Adagio.Utils.durationUtils,t=Adagio.Utils.lyricUtils,u=Adagio.Utils.unpitchedUtils,v=Adagio.Utils.glissandoUtils,w=Adagio.Values.GlissandoType;Adagio.getter.getNotesRangeCrossMeasure=function(a,b,c){var d=A(),e=d.get(a,b,c);return d.cleanUp(),e};var x=function(){},y=x.prototype;y.get=function(a,b,c){return this.reset(a,b),this.checkLocation(c),this.searchTupletStart(),this.searchTupletStop(),this.extractAttributes(),this.isUnpitched=this.scoreData.isPartUnpitched(this.location.partIdx),this.extractNotes(),this.extractSlurs(),{isUnpitched:this.isUnpitched,notes:this.notes,ties:this.ties,slurs:this.slurs,glissandos:this.glissandos,attributes:this.attributes}},y.reset=function(a,b){this.scoreData=a,this.location=b,this.measuresScroller=null,this.voice=null,this.dpq=null,this.attributes={},this.notes=[],this.ties=[],this.slurs=[],this.glissandos=[],this.noteIdx=null,this.noteData=null,this.headData=null,this.fakeMeasureDataMap={}},y.checkLocation=function(e){if(void 0!==e)return void(this.measuresScroller=e);var f=this.location.partIdx,g=this.scoreData.getNbParts();if(f<0||f>=g)throw new a(f,a.GET);this.measuresScroller=d(this.scoreData,this.location);var h=this.location.startMeasureIdx,i=this.location.stopMeasureIdx,j=this.location.startNoteIdx,k=this.location.stopNoteIdx,l=i-h;if(l<0)throw new c(c.MEASURE,h,i);if(0===l&&j>k)throw new c(c.NOTE,j,k);var m,n=this.scoreData.getNbMeasures();if((m=h)<0||m>=n)throw new b(m,b.GET);if((m=i)<0||m>=n)throw new b(m,b.GET);var o,p,q;m=h,q=j,o=this.measuresScroller.getMeasureData(m),o.checkVoiceIdx(this.location.voiceIdx),p=o.getVoice(this.location.voiceIdx),p.checkNoteIdx(q),m=i,q=k,o=this.measuresScroller.getMeasureData(m),p=o.getVoice(this.location.voiceIdx),p.checkNoteIdx(q)},y.searchTupletStart=function(){var a=this.location.startNoteIdx,b=this.measuresScroller.getMeasureData(this.location.startMeasureIdx),c=b.getVoice(this.location.voiceIdx),d=c.getNote(a);if(!o.hasNormalTimeModif(d)){for(;!o.hasTupletStart(d);)a--,d=c.getNote(a);this.location.startNoteIdx=a}},y.searchTupletStop=function(){var a=this.location.stopNoteIdx,b=this.measuresScroller.getMeasureData(this.location.stopMeasureIdx),c=b.getVoice(this.location.voiceIdx),d=c.getNote(a);if(!o.hasNormalTimeModif(d)){for(;!o.hasTupletStop(d);)a++,d=c.getNote(a);this.location.stopNoteIdx=a}},y.extractAttributes=function(){var a=this.scoreData.getPartVoiceMainStaffIdx(this.location.partIdx,this.location.voiceIdx),b=this.measuresScroller.getMeasureData(this.location.startMeasureIdx);this.attributes.transpose=l.copy(b.getTranspose(a)),this.attributes.staffDetails=n.copy(b.getStaffDetails(a))},y.extractNotes=function(){this.forEachNote(this.extractNote)},y.extractNote=function(a,b,c){this.noteIdx=b,this.relativeNoteIdx=c,this.measureIdx=a,this.voice.isRest(b)?this.extractRest():this.extractChord()},y.extractRest=function(){var a={isRest:!0},b=this.voice.getNote(this.noteIdx);this.extractDuration(b,a),this.notes.push(a)},y.extractChord=function(){var a=this.voice.getNote(this.noteIdx);this.noteData={},this.extractDuration(a,this.noteData),this.extractNoteLyrics(a),this.extractGraces(),(o.hasNotations(a)||o.hasArticulations(a))&&(this.noteData.articulations=h.fromList(o.getFullArticulationsList(a))),o.hasOrnaments(a)&&(this.noteData.ornaments=o.getOrnamentsWithOpts(a)),o.hasTechnicals(a)&&(this.noteData.technicals=h.fromList(o.getTechnicalList(a))),this.isUnpitched?this.noteData.instruments=[]:this.noteData.heads=[],i.makeArray(this.voice.getChord(this.noteIdx)).forEach(this.extractNoteHead,this),this.notes.push(this.noteData)},y.extractNoteLyrics=function(a){var b=o.getLyrics(a).slice();b.sort(t.compare);var c=b.map(z);this.noteData.lyrics=c};var z=function(a){return{text:t.getText(a),hasRightConnection:t.hasRightConnection(a),level:t.getLevel(a)}};y.extractDuration=function(a,b){var c=o.getNormalQuarterDuration(a,this.dpq),d=s.quarterToDurationOpts(c);if(b.nbDots=d.nbDots,b.durationType=d.durationType,o.hasTupletStart(a)){var e=1,f=o.getTupletStart(a,e),g=o.getTimeModif(a),h=q.getDurationType(f);b.tuplet={durationType:h,timeModif:r.copy(g)}}},y.extractGraces=function(){this.noteData.graces=[];for(var a=0;a<this.voice.getNbGraces(this.noteIdx);a++){var b=this.voice.getGraceChord(this.noteIdx,a);b=i.makeArray(b),this.extractGraceChord(b),this.noteData.graces.push(this.graceData)}},y.extractGraceChord=function(a){this.graceData={},this.graceData.heads=[],a.forEach(function(a,b){if(0===b){var c=o.getDurationType(a);this.graceData.durationType=c}this.isUnpitched?this.extractUnpitchedGraceHead(a):this.extractPitchedGraceHead(a),this.graceData.heads.push(this.graceHeadData)},this)},y.extractUnpitchedGraceHead=function(a){var b=o.getUnpitched(a),c=o.getHead(a);this.graceHeadData={unpitched:u.copy(b),notehead:c}},y.extractPitchedGraceHead=function(a){var b=o.getPitch(a);this.graceHeadData={pitch:p.copy(b)}},y.extractNoteHead=function(a){this.headData={},this.isUnpitched?(this.extractUnpitchedHead(a),this.noteData.instruments.push(this.headData)):(this.extractPitchedHead(a),this.noteData.heads.push(this.headData))},y.extractUnpitchedHead=function(a){var b=o.getUnpitched(a);this.headData.unpitched=u.copy(b),this.headData.notehead=o.getHead(a),o.hasHeadParentheses(a)&&(this.headData.isGhost=!0);var c=o.getInstrumentId(a);this.headData.MIDIUnpitched=this.scoreData.searchInstrumentMIDIUnpitched(this.location.partIdx,c)},y.extractPitchedHead=function(a){var b=o.getPitch(a);this.headData.pitch=p.copy(b);var c;if(!this.isLastNote()&&o.hasTieStart(a)&&(c=p.copy(b),c.noteIdx=this.relativeNoteIdx,this.ties.push(c)),o.hasGlissandos(a)){o.getGlissandos(a).forEach(function(a){var c=p.copy(b),d=v.getType(a);(w.isStop(d)&&!this.isFirstNote()||w.isStart(d)&&!this.isLastNote())&&(c.noteIdx=this.relativeNoteIdx,c.glissandoType=d,c.number=v.getNumber(a),this.glissandos.push(c))},this)}o.hasTabData(a)&&(this.headData.fretData=o.getTabData(a))},y.isLastNote=function(){return this.noteIdx===this.location.stopNoteIdx&&this.measureIdx===this.location.stopMeasureIdx},y.isFirstNote=function(){return this.noteIdx===this.location.startNoteIdx&&this.measureIdx===this.location.startMeasureIdx},y.extractSlurs=function(){this.slurData=null,this.forEachNote(this.extractSlur)},y.extractSlur=function(a,b,c){var d=this.voice,e=d.getNote(b);o.hasSlurStart(e)?this.slurData={startNoteIdx:c}:o.hasSlurStop(e)&&null!==this.slurData&&(this.slurData.stopNoteIdx=c,this.slurs.push(this.slurData),this.slurData=null)},y.forEachNote=function(a){for(var b=this.location.startMeasureIdx,c=this.location.stopMeasureIdx,d=0,e=b;e<=c;e++){var f,g=this.measuresScroller.getMeasureData(e);g.hasVoice(this.location.voiceIdx)?(f=g.getVoice(this.location.voiceIdx),this.dpq=g.getDpqValue()):(f=this.getHiddenVoice(e),this.dpq=this.getHiddenVoiceDpq(e)),this.voice=f;var h=0;e===b&&(h=this.location.startNoteIdx);var i;i=e===c?this.location.stopNoteIdx:f.getNbNotes()-1;for(var j=h;j<=i;j++)a.call(this,e,j,d),d++}},y.getHiddenVoice=function(a){return this.getFakeMeasureData(a).getVoice(this.location.voiceIdx)},y.getHiddenVoiceDpq=function(a){return this.getFakeMeasureData(a).getDpqValue()},y.getFakeMeasureData=function(a){return void 0===this.fakeMeasureDataMap[a]&&this.createFakeMeasureData(a),this.fakeMeasureDataMap[a]},y.createFakeMeasureData=function(a){var b=this.measuresScroller.getMeasureData(a),c=b.getAnyTime();c=m.copy(c);var d={};j.setNotes(d,[]);var h={};k.setTime(h,[c]),j.setAttributes(d,h);var i=new e(d,a,this.measuresScroller,this.scoreData),l=new f,n={partIdx:this.location.partIdx,measureIdx:a,voiceIdx:this.location.voiceIdx};new g(i,n,l).perform(),this.fakeMeasureDataMap[a]=i},y.cleanUp=function(){this.scoreData=null,this.location=null,this.measuresScroller=null,this.voice=null,this.dpq=null,this.attributes=null,this.notes=null,this.ties=null,this.slurs=null,this.noteIdx=null,this.noteData=null,this.headData=null,this.fakeMeasureDataMap=null};var A=function(){return null===B&&(B=new x),B},B=null}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.clefUtils,c=Adagio.Utils.keyUtils,d=Adagio.Utils.timeUtils,e=Adagio.Utils.transposeUtils,f=Adagio.Utils.attributeUtils,g=Adagio.Utils.rehearsalUtils,h=Adagio.Utils.clone,i=Adagio.Error.client.BadVoiceError;Adagio.getter.getStaffMeasure=function(a,b){return new j(a,b).get()};var j=function(a,b){this.init(a,b)},k=j.prototype;k.init=function(a,b){this.scoreData=a,this.location=b},k.get=function(){var b={},c=this.scoreData.getMeasure(this.location.partIdx,this.location.measureIdx),d=a.getNbStaves(c),e=this.location.staffIdx;if(e<0||e>=d)throw new i(e,i.GET);a.hasLeftBarline(c)?b.leftBarline=h(a.getLeftBarline(c)):b.leftBarline=null,a.hasRightBarline(c)?b.rightBarline=h(a.getRightBarline(c)):b.rightBarline=null;var f=a.getWrappedClef(c);b.clef=l(f.getEntry(e));var j=a.getWrappedKey(c);b.key=m(j.getEntry(e));var k=a.getWrappedTime(c);b.time=n(k.getEntry(e));var p=a.getWrappedTranspose(c);b.transpose=o(p.getEntry(e));var q=this.scoreData.getCommonContent(),r=q.getDisplayedTime(this.location.measureIdx);if(b.displayedTime=n(r),q.hasJumpTag(this.location.measureIdx)?b.jumpTag=q.getJumpTag(this.location.measureIdx):b.jumpTag=null,q.hasJumpCall(this.location.measureIdx)?b.jumpCall=q.getJumpCall(this.location.measureIdx):b.jumpCall=null,q.hasRehearsal(this.location.measureIdx)){var s=q.getRehearsal(this.location.measureIdx);b.rehearsal=g.getText(s),b.rehearsalType=g.getType(s)}else b.rehearsal=null;var t=this.scoreData.getPartStaffMapping(this.location.partIdx);return b.voicesData=h(t[this.location.staffIdx]),b};var l=function(a){return a=h(a),b.makeLineExplicit(a),f.removeStaffIdx(a),a.line=b.getLine(a),a["clef-octave-change"]=b.getOctaveChange(a),a},m=function(a){return a=h(a),f.removeStaffIdx(a),a.fifths=c.getFifths(a),a},n=function(a){return a=h(a),f.removeStaffIdx(a),a.beats=d.getBeats(a),a["beat-type"]=d.getBeatType(a),a},o=function(a){return a=e.copy(a)}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.BadStaffIdxError=function(c,d){void 0===d&&(d=b.action.GET);var e=d.msgPrefix+" staff at the index "+c,f=a.call(this,e);return this.name=f.name="BadStaffIdxError",this.stack=f.stack,this.message=f.message,this.staffIdx=c,this.action=d,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}}),b.action={INSERT:{msgPrefix:"Cannot insert"},GET:{msgPrefix:"There is no"}}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadStaffIdxError,b=Adagio.edit.common.MeasureData,c=Adagio.Utils.math,d=Adagio.Utils.measureUtils,e=Adagio.Utils.noteUtils,f=Adagio.Utils.direction.dynamicDirectionUtils;Adagio.getter.hasDynamic=function(f,h){var i=f.getMeasure(h.partIdx,h.measureIdx),j=d.getNbStaves(i),k=h.staffIdx;if(!c.isInteger(k)||k<0||k>=j)throw new a(k);var l=new b(i);l.checkVoiceIdx(h.voiceIdx);var m=l.getVoice(h.voiceIdx);m.checkNoteIdx(h.noteIdx);for(var n=0,o=0;o<h.noteIdx;o++){var p=m.getNote(o);n+=e.getDuration(p)}return d.getDynamics(i,h.staffIdx).some(g,n)};var g=function(a){var b=this.valueOf();return f.getTimePos(a)===b}}.call(this),function(){"use strict";var a=Adagio.Utils.partHeaderUtils,b=Adagio.Utils.MIDIInstrumentUtils;Adagio.getter.getPartData=function(b,e){b.checkPartIdx(e.partIdx);var f=b.getPartHeader(e.partIdx);return{partName:a.getName(f),partAbbreviation:c(f),isUnpitched:a.hasUnpitched(f),instrumentsData:a.getMIDIInstruments(f).map(d)}};var c=function(b){return a.hasAbbreviation(b)?a.getAbbreviation(b):null},d=function(a){return b.hasUnpitched(a)?{MIDIUnpitched:b.getUnpitched(a)}:{MIDIProgram:b.getMIDIProgram(a)}}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.NoWedgeError=function(){var b="There is no wedge at this location.",c=a.call(this,b);return this.name=c.name="NoWedgeError",this.stack=c.stack,this.message=c.message,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}})}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.MissingOptionError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="MissingOptionError",this.stack=e.stack,this.message=e.message,this.optionName=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"The option ["+a+"] is missing."}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.BadWedgeIdxError=function(b){var c="There is no wedge at the index ["+b+"].",d=a.call(this,c);return this.name=d.name="BadWedgeIdxError",this.stack=d.stack,this.message=d.message,this.wedgeIdx=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}})}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Values.WedgeLocation,c=Adagio.Utils.directionUtils,d=Adagio.Utils.wedgeUtils,e=Adagio.Utils.measureUtils;Adagio.edit.common.searchWedgeSides=function(a,b,c,d){var e=new f(a,b,c,d);return e.search(),e.getResult()};var f=function(a,b,c,d){this.init(a,b,c,d)},g=f.prototype;g.init=function(a,b,c,d){this.measures=a,this.entryMeasureIdx=b,this.entryTimePos=d,this.entryStaffIdx=c,this.candidateMeasureIdx=null,this.directionsByMeasures={},this.startTimePos=null,this.startMeasureIdx=null,this.stopTimePos=null,this.stopMeasureIdx=null,this.type=null,this.placement=null},g.search=function(){this.searchStart(),this.isStartAtEntry()&&this.shiftEntryTimePos(),this.searchStop()},g.searchStart=function(){for(this.candidateMeasureIdx=this.entryMeasureIdx;this.candidateMeasureIdx>=0&&!this.hasFoundStart();this.candidateMeasureIdx--)this.searchStartMeasure();if(!this.hasFoundStart()){throw new a("WedgeStartNotFound","We were not able to find the wedge left side.")}},g.searchStartMeasure=function(){var a=this.getWedgeDirectionsAtCandidateMeasure();this.isEntryMeasure()&&(a=this.filterLowerOrEqual(a)),this.searchStartTimePos(a)},g.filterLowerOrEqual=function(a){for(var b=[],d=a.length,e=0;e<d;e++){var f=a[e];if(c.getTimePos(f)>this.entryTimePos)return b;b.push(f)}return b},g.searchStartTimePos=function(a){for(var e=a.length,f=e-1;f>=0&&!this.hasFoundStart();f--){var g=a[f],h=c.getWedge(g);d.getLocation(h)===b.LEFT&&this.startFound(g,h)}},g.hasFoundStart=function(){return null!==this.startMeasureIdx},g.startFound=function(a,b){var e=c.getTimePos(a);this.startTimePos=e,this.startMeasureIdx=this.candidateMeasureIdx,this.type=d.getType(b),this.placement=c.getPlacement(a)},g.isStartAtEntry=function(){return this.startMeasureIdx===this.entryMeasureIdx&&this.startTimePos===this.entryTimePos},g.shiftEntryTimePos=function(){this.entryTimePos++},g.searchStop=function(){var b=this.measures.length;for(this.candidateMeasureIdx=this.entryMeasureIdx;this.candidateMeasureIdx<b&&!this.hasFoundStop();this.candidateMeasureIdx++)this.searchStopMeasure();if(!this.hasFoundStop()){throw new a("WedgeStopNotFound","We were not able to find the wedge right side.")}},g.searchStopMeasure=function(){var a=this.getWedgeDirectionsAtCandidateMeasure();this.isEntryMeasure()&&(a=this.filterGreaterOrEqual(a)),this.searchStopTimePos(a)},g.getWedgeDirectionsAtCandidateMeasure=function(){if(void 0===this.directionsByMeasures[this.candidateMeasureIdx]){var a=this.measures[this.candidateMeasureIdx],b=e.getWedgeDirections(a);b=b.filter(h,this.entryStaffIdx),b.sort(i),this.directionsByMeasures[this.candidateMeasureIdx]=b}return this.directionsByMeasures[this.candidateMeasureIdx]};var h=function(a){var b=this.valueOf();return c.getStaffIdx(a)===b},i=function(a,b){return c.getTimePos(a)-c.getTimePos(b)};g.isEntryMeasure=function(){return this.candidateMeasureIdx===this.entryMeasureIdx},g.filterGreaterOrEqual=function(a){for(var b=[],d=a.length,e=d-1;e>=0;e--){var f=a[e];if(c.getTimePos(f)<this.entryTimePos)return b;b.unshift(f)}return b},g.searchStopTimePos=function(a){for(var e=a.length,f=0;f<e&&!this.hasFoundStop();f++){var g=a[f],h=c.getWedge(g);d.getLocation(h)===b.RIGHT&&this.stopFound(g)}},g.hasFoundStop=function(){return null!==this.stopMeasureIdx},g.stopFound=function(a){var b=c.getTimePos(a);this.stopTimePos=b,this.stopMeasureIdx=this.candidateMeasureIdx},g.getResult=function(){return{startMeasureIdx:this.startMeasureIdx,startTimePos:this.startTimePos,stopMeasureIdx:this.stopMeasureIdx,stopTimePos:this.stopTimePos,placement:this.placement,type:this.type}}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.noteUtils;Adagio.edit.common.timePosToFloorNoteIdx=function(c,d,e){for(var f=0,g=c.size(),h=0;h<g;h++){if(f===e)return h;var i=c.getNote(h);if((f+=b.getDuration(i)*d)>e)return h}throw new a("Unexpected","There is no noteIdx for time position ["+f+"].")}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.noteUtils;Adagio.edit.common.wideTimePosToFloorNoteIdx=function(c,d,e){for(var f=0,g=c.size(),h=0;h<g;h++){if(f===e)return h;var i=c.getNote(h);if((f+=b.getDuration(i)*d)>e)return h}if(f===e)return h;throw new a("Unexpected","There is no noteIdx for time position ["+f+"].")}}.call(this),function(){"use strict";var a=Adagio.Error.client.NoWedgeError,b=Adagio.Error.client.MissingOptionError,c=Adagio.Error.client.BadWedgeIdxError,d=Adagio.Utils.math,e=Adagio.Utils.noteUtils,f=Adagio.Utils.measureUtils,g=Adagio.Utils.directionUtils,h=Adagio.Utils.partContentUtils,i=Adagio.Data.wedge.searchWedgeType,j=Adagio.edit.common.searchWedgeSides,k=Adagio.edit.common.timePosToFloorNoteIdx,l=Adagio.edit.common.wideTimePosToFloorNoteIdx,m=Adagio.edit.common.MeasuresScroller;Adagio.getter.getWedgeData=function(a,b){var c=new n(a,b);return c.checkPreconditions(),c.get()};var n=Adagio.edit.action.WedgeGetter=function(a,b){this.init(a,b)},o=n.prototype;o.init=function(a,b){this.scoreData=a,this.location=b,this.measuresScroller=null,this.targetTimePos=null},o.checkPreconditions=function(){this.checkLocation(),this.sanitize(),this.checkExistence()},o.checkLocation=function(){this.scoreData.checkPartIdx(this.location.partIdx),this.scoreData.checkMeasureIdx(this.location.measureIdx),this.getMeasureData(this.location.measureIdx).checkVoiceIdx(this.location.voiceIdx)},o.sanitize=function(){if(void 0!==this.location.wedgeIdx){var a=this.getTargetMeasure(),e=f.getWedgeDirections(a);if(e=e.filter(q,this.location.staffIdx),!d.isInteger(this.location.wedgeIdx)||this.location.wedgeIdx>=e.length)throw new c(this.location.wedgeIdx);var h=e[this.location.wedgeIdx];this.targetTimePos=g.getTimePos(h)}else{if(void 0===this.location.noteIdx)throw new b("noteIdx OR wedgeIdx");var i=this.getTargetVoice();i.checkNoteIdx(this.location.noteIdx),this.targetTimePos=p(i,this.location.noteIdx)}};var p=function(a,b){for(var c=0,d=0;d<b;d++){var f=a.getNote(d);c+=e.getDuration(f)}return c};o.getTargetVoice=function(){return this.getMeasureData(this.location.measureIdx).getVoice(this.location.voiceIdx)},o.checkExistence=function(){if(!this.hasWedge())throw new a},o.hasWedge=function(){var a=this.getTargetMeasure(),b=f.getWedgeDirections(a);b=b.filter(q,this.location.staffIdx);var c=r(a,this.location.staffIdx);return null!==i(c,b,this.targetTimePos)};var q=function(a){var b=this.valueOf();return g.getStaffIdx(a)===b};o.getTargetMeasure=function(){
return this.scoreData.getMeasure(this.location.partIdx,this.location.measureIdx)};var r=function(a,b){if(!f.hasLeftWedge(a,b))return null;var c=f.getLeftWedge(a,b);return g.getWedge(c)};o.get=function(){this.searchSides(),this.convertSidesToNoteIdx();var a={type:this.type,placement:this.placement};return this.addLocationData(a),a},o.addLocationData=function(a){var b=this.location.partIdx,c=this.scoreData.voiceIdxToIdxInMainStaff(b,this.startVoiceIdx),d=this.scoreData.voiceIdxToIdxInMainStaff(b,this.stopVoiceIdx);a.startMeasureIdx=this.startMeasureIdx,a.startVoiceIdx=this.startVoiceIdx,a.startIdxInStaff=c,a.startNoteIdx=this.startNoteIdx,a.stopMeasureIdx=this.stopMeasureIdx,a.stopVoiceIdx=this.stopVoiceIdx,a.stopIdxInStaff=d,a.stopNoteIdx=this.stopNoteIdx},o.searchSides=function(){var a=this.getMeasures(),b=j(a,this.location.measureIdx,this.location.staffIdx,this.targetTimePos);this.startMeasureIdx=b.startMeasureIdx,this.startTimePos=b.startTimePos,this.stopMeasureIdx=b.stopMeasureIdx,this.stopTimePos=b.stopTimePos,this.type=b.type,this.placement=b.placement},o.getMeasures=function(){var a=this.scoreData.getPartContent(this.location.partIdx);return h.getMeasures(a)},o.convertSidesToNoteIdx=function(){this.convertLeftSide(),this.convertRightSide()},o.convertLeftSide=function(){var a=this.getLeftVoice();this.startNoteIdx=k(a,1,this.startTimePos)},o.getLeftVoice=function(){var a=this.getMeasureData(this.startMeasureIdx);if(a.hasVoice(this.location.voiceIdx))this.startVoiceIdx=this.location.voiceIdx;else{var b=this.scoreData.getPartStaffVoicesIndexes(this.location.partIdx,this.location.staffIdx);b=b.filter(a.hasVoice,a),this.startVoiceIdx=b[0]}return a.getVoice(this.startVoiceIdx)},o.convertRightSide=function(){var a=this.getRightVoice();this.stopNoteIdx=l(a,1,this.stopTimePos)},o.getRightVoice=function(){var a=this.getMeasureData(this.stopMeasureIdx);if(a.hasVoice(this.location.voiceIdx))this.stopVoiceIdx=this.location.voiceIdx;else{var b=this.scoreData.getPartStaffVoicesIndexes(this.location.partIdx,this.location.staffIdx);b=b.filter(a.hasVoice,a),this.stopVoiceIdx=b[0]}return a.getVoice(this.stopVoiceIdx)},o.getMeasureData=function(a){return this.getMeasuresScroller().getMeasureData(a)},o.getMeasuresScroller=function(){if(null===this.measuresScroller){var a=this.location.partIdx,b=this.scoreData.getPartContent(a),c=h.getMeasures(b);this.measuresScroller=new m(c,a,this.scoreData)}return this.measuresScroller}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.BadHarmonyIdxError=function(b){var c="There is no harmony at the index ["+b+"].",d=a.call(this,c);return this.name=d.name="BadHarmonyIdxError",this.stack=d.stack,this.message=d.message,this.harmonyIdx=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}})}.call(this),function(){"use strict";var a=Adagio.Error.client.BadHarmonyIdxError,b=Adagio.Utils.measureUtils,c=Adagio.Utils.harmonyUtils,d=Adagio.Utils.transposeUtils,e=Adagio.Utils.rootUtils,f=Adagio.Utils.bassUtils,g=Adagio.Utils.degreesUtils,h=Adagio.Utils.math;Adagio.getter.getHarmony=function(d,j){d.checkPartIdx(j.partIdx),d.checkMeasureIdx(j.measureIdx);var k=d.getMeasure(j.partIdx,j.measureIdx),l=b.getNbHarmonies(k),m=j.harmonyIdx;if(!h.isInteger(m)||m<0||m>=l)throw new a(m);var n=b.getHarmonies(k),o=n[m],p=c.getRoot(o);p=e.copy(p);var q=c.getKindValue(o),r=null;c.hasBass(o)&&(r=c.getBass(o),r=f.copy(r));var s=c.getDegrees(o);s=g.copy(s);var t={root:p,kind:q,bass:r,degrees:s};return i(t,k,j.isConcertPitch),t};var i=function(a,c,g){if(g){var h=b.getTranspose(c)[0];d.isUnison(h)||(a.root=e.transpose(a.root,h),null!==a.bass&&(a.bass=f.transpose(a.bass,h)))}}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.BadPizzicatoIdxError=function(b){var c="There is no pizzicato at the index ["+b+"].",d=a.call(this,c);return this.name=d.name="BadPizzicatoIdxError",this.stack=d.stack,this.message=d.message,this.pizzicatoIdx=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}})}.call(this),function(){"use strict";var a=Adagio.Error.client.BadStaffIdxError,b=Adagio.Error.client.BadPizzicatoIdxError,c=Adagio.Utils.math,d=Adagio.Utils.measureUtils,e=Adagio.Utils.direction.pizzicatoDirectionUtils;Adagio.getter.getPizzicato=function(f,g){f.checkPartIdx(g.partIdx),f.checkMeasureIdx(g.measureIdx);var h=f.getMeasure(g.partIdx,g.measureIdx),i=g.staffIdx,j=d.getNbStaves(h);if(!c.isInteger(i)||i<0||i>=j)throw new a(i);var k=d.getPizzicatos(h,g.staffIdx),l=k.length,m=g.pizzicatoIdx;if(!c.isInteger(m)||m<0||m>=l)throw new b(m);var n=k[m];return{type:e.getType(n)}}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.BadDynamicIdxError=function(b){var c="There is no dynamic at the index ["+b+"].",d=a.call(this,c);return this.name=d.name="BadDynamicIdxError",this.stack=d.stack,this.message=d.message,this.dynamicIdx=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}})}.call(this),function(){"use strict";var a=Adagio.Error.client.BadStaffIdxError,b=Adagio.Error.client.BadDynamicIdxError,c=Adagio.Utils.math,d=Adagio.Utils.measureUtils,e=Adagio.Utils.direction.dynamicDirectionUtils;Adagio.getter.getDynamic=function(g,h){g.checkPartIdx(h.partIdx),g.checkMeasureIdx(h.measureIdx);var i=g.getMeasure(h.partIdx,h.measureIdx),j=h.staffIdx,k=d.getNbStaves(i);if(!c.isInteger(j)||j<0||j>=k)throw new a(j);var l=d.getDynamics(i,h.staffIdx),m=l.length,n=h.dynamicIdx;if(!c.isInteger(n)||n<0||n>=m)throw new b(n);var o=l[n];return{style:e.getStyle(o),sound:f(o)}};var f=function(a){return e.hasSound(a)?e.getSound(a):null}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.BadWordIdxError=function(b){var c="There is no word at the index ["+b+"].",d=a.call(this,c);return this.name=d.name="BadWordIdxError",this.stack=d.stack,this.message=d.message,this.wordIdx=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}})}.call(this),function(){"use strict";var a=Adagio.Error.client.BadStaffIdxError,b=Adagio.Error.client.BadWordIdxError,c=Adagio.Utils.math,d=Adagio.Utils.measureUtils,e=Adagio.Utils.direction.wordDirectionUtils;Adagio.getter.getWord=function(f,g){f.checkPartIdx(g.partIdx),f.checkMeasureIdx(g.measureIdx);var h=f.getMeasure(g.partIdx,g.measureIdx),i=g.staffIdx,j=d.getNbStaves(h);if(!c.isInteger(i)||i<0||i>=j)throw new a(i);var k=d.getWords(h,g.staffIdx),l=k.length,m=g.wordIdx;if(!c.isInteger(m)||m<0||m>=l)throw new b(m);var n=k[m];return{text:e.getText(n),placement:e.getPlacement(n)}}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.NoSlurError=function(){var b="There is no slur at this location.",c=a.call(this,b);return this.name=c.name="NoSlurError",this.stack=c.stack,this.message=c.message,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}})}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.measureUtils;Adagio.edit.common.fetchSlurStop=function(c,d){for(var e=null,f=d.measureIdx,g=c.getNbMeasures();f<g;f++){var h=c.getMeasureData(f);if(h.hasVoice(d.voiceIdx)){var i=h.getVoice(d.voiceIdx);e=null===e?d.noteIdx:0;for(var j=i.size();e<j;e++){var k=i.getNote(e);if((e!==d.noteIdx||f!==d.measureIdx)&&a.hasSlurStart(k))return null;if(a.hasSlurStop(k)){return{measureIdx:f,noteIdx:e}}}var l=h.data;if(!b.hasRightSlur(l,d.voiceIdx))return null}else e=0}return null}}.call(this),function(){"use strict";var a=Adagio.Error.client.NoSlurError,b=Adagio.Error.client.BadVoiceError,c=Adagio.edit.common.getMeasuresScroller,d=Adagio.edit.common.fetchSlurStart,e=Adagio.edit.common.fetchSlurStop;Adagio.getter.getSlurData=function(f,g){f.checkPartIdx(g.partIdx),f.checkMeasureIdx(g.measureIdx);var h=c(f,g),i=h.getMeasureData(g.measureIdx);if(!f.hasPartVoiceIdx(g.partIdx,g.voiceIdx))throw new b(g.voiceIdx);if(i.hasVoice(g.voiceIdx)){i.getVoice(g.voiceIdx).checkNoteIdx(g.noteIdx)}var j={},k=d(h,g);if(null===k)throw new a;j.startMeasureIdx=k.measureIdx,j.startNoteIdx=k.noteIdx;var l=e(h,g);if(null===l)throw new a;return j.stopMeasureIdx=l.measureIdx,j.stopNoteIdx=l.noteIdx,j}}.call(this),function(){"use strict";var a=Adagio.edit.common.initMeasureData,b=Adagio.Data.octaveShift.searchOctaveShift,c=Adagio.Utils.typeUtils,d=Adagio.Utils.clefUtils,e=Adagio.Utils.noteUtils,f=Adagio.Utils.pitchUtils,g=Adagio.Utils.unpitchedUtils,h=Adagio.Utils.pitchLineUtils,i=Adagio.Utils.transposeUtils,j=Adagio.Utils.measureUtils,k=Adagio.Utils.direction.octaveShiftDirectionUtils;Adagio.getter.getGrace=function(a,b){return new l(a,b).get()};var l=function(a,b){this.init(a,b)},m=l.prototype;m.init=function(a,b){this.scoreData=a,this.location=b,this.pitch=null,this.unpitched=null,this.octaveShifts={},this.timePos=null},m.get=function(){this.noteData={};var b={};a.call(b,this.scoreData,this.location),this.measureData=b.measureData,this.measureData.checkVoiceIdx(this.location.voiceIdx);var c=this.getVoice();return c.checkGraceIdx(this.location.noteIdx,this.location.graceIdx),c.isUnpitched(this.location.noteIdx)?this.extractUnpitchedInstrument():this.extractPitched(),this.fillNoteData(),this.noteData},m.getVoice=function(){return this.measureData.getVoice(this.location.voiceIdx)},m.extractUnpitchedInstrument=function(){var a=this.getVoice(),b=a.getGraceChord(this.location.noteIdx,this.location.graceIdx);b=c.makeArray(b).slice(),this.baseNote=b[0],b.sort(n),this.noteData.noteheads=b.map(e.getHead),this.noteData.lines=b.map(p),this.noteData.accidentals=b.map(o),this.noteData.isChord=b.length>1,this.getUnpitchedInstruments(b),this.extractDuration(),this.extractIsSlashed()};var n=function(a,b){var c=e.getUnpitched(a),d=e.getUnpitched(b);return g.compare(c,d)},o=function(){return null},p=function(a){var b=e.getUnpitched(a),c=d.createPercussion();return h.toLine(g,b,c)};m.getUnpitchedInstruments=function(a){this.noteData.unpitched=a.map(function(a){var b=e.getInstrumentId(a),c=this.location.partIdx;return{MIDIUnpitched:this.scoreData.searchInstrumentMIDIUnpitched(c,b)}},this)},m.extractPitched=function(){var a=this.getVoice(),b=a.getGraceChord(this.location.noteIdx,this.location.graceIdx);b=c.makeArray(b).slice(),this.baseNote=b[0],b.sort(q),this.noteData.isChord=b.length>1,this.extractStaffIndexes(b),this.getPitches(b),this.getLines(),this.extractAccidentals(b),this.extractDuration(),this.extractIsSlashed(),this.shiftLinesIfNeeded()};var q=function(a,b){var c=e.getPitch(a),d=e.getPitch(b);return f.compareLine(c,d)};m.extractStaffIndexes=function(a){this.staffIndexes=a.map(e.getStaffIdx)},m.getPitches=function(a){var b=a.map(e.getPitch);b=b.map(this.transposePitchIfNeeded,this),this.noteData.pitches=b.map(r)};var r=function(a){return{step:f.getStep(a),octave:f.getOctave(a),alter:f.getAlter(a)}};m.transposePitchIfNeeded=function(a,b){if(!this.location.isConcertPitch)return a;var c=this.staffIndexes[b],d=this.getTranspose(c);return i.isIdentity(d)?a:a=f.transpose(a,d,!0)},m.getTranspose=function(a){return this.measureData.getTranspose(a)},m.getLines=function(){this.noteData.lines=this.noteData.pitches.map(this.pitchToLine,this)},m.pitchToLine=function(a,b){var c=this.staffIndexes[b],d=this.getClef(c);return f.pitchToLine(a,d)},m.getClef=function(a){return this.measureData.getClef(a)},m.extractAccidentals=function(a){this.noteData.accidentals=a.map(this.extractAccidental,this)},m.extractAccidental=function(a,b){if(e.hasAccidental(a)){var c=e.getPitch(a);c=this.transposePitchIfNeeded(c,b);var d=f.getAlter(c);return f.alterToAccidental(d)}return null},m.shiftLinesIfNeeded=function(){void 0!==this.noteData.lines&&(this.noteData.lines=this.noteData.lines.map(this.shiftLineIfNeeded,this))},m.shiftLineIfNeeded=function(a,b){var c=this.staffIndexes[b],d=this.getOctaveShift(c);return null!==d&&(a=k.applyShiftToLine(d,a)),a},m.getOctaveShift=function(a){return void 0===this.octaveShifts[a]&&this.initOctaveShift(a),this.octaveShifts[a]},m.initOctaveShift=function(a){var c=this.measureData.getMeasure(),d=s(c,a);if(null!==d||j.hasOctaveShifts(c,a)){var e=this.getTimePos(),f=j.getOctaveShifts(c,a),g=b(d,f,e,!0);this.octaveShifts[a]=g}else this.octaveShifts[a]=null},m.getTimePos=function(){if(null===this.timePos){var a=this.measureData.getVoice(this.location.voiceIdx);this.timePos=a.getRangeSpace(0,this.location.noteIdx)}return this.timePos};var s=function(a,b){return j.hasLeftOctaveShift(a,b)?j.getLeftOctaveShift(a,b):null};m.extractDuration=function(){this.noteData.durationType=e.getDurationType(this.baseNote)},m.extractIsSlashed=function(){e.isSlashedGrace(this.baseNote)&&(this.noteData.isSlashed=!0)},m.fillNoteData=function(){var a=this.scoreData.getNoteData(this.location);this.noteData.articulations=a.articulations,this.noteData.technical=a.technical,this.noteData.ornaments=a.ornaments,this.noteData.isRest=a.isRest,this.noteData.lyrics=a.lyrics,this.noteData.isTied=a.isTied||!1,this.noteData.hasGlissando=a.hasGlissando||!1,this.noteData.tupletType=a.tupletType,this.noteData.wedgeType=a.wedgeType,this.noteData.dynamicStyle=a.dynamicStyle,null!==a.dynamicStyle&&(this.noteData.dynamicIdx=a.dynamicIdx),void 0!==this.noteData.tempoChange&&(this.noteData.tempoChange=a.tempoChange),this.noteData.isInSlur=a.isInSlur,this.noteData.harmony=a.harmony,this.noteData.hasArpeggio=a.hasArpeggio||!1,this.noteData.nbGraces=a.nbGraces,this.noteData.possibleTuplets=a.possibleTuplets,this.noteData.possibleExpandedTuplets=a.possibleExpandedTuplets}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.BadAbsoluteGraceIdx=function(b,d){var e=c(d),f=a.call(this,e);return this.name=f.name="BadAbsoluteGraceIdx",this.stack=f.stack,this.message=f.message,this.absoluteGraceIdx=d,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"The absulute grace idx ["+a+"] is invalid."}}.call(this),function(){"use strict";var a=Adagio.edit.common.initMeasureData,b=Adagio.Utils.math,c=Adagio.Error.client.BadAbsoluteGraceIdx;Adagio.getter.getNoteIdxForAbsoluteGraceIdx=function(d,e){if(!b.isInteger(e.absoluteGraceIdx)||e.absoluteGraceIdx<0)throw new c(e.absoluteGraceIdx);var f={};a.call(f,d,e);var g=f.measureData;g.checkVoiceIdx(e.voiceIdx);for(var h=g.getVoice(e.voiceIdx),i=0,j=h.getNbNotes(),k=0;k<j;k++){if((i+=h.getNbGraces(k))>e.absoluteGraceIdx)return k}throw new c(e.absoluteGraceIdx)}}.call(this),function(){"use strict";var a=Adagio.edit.common.initMeasureData,b=Adagio.Utils.noteUtils;Adagio.getter.getSlurPossibleRightSide=function(a,b){return new c(a,b).get()};var c=function(a,b){this.init(a,b)},d=c.prototype;d.init=function(a,b){this.scoreData=a,this.location=b},d.get=function(){this.noteData={};var c={};a.call(c,this.scoreData,this.location),this.measureData=c.measureData,this.measureData.checkVoiceIdx(this.location.voiceIdx),this.measureData.getVoice(this.location.voiceIdx).checkNoteIdx(this.location.noteIdx);var d=this.getNote();if(b.hasSlur(d))return null;if(!this.canMoveForward())return null;do{if(this.moveForward(),!this.hasVoice())return null;if(d=this.getNote(),b.hasSlur(d))return null;if(!b.isRest(d))return{measureIdx:this.location.measureIdx,noteIdx:this.location.noteIdx}}while(this.canMoveForward());return null},d.canMoveForward=function(){var a=this.measureData.getVoice(this.location.voiceIdx),b=a.getNbNotes(),c=this.scoreData.getNbMeasures();return this.location.noteIdx<b-1||this.location.measureIdx<c-1},d.hasVoice=function(){return this.measureData.hasVoice(this.location.voiceIdx)},d.moveForward=function(){var a=this.measureData.getVoice(this.location.voiceIdx),b=a.getNbNotes();this.location.noteIdx<b-1?this.location.noteIdx++:(this.location.noteIdx=0,this.location.measureIdx++,this.measureData=this.measureData.getNextMeasure());for(var c=this.scoreData.getNbMeasures();this.location.measureIdx<c&&!this.measureData.hasVoice(this.location.voiceIdx);)this.location.noteIdx=0,this.location.measureIdx++,this.measureData.hasNextMeasure()&&(this.measureData=this.measureData.getNextMeasure())},d.getNote=function(){return this.measureData.getVoice(this.location.voiceIdx).getNote(this.location.noteIdx)}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadPartIdxError,b=Adagio.Error.client.BadMeasureIdxError,c=Adagio.Error.client.BadStaffIdxError,d=Adagio.edit.common.MeasureData,e=Adagio.getter.getNotesRange,f=Adagio.Utils.math,g=Adagio.Utils.partContentUtils;Adagio.getter.getStaffVoicesData=function(h,i){var j=i.partIdx,k=h.getNbParts();if(!f.isInteger(k)||j<0||j>=k)throw new a(j,a.GET);var l=h.getNbMeasures(),m=i.measureIdx;if(!f.isInteger(m)||m<0||m>=l)throw new b(m,b.GET);var n=h.getPartContent(i.partIdx),o=g.getNbStaves(n),p=i.staffIdx;if(!f.isInteger(p)||p<0||p>=o)throw new c(p,c.action.GET);var q=h.getMeasure(j,m),r=h.getPartStaffVoicesIndexes(i.partIdx,i.staffIdx),s=new d(q);return r.map(function(a){if(!s.hasVoice(a))return null;var b=s.getVoice(a),c={partIdx:i.partIdx,measureIdx:i.measureIdx,voiceIdx:a,startNoteIdx:b.getStartNoteIdx(),stopNoteIdx:b.getStopNoteIdx()};return e(h,c,s)})}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.NoPedalError=function(){var b="There is no pedal at this location.",c=a.call(this,b);return this.name=c.name="NoPedalError",this.stack=c.stack,this.message=c.message,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}})}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.BadPedalIdxError=function(b){var c="There is no pedal at the index ["+b+"].",d=a.call(this,c);return this.name=d.name="BadPedalIdxError",this.stack=d.stack,this.message=d.message,this.pedalIdx=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}})}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Values.PedalType,c=Adagio.Utils.measureUtils,d=Adagio.Utils.direction.pedalDirectionUtils;Adagio.edit.common.searchPedalSides=function(a,b,c,d){var f=new e(a,b,c,d);return f.search(),f.getResult()};var e=function(a,b,c,d){this.init(a,b,c,d)},f=e.prototype;f.init=function(a,b,c,d){this.measures=a,this.entryMeasureIdx=b,this.entryTimePos=d,this.entryStaffIdx=c,this.candidateMeasureIdx=null,this.directionsByMeasures={},this.startTimePos=null,this.startMeasureIdx=null,this.stopTimePos=null,this.stopMeasureIdx=null,this.placement=null},f.search=function(){this.searchStart(),this.isStartAtEntry()&&this.shiftEntryTimePos(),this.searchStop()},f.searchStart=function(){for(this.candidateMeasureIdx=this.entryMeasureIdx;this.candidateMeasureIdx>=0&&!this.hasFoundStart();this.candidateMeasureIdx--)this.searchStartMeasure();if(!this.hasFoundStart()){throw new a("PedalStartNotFound","We were not able to find the pedal left side.")}},f.searchStartMeasure=function(){var a=this.getPedalDirectionsAtCandidateMeasure();this.isEntryMeasure()&&(a=this.filterLowerOrEqual(a)),this.searchStartTimePos(a)},f.filterLowerOrEqual=function(a){for(var b=[],c=a.length,e=0;e<c;e++){var f=a[e];if(d.getTimePos(f)>this.entryTimePos)return b;b.push(f)}return b},f.searchStartTimePos=function(a){for(var c=a.length,e=c-1;e>=0&&!this.hasFoundStart();e--){var f=a[e];d.getType(f)===b.START&&this.startFound(f,f)}},f.hasFoundStart=function(){return null!==this.startMeasureIdx},f.startFound=function(a){var b=d.getTimePos(a);this.startTimePos=b,this.startMeasureIdx=this.candidateMeasureIdx,this.placement=d.getPlacement(a)},f.isStartAtEntry=function(){return this.startMeasureIdx===this.entryMeasureIdx&&this.startTimePos===this.entryTimePos},f.shiftEntryTimePos=function(){this.entryTimePos++},f.searchStop=function(){var b=this.measures.length;for(this.candidateMeasureIdx=this.entryMeasureIdx;this.candidateMeasureIdx<b&&!this.hasFoundStop();this.candidateMeasureIdx++)this.searchStopMeasure();if(!this.hasFoundStop()){throw new a("PedalStopNotFound","We were not able to find the pedal right side.")}},f.searchStopMeasure=function(){var a=this.getPedalDirectionsAtCandidateMeasure();this.isEntryMeasure()&&(a=this.filterGreaterOrEqual(a)),this.searchStopTimePos(a)},f.getPedalDirectionsAtCandidateMeasure=function(){if(void 0===this.directionsByMeasures[this.candidateMeasureIdx]){var a=this.measures[this.candidateMeasureIdx],b=c.getPedals(a,this.entryStaffIdx);b.sort(g),this.directionsByMeasures[this.candidateMeasureIdx]=b}return this.directionsByMeasures[this.candidateMeasureIdx]};var g=function(a,b){return d.getTimePos(a)-d.getTimePos(b)};f.isEntryMeasure=function(){return this.candidateMeasureIdx===this.entryMeasureIdx},f.filterGreaterOrEqual=function(a){for(var b=[],c=a.length,e=c-1;e>=0;e--){var f=a[e];if(d.getTimePos(f)<this.entryTimePos)return b;b.unshift(f)}return b},f.searchStopTimePos=function(a){for(var c=a.length,e=0;e<c&&!this.hasFoundStop();e++){var f=a[e];d.getType(f)===b.STOP&&this.stopFound(f)}},f.hasFoundStop=function(){return null!==this.stopMeasureIdx},f.stopFound=function(a){var b=d.getTimePos(a);this.stopTimePos=b,this.stopMeasureIdx=this.candidateMeasureIdx},f.getResult=function(){return{startMeasureIdx:this.startMeasureIdx,startTimePos:this.startTimePos,stopMeasureIdx:this.stopMeasureIdx,stopTimePos:this.stopTimePos,placement:this.placement}}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.IncompatibleVoiceStaffIdxError=function(b,d,e){var f=c(b,d,e),g=a.call(this,f);return this.name=g.name="IncompatibleVoiceStaffIdxError",this.stack=g.stack,this.message=g.message,this.voiceIdx=b,this.staffIdx=d,this.partIdx=e,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a,b,c){return"voiceIdx["+a+"] is not binded to staff ["+b+"] in the part at index ["+c+"]."}}.call(this),function(){"use strict";var a=Adagio.Error.client.IncompatibleVoiceStaffIdxError,b=Adagio.edit.common.getScoreData;Adagio.edit.common.checkCompatibleVoiceStaffIdx=function(c,d){if(c=b(c),!c.getPartVoiceMapping(d.partIdx)[d.voiceIdx].includes(d.staffIdx))throw new a(d.voiceIdx,d.staffIdx,d.partIdx)}}.call(this),function(){"use strict";var a=Adagio.Error.client.NoPedalError,b=Adagio.Error.client.MissingOptionError,c=Adagio.Error.client.BadPedalIdxError,d=Adagio.Utils.noteUtils,e=Adagio.Utils.measureUtils,f=Adagio.Utils.partContentUtils,g=Adagio.Utils.math,h=Adagio.Utils.direction.pedalDirectionUtils,i=Adagio.Data.pedal.searchPedal,j=Adagio.edit.common.searchPedalSides,k=Adagio.edit.common.timePosToFloorNoteIdx,l=Adagio.edit.common.wideTimePosToFloorNoteIdx,m=Adagio.edit.common.MeasuresScroller,n=Adagio.edit.common.checkCompatibleVoiceStaffIdx,o=Adagio.Values.PedalType;Adagio.getter.getPedalData=function(a,b){var c=new p(a,b);return c.checkPreconditions(),c.get()};var p=Adagio.edit.action.PedalGetter=function(a,b){this.init(a,b)},q=p.prototype;q.init=function(a,b){this.scoreData=a,this.location=b,this.measuresScroller=null,this.targetTimePos=null},q.checkPreconditions=function(){this.checkLocation(),this.sanitize(),this.checkExistence()},q.checkLocation=function(){this.scoreData.checkPartIdx(this.location.partIdx),this.scoreData.checkMeasureIdx(this.location.measureIdx),this.getMeasureData(this.location.measureIdx).checkVoiceIdx(this.location.voiceIdx),n(this.scoreData,this.location)},q.sanitize=function(){if(void 0!==this.location.pedalIdx){var a=this.getTargetMeasure(),d=e.getPedals(a,this.location.staffIdx);if(!g.isInteger(this.location.pedalIdx)||this.location.pedalIdx>=d.length)throw new c(this.location.pedalIdx);var f=d[this.location.pedalIdx];this.targetTimePos=h.getTimePos(f)}else{if(void 0===this.location.noteIdx)throw new b("noteIdx OR pedalIdx");var i=this.getTargetVoice();i.checkNoteIdx(this.location.noteIdx),this.targetTimePos=r(i,this.location.noteIdx)}},q.fillTargetTimePos=function(){};var r=function(a,b){for(var c=0,e=0;e<b;e++){var f=a.getNote(e);c+=d.getDuration(f)}return c};q.getTargetVoice=function(){return this.getMeasureData(this.location.measureIdx).getVoice(this.location.voiceIdx)},q.checkExistence=function(){if(!this.hasPedal())throw new a},q.hasPedal=function(){var a=this.getTargetMeasure(),b=e.getPedals(a,this.location.staffIdx),c=s(a,this.location.staffIdx);return null!==i(c,b,this.targetTimePos)},q.getTargetMeasure=function(){return this.scoreData.getMeasure(this.location.partIdx,this.location.measureIdx)};var s=function(a,b){return e.hasLeftPedal(a,b)?e.getLeftPedal(a,b):null};q.get=function(){this.searchSides(),this.convertSidesToNoteIdx(),this.fetchPedalsIdx();var a={placement:this.placement,startPedalIdx:this.startPedalIdx,stopPedalIdx:this.stopPedalIdx};return this.addLocationData(a),a},q.addLocationData=function(a){var b=this.location.partIdx,c=this.scoreData.voiceIdxToIdxInMainStaff(b,this.startVoiceIdx),d=this.scoreData.voiceIdxToIdxInMainStaff(b,this.stopVoiceIdx);a.startMeasureIdx=this.startMeasureIdx,a.startVoiceIdx=this.startVoiceIdx,a.startIdxInStaff=c,a.startNoteIdx=this.startNoteIdx,a.stopMeasureIdx=this.stopMeasureIdx,a.stopVoiceIdx=this.stopVoiceIdx,a.stopIdxInStaff=d,a.stopNoteIdx=this.stopNoteIdx},q.searchSides=function(){var a=this.getMeasures(),b=j(a,this.location.measureIdx,this.location.staffIdx,this.targetTimePos);this.startMeasureIdx=b.startMeasureIdx,this.startTimePos=b.startTimePos,this.stopMeasureIdx=b.stopMeasureIdx,this.stopTimePos=b.stopTimePos,this.placement=b.placement},q.getMeasures=function(){var a=this.scoreData.getPartContent(this.location.partIdx);return f.getMeasures(a)},q.convertSidesToNoteIdx=function(){this.convertLeftSide(),this.convertRightSide()},q.convertLeftSide=function(){var a=this.getLeftVoice();this.startNoteIdx=k(a,1,this.startTimePos)},q.getLeftVoice=function(){var a=this.getMeasureData(this.startMeasureIdx);if(a.hasVoice(this.location.voiceIdx))this.startVoiceIdx=this.location.voiceIdx;else{var b=this.scoreData.getPartStaffVoicesIndexes(this.location.partIdx,this.location.staffIdx);b=b.filter(a.hasVoice,a),this.startVoiceIdx=b[0]}return a.getVoice(this.startVoiceIdx)},q.convertRightSide=function(){var a=this.getRightVoice();this.stopNoteIdx=l(a,1,this.stopTimePos)},q.getRightVoice=function(){var a=this.getMeasureData(this.stopMeasureIdx);if(a.hasVoice(this.location.voiceIdx))this.stopVoiceIdx=this.location.voiceIdx;else{var b=this.scoreData.getPartStaffVoicesIndexes(this.location.partIdx,this.location.staffIdx);b=b.filter(a.hasVoice,a),this.stopVoiceIdx=b[0]}return a.getVoice(this.stopVoiceIdx)},q.getMeasureData=function(a){return this.getMeasuresScroller().getMeasureData(a)},q.getMeasuresScroller=function(){if(null===this.measuresScroller){var a=this.location.partIdx,b=this.scoreData.getPartContent(a),c=f.getMeasures(b);this.measuresScroller=new m(c,a,this.scoreData)}return this.measuresScroller},q.fetchPedalsIdx=function(){this.fetchLeftPedalIdx(),this.fetchRightPedalIdx()},q.fetchLeftPedalIdx=function(){this.pedalIdx=null;var a=this.scoreData.getMeasure(this.location.partIdx,this.startMeasureIdx),b=e.getPedals(a,this.location.staffIdx);this.startPedalIdx=b.findIndex(function(a){var b=h.getTimePos(a),c=h.getType(a);return b===this.startTimePos&&c===o.START},this)},q.fetchRightPedalIdx=function(){this.pedalIdx=null;var a=this.scoreData.getMeasure(this.location.partIdx,this.stopMeasureIdx),b=e.getPedals(a,this.location.staffIdx);this.stopPedalIdx=b.findIndex(function(a){var b=h.getTimePos(a),c=h.getType(a);return b===this.stopTimePos&&c===o.STOP},this)}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.NotPossibleOnUnpitchedError=function(){var b="This operation is not allowed on an unpitched part",c=a.call(this,b);return this.name=c.name="NotPossibleOnUnpitchedError",this.stack=c.stack,this.message=c.message,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}})}.call(this),function(){"use strict";var a=Adagio.Error.client.NotPossibleOnUnpitchedError,b=Adagio.edit.common.createScrollableMeasureData,c=Adagio.Utils.typeUtils,d=Adagio.Utils.noteUtils,e=Adagio.Utils.pitchUtils,f=Adagio.Utils.clefUtils;Adagio.getter.getPreviousRootPitch=function(a,b){return new g(a,b).get()};var g=function(a,b){this.init(a,b)},h=g.prototype;h.init=function(a,b){this.scoreData=a,this.location=b,this.pitch=null,this.done=!1,this.noteIdx=null},h.get=function(){if(this.scoreData.checkPartIdx(this.location.partIdx),this.scoreData.checkMeasureIdx(this.location.measureIdx),this.measureData=b(this.scoreData,this.location.partIdx,this.location.measureIdx),this.initialMeasureData=this.measureData,this.noteIdx=this.location.noteIdx,this.measureData.isUnpitched())throw new a;return this.measureData.checkVoiceIdx(this.location.voiceIdx),this.getVoice().checkNoteIdx(this.location.noteIdx),this.seekRoot(),null===this.pitch&&this.getClefPitch(),{step:e.getStep(this.pitch),octave:e.getOctave(this.pitch)}},h.seekRoot=function(){for(this.moveToPreviousNote();!this.done;){var a=this.getVoice();if(!a.isRest(this.noteIdx)){var b=a.getChord(this.noteIdx);b=c.makeArray(b);var f=b.reduce(i),g=d.getPitch(f);this.pitch=e.copy(g),this.done=!0}this.moveToPreviousNote()}};var i=function(a,b){var c=d.getPitch(a),f=d.getPitch(b);return e.naiveComparePitch(c,f)>0?b:a};h.moveToPreviousNote=function(){this.noteIdx>0?this.noteIdx--:this.moveToPreviousMeasure()},h.moveToPreviousMeasure=function(){do{if(!this.measureData.hasPreviousMeasure())return void(this.done=!0);this.measureData=this.measureData.getPreviousMeasure()}while(!this.measureData.hasVoice(this.location.voiceIdx));var a=this.getVoice();this.noteIdx=a.getNbNotes()-1},h.getVoice=function(){return this.measureData.getVoice(this.location.voiceIdx)},h.getClefPitch=function(){var a=this.scoreData.getPartVoiceMainStaffIdx(this.location.partIdx,this.location.voiceIdx),b=this.initialMeasureData.getClef(a),c=f.getStep(b),d=f.getOctave(b);this.pitch=e.create(d,c)}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.NoOctaveShiftError=function(){var b="There is no octave shift at this location.",c=a.call(this,b);return this.name=c.name="NoOctaveShiftError",this.stack=c.stack,this.message=c.message,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}})}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.BadOctaveShiftIdxError=function(b){var c="There is no octave shift at the index ["+b+"].",d=a.call(this,c);return this.name=d.name="BadOctaveShiftIdxError",this.stack=d.stack,this.message=d.message,this.octaveShiftIdx=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}})}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Values.OctaveShiftType,c=Adagio.Utils.measureUtils,d=Adagio.Utils.direction.octaveShiftDirectionUtils;Adagio.edit.common.searchOctaveShiftSides=function(a,b,c,d){var f=new e(a,b,c,d);return f.search(),f.getResult()};var e=function(a,b,c,d){this.init(a,b,c,d)},f=e.prototype;f.init=function(a,b,c,d){this.measures=a,this.entryMeasureIdx=b,this.entryTimePos=d,this.entryStaffIdx=c,this.candidateMeasureIdx=null,this.directionsByMeasures={},this.startTimePos=null,this.startMeasureIdx=null,this.stopTimePos=null,this.stopMeasureIdx=null,this.placement=null},f.search=function(){this.searchStart(),this.isStartAtEntry()&&this.shiftEntryTimePos(),this.searchStop()},f.searchStart=function(){for(this.candidateMeasureIdx=this.entryMeasureIdx;this.candidateMeasureIdx>=0&&!this.hasFoundStart();this.candidateMeasureIdx--)this.searchStartMeasure();if(!this.hasFoundStart()){throw new a("OctaveShiftStartNotFound","We were not able to find the octave shift left side.")}},f.searchStartMeasure=function(){var a=this.getOctaveShiftDirectionsAtCandidateMeasure();this.isEntryMeasure()&&(a=this.filterLowerOrEqual(a)),this.searchStartTimePos(a)},f.filterLowerOrEqual=function(a){for(var b=[],c=a.length,e=0;e<c;e++){var f=a[e];if(d.getTimePos(f)>this.entryTimePos)return b;b.push(f)}return b},f.searchStartTimePos=function(a){for(var c=a.length,e=c-1;e>=0&&!this.hasFoundStart();e--){
var f=a[e],g=d.getType(f);g!==b.UP&&g!==b.DOWN||this.startFound(f,f)}},f.hasFoundStart=function(){return null!==this.startMeasureIdx},f.startFound=function(a){var b=d.getTimePos(a);this.startTimePos=b,this.startMeasureIdx=this.candidateMeasureIdx,this.placement=d.getPlacement(a),this.type=d.getType(a),this.size=d.getSize(a)},f.isStartAtEntry=function(){return this.startMeasureIdx===this.entryMeasureIdx&&this.startTimePos===this.entryTimePos},f.shiftEntryTimePos=function(){this.entryTimePos++},f.searchStop=function(){var b=this.measures.length;for(this.candidateMeasureIdx=this.entryMeasureIdx;this.candidateMeasureIdx<b&&!this.hasFoundStop();this.candidateMeasureIdx++)this.searchStopMeasure();if(!this.hasFoundStop()){throw new a("OctaveShiftStopNotFound","We were not able to find the octave shift right side.")}},f.searchStopMeasure=function(){var a=this.getOctaveShiftDirectionsAtCandidateMeasure();this.isEntryMeasure()&&(a=this.filterGreaterOrEqual(a)),this.searchStopTimePos(a)},f.getOctaveShiftDirectionsAtCandidateMeasure=function(){if(void 0===this.directionsByMeasures[this.candidateMeasureIdx]){var a=this.measures[this.candidateMeasureIdx],b=c.getOctaveShifts(a,this.entryStaffIdx);b.sort(g),this.directionsByMeasures[this.candidateMeasureIdx]=b}return this.directionsByMeasures[this.candidateMeasureIdx]};var g=function(a,b){return d.getTimePos(a)-d.getTimePos(b)};f.isEntryMeasure=function(){return this.candidateMeasureIdx===this.entryMeasureIdx},f.filterGreaterOrEqual=function(a){for(var b=[],c=a.length,e=c-1;e>=0;e--){var f=a[e];if(d.getTimePos(f)<this.entryTimePos)return b;b.unshift(f)}return b},f.searchStopTimePos=function(a){for(var c=a.length,e=0;e<c&&!this.hasFoundStop();e++){var f=a[e];d.getType(f)===b.STOP&&this.stopFound(f)}},f.hasFoundStop=function(){return null!==this.stopMeasureIdx},f.stopFound=function(a){var b=d.getTimePos(a);this.stopTimePos=b,this.stopMeasureIdx=this.candidateMeasureIdx},f.getResult=function(){return{startMeasureIdx:this.startMeasureIdx,startTimePos:this.startTimePos,stopMeasureIdx:this.stopMeasureIdx,stopTimePos:this.stopTimePos,placement:this.placement,type:this.type,size:this.size}}}.call(this),function(){"use strict";var a=Adagio.Error.client.NoOctaveShiftError,b=Adagio.Error.client.MissingOptionError,c=Adagio.Error.client.BadOctaveShiftIdxError,d=Adagio.Utils.noteUtils,e=Adagio.Utils.measureUtils,f=Adagio.Utils.partContentUtils,g=Adagio.Utils.math,h=Adagio.Utils.direction.octaveShiftDirectionUtils,i=Adagio.Data.octaveShift.searchOctaveShift,j=Adagio.edit.common.searchOctaveShiftSides,k=Adagio.edit.common.timePosToFloorNoteIdx,l=Adagio.edit.common.wideTimePosToFloorNoteIdx,m=Adagio.edit.common.MeasuresScroller,n=Adagio.edit.common.checkCompatibleVoiceStaffIdx,o=Adagio.Values.OctaveShiftType;Adagio.getter.getOctaveShiftData=function(a,b){var c=new p(a,b);return c.checkPreconditions(),c.get()};var p=Adagio.edit.action.OctaveShiftGetter=function(a,b){this.init(a,b)},q=p.prototype;q.init=function(a,b){this.scoreData=a,this.location=b,this.measuresScroller=null,this.targetTimePos=null},q.checkPreconditions=function(){this.checkLocation(),this.sanitize(),this.checkExistence()},q.checkLocation=function(){this.scoreData.checkPartIdx(this.location.partIdx),this.scoreData.checkMeasureIdx(this.location.measureIdx),this.getMeasureData(this.location.measureIdx).checkVoiceIdx(this.location.voiceIdx),n(this.scoreData,this.location)},q.sanitize=function(){if(void 0!==this.location.octaveShiftIdx){var a=this.getTargetMeasure(),d=e.getOctaveShifts(a,this.location.staffIdx);if(!g.isInteger(this.location.octaveShiftIdx)||this.location.octaveShiftIdx>=d.length)throw new c(this.location.octaveShiftIdx);var f=d[this.location.octaveShiftIdx];this.targetTimePos=h.getTimePos(f)}else{if(void 0===this.location.noteIdx)throw new b("noteIdx OR octaveShiftIdx");var i=this.getTargetVoice();i.checkNoteIdx(this.location.noteIdx),this.targetTimePos=r(i,this.location.noteIdx)}},q.fillTargetTimePos=function(){};var r=function(a,b){for(var c=0,e=0;e<b;e++){var f=a.getNote(e);c+=d.getDuration(f)}return c};q.getTargetVoice=function(){return this.getMeasureData(this.location.measureIdx).getVoice(this.location.voiceIdx)},q.checkExistence=function(){if(!this.hasOctaveShift())throw new a},q.hasOctaveShift=function(){var a=this.getTargetMeasure(),b=e.getOctaveShifts(a,this.location.staffIdx),c=s(a,this.location.staffIdx);return null!==i(c,b,this.targetTimePos)},q.getTargetMeasure=function(){return this.scoreData.getMeasure(this.location.partIdx,this.location.measureIdx)};var s=function(a,b){return e.hasLeftOctaveShift(a,b)?e.getLeftOctaveShift(a,b):null};q.get=function(){this.searchSides(),this.convertSidesToNoteIdx(),this.fetchOctaveShiftsIdx();var a={placement:this.placement,type:this.type,size:this.size,startOctaveShiftIdx:this.startOctaveShiftIdx,stopOctaveShiftIdx:this.stopOctaveShiftIdx};return this.addLocationData(a),a},q.addLocationData=function(a){var b=this.location.partIdx,c=this.scoreData.voiceIdxToIdxInMainStaff(b,this.startVoiceIdx),d=this.scoreData.voiceIdxToIdxInMainStaff(b,this.stopVoiceIdx);a.startMeasureIdx=this.startMeasureIdx,a.startVoiceIdx=this.startVoiceIdx,a.startIdxInStaff=c,a.startNoteIdx=this.startNoteIdx,a.stopMeasureIdx=this.stopMeasureIdx,a.stopVoiceIdx=this.stopVoiceIdx,a.stopIdxInStaff=d,a.stopNoteIdx=this.stopNoteIdx},q.searchSides=function(){var a=this.getMeasures(),b=j(a,this.location.measureIdx,this.location.staffIdx,this.targetTimePos);this.startMeasureIdx=b.startMeasureIdx,this.startTimePos=b.startTimePos,this.stopMeasureIdx=b.stopMeasureIdx,this.stopTimePos=b.stopTimePos,this.placement=b.placement,this.type=b.type,this.size=b.size},q.getMeasures=function(){var a=this.scoreData.getPartContent(this.location.partIdx);return f.getMeasures(a)},q.convertSidesToNoteIdx=function(){this.convertLeftSide(),this.convertRightSide()},q.convertLeftSide=function(){var a=this.getLeftVoice();this.startNoteIdx=k(a,1,this.startTimePos)},q.getLeftVoice=function(){var a=this.getMeasureData(this.startMeasureIdx);if(a.hasVoice(this.location.voiceIdx))this.startVoiceIdx=this.location.voiceIdx;else{var b=this.scoreData.getPartStaffVoicesIndexes(this.location.partIdx,this.location.staffIdx);b=b.filter(a.hasVoice,a),this.startVoiceIdx=b[0]}return a.getVoice(this.startVoiceIdx)},q.convertRightSide=function(){var a=this.getRightVoice();this.stopNoteIdx=l(a,1,this.stopTimePos)},q.getRightVoice=function(){var a=this.getMeasureData(this.stopMeasureIdx);if(a.hasVoice(this.location.voiceIdx))this.stopVoiceIdx=this.location.voiceIdx;else{var b=this.scoreData.getPartStaffVoicesIndexes(this.location.partIdx,this.location.staffIdx);b=b.filter(a.hasVoice,a),this.stopVoiceIdx=b[0]}return a.getVoice(this.stopVoiceIdx)},q.getMeasureData=function(a){return this.getMeasuresScroller().getMeasureData(a)},q.getMeasuresScroller=function(){if(null===this.measuresScroller){var a=this.location.partIdx,b=this.scoreData.getPartContent(a),c=f.getMeasures(b);this.measuresScroller=new m(c,a,this.scoreData)}return this.measuresScroller},q.fetchOctaveShiftsIdx=function(){this.fetchLeftOctaveShiftIdx(),this.fetchRightOctaveShiftIdx()},q.fetchLeftOctaveShiftIdx=function(){this.octaveShiftIdx=null;var a=this.scoreData.getMeasure(this.location.partIdx,this.startMeasureIdx),b=e.getOctaveShifts(a,this.location.staffIdx);this.startOctaveShiftIdx=b.findIndex(function(a){var b=h.getTimePos(a),c=h.getType(a);return b===this.startTimePos&&c===o.UP||c===o.DOWN},this)},q.fetchRightOctaveShiftIdx=function(){this.octaveShiftIdx=null;var a=this.scoreData.getMeasure(this.location.partIdx,this.stopMeasureIdx),b=e.getOctaveShifts(a,this.location.staffIdx);this.stopOctaveShiftIdx=b.findIndex(function(a){var b=h.getTimePos(a),c=h.getType(a);return b===this.stopTimePos&&c===o.STOP},this)}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.NoTempoChangeError=function(){var b="There is no tempo change at this location.",c=a.call(this,b);return this.name=c.name="NoTempoChangeError",this.stack=c.stack,this.message=c.message,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}})}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.BadTempoChangeIdxError=function(b){var c="There is no tempo change at the index ["+b+"].",d=a.call(this,c);return this.name=d.name="BadTempoChangeIdxError",this.stack=d.stack,this.message=d.message,this.tempoChangeIdx=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}})}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Values.TempoChangeType,c=Adagio.Utils.direction.tempoChangeDirectionUtils,d=Adagio.Utils.durationUtils;Adagio.edit.common.searchTempoChangeSides=function(a,b,c,d){if(4!==arguments.length)throw new Error("DPQ missing");var f=new e(a,b,c,d);return f.search(),f.getResult()};var e=function(a,b,c,d){this.init(a,b,c,d)},f=e.prototype;f.init=function(a,b,c,e){this.commonContent=a,this.entryMeasureIdx=b,this.entryQuarterPos=d.divisionsToQuarter(c,e),this.candidateMeasureIdx=null,this.tempoChangesByMeasures={},this.startTimePos=null,this.startDpq=null,this.startMeasureIdx=null,this.stopTimePos=null,this.stopDpq=null,this.stopMeasureIdx=null,this.type=null},f.search=function(){this.searchStart(),this.searchStop()},f.searchStart=function(){for(this.candidateMeasureIdx=this.entryMeasureIdx;this.candidateMeasureIdx>=0&&!this.hasFoundStart();this.candidateMeasureIdx--)this.searchStartMeasure();if(!this.hasFoundStart()){throw new a("TempoChangeStartNotFound","We were not able to find the tempo change left side.")}},f.searchStartMeasure=function(){var a=this.getTempoChangeDirectionsAtCandidateMeasure();this.isEntryMeasure()&&(a=this.filterLowerOrEqual(a)),this.searchStartTimePos(a)},f.filterLowerOrEqual=function(a){for(var b=[],d=a.length,e=0;e<d;e++){var f=a[e];if(c.getQuarterPos(f)>this.entryQuarterPos)return b;b.push(f)}return b},f.searchStartTimePos=function(a){for(var d=a.length,e=d-1;e>=0&&!this.hasFoundStart();e--){var f=a[e],g=c.getType(f);b.isStart(g)&&this.startFound(f,f)}},f.hasFoundStart=function(){return null!==this.startMeasureIdx},f.startFound=function(a){this.startTimePos=c.getTimePos(a),this.startDpq=c.getDpq(a),this.startMeasureIdx=this.candidateMeasureIdx,this.type=c.getType(a)},f.searchStop=function(){var b=this.commonContent.getNbMeasures();for(this.candidateMeasureIdx=this.entryMeasureIdx;this.candidateMeasureIdx<b&&!this.hasFoundStop();this.candidateMeasureIdx++)this.searchStopMeasure();if(!this.hasFoundStop()){throw new a("TempoChangeStopNotFound","We were not able to find the tempo change right side.")}},f.searchStopMeasure=function(){var a=this.getTempoChangeDirectionsAtCandidateMeasure();this.isEntryMeasure()&&(a=this.filterGreaterOrEqual(a),this.isStartAtEntry()&&(a=this.filterDifferent(a))),this.searchStopTimePos(a)},f.getTempoChangeDirectionsAtCandidateMeasure=function(){if(void 0===this.tempoChangesByMeasures[this.candidateMeasureIdx]){var a=this.commonContent.getTempoChanges(this.candidateMeasureIdx);a.sort(c.compare),this.tempoChangesByMeasures[this.candidateMeasureIdx]=a}return this.tempoChangesByMeasures[this.candidateMeasureIdx]},f.isEntryMeasure=function(){return this.candidateMeasureIdx===this.entryMeasureIdx},f.filterGreaterOrEqual=function(a){for(var b=[],d=a.length,e=d-1;e>=0;e--){var f=a[e];if(c.getQuarterPos(f)<this.entryQuarterPos)return b;b.unshift(f)}return b},f.isStartAtEntry=function(){return d.divisionsToQuarter(this.startTimePos,this.startDpq)===this.entryQuarterPos&&this.startMeasureIdx===this.entryMeasureIdx},f.filterDifferent=function(a){return a=a.filter(this.isDifferent,this)},f.isDifferent=function(a){return c.getQuarterPos(a)!==this.entryQuarterPos||this.candidateMeasureIdx!==this.startMeasureIdx},f.searchStopTimePos=function(a){for(var d=a.length,e=0;e<d&&!this.hasFoundStop();e++){var f=a[e];c.getType(f)===b.STOP&&this.stopFound(f)}},f.hasFoundStop=function(){return null!==this.stopMeasureIdx},f.stopFound=function(a){this.stopTimePos=c.getTimePos(a),this.stopDpq=c.getDpq(a),this.stopMeasureIdx=this.candidateMeasureIdx},f.getResult=function(){return{startMeasureIdx:this.startMeasureIdx,startTimePos:this.startTimePos,startDpq:this.startDpq,stopMeasureIdx:this.stopMeasureIdx,stopTimePos:this.stopTimePos,stopDpq:this.stopDpq,type:this.type}}}.call(this),function(){"use strict";var a=Adagio.Error.client.NoTempoChangeError,b=Adagio.Error.client.MissingOptionError,c=Adagio.Error.client.BadTempoChangeIdxError,d=Adagio.Utils.noteUtils,e=Adagio.Utils.partContentUtils,f=Adagio.Utils.math,g=Adagio.Utils.direction.tempoChangeDirectionUtils,h=Adagio.Data.tempoChange.searchTempoChange,i=Adagio.edit.common.searchTempoChangeSides,j=Adagio.edit.common.timePosToFloorNoteIdx,k=Adagio.edit.common.wideTimePosToFloorNoteIdx,l=Adagio.edit.common.MeasuresScroller,m=Adagio.Values.TempoChangeType;Adagio.getter.getTempoChangeData=function(a,b){var c=new n(a,b);return c.checkPreconditions(),c.get()};var n=Adagio.edit.action.TempoChangeGetter=function(a,b){this.init(a,b)},o=n.prototype;o.init=function(a,b){this.scoreData=a,this.location=b,this.measuresScroller=null,this.targetTimePos=null,this.targetDpq=null},o.checkPreconditions=function(){this.checkLocation(),this.sanitize(),this.checkExistence()},o.checkLocation=function(){this.scoreData.checkPartIdx(this.location.partIdx),this.scoreData.checkMeasureIdx(this.location.measureIdx),this.getMeasureData(this.location.measureIdx).checkVoiceIdx(this.location.voiceIdx)},o.sanitize=function(){if(void 0!==this.location.tempoChangeIdx){var a=this.scoreData.getCommonContent(),d=a.getTempoChanges(this.location.measureIdx);if(!f.isInteger(this.location.tempoChangeIdx)||this.location.tempoChangeIdx>=d.length)throw new c(this.location.tempoChangeIdx);var e=d[this.location.tempoChangeIdx];this.targetTimePos=g.getTimePos(e),this.targetDpq=g.getDpq(e)}else{if(void 0===this.location.noteIdx)throw new b("noteIdx OR tempoChangeIdx");var h=this.getMeasureData(this.location.measureIdx),i=this.getTargetVoice();i.checkNoteIdx(this.location.noteIdx),this.targetTimePos=p(i,this.location.noteIdx),this.targetDpq=h.getDpqValue()}};var p=function(a,b){for(var c=0,e=0;e<b;e++){var f=a.getNote(e);c+=d.getDuration(f)}return c};o.getTargetVoice=function(){return this.getMeasureData(this.location.measureIdx).getVoice(this.location.voiceIdx)},o.checkExistence=function(){if(!this.hasTempoChange())throw new a},o.hasTempoChange=function(){var a=this.scoreData.getCommonContent(),b=a.getTempoChanges(this.location.measureIdx),c=q(a,this.location.measureIdx);return null!==h(c,b,this.targetTimePos,this.targetDpq)};var q=function(a,b){return a.hasLeftTempoChange(b)?a.getLeftTempoChange(b):null};o.get=function(){this.searchSides(),this.convertSidesToNoteIdx(),this.fetchTempoChangesIdx();var a={type:this.type,startTempoChangeIdx:this.startTempoChangeIdx,stopTempoChangeIdx:this.stopTempoChangeIdx};return this.addLocationData(a),a},o.addLocationData=function(a){var b=this.location.partIdx,c=this.scoreData.voiceIdxToIdxInMainStaff(b,this.startVoiceIdx),d=this.scoreData.voiceIdxToIdxInMainStaff(b,this.stopVoiceIdx);a.partIdx=this.location.partIdx,a.startMeasureIdx=this.startMeasureIdx,a.startVoiceIdx=this.startVoiceIdx,a.startIdxInStaff=c,a.startNoteIdx=this.startNoteIdx,a.stopMeasureIdx=this.stopMeasureIdx,a.stopVoiceIdx=this.stopVoiceIdx,a.stopIdxInStaff=d,a.stopNoteIdx=this.stopNoteIdx},o.searchSides=function(){var a=this.scoreData.getCommonContent(),b=i(a,this.location.measureIdx,this.targetTimePos,this.targetDpq);this.startMeasureIdx=b.startMeasureIdx,this.startTimePos=b.startTimePos,this.startDpq=b.startDpq,this.stopMeasureIdx=b.stopMeasureIdx,this.stopTimePos=b.stopTimePos,this.stopDpq=b.stopDpq,this.type=b.type},o.convertSidesToNoteIdx=function(){this.convertLeftSide(),this.convertRightSide()},o.convertLeftSide=function(){var a=this.getLeftVoice(),b=this.getMeasureData(this.startMeasureIdx),c=b.getDpqValue(),d=f.lcm(this.startDpq,c),e=this.startTimePos*d/this.startDpq,g=d/c;this.startNoteIdx=j(a,g,e)},o.getLeftVoice=function(){var a=this.getMeasureData(this.startMeasureIdx);if(a.hasVoice(this.location.voiceIdx))this.startVoiceIdx=this.location.voiceIdx;else{var b=0,c=this.scoreData.getPartStaffVoicesIndexes(this.location.partIdx,b);c=c.filter(a.hasVoice,a),this.startVoiceIdx=c[0]}return a.getVoice(this.startVoiceIdx)},o.convertRightSide=function(){var a=this.getRightVoice(),b=this.getMeasureData(this.stopMeasureIdx),c=b.getDpqValue(),d=f.lcm(this.stopDpq,c),e=this.stopTimePos*d/this.stopDpq,g=d/c;this.stopNoteIdx=k(a,g,e)},o.getRightVoice=function(){var a=this.getMeasureData(this.stopMeasureIdx);if(a.hasVoice(this.location.voiceIdx))this.stopVoiceIdx=this.location.voiceIdx;else{var b=0,c=this.scoreData.getPartStaffVoicesIndexes(this.location.partIdx,b);c=c.filter(a.hasVoice,a),this.stopVoiceIdx=c[0]}return a.getVoice(this.stopVoiceIdx)},o.getMeasureData=function(a){return this.getMeasuresScroller().getMeasureData(a)},o.getMeasuresScroller=function(){if(null===this.measuresScroller){var a=this.scoreData.getPartContent(this.location.partIdx),b=e.getMeasures(a);this.measuresScroller=new l(b,this.location.partIdx,this.scoreData)}return this.measuresScroller},o.fetchTempoChangesIdx=function(){this.fetchLeftTempoChangeIdx(),this.fetchRightTempoChangeIdx()},o.fetchLeftTempoChangeIdx=function(){this.tempoChangeIdx=null;var a=this.scoreData.getCommonContent(),b=a.getTempoChanges(this.startMeasureIdx);this.startTempoChangeIdx=b.findIndex(function(a){var b=g.getTimePos(a),c=g.getType(a);return b===this.startTimePos&&m.isStart(c)},this)},o.fetchRightTempoChangeIdx=function(){this.tempoChangeIdx=null;var a=this.scoreData.getCommonContent(),b=a.getTempoChanges(this.stopMeasureIdx);this.stopTempoChangeIdx=b.findIndex(function(a){var b=g.getTimePos(a),c=g.getType(a);return b===this.stopTimePos&&c===m.STOP},this)}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils;Adagio.edit.common.hasTimePosExactNoteIdx=function(b,c,d){for(var e=0,f=b.size(),g=0;g<f-1&&e<d;g++){var h=b.getNote(g);e+=a.getDuration(h)*c}return e===d}}.call(this),function(){"use strict";var a=Adagio.edit.common.timePosToFloorNoteIdx,b=Adagio.edit.common.hasTimePosExactNoteIdx,c=Adagio.Utils.measureUtils,d=Adagio.Utils.math;Adagio.edit.common.timePosIntervalToNoteIdxInterval=function(a,b,c){var d=e(a,b,c);if(null===d)return null;var h=f(a,b,c);return null===h?null:g(d,h)?null:{voiceIdx:c,startMeasureIdx:d.measureIdx,startNoteIdx:d.noteIdx,stopMeasureIdx:h.measureIdx,stopNoteIdx:h.noteIdx}};var e=function(c,e,f){var g=e.startMeasureIdx,h=c.getMeasureData(g);if(h.hasVoice(f)){var i=h.getVoice(f),j=h.getDpqValue(),k=d.lcm(j,e.startDpq),l=e.startTimePos*k/e.startDpq,m=k/j,n=a(i,m,l);b(i,m,l)||n++;if(n<i.getNbNotes())return{measureIdx:g,noteIdx:n}}g++;for(var o=c.getNbMeasures();g<o&&g<=e.stopMeasureIdx;g++)if(h=c.getMeasureData(g),h.hasVoice(f))return{measureIdx:g,noteIdx:0};return null},f=function(e,f,g){var h,i=f.stopMeasureIdx,j=e.getMeasureData(i);if(j.hasVoice(g)){var k=j.getMeasure(),l=j.getDpqValue(),m=d.lcm(l,f.stopDpq),n=f.stopTimePos*m/f.stopDpq,o=m/l,p=c.getNbDivisions(k)*o;if(h=j.getVoice(g),n===p)return{measureIdx:i,noteIdx:h.getNbNotes()-1};var q=a(h,o,n);if(b(h,o,n)&&q--,q>=0)return{measureIdx:i,noteIdx:q}}for(i--;i>=0&&i>=f.startMeasureIdx;i--)if(j=e.getMeasureData(i),j.hasVoice(g)){h=j.getVoice(g);var r=h.getNbNotes();return{measureIdx:i,noteIdx:r-1}}return null},g=function(a,b){return!(a.measureIdx<b.measureIdx)&&(a.measureIdx>b.measureIdx||a.noteIdx>b.noteIdx)}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils;Adagio.edit.common.searchIntervalTupletBounds=function(a,d){return{startNoteIdx:b(a,d),stopNoteIdx:c(a,d)}};var b=function(b,c){var d=c.startNoteIdx,e=b.getMeasureData(c.startMeasureIdx),f=e.getVoice(c.voiceIdx),g=f.getNote(d);if(!a.hasNormalTimeModif(g))for(;!a.hasTupletStart(g);)d--,g=f.getNote(d);return d},c=function(b,c){var d=c.stopNoteIdx,e=b.getMeasureData(c.stopMeasureIdx),f=e.getVoice(c.voiceIdx),g=f.getNote(d);if(!a.hasNormalTimeModif(g))for(;!a.hasTupletStop(g);)d++,g=f.getNote(d);return d}}.call(this),function(){"use strict";var a=Adagio.Utils.math,b=Adagio.Utils.measureUtils,c=Adagio.Utils.directionUtils,d=Adagio.getter.TimeRangeSingleDirectionsAbstractGetter=function(a,b,c){this.init(a,b,c)},e=d.prototype;e.init=function(a,b,c){this.scoreData=a,this.location=b,this.utils=c,this.entities=[]},e.get=function(){this.initTimePos(),this.measureIdx=this.location.startMeasureIdx;for(var a=this.location.stopMeasureIdx;this.measureIdx<=a;this.measureIdx++){this.adaptDpq();var b=this.getMeasure(this.measureIdx),c=this.utils.getEntities(b,this.location.staffIdx);c=c.filter(this.positionPredicate,this),c.forEach(this.addEntity,this),this.moveForward()}return this.entities},e.initTimePos=function(){var c=this.getMeasure(this.location.startMeasureIdx),d=b.getDpq(c);this.dpq=a.lcm(d,this.location.startDpq);var e=this.location.startTimePos*this.dpq/this.location.startDpq;this.timePos=-e},e.adaptDpq=function(){var c=this.getMeasure(this.measureIdx),d=b.getDpq(c),e=a.lcm(this.dpq,d),f=e/this.dpq;this.timePos*=f,this.dpq=e},e.getDpq=function(a){var c=this.getMeasure(a);return b.getDpq(c)},e.getMeasure=function(a){return this.scoreData.getMeasure(this.location.partIdx,a)},e.positionPredicate=function(a){var b=c.getTimePos(a);if(this.measureIdx===this.location.startMeasureIdx){var d=this.getMeasureDpq(this.location.startMeasureIdx);if(b*this.location.startDpq/d<this.location.startTimePos)return!1}if(this.measureIdx===this.location.stopMeasureIdx){var e=this.getMeasureDpq(this.location.stopMeasureIdx);if(b*this.location.stopDpq/e>=this.location.stopTimePos)return!1}return!0},e.addEntity=function(a){var b=this.getMeasureDpq(this.measureIdx),d=this.dpq/b,e=c.getTimePos(a);e*=d,e+=this.timePos;var f={timePos:e,dpq:this.dpq};this.utils.fillEntity(a,f),this.entities.push(f)},e.getMeasureDpq=function(a){var c=this.getMeasure(a);return b.getDpq(c)},e.moveForward=function(){var a=this.getMeasure(this.measureIdx),c=b.getDpq(a),d=b.getNbDivisions(a);d*=this.dpq/c,this.timePos+=d}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.direction.dynamicDirectionUtils,c=Adagio.getter.TimeRangeSingleDirectionsAbstractGetter,d=function(a,c){c.sound=e(a),c.style=b.getStyle(a),c.placement=b.getPlacement(a)},e=function(a){return b.hasSound(a)?b.getSound(a):null},f={getEntities:a.getDynamics,fillEntity:d};Adagio.getter.getTimeRangeDynamics=function(a,b){return new c(a,b,f).get()}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.direction.wordDirectionUtils,c=Adagio.getter.TimeRangeSingleDirectionsAbstractGetter,d=function(a,c){c.text=b.getText(a),c.placement=b.getPlacement(a)},e={getEntities:a.getWords,fillEntity:d};Adagio.getter.getTimeRangeWords=function(a,b){return new c(a,b,e).get()}}.call(this),function(){"use strict";var a=Adagio.Utils.math,b=Adagio.Utils.fractionUtils={};b.create=function(a,b){return{numerator:a,denominator:b}},b.add=function(a,c){b.makeSameDenominatorIfNeeded(a,c);var d=b.getNumerator(a),e=b.getNumerator(c),f=b.getDenominator(a),g=d+e;return b.create(g,f)},b.sub=function(a,c){b.makeSameDenominatorIfNeeded(a,c);var d=b.getNumerator(a),e=b.getNumerator(c),f=b.getDenominator(a),g=d-e;return b.create(g,f)},b.isGreaterOrEqualThan=function(a,c){return b.makeSameDenominatorIfNeeded(a,c),b.getNumerator(a)>=b.getNumerator(c)},b.isGreater=function(a,c){return b.makeSameDenominatorIfNeeded(a,c),b.getNumerator(a)>b.getNumerator(c)},b.makeSameDenominatorIfNeeded=function(a,c){b.isSameDenominator(a,c)||b.makeSameDenominator(a,c)},b.isSameDenominator=function(a,c){return b.getDenominator(a)===b.getDenominator(c)},b.makeSameDenominator=function(c,d){var e=b.getDenominator(c),f=b.getDenominator(d),g=a.lcm(e,f),h=b.getNumerator(c);h*=g/e,b.setNumerator(c,h),b.setDenominator(c,g);var i=b.getNumerator(d);i*=g/f,b.setNumerator(d,i),b.setDenominator(d,g)},b.copy=function(a){var c=b.getNumerator(a),d=b.getDenominator(a);return b.copy(c,d)},b.getDenominator=function(a){return a.denominator},b.setDenominator=function(a,b){a.denominator=b},b.getNumerator=function(a){return a.numerator},b.setNumerator=function(a,b){a.numerator=b},b.isSame=function(a,c){var d=b.getNumerator(a),e=b.getNumerator(c),f=b.getDenominator(a),g=b.getDenominator(c);return d===e&&f===g}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.directionUtils,c=Adagio.Utils.fractionUtils,d=Adagio.Error.InternalError,e=Adagio.getter.TimeRangeRangeDirectionsAbstractGetter=function(a,b,c){this.init(a,b,c)},f=e.prototype;f.init=function(a,b,c){this.scoreData=a,this.location=b,this.utils=c,this.entities=[],this.ongoingEntry=null},f.get=function(){this.initTimePos(),this.measureIdx=this.location.startMeasureIdx;for(var a=this.location.stopMeasureIdx;this.measureIdx<=a;this.measureIdx++){var b=this.utils.getEntities.call(this,this.measureIdx);b=b.filter(this.positionPredicate,this),b.forEach(this.addEntity,this),this.moveForward()}return this.entities},f.initTimePos=function(){this.position=c.create(-this.location.startTimePos,this.location.startDpq),this.startPosition=c.create(this.location.startTimePos,this.location.startDpq),this.stopPosition=c.create(this.location.stopTimePos,this.location.stopDpq)},f.getDpq=function(b){var c=this.getMeasure(b);return a.getDpq(c)},f.getMeasure=function(a){return this.scoreData.getMeasure(this.location.partIdx,a)},f.positionPredicate=function(a){var d=b.getTimePos(a);if(this.measureIdx===this.location.startMeasureIdx){var e=this.utils.getDpq.call(this,a,this.location.startMeasureIdx),f=c.create(d,e);if(c.isGreater(this.startPosition,f))return!1}if(this.measureIdx===this.location.stopMeasureIdx){var g=this.utils.getDpq.call(this,a,this.location.stopMeasureIdx),h=c.create(d,g);if(c.isGreater(h,this.stopPosition))return!1}return!0},f.addEntity=function(a){if(this.utils.isStart(a))this.addStart(a);else{if(!this.utils.isStop(a))throw new d("Unexpected");this.addStop(a)}},f.addStart=function(a){if(this.hasStart())throw new d("Unexpected");var b=this.getEntityFinalPosition(a),e=c.getNumerator(b),f=c.getDenominator(b),g={startTimePos:e,startDpq:f};this.utils.fillEntity(a,g),this.ongoingEntry=g},f.addStop=function(a){if(this.hasStart()){var b=this.getEntityFinalPosition(a),d=c.getNumerator(b),e=c.getDenominator(b),f=this.ongoingEntry;this.ongoingEntry=null,f.stopTimePos=d,f.stopDpq=e,this.entities.push(f)}},f.getEntityFinalPosition=function(a){var d=b.getTimePos(a),e=this.utils.getDpq.call(this,a,this.measureIdx),f=c.create(d,e);return c.add(this.position,f)},f.hasStart=function(){return null!==this.ongoingEntry},f.getMeasureDpq=function(b){var c=this.getMeasure(b);return a.getDpq(c)},f.moveForward=function(){var b=this.getMeasure(this.measureIdx),d=a.getDpq(b),e=a.getNbDivisions(b),f=c.create(e,d);this.position=c.add(this.position,f)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.direction.octaveShiftDirectionUtils,c=Adagio.getter.TimeRangeRangeDirectionsAbstractGetter,d=function(a,c){c.size=b.getSize(a),c.placement=b.getPlacement(a)},e=function(b){var c=this.getMeasure(b);return a.getOctaveShifts(c,this.location.staffIdx)},f=function(a,b){return this.getMeasureDpq(b)},g={getEntities:e,isStart:b.isStart,isStop:b.isStop,fillEntity:d,getDpq:f};Adagio.getter.getTimeRangeOctaveShifts=function(a,b){return new c(a,b,g).get()}}.call(this),function(){"use strict";var a=Adagio.Utils.direction.tempoChangeDirectionUtils,b=Adagio.getter.TimeRangeRangeDirectionsAbstractGetter,c=function(b,c){c.type=a.getType(b)},d=function(a){return this.scoreData.getCommonContent().getTempoChanges(a)},e=function(b){return a.getDpq(b)},f={getEntities:d,isStart:a.isStart,isStop:a.isStop,fillEntity:c,getDpq:e};Adagio.getter.getTimeRangeTempoChanges=function(a,c){return new b(a,c,f).get()}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.direction.pedalDirectionUtils,c=Adagio.getter.TimeRangeRangeDirectionsAbstractGetter,d=function(a,c){c.placement=b.getPlacement(a)},e=function(b){var c=this.getMeasure(b);return a.getPedals(c,this.location.staffIdx)},f=function(a,b){return this.getMeasureDpq(b)},g={getEntities:e,isStart:b.isStart,isStop:b.isStop,fillEntity:d,getDpq:f};Adagio.getter.getTimeRangePedals=function(a,b){return new c(a,b,g).get()}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.directionUtils,c=Adagio.Utils.wedgeUtils,d=Adagio.getter.TimeRangeRangeDirectionsAbstractGetter,e=function(a,d){d.placement=b.getPlacement(a);var e=b.getWedge(a);d.type=c.getType(e)},f=function(b){var c=this.getMeasure(b),d=a.getWedgeDirections(c);return d=d.filter(g,this.location.staffIdx)},g=function(a){var c=this.valueOf();return b.getStaffIdx(a)===c},h=function(a,b){return this.getMeasureDpq(b)},i=function(a){var d=b.getWedge(a);return c.isLeft(d)},j=function(a){var d=b.getWedge(a);return c.isRight(d)},k={getEntities:f,isStart:i,isStop:j,fillEntity:e,getDpq:h};Adagio.getter.getTimeRangeWedges=function(a,b){return new d(a,b,k).get()}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadPartIdxError,b=Adagio.Error.client.BadMeasureIdxError,c=Adagio.Error.client.IncompatibleVoiceStaffIdxError,d=Adagio.Error.client.RevertRangeError,e=Adagio.getter.getNotesRangeCrossMeasure,f=Adagio.getter.getTimeRangeDynamics,g=Adagio.getter.getTimeRangeWords,h=Adagio.getter.getTimeRangeOctaveShifts,i=Adagio.getter.getTimeRangeTempoChanges,j=Adagio.getter.getTimeRangePedals,k=Adagio.getter.getTimeRangeWedges,l=Adagio.edit.common.getMeasuresScroller,m=Adagio.edit.common.timePosIntervalToNoteIdxInterval,n=Adagio.edit.common.searchIntervalTupletBounds,o=Adagio.Utils.math,p=Adagio.Utils.mapUtils,q=Adagio.Utils.noteUtils,r=Adagio.Utils.measureUtils;Adagio.getter.getStaffContentCrossMeasure=function(a,b){return new s(a,b).get()};var s=function(a,b){this.init(a,b)},t=s.prototype;t.init=function(a,b){this.scoreData=a,this.location=b,this.startTimePos=null,this.startDpq=null,this.stopTimePos=null,this.stopDpq=null,this.firstLocation=null,this.voicesMap={}},t.get=function(){return this.check(),this.fillVoices(),this.searchVoicesTupletBounds(),this.fillVoicesTimePos(),this.searchFirstLocation(),this.searchLastLocation(),this.fillVoicesData(),this.fillVoicesTimePosShift(),this.fillDynamics(),this.fillWords(),this.fillOctaveShifts(),this.fillTempoChanges(),this.fillPedals(),this.fillWedges(),this.generateData()},t.check=function(){this.checkLocation(),this.checkRevertRange(),this.checkStaffConsistent()},t.checkLocation=function(){var c=this.location.partIdx,d=this.scoreData.getNbParts();if(c<0||c>=d)throw new a(c,a.GET);this.measuresScroller=l(this.scoreData,this.location);var e,f=this.location.startMeasureIdx,g=this.location.stopMeasureIdx,h=this.scoreData.getNbMeasures();if((e=f)<0||e>=h)throw new b(e,b.GET);if((e=g)<0||e>=h)throw new b(e,b.GET);var i,j,k,m,n=this.location.startNoteIdx,o=this.location.stopNoteIdx;e=f,m=this.location.startVoiceIdx,k=n,i=this.measuresScroller.getMeasureData(e),i.checkVoiceIdx(m),j=i.getVoice(m),j.checkNoteIdx(k),e=g,k=o,m=this.location.stopVoiceIdx,i=this.measuresScroller.getMeasureData(e),i.checkVoiceIdx(m),j=i.getVoice(m),j.checkNoteIdx(k)},t.checkRevertRange=function(){var a=this.location.startMeasureIdx,b=this.location.stopMeasureIdx,c=b-a;if(c<0)throw new d(d.MEASURE,a,b);if(0===c){if(this.getStartTimePos()>this.getStopNoteTimePos())throw new d(d.NOTE,this.location.startNoteIdx,this.location.stopNoteIdx)}},t.getStopNoteTimePos=function(){return this.measuresScroller.getMeasureData(this.location.stopMeasureIdx).getVoice(this.location.stopVoiceIdx).getRangeSpace(0,this.location.stopNoteIdx)},t.checkStaffConsistent=function(){var a=this.location.partIdx;if(this.staffIdx=this.scoreData.getPartVoiceMainStaffIdx(a,this.location.startVoiceIdx),
this.scoreData.getPartVoiceMainStaffIdx(a,this.location.stopVoiceIdx)!==this.staffIdx)throw new c(this.location.stopVoiceIdx,this.staffIdx,a)},t.fillVoices=function(){this.scoreData.getPartVoicesIndexes(this.location.partIdx).forEach(this.fillVoice,this)},t.fillVoice=function(a){var b=this.getStartTimePos(),c=this.getStopTimePos(),d=this.getStartDpq(),e=this.getStopDpq(),f={startMeasureIdx:this.location.startMeasureIdx,startTimePos:b,startDpq:d,stopMeasureIdx:this.location.stopMeasureIdx,stopTimePos:c,stopDpq:e},g=m(this.measuresScroller,f,a);null!==g&&(this.voicesMap[a]=g)},t.getStartTimePos=function(){if(null===this.startTimePos){var a=this.measuresScroller.getMeasureData(this.location.startMeasureIdx),b=a.getVoice(this.location.startVoiceIdx);this.startTimePos=b.getRangeSpace(0,this.location.startNoteIdx)}return this.startTimePos},t.getStopTimePos=function(){if(null===this.stopTimePos){var a=this.measuresScroller.getMeasureData(this.location.stopMeasureIdx),b=a.getVoice(this.location.stopVoiceIdx),c=b.getNote(this.location.stopNoteIdx),d=q.getDuration(c);this.stopTimePos=b.getRangeSpace(0,this.location.stopNoteIdx)+d}return this.stopTimePos},t.getStartDpq=function(){if(null===this.startDpq){var a=this.measuresScroller.getMeasureData(this.location.startMeasureIdx);this.startDpq=a.getDpqValue()}return this.startDpq},t.getStopDpq=function(){if(null===this.stopDpq){var a=this.measuresScroller.getMeasureData(this.location.stopMeasureIdx);this.stopDpq=a.getDpqValue()}return this.stopDpq},t.searchVoicesTupletBounds=function(){p.forEach(this.voicesMap,this.searchVoiceTupletBounds,this)},t.searchVoiceTupletBounds=function(a,b){if(null!==b){var c=n(this.measuresScroller,b);b.startNoteIdx=c.startNoteIdx,b.stopNoteIdx=c.stopNoteIdx}},t.fillVoicesTimePos=function(){p.forEach(this.voicesMap,this.fillVoiceTimePos,this)},t.fillVoiceTimePos=function(a,b){a=parseInt(a,0);var c=this.measuresScroller.getMeasureData(b.startMeasureIdx),d=c.getVoice(a);b.startTimePos=d.getRangeSpace(0,b.startNoteIdx);var e=this.measuresScroller.getMeasureData(b.stopMeasureIdx),f=e.getVoice(a),g=f.getNote(b.stopNoteIdx),h=q.getDuration(g);b.stopTimePos=f.getRangeSpace(0,b.stopNoteIdx)+h},t.searchFirstLocation=function(){var a=p.getValues(this.voicesMap),b=a.map(u);this.firstLocation=b.reduce(v)};var u=function(a){return{measureIdx:a.startMeasureIdx,timePos:a.startTimePos}},v=function(a,b){return a.measureIdx<b.measureIdx?a:b.measureIdx<a.measureIdx?b:a.timePos<b.timePos?a:b};t.searchLastLocation=function(){var a=p.getValues(this.voicesMap),b=a.map(w);this.lastLocation=b.reduce(x)};var w=function(a){return{measureIdx:a.stopMeasureIdx,timePos:a.stopTimePos}},x=function(a,b){return a.measureIdx>b.measureIdx?a:b.measureIdx>a.measureIdx?b:a.timePos>b.timePos?a:b};t.fillVoicesTimePosShift=function(){p.forEach(this.voicesMap,this.fillVoiceTimePosShift,this)},t.fillVoiceTimePosShift=function(a,b){for(var c=0,d=1,e=this.firstLocation.measureIdx;e<=b.startMeasureIdx;){var f=this.measuresScroller.getMeasureData(e),g=f.getDpqValue(),h=o.lcm(d,g);c*=h/d,d=h;var i=f.getMeasure(),j=r.getNbDivisions(i);if(j*=h/g,c+=j,e===this.firstLocation.measureIdx){c-=this.firstLocation.timePos*h/g}if(e===b.startMeasureIdx){c-=j-b.startTimePos*h/g}e++}b.timePosShift=c,b.dpq=d},t.fillVoicesData=function(){p.forEach(this.voicesMap,this.fillVoiceData,this)},t.fillVoiceData=function(a,b){a=parseInt(a,0);var c={partIdx:this.location.partIdx,voiceIdx:b.voiceIdx,startMeasureIdx:b.startMeasureIdx,startNoteIdx:b.startNoteIdx,stopMeasureIdx:b.stopMeasureIdx,stopNoteIdx:b.stopNoteIdx},d=e(this.scoreData,c,this.measuresScroller);b.data=d},t.fillDynamics=function(){var a={partIdx:this.location.partIdx,staffIdx:this.staffIdx,startMeasureIdx:this.firstLocation.measureIdx,startTimePos:this.firstLocation.timePos,stopMeasureIdx:this.lastLocation.measureIdx,stopTimePos:this.lastLocation.timePos};a.startDpq=this.getMeasureDpq(a.startMeasureIdx),a.stopDpq=this.getMeasureDpq(a.stopMeasureIdx),this.dynamics=f(this.scoreData,a)},t.fillWords=function(){var a={partIdx:this.location.partIdx,staffIdx:this.staffIdx,startMeasureIdx:this.firstLocation.measureIdx,startTimePos:this.firstLocation.timePos,stopMeasureIdx:this.lastLocation.measureIdx,stopTimePos:this.lastLocation.timePos};a.startDpq=this.getMeasureDpq(a.startMeasureIdx),a.stopDpq=this.getMeasureDpq(a.stopMeasureIdx),this.words=g(this.scoreData,a)},t.fillOctaveShifts=function(){var a={partIdx:this.location.partIdx,staffIdx:this.staffIdx,startMeasureIdx:this.firstLocation.measureIdx,startTimePos:this.firstLocation.timePos,stopMeasureIdx:this.lastLocation.measureIdx,stopTimePos:this.lastLocation.timePos};a.startDpq=this.getMeasureDpq(a.startMeasureIdx),a.stopDpq=this.getMeasureDpq(a.stopMeasureIdx),this.octaveShifts=h(this.scoreData,a)},t.fillTempoChanges=function(){var a={partIdx:this.location.partIdx,staffIdx:this.staffIdx,startMeasureIdx:this.firstLocation.measureIdx,startTimePos:this.firstLocation.timePos,stopMeasureIdx:this.lastLocation.measureIdx,stopTimePos:this.lastLocation.timePos};a.startDpq=this.getMeasureDpq(a.startMeasureIdx),a.stopDpq=this.getMeasureDpq(a.stopMeasureIdx),this.tempoChanges=i(this.scoreData,a)},t.fillPedals=function(){var a={partIdx:this.location.partIdx,staffIdx:this.staffIdx,startMeasureIdx:this.firstLocation.measureIdx,startTimePos:this.firstLocation.timePos,stopMeasureIdx:this.lastLocation.measureIdx,stopTimePos:this.lastLocation.timePos};a.startDpq=this.getMeasureDpq(a.startMeasureIdx),a.stopDpq=this.getMeasureDpq(a.stopMeasureIdx),this.pedals=j(this.scoreData,a)},t.fillWedges=function(){var a={partIdx:this.location.partIdx,staffIdx:this.staffIdx,startMeasureIdx:this.firstLocation.measureIdx,startTimePos:this.firstLocation.timePos,stopMeasureIdx:this.lastLocation.measureIdx,stopTimePos:this.lastLocation.timePos};a.startDpq=this.getMeasureDpq(a.startMeasureIdx),a.stopDpq=this.getMeasureDpq(a.stopMeasureIdx),this.wedges=k(this.scoreData,a)},t.getMeasureDpq=function(a){var b=this.getMeasure(a);return r.getDpq(b)},t.getMeasure=function(a){return this.scoreData.getMeasure(this.location.partIdx,a)},t.generateData=function(){return{voices:this.generateVoices(),dynamics:this.dynamics,words:this.words,octaveShifts:this.octaveShifts,tempoChanges:this.tempoChanges,pedals:this.pedals,wedges:this.wedges}},t.generateVoices=function(){return this.scoreData.getPartStaffVoicesIndexes(this.location.partIdx,this.staffIdx).map(this.getVoiceData,this)},t.getVoiceData=function(a){if(void 0!==this.voicesMap[a]){var b=this.voicesMap[a];return{data:b.data,timePosShift:b.timePosShift,dpq:b.dpq}}return null}}.call(this),function(){"use strict";var a=Adagio.edit.common.initMeasureData;Adagio.getter.getPartVoiceNbNotes=function(b,c){var d={};a.call(d,b,c);var e=d.measureData;return e.checkVoiceIdx(c.voiceIdx),e.getVoice(c.voiceIdx).getNbNotes()}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadVoiceError,b=Adagio.Utils.measureUtils,c=Adagio.Utils.noteUtils;Adagio.getter.hasMeasureVoice=function(c,e){if(c.checkPartIdx(e.partIdx),c.checkMeasureIdx(e.measureIdx),!c.hasPartVoiceIdx(e.partIdx,e.voiceIdx))throw new a(e.voiceIdx);var f=c.getMeasure(e.partIdx,e.measureIdx);return b.getNotes(f).some(d,e)};var d=function(a){var b=this;return c.getVoiceIdx(a)===b.voiceIdx}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadStaffIdxError,b=Adagio.Utils.measureUtils,c=Adagio.Utils.noteUtils,d=Adagio.Utils.math;Adagio.getter.getMeasureStaffNbDisplayedVoices=function(c,f){c.checkPartIdx(f.partIdx),c.checkMeasureIdx(f.measureIdx);var g=c.getMeasure(f.partIdx,f.measureIdx),h=b.getNbStaves(g),i=f.staffIdx;if(!d.isInteger(i)||i<0||i>=h)throw new a(i);var j=b.getNotes(g),k={staffIdx:i,voicesSet:{}};return j.forEach(e,k),Object.keys(k.voicesSet).length};var e=function(a){var b=this;if(c.getStaffIdx(a)===b.staffIdx){var d=c.getVoiceIdx(a);b.voicesSet[d]=!0}}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.BadIdxInStaffError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadIdxInStaffError",this.stack=e.stack,this.message=e.message,this.idxInStaff=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"Bad index in staff ["+a+"] for voice insertion."}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadStaffIdxError,b=Adagio.Error.client.BadIdxInStaffError,c=Adagio.Utils.measureUtils,d=Adagio.Utils.noteUtils,e=Adagio.Utils.math;Adagio.getter.getMeasureVoiceIdxAtDisplayedIdxInStaff=function(d,g){var h=g.partIdx;d.checkPartIdx(h),d.checkMeasureIdx(g.measureIdx);var i=(g.voiceIdx,d.getMeasure(h,g.measureIdx)),j=c.getNbStaves(i),k=g.staffIdx;if(!e.isInteger(k)||k<0||k>=j)throw new a(k);var l=c.getNotes(i),m={staffIdx:k,voicesSet:{}};l.forEach(f,m);var n=Object.keys(m.voicesSet),o=n.length,p=g.idxInStaff;if(!e.isInteger(p)||p<0||p>=o)throw new b(p);return 1===o?parseInt(n[0],10):d.getPartStaffVoiceAtIdx(h,k,p)};var f=function(a){var b=this;if(d.getStaffIdx(a)===b.staffIdx){var c=d.getVoiceIdx(a);b.voicesSet[c]=!0}}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.timeModifUtils;Adagio.edit.common.convertNoteRef=function(a,d){a.checkVoiceIdx(d.voiceIdxRef);var e=a.getVoice(d.voiceIdxRef);e.checkNoteIdx(d.noteIdxRef);var f=c(e,d.noteIdxRef);d.divisions=a.getDpqValue(),d.timePos=e.getRangeSpace(0,f),d.timeModif=b.createDefault(),delete d.voiceIdxRef,delete d.noteIdxRef};var c=function(b,c){for(;;){var d=b.getNote(c);if(!a.hasTimeModif(d))return c;if(a.hasTupletStart(d))return c;c--}}}.call(this),function(){"use strict";var a=Adagio.edit.common.initMeasureData,b=Adagio.edit.common.convertNoteRef,c=Adagio.edit.common.timePosToFloorNoteIdx,d=Adagio.Utils.math;Adagio.getter.refToNoteIdx=function(e,f){var g={};a.call(g,e,f);var h=g.measureData;h.checkVoiceIdx(f.voiceIdx);var i=h.getVoice(f.voiceIdx);if(f.voiceIdxRef===f.voiceIdx)return i.checkNoteIdx(f.noteIdxRef),f.noteIdxRef;b(h,f);var j=h.getDpqValue(),k=d.lcm(j,f.divisions),l=f.timePos*k/f.divisions;return c(i,k/j,l)}}.call(this),function(){"use strict";var a=Adagio.edit.common.MeasureData;Adagio.getter.compareNotesTimePos=function(b,c,d){var e=c.partIdx;if(b.checkPartIdx(e),b.checkMeasureIdx(c.measureIdx),b.checkMeasureIdx(d.measureIdx),c.measureIdx!==d.measureIdx)return c.measureIdx-d.measureIdx;var f=b.getMeasure(e,c.measureIdx),g=new a(f);g.checkVoiceIdx(c.voiceIdx),g.checkVoiceIdx(d.voiceIdx);var h=g.getVoice(c.voiceIdx),i=g.getVoice(d.voiceIdx);return h.checkNoteIdx(c.noteIdx),i.checkNoteIdx(d.noteIdx),h.getRangeSpace(0,c.noteIdx)-i.getRangeSpace(0,d.noteIdx)}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadStaffIdxError,b=Adagio.edit.common.MeasureData,c=Adagio.edit.common.timePosToFloorNoteIdx,d=Adagio.edit.common.hasTimePosExactNoteIdx,e=Adagio.Utils.measureUtils,f=Adagio.Utils.math;Adagio.getter.getClosestLeftNote=function(c,d){c.checkPartIdx(d.partIdx);var i=d.measureIdx;c.checkMeasureIdx(i);var j,k,l;if(0===d.noteIdx){if(0===i)return null;i--,k=c.getMeasure(d.partIdx,i),j=e.getNbDivisions(k),l=new b(k)}else{k=c.getMeasure(d.partIdx,i),l=new b(k),l.checkVoiceIdx(d.voiceIdx);var m=l.getVoice(d.voiceIdx);m.checkNoteIdx(d.noteIdx),j=m.getRangeSpace(0,d.noteIdx)}var n=e.getNbStaves(k),o=d.staffIdx;if(!f.isInteger(o)||o<0||o>=n)throw new a(o);var p=c.getPartStaffVoicesIndexes(d.partIdx,d.staffIdx);p=p.filter(l.hasVoice,l);var q={timePos:j,measureData:l},r=p.map(g,q),s=r.reduce(h);return{partIdx:d.partIdx,measureIdx:i,staffIdx:d.staffIdx,voiceIdx:s.voiceIdx,noteIdx:s.noteIdx}};var g=function(a){a=parseInt(a,10);var b,e=this,f=e.measureData.getVoice(a),g=e.timePos,h=f.getNbNotes();if(g===f.getRangeSpace(0,h))b=h-1;else{var i=1;b=c(f,i,g),d(f,i,g)&&b--}return{voiceIdx:a,noteIdx:b,timePos:f.getRangeSpace(0,b)}},h=function(a,b){return a.timePos>b.timePos?a:b}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadStaffIdxError,b=Adagio.edit.common.MeasureData,c=Adagio.edit.common.timePosToFloorNoteIdx,d=Adagio.Utils.measureUtils,e=Adagio.Utils.math;Adagio.getter.getClosestRightNote=function(c,i){c.checkPartIdx(i.partIdx),c.checkMeasureIdx(i.measureIdx);var j=c.getMeasure(i.partIdx,i.measureIdx),k=new b(j);k.checkVoiceIdx(i.voiceIdx);var l=k.getVoice(i.voiceIdx);l.checkNoteIdx(i.noteIdx);var m=l.getRangeSpace(0,i.noteIdx),n=d.getNbStaves(j),o=i.staffIdx;if(!e.isInteger(o)||o<0||o>=n)throw new a(o);var p=c.getPartStaffVoicesIndexes(i.partIdx,i.staffIdx);p=p.filter(k.hasVoice,k);var q={timePos:m,measureData:k,measureIdx:i.measureIdx,scoreData:c},r=p.map(f,q),s=r.reduce(g),t=c.getNbMeasures();return s.measureIdx===t?null:(s.measureIdx>i.measureIdx&&(s=h(c,i)),{partIdx:i.partIdx,measureIdx:s.measureIdx,staffIdx:i.staffIdx,voiceIdx:s.voiceIdx,noteIdx:s.noteIdx})};var f=function(a){a=parseInt(a,10);var b,d=this,e=d.measureData.getVoice(a),f=d.timePos,g=1,h=c(e,g,f)+1,i=d.measureIdx,j=e.getNbNotes();return h===j?(h=0,i++,b=0):b=e.getRangeSpace(0,h),{voiceIdx:a,measureIdx:i,noteIdx:h,timePos:b}},g=function(a,b){return a.measureIdx<b.measureIdx?a:a.measureIdx>b.measureIdx?b:a.timePos<b.timePos?a:b},h=function(a,c){var d=c.measureIdx+1,e=a.getMeasure(c.partIdx,d),f=new b(e),g=a.getPartStaffVoicesIndexes(c.partIdx,c.staffIdx);return g=g.filter(f.hasVoice,f),{voiceIdx:g[0],measureIdx:d,noteIdx:0,timePos:0}}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Error.client.RevertRangeError,c=Adagio.Error.client.BadStaffIdxError,d=Adagio.Error.client.BadVoiceError,e=Adagio.Utils.measureUtils,f=Adagio.Utils.partContentUtils,g=Adagio.edit.common.MeasuresScroller,h=Adagio.getter.MeasuresRangesAbstractGetter=function(a,b,c){this.init(a,b,c)},i=h.prototype;i.init=function(a,b,c){this.utils=c,this.scoreData=a,this.location=b,this.measuresScroller=null,this.start=null},i.checkPreconditions=function(){this.checkLocation()},i.checkLocation=function(){this.scoreData.checkPartIdx(this.location.partIdx);var a=this.location.startMeasureIdx,c=this.location.stopMeasureIdx;if(this.scoreData.checkMeasureIdx(a),this.scoreData.checkMeasureIdx(c),a>c)throw new b(b.MEASURE,a,c);this.checkStaffIdx(),this.checkVoiceIdx()},i.checkStaffIdx=function(){var a=this.getMeasure(0),b=e.getNbStaves(a);if(this.location.staffIdx<0||this.location.staffIdx>=b)throw new c(this.location.staffIdx)},i.checkVoiceIdx=function(){if(!this.scoreData.hasPartVoiceIdx(this.location.partIdx,this.location.voiceIdx))throw new d(this.location.voiceIdx)},i.get=function(){if(this.entries=[],this.hasLeftContinue()){var a=this.searchLeftStart();this.addStart(a)}for(var b=this.location.startMeasureIdx,c=this.location.stopMeasureIdx,d=b;d<=c;d++){this.measureIdx=d;this.utils.getEntities.call(this,d).forEach(this.processEntity,this)}if(this.hasStart()){var e=this.searchRightStop();this.addStop(e)}return this.entries},i.processEntity=function(b){var c=this.measureIdx;if(this.utils.isEntityStart(b)){var d=this.createStart(b,c);this.addStart(d)}else{if(!this.utils.isEntityStop(b))throw new a("Unexpected");var e=this.createStop(b,c);this.addStop(e)}},i.hasLeftContinue=function(){return this.utils.hasLeftContinue.call(this)},i.searchLeftStart=function(){return this.utils.searchLeftStart.call(this)},i.createStart=function(a,b){return this.utils.createStart.call(this,a,b)},i.createStop=function(a,b){return this.utils.createStop.call(this,a,b)},i.addStart=function(b){if(this.hasStart())throw new a("Unexpected","There is already an entity started");this.start=b},i.hasRightContinue=function(){return this.utils.hasRightContinue.call(this)},i.searchRightStop=function(){return this.utils.searchRightStop.call(this)},i.getMeasure=function(a){return this.scoreData.getMeasure(this.location.partIdx,a)},i.addStop=function(b){if(!this.hasStart())throw new a("Unexpected","There is no entity started");this.closeEntity(this.start,b),this.start=null},i.hasStart=function(){return null!==this.start},i.closeEntity=function(a,b){var c=this.utils.createEntry.call(this,a,b);this.entries.push(c)},i.getVoice=function(a){var b=this.getMeasureData(a),c=this.getVoiceIdx(a);return b.getVoice(c)},i.getVoiceIdx=function(a){var b=this.getMeasureData(a);if(b.hasVoice(this.location.voiceIdx))return this.location.voiceIdx;var c=this.scoreData.getPartStaffVoicesIndexes(this.location.partIdx,this.location.staffIdx);return c=c.filter(b.hasVoice,b),c[0]},i.getMeasureData=function(a){return this.getMeasuresScroller().getMeasureData(a)},i.getMeasuresScroller=function(){if(null===this.measuresScroller){var a=this.location.partIdx,b=this.getMeasures();this.measuresScroller=new g(b,a,this.scoreData)}return this.measuresScroller},i.getMeasures=function(){var a=this.scoreData.getPartContent(this.location.partIdx);return f.getMeasures(a)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.direction.octaveShiftDirectionUtils,c=Adagio.edit.common.searchOctaveShiftSides,d=Adagio.edit.common.timePosToFloorNoteIdx,e=Adagio.edit.common.wideTimePosToFloorNoteIdx,f=Adagio.getter.MeasuresRangesAbstractGetter;Adagio.getter.getMeasuresRangeOctaveShifts=function(a,c){var d={hasLeftContinue:g,searchLeftStart:h,getEntities:i,createStart:j,createStop:k,hasRightContinue:l,searchRightStop:m,createEntry:n,isEntityStart:b.isStart,isEntityStop:b.isStop},e=new f(a,c,d);return e.checkPreconditions(),e.get()};var g=function(){var b=this.getMeasure(this.location.startMeasureIdx);return a.hasLeftOctaveShift(b,this.location.staffIdx)},h=function(){var b=this.getMeasures(),d=c(b,this.location.startMeasureIdx,this.location.staffIdx,0),e=this.getMeasure(d.startMeasureIdx),f=a.getDpq(e);return{measureIdx:d.startMeasureIdx,timePos:d.startTimePos,dpq:f,placement:d.placement,type:d.type,size:d.size}},i=function(b){var c=this.getMeasure(b);return a.getOctaveShifts(c,this.location.staffIdx)},j=function(c,d){var e=b.getTimePos(c),f=b.getPlacement(c),g=b.getType(c),h=b.getSize(c),i=this.getMeasure(d);return{measureIdx:d,timePos:e,dpq:a.getDpq(i),placement:f,type:g,size:h}},k=function(c,d){var e=b.getTimePos(c),f=this.getMeasure(d);return{measureIdx:d,timePos:e,dpq:a.getDpq(f)}},l=function(){var b=this.getMeasure(this.location.stopMeasureIdx);return a.hasRightOctaveShift(b,this.location.staffIdx)},m=function(){var b=this.getMeasures(),d=c(b,this.location.stopMeasureIdx+1,this.location.staffIdx,0),e=this.getMeasure(d.stopMeasureIdx),f=a.getDpq(e);return{measureIdx:d.stopMeasureIdx,timePos:d.stopTimePos,dpq:f}},n=function(a,b){var c={startMeasureIdx:a.measureIdx,startTimePos:a.timePos,startDpq:a.dpq,stopMeasureIdx:b.measureIdx,stopTimePos:b.timePos,stopDpq:b.dpq,placement:a.placement,type:a.type,size:a.size},f=this.location.partIdx,g=1;c.startVoiceIdx=this.getVoiceIdx(a.measureIdx);var h=this.getVoice(a.measureIdx);c.startNoteIdx=d(h,g,a.timePos),c.startIdxInStaff=this.scoreData.voiceIdxToIdxInMainStaff(f,c.startVoiceIdx),c.stopVoiceIdx=this.getVoiceIdx(b.measureIdx);var i=this.getVoice(b.measureIdx);return c.stopNoteIdx=e(i,g,b.timePos),c.stopIdxInStaff=this.scoreData.voiceIdxToIdxInMainStaff(f,c.stopVoiceIdx),c}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.directionUtils,c=Adagio.Utils.wedgeUtils,d=Adagio.Values.WedgeLocation,e=Adagio.edit.common.searchWedgeSides,f=Adagio.edit.common.timePosToFloorNoteIdx,g=Adagio.edit.common.wideTimePosToFloorNoteIdx,h=Adagio.getter.MeasuresRangesAbstractGetter;Adagio.getter.getMeasuresRangeWedges=function(a,b){var c={hasLeftContinue:i,searchLeftStart:j,getEntities:k,createStart:m,createStop:n,hasRightContinue:o,searchRightStop:p,createEntry:q,isEntityStart:r,isEntityStop:s},d=new h(a,b,c);return d.checkPreconditions(),d.get()};var i=function(){var b=this.getMeasure(this.location.startMeasureIdx);return a.hasLeftWedge(b,this.location.staffIdx)},j=function(){var b=this.getMeasures(),c=e(b,this.location.startMeasureIdx,this.location.staffIdx,0),d=this.getMeasure(c.startMeasureIdx),f=a.getDpq(d);return{measureIdx:c.startMeasureIdx,timePos:c.startTimePos,dpq:f,placement:c.placement,type:c.type}},k=function(b){var c=this.getMeasure(b),d=a.getWedgeDirections(c);return d=d.filter(l,this.location.staffIdx)},l=function(a){var c=this.valueOf();return b.getStaffIdx(a)===c},m=function(d,e){var f=b.getTimePos(d),g=b.getPlacement(d),h=b.getWedge(d),i=c.getType(h),j=this.getMeasure(e);return{measureIdx:e,timePos:f,dpq:a.getDpq(j),placement:g,type:i}},n=function(c,d){var e=b.getTimePos(c),f=this.getMeasure(d);return{measureIdx:d,timePos:e,dpq:a.getDpq(f)}},o=function(){var b=this.getMeasure(this.location.stopMeasureIdx);return a.hasRightWedge(b,this.location.staffIdx)},p=function(){var b=this.getMeasures(),c=e(b,this.location.stopMeasureIdx+1,this.location.staffIdx,0),d=this.getMeasure(c.stopMeasureIdx),f=a.getDpq(d);return{measureIdx:c.stopMeasureIdx,timePos:c.stopTimePos,dpq:f}},q=function(a,b){var c={startMeasureIdx:a.measureIdx,startTimePos:a.timePos,startDpq:a.dpq,stopMeasureIdx:b.measureIdx,stopTimePos:b.timePos,stopDpq:b.dpq,placement:a.placement,type:a.type},d=this.location.partIdx,e=1;c.startVoiceIdx=this.getVoiceIdx(a.measureIdx);var h=this.getVoice(a.measureIdx);c.startNoteIdx=f(h,e,a.timePos),c.startIdxInStaff=this.scoreData.voiceIdxToIdxInMainStaff(d,c.startVoiceIdx),c.stopVoiceIdx=this.getVoiceIdx(b.measureIdx);var i=this.getVoice(b.measureIdx);return c.stopNoteIdx=g(i,e,b.timePos),c.stopIdxInStaff=this.scoreData.voiceIdxToIdxInMainStaff(d,c.stopVoiceIdx),c},r=function(a){var e=b.getWedge(a);return c.getLocation(e)===d.LEFT},s=function(a){var e=b.getWedge(a);return c.getLocation(e)===d.RIGHT}}.call(this),function(){"use strict";var a=Adagio.Utils.direction.tempoChangeDirectionUtils,b=Adagio.edit.common.searchTempoChangeSides,c=Adagio.edit.common.timePosToFloorNoteIdx,d=Adagio.edit.common.wideTimePosToFloorNoteIdx,e=Adagio.getter.MeasuresRangesAbstractGetter;Adagio.getter.getMeasuresRangeTempoChanges=function(b,c){var d={hasLeftContinue:f,searchLeftStart:g,getEntities:h,createStart:i,createStop:j,hasRightContinue:k,searchRightStop:l,createEntry:m,isEntityStart:a.isStart,isEntityStop:a.isStop},n=new e(b,c,d);return n.checkPreconditions(),n.get()};var f=function(){return this.scoreData.getCommonContent().hasLeftTempoChange(this.location.startMeasureIdx)},g=function(){var a=this.scoreData.getCommonContent(),c=0,d=1,e=b(a,this.location.startMeasureIdx,c,d);return{measureIdx:e.startMeasureIdx,timePos:e.startTimePos,dpq:e.startDpq,type:e.type}},h=function(a){return this.scoreData.getCommonContent().getTempoChanges(a)},i=function(b,c){var d=a.getTimePos(b),e=a.getType(b);return{measureIdx:c,timePos:d,dpq:a.getDpq(b),type:e}},j=function(b,c){return{measureIdx:c,timePos:a.getTimePos(b),dpq:a.getDpq(b)}},k=function(){return this.scoreData.getCommonContent().hasRightTempoChange(this.location.stopMeasureIdx)},l=function(){var a=this.scoreData.getCommonContent(),c=0,d=1,e=b(a,this.location.stopMeasureIdx+1,c,d);return{measureIdx:e.stopMeasureIdx,timePos:e.stopTimePos,dpq:e.stopDpq}},m=function(a,b){var e={startMeasureIdx:a.measureIdx,startTimePos:a.timePos,startDpq:a.dpq,stopMeasureIdx:b.measureIdx,stopTimePos:b.timePos,stopDpq:b.dpq,type:a.type},f=this.location.partIdx,g=1;e.startVoiceIdx=this.getVoiceIdx(a.measureIdx);var h=this.getVoice(a.measureIdx);e.startNoteIdx=c(h,g,a.timePos),e.startIdxInStaff=this.scoreData.voiceIdxToIdxInMainStaff(f,e.startVoiceIdx),e.stopVoiceIdx=this.getVoiceIdx(b.measureIdx);var i=this.getVoice(b.measureIdx);return e.stopNoteIdx=d(i,g,b.timePos),e.stopIdxInStaff=this.scoreData.voiceIdxToIdxInMainStaff(f,e.stopVoiceIdx),e}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.measureUtils,c=Adagio.Utils.noteUtils,d=Adagio.edit.common.fetchSlurStart,e=Adagio.edit.common.fetchSlurStop,f=Adagio.getter.MeasuresRangesAbstractGetter;Adagio.getter.getMeasuresRangeSlurs=function(a,b){var c={hasLeftContinue:g,searchLeftStart:h,getEntities:i,createStart:l,createStop:m,hasRightContinue:n,searchRightStop:o,createEntry:p,isEntityStart:j,isEntityStop:k},d=new f(a,b,c);return d.checkPreconditions(),d.get()};var g=function(){var a=this.getMeasure(this.location.startMeasureIdx);return b.hasLeftSlur(a,this.location.voiceIdx)},h=function(){var b=this.getMeasuresScroller(),c={measureIdx:this.location.startMeasureIdx,noteIdx:0,voiceIdx:this.location.voiceIdx},e=d(b,c);if(null===e)throw new a("Unexpected","There should be a slur start.");return{measureIdx:e.measureIdx,noteIdx:e.noteIdx}},i=function(a){var b=this.getMeasureData(a);if(!b.hasVoice(this.location.voiceIdx))return[];for(var d=[],e=b.getVoice(this.location.voiceIdx),f=e.getNbNotes(),g=0;g<f;g++){var h=e.getNote(g);c.hasSlurStart(h)?d.push({start:!0,noteIdx:g}):c.hasSlurStop(h)&&d.push({stop:!0,noteIdx:g})}return d},j=function(a){return!0===a.start},k=function(a){return!0===a.stop},l=function(a,b){return{measureIdx:b,noteIdx:a.noteIdx}},m=function(a,b){return{measureIdx:b,noteIdx:a.noteIdx}},n=function(){var a=this.getMeasure(this.location.stopMeasureIdx);return b.hasRightSlur(a,this.location.voiceIdx)},o=function(){var b=this.getMeasuresScroller(),c={measureIdx:this.location.stopMeasureIdx+1,noteIdx:0,voiceIdx:this.location.voiceIdx},d=e(b,c);if(null===d)throw new a("Unexpected","There should be a slur start.");return{measureIdx:d.measureIdx,noteIdx:d.noteIdx}},p=function(a,c){var d=this.location.voiceIdx,e=this.location.partIdx,f={startMeasureIdx:a.measureIdx,startNoteIdx:a.noteIdx,startVoiceIdx:d,stopMeasureIdx:c.measureIdx,stopNoteIdx:c.noteIdx,stopVoiceIdx:d},g=this.getMeasure(a.measureIdx);f.startDpq=b.getDpq(g);var h=this.getVoice(a.measureIdx);f.startTimePos=h.getRangeSpace(0,a.noteIdx),f.startIdxInStaff=this.scoreData.voiceIdxToIdxInMainStaff(e,f.startVoiceIdx);var i=this.getMeasure(c.measureIdx);f.stopDpq=b.getDpq(i);var j=this.getVoice(c.measureIdx);return f.stopTimePos=j.getRangeSpace(0,c.noteIdx),f.stopIdxInStaff=f.startIdxInStaff,f}}.call(this),function(){"use strict";var a=Adagio.getter.getNote,b=Adagio.getter.getNotesRange,c=Adagio.getter.getNotesRangeCrossMeasure,d=Adagio.getter.getVoiceData,e=Adagio.getter.getStaffMeasure,f=Adagio.getter.hasDynamic,g=Adagio.getter.getPartData,h=Adagio.getter.getWedgeData,i=Adagio.getter.getHarmony,j=Adagio.getter.getPizzicato,k=Adagio.getter.getDynamic,l=Adagio.getter.getWord,m=Adagio.getter.getSlurData,n=Adagio.getter.getGrace,o=Adagio.getter.getNoteIdxForAbsoluteGraceIdx,p=Adagio.getter.getSlurPossibleRightSide,q=Adagio.getter.getStaffVoicesData,r=Adagio.getter.getPedalData,s=Adagio.getter.getPreviousRootPitch,t=Adagio.getter.getOctaveShiftData,u=Adagio.getter.getTempoChangeData,v=Adagio.getter.getStaffContentCrossMeasure,w=Adagio.getter.getPartVoiceNbNotes,x=Adagio.getter.hasMeasureVoice,y=Adagio.getter.getMeasureStaffNbDisplayedVoices,z=Adagio.getter.getMeasureVoiceIdxAtDisplayedIdxInStaff,A=Adagio.getter.refToNoteIdx,B=Adagio.getter.compareNotesTimePos,C=Adagio.getter.getClosestLeftNote,D=Adagio.getter.getClosestRightNote,E=Adagio.getter.getMeasuresRangeOctaveShifts,F=Adagio.getter.getMeasuresRangeWedges,G=Adagio.getter.getMeasuresRangeTempoChanges,H=Adagio.getter.getMeasuresRangeSlurs,I=Adagio.Data,J=I.prototype;J.getNoteData=function(b){return a(this,b)},J.getGraceData=function(a){return n(this,a)},J.getStaffData=function(a){return this.getVoiceData(a)},J.getVoiceData=function(a){return d(this,a)},J.getStaffVoicesData=function(a){return q(this,a)},J.getNotesRange=function(a){return b(this,a)},J.getNotesRangeCrossMeasure=function(a){return c(this,a)},J.getStaffContentCrossMeasure=function(a){return v(this,a)},J.getStaffMeasure=function(a){return e(this,a)},J.hasDynamic=function(a){return f(this,a)},J.getPartData=function(a){return g(this,a)},J.getWedgeData=function(a){return h(this,a)},J.getPedalData=function(a){return r(this,a)},J.getOctaveShiftData=function(a){return t(this,a)},J.getTempoChangeData=function(a){return u(this,a)},J.getSlurData=function(a){return m(this,a)},J.getHarmonyData=function(a){return i(this,a)},J.getPizzicatoData=function(a){return j(this,a)},J.getDynamicData=function(a){return k(this,a)},J.getWordData=function(a){return l(this,a)},J.getNoteIdxForAbsoluteGraceIdx=function(a){return o(this,a)},J.getSlurPossibleRightSide=function(a){return p(this,a)},J.getPreviousRootPitch=function(a){return s(this,a)},J.getPartVoiceNbNotes=function(a){return w(this,a)},J.hasMeasureVoice=function(a){return x(this,a)},J.getMeasureStaffNbDisplayedVoices=function(a){return y(this,a)},J.getMeasureVoiceIdxAtDisplayedIdxInStaff=function(a){return z(this,a)},J.refToNoteIdx=function(a){return A(this,a)},J.compareNotesTimePos=function(a,b){return B(this,a,b)},J.getClosestLeftNote=function(a){return C(this,a)},J.getClosestRightNote=function(a){return D(this,a)},J.getMeasuresRangeOctaveShiftsData=function(a){return E(this,a)},J.getMeasuresRangeWedgesData=function(a){return F(this,a)},J.getMeasuresRangeTempoChangesData=function(a){return G(this,a)},J.getMeasuresRangeSlursData=function(a){return H(this,a)}}.call(this),function(){"use strict";var a=Adagio.Utils.partHeaderUtils,b=Adagio.Utils.typeUtils,c=Adagio.Values.MIDIValues,d=Adagio.Utils.partHeadersUtils={};d.updateMIDIChannels=function(a){var e=c.getPitchedChannelsMap(),f=d.getUsedMIDIChannels(a);e=b.filterObjectBlackMap(e,f),d.fillMIDIChannels(a,e)},d.getUsedMIDIChannels=function(c){return c.map(a.getUsedMIDIChannels).reduce(b.fillObject,{})},d.fillMIDIChannels=function(a,b){a.forEach(e,b)};var e=function(b){var c=this;a.fillMIDIChannels(b,c)}}.call(this),function(){"use strict";var a=Adagio.Utils.partHeaderUtils,b=Adagio.Utils.partContentUtils,c=Adagio.Utils.typeUtils,d=Adagio.Utils.uuidUtils,e=Adagio.Utils.partUtils={};e.checkOrGenerateUuid=function(c,e){if(a.hasUuid(c)&&b.hasUuid(e)){var f=a.getUuid(c),g=b.getUuid(e);d.isValid(f)&&d.isValid(g)?f!==g&&(a.setUuid(c,f),b.setUuid(e,f)):this.generateUuid(c,e)}else this.generateUuid(c,e)},e.generateUuid=function(c,e){var f=d.generate();a.setUuid(c,f),b.setUuid(e,f)},e.updateIdFromIdx=function(c,d,e){var g=f(e);a.setId(c,g),b.setId(d,g)};var f=function(a){return"P"+(a+1)};e.updateInstrumentsIds=function(d,e){var f=a.updateInstrumentsIds(d);c.isObjectEmpty(f)||b.updateInstrumentsIds(e,f)}}.call(this),function(){"use strict";var a=Adagio.Utils.partHeadersUtils,b=Adagio.Utils.partHeaderUtils,c=Adagio.Utils.partContentUtils,d=Adagio.Utils.partUtils,e=Adagio.Data.prototype;e.insertPart=function(a,b,c){var d=this.getPartsHeaders(),e=this.getPartsContents();d.splice(c,0,a),e.splice(c,0,b),g(d,e,c),f(d,e,c+1),this.updateMIDIChannels()},e.removePart=function(a){var b=this.getPartsHeaders(),c=this.getPartsContents();b.splice(a,1),c.splice(a,1),f(b,c,a),this.updateMIDIChannels()},e.movePart=function(a,b){var c=this.getPartsHeaders(),d=this.getPartsContents(),e=c.splice(a,1)[0],g=d.splice(a,1)[0];b>a&&b--,c.splice(b,0,e),d.splice(b,0,g);var h=Math.min(b,a);f(c,d,h),this.updateMIDIChannels()},e.setPartUuid=function(a,d,e){b.setUuid(a,e),c.setUuid(d,e)};var f=function(a,b,c){for(var e=c;e<a.length;e++){var f=a[e],g=b[e];d.updateIdFromIdx(f,g,e),d.checkOrGenerateUuid(f,g),d.updateInstrumentsIds(f,g)}},g=function(a,c,e){var f=a[e],g=c[e];d.updateIdFromIdx(f,g,e),d.checkOrGenerateUuid(f,g),b.initInstrumentsIds(f)};e.updateMIDIChannels=function(){var b=this.getPartsHeaders();a.updateMIDIChannels(b)}}.call(this),function(){"use strict";var a=Adagio.Utils.uuidUtils,b=Adagio.Utils.measureHeaderUtils,c=Adagio.Utils.measuresHeadersUtils={};c.checkOrGenerateHeaders=function(c,d){if(d<this.getNbHeaders(c)){var e=this.getHeader(c,d);b.hasUuid(e)&&a.isValid(b.getUuid(e))||this.setUuid(c,d,a.generate())}else this.generateNewHeader(c,d)},c.generateNewHeader=function(c,d){var e=b.create(a.generate());this.addHeader(c,e,d)},c.isEmpty=function(a){return 0===a.length},c.addHeader=function(a,b,c){a.splice(c,0,b)},c.removeHeader=function(a,b){a.splice(b,1)},c.getHeader=function(a,b){return a[b]},c.setUuid=function(a,c,d){var e=this.getHeader(a,c);b.setUuid(e,d)},c.getUuid=function(a,c){var d=this.getHeader(a,c)
;return b.getUuid(d)},c.getNbHeaders=function(a){return a.length},c.hasUuid=function(a,c){return a.some(function(a){return b.getUuid(a)===c})}}.call(this),function(){"use strict";var a=Adagio.Utils.measuresHeadersUtils,b=Adagio.Data.prototype;b.insertMeasureHeader=function(b,d){var e=this.getMeasuresHeaders();a.addHeader(e,b,d),c(e,d)},b.removeMeasureHeader=function(b){var c=this.getMeasuresHeaders();a.removeHeader(c,b)},b.hasMeasureIdxByUuid=function(b){var c=this.getMeasuresHeaders();return a.hasUuid(c,b)};var c=function(b,c){a.checkOrGenerateHeaders(b,c)}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadNbMeasuresError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadNbMeasuresError",this.stack=e.stack,this.message=e.message,this.nbMeasures=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"The number of measures ["+a+"] is invalid. It has to be a positive non null integer"}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Error.value.BadNbMeasuresError,c=Adagio.Error.client.BadMeasureIdxError,d=Adagio.Utils.clone,e=Adagio.Utils.math,f=Adagio.Utils.timeUtils,g=Adagio.Utils.keyUtils,h=Adagio.Utils.measureUtils,i=Adagio.Utils.soundUtils,j=Adagio.Utils.partContentUtils,k=Adagio.Utils.swingUtils,l=Adagio.Utils.tempoUtils,m=Adagio.Data.prototype;m.settedTime=null,m.settedNbMeasures=null,m.settedTempo=l.createDefault(),m.settedSwing=k.createDefault(),m.setTempo=function(a){this.setQpm(a)},m.setQpm=function(a){i.checkTempo(a);var b=l.createWithDefaultDisplay(a);this.setRealTempo(b)},m.setRealTempo=function(a){this.settedTempo=a},m.setTime=function(a){f.check(a),this.settedTime=d(a)},m.setNbMeasures=function(a){n(a),this.settedNbMeasures=a};var n=function(a){if(!o(a))throw new b(a)},o=function(a){return e.isInteger(a)&&a>0};m.getTempo=function(a){return this.getQpm(a)},m.getQpm=function(a){var b=this.getRealTempo(a);return l.getQpm(b)},m.getRealTempo=function(a){return this.hasContent()?this.getTempoFromContent(a):this.getSettedTempo(a)},m.getTempoFromContent=function(a){return this.getCommonContent().getTempo(a)},m.getSettedTempo=function(a){return this.checkSettedTempo(a),this.settedTempo},m.checkSettedTempo=function(b){if(!this.hasSettedTempo()){throw new a("MissingValue","the tempo is not setted for the score")}var c=this.getNbMeasures();p(b,c)},m.hasTempo=function(){return this.hasContent()||this.hasSettedTempo()},m.hasSettedTempo=function(){return null!==this.settedTempo},m.getSwing=function(a){return this.hasContent()?this.getSwingFromContent(a):this.getSettedSwing(a)},m.getSwingFromContent=function(a){return this.getCommonContent().getSwing(a)},m.getSettedSwing=function(a){return this.checkSettedSwing(a),this.settedSwing},m.checkSettedSwing=function(b){if(!this.hasSettedSwing()){throw new a("MissingValue","the swing is not setted for the score")}var c=this.getNbMeasures();p(b,c)},m.hasSwing=function(){return this.hasContent()||this.hasSettedSwing()},m.hasSettedSwing=function(){return null!==this.settedSwing},m.getTime=function(a){return this.hasContent()?this.getTimeFromContent(a):this.getSettedTime(a)},m.getTimeFromContent=function(a){var b=this.getPartMeasures(0),c=b.length;p(a,c);var d=b[a];return h.getWrappedTime(d).getAnyEntry()},m.getSettedTime=function(a){return this.checkSettedTime(a),this.settedTime},m.checkSettedTime=function(b){if(!this.hasSettedTime()){throw new a("MissingValue","the time signature is not setted for the score")}var c=this.getNbMeasures();p(b,c)};var p=function(a,b){if("number"!=typeof a||a<0||a>=b)throw new c(a,c.GET)};m.hasTime=function(){return this.hasContent()||this.hasSettedTime()},m.hasSettedTime=function(){return null!==this.settedTime},m.getNbMeasures=function(){return this.hasContent()?this.getNbMeasuresFromContent():this.getSettedNbMeasures()},m.getNbMeasuresFromContent=function(){var a=this.getPartContent(0);return j.getNbMeasures(a)},m.getSettedNbMeasures=function(){return this.checkHasSettedNbMeasures(),this.settedNbMeasures},m.checkHasSettedNbMeasures=function(){if(!this.hasSettedNbMeasures()){throw new a("MissingValue","the measure number is not setted for the score")}},m.hasNbMeasures=function(){return this.hasContent()||this.hasSettedNbMeasures()},m.hasSettedNbMeasures=function(){return null!==this.settedNbMeasures},m.getConcertKey=function(){if(this.hasContent()){var b=this.getMeasure(0,0),c=h.getWrappedKey(b).getAnyEntry(),d=h.getWrappedTranspose(b).getAnyEntry();return g.transpose(c,d)}throw new a("MissingValue","There must be at least one part to retrieve the concert key")},m.hasContent=function(){return this.getNbParts()>0}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadMillimetersScalingError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadMillimetersScalingError",this.stack=e.stack,this.message=e.message,this.millimeters=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"millimeters scaling value ["+a+"] is invalid. It has to be a number strictly positive. "}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadTenthsScalingError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadTenthsScalingError",this.stack=e.stack,this.message=e.message,this.tenths=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"tenths scaling value ["+a+"] is invalid. It has to be a number strictly positive. "}}.call(this),function(){"use strict";var a=Adagio.Error.value.BadMillimetersScalingError,b=Adagio.Error.value.BadTenthsScalingError,c=Adagio.Utils.scalingUtils={};c.create=function(a,b){c.check(a,b);var d={};return c.set(d,a,b),d},c.set=function(a,b,d){c.check(b,d),a.millimeters=b.toString(),a.tenths=d.toString()},c.isComplete=function(a){var b=c.getMillimeters(a),d=c.getTenths(a);return c.isValidMillimeters(b)&&c.isValidTenths(d)},c.check=function(a,b){c.checkMillimeters(a),c.checkTenths(b)},c.checkMillimeters=function(b){if(!c.isValidMillimeters(b))throw new a(b)},c.isValidMillimeters=function(a){return d(a)},c.checkTenths=function(a){if(!c.isValidTenths(a))throw new b(a)},c.isValidTenths=function(a){return d(a)};var d=function(a){return!isNaN(a)&&a>0};c.getMillimeters=function(a){return parseFloat(a.millimeters)},c.getTenths=function(a){return parseFloat(a.tenths)},c.toMillimeters=function(a,b){return b*c.getMillimeters(a)/c.getTenths(a)},c.toTenths=function(a,b){var d=c.getMillimeters(a);return b*c.getTenths(a)/d}}.call(this),function(){"use strict";var a=Adagio.Utils.clone,b=Adagio.Error.client.ClientError,c=Adagio.Utils.pageMarginUtils={};c.TYPE_ODD="odd",c.TYPE_EVEN="even",c.TYPE_BOTH="both",c.DEFAULT_TYPE=c.TYPE_BOTH,c.DEFAULT_TOP=0,c.DEFAULT_BOTTOM=0,c.DEFAULT_LEFT=0,c.DEFAULT_RIGHT=0;var d=[c.TYPE_ODD,c.TYPE_EVEN,c.TYPE_BOTH];c.checkType=function(a){if(!d.includes(a)){throw new b("The margin type ["+a+"] is invalid.","BadMarginType")}},c.getType=function(a){return c.hasType(a)?a.$type:c.DEFAULT_TYPE},c.typeOrDefault=function(a){return void 0!==a?a:c.DEFAULT_TYPE},c.hasType=function(a){return void 0!==a.$type},c.setType=function(a,b){a.$type=b},c.isBoth=function(a){return c.getType(a)===c.TYPE_BOTH},c.isEven=function(a){return c.getType(a)===c.TYPE_EVEN},c.isOdd=function(a){return c.getType(a)===c.TYPE_ODD},c.getLeft=function(a){return c.hasLeft(a)?parseFloat(a["left-margin"]):c.DEFAULT_LEFT},c.hasLeft=function(a){return void 0!==a["left-margin"]},c.setLeft=function(a,b){a["left-margin"]=b.toString()},c.getRight=function(a){return c.hasRight(a)?parseFloat(a["right-margin"]):c.DEFAULT_RIGHT},c.hasRight=function(a){return void 0!==a["right-margin"]},c.setRight=function(a,b){a["right-margin"]=b.toString()},c.getTop=function(a){return c.hasTop(a)?parseFloat(a["top-margin"]):c.DEFAULT_TOP},c.hasTop=function(a){return void 0!==a["top-margin"]},c.setTop=function(a,b){a["top-margin"]=b.toString()},c.getBottom=function(a){return c.hasBottom(a)?parseFloat(a["bottom-margin"]):c.DEFAULT_BOTTOM},c.hasBottom=function(a){return void 0!==a["bottom-margin"]},c.setBottom=function(a,b){a["bottom-margin"]=b.toString()},c.copy=function(b){return a(b)},c.createDefaultMargin=function(){return{}}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.pageMarginUtils,c=Adagio.Utils.pageMarginsUtils={};c.isUnified=function(a){if(c.isEmpty(a))return!1;var d=a[0];return b.isBoth(d)},c.isEmpty=function(a){return 0===a.length},c.hasEven=function(a){return!!c.isUnified(a)||a.some(b.isEven)},c.getEven=function(a){return c.isUnified(a)?c.getBoth(a):a.find(b.isEven)},c.hasOdd=function(a){return!!c.isUnified(a)||a.some(b.isOdd)},c.getOdd=function(a){return c.isUnified(a)?c.getBoth(a):a.find(b.isOdd)},c.getBoth=function(a){return a[0]},c.setTop=function(d,e,f){if((f=b.typeOrDefault(f))===b.TYPE_BOTH)c.setBothTop(d,e);else if(f===b.TYPE_EVEN)c.setEvenTop(d,e);else{if(f!==b.TYPE_ODD){var g="invalid margin type: ["+f+"].";throw new a("BadMarginType",g)}c.setOddTop(d,e)}},c.setBottom=function(d,e,f){if((f=b.typeOrDefault(f))===b.TYPE_BOTH)c.setBothBottom(d,e);else if(f===b.TYPE_EVEN)c.setEvenBottom(d,e);else{if(f!==b.TYPE_ODD){var g="invalid margin type: ["+f+"].";throw new a("BadMarginType",g)}c.setOddBottom(d,e)}},c.setLeft=function(d,e,f){if((f=b.typeOrDefault(f))===b.TYPE_BOTH)c.setBothLeft(d,e);else if(f===b.TYPE_EVEN)c.setEvenLeft(d,e);else{if(f!==b.TYPE_ODD){var g="invalid margin type: ["+f+"].";throw new a("BadMarginType",g)}c.setOddLeft(d,e)}},c.setRight=function(d,e,f){if((f=b.typeOrDefault(f))===b.TYPE_BOTH)c.setBothRight(d,e);else if(f===b.TYPE_EVEN)c.setEvenRight(d,e);else{if(f!==b.TYPE_ODD){var g="invalid margin type: ["+f+"].";throw new a("BadMarginType",g)}c.setOddRight(d,e)}},c.setBothTop=function(a,d){c.setBothProp(a,d,b.setTop)},c.setBothBottom=function(a,d){c.setBothProp(a,d,b.setBottom)},c.setBothLeft=function(a,d){c.setBothProp(a,d,b.setLeft)},c.setBothRight=function(a,d){c.setBothProp(a,d,b.setRight)},c.setBothProp=function(a,b,d){c.isEmpty(a)?c.createBoth(a):c.isUnified(a)||c.merge(a),d(c.getBoth(a),b)},c.setEvenTop=function(a,d){c.setEvenProp(a,d,b.setTop)},c.setEvenBottom=function(a,d){c.setEvenProp(a,d,b.setBottom)},c.setEvenLeft=function(a,d){c.setEvenProp(a,d,b.setLeft)},c.setEvenRight=function(a,d){c.setEvenProp(a,d,b.setRight)},c.setEvenProp=function(a,b,d){d(c.getOrCreateSide(a,c.createEven,c.getEven),b)},c.setOddTop=function(a,d){c.setOddProp(a,d,b.setTop)},c.setOddBottom=function(a,d){c.setOddProp(a,d,b.setBottom)},c.setOddLeft=function(a,d){c.setOddProp(a,d,b.setLeft)},c.setOddRight=function(a,d){c.setOddProp(a,d,b.setRight)},c.setOddProp=function(a,b,d){d(c.getOrCreateSide(a,c.createOdd,c.getOdd),b)},c.getOrCreateSide=function(a,b,d){return c.isEmpty(a)?b(a):c.isUnified(a)&&c.split(a),d(a)},c.split=function(a){var c=a[0],d=b.copy(c);a.push(d),b.setType(c,b.TYPE_ODD),b.setType(d,b.TYPE_EVEN)},c.merge=function(a){var c=a[0],d=2===a.length,e=a[1];if(!b.hasTop(c)&&d&&b.hasTop(e)){var f=b.getTop(e);b.setTop(c,f)}if(!b.hasBottom(c)&&d&&b.hasBottom(e)){var g=b.getBottom(e);b.setBottom(c,g)}if(!b.hasLeft(c)&&d&&b.hasLeft(e)){var h=b.getLeft(e);b.setLeft(c,h)}if(!b.hasRight(c)&&d&&b.hasRight(e)){var i=b.getRight(e);b.setRight(c,i)}b.setType(c,b.TYPE_BOTH),d&&a.pop()},c.createOdd=function(a){var c={};b.setType(c,b.TYPE_ODD),a.push(c)},c.createEven=function(a){var c={};b.setType(c,b.TYPE_EVEN),a.push(c)},c.createBoth=function(a){var c={};b.setType(c,b.TYPE_BOTH),a.push(c)}}.call(this),function(){"use strict";var a=Adagio.Utils.typeUtils,b=Adagio.Utils.pageMarginsUtils,c=Adagio.Utils.pageMarginUtils,d=Adagio.Utils.pageLayoutUtils={};d.hasPageSize=function(a){return d.hasPageHeight(a)&&d.hasPageWidth(a)},d.hasPageHeight=function(a){return void 0!==a["page-height"]},d.hasPageWidth=function(a){return void 0!==a["page-width"]},d.getHeight=function(a){return parseFloat(a["page-height"])},d.getWidth=function(a){return parseFloat(a["page-width"])},d.setPageSize=function(a,b,c){d.setPageWidth(a,b),d.setPageHeight(a,c)},d.setPageHeight=function(a,b){a["page-height"]=b.toString()},d.setPageWidth=function(a,b){a["page-width"]=b.toString()},d.getMargins=function(b){return a.isArray(b["page-margins"])?b["page-margins"]:void 0!==b["page-margins"]?[b["page-margins"]]:[]},d.setMargins=function(a,b){b.length>1?a["page-margins"]=b:1===b.length?a["page-margins"]=b[0]:delete a["page-margins"]},d.setTopMargin=function(a,c,e){var f=d.getMargins(a);b.setTop(f,c,e),d.setMargins(a,f)},d.setBottomMargin=function(a,c,e){var f=d.getMargins(a);b.setBottom(f,c,e),d.setMargins(a,f)},d.setLeftMargin=function(a,c,e){var f=d.getMargins(a);b.setLeft(f,c,e),d.setMargins(a,f)},d.setRightMargin=function(a,c,e){var f=d.getMargins(a);b.setRight(f,c,e),d.setMargins(a,f)},d.hasMargins=function(a){return void 0!==a["page-margins"]},d.getMarginsForEvenOrDefault=function(a){return d.hasMarginsForEven(a)?d.getMarginsForEven(a):[c.createDefaultMargin()]},d.getMarginsForEven=function(a){var c=d.getMargins(a);return b.getEven(c)},d.hasMarginsForEven=function(a){var c=d.getMargins(a);return b.hasEven(c)},d.getMarginsForOddOrDefault=function(a){return d.hasMarginsForOdd(a)?d.getMarginsForOdd(a):[c.createDefaultMargin()]},d.getMarginsForOdd=function(a){var c=d.getMargins(a);return b.getOdd(c)},d.hasMarginsForOdd=function(a){var c=d.getMargins(a);return b.hasOdd(c)}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadMaxNbMeasuresPerLineError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadMaxNbMeasuresPerLineError",this.stack=e.stack,this.message=e.message,this.maxNbMeasuresPerLine=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"The max number of measures per lines value ["+a+"<"+typeof a+">] is invalid."}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadNbMeasuresPerLineForbiddenCountError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadNbMeasuresPerLineForbiddenCountError",this.stack=e.stack,this.message=e.message,this.forbiddenCount=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"The forbidden measures count value ["+a+"<"+typeof a+">] is invalid."}}.call(this),function(){"use strict";var a=Adagio.Error.value.BadMaxNbMeasuresPerLineError,b=Adagio.Error.value.BadNbMeasuresPerLineForbiddenCountError,c=Adagio.Utils.math,d=Adagio.Utils.setUtils,e={},f=Adagio.Utils.systemBreakPolicyUtils={};f.createDefault=function(){var a={};return f.fillDefault(a),a},f.fillDefault=function(a){void 0===a.maxNbMeasuresPerLine&&(a.maxNbMeasuresPerLine=4),void 0===a.forbiddenCounts&&(a.forbiddenCounts=d.copy(e))},f.check=function(a){f.checkMaxNbMeasuresPerLine(a.maxNbMeasuresPerLine),f.checkForbiddenCounts(a.forbiddenCounts)},f.checkMaxNbMeasuresPerLine=function(b){if(!f.isValidMeasureCount(b))throw new a(b)},f.checkForbiddenCounts=function(a){a=d.toList(a),a=a.map(c.intPart),a.forEach(f.checkForbiddenCount)},f.checkForbiddenCount=function(a){if(!f.isValidMeasureForbiddenCount(a))throw new b(a)},f.isValidMeasureCount=function(a){return null===a||c.isInteger(a)&&a>=1},f.isValidMeasureForbiddenCount=function(a){return c.isInteger(a)&&a>=2},f.copy=function(a){var b={};return b.maxNbMeasuresPerLine=a.maxNbMeasuresPerLine,b.forbiddenCounts=d.copy(a.forbiddenCounts),b},f.isSame=function(a,b){return a.maxNbMeasuresPerLine===b.maxNbMeasuresPerLine&&d.isSame(a.forbiddenCounts,b.forbiddenCounts)},f.createNoLimitConfig=function(){return{maxNbMeasuresPerLine:null,forbiddenCounts:{}}}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadMeasureNumberingPolicyError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadMeasureNumberingPolicyError",this.stack=e.stack,this.message=e.message,this.policy=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"The measures numbering policy ["+a+"] is invalid."}}.call(this),function(){"use strict";var a=Adagio.Error.value.BadMeasureNumberingPolicyError,b=Adagio.Error.InternalError,c=Adagio.Values.MeasureNumberingPolicy={EVERY:"every",FIRST_OF_SYSTEM:"first-of-system"};c.DEFAULT=c.EVERY,c.values=[c.EVERY,c.FIRST_OF_SYSTEM],c.raiseError=function(a){throw new b("BadMeasureNumberingPolicy","The rehearsal type value: ["+a+"] is invalid")},c.check=function(b){if(!c.isValid(b))throw new a(b)},c.isValid=function(a){return c.values.includes(a)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.scalingUtils,c=Adagio.Utils.pageLayoutUtils,d=Adagio.Utils.pageMarginUtils,e=Adagio.Utils.systemBreakPolicyUtils,f=Adagio.Values.MeasureNumberingPolicy,g=Adagio.Utils.defaultsUtils={},h="$adagio-notesSpacing",i="$adagio-systemBreakPolicy",j="$adagio-measureNumberingPolicy";g.setNotesSpacingCoeff=function(a,b){a[h]=b},g.getNotesSpacingCoeff=function(a){return g.hasNotesSpacingCoeff(a)?a[h]:1.25},g.hasNotesSpacingCoeff=function(a){return void 0!==a[h]},g.setMeasureNumberingPolicy=function(a,b){a[j]=b},g.getMeasureNumberingPolicy=function(a){return g.hasMeasureNumberingPolicy(a)?a[j]:f.DEFAULT},g.hasMeasureNumberingPolicy=function(a){return void 0!==a[j]},g.setSystemBreakPolicy=function(a,b){a[i]=b},g.getSystemBreakPolicy=function(a){return g.hasSystemBreakPolicy(a)?a[i]:e.createDefault()},g.hasSystemBreakPolicy=function(a){return void 0!==a[i]},g.hasScaling=function(a){return void 0!==a.scaling&&b.isComplete(a.scaling)},g.setScaling=function(a,c,d){if(g.hasScaling(a)){var e=g.getScaling(a);b.set(e,c,d)}else a.scaling=b.create(c,d)},g.getScaling=function(a){return a.scaling},g.getMillimetersScaling=function(a){var c=g.getScaling(a);return b.getMillimeters(c)},g.getTenthsScaling=function(a){var c=g.getScaling(a);return b.getTenths(c)},g.scaleToTenths=function(a,c){g.checkHasScaling(a);var d=g.getScaling(a);return b.toTenths(d,c)},g.scaleToMillimeters=function(a,c){g.checkHasScaling(a);var d=g.getScaling(a);return b.toMillimeters(d,c)},g.checkHasScaling=function(b){if(!g.hasScaling(b))throw new a("ScalingMissing","Cannot take parameters as millimeters whithout scaling informations")},g.getOrCreatePageLayout=function(a){return g.hasPageLayout(a)||g.createPageLayout(a),g.getPageLayout(a)},g.createPageLayout=function(a){a["page-layout"]={}},g.hasPageLayout=function(a){return void 0!==a["page-layout"]},g.getPageLayout=function(a){return a["page-layout"]},g.setPageSizeAsMillimeters=function(a,b,d){b=g.scaleToTenths(a,b),d=g.scaleToTenths(a,d);var e=g.getOrCreatePageLayout(a);c.setPageSize(e,b,d)},g.getPageWidthAsMillimeters=function(a){var b=g.getPageWidth(a);return g.scaleToMillimeters(a,b)},g.getPageWidth=function(a){var b=g.getPageLayout(a);return c.getWidth(b)},g.getPageHeightAsMillimeters=function(a){var b=g.getPageHeight(a);return g.scaleToMillimeters(a,b)},g.getPageHeight=function(a){var b=g.getPageLayout(a);return c.getHeight(b)},g.getPageUsableSize=function(b,c){var e;if(c===d.TYPE_EVEN)e=g.getEvenPageMargins(b);else{if(c!==d.TYPE_ODD)throw new a("BadMarginType","The margin type ["+c+"] is invalid.");e=g.getOddPageMargins(b)}var f=g.getPageWidth(b);f-=d.getLeft(e),f-=d.getRight(e);var h=g.getPageHeight(b);return h-=d.getTop(e),h-=d.getBottom(e),{width:f,height:h}},g.hasPageSize=function(a){if(!g.hasPageLayout(a))return!1;var b=g.getPageLayout(a);return c.hasPageSize(b)},g.setPageTopMarginMillimeters=function(a,b,d){b=g.scaleToTenths(a,b);var e=g.getOrCreatePageLayout(a);c.setTopMargin(e,b,d)},g.setPageBottomMarginMillimeters=function(a,b,d){b=g.scaleToTenths(a,b);var e=g.getOrCreatePageLayout(a);c.setBottomMargin(e,b,d)},g.setPageLeftMarginMillimeters=function(a,b,d){b=g.scaleToTenths(a,b);var e=g.getOrCreatePageLayout(a);c.setLeftMargin(e,b,d)},g.setPageRightMarginMillimeters=function(a,b,d){b=g.scaleToTenths(a,b);var e=g.getOrCreatePageLayout(a);c.setRightMargin(e,b,d)},g.getOddPageTopMarginAsMillimeters=function(a){var b=g.getOddPageTopMargin(a);return g.scaleToMillimeters(a,b)},g.getOddPageTopMargin=function(a){var b=g.getOddPageMargins(a);return d.getTop(b)},g.getOddPageBottomMarginAsMillimeters=function(a){var b=g.getOddPageBottomMargin(a);return g.scaleToMillimeters(a,b)},g.getOddPageBottomMargin=function(a){var b=g.getOddPageMargins(a);return d.getBottom(b)},g.getOddPageLeftMarginAsMillimeters=function(a){var b=g.getOddPageLeftMargin(a);return g.scaleToMillimeters(a,b)},g.getOddPageLeftMargin=function(a){var b=g.getOddPageMargins(a);return d.getLeft(b)},g.getOddPageRightMarginAsMillimeters=function(a){var b=g.getOddPageRightMargin(a);return g.scaleToMillimeters(a,b)},g.getOddPageRightMargin=function(a){var b=g.getOddPageMargins(a);return d.getRight(b)},g.getOddPageMargins=function(a){var b=g.getOrCreatePageLayout(a);return c.getMarginsForOddOrDefault(b)},g.getEvenPageTopMarginAsMillimeters=function(a){var b=g.getEvenPageTopMargin(a);return g.scaleToMillimeters(a,b)},g.getEvenPageTopMargin=function(a){var b=g.getEvenPageMargins(a);return d.getTop(b)},g.getEvenPageBottomMarginAsMillimeters=function(a){var b=g.getEvenPageBottomMargin(a);return g.scaleToMillimeters(a,b)},g.getEvenPageBottomMargin=function(a){var b=g.getEvenPageMargins(a);return d.getBottom(b)},g.getEvenPageLeftMarginAsMillimeters=function(a){var b=g.getEvenPageLeftMargin(a);return g.scaleToMillimeters(a,b)},g.getEvenPageLeftMargin=function(a){var b=g.getEvenPageMargins(a);return d.getLeft(b)},g.getEvenPageRightMarginAsMillimeters=function(a){var b=g.getEvenPageRightMargin(a);return g.scaleToMillimeters(a,b)},g.getEvenPageRightMargin=function(a){var b=g.getEvenPageMargins(a);return d.getRight(b)},g.getEvenPageMargins=function(a){var b=g.getOrCreatePageLayout(a);return c.getMarginsForEvenOrDefault(b)}}.call(this),function(){"use strict";var a=Adagio.Utils.defaultsUtils,b=Adagio.Data.prototype;b.getDefaults=function(){var a=this.getScorePartWise();return void 0===a.defaults&&(a.defaults={}),a.defaults},b.getMillimetersScaling=function(){var b=this.getDefaults();return a.getMillimetersScaling(b)},b.getTenthsScaling=function(){var b=this.getDefaults();return a.getTenthsScaling(b)},b.hasScaling=function(){var b=this.getDefaults();return a.hasScaling(b)},b.setScaling=function(b,c){var d=this.getDefaults();a.setScaling(d,b,c)},b.setPageSizeAsMillimeters=function(b,c){var d=this.getDefaults();a.setPageSizeAsMillimeters(d,b,c)},b.getPageWidth=function(){var b=this.getDefaults();return a.getPageWidth(b)},b.getPageWidthAsMillimeters=function(){var b=this.getDefaults();return a.getPageWidthAsMillimeters(b)},b.getPageHeight=function(){var b=this.getDefaults();return a.getPageHeight(b)},b.getPageHeightAsMillimeters=function(){var b=this.getDefaults();return a.getPageHeightAsMillimeters(b)},b.scaleToTenths=function(b){var c=this.getDefaults();return a.scaleToTenths(c,b)},b.scaleToMillimeters=function(b){var c=this.getDefaults();return a.scaleToMillimeters(c,b)},b.getPageUsableSize=function(b){var c=this.getDefaults();return a.getPageUsableSize(c,b)},b.hasPageSize=function(){var b=this.getDefaults();return a.hasPageSize(b)},b.setPageTopMarginMillimeters=function(b,c){var d=this.getDefaults();a.setPageTopMarginMillimeters(d,b,c)},b.setPageBottomMarginMillimeters=function(b,c){var d=this.getDefaults();a.setPageBottomMarginMillimeters(d,b,c)},b.setPageLeftMarginMillimeters=function(b,c){var d=this.getDefaults();a.setPageLeftMarginMillimeters(d,b,c)},b.setPageRightMarginMillimeters=function(b,c){var d=this.getDefaults();a.setPageRightMarginMillimeters(d,b,c)},b.getOddPageMargins=function(){var b=this.getDefaults();return a.getOddPageMargins(b)},b.getOddPageTopMarginAsMillimeters=function(){var b=this.getDefaults();return a.getOddPageTopMarginAsMillimeters(b)},b.getOddPageBottomMarginAsMillimeters=function(){var b=this.getDefaults();return a.getOddPageBottomMarginAsMillimeters(b)},b.getOddPageLeftMarginAsMillimeters=function(){var b=this.getDefaults();return a.getOddPageLeftMarginAsMillimeters(b)},b.getOddPageRightMarginAsMillimeters=function(){var b=this.getDefaults();return a.getOddPageRightMarginAsMillimeters(b)},b.getEvenPageMargins=function(){var b=this.getDefaults();return a.getEvenPageMargins(b)},b.getEvenPageTopMarginAsMillimeters=function(){var b=this.getDefaults();return a.getEvenPageTopMarginAsMillimeters(b)},b.getEvenPageBottomMarginAsMillimeters=function(){var b=this.getDefaults();return a.getEvenPageBottomMarginAsMillimeters(b)},b.getEvenPageLeftMarginAsMillimeters=function(){var b=this.getDefaults();return a.getEvenPageLeftMarginAsMillimeters(b)},b.getEvenPageRightMarginAsMillimeters=function(){var b=this.getDefaults();return a.getEvenPageRightMarginAsMillimeters(b)},b.getNotesSpacingCoeff=function(){var b=this.getDefaults();return a.getNotesSpacingCoeff(b)},b.setNotesSpacingCoeff=function(b){var c=this.getDefaults();return a.setNotesSpacingCoeff(c,b)},b.getMeasureNumberingPolicy=function(){var b=this.getDefaults();return a.getMeasureNumberingPolicy(b)},b.setMeasureNumberingPolicy=function(b){var c=this.getDefaults();return a.setMeasureNumberingPolicy(c,b)},b.getSystemBreakPolicy=function(){var b=this.getDefaults();return a.getSystemBreakPolicy(b)},b.setSystemBreakPolicy=function(b){var c=this.getDefaults();return a.setSystemBreakPolicy(c,b)}}.call(this),function(){"use strict";var a=Adagio.Data.prototype;a["action.setScaling"]=function(a){this.setScaling(a.millimeters,a.tenths)},a["action.setPageSizeAsMillimeters"]=function(a){this.setPageSizeAsMillimeters(a.width,a.height)},a["action.setPageTopMarginMillimeters"]=function(a){this.setPageTopMarginMillimeters(a.top,a.type)},a["action.setPageBottomMarginMillimeters"]=function(a){this.setPageBottomMarginMillimeters(a.bottom,a.type)},a["action.setPageLeftMarginMillimeters"]=function(a){this.setPageLeftMarginMillimeters(a.left,a.type)},a["action.setPageRightMarginMillimeters"]=function(a){this.setPageRightMarginMillimeters(a.right,a.type)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.attributesUtils,c=Adagio.Utils.clefUtils,d="percussion";Adagio.import.renameMeasurePercussionClefs=function(b){a.getAllRawAttributes(b).forEach(e)};var e=function(a){b.getClef(a).forEach(f)},f=function(a){c.getSign(a).toLowerCase()===d&&c.setSign(a,d)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.keyUtils,c=Adagio.Utils.mapUtils,d=7;Adagio.import.convertCustomKey=function(a){if(!b.hasFifths(a)){var d=b.getCustomAlters(a);if(b.removeCustom(a),d=d.filter(e),0===d.length)return void b.setFifths(a,0);var j={};d.forEach(f,j),j=c.toPairs(j);var k=j.reduce(g),l=h(k),m=i(k),n=l*m;b.setFifths(a,n)}};var e=function(a){return 1===a||-1===a},f=function(a){var b=this;void 0===b[a]?b[a]=1:b[a]++},g=function(a,b){return a.value>=b.value?a:b},h=function(b){if("1"===b.key)return 1;if("-1"===b.key)return-1;throw new a("Unexpected")},i=function(a){var b=a.value;return b=Math.min(b,d)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.attributesUtils,c=Adagio.import.convertCustomKey;Adagio.import.convertCustomKeys=function(b){a.getAllRawAttributes(b).forEach(d)};var d=function(a){b.getKey(a).forEach(c)}}.call(this),function(){"use strict";var a=Adagio.Utils.clone,b=Adagio.Utils.measureUtils,c=Adagio.Utils.attributesUtils;Adagio.import.reconstructAttributes=function(b){var c=b[0],f=d(c);b.slice(1).reduce(e,a(f))};var d=function(d){var e=b.getAttributes(d),f=b.getWrappedOwnClef(d),g=a(f.dumpAttribute());c.setClef(e,g);var h=b.getWrappedOwnKey(d),i=a(h.dumpAttribute());c.setKey(e,i);var j=b.getWrappedOwnTransposeOrDefault(d),k=a(j.dumpAttribute());c.setTranspose(e,k);var l=b.getWrappedOwnStaffDetailsOrDefault(d),m=a(l.dumpAttribute());return c.setStaffDetails(e,m),a(e)},e=function(d,e){var f=b.getAttributes(e),g=b.getNbStaves(e),h=b.getOwnAttributes(e),i=c.getWrappedClef(h,g),j=c.getWrappedClef(d);j.replaceWith(i);var k=j.dumpAttribute();c.setClef(f,k);var l=c.getWrappedKey(h,g),m=c.getWrappedKey(d);m.replaceWith(l);var n=m.dumpAttribute();c.setKey(f,n);var o=c.getWrappedTranspose(h,g),p=c.getWrappedTranspose(d);p.replaceWith(o);var q=p.dumpAttribute();c.setTranspose(f,q);var r=c.getWrappedStaffDetails(h,g),s=c.getWrappedStaffDetailsOrDefault(d);s.replaceWith(r);var t=a(s.dumpAttribute());return c.setStaffDetails(f,t),a(f)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.partContentUtils,c=Adagio.Utils.partHeaderUtils;Adagio.import.fixPartsContentsOrder=function(a,b){a.map(c.getId).forEach(function(a,c){d(a,c,b)})};var d=function(c,d,f){if(b.getId(f[d])!==c){var g=f.findIndex(e,c);if(!(g>d))throw new a("unreachable");var h=f.splice(g,1)[0];f.splice(d,0,h)}},e=function(a){var c=this.valueOf();return b.getId(a)===c}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.scoreInstrumentUtils,c=Adagio.Utils.MIDIInstrumentUtils;Adagio.import.fixMIDIInstrumentsOrder=function(a,c){for(var e=a.map(b.getId),f=0,g=e.length,h=c.length,i=0;i<g&&f<h;i++){var j=e[i];f=d(j,f,c)}};var d=function(b,d,f){if(c.getId(f[d])!==b){var g=f.findIndex(e,b);if(g>d){var h=f.splice(g,1)[0];return f.splice(d,0,h),d+1}if(-1===g)return d;throw new a("unreachable")}return d+1},e=function(a){var b=this.valueOf();return c.getId(a)===b}}.call(this),function(){"use strict";var a=Adagio.Utils.partHeaderUtils,b=Adagio.import.fixMIDIInstrumentsOrder;Adagio.import.fixHeadersInstrumentsOrder=function(a){a.forEach(c)};var c=function(c){var d=a.getScoreInstruments(c),e=a.getMIDIInstruments(c);b(d,e)}}.call(this),function(){"use strict";var a=Adagio.Utils.partHeaderUtils,b=Adagio.Utils.MIDIInstrumentUtils;Adagio.import.removeHeaderOrhpanMIDIInstruments=function(b){var d=a.getScoreInstrumentsMap(b),e=a.getMIDIInstruments(b);e=e.filter(c,d),a.setMIDIInstruments(b,e)};var c=function(a){return void 0!==this[b.getId(a)]}}.call(this),function(){"use strict";var a=Adagio.import.removeHeaderOrhpanMIDIInstruments;Adagio.import.removeHeadersOrhpanMIDIInstruments=function(b){b.forEach(a)}}.call(this),function(){"use strict";var a=Adagio.Utils.scoreInstrumentUtils,b=Adagio.Utils.MIDIInstrumentUtils,c=Adagio.import.InstrumentProvider=function(){},d=c.prototype;d.getInstrument=function(a){return a.nbStaves>=2?this.createPiano():this.createViolin()},d.createPiano=function(){var c=a.create("Piano");a.setAbbreviation(c,"Pno.");var d={};return b.setMIDIProgram(d,"1"),{MIDI:d,score:c}},d.createViolin=function(){var c=a.create("Violin");a.setAbbreviation(c,"Vln.");var d={};return b.setMIDIProgram(d,"41"),{MIDI:d,score:c}}}.call(this),function(){"use strict";var a=Adagio.Utils.partHeaderUtils,b=Adagio.Utils.MIDIInstrumentUtils,c=Adagio.Utils.scoreInstrumentUtils,d=Adagio.Utils.clone,e=Adagio.import.InstrumentProvider;Adagio.import.fillHeaderMissingInstruments=function(b,c){a.hasScoreInstruments(b)?g(b,c):f(b,c)};var f=function(e,f){var g=a.getId(e),i=a.getName(e);f=d(f),f.partName=i;var j=h(f),k=j.MIDI,l=j.score;b.initId(k,g,0);var m=b.getId(k);c.setId(l,m),a.setInstrument(e,l,k)},g=function(e,f){var g=a.getScoreInstruments(e),i=a.getMIDIInstruments(e),j=a.getMIDIInstrumentsMap(e);g.forEach(function(a,e){var g=c.getId(a);if(void 0===j[g]){var k=c.getName(a),l=d(f);l.name=k;var m=h(l),n=m.MIDI;b.setId(n,g),i.splice(e,0,n),k=c.getName(m.score),c.setName(a,k);var o=c.getAbbreviation(m.score);c.setAbbreviation(a,o)}}),a.setMIDIInstruments(e,i)},h=function(a){return(new e).getInstrument(a)}}.call(this),function(){"use strict";var a=Adagio.Utils.partContentUtils,b=Adagio.import.fillHeaderMissingInstruments;Adagio.import.fillMissingInstruments=function(c,d){c.forEach(function(c,e){var f=d[e],g=a.getInstrumentContext(f);b(c,g)})}}.call(this),function(){"use strict";var a=Adagio.Utils.partUtils;Adagio.import.setPartsIds=function(b,c){b.forEach(function(b,d){var e=c[d];a.updateIdFromIdx(b,e,d),
a.checkOrGenerateUuid(b,e)})}}.call(this),function(){"use strict";var a=Adagio.Utils.partUtils;Adagio.import.setInstrumentsIds=function(b,c){b.forEach(function(b,d){var e=c[d];a.updateInstrumentsIds(b,e)})}}.call(this),function(){"use strict";var a=Adagio.Utils.mapUtils,b=Adagio.Utils.partHeaderUtils,c=Adagio.Utils.partContentUtils,d=Adagio.Utils.measureUtils,e=Adagio.Utils.noteUtils,f=Adagio.Utils.unpitchedUtils;Adagio.import.inferPitchMappingFromContent=function(a,b){var d=c.getMeasures(a),e={},f={},h={pitchMapping:e,header:b,frequencies:f};d.forEach(g,h);var i=k(f);return n(e,i),e};var g=function(a){d.getNotes(a).forEach(h,this)},h=function(a){if(e.hasUnpitched(a)&&e.hasInstrumentId(a)){var c=e.getInstrumentId(a);if(b.hasInstrumentId(this.header,c)){var d=b.searchInstrumentMIDIUnpitched(this.header,c),f=e.getUnpitched(a),g=e.getHead(a);i(this.pitchMapping,f,g,d),j(this.frequencies,f,g)}}},i=function(a,b,c,d){var e=f.stringify(b);void 0===a[e]&&(a[e]={}),a[e][c]=d},j=function(a,b,c){var d=f.stringify(b);void 0===a[d]&&(a[d]={}),void 0===a[d][c]?a[d][c]=1:a[d][c]++},k=function(a){var b={};for(var c in a){var d=a[c],e=l(d);b[c]=e}return b},l=function(b){var c=a.toPairs(b);return c.sort(m),c[0].key},m=function(a,b){return b.value-a.value},n=function(a,b){for(var c in a){var d=b[c];a[c].default=d}}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.setUtils,c=Adagio.Utils.partHeaderUtils,d=Adagio.Utils.MIDIInstrumentUtils;Adagio.import.addDefaultPitchMapping=function(a,f){var l=k(),m=c.getMIDIInstruments(a),n=m.map(d.getUnpitched),o=b.fromList(n);i(l,o);var p=h(f);j(l,p),g(l,f),e(f,l)};var e=function(a,b){for(var c in b){var d=b[c];for(var e in d)if("default"!==e){var g=d[e];void 0===a[c]&&(a[c]={}),a[c][e]=g}if(void 0!==a[c]){var h=a[c],i=d.default;void 0!==h[i]?h.default=i:void 0===h.default&&(i=f(h),h.default=i)}}},f=function(b){for(var c in b)return c;throw new a("Unexpected, heads should not be empty.")},g=function(a,b){for(var c in a)if(void 0!==b[c]){var d=a[c],e=b[c];for(var f in d)"default"!==f&&void 0!==e[f]&&delete d[f]}},h=function(a){var b={};for(var c in a){var d=a[c];for(var e in d)if("default"!==e){var f=d[e];b[f]=!0}}return b},i=function(a,b){for(var c in a){var d=a[c];for(var e in d)if("default"!==e){var f=d[e];void 0===b[f]&&delete d[e]}}},j=function(a,b){for(var c in a){var d=a[c];for(var e in d)if("default"!==e){var f=d[e];void 0!==b[f]&&delete d[e]}}},k=function(){return{"uD/4":{x:"45",default:"x"},"uF/4":{normal:"36",default:"normal"},"uA/4":{normal:"44",default:"normal"},"uC/5":{normal:"39",x:"38",default:"normal"},"uD/5":{normal:"46",default:"normal"},"uE/5":{normal:"48",x:"47",default:"normal"},"uF/5":{normal:"51",x:"52",diamond:"54",default:"normal"},"uG/5":{x:"43",default:"x"},"uA/5":{x:"50",default:"x"},"uB/5":{x:"56",default:"x"}}}}.call(this),function(){"use strict";var a=Adagio.import.inferPitchMappingFromContent,b=Adagio.import.addDefaultPitchMapping,c=Adagio.Utils.partHeaderUtils;Adagio.import.inferPitchMapping=function(d,e){d.forEach(function(d,f){if(c.hasUnpitched(d)&&!c.hasPitchMapping(d)){var g=e[f],h=a(g,d);b(d,h),c.setPitchMapping(d,h)}})}}.call(this),function(){"use strict";var a=Adagio.Error.import.ImportError=function(a,b){"string"!=typeof b&&(b=a);var c=Error.call(this,b);return this.name=c.name="ImportError",this.stack=c.stack,this.message=c.message,this.code=a,this};a.prototype=Object.create(Error.prototype,{constructor:{value:a}})}.call(this),function(){"use strict";var a=Adagio.Error.import.ImportError,b=Adagio.Utils.mapUtils,c=Adagio.Utils.partHeaderUtils;Adagio.import.removeEmptyPitchMappingParts=function(b,c){for(var e=0;e<b.length;){var f=b[e];d(f)?(b.splice(e,1),c.splice(e,1)):e++}if(0===b.length)throw new a("NoPartRemaining")};var d=function(a){if(c.hasPitchMapping(a)){var d=c.getPitchMapping(a);return b.isEmpty(d)}return!1}}.call(this),function(){"use strict";var a=Adagio.Utils.measuresHeadersUtils;Adagio.import.setMeasureIds=function(b,c){for(var d=0;d<c;d++)a.checkOrGenerateHeaders(b,d)}}.call(this),function(){"use strict";var a=Adagio.Utils.partContentUtils,b=Adagio.Utils.partHeaderUtils,c=Adagio.Utils.typeUtils;Adagio.import.removeOrphanHeaders=function(b,e){var f=c.listToMap(e,a.getId);return b=b.filter(d,f)};var d=function(a){return void 0!==this[b.getId(a)]}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError;Adagio.import.fillEntityTimePosFromMapping=function(b,c,d){var e=d.getNoteBefore(b),f=e+1,g=c[f];if(void 0===g&&(g=c[f-1]),void 0===g){throw new a("","There is no time position mapping for the absolute note index ["+g+"]. ")}if(d.hasOffset(b)){g+=d.getOffsetValue(b)}d.setTimePos(b,g)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.directionUtils,c=Adagio.import.fillEntityTimePosFromMapping;Adagio.import.shiftDirectionsNotesRefs=function(c){if(a.hasDirections(c)){var f=a.getImportMapping(c),g=a.getRawDirections(c);g=g.filter(d,f),g.forEach(e,f),g.sort(b.compareTimePos),a.setDirections(c,g)}};var d=function(a){var c=this,d=b.getNoteBefore(a),e=d+1;return void 0!==c[e]||void 0!==c[e-1]},e=function(a){c(a,this,b)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.clefUtils,c=Adagio.Utils.attributesUtils;Adagio.import.fillMissingClef=function(e){for(var f=a.getWrappedOwnClef(e),g=d(f),h=!1,i=f.getNbStaves(),j=0;j<i;j++)if(!f.hasEntry(j)){h=!0;var k=b.copy(g);f.setEntry(k,j)}if(h){var l=a.getOwnAttributes(e),m=f.dumpAttribute();c.setClef(l,m),a.setOwnAttributes(e,l)}};var d=function(a){for(var c=a.getNbStaves(),d=0;d<c;d++)if(a.hasEntry(d))return a.getEntry(d);return b.create("G")}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.measureUtils,c=Adagio.Utils.noteUtils;Adagio.import.fillChordVoice=function(a){b.getNotes(a).reduce(d,null)};var d=function(b,d){if(c.isChord(d)){if(c.hasVoiceIdx(d))return c.getVoiceIdx(d);if(null!==b)return c.setVoiceIdx(d,b),b;throw new a("Unexpected","Cannot have a chord note without former voice idx indication.")}return c.getVoiceIdx(d)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.directionUtils,c=Adagio.Values.DirectionPlacement;Adagio.import.fillDirectionsPlacement=function(b){a.getRawDirections(b).filter(f).forEach(d)};var d=function(a){var c=e(a);b.setPlacement(a,c)},e=function(a){var d=b.getStaffIdx(a);return 0===d?c.BELOW:1===d?c.ABOVE:c.BELOW},f=function(a){return!b.hasPlacement(a)}}.call(this),function(){"use strict";var a=Adagio.Utils.clone,b=Adagio.Utils.measureUtils,c=Adagio.Utils.attributesUtils;Adagio.import.fillSimpleAttributes=function(b){var c=b[0],f=d(c);b.slice(1).reduce(e,a(f))};var d=function(d){var e={},f=b.getOwnNbStaves(d);c.setNbStaves(e,f);var g=b.getOwnDivisions(d);return c.setDivisions(e,g),b.setAttributes(d,e),a(e)},e=function(d,e){if(b.hasOwnDivisions(e)){var f=b.getOwnDivisions(e);c.setDivisions(d,f)}return b.setAttributes(e,d),a(d)}}.call(this),function(){"use strict";var a=Adagio.Error.import.ImportError,b=Adagio.Values.DurationType,c=Adagio.Utils.measureUtils,d=Adagio.Utils.noteUtils,e=Adagio.Utils.durationUtils,f=Adagio.Utils.timeUtils,g=Adagio.Utils.math,h=[b.QUARTER,b.EIGHT,b.SIXTEENTH,b.THIRTY_SECOND,b.SIXTY_FOURTH];Adagio.import.inferFirstOwnTimeSignature=function(a){var b=i(a);null===b&&(b=k(a)),q(a,b)};var i=function(a){var b={time:null};return a.some(j,b),b.time},j=function(a){if(c.hasOwnTime(a)){var b=c.getAnyOwnTime(a);return this.time=f.copy(b),!0}return!1},k=function(b){var c=b.map(l),d=c.reduce(g.max2);if(0===d){throw new a("InferFirstOwnTimeSignature","Cannot infer a time signature from an empty measure.")}var e=o(d),h=p(d,e);return f.create(h,e)},l=function(a){var b=new m(a);return b.extract(),b.getQuarterDuration()},m=function(a){this.init(a)},n=m.prototype;n.init=function(a){this.maxLength=0,this.timePos=0,this.divisionsPerQuarter=c.getOwnDivisions(a),this.notes=c.getNotes(a)},n.extract=function(){this.searchMeasureSize()},n.searchMeasureSize=function(){this.notes.forEach(this.addNote,this)},n.addNote=function(a){if(!d.isChord(a)&&(this.applyTimeShifts(a),d.hasDuration(a))){var b=d.getDuration(a);this.addDuration(b)}},n.applyTimeShifts=function(a){if(d.hasBackup(a)){var b=d.getBackupDuration(a);this.timePos-=b}if(d.hasForward(a)){var c=d.getForwardDuration(a);this.timePos+=c}this.recordMax()},n.recordMax=function(){this.maxLength=Math.max(this.timePos,this.maxLength)},n.addDuration=function(a){this.timePos+=a,this.recordMax()},n.getQuarterDuration=function(){return this.maxLength/this.divisionsPerQuarter};var o=function(c){for(var d=h.length,f=0;f<d;f++){var i=h[f],j=b.toQuarterDuration(i),k=c/j;if(g.isInteger(k)){return e.quarterToBeatType(j)}}throw new a("InferFirstOwnTimeSignature","Cannot infer a time signature from the total quarter duration ["+c+"].")},p=function(a,b){return a/e.beatTypeToQuarter(b)},q=function(a,b){a.forEach(r,b)},r=function(a){var b=this;b=f.copy(b),c.setOwnTime(a,[b])}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.noteUtils,c=Adagio.Utils.durationUtils;Adagio.import.attributes.countMeasureQuarterDuration=function(b){var e=a.getDpq(b),f=d(b);return c.divisionsToQuarter(f,e)};var d=function(b){var c=a.getNotes(b);return new e(c).getNbDivisions()},e=function(a){this.init(a)},f=e.prototype;f.init=function(a){this.maxLength=0,this.timePos=0,this.notes=a},f.getNbDivisions=function(){return this.searchMeasureSize(),this.maxLength},f.searchMeasureSize=function(){this.notes.forEach(this.addNote,this)},f.addNote=function(a){if(!b.isChord(a)&&(this.applyTimeShifts(a),b.hasDuration(a))){var c=b.getDuration(a);this.addDuration(c)}},f.applyTimeShifts=function(a){if(b.hasBackup(a)){var c=b.getBackupDuration(a);this.timePos-=c}if(b.hasForward(a)){var d=b.getForwardDuration(a);this.timePos+=d}this.recordMax()},f.recordMax=function(){this.maxLength=Math.max(this.timePos,this.maxLength)},f.addDuration=function(a){this.timePos+=a,this.recordMax()}}.call(this),function(){"use strict";var a=Adagio.Utils.durationUtils,b=Adagio.Utils.timeUtils;Adagio.import.attributes.quarterDurationToTimeSignature=function(c,d){if(0===c)return b.copy(d);var e=b.getBeatType(d),f=a.beatTypeToQuarter(e),g=a.extractSmallestBaseDuration(c),h=Math.min(f,g),i=c/h,j=a.quarterToBeatType(h);return b.create(i,j)}}.call(this),function(){"use strict";var a=Adagio.Utils.partContentUtils,b=Adagio.Utils.measureUtils,c=Adagio.Utils.timeUtils,d=Adagio.Utils.math,e=Adagio.import.attributes.countMeasureQuarterDuration,f=Adagio.import.attributes.quarterDurationToTimeSignature;Adagio.import.attributes.inferTimeSignatures=function(a){for(var b=a.getNbMeasures(),c=0;c<b;c++)g(a,c)};var g=function(a,b){var c=h(a,b),d=i(c),e=a.getCommonContent(),g=e.getDisplayedTime(b),k=f(d,g);j(c,k)},h=function(b,c){for(var d=[],e=b.getNbParts(),f=0;f<e;f++){var g=b.getPartContent(f),h=a.getMeasure(g,c);d.push(h)}return d},i=function(a){return a.map(e).reduce(d.max2)},j=function(a,b){a.forEach(k,b)},k=function(a){for(var d=this,e=b.getWrappedTime(a),f=e.getNbStaves(),g=0;g<f;g++){var h=c.copy(d);e.setEntry(h,g)}var i=e.dumpAttribute();b.setTime(a,i)}}.call(this),function(){"use strict";var a=Adagio.Utils.attributeWrapper.NbStaves,b=Adagio.Utils.attributeWrapper.SpecificAttribute,c=Adagio.Utils.attributeWrapper.AttributeWrapper,d=Adagio.Utils.attributeUtils,e=Adagio.Utils.attributesUtils,f=Adagio.Utils.measureUtils,g=Adagio.Utils.clefUtils,h=Adagio.Utils.timeUtils,i=Adagio.Utils.keyUtils,j=Adagio.Utils.transposeUtils,k=Adagio.Utils.staffDetailsUtils;Adagio.import.fixDuplicateAttributes=function(b){var c=f.getNbStaves(b);if(c=new a(c),f.hasOwnAttributes(b)){var d=f.getOwnAttributes(b);if(e.hasClef(d)){var m=e.getClef(d);m=l(m,c,g),e.setClef(d,m)}if(e.hasKey(d)){var n=e.getKey(d);n=l(n,c,i),e.setKey(d,n)}if(e.hasTime(d)){var o=e.getTime(d);o=l(o,c,h),e.setTime(d,o)}if(e.hasTranspose(d)){var p=e.getTranspose(d);p=l(p,c,j),e.setTranspose(d,p)}if(e.hasStaffDetails(d)){var q=e.getStaffDetails(d);q=l(q,c,k),e.setStaffDetails(d,q)}f.setOwnAttributes(b,d)}};var l=function(a,e,f){var g,h=new b(e,f);return a.forEach(function(a){if(d.hasStaffIdx(a))(g=d.getStaffIdx(a))<e.get()&&h.setSpecificEntry(a,g);else for(g=0;g<e.get();g++){var b=f.copy(a);h.setSpecificEntry(b,g)}}),a=h.dumpAttribute(),a=new c(a,e.get(),f).dumpAttribute()}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.keyUtils,c=Adagio.Utils.attributesUtils;Adagio.import.fillMissingKeySignature=function(d){for(var e=!1,f=a.getWrappedOwnKey(d),g=f.getNbStaves(),h=0;h<g;h++)if(!f.hasEntry(h)){e=!0;var i=b.createDefault();f.setEntry(i,h)}if(e){var j=a.getOwnAttributes(d),k=f.dumpAttribute();c.setKey(j,k),a.setOwnAttributes(d,j)}}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils;Adagio.edit.common.optsToLocalGetTimePos=function(a,c){var d=a.dpq;return a.timePos*b(c)/d};var b=function(b){return a.getDpq(b)}}.call(this),function(){"use strict";var a=Adagio.Utils.math,b=Adagio.Utils.measureUtils,c=Adagio.edit.primitive.IncreaseDivisions,d=Adagio.edit.common.optsToLocalGetTimePos,e=Adagio.edit.composite.AdaptDpqToPosition=function(a,b,c){this.init(a,b,c)};e.NAME="composite.AdaptDpqToPosition";var f=e.prototype;f.name=e.NAME,f.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.measure=null},f.perform=function(){this.needAdapt()&&this.adaptDpq()},f.needAdapt=function(){var b=this.getMeasure(),c=d(this.opts,b);return!a.isInteger(c)},f.adaptDpq=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a=this.getCoeff();this.increaseDivisions(a)},f.getCoeff=function(){var c=this.getMeasure(),d=b.getDpq(c),e=this.opts.dpq;return a.lcm(d,e)/d},f.getMeasure=function(){return null===this.measure&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure},f.increaseDivisions=function(a){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,coeff:a};new c(this.scoreData,b,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.import.ImportError,b=Adagio.Utils.noteUtils,c=Adagio.Utils.measureUtils,d=Adagio.Utils.attributesUtils,e=Adagio.Utils.timeUtils,f=Adagio.Utils.durationUtils,g=Adagio.Utils.timeModifUtils,h=Adagio.Utils.math,i=Adagio.edit.common.RestDispatcherLeft,j=Adagio.edit.common.MeasureData,k=Adagio.edit.common.CancelStack,l=Adagio.edit.composite.AdaptDpqToPosition,m="ERR_CHORD_MISSING_FORMER",n="ERR_CHORD_BACKUP",o="ERR_CHORD_FORWARD",p="ERR_CHORD_BADVOICE",q="ERR_TIME_NEGATIVE",r="ERR_NOT_QUARTER",s="ERR_CHORD_GRACE";Adagio.import.fillMeasureVoicesGap=function(a){var b=c.getNotes(a),d=c.getAttributes(a);t(a);var e=c.getNbDivisions(a),f=new u(b),g=f.getVoices(),h=y(g);b=[],h.forEach(function(a){var c=g[a],f=new z(c,d,e);f.organize();var h=f.getNotes();Array.prototype.push.apply(b,h)}),c.setNotes(a,b)};var t=function(a){var b=c.getDpq(a),d=c.getQuarterDuration(a),e=f.quarterDurationToRequiredDpq(d),g=h.lcm(b,e),i={partIdx:null,measureIdx:null,timePos:1,dpq:g},m=new k,n=new j(a),o=new l(n,i,m);o.measure=a,o.perform()},u=function(a){this.init(a)},v=u.prototype;v.init=function(a){this.maxTimePos=0,this.voices={},this.timePos=0,this.currentContainer=null,this.currentChord=null,a.forEach(this.addNote,this),this.currentContainer},v.addNote=function(a){b.isChord(a)?x(a)&&this.addChordNote(a):this.addSingleNote(a)},v.addChordNote=function(c){var d;if(null===this.currentChord)throw d="Cannot have a chord note without note before.",new a(m,d);if(b.hasBackup(c))throw d="a chord note shoud not have backup data.",new a(n,d);if(b.hasForward(c))throw d="a chord note shoud not have forward data.",new a(o,d);if(b.getVoiceIdx(c)!==this.getCurrentChordVoiceIdx())throw d="the chord note belong to a different voice than the current chord.",new a(p,d);if(b.isGraceNote(c)!==this.isCurrentChordGrace())throw d="Cannot mix grace and non grace within the same chord.",new a(s,d);this.currentChord.push(c)},v.isCurrentChordGrace=function(){return b.isGraceNote(this.currentChord[0])},v.getCurrentChordVoiceIdx=function(){return b.getVoiceIdx(this.currentChord[0])},v.addSingleNote=function(b){var c=this.timePos;if((c=w(b,c))<0){throw new a(q,"The time position is negative.")}this.updateTimePos(c),x(b)&&this.addNoteAtPos(b,c)};var w=function(a,c){var d;return b.hasBackup(a)&&(d=b.getBackupDuration(a),c-=d),b.hasForward(a)&&(d=b.getForwardDuration(a),c+=d),c};v.addNoteAtPos=function(a,c){var d=b.getVoiceIdx(a),e=this.getVoice(d),f=[a],g=this.getContainer();b.isGraceNote(a)?(b.setDuration(a,0),g.graces.push(f)):g.note=f,b.isGraceNote(a)||(void 0===e[c]&&(e[c]=g),this.currentContainer=null),this.currentChord=f;var h=b.getDuration(a);this.updateTimePos(c+h)},v.getVoice=function(a){return void 0===this.voices[a]&&(this.voices[a]={}),this.voices[a]},v.updateTimePos=function(a){this.timePos=a,this.maxTimePos=Math.max(a,this.maxTimePos)},v.getContainer=function(){return null===this.currentContainer&&(this.currentContainer={note:null,graces:[]}),this.currentContainer},v.getVoices=function(){return this.voices},v.getMaxTimePos=function(){return this.maxTimePos};var x=function(a){return!!b.isGraceNote(a)||b.getDuration(a)>0},y=function(a){var b=Object.keys(a);return b=b.map(h.intPart),b.sort(h.cmp),b},z=function(a,b,c){this.init(a,b,c)},A=z.prototype;A.init=function(a,b,c){this.timePos=0,this.maxTimePos=c,this.voice=a,this.attributes=b,this.timePerBeat=null,this.list=null},A.organize=function(){var a=B(this.voice);this.fillGaps(a),G(a),this.list=a};var B=function(a){var b=[];for(var c in a){var d=a[c];c=parseInt(c,10);var e={timePos:c,container:d};b.push(e)}return b.sort(C),b},C=function(a,b){return a.timePos-b.timePos};A.fillGaps=function(a){for(var c=0,d=0;d<a.length;){var e=a[d];if(e.timePos<c)a.splice(d,1);else{if(e.timePos>c){var f=e.timePos-c,g=this.createRests(c,e,f),h=[d,0].concat(g);Array.prototype.splice.apply(a,h),d+=g.length}c=e.timePos+b.getDuration(e.container.note[0]),d++}}c<this.maxTimePos&&this.addFinalNotes(a,c)},A.addFinalNotes=function(a,b){var c=a.length-1,d=a[c],e=this.maxTimePos-b,f=this.createRests(b,d,e);Array.prototype.push.apply(a,f)},A.createRests=function(b,c,d){var e=this.getDivisionsPerQuarter(),h=f.divisionsToQuarter(d,e);if(!f.isValidQuarter(h)){throw new a(r,"Cannot fill gap with a duration that is not aligned to a possible quarter duration ["+d+"]. Tuplet involved? ")}var j=this.getTimePerBeat(),k=g.createDefault(),l=new i(b,d,j,e,k);l.dispatch();var m=l.getDispatchedRests(),n=m.map(D,c),o=n.map(E);return o.reduce(F,b),o},A.getDivisionsPerQuarter=function(){return d.getDivisions(this.attributes)},A.getTimePerBeat=function(){if(null===this.timePerBeat){var a=d.getWrappedTime(this.attributes),b=a.getAnyEntry(),c=e.getBeatType(b),g=this.getDivisionsPerQuarter();this.timePerBeat=f.beatTypeToDivisions(c,g)}return this.timePerBeat};var D=function(a){var c=this,d=c.container.note[0],e=b.getVoiceIdx(d),f=b.getStaffIdx(d),g=b.createRest();return b.setVoiceIdx(g,e),b.setStaffIdx(g,f),b.setDuration(g,a),g},E=function(a){return{container:{note:[a],graces:[]},timePos:null}},F=function(a,c){c.timePos=a;var d=c.container.note[0];return a+b.getDuration(d)},G=function(a){a.forEach(function(a){H(a.container.note),a.container.graces.forEach(H)})},H=function(a){var c=a[0];b.hasBackup(c)&&b.removeBackup(c),b.hasForward(c)&&b.removeForward(c)};A.getNotes=function(){var a=[];return this.list.forEach(I,a),a};var I=function(a){var b=this;a.container.graces.forEach(J,b),J.call(b,a.container.note)},J=function(a){var b=this;Array.prototype.push.apply(b,a)}}.call(this),function(){"use strict";var a=Adagio.Error.import.ImportError,b=Adagio.Utils.noteUtils,c=Adagio.Utils.timeModifUtils,d=Adagio.Values.TupletType,e=Adagio.edit.common.MeasureData;Adagio.import.checkMeasureTuplets=function(a){new e(a).forEachVoice(f)};var f=function(e){for(var f,g=!1,h=e.size(),i=0;i<h;i++){var j=e.getNote(i);if(b.hasTupletStart(j)){if(b.getTupletStartLevel(j)>1)throw f="Nested tuplets are not supported.",new a("NestedTuplet",f);g=!0}var k=b.getTimeModif(j);if(!c.isNormal(k)&&!d.isTimeModifSupported(k))throw f="The time modification ["+c.stringify(k)+"] is not supported.",new a("TimeModif",f);if(b.hasTupletStop(j)){if(!g)throw f="There is a tuplet stop without prior start.",new a("TupletStop",f);g=!1}}}}.call(this),function(){"use strict";var a=Adagio.Error.import.ImportError,b=Adagio.Error.InternalError,c=Adagio.Utils.measureUtils,d=Adagio.Utils.noteUtils,e=Adagio.Utils.tupletBoundUtils,f=Adagio.Utils.timeModifUtils,g=Adagio.Utils.durationUtils,h=Adagio.Utils.attributesUtils,i=Adagio.Utils.tupletPortionUtils,j=Adagio.Utils.math,k=Adagio.Values.DurationType,l=Adagio.edit.common.MeasureData;Adagio.import.fillMeasureTuplets=function(a){var b=new l(a),d=c.getAttributes(a);b.forEachVoice(m,d)};var m=function(a){n(a,this)},n=function(a,b){var c,d=0,e=a.size();do{if(-1!==(c=o(a,d))){var f=p(a,c);q(f,b),d=c+f.length}}while(d<e&&-1!==c)},o=function(a,b){for(var c=a.size(),e=b;e<c;e++){var f=a.getNote(e);if(d.hasTupletStart(f))return e}return-1},p=function(a,c){for(var e=[],f=a.size(),g=c;g<f;g++){var h=a.getNote(g);if(e.push(h),d.hasTupletStop(h))return e}throw new b("Unexpected","cannot find a tuplet stop.")},q=function(a,b){var c=a[0],g=1,h=d.getTupletStart(c,g),j=d.getTimeModif(c),k=f.getActual(j),l=f.getNormal(j),m=r(a,b),n=i.createActual(k,m),o=i.createNormal(l);e.setTupletActual(h,n),e.setTupletNormal(h,o)},r=function(b,c){var e=h.getDivisions(c),i=b[0],l=d.getTimeModif(i),m=f.getActual(l),n=b.map(d.getDuration),o=n.reduce(j.add),p=o/m,q=g.actualToNormal(p,l),r=g.divisionsToQuarter(q,e);if(!g.isBaseDuration(r)){throw new a("TupletDot","dotted durations are not allowed for tuplet ratio.")}return k.quarterToDurationType(r)}}.call(this),function(){"use strict";var a=Adagio.Values.DurationType,b=Adagio.Utils.durationUtils;Adagio.edit.common.calcDurationType=function(c,d,e){var f=b.actualToNormal(c,e),g=b.divisionsToQuarter(f,d),h=b.extractBaseDuration(g);return a.quarterToDurationType(h)}}.call(this),function(){"use strict";var a=Adagio.Error.import.ImportError,b=Adagio.Utils.measureUtils,c=Adagio.Utils.noteUtils,d=Adagio.Values.DurationType,e=Adagio.edit.common.calcDurationType;Adagio.import.checkDurations=function(a){var c=b.getDivisions(a);b.getNotes(a).forEach(f,c)};var f=function(b){var f=this.valueOf();if(c.hasDuration(b)){var g=c.getDuration(b);if(g>0){var h=c.getTimeModif(b),i=e(g,f,h),j=d.toRoomForDots(i),k=c.getNbDots(b);if(k>j){var l="The quarter duration ["+d.toQuarterDuration(i)+"] with ["+k+"] dots has a base duration too small.";throw new a("BaseDurationTooSmall",l)}}}}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils;Adagio.import.emptyStaves.getVoicesToAdd=function(a,c){var f=b(a),g=c.length;return d(f,g).map(e,c)};var b=function(a){var b={};return a.forEach(c,b),b},c=function(b){this[a.getStaffIdx(b)]=!0},d=function(a,b){for(var c=[],d=0;d<b;d++)void 0===a[d]&&c.push(d);return c},e=function(a){return{staffIdx:a,voiceIdx:this[a].mainVoiceIdx}}}.call(this),function(){"use strict";var a=Adagio.edit.common.MeasureData,b=Adagio.edit.composite.FillVoiceWithRests;Adagio.import.emptyStaves.createVoices=function(b,d){var e=new a(b);d.forEach(c,e)};var c=function(a){var c=this;c.getVoicesList().insertVoice(a.voiceIdx);var d={staffIdx:a.staffIdx,voiceIdx:a.voiceIdx};new b(c,d).perform()}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.import.emptyStaves.getVoicesToAdd,c=Adagio.import.emptyStaves.createVoices;Adagio.import.emptyStaves.fillMeasureEmptyStaves=function(d,e){var f=a.getNotes(d),g=b(f,e);c(d,g)}}.call(this),function(){"use strict";var a=Adagio.Utils.partHeaderUtils,b=Adagio.Utils.partContentUtils,c=Adagio.import.emptyStaves.fillMeasureEmptyStaves;Adagio.import.emptyStaves.fillPartsEmptyStaves=function(a,b){a.forEach(d,b)};var d=function(c,d){var f=this,g=f[d],h=a.getStaffMapping(c);b.getMeasures(g).forEach(e,h)},e=function(a){c(a,this)}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils;(Adagio.Utils.voiceUtils={}).groupVoices=function(a){return d.group(a)};var b=function(){},c=b.prototype;c.group=function(a){return this.reset(),a.forEach(this.addNote.bind(this)),this.voices},c.reset=function(){this.voices={}},c.addNote=function(b){var c=a.getVoiceIdx(b);this.addNoteToVoice(b,c)},c.addNoteToVoice=function(a,b){void 0===this.voices[b]&&(this.voices[b]=[]),this.voices[b].push(a)};var d=new b}.call(this),function(){"use strict";var a=Adagio.Error.import.ImportError,b=Adagio.Utils.measureUtils,c=Adagio.Utils.noteUtils,d=Adagio.Utils.durationUtils,e=Adagio.Utils.voiceUtils;Adagio.import.checkTimeIntegrity=function(a){var c=b.getDivisions(a),g=b.getWrappedTime(a),h=g.getAnyEntry(),i=d.timeToDivisions(h,c),j=b.getNotes(a),k=e.groupVoices(j);for(var l in k){var m=k[l];f(m,c,i)}};var f=function(b,d,e){b=b.filter(g);var f=b.reduce(function(a,b){return a+c.getDuration(b)},0);if(f!==e){throw new a("TimeSignatureViolation","The time signature implies ["+e+"] divisions while there is actually ["+f+"] for the notes.")}},g=function(a){return!c.isChord(a)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.noteUtils,c=Adagio.Utils.pitchUtils,d=Adagio.Utils.unpitchedUtils,e=Adagio.edit.common.MeasureData,f=null;Adagio.import.fixDuplicateChordHead=function(a){new e(a).forEachVoice(g)};var g=function(a){for(var b=a.size(),c=0;c<b;c++)a.isChord(c)&&h(a,c)},h=function(a,b){i().filter(a,b)},i=function(){return null===f&&(f=new j),f},j=function(){},k=j.prototype;k.filter=function(a,b){this.reset(a,b);var c=this.voice.getChord(this.noteIdx);c=c.slice(),c.forEach(this.processHead,this)},k.reset=function(a,b){this.voice=a,this.noteIdx=b,this.headIdx=0,this.map={}},k.processHead=function(a){var b=m(a);this.hasDuplicate(b)?this.removeHead(b,a):(this.addHead(b,a),this.headIdx++)},k.hasDuplicate=function(a){return void 0!==this.map[a]},k.getHead=function(a){return this.map[a]},k.removeHead=function(a,c){var d=this.map[a];l(d,c)&&(b.hasTieStart(c)&&!b.hasTieStart(d)&&b.addTieStart(d),b.hasTieStop(c)&&!b.hasTieStop(d)&&b.addTieStop(d)),this.voice.removeNoteFromChord(this.noteIdx,this.headIdx)};var l=function(e,f){if(b.hasPitch(e)){var g=b.getPitch(e),h=b.getPitch(f);return c.isSamePitch(g,h)}if(b.hasUnpitched(e)){var i=b.getUnpitched(e),j=b.getUnpitched(f);return d.isSame(i,j)&&b.getHead(e)===b.getHead(f)}throw new a("Unexpected")},m=function(e){if(b.hasPitch(e)){var f=b.getPitch(e);return c.getOctave(f)+"/"+c.getStep(f)}if(b.hasUnpitched(e)){var g=b.getUnpitched(e);return d.stringify(g)}throw new a("Unexpected")};k.addHead=function(a,b){this.map[a]=b}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.noteUtils,c=Adagio.edit.common.initMeasureData,d=Adagio.edit.primitive.RemoveRest=function(a,b,c){this.init(a,b,c)};d.NAME="primitive.RemoveRest";var e=d.prototype;e.name=d.NAME,e.initMeasureData=c,e.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},e.perform=function(){this.assertUnlockedRest(),this.removeRest(),this.updateStack()},e.assertUnlockedRest=function(){var c=this.getNote();if(!b.isRest(c))throw new a("RestExpected");if(b.needRestLock(c))throw new a("LockedRest")},e.getNote=function(){return this.getVoice().getNote(this.opts.noteIdx)},e.removeRest=function(){this.getVoice().removeNote(this.opts.noteIdx)},e.getVoice=function(){var a=this.opts.voiceIdx,b=this.opts.noteIdx;return this.measureData.getVoiceOrTupletForGet(a,b)},e.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.Utils.pitchUtils,b=Adagio.Error.client.ClientError,c=Adagio.Error.client.PitchCollisionError=function(c,d,e){var f=c.msgPrefix+" at ";if(e){f+="line "+a.pitchToLine(d,e)+" ("+d.step+"/"+d.octave+"). "}else f+="pitch "+d.step+"/"+d.octave+". ";var g=b.call(this,f);return this.name=g.name="PitchCollisionError",this.stack=g.stack,this.message=g.message,this.pitch=d,this.clef=e,this};c.prototype=Object.create(b.prototype,{constructor:{value:c}}),c.action={INSERT:{msgPrefix:"There is already a note"},GET:{msgPrefix:"There is no note"}}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError;Adagio.edit.common.getStaffIdx=function(b){if(void 0!==b.staffIdx)return b.staffIdx;throw new a("Unexpected","Cannot convert line to pitch, or convert from concert pitch, since there is no staffIdx informations provided.")}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils;Adagio.edit.common.noteIdxToTimePos=function(b,c){for(var d=0,e=0;e<c;e++){var f=b.getNote(e);d+=a.getDuration(f)}return d}}.call(this),function(){"use strict";var a=Adagio.edit.common.getStaffIdx,b=Adagio.edit.common.noteIdxToTimePos,c=Adagio.Utils.measureUtils,d=Adagio.Data.octaveShift.searchOctaveShift;Adagio.edit.common.getOctaveShiftAtNote=function(f,g){var h=a(g),i=f.getMeasure(),j=e(i,h),k=c.getOctaveShifts(i,h),l=f.getVoice(g.voiceIdx),m=b(l,g.noteIdx);return d(j,k,m,!0)};var e=function(a,b){return c.hasLeftOctaveShift(a,b)?c.getLeftOctaveShift(a,b):null}}.call(this),function(){"use strict";var a=Adagio.edit.common.getStaffIdx,b=Adagio.Utils.measureUtils,c=Adagio.Data.octaveShift.searchOctaveShift;Adagio.edit.common.getOctaveShiftAtTimePos=function(e,f){var g=a(f),h=e.getMeasure(),i=d(h,g),j=b.getOctaveShifts(h,g),k=b.getDpq(h),l=f.timePos*k/f.divisions;return c(i,j,l,!0)};var d=function(a,c){return b.hasLeftOctaveShift(a,c)?b.getLeftOctaveShift(a,c):null}}.call(this),function(){"use strict";var a=Adagio.Utils.direction.octaveShiftDirectionUtils,b=Adagio.edit.common.getOctaveShiftAtNote,c=Adagio.edit.common.getOctaveShiftAtTimePos,d=Adagio.Error.InternalError;Adagio.edit.common.transposeLineFromOctaveShift=function(a,b){var c=e(a,b);c&&i(c,b)};var e=function(a,b){return f(b)(a,b)},f=function(a){if(g(a))return c;if(h(a))return b;throw new d("Unexpected")},g=function(a){return"number"==typeof a.timePos&&"number"==typeof a.divisions},h=function(a){return"number"==typeof a.noteIdx},i=function(b,c){c.line=a.removeShiftFromLine(b,c.line)}}.call(this),function(){"use strict";var a=Adagio.Utils.pitchUtils,b=Adagio.edit.common.getStaffIdx,c=Adagio.edit.common.transposeLineFromOctaveShift;Adagio.edit.common.convertLineToPitch=function(b,e,f){if(void 0!==e.line){var g=d(b,e);f&&c(b,e),e.pitch=a.lineToPitch(e.line,g),delete e.line}};var d=function(a,c){var d=b(c);return a.getClef(d)}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadLineError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadLineError",this.stack=e.stack,this.message=e.message,this.line=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"the line value ["+a+"] is invalid."}}.call(this),function(){"use strict";var a=Adagio.Utils.pitchUtils,b=Adagio.Utils.pitchLineUtils,c=Adagio.Error.value.BadLineError;Adagio.edit.common.checkOptsPitch=function(b){void 0!==b.line?d(b.line):a.check(b.pitch)};var d=function(a){if(!b.isValidLine(a))throw new c(a)}}.call(this),function(){"use strict";var a=Adagio.Utils.typeUtils,b=Adagio.Utils.pitchUtils,c=Adagio.Utils.noteUtils;Adagio.edit.common.getNoteAtPitch=function(b,c,f,g){var h=d(b,c,g);return h=a.makeArray(h),h.find(e,f)};var d=function(a,b,c){return"number"==typeof c?a.getGraceChord(b,c):a.getChord(b)},e=function(a){var d=this,e=c.getPitch(a);return b.isSameLine(e,d)}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.BadTimePosError=function(d,e,f){void 0===f&&(f=b.GET),void 0===e&&(e=1);var g=c(d,e,f),h=a.call(this,g);return this.name=h.name="BadTimePosError",this.stack=h.stack,this.message=h.message,this.timePos=d,this.dpq=e,this.action=f,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a,b,c){
return c.msgPrefix+" entity at the time position ["+a+"/"+b+"] (quarter duration)."};b.INSERT={msgPrefix:"Cannot insert"},b.GET={msgPrefix:"There is no"}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.noteUtils;Adagio.edit.common.timePosToNoteIdx=function(c,d,e){for(var f=0,g=c.size(),h=0;h<g-1&&f<e;h++){var i=c.getNote(h);f+=b.getDuration(i)*d}if(f===e)return h;throw new a("Unexpected","There is no noteIdx for time position ["+e+"].")}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadTimePosError,b=Adagio.Utils.math,c=Adagio.edit.common.hasTimePosExactNoteIdx,d=Adagio.edit.common.timePosToNoteIdx;Adagio.edit.common.convertTimePosToGetNoteIdx=function(a,b){void 0!==b.timePos&&e(a,b)};var e=function(e,f){var g=e.getDivisions().getDivisions(),h=b.lcm(g,f.divisions),i=h/g,j=h/f.divisions;f.timePos*=j;var k=e.getVoice(f.voiceIdx);if(!c(k,i,f.timePos))throw new a(f.timePos,h,a.GET);f.noteIdx=d(k,i,f.timePos),delete f.timePos,delete f.divisions}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.edit.common.calcDurationType;Adagio.edit.common.extractNoteDurationType=function(c,d){var e=a.getDuration(c),f=a.getTimeModif(c);return b(e,d,f)}}.call(this),function(){"use strict";var a=Adagio.edit.common.getStaffIdx,b=Adagio.Utils.transposeUtils,c=Adagio.Utils.pitchUtils;Adagio.edit.common.transposePitchLineOpts=function(d,e){if(e.isConcertPitch){var f=a(e),g=d.getTranspose(f);if(!b.isIdentity(g)){g=b.getReverse(g);var h=e.pitch;h=c.transpose(h,g),e.pitch=c.copyWithoutAlter(h),e.isConcertPitch=!1}}}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Values.TechnicalType;Adagio.edit.common.extractFret=function(c){if(a.hasTechnical(c,b.FRET)&&a.hasTechnical(c,b.STRING))return{fret:a.getTechnicalContent(c,b.FRET),string:a.getTechnicalContent(c,b.STRING)}}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.pitchUtils,c=Adagio.edit.common.initMeasureData,d=Adagio.edit.primitive.RemoveFromChord=function(a,b,c){this.init(a,b,c)};d.NAME="primitive.RemoveFromChord";var e=d.prototype;e.name=d.NAME,e.initMeasureData=c,e.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},e.perform=function(){var b=this.getVoice(),c=b.getChord(this.opts.noteIdx),d=c.map(a.getPitch),e=d.findIndex(f,this.opts.pitch),g=c[e];b.removeNoteFromChord(this.opts.noteIdx,e),this.updateStack(g)},e.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)};var f=function(a){var c=this;return b.isSameLine(a,c)};e.updateStack=function(c){var d=a.getPitch(c),e=g(c),f=a.getStaffIdx(c),h={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,noteIdx:this.opts.noteIdx,voiceIdx:this.opts.voiceIdx,staffIdx:f,pitch:b.copy(d),accidental:e}};this.cancelStack.push(h)};var g=function(b){return a.hasAccidental(b)?a.getAccidental(b):null}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.pitchUtils,c=Adagio.edit.common.getNoteAtPitch,d=Adagio.edit.common.initMeasureData,e=Adagio.edit.primitive.SetAccidental=function(a,b,c){this.init(a,b,c)};e.NAME="primitive.SetAccidental";var f=e.prototype;f.initMeasureData=d,f.name=e.NAME,f.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},f.perform=function(){var b,c=this.getNoteAtPitch();b=a.hasAccidental(c)?a.getAccidental(c):null,a.setAccidental(c,this.opts.accidental),this.updateStack(b)},f.getNoteAtPitch=function(){var a=this.measureData.getVoice(this.opts.voiceIdx);return c(a,this.opts.noteIdx,this.opts.pitch)},f.updateStack=function(a){var c={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:b.copy(this.opts.pitch),previousAccidental:a,accidental:this.opts.accidental}};this.cancelStack.push(c)}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.pitchUtils,c=Adagio.edit.primitive.SetAccidental,d=Adagio.edit.common.getNoteAtPitch,e=Adagio.edit.common.initMeasureData,f=Adagio.edit.composite.SetAccidentalIfNeeded=function(a,b,c){this.init(a,b,c)};f.NAME="composite.SetAccidentalIfNeeded";var g=f.prototype;g.initMeasureData=e,g.name=f.NAME,g.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},g.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.needSet()&&this.setAccidental()},g.needSet=function(){var b=this.getNoteAtPitch();if(a.hasAccidental(b)){var c=a.getAccidental(b);return this.opts.accidental!==c}return!0},g.getNoteAtPitch=function(){var a=this.measureData.getVoice(this.opts.voiceIdx);return d(a,this.opts.noteIdx,this.opts.pitch)},g.setAccidental=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:b.copy(this.opts.pitch),accidental:this.opts.accidental};new c(this.measureData,a,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Utils.typeUtils,b=Adagio.Utils.pitchUtils,c=Adagio.Utils.noteUtils;Adagio.edit.common.getGraceAtPitch=function(b,c,e,f){var g=b.getGraceChord(c,e);return g=a.makeArray(g),g.find(d,f)};var d=function(a){var d=this,e=c.getPitch(a);return b.isSameLine(e,d)}}.call(this);(function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.noteUtils,c=Adagio.edit.common.getGraceAtPitch,d=Adagio.edit.common.initMeasureData,e=Adagio.edit.primitive.SetGraceAccidental=function(a,b,c){this.init(a,b,c)};e.NAME="primitive.SetGraceAccidental";var f=e.prototype;f.initMeasureData=d,f.name=e.NAME,f.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},f.perform=function(){var a=this.getGraceAtPitch();b.setAccidental(a,this.opts.accidental),this.updateStack()},f.getGraceAtPitch=function(){var b=this.measureData.getVoice(this.opts.voiceIdx),d=c(b,this.opts.noteIdx,this.opts.graceIdx,this.opts.pitch);if(void 0===d)throw new a("NoGraceAtPitch");return d},f.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(a)}}).call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.pitchUtils,c=Adagio.edit.primitive.SetGraceAccidental,d=Adagio.edit.common.getGraceAtPitch,e=Adagio.edit.common.initMeasureData,f=Adagio.edit.composite.SetGraceAccidentalIfNeeded=function(a,b,c){this.init(a,b,c)};f.NAME="composite.SetGraceAccidentalIfNeeded";var g=f.prototype;g.initMeasureData=e,g.name=f.NAME,g.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},g.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.needSet()&&this.setAccidental()},g.needSet=function(){var b=this.getGraceAtPitch();if(a.hasAccidental(b)){var c=a.getAccidental(b);return this.opts.accidental!==c}return!0},g.getGraceAtPitch=function(){var a=this.measureData.getVoice(this.opts.voiceIdx);return d(a,this.opts.noteIdx,this.opts.graceIdx,this.opts.pitch)},g.setAccidental=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,pitch:b.copy(this.opts.pitch),accidental:this.opts.accidental};new c(this.measureData,a,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.pitchUtils,c=Adagio.edit.common.getNoteAtPitch,d=Adagio.edit.common.initMeasureData,e=Adagio.edit.primitive.RemoveAccidental=function(a,b,c){this.init(a,b,c)};e.NAME="primitive.RemoveAccidental";var f=e.prototype;f.initMeasureData=d,f.name=e.NAME,f.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},f.perform=function(){var b=this.getNoteAtPitch(),c=a.getAccidental(b);a.removeAccidental(b),this.updateStack(c)},f.getNoteAtPitch=function(){var a=this.measureData.getVoice(this.opts.voiceIdx);return c(a,this.opts.noteIdx,this.opts.pitch)},f.updateStack=function(a){var c={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:b.copy(this.opts.pitch),removedAccidental:a}};this.cancelStack.push(c)}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.pitchUtils,c=Adagio.edit.primitive.RemoveAccidental,d=Adagio.edit.common.getNoteAtPitch,e=Adagio.edit.common.initMeasureData,f=Adagio.edit.composite.RemoveAccidentalIfNeeded=function(a,b,c){this.init(a,b,c)};f.NAME="composite.RemoveAccidentalIfNeeded";var g=f.prototype;g.initMeasureData=e,g.name=f.NAME,g.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},g.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.needRemove()&&this.remove()},g.needRemove=function(){var b=this.getNoteAtPitch();return a.hasAccidental(b)},g.getNoteAtPitch=function(){var a=this.measureData.getVoice(this.opts.voiceIdx);return d(a,this.opts.noteIdx,this.opts.pitch)},g.remove=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:b.copy(this.opts.pitch)};new c(this.measureData,a,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.noteUtils,c=Adagio.edit.common.getGraceAtPitch,d=Adagio.edit.common.initMeasureData,e=Adagio.edit.primitive.RemoveGraceAccidental=function(a,b,c){this.init(a,b,c)};e.NAME="primitive.RemoveGraceAccidental";var f=e.prototype;f.initMeasureData=d,f.name=e.NAME,f.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},f.perform=function(){var a=this.getGraceAtPitch();b.removeAccidental(a),this.updateStack()},f.getGraceAtPitch=function(){var b=this.measureData.getVoice(this.opts.voiceIdx),d=c(b,this.opts.noteIdx,this.opts.graceIdx,this.opts.pitch);if(void 0===d)throw new a("NoGraceAtPitch");return d},f.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.pitchUtils,c=Adagio.edit.primitive.RemoveGraceAccidental,d=Adagio.edit.common.getGraceAtPitch,e=Adagio.edit.common.initMeasureData,f=Adagio.edit.composite.RemoveGraceAccidentalIfNeeded=function(a,b,c){this.init(a,b,c)};f.NAME="composite.RemoveGraceAccidentalIfNeeded";var g=f.prototype;g.initMeasureData=e,g.name=f.NAME,g.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},g.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.needRemove()&&this.remove()},g.needRemove=function(){var b=this.getGraceAtPitch();return a.hasAccidental(b)},g.getGraceAtPitch=function(){var a=this.measureData.getVoice(this.opts.voiceIdx);return d(a,this.opts.noteIdx,this.opts.graceIdx,this.opts.pitch)},g.remove=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,pitch:b.copy(this.opts.pitch)};new c(this.measureData,a,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.edit.common.GracesScroller=function(a){this.voice=a},c=b.prototype;c.forEach=function(a){var b=this.getFirstCursor();for(a(b);this.hasNextEntity(b.noteIdx,b.graceIdx);)b=this.getNextCursor(b.noteIdx,b.graceIdx),a(b)},c.getFirstCursor=function(){if(0===this.voice.getNbNotes())throw new a("Unexpected","Voice should not be empty.");return this.voice.hasGrace(0)?{noteIdx:0,graceIdx:0}:{noteIdx:0,graceIdx:null}},c.hasNextEntity=function(a,b){return"number"==typeof b?this.hasEntityAfterGrace(a,b):this.hasEntityAfterNote(a)},c.hasEntityAfterGrace=function(a,b){return this.voice.assertGraceIdx(a,b),!0},c.hasEntityAfterNote=function(a){return this.voice.assertNoteIdx(a),a+1<this.voice.getNbNotes()},c.getNextCursor=function(a,b){return"number"==typeof b?this.getCursorAfterGrace(a,b):this.getCursorAfterNote(a)},c.getCursorAfterGrace=function(a,b){return b+1<this.voice.getNbGraces(a)?{noteIdx:a,graceIdx:b+1}:{noteIdx:a,graceIdx:null}},c.getCursorAfterNote=function(a){return this.voice.hasGrace(a+1)?{noteIdx:a+1,graceIdx:0}:{noteIdx:a+1,graceIdx:null}},c.hasPreviousEntity=function(a,b){return"number"==typeof b?this.hasEntityBeforeGrace(a,b):this.hasEntityBeforeNote(a)},c.hasEntityBeforeGrace=function(a,b){return this.voice.assertGraceIdx(a,b),b>0||a>0},c.hasEntityBeforeNote=function(a){return this.voice.assertNoteIdx(a),!!this.voice.hasGrace(a)||a>0},c.getPreviousCursor=function(a,b){return"number"==typeof b?this.getCursorBeforeGrace(a,b):this.getCursorBeforeNote(a)},c.getCursorBeforeGrace=function(a,b){return b>0?{noteIdx:a,graceIdx:b-1}:{noteIdx:a-1,graceIdx:null}},c.getCursorBeforeNote=function(a){if(this.voice.hasGrace(a)){return{noteIdx:a,graceIdx:this.voice.getNbGraces(a)-1}}return{noteIdx:a-1,graceIdx:null}}}.call(this),function(){"use strict";var a=Adagio.Utils.typeUtils,b=Adagio.Utils.noteUtils,c=Adagio.Utils.pitchUtils,d=Adagio.Utils.keyUtils,e=Adagio.edit.common.GracesScroller;Adagio.edit.common.getPreviousAlter=function(a,c,d,e,g,h){var i=a.getVoice(d),k=f(i,c,g,h);return void 0!==k?b.getAlter(k):j(a,e,g)};var f=function(b,c,d,f){for(var j=new e(b),k={noteIdx:c,graceIdx:f};j.hasPreviousEntity(k.noteIdx,k.graceIdx);)if(k=j.getPreviousCursor(k.noteIdx,k.graceIdx),g(b,k)){var l=h(b,k);l=a.makeArray(l);var m=l.find(i,d);if(void 0!==m)return m}},g=function(a,b){return null!==b.graceIdx||!a.isRest(b.noteIdx)},h=function(a,b){return null!==b.graceIdx?a.getGraceChord(b.noteIdx,b.graceIdx):a.getChord(b.noteIdx)},i=function(a){var d=this,e=b.getPitch(a);return c.isSameLine(e,d)},j=function(a,b,e){var f=c.getStep(e),g=a.getKey(b),h=d.getFifths(g);return c.stepToAlter(f,h)}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.pitchUtils,c=Adagio.edit.composite.SetAccidentalIfNeeded,d=Adagio.edit.composite.SetGraceAccidentalIfNeeded,e=Adagio.edit.composite.RemoveAccidentalIfNeeded,f=Adagio.edit.composite.RemoveGraceAccidentalIfNeeded,g=Adagio.edit.common.getPreviousAlter,h=Adagio.edit.common.getNoteAtPitch,i=Adagio.edit.common.getGraceAtPitch,j=Adagio.edit.common.GracesScroller,k=Adagio.edit.common.initMeasureData,l=Adagio.edit.composite.UpdateAccidental=function(a,b,c){this.init(a,b,c)};l.NAME="composite.UpdateAccidental";var m=l.prototype;m.initMeasureData=k,m.name=l.NAME,m.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},m.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a=this.getPreviousAlter();a=this.updateCurrentAccidental(a),this.updateNextAccidental(a)},m.getPreviousAlter=function(){return g(this.measureData,this.opts.noteIdx,this.opts.voiceIdx,this.opts.staffIdx,this.opts.pitch,null)},m.updateCurrentAccidental=function(c){var d=this.getNoteAtPitch();if(void 0!==d){var e=a.getPitch(d),f=b.getAlter(e);return this.updateAccidental(d,this.opts.noteIdx,c,null),f}return c},m.getNoteAtPitch=function(){var a=this.measureData.getVoice(this.opts.voiceIdx);return a.isRest(this.opts.noteIdx)?void 0:h(a,this.opts.noteIdx,this.opts.pitch)},m.updateNextAccidental=function(a){var b=this.measureData.getVoice(this.opts.voiceIdx),c=n(b,this.opts.noteIdx,this.opts.pitch);if(null!==c){var d=this.getNextNoteAtPitch(c);this.updateAccidental(d,c.noteIdx,a,c.graceIdx)}},m.getNextNoteAtPitch=function(a){var b=this.measureData.getVoice(this.opts.voiceIdx);return null===a.graceIdx?h(b,a.noteIdx,this.opts.pitch):i(b,a.noteIdx,a.graceIdx,this.opts.pitch)};var n=function(a,b,c){for(var d=new j(a),e={noteIdx:b,graceIdx:null};d.hasNextEntity(e.noteIdx,e.graceIdx);)if(e=d.getNextCursor(e.noteIdx,e.graceIdx),o(a,e)){var f=h(a,e.noteIdx,c,e.graceIdx);if(void 0!==f)return e}return null},o=function(a,b){return null!==b.graceIdx||!a.isRest(b.noteIdx)};m.updateAccidental=function(c,d,e,f){var g=a.getPitch(c),h=b.getAlter(g);if(h===e)this.removeAccidental(d,f);else{var i=b.alterToAccidental(h);this.addAccidental(d,i,f)}},m.removeAccidental=function(a,c){var d,g={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:a,pitch:b.copy(this.opts.pitch)};null===c?d=new e(this.measureData,g,this.cancelStack):(g.graceIdx=c,d=new f(this.measureData,g,this.cancelStack)),d.perform()},m.addAccidental=function(a,e,f){var g,h={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:a,pitch:b.copy(this.opts.pitch),accidental:e};null===f?g=new c(this.measureData,h,this.cancelStack):(h.graceIdx=f,g=new d(this.measureData,h,this.cancelStack)),g.perform()}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.DoesntHaveFretDataOptsError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="DoesntHaveFretDataOptsError",this.stack=e.stack,this.message=e.message,this.technicalType=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"Note doesn't have fret data opts "+a}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadFretDataOptsError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadFretDataOptsError",this.stack=e.stack,this.message=e.message,this.type=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"Fret data option "+a+" is invalid."}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.NoFretFound=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="NoFretFound",this.stack=e.stack,this.message=e.message,this.pitch=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"No fret found for pitch ["+JSON.stringify(a)+"]"}}.call(this),function(){"use strict";var a=Adagio.Error.value.BadFretDataOptsError,b=Adagio.Utils.math,c=Adagio.Values.FretValue={};c.check=function(b){if(!c.isValid(b))throw new a("fret")},c.isValid=function(a){return b.isNumber(a)&&a>=0&&a<=36}}.call(this),function(){"use strict";var a=Adagio.Error.client.NoFretFound,b=Adagio.Utils.pitchUtils,c=Adagio.Utils.staffDetailsUtils,d=Adagio.Utils.staffTuningUtils,e=Adagio.Utils.transposeUtils,f=Adagio.Utils.typeUtils,g=Adagio.Values.FretValue;Adagio.edit.common.pitchToFret=function(h,i,j){var k={},l=c.getStaffTuningsLength(i);f.isArray(j)||(j=[]);for(var m=1;m<=l;m++){var n=c.getShiftedTuningByString(i,m),o=d.toPitch(n),p=b.getTransposeDiff(h,o),q=e.getChromatic(p),r=e.getOctaveChange(p),s=q+r*e.NB_CHROMATIC;s>=0&&!j.includes(m)&&(void 0===k.fret||s<k.fret)&&(k={fret:s,string:m})}if(!g.isValid(k.fret))throw new a(h);return k}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.edit.common.pitchToFret,c=Adagio.Utils.noteUtils,d=Adagio.Utils.typeUtils,e=Adagio.Values.TechnicalType;Adagio.edit.common.convertPitchToFret=function(a,c,e){if(void 0!==c.pitch){var g=i(a,c),h=j(a,c),m=f(c),n=h.getChord(m);n=d.makeArray(n);var o=n.map(k);o=o.filter(l,e),c.fretData=b(c.pitch,g,o)}};var f=function(b){if(void 0!==b.noteIdx)return b.noteIdx;throw new a("Unexpected","Cannot convert fret to pitch since there is no noteIdx informations.")},g=function(b){if(void 0!==b.voiceIdx)return b.voiceIdx;throw new a("Unexpected","Cannot convert fret to pitch since there is no voiceIdx informations.")},h=function(b,c){if(void 0!==c.staffIdx)return c.staffIdx;if(void 0!==c.voiceIdx)return b.getVoiceMainStaffIdx(c.voiceIdx);throw new a("Unexpected","Cannot convert fret to pitch since there is no staffIdx informations.")},i=function(a,b){var c=h(a,b);return a.getStaffDetails(c)},j=function(a,b){var c=g(b);return a.getVoice(c)},k=function(a){return c.hasTechnical(a,e.STRING)?c.getTechnicalContent(a,e.STRING):-1},l=function(a){return a!==this}}.call(this),function(){"use strict";var a=Adagio.edit.common.initMeasureData,b=Adagio.edit.common.getNoteAtPitch,c=Adagio.Utils.noteUtils,d=Adagio.Utils.technicalUtils,e=Adagio.Utils.pitchUtils,f=Adagio.Values.TechnicalType,g=Adagio.edit.primitive.SetFret=function(a,b,c){this.init(a,b,c)};g.NAME="primitive.SetFret";var h=g.prototype;h.name=g.NAME,h.initMeasureData=a,h.init=function(a,b,c){this.initMeasureData(a,b),this.opts=b,this.cancelStack=c},h.perform=function(){var a=this.measureData.getVoice(this.opts.voiceIdx),c=b(a,this.opts.noteIdx,this.opts.pitch);this.addTechnical(c,f.FRET),this.addTechnical(c,f.STRING),this.updateCancelStack()},h.addTechnical=function(a,b){var e=d.getTechnicalOpts(this.opts.fretData,b);c.addTechnical(a,b,e)},h.updateCancelStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:e.copy(this.opts.pitch),fretData:this.opts.fretData}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.edit.common.initMeasureData,b=Adagio.edit.common.getNoteAtPitch,c=Adagio.Utils.noteUtils,d=Adagio.Utils.pitchUtils,e=Adagio.Values.TechnicalType,f=Adagio.edit.primitive.UnsetFret=function(a,b,c){this.init(a,b,c)};f.NAME="primitive.UnsetFret";var g=f.prototype;g.name=f.NAME,g.initMeasureData=a,g.init=function(a,b,c){this.initMeasureData(a,b),this.opts=b,this.cancelStack=c},g.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},g.getNoteAtPitch=function(){var a=this.getVoice();return b(a,this.opts.noteIdx,this.opts.pitch)},g.perform=function(){var a=this.getNoteAtPitch();c.removeTechnical(a,e.FRET),c.removeTechnical(a,e.STRING),this.updateCancelStack()},g.updateCancelStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:d.copy(this.opts.pitch)}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.NoHammerOnPullOffToRemove=function(){var b="There is no hammer-on/pull-off at this location.",c=a.call(this,b);return this.name=c.name="NoHammerOnPullOffToRemove",this.stack=c.stack,this.message=c.message,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}})}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.NoFretDataError=function(b){var c="There is no fret data linked to this note.",d=a.call(this,c);return this.name=d.name="NoFretDataError",this.stack=d.stack,this.message=d.message,this.pitch=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}})}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.NotPossibleOnNonTabError=function(){var b="This operation is only allowed on tab part.",c=a.call(this,b);return this.name=c.name="NotPossibleOnNonTabError",this.stack=c.stack,this.message=c.message,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}})}.call(this),function(){"use strict";var a=Adagio.Error.client.NotPossibleOnNonTabError,b=Adagio.edit.common.getScoreData;Adagio.edit.common.checkTabPart=function(c,d){if(c=b(c),!c.isPartTab(d.partIdx))throw new a}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.NoNoteAtFretError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="NoNoteAtFretError",this.stack=e.stack,this.message=e.message,this.fretData=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"No note found on the fret ["+a.fret+"] of the string ["+a.string+"]."}}.call(this),function(){"use strict";var a=Adagio.Utils.typeUtils,b=Adagio.Utils.noteUtils;Adagio.edit.common.getNoteAtFretData=function(b,d,e){var f=b.getChord(d);return f=a.makeArray(f),f.find(c,e)};var c=function(a){var c=this;if(b.hasTabData(a)){var d=b.getTabData(a);return d.fret===c.fret&&d.string===c.string}return!1}}.call(this),function(){"use strict";var a=Adagio.Error.client.NoNoteAtFretError,b=Adagio.Utils.clone,c=Adagio.Utils.noteUtils,d=Adagio.Utils.pitchUtils,e=Adagio.edit.common.getNoteAtFretData;Adagio.edit.common.convertExistingFretToPitch=function(f,g){var h=f.getVoice(g.voiceIdx),i=e(h,g.noteIdx,g.fretData);if(void 0!==i){var j=c.getPitch(i);return j=d.copy(j)}var k=b(g.fretData);throw new a(k)}}.call(this),function(){"use strict";var a=Adagio.Utils.typeUtils,b=Adagio.edit.common.CrossMeasure=function(a,b,c){this.init(a,b,c)},c=b.prototype;c.init=function(a,b,c){this.measureData=a,this.voiceIdx=b,this.noteIdx=c},c.checkVoiceIdx=function(){this.checkLeftVoiceIdx(),this.checkRightVoiceIdx()},c.checkLeftVoiceIdx=function(){this.getLeftMeasure().checkVoiceIdx(this.voiceIdx)},c.checkRightVoiceIdx=function(){this.getRightMeasure().checkVoiceIdx(this.voiceIdx)},c.checkNoteIdx=function(){this.checkLeftNoteIdx(),this.checkRightNoteIdx()},c.checkLeftNoteIdx=function(){var a=this.getLeftVoice(),b=this.getLeftNoteIdx();a.checkNoteIdx(b)},c.checkRightNoteIdx=function(){var a=this.getRightVoice(),b=this.getRightNoteIdx();a.checkNoteIdx(b)},c.isLeftRest=function(){var a=this.getLeftVoice(),b=this.getLeftNoteIdx();return a.isRest(b)},c.isRightRest=function(){var a=this.getRightVoice(),b=this.getRightNoteIdx();return a.isRest(b)},c.getLeftChord=function(){var b=this.getLeftVoice(),c=this.getLeftNoteIdx(),d=b.getChord(c);return a.makeArray(d)},c.hasRightGrace=function(){var a=this.getRightVoice(),b=this.getRightNoteIdx();return a.hasGrace(b)},c.getRightChord=function(){var b=this.getRightVoice(),c=this.getRightNoteIdx(),d=b.getChord(c);return a.makeArray(d)},c.getLeftNoteIdx=function(){if(this.hasLeftOverflow()){return this.getPreviousVoiceSize()-1}return this.noteIdx},c.getPreviousVoiceSize=function(){return this.getPreviousVoice().size()},c.getRightNoteIdx=function(){return this.hasRightOverflow()?0:this.noteIdx+1},c.hasLeftVoice=function(){return this.hasLeftOverflow()?this.hasPreviousVoice():this.hasVoice()},c.hasPreviousVoice=function(){return this.getPreviousMeasure().hasVoice(this.voiceIdx)},c.hasRightVoice=function(){return this.hasRightOverflow()?this.hasNextVoice():this.hasVoice()},c.hasNextVoice=function(){return this.getNextMeasure().hasVoice(this.voiceIdx)},c.hasVoice=function(){return this.measureData.hasVoice(this.voiceIdx)},c.getLeftVoice=function(){return this.hasLeftOverflow()?this.getPreviousVoice():this.getVoice()},c.getPreviousVoice=function(){return this.getPreviousMeasure().getVoice(this.voiceIdx)},c.hasLeftOverflow=function(){return-1===this.noteIdx},c.getRightVoice=function(){return this.hasRightOverflow()?this.getNextVoice():this.getVoice()},c.hasRightOverflow=function(){var a=this.getVoiceSize();return this.noteIdx+1===a},c.getVoiceSize=function(){return this.getVoice().size()},c.getNextVoice=function(){return this.getNextMeasure().getVoice(this.voiceIdx)},c.getVoice=function(){return this.measureData.getVoice(this.voiceIdx)},c.getRightMeasureIdx=function(){return this.getRightMeasure().getIdx()},c.getRightMeasure=function(){return this.hasRightOverflow()?this.getNextMeasure():this.getMeasure()},c.getLeftMeasureIdx=function(){return this.getLeftMeasure().getIdx()},c.getLeftMeasure=function(){return this.hasLeftOverflow()?this.getPreviousMeasure():this.getMeasure()},c.getPreviousMeasure=function(){return this.measureData.getPreviousMeasure()},c.getNextMeasure=function(){return this.measureData.getNextMeasure()},c.getMeasure=function(){return this.measureData}}.call(this),function(){"use strict";var a=Adagio.edit.common.initMeasureData,b=Adagio.edit.common.getNoteAtPitch,c=Adagio.Utils.noteUtils,d=Adagio.edit.primitive.RemoveHammerOnPullOffSide=function(a,b,c){this.init(a,b,c)};d.NAME="primitive.RemoveHammerOnPullOffSide";var e=d.prototype;e.name=d.NAME,e.initMeasureData=a,e.init=function(a,b,c){this.initMeasureData(a,b),this.opts=b,this.cancelStack=c},e.perform=function(){var a=this.measureData.getVoice(this.opts.voiceIdx),d=b(a,this.opts.noteIdx,this.opts.pitch);c.hasTechnical(d,this.opts.technicalType,this.opts.technicalOpts)&&c.removeTechnical(d,this.opts.technicalType,this.opts.technicalOpts),this.updateStack()},e.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.edit.common.CrossMeasure,b=Adagio.edit.common.initMeasureData,c=Adagio.edit.primitive.RemoveHammerOnPullOffSide,d=Adagio.Utils.hammerOnPullOffUtils,e=Adagio.Utils.noteUtils,f=Adagio.Utils.pitchUtils,g=Adagio.Values.HammerOnPullOffType,h=Adagio.edit.composite.RemoveHammerOnPullOff=function(a,b,c){this.init(a,b,c)};h.NAME="composite.RemoveHammerOnPullOff";var i=h.prototype;i.name=h.NAME,i.initMeasureData=b,i.init=function(b,c,d){this.initMeasureData(b,c),this.opts=c,this.cancelStack=d,this.crossMeasure=new a(this.measureData,c.voiceIdx,c.noteIdx),this.leftNote=null,this.rightNote=null},i.perform=function(){this.removeStartHammerOnPullOff(),this.removeStopHammerOnPullOff()},i.removeStartHammerOnPullOff=function(){var a=this.getTechnicalOpts(g.START),b=this.getLeftNote(),d={partIdx:this.opts.partIdx,measureIdx:this.crossMeasure.getLeftMeasureIdx(),voiceIdx:this.opts.voiceIdx,noteIdx:this.crossMeasure.getLeftNoteIdx(),technicalType:this.opts.technicalType,technicalOpts:a,pitch:e.getPitch(b)};new c(this.crossMeasure.getLeftMeasure(),d,this.cancelStack).perform()},i.removeStopHammerOnPullOff=function(){var a=this.getTechnicalOpts(g.STOP),b=this.getRightNote(),d={partIdx:this.opts.partIdx,measureIdx:this.crossMeasure.getRightMeasureIdx(),voiceIdx:this.opts.voiceIdx,noteIdx:this.crossMeasure.getRightNoteIdx(),technicalType:this.opts.technicalType,technicalOpts:a,pitch:e.getPitch(b)};new c(this.crossMeasure.getRightMeasure(),d,this.cancelStack).perform()},i.getTechnicalOpts=function(a){return{hammerOnPullOff:d.create(a)}},i.getLeftNote=function(){if(null===this.leftNote){var a=this.crossMeasure.getLeftChord();this.leftNote=a.find(this.pitchPredicate,this)}return this.leftNote},i.pitchPredicate=function(a){var b=e.getPitch(a);return f.isSameLine(b,this.opts.pitch)},i.getRightNote=function(){if(null===this.rightNote){var a=this.getLeftNote(),b=this.crossMeasure.getRightChord(),c=e.getFretData(a);this.rightNote=b.find(this.stringPredicate,c)}return this.rightNote},i.stringPredicate=function(a){var b=this;return e.getFretData(a).string===b.string}}.call(this),function(){"use strict";var a=Adagio.edit.common.initMeasureData,b=Adagio.edit.common.convertPartUuidToGetPartIdx,c=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,d=Adagio.edit.common.convertTimePosToGetNoteIdx,e=Adagio.edit.common.checkTabPart,f=Adagio.edit.common.noteIdxToTimePos,g=Adagio.edit.common.convertLineToPitch,h=Adagio.edit.common.transposePitchLineOpts,i=Adagio.edit.common.convertExistingFretToPitch,j=Adagio.edit.common.CrossMeasure,k=Adagio.Error.InternalError,l=Adagio.Error.client.NotPossibleOnUnpitchedError,m=Adagio.Error.client.NotPossibleOnRestsError,n=Adagio.Error.client.NoHammerOnPullOffToRemove,o=Adagio.Error.client.BadPartIdxError,p=Adagio.Error.client.BadMeasureIdxError,q=Adagio.Error.client.BadNoteIdxError,r=Adagio.Error.client.BadVoiceError,s=Adagio.Error.client.NotPossibleOnNonTabError,t=Adagio.Error.client.PitchCollisionError,u=Adagio.Error.client.NoFretDataError,v=Adagio.Utils.clone,w=Adagio.Utils.noteUtils,x=Adagio.Utils.hammerOnPullOffUtils,y=Adagio.Utils.pitchUtils,z=Adagio.Values.TechnicalType,A=Adagio.Values.HammerOnPullOffType,B=Adagio.edit.composite.RemoveHammerOnPullOff,C=Adagio.edit.action.RemoveHammerOnPullOff=function(a,b,c){this.init(a,b,c)};C.NAME="action.RemoveHammerOnPullOff",C.isAuthorizedException=function(a){return a instanceof o||a instanceof p||a instanceof q||a instanceof r||a instanceof m||a instanceof l||a instanceof n||a instanceof s||a instanceof t||a instanceof u};var D=C.prototype;D.name=C.NAME,D.initMeasureData=a,D.init=function(a,e,f){b(a,e),c(a,e),this.initMeasureData(a,e),this.opts=e,
this.cancelStack=f,this.location=null,this.leftNote=null,this.rightNote=null,this.sanitized=!1,d(this.measureData,e),this.crossMeasure=new j(this.measureData,this.opts.voiceIdx,this.opts.noteIdx)},D.performIfPossible=function(){var a=!0;try{this.checkPreconditions()}catch(b){if(!C.isAuthorizedException(b))throw b;a=!1}a&&this.perform()},D.checkPreconditions=function(){this.checkPitchedPart(),this.crossMeasure.checkVoiceIdx(),this.crossMeasure.checkNoteIdx(),this.checkNotRest(),this.checkTabPart(),this.sanitizeIfNeeded(),this.checkPitch(),this.checkNoteAtPitch(),this.checkFretData(),this.checkExistence()},D.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new l},D.checkNotRest=function(){if(this.isLeftRest()||this.isRightRest())throw new m},D.isLeftRest=function(){return this.crossMeasure.isLeftRest()},D.isRightRest=function(){return this.crossMeasure.isRightRest()},D.checkTabPart=function(){e(this.measureData,this.opts)},D.sanitizeIfNeeded=function(){this.sanitized||(void 0!==this.opts.line&&g(this.measureData,this.opts,!0),this.opts.isConcertPitch&&h(this.measureData,this.opts),void 0!==this.opts.fretData&&this.convertExistingFretToPitch(),this.sanitized=!0)},D.convertExistingFretToPitch=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,fretData:v(this.opts.fretData)};this.opts.pitch=i(this.measureData,a)},D.checkPitch=function(){y.check(this.opts.pitch)},D.checkNoteAtPitch=function(){if(void 0===this.getLeftNote()){var a=y.copy(this.opts.pitch);throw new t(t.action.GET,a)}},D.checkFretData=function(){var a=this.getLeftNote();if(!w.hasFretData(a))throw new u(this.opts.pitch)},D.checkExistence=function(){var a=this.getLeftNote(),b=this.getRightNote(),c=this.getTechnicalOpts(A.START),d=this.getTechnicalOpts(A.STOP);if(!w.hasTechnical(a,z.HAMMER_ON,c)&&!w.hasTechnical(a,z.PULL_OFF,c))throw new n;if(!b||!w.hasTechnical(b,z.HAMMER_ON,d)&&!w.hasTechnical(b,z.PULL_OFF,d))throw new n},D.getTechnicalOpts=function(a){return{hammerOnPullOff:x.create(a)}},D.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a=this.getTechnicalType(),b=this.getLeftNote(),c=w.getPitch(b);this.storeAction(c);var d={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,technicalType:a,pitch:y.copy(c)};new B(this.measureData,d,this.cancelStack).perform(),this.updateStack(c)},D.getTechnicalType=function(){var a=this.getLeftNote(),b=this.getTechnicalOpts(A.START);if(w.hasTechnical(a,z.HAMMER_ON,b))return z.HAMMER_ON;if(w.hasTechnical(a,z.PULL_OFF,b))return z.PULL_OFF;throw new k("Unexpected")},D.getLeftNote=function(){if(null===this.leftNote){var a=this.crossMeasure.getLeftChord();this.leftNote=a.find(this.pitchPredicate,this)}return this.leftNote},D.pitchPredicate=function(a){var b=w.getPitch(a);return y.isSameLine(b,this.opts.pitch)},D.getRightNote=function(){if(null===this.rightNote){var a=this.getLeftNote(),b=this.crossMeasure.getRightChord(),c=w.getFretData(a);this.rightNote=b.find(this.stringPredicate,c)}return this.rightNote},D.stringPredicate=function(a){var b=this;if(w.hasFretData(a)){return w.getFretData(a).string===b.string}return!1},D.storeAction=function(a){if(!this.cancelStack.hasAction()){var b=this.getLocation(),c={actionName:this.name,opts:{partUuid:b.partUuid,measureUuid:b.measureUuid,voiceIdx:this.opts.voiceIdx,timePos:b.timePos,divisions:b.dpq,pitch:y.copy(a)}};this.cancelStack.storeAction(c)}},D.updateStack=function(a){var b=this.getLocation(),c={type:this.name,noDraw:!0,opts:{partUuid:b.partUuid,measureUuid:b.measureUuid,voiceIdx:this.opts.voiceIdx,timePos:b.timePos,divisions:b.dpq,pitch:y.copy(a)}};this.cancelStack.push(c)},D.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=this.crossMeasure.getLeftMeasureIdx(),d=a.getMeasureUuid(c),e=this.crossMeasure.getLeftMeasure().getDpqValue(),g=this.crossMeasure.getLeftVoice(),h=this.crossMeasure.getLeftNoteIdx(),i=f(g,h);this.location={partUuid:b,measureUuid:d,dpq:e,timePos:i}}return this.location}}.call(this),function(){"use strict";Adagio.edit.common.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)}}.call(this),function(){"use strict";var a=Adagio.Error.client.NoHammerOnPullOffToRemove,b=Adagio.Error.client.NotPossibleOnUnpitchedError,c=Adagio.Error.client.PitchCollisionError,d=Adagio.Error.client.NoFretDataError,e=Adagio.Utils.clone,f=Adagio.Utils.pitchUtils,g=Adagio.Utils.noteUtils,h=Adagio.edit.action.RemoveHammerOnPullOff,i=Adagio.edit.common.initMeasureData,j=Adagio.edit.common.getVoice,k=Adagio.edit.common.checkTabPart,l=Adagio.edit.common.CrossMeasure,m=Adagio.edit.action.RemoveEdgeHammerOnPullOffs=function(a,b,c){this.init(a,b,c)};m.isAuthorizedException=function(a){return h.isAuthorizedException(a)},m.NAME="action.RemoveEdgeHammerOnPullOffs";var n=m.prototype;n.performIfPossible=function(){this.isPossible()&&this.perform()},n.isPossible=function(){var a=!0;try{this.checkPreconditions()}catch(b){if(!m.isAuthorizedException(b))throw b;a=!1}return a},n.name=m.NAME,n.initMeasureData=i,n.getVoice=j,n.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.untieRight=null,this.untieLeft=null,this.rightAction=null,this.leftAction=null,this.leftNote=null,this.rightNote=null,this.crossMeasure=new l(this.measureData,this.opts.voiceIdx,this.opts.noteIdx-1)},n.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx);var a=this.getVoice();a.checkNoteIdx(this.opts.noteIdx),a.checkNotRest(this.opts.noteIdx),this.checkTabPart(),this.checkPitch(),this.checkNoteAtPitch(),this.checkFretData(),this.checkCanUntie()},n.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new b},n.checkTabPart=function(){k(this.measureData,this.opts)},n.checkPitch=function(){f.check(this.opts.pitch)},n.checkNoteAtPitch=function(){if(void 0===this.getRightNote()){var a=f.copy(this.opts.pitch);throw new c(c.action.GET,a)}},n.checkFretData=function(){var a=this.getRightNote();if(!g.hasFretData(a))throw new d(this.opts.pitch)},n.checkCanUntie=function(){var b=this.canUntieLeft(),c=this.canUntieRight();if(!b&&!c)throw new a("There is nothing to untie")},n.perform=function(){if(this.cancelStack=this.cancelStack.createSubstack(this.name),this.canUntieLeft()){var a=this.getLeftAction();a.cancelStack=this.cancelStack,a.perform()}if(this.canUntieRight()){var b=this.getRightAction();b.cancelStack=this.cancelStack,b.perform()}},n.canUntieRight=function(){if(null===this.untieRight){var a=this.getRightAction();try{a.checkPreconditions(),this.untieRight=!0}catch(a){if(!h.isAuthorizedException(a))throw a;this.untieRight=!1}}return this.untieRight},n.getRightAction=function(){if(null===this.rightAction){var a=this.getRightNote(),b=g.getPitch(a),c=e(this.opts);c.pitch=f.copy(b),this.rightAction=new h(this.measureData,c,this.cancelStack)}return this.rightAction},n.canUntieLeft=function(){if(null===this.untieLeft)try{if(this.crossMeasure.checkLeftVoiceIdx(),this.crossMeasure.checkLeftNoteIdx(),this.crossMeasure.isLeftRest()||!this.getLeftNote())this.untieLeft=!1;else{this.getLeftAction().checkPreconditions(),this.untieLeft=!0}}catch(a){if(!h.isAuthorizedException(a))throw a;this.untieLeft=!1}return this.untieLeft},n.getLeftAction=function(){if(null===this.leftAction){var a=this.getLeftNote(),b=g.getPitch(a),c=e(this.opts);c.pitch=f.copy(b),c.noteIdx--,this.leftAction=new h(this.measureData,c,this.cancelStack)}return this.leftAction},n.getLeftNote=function(){if(null===this.leftNote){var a=this.getRightNote(),b=this.crossMeasure.getLeftChord(),c=g.getFretData(a);this.leftNote=b.find(this.stringPredicate,c)}return this.leftNote},n.stringPredicate=function(a){var b=this;if(g.hasFretData(a)){return g.getFretData(a).string===b.string}return!1},n.getRightNote=function(){if(null===this.rightNote){var a=this.crossMeasure.getRightChord();this.rightNote=a.find(this.pitchPredicate,this)}return this.rightNote},n.pitchPredicate=function(a){var b=g.getPitch(a);return f.isSameLine(b,this.opts.pitch)}}.call(this),function(){"use strict";var a=Adagio.Error.client.MissingOptionError,b=Adagio.Error.value.DoesntHaveFretDataOptsError,c=Adagio.Error.value.BadFretDataOptsError,d=Adagio.Error.client.PitchCollisionError,e=Adagio.Error.client.NoFretFound,f=Adagio.Error.noChange.NoChangeError,g=Adagio.edit.common.convertPartUuidToGetPartIdx,h=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,i=Adagio.edit.common.initMeasureData,j=Adagio.edit.common.convertTimePosToGetNoteIdx,k=Adagio.edit.common.convertPitchToFret,l=Adagio.edit.common.getNoteAtPitch,m=Adagio.edit.primitive.SetFret,n=Adagio.edit.primitive.UnsetFret,o=Adagio.edit.action.RemoveEdgeHammerOnPullOffs,p=Adagio.Utils.pitchUtils,q=Adagio.Utils.technicalUtils,r=Adagio.Utils.staffDetailsUtils,s=Adagio.Utils.noteUtils,t=Adagio.Utils.clone,u=Adagio.Values.TechnicalType,v=Adagio.Values.FretValue,w=Adagio.edit.action.SetFret=function(a,b,c){this.init(a,b,c)};w.isAuthorizedException=function(a){return a instanceof f||a instanceof e},w.NAME="action.SetFret";var x=w.prototype;x.name=w.NAME,x.initMeasureData=i,x.init=function(a,b,c){g(a,b),h(a,b),this.initMeasureData(a,b),this.opts=b,this.cancelStack=c,this.sanitized=!1,this.location=null,j(this.measureData,this.opts)},x.performIfPossible=function(){this.isPossible()&&this.perform()},x.isPossible=function(){var a=!0;try{this.checkPreconditions()}catch(b){if(!w.isAuthorizedException(b))throw b;a=!1}return a},x.checkPreconditions=function(){this.checkLocation(),this.checkPitch(),this.sanitizeIfNeeded(),this.checkNoteAtPitch(),this.checkFretData(),this.checkFretDataOpts(),this.checkExistence()},x.checkLocation=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx);var a=this.getVoice();a.checkNoteIdx(this.opts.noteIdx),a.checkNotRest(this.opts.noteIdx)},x.checkPitch=function(){p.check(this.opts.pitch)},x.sanitizeIfNeeded=function(){this.sanitized||(null!==this.opts.fretData&&(void 0!==this.opts.fretData&&q.hasTechnical(this.opts.fretData,u.FRET)&&q.hasTechnical(this.opts.fretData,u.STRING)||this.convertPitchToFret()),void 0===this.opts.record&&(this.opts.record=!1),this.sanitized=!0)},x.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},x.getNoteAtPitch=function(){var a=this.getVoice();return l(a,this.opts.noteIdx,this.opts.pitch)},x.checkNoteAtPitch=function(){if(void 0===this.getNoteAtPitch()){var a=p.copy(this.opts.pitch);throw new d(d.action.GET,a)}},x.checkFretData=function(){if(void 0===this.opts.fretData)throw new a("fretData");if(null!==this.opts.fretData){if(!q.hasTechnical(this.opts.fretData,u.FRET))throw new b("fret");if(!q.hasTechnical(this.opts.fretData,u.STRING))throw new b("string")}},x.checkFretDataOpts=function(){if(null!==this.opts.fretData){var a=parseInt(this.opts.fretData.fret,10);v.check(a);var b=this.measureData.getScoreData(),d=b.getPartVoiceMainStaffIdx(this.opts.partIdx,this.opts.voiceIdx),e=this.measureData.getStaffDetails(d),f=r.getNbStaffLines(e),g=parseInt(this.opts.fretData.string,10);if(g<1||g>f)throw new c("string")}},x.checkExistence=function(){if(null===this.opts.fretData){var a=this.getNoteAtPitch();if(!s.hasTechnical(a,u.STRING)&&!s.hasTechnical(a,u.FRET))throw new f("No fret to remove")}},x.convertPitchToFret=function(){var a=void 0===this.opts.fretData?null:this.opts.fretData.lastString;k(this.measureData,this.opts,a)},x.getOldFretData=function(){var a=this.getNoteAtPitch();return s.hasTechnical(a,u.STRING)&&s.hasTechnical(a,u.FRET)?{fret:s.getTechnicalContent(a,u.FRET),string:s.getTechnicalContent(a,u.STRING)}:null},x.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a=this.getOldFretData();this.removeConnections(),null!==this.opts.fretData?this.setFret():this.unsetFret(),this.opts.record&&this.updateStack(a)},x.removeConnections=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:p.copy(this.opts.pitch)};new o(this.measureData,a,this.cancelStack).performIfPossible()},x.setFret=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:this.opts.pitch,fretData:this.opts.fretData};new m(this.measureData,a,this.cancelStack).perform()},x.unsetFret=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:this.opts.pitch};new n(this.measureData,a,this.cancelStack).perform()},x.updateStack=function(a){var b=this.getLocation(),c={type:this.name,noDraw:!0,opts:{partUuid:b.partUuid,measureUuid:b.measureUuid,voiceIdx:this.opts.voiceIdx,timePos:b.timePos,divisions:b.dpq,pitch:p.copy(this.opts.pitch),fretData:null!==a?t(a):null}};this.cancelStack.push(c)},x.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,timePos:a.timePos,divisions:a.dpq,pitch:p.copy(this.opts.pitch),fretData:null!==this.opts.fretData?t(this.opts.fretData):null}};this.cancelStack.storeAction(b)}},x.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Utils.typeUtils,b=Adagio.Utils.noteUtils,c=Adagio.Utils.pitchUtils,d=Adagio.edit.action.SetFret,e=Adagio.Values.TechnicalType,f=Adagio.edit.composite.SetChordsFrets=function(a,b,c){this.init(a,b,c)},g=f.prototype;g.init=function(a,b,c){this.measureData=a,this.opts=b,this.cancelStack=c,this.actions=null},g.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},g.perform=function(){this.getSetFretActions().forEach(this.performActionIfPossible)},g.performActionIfPossible=function(a){a.performIfPossible()},g.getSetFretActions=function(){return null===this.actions&&(this.actions=this.getChordsActions()),this.actions},g.getChordsActions=function(){var b=this.getVoice(),c=this.opts.noteIdx;if(!b.isRest(c)){var d=b.getChord(c);return d=a.makeArray(d),this.getChordActions(d,c)}return[]},g.getChordActions=function(a,e){var f=[];return a.forEach(function(a){if(!this.hasFretData(a)){var g=b.getPitch(a),h={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:e,pitch:c.copy(g),record:!0},i=new d(this.measureData,h,this.cancelStack);f.push(i)}},this),f},g.hasFretData=function(a){return b.hasTechnical(a,e.STRING)&&b.hasTechnical(a,e.FRET)}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.TieError=function(b,c){var d="cannot perform tie operation "+b;c&&(d+=": "+c);var e=a.call(this,d);return this.name=e.name="TieError",this.stack=e.stack,this.message=e.message,this.actionName=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}})}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.pitchUtils,c=Adagio.Utils.unpitchedUtils,d=Adagio.Values.Notehead,e=Adagio.Data.tieAction={};e.tieChords=function(a,b,c){e.getUntiedPairs(a,b,c).forEach(e.tiePair)},e.canTieChords=function(a,b,c){return e.getUntiedPairs(a,b,c).length>0},e.getUntiedPairs=function(a,b,c){return f(a,b,c).filter(e.isPairUntied)},e.untieChords=function(a,b,c){e.getTiedPairs(a,b,c).forEach(e.untiePair)},e.canUntieChords=function(a,b,c){return e.getTiedPairs(a,b,c).length>0},e.getTiedPairs=function(a,b,c){return f(a,b,c).filter(e.isPairTied)};var f=function(a,b,c){var d=c?i:h;a=a.slice(),b=b.slice(),a.sort(d),b.sort(d);for(var e=0;e<a.length&&e<b.length;){var f=a[e],j=b[e],k=d(f,j);k>0?b.splice(e,1):k<0?a.splice(e,1):e++}var l;return e<a.length?(l=a.length-e,a.splice(e,l)):e<b.length&&(l=b.length-e,b.splice(e,l)),g(a,b)},g=function(a,b){var c=[];return a.forEach(function(a,d){var e=b[d],f={left:a,right:e};c.push(f)}),c},h=function(c,d){var e=a.getPitch(c),f=a.getPitch(d);return b.naiveComparePitch(e,f)},i=function(b,d){var e=a.getUnpitched(b),f=a.getUnpitched(d),g=c.compare(e,f);return 0!==g?g:j(b,d)},j=function(b,c){var e=a.getHead(b),f=a.getHead(c);return d.getNoteHeadIdx(e)-d.getNoteHeadIdx(f)};e.isPairUntied=function(a){return!e.isPairTied(a)},e.isPairTied=function(a){return e.areNotesTied(a.left,a.right)},e.areNotesTied=function(b,c){return a.hasTieStart(b)&&a.hasTieStop(c)},e.untiePair=function(a){e.untieNotes(a.left,a.right)},e.untieNotes=function(b,c){a.removeTieStart(b),a.removeTieStop(c)},e.tiePair=function(a){e.tieNotes(a.left,a.right)},e.tieNotes=function(b,c){a.addTieStart(b),a.addTieStop(c)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError;Adagio.edit.common.getClef=function(){var b;if(void 0===this.opts.staffIdx){throw new a("NoStaffIdx","Cannot retrieve a clef since no staff idx is provided. ")}return b=this.opts.staffIdx,this.measureData.getClef(b)}}.call(this),function(){"use strict";var a=Adagio.Utils.pitchUtils,b=Adagio.edit.common.getClef;Adagio.edit.common.lineToDestPitch=function(){if(void 0!==this.opts.line){var c=this.getClef||b,d=c.call(this),e=a.lineToPitch(this.opts.line,d);this.opts.octave=e.octave,this.opts.step=e.step,delete this.opts.line}}}.call(this),function(){"use strict";var a=Adagio.Error.client.NotPossibleOnRestsError,b=Adagio.Error.client.PitchCollisionError,c=Adagio.Error.client.TieError,d=Adagio.Error.client.BadPartIdxError,e=Adagio.Error.client.BadMeasureIdxError,f=Adagio.Error.client.BadVoiceError,g=Adagio.Error.client.BadNoteIdxError,h=Adagio.Error.client.NotPossibleOnUnpitchedError,i=Adagio.Utils.noteUtils,j=Adagio.Utils.pitchUtils,k=Adagio.Data.tieAction,l=Adagio.edit.common.CrossMeasure,m=Adagio.edit.common.convertTimePosToGetNoteIdx,n=Adagio.edit.common.noteIdxToTimePos,o=Adagio.edit.common.convertPartUuidToGetPartIdx,p=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,q=Adagio.edit.common.transposePitchLineOpts,r=Adagio.edit.common.initMeasureData,s=Adagio.edit.common.lineToDestPitch,t=Adagio.edit.action.RemoveTieArc=function(a,b,c){this.init(a,b,c)};t.NAME="action.RemoveTieArc",t.isAuthorizedException=function(i){return i instanceof d||i instanceof e||i instanceof f||i instanceof g||i instanceof c||i instanceof a||i instanceof b||i instanceof h};var u=t.prototype;u.name=t.NAME,u.initMeasureData=r,u.lineToDestPitch=s,u.init=function(a,b,c){o(a,b),p(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,m(this.measureData,b),this.lineToDestPitch(),this.opts.isConcertPitch&&(this.opts.pitch=j.copy(this.opts),q(this.measureData,this.opts),this.opts.octave=j.getOctave(this.opts.pitch),this.opts.step=j.getStep(this.opts.pitch)),this.crossMeasure=new l(this.measureData,b.voiceIdx,b.noteIdx),this.location=null},u.checkPreconditions=function(){this.checkPitchedPart(),this.crossMeasure.checkVoiceIdx(),this.crossMeasure.checkNoteIdx(),this.checkNotRest(),this.checkPitch()},u.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new h},u.checkNotRest=function(){if(this.isLeftRest()||this.isRightRest())throw new a},u.isLeftRest=function(){return this.crossMeasure.isLeftRest()},u.isRightRest=function(){return this.crossMeasure.isRightRest()},u.checkPitch=function(){var a,d=this.getLeftChord(),e=this.getRightChord(),f=d.find(this.pitchPredicate,this);if(void 0===f)throw a={msgPrefix:"there is no left note"},new b(a,this.opts);var g=e.find(this.pitchPredicate,this);if(void 0===g)throw a={msgPrefix:"there is no right note"},new b(a,this.opts);var h=i.getPitch(f),l=i.getPitch(g);if(!j.isSamePitch(h,l))throw new c(this.name,"notes must have the same pitch");if(!k.areNotesTied(f,g))throw new c(this.name,"notes are not tied")},u.pitchPredicate=function(a){var b=i.getPitch(a);return j.isSameLine(b,this.opts)},u.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a=this.getLeftChord(),b=a.find(this.pitchPredicate,this),c=i.getPitch(b),d=this.getRightChord(),e=d.find(this.pitchPredicate,this);k.untieNotes(b,e),this.updateStack(c)},u.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,divisions:a.dpq,timePos:a.timePos,voiceIdx:this.opts.voiceIdx,octave:this.opts.octave,step:this.opts.step}};this.cancelStack.storeAction(b)}},u.getLeftChord=function(){return this.crossMeasure.getLeftChord()},u.getRightChord=function(){return this.crossMeasure.getRightChord()},u.updateStack=function(a){this.opts.leftNoteIdx=this.crossMeasure.getLeftNoteIdx(),this.opts.leftMeasureIdx=this.crossMeasure.getLeftMeasureIdx(),this.opts.rightNoteIdx=this.crossMeasure.getRightNoteIdx(),this.opts.rightMeasureIdx=this.crossMeasure.getRightMeasureIdx();var b=this.getLocation(),c={type:this.name,opts:{partIdx:this.opts.partIdx,partUuid:b.partUuid,measureIdx:this.opts.leftMeasureIdx,measureUuid:b.measureUuid,noteIdx:this.opts.leftNoteIdx,timePos:b.timePos,divisions:b.dpq,voiceIdx:this.opts.voiceIdx,pitch:j.copy(a)}};this.cancelStack.push(c);var d={type:this.name+"-close",opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.rightMeasureIdx,noteIdx:this.opts.rightNoteIdx,voiceIdx:this.opts.voiceIdx,pitch:j.copy(a)}};this.cancelStack.push(d)},u.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=this.crossMeasure.getLeftMeasureIdx(),d=a.getMeasureUuid(c),e=this.crossMeasure.getLeftMeasure().getDpqValue(),f=this.crossMeasure.getLeftVoice(),g=this.crossMeasure.getLeftNoteIdx(),h=n(f,g);this.location={partUuid:b,measureUuid:d,dpq:e,timePos:h}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.client.PitchCollisionError,b=Adagio.Error.client.TieError,c=Adagio.Error.client.NotPossibleOnUnpitchedError,d=Adagio.Utils.typeUtils,e=Adagio.Utils.noteUtils,f=Adagio.Utils.pitchUtils,g=Adagio.Utils.clone,h=Adagio.edit.action.RemoveTieArc,i=Adagio.edit.common.initMeasureData,j=Adagio.edit.common.getVoice,k=Adagio.edit.common.lineToDestPitch,l=Adagio.edit.common.transposePitchLineOpts,m=Adagio.edit.action.UntieNoteHead=function(a,b,c){this.init(a,b,c)};m.NAME="action.UntieNoteHead",m.isAuthorizedException=function(a){return h.isAuthorizedException(a)};var n=m.prototype;n.name=m.NAME,n.initMeasureData=i,n.getVoice=j,n.lineToDestPitch=k,n.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.lineToDestPitch(),this.opts.isConcertPitch&&(this.opts.pitch=f.copy(this.opts),l(this.measureData,this.opts),this.opts.octave=f.getOctave(this.opts.pitch),this.opts.step=f.getStep(this.opts.pitch)),this.untieRight=null,this.untieLeft=null,this.rightAction=null,this.leftAction=null},n.performIfPossible=function(){this.isPossible()&&this.perform()},n.isPossible=function(){var a=!0;try{this.checkPreconditions()}catch(b){if(!m.isAuthorizedException(b))throw b;a=!1}return a},n.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx);var a=this.getVoice();a.checkNoteIdx(this.opts.noteIdx),a.checkNotRest(this.opts.noteIdx),this.checkPitch()},n.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new c},n.checkPitch=function(){var c,e=this.getVoice(),f=e.getChord(this.opts.noteIdx);if(f=d.makeArray(f),void 0===f.find(this.pitchPredicate,this))throw c={msgPrefix:"there is no left note"},new a(c,this.opts);var g=this.canUntieLeft(),h=this.canUntieRight();if(!g&&!h)throw new b("There is nothing to untie")},n.pitchPredicate=function(a){var b=e.getPitch(a);return f.isSameLine(b,this.opts)},n.perform=function(){if(this.cancelStack=this.cancelStack.createSubstack(this.name),this.canUntieLeft()){var a=this.getLeftAction();a.cancelStack=this.cancelStack,a.perform()}if(this.canUntieRight()){var b=this.getRightAction();b.cancelStack=this.cancelStack,b.perform()}},n.canUntieRight=function(){if(null===this.untieRight){var a=this.getRightAction();try{a.checkPreconditions(),this.untieRight=!0}catch(a){if(!h.isAuthorizedException(a))throw a;this.untieRight=!1}}return this.untieRight},n.getRightAction=function(){if(null===this.rightAction){var a=g(this.opts);this.rightAction=new h(this.measureData,a,this.cancelStack)}return this.rightAction},n.canUntieLeft=function(){if(null===this.untieLeft){var a=this.getLeftAction();try{a.checkPreconditions(),this.untieLeft=!0}catch(a){if(!h.isAuthorizedException(a))throw a;this.untieLeft=!1}}return this.untieLeft},n.getLeftAction=function(){if(null===this.leftAction){var a=g(this.opts);a.noteIdx--,this.leftAction=new h(this.measureData,a,this.cancelStack)}return this.leftAction}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.NoGlissandoToRemove=function(){var b=c(),d=a.call(this,b);return this.name=d.name="NoGlissandoToRemove",this.stack=d.stack,this.message=d.message,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(){return"There are not glissando notations at this location."}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadGlissandoNumberError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadGlissandoNumberError",this.stack=e.stack,this.message=e.message,this.number=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"The glissando number value ["+a+"] is invalid and should be a number greater than 0."}}.call(this),function(){"use strict";var a=Adagio.edit.common.initMeasureData,b=Adagio.edit.common.getNoteAtPitch,c=Adagio.Utils.glissandoUtils,d=Adagio.Utils.noteUtils,e=Adagio.Utils.pitchUtils,f=Adagio.edit.primitive.RemoveGlissandoSide=function(a,b,c){this.init(a,b,c)};f.NAME="primitive.RemoveGlissandoSide";var g=f.prototype;g.name=f.NAME,g.initMeasureData=a,g.init=function(a,b,c){this.initMeasureData(a,b),this.opts=b,this.cancelStack=c},g.perform=function(){var a=this.getNoteAtPitch();if(d.hasGlissando(a,this.opts.glissandoType,this.opts.number)){var b=c.create(this.opts.glissandoType,this.opts.number);d.removeGlissando(a,b)}this.updateStack()},g.getNoteAtPitch=function(){var a=this.measureData.getVoice(this.opts.voiceIdx);return b(a,this.opts.noteIdx,this.opts.pitch)},g.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:e.copy(this.opts.pitch),glissandoType:this.opts.glissandoType,number:this.opts.number}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.edit.common.initMeasureData,b=Adagio.edit.common.getNoteAtPitch,c=Adagio.Utils.pitchUtils,d=Adagio.edit.common.CrossMeasure,e=Adagio.Values.GlissandoType,f=Adagio.edit.primitive.RemoveGlissandoSide,g=Adagio.edit.composite.RemoveGlissando=function(a,b,c){this.init(a,b,c)};g.NAME="composite.RemoveGlissando";var h=g.prototype;h.name=g.NAME,h.initMeasureData=a,h.init=function(a,b,c){this.initMeasureData(a,b),this.opts=b,this.cancelStack=c,this.crossMeasure=new d(this.measureData,this.opts.voiceIdx,this.opts.noteIdx)},h.getNoteAtPitch=function(a,c,d){return b(a,c,d)},h.getLeftNoteAtPitch=function(){var a=this.crossMeasure.getLeftVoice(),b=this.crossMeasure.getLeftNoteIdx();return this.getNoteAtPitch(a,b,this.opts.leftPitch)},h.getRightNoteAtPitch=function(){var a=this.crossMeasure.getRightVoice(),b=this.crossMeasure.getRightNoteIdx();return this.getNoteAtPitch(a,b,this.opts.rightPitch)},h.perform=function(){this.removeLeftGlissandoSide(),this.removeRightGlissandoSide()},h.removeLeftGlissandoSide=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.crossMeasure.getLeftMeasureIdx(),voiceIdx:this.opts.voiceIdx,noteIdx:this.crossMeasure.getLeftNoteIdx(),pitch:c.copy(this.opts.leftPitch),glissandoType:e.START,number:this.opts.number};new f(this.crossMeasure.getLeftMeasure(),a,this.cancelStack).perform()},h.removeRightGlissandoSide=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.crossMeasure.getRightMeasureIdx(),voiceIdx:this.opts.voiceIdx,noteIdx:this.crossMeasure.getRightNoteIdx(),pitch:c.copy(this.opts.rightPitch),glissandoType:e.STOP,number:this.opts.number};new f(this.crossMeasure.getRightMeasure(),a,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.edit.common.convertPartUuidToGetPartIdx,b=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,c=Adagio.edit.common.convertTimePosToGetNoteIdx,d=Adagio.edit.common.initMeasureData,e=Adagio.edit.common.getNoteAtPitch,f=Adagio.edit.common.noteIdxToTimePos,g=Adagio.Error.client.NotPossibleOnUnpitchedError,h=Adagio.Error.client.PitchCollisionError,i=Adagio.Error.client.NoGlissandoToRemove,j=Adagio.Error.client.NotPossibleOnRestsError,k=Adagio.Error.value.BadGlissandoNumberError,l=Adagio.Utils.pitchUtils,m=Adagio.Utils.noteUtils,n=Adagio.edit.common.CrossMeasure,o=Adagio.Values.GlissandoType,p=Adagio.edit.composite.RemoveGlissando,q=Adagio.edit.action.RemoveGlissando=function(a,b,c){this.init(a,b,c)};q.NAME="action.RemoveGlissando";var r=q.prototype;r.name=q.NAME,r.initMeasureData=d,r.init=function(d,e,f){a(d,e),b(d,e),this.initMeasureData(d,e),this.opts=e,this.cancelStack=f,this.location=null,this.sanitized=!1,c(this.measureData,e),this.crossMeasure=new n(this.measureData,this.opts.voiceIdx,this.opts.noteIdx)},r.checkPreconditions=function(){this.checkPitchedPart(),this.crossMeasure.checkVoiceIdx(),this.checkNoteIdx(),this.checkNotRest(),this.checkPitchs(),this.checkNotesAtPitch(),this.sanitizeIfNeeded(),this.checkNumber(),this.checkExistence()},r.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new g},r.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},r.checkNoteIdx=function(){this.crossMeasure.checkNoteIdx()},r.isLeftRest=function(){return this.crossMeasure.isLeftRest()},r.isRightRest=function(){return this.crossMeasure.isRightRest()},r.checkNotRest=function(){if(this.isLeftRest()||this.isRightRest())throw new j},r.checkPitchs=function(){l.check(this.opts.leftPitch),l.check(this.opts.rightPitch)},r.checkPitch=function(a){l.check(a)},r.checkNotesAtPitch=function(){var a=this.getLeftNoteAtPitch(),b=this.getRightNoteAtPitch();if(void 0===a){var c=l.copy(this.opts.leftPitch);throw new h(h.action.GET,c)}if(void 0===b){var d=l.copy(this.opts.rightPitch);throw new h(h.action.GET,d)}},r.getNoteAtPitch=function(a,b,c){return e(a,b,c)},r.getLeftNoteAtPitch=function(){var a=this.crossMeasure.getLeftVoice(),b=this.crossMeasure.getLeftNoteIdx();return this.getNoteAtPitch(a,b,this.opts.leftPitch)},r.getRightNoteAtPitch=function(){var a=this.crossMeasure.getRightVoice(),b=this.crossMeasure.getRightNoteIdx();return this.getNoteAtPitch(a,b,this.opts.rightPitch)},r.sanitizeIfNeeded=function(){this.sanitized||(void 0===this.opts.number&&(this.opts.number=1),this.sanitized=!0)},r.checkNumber=function(){if("number"!=typeof this.opts.number||this.opts.number<0)throw new k(this.opts.number)},r.checkExistence=function(){var a=this.getLeftNoteAtPitch(),b=this.getRightNoteAtPitch();if(!m.hasGlissando(a,o.START,this.opts.number)&&!m.hasGlissando(b,o.STOP,this.opts.number))throw new i},r.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,leftPitch:l.copy(this.opts.leftPitch),rightPitch:l.copy(this.opts.rightPitch),number:this.opts.number};new p(this.measureData,a,this.cancelStack).perform(),this.updateStack()},r.updateStack=function(){var a=this.getLocation(),b={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,
measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,timePos:a.timePos,divisions:a.dpq,leftPitch:l.copy(this.opts.leftPitch),rightPitch:l.copy(this.opts.rightPitch),number:this.opts.number}};this.cancelStack.push(b)},r.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,timePos:a.timePos,divisions:a.dpq,leftPitch:l.copy(this.opts.leftPitch),rightPitch:l.copy(this.opts.rightPitch),number:this.opts.number}};this.cancelStack.storeAction(b)}},r.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=this.crossMeasure.getLeftMeasureIdx(),d=a.getMeasureUuid(c),e=this.crossMeasure.getLeftMeasure().getDpqValue(),g=this.crossMeasure.getLeftVoice(),h=this.crossMeasure.getLeftNoteIdx(),i=f(g,h);this.location={partUuid:b,measureUuid:d,dpq:e,timePos:i}}return this.location}}.call(this),function(){"use strict";var a=Adagio.edit.common.initMeasureData,b=Adagio.edit.common.getNoteAtPitch,c=Adagio.edit.common.CrossMeasure,d=Adagio.Utils.pitchUtils,e=Adagio.Utils.noteUtils,f=Adagio.Utils.glissandoUtils,g=Adagio.Values.GlissandoType,h=Adagio.edit.action.RemoveGlissando,i=Adagio.edit.composite.RemoveHeadGlissandos=function(a,b,c){this.init(a,b,c)};i.NAME="composite.RemoveHeadGlissandos";var j=i.prototype;j.name=i.NAME,j.initMeasureData=a,j.init=function(a,b,d){this.initMeasureData(a,b),this.opts=b,this.cancelStack=d,this.crossMeasure=new c(this.measureData,b.voiceIdx,b.noteIdx)},j.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},j.getNoteAtPitch=function(){var a=this.getVoice();return b(a,this.opts.noteIdx,this.opts.pitch)},j.getRightChord=function(){return this.crossMeasure.getRightChord()},j.getRemoveAction=function(a,b,c){var e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,leftPitch:d.copy(a),rightPitch:d.copy(b),number:c};return new h(this.measureData,e,this.cancelStack)},j.reduceGlissandoStops=function(a,b){return e.getGlissandosType(b,g.STOP).forEach(function(c){var d=f.getNumber(c);void 0===a[d]&&(a[d]=e.getPitch(b))}),a},j.getActions=function(){var a=this.getNoteAtPitch(),b=this.getRightChord(),c=e.getGlissandosType(a,g.START),d=b.reduce(this.reduceGlissandoStops,{}),h=[];return c.forEach(function(b){var c=f.getNumber(b);if(void 0!==d[c]){var g=e.getPitch(a),i=d[c];h.push(this.getRemoveAction(g,i,c))}},this),h},j.perform=function(){this.getActions().forEach(this.performAction)},j.performAction=function(a){a.checkPreconditions(),a.perform()}}.call(this),function(){"use strict";var a=Adagio.edit.common.convertPartUuidToGetPartIdx,b=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,c=Adagio.edit.common.initMeasureData,d=Adagio.edit.common.convertTimePosToGetNoteIdx,e=Adagio.edit.common.noteIdxToTimePos,f=Adagio.edit.common.convertLineToPitch,g=Adagio.edit.common.transposePitchLineOpts,h=Adagio.edit.common.getNoteAtPitch,i=Adagio.edit.common.CrossMeasure,j=Adagio.Error.client.NotPossibleOnUnpitchedError,k=Adagio.Error.client.NotPossibleOnRestsError,l=Adagio.Error.client.NoGlissandoToRemove,m=Adagio.Error.client.BadNoteIdxError,n=Adagio.Error.client.PitchCollisionError,o=Adagio.Error.client.BadPartIdxError,p=Adagio.Error.client.BadMeasureIdxError,q=Adagio.Error.client.BadVoiceError,r=Adagio.Utils.pitchUtils,s=Adagio.Utils.noteUtils,t=Adagio.Values.GlissandoType,u=Adagio.edit.composite.RemoveHeadGlissandos,v=Adagio.edit.action.RemoveHeadGlissandos=function(a,b,c){this.init(a,b,c)};v.NAME="action.RemoveHeadGlissandos",v.isAuthorizedException=function(a){return a instanceof j||a instanceof k||a instanceof m||a instanceof l||a instanceof o||a instanceof p||a instanceof q};var w=v.prototype;w.name=v.NAME,w.initMeasureData=c,w.init=function(c,e,f){a(c,e),b(c,e),this.initMeasureData(c,e),this.opts=e,this.cancelStack=f,this.sanitized=!1,this.location=null,d(this.measureData,e),this.crossMeasure=new i(this.measureData,e.voiceIdx,e.noteIdx)},w.isPossible=function(){try{this.checkPreconditions()}catch(a){if(v.isAuthorizedException(a))return!1;throw a}return!0},w.performIfPossible=function(){this.isPossible()&&this.perform()},w.checkPreconditions=function(){this.checkPitchedPart(),this.crossMeasure.checkVoiceIdx(),this.checkNoteIdx(),this.checkNotRest(),this.sanitizeIfNeeded(),this.checkPitch(),this.checkNoteAtPitch(),this.checkExistence()},w.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new j},w.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},w.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},w.checkNotRest=function(){if(this.isLeftRest()||this.isRightRest())throw new k},w.isLeftRest=function(){return this.crossMeasure.isLeftRest()},w.isRightRest=function(){return this.crossMeasure.isRightRest()},w.sanitizeIfNeeded=function(){this.sanitized||(void 0!==this.opts.line&&f(this.measureData,this.opts,!0),this.opts.isConcertPitch&&g(this.measureData,this.opts),this.sanitized=!1)},w.checkPitch=function(){r.check(this.opts.pitch)},w.checkNoteAtPitch=function(){if(void 0===this.getNoteAtPitch()){var a=r.copy(this.opts.pitch);throw new n(n.action.GET,a)}},w.getNoteAtPitch=function(){var a=this.getVoice();return h(a,this.opts.noteIdx,this.opts.pitch)},w.checkExistence=function(){var a=this.getNoteAtPitch();if(!s.hasGlissandoType(a,t.START))throw new l},w.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:r.copy(this.opts.pitch)};new u(this.measureData,a,this.cancelStack).perform(),this.updateStack()},w.updateStack=function(){var a=this.getLocation(),b={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,timePos:a.timePos,divisions:a.dpq,pitch:r.copy(this.opts.pitch)}};this.cancelStack.push(b)},w.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,timePos:a.timePos,divisions:a.dpq,pitch:r.copy(this.opts.pitch)}};this.cancelStack.storeAction(b)}},w.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=this.crossMeasure.getLeftMeasureIdx(),d=a.getMeasureUuid(c),f=this.crossMeasure.getLeftMeasure().getDpqValue(),g=this.crossMeasure.getLeftVoice(),h=this.crossMeasure.getLeftNoteIdx(),i=e(g,h);this.location={partUuid:b,measureUuid:d,dpq:f,timePos:i}}return this.location}}.call(this),function(){"use strict";var a=Adagio.edit.common.convertPartUuidToGetPartIdx,b=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,c=Adagio.edit.common.initMeasureData,d=Adagio.edit.common.convertTimePosToGetNoteIdx,e=Adagio.edit.common.getNoteAtPitch,f=Adagio.edit.common.convertLineToPitch,g=Adagio.edit.common.transposePitchLineOpts,h=Adagio.Error.client.NotPossibleOnUnpitchedError,i=Adagio.Error.client.NotPossibleOnRestsError,j=Adagio.Error.client.BadNoteIdxError,k=Adagio.Error.client.NoGlissandoToRemove,l=Adagio.Error.client.PitchCollisionError,m=Adagio.Error.client.BadPartIdxError,n=Adagio.Error.client.BadMeasureIdxError,o=Adagio.Error.client.BadVoiceError,p=Adagio.Utils.noteUtils,q=Adagio.Utils.glissandoUtils,r=Adagio.Utils.pitchUtils,s=Adagio.Values.GlissandoType,t=Adagio.edit.action.RemoveHeadGlissandos,u=Adagio.edit.common.CrossMeasure,v=Adagio.edit.action.RemoveHeadEdgeGlissandos=function(a,b,c){this.init(a,b,c)};v.NAME="action.RemoveHeadEdgeGlissandos",v.isAuthorizedException=function(a){return a instanceof h||a instanceof i||a instanceof j||a instanceof k||a instanceof m||a instanceof n||a instanceof o};var w=v.prototype;w.name=v.NAME,w.initMeasureData=c,w.init=function(c,e,f){a(c,e),b(c,e),this.initMeasureData(c,e),this.opts=e,this.cancelStack=f,this.location=null,this.leftActions=null,this.canRemoveLeft=null,this.rightAction=null,this.canRemoveRight=null,this.sanitized=!1,d(this.measureData,e),this.crossMeasure=new u(this.measureData,e.voiceIdx,e.noteIdx-1)},w.performIfPossible=function(){var a=!0;try{this.checkPreconditions()}catch(b){if(!v.isAuthorizedException(b))throw b;a=!1}a&&this.perform()},w.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkNoteIdx(),this.checkNotRest(),this.sanitizeIfNeeded(),this.checkNoteAtPitch(),this.checkCanRemoveHeadGlissandos()},w.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new h},w.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},w.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},w.checkNotRest=function(){if(this.getVoice().isRest(this.opts.noteIdx))throw new i},w.getNoteAtPitch=function(){var a=this.getVoice();return e(a,this.opts.noteIdx,this.opts.pitch)},w.sanitizeIfNeeded=function(){this.sanitized||(void 0!==this.opts.line&&f(this.measureData,this.opts,!0),this.opts.isConcertPitch&&g(this.measureData,this.opts),this.sanitized=!1)},w.checkNoteAtPitch=function(){if(void 0===this.getNoteAtPitch()){var a=r.copy(this.opts.pitch);throw new l(l.action.GET,a)}},w.checkCanRemoveHeadGlissandos=function(){var a=this.canRemoveLeftGlissandos(),b=this.canRemoveRightGlissandos();if(!a&&!b)throw new k},w.canRemoveLeftGlissandos=function(){if(null===this.canRemoveLeft)if(0===this.opts.measureIdx&&0===this.opts.noteIdx)this.canRemoveLeft=!1;else{var a=this.getLeftActions();this.canRemoveLeft=a.some(this.isActionPossible)}return this.canRemoveLeft},w.canRemoveRightGlissandos=function(){if(null===this.canRemoveRight){var a=this.getRightAction();this.canRemoveRight=a.isPossible()}return this.canRemoveRight},w.getLeftActions=function(){if(null===this.leftActions){var a=this.getNoteAtPitch(),b=p.getGlissandosType(a,s.STOP),c=[];b.forEach(function(a){var b=q.getNumber(a);c.push(this.getLeftAction(b))},this),this.leftActions=c}return this.leftActions},w.getLeftAction=function(a){var b=this.getLeftPitch(a),c={partIdx:this.opts.partIdx,measureIdx:this.crossMeasure.getLeftMeasureIdx(),voiceIdx:this.opts.voiceIdx,noteIdx:this.crossMeasure.getLeftNoteIdx(),pitch:r.copy(b)};return new t(this.measureData,c,this.cancelStack)},w.getRightAction=function(){if(null===this.rightAction){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:r.copy(this.opts.pitch)};this.rightAction=new t(this.measureData,a,this.cancelStack)}return this.rightAction},w.getLeftPitch=function(a){var b=this.crossMeasure.getLeftChord(),c=null;return b.forEach(function(b){p.hasGlissando(b,s.START,a)&&(c=p.getPitch(b))}),c},w.perform=function(){if(this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.canRemoveLeftGlissandos()){this.getLeftActions().forEach(this.performActionIfPossible)}if(this.canRemoveRightGlissandos()){this.getRightAction().perform()}this.updateStack()},w.isActionPossible=function(a){return a.isPossible()},w.performActionIfPossible=function(a){a.performIfPossible()},w.updateStack=function(){var a=this.getLocation(),b={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,timePos:a.timePos,divisions:a.dpq,pitch:r.copy(this.opts.pitch)}};this.cancelStack.push(b)},w.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,timePos:a.timePos,divisions:a.dpq,pitch:r.copy(this.opts.pitch)}};this.cancelStack.storeAction(b)}},w.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Utils.arpeggiateUtils={};a.DEFAULT_DIRECTION="up",a.copy=function(b){var c=a.create();if(a.hasNumber(b)){var d=a.getNumber(b);a.setNumber(c,d)}if(a.hasDisplayedDirection(b)){var e=a.getDirection(b);a.setDisplayedDirection(c,e)}return c},a.create=function(){return{}},a.getNumber=function(b){return a.hasNumber(b)?parseInt(b.$number,10)-1:0},a.hasNumber=function(a){return void 0!==a.$number},a.setNumber=function(a,b){a.$number=(b+1).toString()},a.getDirection=function(b){return a.hasDisplayedDirection(b)?b.$direction:a.DEFAULT_DIRECTION},a.hasDisplayedDirection=function(a){return void 0!==a.$direction},a.setDisplayedDirection=function(a,b){a.$direction=b}}.call(this),function(){"use strict";var a=Adagio.Utils.typeUtils,b=Adagio.Utils.noteUtils,c=Adagio.edit.common.initMeasureData,d=Adagio.edit.primitive.RemoveArpeggio=function(a,b,c){this.init(a,b,c)};d.NAME="primitive.RemoveArpeggio";var e=d.prototype;e.name=d.NAME,e.initMeasureData=c,e.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeArpeggio(),this.updateStack()},e.removeArpeggio=function(){var c=this.getVoice(),d=c.getChord(this.opts.noteIdx);d=a.makeArray(d),d.forEach(b.removeArpeggiate)},e.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},e.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.Error.noChange.NoChangeError,b=Adagio.Error.client.NotPossibleOnUnpitchedError,c=Adagio.Error.client.BadPartIdxError,d=Adagio.Error.client.BadMeasureIdxError,e=Adagio.Error.client.BadNoteIdxError,f=Adagio.Error.client.BadVoiceError,g=Adagio.Utils.noteUtils,h=Adagio.edit.common.convertTimePosToGetNoteIdx,i=Adagio.edit.common.convertPartUuidToGetPartIdx,j=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,k=Adagio.edit.common.initMeasureData,l=Adagio.edit.primitive.RemoveArpeggio,m=Adagio.edit.action.RemoveArpeggio=function(a,b,c){this.init(a,b,c)};m.NAME="action.RemoveArpeggio",m.isAuthorizedException=function(g){return g instanceof c||g instanceof d||g instanceof f||g instanceof e||g instanceof a||g instanceof b},m.isNoChange=function(b){return b instanceof a};var n=m.prototype;n.initMeasureData=k,n.name=m.NAME,n.init=function(a,b,c){i(a,b),j(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,h(this.measureData,this.opts),this.location=null},n.performIfPossible=function(){this.isPossible()&&this.perform()},n.isPossible=function(){var a=!0;try{this.checkPreconditions()}catch(b){if(!m.isAuthorizedException(b))throw b;a=!1}return a},n.checkPreconditions=function(){this.checkPitchedPart(),this.checkLocation(),this.checkUsage()},n.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new b},n.checkLocation=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.measureData.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},n.checkUsage=function(){var b=this.measureData.getVoice(this.opts.voiceIdx),c=b.getNote(this.opts.noteIdx);if(!g.hasArpeggiate(c)){throw new a("There is no arpeggio at this location.")}},n.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),void 0===this.opts.record&&(this.opts.record=!0),this.storeAction(),this.removeArpeggio(),this.updateStack()},n.removeArpeggio=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new l(this.measureData,a,this.cancelStack).perform()},n.updateStack=function(){var a=this.getLocation(),b={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos}};this.cancelStack.push(b)},n.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos}};this.cancelStack.storeAction(b)}},n.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location},n.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.edit.common.initMeasureData,c=Adagio.edit.common.getNoteAtPitch,d=Adagio.edit.primitive.RemoveCourtesyAccidental=function(a,b,c){this.init(a,b,c)};d.NAME="primitive.RemoveCourtesyAccidental";var e=d.prototype;e.name=d.NAME,e.initMeasureData=b,e.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},e.perform=function(){this.removeCourtesyAccidental(),this.updateStack()},e.removeCourtesyAccidental=function(){var b=this.measureData.getVoice(this.opts.voiceIdx),d=c(b,this.opts.noteIdx,this.opts.pitch);a.removeCourtesyAccidental(d)},e.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.Error.noChange.NoChangeError,b=Adagio.Error.client.NotPossibleOnUnpitchedError,c=Adagio.Error.client.PitchCollisionError,d=Adagio.Utils.noteUtils,e=Adagio.Utils.pitchUtils,f=Adagio.edit.primitive.RemoveCourtesyAccidental,g=Adagio.edit.common.getNoteAtPitch,h=Adagio.edit.common.checkOptsPitch,i=Adagio.edit.common.convertLineToPitch,j=Adagio.edit.common.convertTimePosToGetNoteIdx,k=Adagio.edit.common.convertPartUuidToGetPartIdx,l=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,m=Adagio.edit.common.transposePitchLineOpts,n=Adagio.edit.common.initMeasureData,o=Adagio.edit.action.RemoveCourtesyAccidental=function(a,b,c){this.init(a,b,c)};o.NAME="action.RemoveCourtesyAccidentals",o.isNoChange=function(b){return b instanceof a};var p=o.prototype;p.name=o.NAME,p.initMeasureData=n,p.init=function(a,b,c){k(a,b),l(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.noteHead=null,this.voice=null,this.location=null},p.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),j(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),this.checkValues(),this.sanitizeIfNeeded(),this.checkNoteAtPitch(),this.checkCourtesy()},p.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new b},p.checkValues=function(){h(this.opts)},p.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},p.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},p.sanitizeIfNeeded=function(){void 0!==this.opts.line&&i(this.measureData,this.opts,!0),this.opts.isConcertPitch&&m(this.measureData,this.opts)},p.checkNoteAtPitch=function(){if(void 0===this.getNoteAtPitch()){var a=e.copy(this.opts.pitch);throw new c(c.action.GET,a)}},p.checkCourtesy=function(){var b=this.getNoteAtPitch();if(!d.hasCourtesyAccidental(b))throw new a},p.getNoteAtPitch=function(){if(null===this.noteHead){var a=this.getVoice();this.noteHead=g(a,this.opts.noteIdx,this.opts.pitch)}return this.noteHead},p.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.removeCourtesyAccidental(),this.updateStack()},p.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos,pitch:e.copyWithoutAlter(this.opts.pitch),isConcertPitch:!1},c={actionName:this.name,opts:b};this.cancelStack.storeAction(c)}},p.removeCourtesyAccidental=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:e.copy(this.opts.pitch)};new f(this.measureData,a,this.cancelStack).perform()},p.updateStack=function(){var a=this.getLocation(),b={partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos,pitch:e.copyWithoutAlter(this.opts.pitch)},c={type:this.name,noDraw:!0,opts:b};this.cancelStack.push(c)},p.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.getVoice(),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f,isConcertPitch:!1}}return this.location},p.getVoice=function(){return null===this.voice&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.edit.common.initMeasureData,c=Adagio.edit.common.getNoteAtPitch,d=Adagio.edit.primitive.RemoveGhostNote=function(a,b,c){this.init(a,b,c)};d.NAME="primitive.RemoveGhostNote";var e=d.prototype;e.name=d.NAME,e.initMeasureData=b,e.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},e.perform=function(){this.removeGhostNote(),this.updateStack()},e.removeGhostNote=function(){var b=this.measureData.getVoice(this.opts.voiceIdx),d=c(b,this.opts.noteIdx,this.opts.pitch);a.removeHeadParentheses(d)},e.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.Error.noChange.NoChangeError,b=Adagio.Error.client.NotPossibleOnUnpitchedError,c=Adagio.Error.client.PitchCollisionError,d=Adagio.Utils.noteUtils,e=Adagio.Utils.pitchUtils,f=Adagio.edit.primitive.RemoveGhostNote,g=Adagio.edit.common.getNoteAtPitch,h=Adagio.edit.common.checkOptsPitch,i=Adagio.edit.common.convertLineToPitch,j=Adagio.edit.common.convertTimePosToGetNoteIdx,k=Adagio.edit.common.convertPartUuidToGetPartIdx,l=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,m=Adagio.edit.common.transposePitchLineOpts,n=Adagio.edit.common.initMeasureData,o=Adagio.edit.action.RemoveGhostNote=function(a,b,c){this.init(a,b,c)};o.NAME="action.RemoveGhostNotes",o.isNoChange=function(b){return b instanceof a};var p=o.prototype;p.name=o.NAME,p.initMeasureData=n,p.init=function(a,b,c){k(a,b),l(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.sanitized=!1,this.noteHead=null,this.voice=null,this.location=null},p.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),j(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),this.checkValues(),this.sanitizeIfNeeded(),this.checkPitch(),this.checkNoteAtPitch(),this.checkGhost()},p.checkValues=function(){h(this.opts)},p.checkPitch=function(){e.check(this.opts.pitch)},p.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new b},p.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},p.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},p.checkNoteAtPitch=function(){if(void 0===this.getNoteAtPitch()){var a=e.copy(this.opts.pitch);throw new c(c.action.GET,a)}},p.checkGhost=function(){var b=this.getNoteAtPitch();if(!d.hasHeadParentheses(b))throw new a},p.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),j(this.measureData,this.opts),this.sanitizeIfNeeded(),this.storeAction(),this.removeGhostNote(),this.updateStack()},p.sanitizeIfNeeded=function(){this.sanitized||(void 0!==this.opts.line&&i(this.measureData,this.opts,!0),this.opts.isConcertPitch&&m(this.measureData,this.opts),this.checkNoteAtPitch(),this.sanitized=!0)},p.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos,pitch:e.copyWithoutAlter(this.opts.pitch)},c={actionName:this.name,opts:b};this.cancelStack.storeAction(c)}},p.removeGhostNote=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:e.copy(this.opts.pitch)};new f(this.measureData,a,this.cancelStack).perform()},p.getNoteAtPitch=function(){if(null===this.noteHead){var a=this.getVoice();this.noteHead=g(a,this.opts.noteIdx,this.opts.pitch)}return this.noteHead},p.updateStack=function(){var a=this.getLocation(),b={partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos,pitch:e.copyWithoutAlter(this.opts.pitch)},c={type:this.name,noDraw:!0,opts:b};this.cancelStack.push(c)},p.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location},p.getVoice=function(){return null===this.voice&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.edit.common.getNoteAtPitch,c=Adagio.edit.common.initMeasureData,d=Adagio.edit.primitive.RemoveFingering=function(a,b,c){this.init(a,b,c)};d.NAME="primitive.RemoveFingering";var e=d.prototype;e.initMeasureData=c,e.name=d.NAME,e.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},e.perform=function(){this.removeFingering(),this.updateStack()},e.removeFingering=function(){var c=this.measureData.getVoice(this.opts.voiceIdx),d=b(c,this.opts.noteIdx,this.opts.pitch);a.removeFingering(d)},e.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.Error.noChange.NoChangeError,b=Adagio.Error.client.NotPossibleOnUnpitchedError,c=Adagio.Error.client.PitchCollisionError,d=Adagio.Utils.noteUtils,e=Adagio.Utils.pitchUtils,f=Adagio.edit.primitive.RemoveFingering,g=Adagio.edit.common.getNoteAtPitch,h=Adagio.edit.common.checkOptsPitch,i=Adagio.edit.common.convertLineToPitch,j=Adagio.edit.common.convertTimePosToGetNoteIdx,k=Adagio.edit.common.convertPartUuidToGetPartIdx,l=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,m=Adagio.edit.common.transposePitchLineOpts,n=Adagio.edit.common.initMeasureData,o=Adagio.edit.action.RemoveFingering=function(a,b,c){this.init(a,b,c)};o.NAME="action.RemoveFingerings",o.isNoChange=function(b){return b instanceof a};var p=o.prototype;p.name=o.NAME,p.initMeasureData=n,p.init=function(a,b,c){k(a,b),l(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.noteHead=null,this.voice=null,this.location=null},p.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),j(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),this.checkValues(),this.sanitizeIfNeeded(),this.checkNoteAtPitch(),this.checkFingering()},p.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new b},p.checkValues=function(){h(this.opts)},p.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},p.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},p.sanitizeIfNeeded=function(){void 0!==this.opts.line&&i(this.measureData,this.opts,!0),this.opts.isConcertPitch&&m(this.measureData,this.opts)},p.checkNoteAtPitch=function(){if(void 0===this.getNoteAtPitch()){var a=e.copy(this.opts.pitch);throw new c(c.action.GET,a)}},p.checkFingering=function(){var b=this.getNoteAtPitch();if(!d.hasFingering(b))throw new a},p.getNoteAtPitch=function(){if(null===this.noteHead){var a=this.getVoice();this.noteHead=g(a,this.opts.noteIdx,this.opts.pitch)}return this.noteHead},p.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a=this.getPreviousData();this.removeFingering(),this.updateStack(a)},p.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos,pitch:e.copyWithoutAlter(this.opts.pitch),isConcertPitch:!1},c={actionName:this.name,opts:b};this.cancelStack.storeAction(c)}},p.getPreviousData=function(){var a=this.getNoteAtPitch();return{fingering:d.getFingering(a)}},p.removeFingering=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:e.copy(this.opts.pitch)};new f(this.measureData,a,this.cancelStack).perform()},p.updateStack=function(a){var b=this.getLocation(),c={partUuid:b.partUuid,measureUuid:b.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:b.dpq,timePos:b.timePos,pitch:e.copyWithoutAlter(this.opts.pitch),fingering:a.fingering},d={type:this.name,noDraw:!0,opts:c};this.cancelStack.push(d)},p.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.getVoice(),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f,isConcertPitch:!1}}return this.location},p.getVoice=function(){return null===this.voice&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Error.client.ClientError,c=Adagio.Error.value.ValueError,d=Adagio.Error.noChange.NoChangeError,e=Adagio.edit.common.assertPerform=function(a,b){b=b||f;var c=!0;try{a.checkPreconditions()}catch(d){if(!b(d)){if(!g(d))throw d;h(a,d)}c=!1}return c&&a.perform(),c},f=function(){return!1},g=function(a){return a instanceof b||a instanceof d||a instanceof c},h=e.requalifyException=function(b,c){var d="Error while performing action ["+b.name+"]: "+c.message,e=new a(d);throw e.cause=c,e.actionName=b.name,e}}.call(this),function(){"use strict";var a=Adagio.Error.noChange.NoChangeError,b=Adagio.Utils.pitchUtils,c=Adagio.Utils.typeUtils,d=Adagio.Utils.noteUtils,e=Adagio.Utils.measureUtils,f=Adagio.edit.primitive.RemoveFromChord,g=Adagio.edit.composite.UpdateAccidental,h=Adagio.edit.composite.SetChordsFrets,i=Adagio.edit.action.UntieNoteHead,j=Adagio.edit.action.RemoveHeadEdgeGlissandos,k=Adagio.edit.action.RemoveArpeggio,l=Adagio.edit.action.RemoveEdgeHammerOnPullOffs,m=Adagio.edit.action.RemoveCourtesyAccidental,n=Adagio.edit.action.RemoveGhostNote,o=Adagio.edit.action.RemoveFingering,p=Adagio.edit.common.initMeasureData,q=Adagio.edit.common.getNoteAtPitch,r=Adagio.edit.common.assertPerform,s=Adagio.edit.composite.RemoveFromChord=function(a,b,c){this.init(a,b,c)};s.NAME="composite.RemoveFromChord";var t=s.prototype;t.name=s.NAME,t.initMeasureData=p,t.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.voice=null,this.chordHead=null},t.perform=function(){this.cancelStack=this.cancelStack.createSubstack();var a=this.getPreviousData();this.removeTie(),this.removeHammerOnPullOffs(),this.removeCourtesyAccidental(),this.removeGhostNote(),this.removeFingering(),this.removeGlissandos(),this.removeArpeggioIfNeeded(),this.removeFromChord(),this.updateAccidental(a),this.isTab()&&this.updateChordsFrets()},t.getPreviousData=function(){var a=this.getChordHead();return{staffIdx:d.getStaffIdx(a)}},t.getChordHead=function(){if(null===this.chordHead){var a=this.getVoice();this.chordHead=q(a,this.opts.noteIdx,this.opts.pitch)}return this.chordHead},t.getVoice=function(){return null===this.voice&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},t.removeTie=function(){var a={partIdx:this.opts.partIdx,
measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,step:b.getStep(this.opts.pitch),octave:b.getOctave(this.opts.pitch)};new i(this.measureData,a,this.cancelStack).performIfPossible()},t.removeHammerOnPullOffs=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:b.copy(this.opts.pitch)};new l(this.measureData,a,this.cancelStack).performIfPossible()},t.removeCourtesyAccidental=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:b.copy(this.opts.pitch)},c=new m(this.measureData,a,this.cancelStack);r(c,u)};var u=function(b){return b instanceof a};t.removeGhostNote=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:b.copy(this.opts.pitch)},c=new n(this.measureData,a,this.cancelStack);r(c,u)},t.removeFingering=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:b.copy(this.opts.pitch)},c=new o(this.measureData,a,this.cancelStack);r(c,u)},t.removeGlissandos=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:b.copy(this.opts.pitch)};new j(this.measureData,a,this.cancelStack).performIfPossible()},t.removeArpeggioIfNeeded=function(){var a=this.getVoice(),b=a.getChord(this.opts.noteIdx);if(b=c.makeArray(b),2===b.length){var d={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new k(this.measureData,d,this.cancelStack).performIfPossible()}},t.removeFromChord=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:b.copy(this.opts.pitch)};new f(this.measureData,a,this.cancelStack).perform()},t.updateAccidental=function(a){var c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:a.staffIdx,noteIdx:this.opts.noteIdx,pitch:b.copy(this.opts.pitch)};new g(this.measureData,c,this.cancelStack).perform()},t.isTab=function(){var a=this.measureData.getMeasure();return e.isTab(a)},t.updateChordsFrets=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new h(this.measureData,a,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.client.NotPossibleOnUnpitchedError,b=Adagio.Error.client.PitchCollisionError,c=Adagio.Error.client.NotPossibleOnSingleNoteError,d=Adagio.Utils.pitchUtils,e=Adagio.Utils.timeModifUtils,f=Adagio.Utils.clone,g=Adagio.Utils.noteUtils,h=Adagio.Utils.typeUtils,i=Adagio.edit.composite.RemoveFromChord,j=Adagio.edit.common.checkOptsPitch,k=Adagio.edit.common.convertLineToPitch,l=Adagio.edit.common.getNoteAtPitch,m=Adagio.edit.common.transposePitchLineOpts,n=Adagio.edit.common.convertPartUuidToGetPartIdx,o=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,p=Adagio.edit.common.convertTimePosToGetNoteIdx,q=Adagio.edit.common.extractNoteDurationType,r=Adagio.edit.common.initMeasureData,s=Adagio.edit.action.RemoveFromChord=function(a,b,c){this.init(a,b,c)};s.NAME="action.RemoveFromChord";var t=s.prototype;t.name=s.NAME,t.initMeasureData=r,t.init=function(a,b,c){n(a,b),o(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.sanitized=!1,this.voice=null,this.location=null,p(this.measureData,this.opts)},t.checkPreconditions=function(){j(this.opts),this.sanitizeIfNeeded(),this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkNoteIdx(),this.checkNotRest(),this.checkSingleNote(),this.checkPitch()},t.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new a},t.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},t.getVoice=function(){return null===this.voice&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},t.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},t.checkPitch=function(){this.sanitizeIfNeeded();var a=this.getVoice();if(void 0===l(a,this.opts.noteIdx,this.opts.pitch)){var c=d.copy(this.opts.pitch);throw new b(b.action.GET,c)}},t.checkSingleNote=function(){if(!this.getVoice().isChord(this.opts.noteIdx))throw new c},t.perform=function(){this.sanitizeIfNeeded(),this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a;this.opts.record&&(a=this.getPreviousData()),this.removeFromChord(),this.opts.record&&this.updateCancelStack(a)},t.sanitizeIfNeeded=function(){this.sanitized||(void 0!==this.opts.line&&k(this.measureData,this.opts,!0),this.opts.isConcertPitch&&m(this.measureData,this.opts),void 0===this.opts.record&&(this.opts.record=!0),this.sanitized=!0)},t.getPreviousData=function(){var a=this.getVoice(),b=l(a,this.opts.noteIdx,this.opts.pitch),c=g.getStaffIdx(b),f=g.getPitch(b),h=d.getAlter(f),i=d.alterToAccidental(h),j=this.measureData.getDpqValue(),k=q(b,j),m=g.getNbDots(b),n=g.getTimeModif(b),o={staffIdx:c,accidental:i,durationType:k,nbDots:m,timeModif:e.copy(n)};return g.hasTabData(b)&&(o.fretData=this.extractFretData(b)),o},t.extractFretData=function(a){var b=g.getTabData(a);b=f(b);var c=this.getVoice(),d=c.getChord(this.opts.noteIdx);return d=h.makeArray(d),d=d.filter(u,b),d.length>1&&(b.lastString=b.string),b};var u=function(a){return!!g.hasTabData(a)&&g.getString(a)===this.string};t.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,timePos:a.timePos,divisions:a.dpq,pitch:d.copyWithoutAlter(this.opts.pitch)}};this.cancelStack.storeAction(b)}},t.removeFromChord=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:d.copy(this.opts.pitch)};new i(this.measureData,a,this.cancelStack).perform()},t.updateCancelStack=function(a){var b=this.getLocation(),c={partUuid:b.partUuid,measureUuid:b.measureUuid,voiceIdx:this.opts.voiceIdx,staffIdx:a.staffIdx,timePos:b.timePos,divisions:b.dpq,pitch:d.copyWithoutAlter(this.opts.pitch),accidental:a.accidental,nbDots:a.nbDots,durationType:a.durationType,timeModif:e.copy(a.timeModif)};void 0!==a.fretData&&(c.fretData=f(a.fretData));var g={noDraw:!0,type:this.name,opts:c};this.cancelStack.push(g)},t.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.pitchUtils,c=Adagio.edit.common.extractNoteDurationType,d=Adagio.edit.common.initMeasureData,e=Adagio.edit.primitive.RemoveSingleNote=function(a,b,c){this.init(a,b,c)};e.NAME="primitive.RemoveSingleNote";var f=e.prototype;f.name=e.NAME,f.initMeasureData=d,f.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},f.perform=function(){var a=this.getVoice(),b=a.getNote(this.opts.noteIdx);a.removeNote(this.opts.noteIdx),this.updateStack(b)},f.getVoice=function(){var a=this.opts.voiceIdx,b=this.opts.noteIdx;return this.measureData.getVoiceOrTupletForGet(a,b)},f.updateStack=function(c){var d=this.getDurationType(c),e=a.getPitch(c),f=g(c),h={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,noteIdx:this.opts.noteIdx,voiceIdx:this.opts.voiceIdx,staffIdx:a.getStaffIdx(c),durationType:d,nbDots:a.getNbDots(c),pitch:b.copy(e),accidental:f}};this.cancelStack.push(h)};var g=function(b){return a.hasAccidental(b)?a.getAccidental(b):null};f.getDurationType=function(a){var b=this.measureData.getDivisionsPerQuarterValue();return c(a,b)}}.call(this),function(){"use strict";var a=Adagio.Error.client.NotPossibleOnRestsError,b=Adagio.Error.client.TieError,c=Adagio.Error.client.BadPartIdxError,d=Adagio.Error.client.BadMeasureIdxError,e=Adagio.Error.client.BadNoteIdxError,f=Adagio.Error.client.NotPossibleOnUnpitchedError,g=Adagio.Error.client.BadVoiceError,h=Adagio.Utils.noteUtils,i=Adagio.Utils.pitchUtils,j=Adagio.Data.tieAction,k=Adagio.edit.action.RemoveTieArc,l=Adagio.edit.common.CrossMeasure,m=Adagio.edit.common.noteIdxToTimePos,n=Adagio.edit.common.convertPartUuidToGetPartIdx,o=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,p=Adagio.edit.common.convertTimePosToGetNoteIdx,q=Adagio.edit.common.initMeasureData,r=Adagio.edit.action.RemoveTie=function(a,b,c){this.init(a,b,c)};r.NAME="action.RemoveTie",r.isAuthorizedException=function(h){return h instanceof c||h instanceof d||h instanceof b||h instanceof a||h instanceof e||h instanceof f||h instanceof g};var s=r.prototype;s.name=r.NAME,s.initMeasureData=q,s.init=function(a,b,c){n(a,b),o(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,p(this.measureData,b),this.crossMeasure=new l(this.measureData,b.voiceIdx,b.noteIdx),this.location=null},s.performIfPossible=function(){var a=!0;try{this.checkPreconditions()}catch(b){if(!r.isAuthorizedException(b))throw b;a=!1}a&&this.perform()},s.checkPreconditions=function(){this.checkPitchedPart(),this.crossMeasure.checkVoiceIdx(),this.crossMeasure.checkNoteIdx(),this.checkNotRest(),this.checkCanUntie()},s.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new f},s.checkNotRest=function(){if(this.isLeftRest()||this.isRightRest())throw new a},s.isLeftRest=function(){return this.crossMeasure.isLeftRest()},s.isRightRest=function(){return this.crossMeasure.isRightRest()},s.checkCanUntie=function(){var a=this.getLeftChord(),c=this.getRightChord();if(!j.canUntieChords(a,c))throw new b(this.name,"nothing can be tied")},s.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a=this.getLeftChord(),b=a.filter(h.hasTieStart).map(h.getPitch),c=this.getRightChord();j.untieChords(a,c),this.updateStack(b)},s.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,divisions:a.dpq,timePos:a.timePos,voiceIdx:this.opts.voiceIdx}};this.cancelStack.storeAction(b)}},s.getLeftChord=function(){return this.crossMeasure.getLeftChord()},s.getRightChord=function(){return this.crossMeasure.getRightChord()},s.updateStack=function(a){this.opts.leftNoteIdx=this.crossMeasure.getLeftNoteIdx(),this.opts.leftMeasureIdx=this.crossMeasure.getLeftMeasureIdx(),this.opts.rightNoteIdx=this.crossMeasure.getRightNoteIdx(),this.opts.rightMeasureIdx=this.crossMeasure.getRightMeasureIdx();var b=this.getLocation();a.forEach(function(a){var c={type:k.NAME,opts:{partIdx:this.opts.partIdx,partUuid:b.partUuid,measureIdx:this.opts.leftMeasureIdx,measureUuid:b.measureUuid,noteIdx:this.opts.leftNoteIdx,timePos:b.timePos,divisions:b.dpq,voiceIdx:this.opts.voiceIdx,pitch:i.copy(a)}};this.cancelStack.push(c);var d={type:k.NAME+"-close",opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.rightMeasureIdx,noteIdx:this.opts.rightNoteIdx,voiceIdx:this.opts.voiceIdx,pitch:i.copy(a)}};this.cancelStack.push(d)},this)},s.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=this.crossMeasure.getLeftMeasureIdx(),d=a.getMeasureUuid(c),e=this.crossMeasure.getLeftMeasure().getDpqValue(),f=this.crossMeasure.getLeftVoice(),g=this.crossMeasure.getLeftNoteIdx(),h=m(f,g);this.location={partUuid:b,measureUuid:d,dpq:e,timePos:h}}return this.location}}.call(this),function(){"use strict";var a=Adagio.edit.common.initMeasureData,b=Adagio.Utils.typeUtils,c=Adagio.Utils.noteUtils,d=Adagio.Utils.hammerOnPullOffUtils,e=Adagio.Utils.pitchUtils,f=Adagio.Values.TechnicalType,g=Adagio.Values.HammerOnPullOffType,h=Adagio.edit.action.RemoveHammerOnPullOff,i=Adagio.edit.composite.RemoveHammerOnPullOffs=function(a,b,c){this.init(a,b,c)};i.NAME="composite.RemoveHammerOnPullOffs";var j=i.prototype;j.name=i.NAME,j.initMeasureData=a,j.init=function(a,b,c){this.initMeasureData(a,b),this.opts=b,this.cancelStack=c},j.perform=function(){var a=this.getVoice(),d=a.getChord(this.opts.noteIdx);d=b.makeArray(d);var e=this.getTechnicalOpts(g.START);d.forEach(function(a){if(c.hasTechnical(a,f.HAMMER_ON,e)||c.hasTechnical(a,f.PULL_OFF,e)){var b=c.getPitch(a);this.removeHammerOnPullOff(b)}},this)},j.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},j.getTechnicalOpts=function(a){return{hammerOnPullOff:d.create(a)}},j.removeHammerOnPullOff=function(a){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:e.copy(a)},c=new h(this.measureData,b,this.cancelStack);c.checkPreconditions(),c.perform()}}.call(this),function(){"use strict";var a=Adagio.edit.common.initMeasureData,b=Adagio.edit.common.convertPartUuidToGetPartIdx,c=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,d=Adagio.edit.common.convertTimePosToGetNoteIdx,e=Adagio.edit.common.checkTabPart,f=Adagio.edit.common.noteIdxToTimePos,g=Adagio.Error.client.NotPossibleOnUnpitchedError,h=Adagio.Error.client.NoHammerOnPullOffToRemove,i=Adagio.Error.client.NotPossibleOnRestsError,j=Adagio.Utils.noteUtils,k=Adagio.Utils.hammerOnPullOffUtils,l=Adagio.Values.TechnicalType,m=Adagio.Values.HammerOnPullOffType,n=Adagio.edit.composite.RemoveHammerOnPullOffs,o=Adagio.edit.action.RemoveHammerOnPullOff,p=Adagio.edit.common.CrossMeasure,q=Adagio.edit.action.RemoveHammerOnPullOffs=function(a,b,c){this.init(a,b,c)};q.NAME="action.RemoveHammerOnPullOffs";var r=q.prototype;r.name=q.NAME,r.initMeasureData=a,r.init=function(a,e,f){b(a,e),c(a,e),this.initMeasureData(a,e),this.opts=e,this.cancelStack=f,this.location=null,d(this.measureData,e),this.crossMeasure=new p(this.measureData,this.opts.voiceIdx,this.opts.noteIdx)},r.performIfPossible=function(){var a=!0;try{this.checkPreconditions()}catch(b){if(!o.isAuthorizedException(b))throw b;a=!1}a&&this.perform()},r.checkPreconditions=function(){this.checkPitchedPart(),this.crossMeasure.checkVoiceIdx(),this.crossMeasure.checkNoteIdx(),this.checkNotRest(),this.checkTabPart(),this.checkExistence()},r.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new g},r.checkNotRest=function(){if(this.crossMeasure.isLeftRest()||this.crossMeasure.isRightRest())throw new i},r.checkTabPart=function(){e(this.measureData,this.opts)},r.checkExistence=function(){var a=this.crossMeasure.getLeftChord(),b=this.getTechnicalOpts(m.START);if(!a.some(function(a){return j.hasTechnical(a,l.HAMMER_ON,b)||j.hasTechnical(a,l.PULL_OFF,b)}))throw new h},r.getTechnicalOpts=function(a){return{hammerOnPullOff:k.create(a)}},r.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a={partIdx:this.opts.partIdx,measureIdx:this.crossMeasure.getLeftMeasureIdx(),voiceIdx:this.opts.voiceIdx,noteIdx:this.crossMeasure.getLeftNoteIdx()};new n(this.crossMeasure.getLeftMeasure(),a,this.cancelStack).perform(),this.updateStack()},r.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,timePos:a.timePos,divisions:a.dpq}};this.cancelStack.storeAction(b)}},r.updateStack=function(){var a=this.getLocation(),b={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,timePos:a.timePos,divisions:a.dpq}};this.cancelStack.push(b)},r.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=this.crossMeasure.getLeftMeasureIdx(),d=a.getMeasureUuid(c),e=this.crossMeasure.getLeftMeasure().getDpqValue(),g=this.crossMeasure.getLeftVoice(),h=this.crossMeasure.getLeftNoteIdx(),i=f(g,h);this.location={partUuid:b,measureUuid:d,dpq:e,timePos:i}}return this.location}}.call(this),function(){"use strict";var a=Adagio.edit.common.initMeasureData,b=Adagio.edit.common.CrossMeasure,c=Adagio.Utils.pitchUtils,d=Adagio.Utils.noteUtils,e=Adagio.Utils.mapUtils,f=Adagio.Utils.glissandoUtils,g=Adagio.Values.GlissandoType,h=Adagio.edit.action.RemoveGlissando,i=Adagio.edit.composite.RemoveGlissandos=function(a,b,c){this.init(a,b,c)};i.NAME="composite.RemoveGlissandos";var j=i.prototype;j.name=i.NAME,j.initMeasureData=a,j.init=function(a,c,d){this.initMeasureData(a,c),this.opts=c,this.cancelStack=d,this.crossMeasure=new b(this.measureData,c.voiceIdx,c.noteIdx)},j.getLeftChord=function(){return this.crossMeasure.getLeftChord()},j.getRightChord=function(){return this.crossMeasure.getRightChord()},j.getRemoveAction=function(a,b,d){var e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,leftPitch:c.copy(a),rightPitch:c.copy(b),number:parseInt(d,10)};return new h(this.measureData,e,this.cancelStack)},j.getActions=function(){var a=this.getGlissandos(),b=[];return e.forEach(a,function(a,c){b.push(this.getRemoveAction(c.leftPitch,c.rightPitch,a))},this),b},j.getGlissandos=function(){var a=this.getLeftChord(),b=this.getRightChord(),c={};return a.forEach(function(a){d.getGlissandosType(a,g.START).forEach(function(b){var e=f.getNumber(b);void 0===c[e]&&(c[e]={leftPitch:d.getPitch(a)})})}),b.forEach(function(b,e){d.getGlissandosType(b,g.STOP).forEach(function(g){var h=f.getNumber(g);if(void 0===c[h]){var i=e>=a.length?a[a.length-1]:a[e];c[h]={leftPitch:d.getPitch(i)}}c[h].rightPitch=d.getPitch(b)})}),c},j.perform=function(){this.getActions().forEach(this.performAction)},j.performAction=function(a){a.checkPreconditions(),a.perform()}}.call(this),function(){"use strict";var a=Adagio.edit.common.convertPartUuidToGetPartIdx,b=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,c=Adagio.edit.common.initMeasureData,d=Adagio.edit.common.convertTimePosToGetNoteIdx,e=Adagio.edit.common.noteIdxToTimePos,f=Adagio.edit.common.CrossMeasure,g=Adagio.Error.client.NotPossibleOnUnpitchedError,h=Adagio.Error.client.NotPossibleOnRestsError,i=Adagio.Error.client.NoGlissandoToRemove,j=Adagio.Error.client.BadVoiceError,k=Adagio.Error.client.BadNoteIdxError,l=Adagio.Error.client.BadPartIdxError,m=Adagio.Error.client.BadMeasureIdxError,n=Adagio.Utils.noteUtils,o=Adagio.Values.GlissandoType,p=Adagio.edit.composite.RemoveGlissandos,q=Adagio.edit.action.RemoveGlissandos=function(a,b,c){this.init(a,b,c)};q.NAME="action.RemoveGlissandos",q.isAuthorizedException=function(a){return a instanceof g||a instanceof h||a instanceof j||a instanceof k||a instanceof i||a instanceof l||a instanceof m};var r=q.prototype;r.name=q.NAME,r.initMeasureData=c,r.init=function(c,e,g){a(c,e),b(c,e),this.initMeasureData(c,e),this.opts=e,this.cancelStack=g,this.location=null,d(this.measureData,e),this.crossMeasure=new f(this.measureData,e.voiceIdx,e.noteIdx)},r.isPossible=function(){try{this.checkPreconditions()}catch(a){if(q.isAuthorizedException(a))return!1;throw a}return!0},r.performIfPossible=function(){this.isPossible()&&this.perform()},r.checkPreconditions=function(){this.checkPitchedPart(),this.crossMeasure.checkVoiceIdx(),this.checkNoteIdx(),this.checkNotRest(),this.checkExistence()},r.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new g},r.checkNoteIdx=function(){this.crossMeasure.checkNoteIdx()},r.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},r.checkNotRest=function(){if(this.isLeftRest()||this.isRightRest())throw new h},r.isLeftRest=function(){return this.crossMeasure.isLeftRest()},r.isRightRest=function(){return this.crossMeasure.isRightRest()},r.checkExistence=function(){var a=this.getLeftChord(),b=this.getRightChord();if(!a.some(function(a){return n.hasGlissandoType(a,o.START)})&&!b.some(function(a){return n.hasGlissandoType(a,o.STOP)}))throw new i},r.getLeftChord=function(){return this.crossMeasure.getLeftChord()},r.getRightChord=function(){return this.crossMeasure.getRightChord()},r.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new p(this.measureData,a,this.cancelStack).perform(),this.updateStack()},r.updateStack=function(){var a=this.getLocation(),b={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,timePos:a.timePos,divisions:a.dpq}};this.cancelStack.push(b)},r.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,timePos:a.timePos,divisions:a.dpq}};this.cancelStack.storeAction(b)}},r.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=this.crossMeasure.getLeftMeasureIdx(),d=a.getMeasureUuid(c),f=this.crossMeasure.getLeftMeasure().getDpqValue(),g=this.crossMeasure.getLeftVoice(),h=this.crossMeasure.getLeftNoteIdx(),i=e(g,h);this.location={partUuid:b,measureUuid:d,dpq:f,timePos:i}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.BeamError=function(b){var c="cannot perform beam operation: "+b,d=a.call(this,c);return this.name=d.name="BeamError",this.stack=d.stack,this.message=d.message,this.actionName=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}})}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.attributesUtils,c=Adagio.Utils.timeModifUtils,d=Adagio.Data.beamAction={};d.canBeam=function(c,d,f){if(!e(c,d))return!1;var g=b.getDivisions(f);return!a.hasTupletStop(c)&&(!a.hasTupletStart(d)&&(a.canHoldFlag(c,g)&&a.canHoldFlag(d,g)))};var e=function(b,d){var e=a.getTimeModif(b),f=a.getTimeModif(d);return c.isSame(e,f)};d.areBeamed=function(b,c){return a.hasForwardBeam(b)&&a.hasBackwardBeam(c)},d.beam=function(c,d,e){var f=b.getDivisions(e);a.isBeamEnd(c)?a.makeBeamContinue(c,f):a.makeBeamBegin(c,f),a.isBeamBegin(d)?a.makeBeamContinue(d,f):a.makeBeamEnd(d,f)},d.unbeam=function(c,d,e){var f=b.getDivisions(e);a.isBeamContinue(c)?a.makeBeamEnd(c,f):a.makeUnbeamed(c,f),a.isBeamContinue(d)?a.makeBeamBegin(d,f):a.makeUnbeamed(d,f)}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils;Adagio.Data.beam.createBeamEntry=function(b,c){return{nbBeams:a.calcNbBeams(b,c),left:[],right:[]}}}.call(this),function(){"use strict";Adagio.Data.beam.fillEntryConnections=function(c,d,e){a(d,c),b(d,e)};var a=function(a,b){for(var c=0;c<a.nbBeams;c++)null!==b&&c<b.nbBeams?a.left.push(!0):a.left.push(!1)},b=function(a,b){for(var c=0;c<a.nbBeams;c++)null!==b&&c<b.nbBeams?a.right.push(!0):a.right.push(!1)}}.call(this),function(){"use strict";var a=Adagio.Values.BeamType,b=Adagio.Utils.beamUtils,c=Adagio.Error.InternalError;Adagio.Data.beam.createNoteBeams=function(a){for(var c=[],e=null,f=0;f<a.nbBeams;f++){var g=d(a,f,e);e=g;var h=b.create(f,g);c.push(h)}return c};var d=function(b,d,f){if(!0===b.left[d]&&!0===b.right[d])return a.CONTINUE;if(!0===b.left[d]&&!1===b.right[d])return a.END;if(!1===b.left[d]&&!0===b.right[d])return a.BEGIN;if(!1===b.left[d]&&!1===b.right[d])return e(f);throw new c("Unreachable")},e=function(b){if(b===a.BEGIN||b===a.FORWARD)return a.FORWARD;if(b===a.END||b===a.BACKWARD)return a.BACKWARD;if(b===a.CONTINUE)return a.FORWARD;if(null===b){throw new c("Unexpected","Cannot have ")}a.raiseError(b)}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Data.beam.createBeamEntry,c=Adagio.Data.beam.fillEntryConnections,d=Adagio.Data.beam.createNoteBeams;Adagio.Data.beam.removeBeamSegment=function(a,b,c,d,g){e(a,b,g),f(c,d,g)};var e=function(c,d,e){if(null===c)a.makeUnbeamed(d);else{var f=b(c,e),h=b(d,e);g(d,f,h,null)}},f=function(c,d,e){if(null===d)a.makeUnbeamed(c);else{var f=b(c,e),h=b(d,e);g(c,null,f,h)}},g=function(b,e,f,g){c(e,f,g);var h=d(f);a.setBeams(b,h)}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadPartIdxError,b=Adagio.Error.client.BadMeasureIdxError,c=Adagio.Error.client.BadVoiceError,d=Adagio.Error.client.BadNoteIdxError,e=Adagio.Error.client.BeamError,f=Adagio.Data.beamAction,g=Adagio.Data.beam.removeBeamSegment,h=Adagio.Utils.noteUtils,i=Adagio.edit.common.initMeasureData,j=Adagio.edit.action.RemoveBeamEdge=function(a,b,c){this.init(a,b,c)};j.NAME="action.RemoveBeamEdge",j.isAuthorizedException=function(f){return f instanceof a||f instanceof b||f instanceof c||f instanceof d||f instanceof e};var k=j.prototype;k.initMeasureData=i,k.name=j.NAME,k.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},k.performIfPossible=function(){this.isPossible()&&this.perform()},k.isPossible=function(){var a=!0;try{this.checkPreconditions()}catch(b){if(!j.isAuthorizedException(b))throw b;a=!1}return a},k.checkPreconditions=function(){this.checkLocation(),this.checkBeamable()},k.checkLocation=function(){var a=this.getVoice();a.checkNoteIdx(this.opts.noteIdx),a.checkNoteIdx(this.opts.noteIdx+1)},k.checkBeamable=function(){var a=this.getVoice(),b=this.measureData.getAttributes(),c=a.getNote(this.opts.noteIdx),d=a.getNote(this.opts.noteIdx+1);if(!f.canBeam(c,d,b)||!f.areBeamed(c,d))throw new e(this.name)},k.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},k.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeBeam(),this.updateStack()},k.removeBeam=function(){var a=this.getVoiceOrTuplet(),b=a.getNote(this.opts.noteIdx),c=a.getNote(this.opts.noteIdx+1),d=this.getPreviousLeft(),e=this.getNextRight(),f=this.getDpq();g(d,b,c,e,f)},k.getPreviousLeft=function(){var a=this.getVoiceOrTuplet(),b=a.getStartNoteIdx();if(this.opts.noteIdx===b)return null;var c=a.getNote(this.opts.noteIdx-1);if(h.isRest(c))return null;var d=this.getDpq();return h.canHoldFlag(c,d)&&h.hasForwardBeam(c)?c:null},k.getNextRight=function(){var a=this.getVoiceOrTuplet(),b=a.getStopNoteIdx();if(this.opts.noteIdx+1===b)return null;var c=a.getNote(this.opts.noteIdx+2);if(h.isRest(c))return null;var d=this.getDpq();return h.canHoldFlag(c,d)&&h.hasBackwardBeam(c)?c:null},k.getVoiceOrTuplet=function(){return this.measureData.getVoiceOrTupletForGet(this.opts.voiceIdx,this.opts.noteIdx)},k.getDpq=function(){return this.measureData.getDpqValue()},k.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,noteIdx:this.opts.noteIdx,voiceIdx:this.opts.voiceIdx}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=["partIdx","measureIdx","staffIdx","voiceIdx","noteIdx","groupRest","insertMode"];Adagio.edit.common.copyOpts=function(b){var c={};return a.forEach(function(a){a in b&&(c[a]=b[a])}),c}}.call(this),function(){"use strict";var a=Adagio.Data.beamAction,b=Adagio.edit.common.getVoice;Adagio.edit.common.canUnbeamForward=function(){var c=this.getVoice||b,d=c.call(this);if(this.opts.noteIdx===d.getStopNoteIdx())return!1;var e=d.getNote(this.opts.noteIdx),f=d.getNote(this.opts.noteIdx+1);return a.areBeamed(e,f)}}.call(this),function(){"use strict";var a=Adagio.Data.beamAction,b=Adagio.edit.common.getVoice;Adagio.edit.common.canUnbeamBackward=function(){if(0===this.opts.noteIdx)return!1;var c=this.getVoice||b,d=c.call(this),e=d.getNote(this.opts.noteIdx-1),f=d.getNote(this.opts.noteIdx);return a.areBeamed(e,f)}}.call(this),function(){"use strict";var a=Adagio.edit.common.canUnbeamForward,b=Adagio.edit.common.canUnbeamBackward;Adagio.edit.common.canUnbeamNote=function(){var c=this.canUnbeamForward||a;return(this.canUnbeamBackward||b).call(this)||c.call(this)}}.call(this),function(){"use strict";var a=Adagio.Error.client.BeamError,b=Adagio.edit.action.RemoveBeamEdge,c=Adagio.edit.common.copyOpts,d=Adagio.edit.common.initMeasureData,e=Adagio.edit.common.getVoice,f=Adagio.edit.common.canUnbeamNote,g=Adagio.edit.common.canUnbeamForward,h=Adagio.edit.common.canUnbeamBackward,i=Adagio.edit.action.UnbeamNote=function(a,b,c){this.init(a,b,c)};i.NAME="action.UnbeamNote",i.isAuthorizedException=function(b){return b instanceof a};var j=i.prototype;j.initMeasureData=d,j.getVoice=e,j.canUnbeamNote=f,j.canUnbeamForward=g,j.canUnbeamBackward=h,j.name=i.NAME,j.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},j.performIfPossible=function(){this.isPossible()&&this.perform()},j.isPossible=function(){var a=!0;try{this.checkPreconditions()}catch(b){if(!i.isAuthorizedException(b))throw b;a=!1}return a},j.checkPreconditions=function(){this.checkLocation(),this.checkBeamable()},j.checkLocation=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},j.checkBeamable=function(){if(!this.canUnbeamNote())throw new a(this.name)},j.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.canUnbeamBackward()&&this.unbeamBackward(),this.canUnbeamForward()&&this.unbeamForward()},j.unbeamBackward=function(){var a=c(this.opts);a.noteIdx=this.opts.noteIdx-1,new b(this.measureData,a,this.cancelStack).perform()},j.unbeamForward=function(){var a=c(this.opts);new b(this.measureData,a,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.client.TieError,b=Adagio.Error.client.NotPossibleOnUnpitchedError,c=Adagio.Utils.clone,d=Adagio.edit.action.RemoveTie,e=Adagio.edit.common.initMeasureData,f=Adagio.edit.common.getVoice,g=Adagio.edit.action.UntieNote=function(a,b,c){this.init(a,b,c)};g.isAuthorizedException=function(a){return d.isAuthorizedException(a)},g.NAME="action.UntieNote";var h=g.prototype;h.performIfPossible=function(){this.isPossible()&&this.perform()},h.isPossible=function(){var a=!0;try{this.checkPreconditions()}catch(b){if(!g.isAuthorizedException(b))throw b;a=!1}return a},h.name=g.NAME,h.initMeasureData=e,h.getVoice=f,h.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.untieRight=null,this.untieLeft=null,this.rightAction=null,this.leftAction=null},h.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx);var a=this.getVoice();a.checkNoteIdx(this.opts.noteIdx),a.checkNotRest(this.opts.noteIdx),this.checkCanUntie()},h.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new b},h.checkCanUntie=function(){var b=this.canUntieLeft(),c=this.canUntieRight();if(!b&&!c)throw new a("There is nothing to untie")},h.perform=function(){if(this.cancelStack=this.cancelStack.createSubstack(this.name),this.canUntieLeft()){var a=this.getLeftAction();a.cancelStack=this.cancelStack,a.perform()}if(this.canUntieRight()){var b=this.getRightAction();b.cancelStack=this.cancelStack,b.perform()}},h.canUntieRight=function(){if(null===this.untieRight){var a=this.getRightAction();try{a.checkPreconditions(),this.untieRight=!0}catch(a){if(!d.isAuthorizedException(a))throw a;this.untieRight=!1}}return this.untieRight},h.getRightAction=function(){if(null===this.rightAction){var a=c(this.opts);this.rightAction=new d(this.measureData,a,this.cancelStack)}return this.rightAction},h.canUntieLeft=function(){if(null===this.untieLeft){var a=this.getLeftAction();try{a.checkPreconditions(),this.untieLeft=!0}catch(a){if(!d.isAuthorizedException(a))throw a;this.untieLeft=!1}}return this.untieLeft},h.getLeftAction=function(){if(null===this.leftAction){var a=c(this.opts);a.noteIdx--,this.leftAction=new d(this.measureData,a,this.cancelStack)}return this.leftAction}}.call(this),function(){"use strict"
;var a=Adagio.edit.common.convertPartUuidToGetPartIdx,b=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,c=Adagio.edit.common.initMeasureData,d=Adagio.edit.common.convertTimePosToGetNoteIdx,e=Adagio.Error.client.NotPossibleOnUnpitchedError,f=Adagio.Error.client.NotPossibleOnRestsError,g=Adagio.Error.client.BadNoteIdxError,h=Adagio.Error.client.NoGlissandoToRemove,i=Adagio.Error.client.BadVoiceError,j=Adagio.edit.action.RemoveGlissandos,k=Adagio.edit.action.RemoveEdgeGlissandos=function(a,b,c){this.init(a,b,c)};k.NAME="action.RemoveEdgeGlissandos",k.isAuthorizedException=function(a){return a instanceof e||a instanceof f||a instanceof g||a instanceof h||a instanceof i};var l=k.prototype;l.name=k.NAME,l.initMeasureData=c,l.init=function(c,e,f){a(c,e),b(c,e),this.initMeasureData(c,e),this.opts=e,this.cancelStack=f,this.location=null,this.leftAction=null,this.canRemoveLeft=null,this.rightAction=null,this.canRemoveRight=null,d(this.measureData,e)},l.performIfPossible=function(){var a=!0;try{this.checkPreconditions()}catch(b){if(!k.isAuthorizedException(b))throw b;a=!1}a&&this.perform()},l.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkNoteIdx(),this.checkNotRest(),this.checkCanRemoveGlissandos()},l.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new e},l.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},l.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},l.checkNotRest=function(){if(this.getVoice().isRest(this.opts.noteIdx))throw new f},l.checkCanRemoveGlissandos=function(){var a=this.canRemoveLeftGlissandos(),b=this.canRemoveRightGlissandos();if(!a&&!b)throw new h},l.canRemoveLeftGlissandos=function(){if(null===this.canRemoveLeft){var a=this.getLeftAction();this.canRemoveLeft=a.isPossible()}return this.canRemoveLeft},l.canRemoveRightGlissandos=function(){if(null===this.canRemoveRight){var a=this.getRightAction();this.canRemoveRight=a.isPossible()}return this.canRemoveRight},l.getLeftAction=function(){if(null===this.leftAction){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx-1};this.leftAction=new j(this.measureData,a,this.cancelStack)}return this.leftAction},l.getRightAction=function(){if(null===this.rightAction){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};this.rightAction=new j(this.measureData,a,this.cancelStack)}return this.rightAction},l.perform=function(){if(this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.canRemoveLeftGlissandos()){this.getLeftAction().perform()}if(this.canRemoveRightGlissandos()){this.getRightAction().perform()}this.updateStack()},l.updateStack=function(){var a=this.getLocation(),b={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,timePos:a.timePos,divisions:a.dpq}};this.cancelStack.push(b)},l.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,timePos:a.timePos,divisions:a.dpq}};this.cancelStack.storeAction(b)}},l.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Data.beam.createBeamEntry,c=Adagio.Data.beam.fillEntryConnections,d=Adagio.Data.beam.createNoteBeams;Adagio.Data.beam.addBeamSegment=function(a,b,c,d,f){e(a,b,c,f),e(b,c,d,f)};var e=function(a,c,d,e){var g=null===a?null:b(a,e),h=b(c,e),i=null===d?null:b(d,e);f(c,g,h,i)},f=function(b,e,f,g){c(e,f,g);var h=d(f);a.setBeams(b,h)}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadPartIdxError,b=Adagio.Error.client.BadMeasureIdxError,c=Adagio.Error.client.BadVoiceError,d=Adagio.Error.client.BadNoteIdxError,e=Adagio.Error.client.BeamError,f=Adagio.Data.beamAction,g=Adagio.Data.beam.addBeamSegment,h=Adagio.Utils.noteUtils,i=Adagio.edit.common.initMeasureData,j=Adagio.edit.action.AddBeamEdge=function(a,b,c){this.init(a,b,c)};j.isAuthorizedException=function(f){return f instanceof a||f instanceof b||f instanceof c||f instanceof d||f instanceof e},j.NAME="action.AddBeamEdge";var k=j.prototype;k.initMeasureData=i,k.name=j.NAME,k.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},k.performIfPossible=function(){this.isPossible()&&this.perform()},k.isPossible=function(){var a=!0;try{this.checkPreconditions()}catch(b){if(!j.isAuthorizedException(b))throw b;a=!1}return a},k.checkPreconditions=function(){this.checkLocation(),this.checkBeamable()},k.checkLocation=function(){var a=this.getVoice();a.checkNoteIdx(this.opts.noteIdx),a.checkNoteIdx(this.opts.noteIdx+1)},k.checkBeamable=function(){var a=this.getVoice(),b=this.measureData.getAttributes(),c=a.getNote(this.opts.noteIdx),d=a.getNote(this.opts.noteIdx+1);if(!f.canBeam(c,d,b)||f.areBeamed(c,d))throw new e(this.name)},k.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},k.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.addBeam(),this.updateStack()},k.addBeam=function(){var a=this.getVoiceOrTuplet(),b=a.getNote(this.opts.noteIdx),c=a.getNote(this.opts.noteIdx+1),d=this.getPreviousLeft(),e=this.getNextRight(),f=this.getDpq();g(d,b,c,e,f)},k.getPreviousLeft=function(){var a=this.getVoiceOrTuplet(),b=a.getStartNoteIdx();if(this.opts.noteIdx===b)return null;var c=a.getNote(this.opts.noteIdx-1);if(h.isRest(c))return null;var d=this.getDpq();return h.canHoldFlag(c,d)&&h.hasForwardBeam(c)?c:null},k.getNextRight=function(){var a=this.getVoiceOrTuplet(),b=a.getStopNoteIdx();if(this.opts.noteIdx+1===b)return null;var c=a.getNote(this.opts.noteIdx+2);if(h.isRest(c))return null;var d=this.getDpq();return h.canHoldFlag(c,d)&&h.hasBackwardBeam(c)?c:null},k.getVoiceOrTuplet=function(){return this.measureData.getVoiceOrTupletForGet(this.opts.voiceIdx,this.opts.noteIdx)},k.getDpq=function(){return this.measureData.getDpqValue()},k.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,noteIdx:this.opts.noteIdx,voiceIdx:this.opts.voiceIdx}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Values.DurationType,c=Adagio.Utils.noteUtils,d=Adagio.Utils.durationUtils,e=Adagio.edit.action.AddBeamEdge,f=Adagio.edit.action.RemoveBeamEdge,g=Adagio.edit.common.initMeasureData,h=Adagio.edit.composite.FormatBeams=function(a,b,c){this.init(a,b,c)};h.NAME="composite.FormatBeams";var i=h.prototype;i.name=h.NAME,i.initMeasureData=g,i.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.timePosPerNoteIdx={},this.divsPerBeat=null},i.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.beamNotes()},i.beamNotes=function(){for(var a=this.getVoice(),b=this.opts.noteIdx,c=a.getStopNoteIdx(),d=b;d<c&&!this.beamPair(d,d+1);d++);},i.beamPair=function(a,b){var d=this.getVoice(),e=d.getNote(a),f=d.getNote(b);if(c.isRest(e)||c.isRest(f))return!0;var g=this.getDivsPerQuarter();return!c.canHoldFlag(e,g)||!c.canHoldFlag(f,g)||(!(!c.hasTupletStart(f)&&!c.hasTupletStop(e))||void(this.isSameBeat(a,b)?this.addBeamEdge(a):this.removeBeamEdge(a)))},i.isSameNumberOfFlags=function(a,b){var d=this.getDivsPerQuarter();return c.calcNbBeams(a,d)===c.calcNbBeams(b,d)},i.isSameBeat=function(a,b){if(this.getVoice().isTuplet())return!0;var c=this.getDivsPerBeat(),d=this.getTimePos(a),e=Math.floor(d/c),f=this.getTimePos(b);return e===Math.floor(f/c)},i.getDivsPerBeat=function(){return null===this.divsPerBeat&&this.calcDivsPerBeat(),this.divsPerBeat},i.calcDivsPerBeat=function(){var a=this.getVoice();a.isTuplet()?this.divsPerBeat=this.getDivPerBeatFromTimeModif(a):this.divsPerBeat=this.getDivPerBeatFromTimeSignature()},i.getDivPerBeatFromTimeSignature=function(){var a=this.measureData.getAnyTime(),b=d.getBeatQuarterDuration(a),c=this.getDivsPerQuarter();return d.quarterToDuration(b,c)},i.getDivPerBeatFromTimeModif=function(a){var c=a.getAbsoluteTimeModif(),e=a.getDurationType(),f=this.getDivsPerQuarter(),g=b.toQuarterDuration(e),h=d.quarterToDuration(g,f);return d.normalToActual(h,c)},i.getTimePos=function(a){return void 0===this.timePosPerNoteIdx[a]&&this.loadTimePos(a),this.timePosPerNoteIdx[a]},i.loadTimePos=function(b){var c=this.getVoice(),d=c.getStartNoteIdx();if(b<d){throw new a("Unexpected","The note idx is too low.")}b===d?this.loadFirstTimePos():this.loadPreviousTimePos(b)},i.loadFirstTimePos=function(){this.getVoice().isTuplet()?this.loadTupletFirstTimePos():this.loadVoiceFirstTimePos()},i.loadTupletFirstTimePos=function(){var a=this.getVoice(),b=a.getStartNoteIdx();this.timePosPerNoteIdx[b]=0},i.loadVoiceFirstTimePos=function(){this.timePosPerNoteIdx[0]=0},i.loadPreviousTimePos=function(a){var b=a-1,d=this.getTimePos(b),e=this.getVoice(),f=e.getNote(b),g=c.getDuration(f),h=d+g;this.timePosPerNoteIdx[a]=h},i.removeBeamEdge=function(a){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:a};new f(this.measureData,b,this.cancelStack).performIfPossible()},i.addBeamEdge=function(a){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:a};new e(this.measureData,b,this.cancelStack).performIfPossible()},i.getDivsPerQuarter=function(){return this.measureData.getDivisionsPerQuarterValue()},i.getVoice=function(){var a=this.opts.voiceIdx,b=this.opts.noteIdx;return this.measureData.getVoiceOrTupletForGet(a,b)}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.edit.composite.FormatBeams,c=Adagio.edit.common.initMeasureData,d=Adagio.edit.composite.FormatBeamsRandPos=function(a,b,c){this.init(a,b,c)};d.NAME="composite.FormatBeamsRandPos";var e=d.prototype;e.name=d.NAME,e.initMeasureData=c,e.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.noteIdx=null},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.seekStart(),this.formatBeams()},e.seekStart=function(){var b=this.getVoice(),c=b.getStartNoteIdx();this.noteIdx=this.opts.noteIdx;for(var d=this.opts.noteIdx-1;d>=c;d--){var e=b.getNote(d);if(a.isRest(e))return;if(a.hasTupletStop(e))return;if(!this.canHoldFlag(e))return;this.noteIdx=d}},e.canHoldFlag=function(b){var c=this.getDivsPerQuarter();return a.canHoldFlag(b,c)},e.getDivsPerQuarter=function(){return this.measureData.getDivisionsPerQuarterValue()},e.getVoice=function(){var a=this.opts.voiceIdx,b=this.opts.noteIdx;return this.measureData.getVoiceOrTupletForGet(a,b)},e.formatBeams=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.noteIdx};new b(this.measureData,a,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.client.NotPossibleOnRestsError,b=Adagio.Error.client.BeamError,c=Adagio.Utils.noteUtils,d=Adagio.edit.composite.FormatBeamsRandPos,e=Adagio.edit.common.initMeasureData,f=Adagio.edit.action.FormatBeamsRandPos=function(a,b,c){this.init(a,b,c)};f.NAME="action.FormatBeamsRandPos",f.isAuthorizedException=function(c){return c instanceof a||c instanceof b};var g=f.prototype;g.name=f.NAME,g.initMeasureData=e,g.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},g.performIfPossible=function(){this.isPossible()&&this.perform()},g.isPossible=function(){var a=!0;try{this.checkPreconditions()}catch(b){if(!f.isAuthorizedException(b))throw b;a=!1}return a},g.checkPreconditions=function(){this.checkLocation(),this.checkBeamable()},g.checkLocation=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.measureData.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},g.checkBeamable=function(){var a=this.measureData.getVoice(this.opts.voiceIdx);a.checkNotRest(this.opts.noteIdx);var c=a.getNote(this.opts.noteIdx);if(!this.canHoldFlag(c))throw new b(this.name)},g.canHoldFlag=function(a){var b=this.getDivsPerQuarter();return c.canHoldFlag(a,b)},g.getDivsPerQuarter=function(){return this.measureData.getDivisionsPerQuarterValue()},g.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.formatBeams()},g.formatBeams=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new d(this.measureData,a,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadArticulationTypeError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadArticulationTypeError",this.stack=e.stack,this.message=e.message,this.type=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"Articulation "+a+" is invalid."}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.DoesntHaveArticulationError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="DoesntHaveArticulationError",this.stack=e.stack,this.message=e.message,this.articulationType=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"Note doesn't have Articulation "+a}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.edit.common.initMeasureData,c=Adagio.edit.primitive.RemoveArticulation=function(a,b,c){this.init(a,b,c)};c.NAME="primitive.RemoveArticulation";var d=c.prototype;d.name=c.NAME,d.initMeasureData=b,d.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},d.perform=function(){var b=this.measureData.getVoice(this.opts.voiceIdx),c=b.getNote(this.opts.noteIdx);a.removeArticulation(c,this.opts.articulationType),this.updateStack()},d.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,articulationType:this.opts.articulationType,noteIdx:this.opts.noteIdx}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.Error.value.DoesntHaveArticulationError,b=Adagio.Error.value.BadArticulationTypeError,c=Adagio.Utils.noteUtils,d=Adagio.Values.ArticulationType,e=Adagio.edit.common.initMeasureData,f=Adagio.edit.common.convertTimePosToGetNoteIdx,g=Adagio.edit.common.convertPartUuidToGetPartIdx,h=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,i=Adagio.edit.primitive.RemoveArticulation,j=Adagio.edit.action.RemoveArticulation=function(a,b,c){this.init(a,b,c)};j.NAME="action.RemoveArticulation";var k=j.prototype;k.initMeasureData=e,k.name=j.NAME,k.init=function(a,b,c){g(a,b),h(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,f(this.measureData,this.opts),this.location=null},k.checkPreconditions=function(){this.checkLocation(),this.checkExistence()},k.checkLocation=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx);var a=this.measureData.getVoice(this.opts.voiceIdx);a.checkNoteIdx(this.opts.noteIdx),a.checkNotRest(this.opts.noteIdx)},k.checkExistence=function(){if(!d.isValid(this.opts.articulationType))throw new b(this.opts.placement);var e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getNote(this.opts.noteIdx);if(!c.hasArticulation(f,this.opts.articulationType))throw new a(this.opts.articulationType)},k.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,articulationType:this.opts.articulationType,noteIdx:this.opts.noteIdx};new i(this.measureData,a,this.cancelStack).perform(),this.storeAction(),this.updateStack()},k.updateStack=function(){var a=this.getLocation(),b={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,articulationType:this.opts.articulationType,timePos:a.timePos,divisions:a.dpq}};this.cancelStack.push(b)},k.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,articulationType:this.opts.articulationType,timePos:a.timePos,divisions:a.dpq}};this.cancelStack.storeAction(b)}},k.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadTechnicalTypeError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadTechnicalTypeError",this.stack=e.stack,this.message=e.message,this.type=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"Technical ["+a+"] is invalid."}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.DoesntHaveTechnicalError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="DoesntHaveTechnicalError",this.stack=e.stack,this.message=e.message,this.technicalType=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"Note doesn't have Technical "+a}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.edit.common.initMeasureData,c=Adagio.edit.primitive.RemoveTechnical=function(a,b,c){this.init(a,b,c)};c.NAME="primitive.RemoveTechnical";var d=c.prototype;d.name=c.NAME,d.initMeasureData=b,d.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},d.perform=function(){var b=this.measureData.getVoice(this.opts.voiceIdx),c=b.getNote(this.opts.noteIdx);a.removeTechnical(c,this.opts.technicalType),this.updateStack()},d.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,technicalType:this.opts.technicalType,noteIdx:this.opts.noteIdx}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.Error.value.DoesntHaveTechnicalError,b=Adagio.Error.value.BadTechnicalTypeError,c=Adagio.Utils.noteUtils,d=Adagio.Values.TechnicalType,e=Adagio.edit.common.initMeasureData,f=Adagio.edit.common.convertTimePosToGetNoteIdx,g=Adagio.edit.common.convertPartUuidToGetPartIdx,h=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,i=Adagio.edit.primitive.RemoveTechnical,j=Adagio.edit.action.RemoveTechnical=function(a,b,c){this.init(a,b,c)};j.NAME="action.RemoveTechnical";var k=j.prototype;k.initMeasureData=e,k.name=j.NAME,k.init=function(a,b,c){g(a,b),h(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.location=null,f(this.measureData,this.opts)},k.checkPreconditions=function(){this.checkLocation(),this.checkExistence()},k.checkLocation=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx);var a=this.measureData.getVoice(this.opts.voiceIdx);a.checkNoteIdx(this.opts.noteIdx),a.checkNotRest(this.opts.noteIdx)},k.checkExistence=function(){if(!d.isCommonValid(this.opts.technicalType))throw new b(this.opts.technicalType);var e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getNote(this.opts.noteIdx);if(!c.hasTechnical(f,this.opts.technicalType,this.opts.technicalOpts))throw new a(this.opts.technicalType)},k.extractTechnicalOpts=function(){var a=this.measureData.getVoice(this.opts.voiceIdx),b=a.getNote(this.opts.noteIdx),d=c.getTechnicalOpts(b,this.opts.technicalType);this.opts.technicalOpts=d},k.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.extractTechnicalOpts(),this.storeAction();var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,technicalType:this.opts.technicalType,noteIdx:this.opts.noteIdx};new i(this.measureData,a,this.cancelStack).perform(),this.updateStack()},k.updateStack=function(){var a=this.getLocation(),b={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,timePos:a.timePos,divisions:a.dpq,technicalType:this.opts.technicalType,technicalOpts:this.opts.technicalOpts}};this.cancelStack.push(b)},k.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,timePos:a.timePos,divisions:a.dpq,technicalType:this.opts.technicalType,technicalOpts:this.opts.technicalOpts}};this.cancelStack.storeAction(b)}},k.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location}}.call(this),function(){"use strict";var a=Adagio.edit.common.initMeasureData,b=Adagio.Utils.noteUtils,c=Adagio.edit.primitive.RemoveOrnament=function(a,b,c){this.init(a,b,c)};c.NAME="primitive.RemoveOrnament";var d=c.prototype;d.name=c.NAME,d.initMeasureData=a,d.init=function(a,b,c){this.initMeasureData(a,b,c),this.cancelStack=c,this.opts=b},d.perform=function(){var a=this.measureData.getVoice(this.opts.voiceIdx),c=a.getNote(this.opts.noteIdx),d=b.getOrnamentOpts(c,this.opts.ornamentType);b.removeOrnament(c,this.opts.ornamentType),this.updateStack(d)},d.updateStack=function(a){var b={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,ornamentType:this.opts.ornamentType,ornamentsOpts:a,noteIdx:this.opts.noteIdx}};this.cancelStack.push(b)}}.call(this),function(){"use strict";var a=Adagio.Error.value.BadOrnamentTypeError,b=Adagio.Error.noChange.NoChangeError,c=Adagio.Utils.clone,d=Adagio.Utils.noteUtils,e=Adagio.edit.common.initMeasureData,f=Adagio.edit.common.convertTimePosToGetNoteIdx,g=Adagio.edit.common.convertPartUuidToGetPartIdx,h=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,i=Adagio.Values.OrnamentType,j=Adagio.edit.primitive.RemoveOrnament,k=Adagio.edit.action.RemoveOrnament=function(a,b,c){this.init(a,b,c)};k.NAME="action.RemoveOrnament";var l=k.prototype;l.initMeasureData=e,l.name=k.NAME,l.init=function(a,b,d){g(a,b),h(a,b),this.initMeasureData(a,b),this.cancelStack=d,this.opts=c(b),this.location=null,f(this.measureData,this.opts)},l.checkPreconditions=function(){this.checkLocation(),this.checkExistence()},l.checkLocation=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx);var a=this.measureData.getVoice(this.opts.voiceIdx);a.checkNoteIdx(this.opts.noteIdx),a.checkNotRest(this.opts.noteIdx)},l.checkExistence=function(){if(!i.isValid(this.opts.ornamentType))throw new a(this.opts.ornamentType);var c=this.measureData.getVoice(this.opts.voiceIdx),e=c.getNote(this.opts.noteIdx);if(!d.hasOrnamentType(e,this.opts.ornamentType))throw new b},l.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a=this.extractOrnamentsOpts();this.storeAction();var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,ornamentType:this.opts.ornamentType};new j(this.measureData,b,this.cancelStack).perform(),this.updateStack(a)},l.extractOrnamentsOpts=function(){var a=this.measureData.getVoice(this.opts.voiceIdx),b=a.getNote(this.opts.noteIdx);return d.getOrnamentOpts(b,this.opts.ornamentType)},l.updateStack=function(a){var b=this.getLocation(),d={type:this.name,noDraw:!0,opts:{partUuid:b.partUuid,measureUuid:b.measureUuid,voiceIdx:this.opts.voiceIdx,timePos:b.timePos,divisions:b.dpq,ornamentType:this.opts.ornamentType,ornamentsOpts:c(a)}};this.cancelStack.push(d)},l.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,timePos:a.timePos,divisions:a.dpq,ornamentType:this.opts.ornamentType}};this.cancelStack.storeAction(b)}},l.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.edit.common.initMeasureData,c=Adagio.edit.primitive.RemoveLyric=function(a,b,c){this.init(a,b,c)};c.NAME="primitive.RemoveLyric";var d=c.prototype;d.name=c.NAME,d.initMeasureData=b,d.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},d.perform=function(){var b=this.measureData.getVoice(this.opts.voiceIdx),c=b.getNote(this.opts.noteIdx);a.removeLyricAtLevel(c,this.opts.level),this.updateStack()},d.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.noteUtils,c=Adagio.Utils.lyricUtils,d=Adagio.edit.common.initMeasureData,e=Adagio.edit.primitive.SetSyllabic=function(a,b,c){this.init(a,b,c)};e.NAME="primitive.SetSyllabic";var f=e.prototype;f.name=e.NAME,f.initMeasureData=d,f.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},f.perform=function(){this.setSyllabic(),this.updateStack()},f.setSyllabic=function(){var a=this.getLyric();c.setSyllabic(a,this.opts.syllabicType)},f.getLyric=function(){var c=this.measureData.getVoice(this.opts.voiceIdx),d=c.getNote(this.opts.noteIdx),e=this.opts.level;if(b.hasLyricAtLevel(d,e)){return b.getLyricAtLevel(d,e)}throw new a("NoNoteAtLevel","There should be a lyric at the level ["+e+"].")},f.updateStack=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx},b={type:this.name,opts:a};this.cancelStack.push(b)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Values.SyllabicType,c=Adagio.Utils.noteUtils,d=Adagio.Utils.lyricUtils,e=Adagio.edit.primitive.SetSyllabic,f=Adagio.edit.common.initMeasureData,g=Adagio.edit.common.CrossMeasure,h=Adagio.edit.composite.UpdateSyllabic=function(a,b,c){this.init(a,b,c)};h.NAME="primitive.UpdateSyllabic";var i=h.prototype;i.name=h.NAME,i.initMeasureData=f,i.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.crossMeasure=new g(this.measureData,this.opts.voiceIdx,this.opts.noteIdx-1)},i.perform=function(){var a=this.getSyllabicType();this.setSyllabic(a)},i.getSyllabicType=function(){var a=this.hasPreviousRightConnection(),c=this.hasRightConnection();return a?c?b.MIDDLE:b.END:c?b.BEGIN:b.SINGLE},i.hasPreviousRightConnection=function(){if(this.hasPreviousNote()){var a=this.getPreviousNote();if(c.hasLyricAtLevel(a,this.opts.level)){var b=c.getLyricAtLevel(a,this.opts.level);return d.hasRightConnection(b)}return!1}return!1},i.hasPreviousNote=function(){return!this.crossMeasure.hasLeftOverflow()||!!this.measureData.hasPreviousMeasure()&&!!this.crossMeasure.hasLeftVoice()},i.getPreviousNote=function(){var a=this.crossMeasure.getLeftVoice(),b=this.crossMeasure.getLeftNoteIdx();return a.getNote(b)},i.hasRightConnection=function(){var b=this.measureData.getVoice(this.opts.voiceIdx),e=b.getNote(this.opts.noteIdx),f=this.opts.level;if(c.hasLyricAtLevel(e,f)){var g=c.getLyricAtLevel(e,f);return d.hasRightConnection(g)}throw new a("NoNoteAtLevel","There should be a lyric at the level ["+f+"].")},i.setSyllabic=function(a){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,level:this.opts.level,syllabicType:a};new e(this.measureData,b,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.edit.composite.UpdateSyllabic,c=Adagio.edit.primitive.RemoveLyric,d=Adagio.edit.common.initMeasureData,e=Adagio.edit.common.CrossMeasure,f=Adagio.edit.composite.RemoveLyric=function(a,b,c){this.init(a,b,c)};f.NAME="primitive.RemoveLyric";var g=f.prototype;g.name=f.NAME,g.initMeasureData=d,g.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.crossMeasure=new e(this.measureData,this.opts.voiceIdx,this.opts.noteIdx)},g.perform=function(){this.removeLyric(),this.hasLyricAfter()&&this.updateNextSyllabicType()},g.removeLyric=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,level:this.opts.level};new c(this.measureData,a,this.cancelStack).perform()},g.hasLyricAfter=function(){if(this.hasNoteAfter()){var b=this.getNoteAfter();return a.hasLyricAtLevel(b,this.opts.level)}return!1},g.hasNoteAfter=function(){return!this.crossMeasure.hasRightOverflow()||!!this.measureData.hasNextMeasure()&&!!this.crossMeasure.hasRightVoice()},g.getNoteAfter=function(){var a=this.crossMeasure.getRightVoice(),b=this.crossMeasure.getRightNoteIdx();return a.getNote(b)},g.updateNextSyllabicType=function(){var a=this.crossMeasure.getRightMeasureIdx(),c=this.crossMeasure.getRightMeasure(),d=this.crossMeasure.getRightNoteIdx(),e={partIdx:this.opts.partIdx,measureIdx:a,voiceIdx:this.opts.voiceIdx,noteIdx:d,level:this.opts.level};new b(c,e,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.noChange.NoChangeError,b=Adagio.Error.client.BadPartIdxError,c=Adagio.Error.client.BadMeasureIdxError,d=Adagio.Error.client.BadVoiceError,e=Adagio.Error.client.BadNoteIdxError,f=Adagio.Utils.noteUtils,g=Adagio.Utils.lyricUtils,h=Adagio.Utils.timeModifUtils,i=Adagio.edit.composite.RemoveLyric,j=Adagio.edit.common.initMeasureData,k=Adagio.edit.common.convertPartUuidToGetPartIdx,l=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,m=Adagio.edit.common.convertTimePosToGetNoteIdx,n=Adagio.edit.action.RemoveLyric=function(a,b,c){this.init(a,b,c)};n.NAME="action.RemoveLyric",n.isAuthorizedException=function(f){return f instanceof b||f instanceof c||f instanceof d||f instanceof a||f instanceof e};var o=n.prototype;o.initMeasureData=j,o.name=n.NAME,o.init=function(a,b,c){k(a,b),l(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,m(this.measureData,b),this.location=null,this.sanitized=!1},o.performIfPossible=function(){this.isPossible()&&this.perform()},o.isPossible=function(){var a=!0;try{this.checkPreconditions()}catch(b){if(!n.isAuthorizedException(b))throw b;a=!1}return a},o.checkPreconditions=function(){this.sanitizeIfNeeded(),this.checkLocation(),this.checkExistence()},o.checkLocation=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.measureData.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},o.checkExistence=function(){var b=this.measureData.getVoice(this.opts.voiceIdx),c=b.getNote(this.opts.noteIdx);if(!f.hasLyricAtLevel(c,this.opts.level)){throw new a("There is no lyric at this location.")}},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded(),this.storeAction();var a=this.getPreviousData();this.removeLyric(),this.updateStack(a)},o.sanitizeIfNeeded=function(){this.sanitized||(void 0===this.opts.level&&(this.opts.level=0),this.sanitized=!0)},o.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos,level:this.opts.level}}
;this.cancelStack.storeAction(b)}},o.getPreviousData=function(){var a=this.measureData.getVoice(this.opts.voiceIdx),b=a.getNote(this.opts.noteIdx),c=f.getLyricAtLevel(b,this.opts.level);return{text:g.getText(c),hasRightConnection:g.hasRightConnection(c)}},o.removeLyric=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,level:this.opts.level};new i(this.measureData,a,this.cancelStack).perform()},o.updateStack=function(a){var b=this.getLocation(),c=h.copy(b.timeModif),d={type:this.name,noDraw:!0,opts:{partUuid:b.partUuid,measureUuid:b.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:b.dpq,timeModif:c,timePos:b.timePos,level:this.opts.level,hasRightConnection:a.hasRightConnection,lyric:a.text}};this.cancelStack.push(d)},o.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),g=e.getRangeSpace(0,this.opts.noteIdx),i=e.getNote(this.opts.noteIdx),j=f.getTimeModif(i);j=h.copy(j),this.location={partUuid:b,measureUuid:c,dpq:d,timePos:g,timeModif:j}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.noChange.NoChangeError,b=Adagio.Error.client.BadPartIdxError,c=Adagio.Error.client.BadMeasureIdxError,d=Adagio.Error.client.BadVoiceError,e=Adagio.Error.client.BadNoteIdxError,f=Adagio.Utils.noteUtils,g=Adagio.Utils.lyricUtils,h=Adagio.edit.action.RemoveLyric,i=Adagio.edit.common.initMeasureData,j=Adagio.edit.common.convertPartUuidToGetPartIdx,k=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,l=Adagio.edit.common.convertTimePosToGetNoteIdx,m=Adagio.edit.action.RemoveLyrics=function(a,b,c){this.init(a,b,c)};m.NAME="action.RemoveLyrics",m.isAuthorizedException=function(f){return f instanceof b||f instanceof c||f instanceof d||f instanceof a||f instanceof e};var n=m.prototype;n.initMeasureData=i,n.name=m.NAME,n.init=function(a,b,c){j(a,b),k(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,l(this.measureData,b),this.location=null,this.sanitized=!1},n.performIfPossible=function(){this.isPossible()&&this.perform()},n.isPossible=function(){var a=!0;try{this.checkPreconditions()}catch(b){if(!m.isAuthorizedException(b))throw b;a=!1}return a},n.checkPreconditions=function(){this.sanitizeIfNeeded(),this.checkLocation(),this.checkExistence()},n.checkLocation=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.measureData.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},n.checkExistence=function(){var b=this.measureData.getVoice(this.opts.voiceIdx),c=b.getNote(this.opts.noteIdx);if(!f.hasLyrics(c)){throw new a("There is no lyric at this location.")}},n.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded(),this.storeAction(),this.removeLyrics()},n.sanitizeIfNeeded=function(){this.sanitized||(void 0===this.opts.level&&(this.opts.level=0),this.sanitized=!0)},n.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos}};this.cancelStack.storeAction(b)}},n.removeLyrics=function(){var a=this.measureData.getVoice(this.opts.voiceIdx),b=a.getNote(this.opts.noteIdx);f.getLyrics(b).map(g.getLevel).forEach(this.removeLyric,this)},n.removeLyric=function(a){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,level:a};new h(this.measureData,b,this.cancelStack).perform()},n.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Utils.timeUtils,b=Adagio.Utils.timeModifUtils,c=Adagio.Utils.durationUtils,d=Adagio.Values.DurationType,e=Adagio.edit.composite.AdaptDpqToDuration,f=Adagio.edit.common.initMeasureData,g=Adagio.edit.composite.AdaptDpqToTimeSignature=function(a,b,c){this.init(a,b,c)};g.NAME="composite.AdaptDpqToTimeSignature";var h=g.prototype;h.initMeasureData=f,h.name=g.NAME,h.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},h.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.adaptDpqToDuration()},h.adaptDpqToDuration=function(){var f=this.measureData.getAnyTime(),g=a.getBeatType(f),h=c.beatTypeToQuarter(g),i=d.quarterToDurationType(h),j=b.createDefault(),k={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,durationType:i,nbDots:0,timeModif:j};new e(this.measureData,k,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.NoSlurToMoveError=function(){var b="There is no slur bound to move",c=a.call(this,b);return this.name=c.name="NoSlurToMoveError",this.stack=c.stack,this.message=c.message,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}})}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.BadSlurLocationError=function(){var b="Cannot move the slur bound to this location.",c=a.call(this,b);return this.name=c.name="BadSlurLocationError",this.stack=c.stack,this.message=c.message,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}})}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.slurUtils,c=Adagio.edit.common.initMeasureData,d=Adagio.edit.primitive.RemoveSlurSide=function(a,b,c){this.init(a,b,c)};d.NAME="primitive.RemoveSlurSide";var e=d.prototype;e.name=d.NAME,e.initMeasureData=c,e.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},e.perform=function(){var a=this.removeSlur();this.updateStack(a)},e.removeSlur=function(){var c=this.measureData.getVoice(this.opts.voiceIdx),d=c.getNote(this.opts.noteIdx),e=a.getSlurType(d),f=a.getSlur(d),g=b.isCrossMeasure(f),h={slurType:e,isCrossMeasure:g};return a.removeSlur(d),h},e.updateStack=function(a){var b={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,type:a.slurType,isCrossMeasure:a.isCrossMeasure}};this.cancelStack.push(b)}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.slurUtils,c=Adagio.edit.common.initMeasureData,d=Adagio.edit.primitive.AddSlurSide=function(a,b,c){this.init(a,b,c)};d.NAME="primitive.AddSlurSide";var e=d.prototype;e.name=d.NAME,e.initMeasureData=c,e.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},e.perform=function(){this.addSlur(),this.updateStack()},e.addSlur=function(){var c=this.measureData.getVoice(this.opts.voiceIdx),d=c.getNote(this.opts.noteIdx),e=b.create(this.opts.type);this.opts.isCrossMeasure&&b.addCrossMeasure(e),a.setSlur(d,e)},e.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,isCrossMeasure:this.opts.isCrossMeasure,type:this.opts.type}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.edit.primitive.RemoveSlurContinue=function(a,b,c){this.init(a,b,c)};b.NAME="primitive.RemoveSlurContinue";var c=b.prototype;c.name=b.NAME,c.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},c.perform=function(){var a=this.getStaffIdx();this.removeLeftSlur(),this.removeRightSlur(),this.updateStack(a)},c.getStaffIdx=function(){var b=this.getLeftMeasure();return a.getRightSlur(b,this.opts.voiceIdx).staffIdx},c.removeLeftSlur=function(){var b=this.getLeftMeasure();a.removeRightSlur(b,this.opts.voiceIdx)},c.getLeftMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},c.removeRightSlur=function(){var b=this.getRightMeasure();a.removeLeftSlur(b,this.opts.voiceIdx)},c.getRightMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx+1)},c.updateStack=function(a){var b={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:a}};this.cancelStack.push(b)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.edit.primitive.AddSlurContinue=function(a,b,c){this.init(a,b,c)};b.NAME="primitive.AddSlurContinue";var c=b.prototype;c.name=b.NAME,c.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},c.perform=function(){this.addLeftSlur(),this.addRightSlur(),this.updateStack()},c.addLeftSlur=function(){var b=this.getLeftMeasure(),c=this.createSlur();a.setRightSlur(b,this.opts.voiceIdx,c)},c.getLeftMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},c.addRightSlur=function(){var b=this.getRightMeasure(),c=this.createSlur();a.setLeftSlur(b,this.opts.voiceIdx,c)},c.getRightMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx+1)},c.createSlur=function(){return{staffIdx:this.opts.staffIdx}},c.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.slurUtils,c=Adagio.edit.common.initMeasureData,d=Adagio.edit.primitive.SetSlurIsCrossMeasure=function(a,b,c){this.init(a,b,c)};d.NAME="primitive.SetSlurIsCrossMeasure";var e=d.prototype;e.name=d.NAME,e.initMeasureData=c,e.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},e.perform=function(){this.setIsCrossMeasure(),this.updateStack()},e.setIsCrossMeasure=function(){var c=this.measureData.getVoice(this.opts.voiceIdx),d=c.getNote(this.opts.noteIdx),e=a.getSlur(d);this.opts.isCrossMeasure?b.addCrossMeasure(e):b.removeCrossMeasure(e)},e.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,isCrossMeasure:this.opts.isCrossMeasure}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.noteUtils,c=Adagio.Values.SlurType,d=Adagio.edit.primitive.RemoveSlurSide,e=Adagio.edit.primitive.AddSlurSide,f=Adagio.edit.primitive.RemoveSlurContinue,g=Adagio.edit.primitive.AddSlurContinue,h=Adagio.edit.primitive.SetSlurIsCrossMeasure,i=Adagio.edit.common.getMeasuresScroller,j=Adagio.edit.common.fetchSlurStop,k=Adagio.edit.common.fetchSlurStart,l=Adagio.edit.composite.MoveSlurSide=function(a,b,c){this.init(a,b,c)};l.NAME="composite.MoveSlurSide";var m=l.prototype;m.name=l.NAME,m.init=function(a,b,c){this.measuresScroller=i(a,b),this.cancelStack=c,this.opts=b,this.slurType=null,this.otherSide=null,this.staffIdx=null},m.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.getSlurData(),this.fetchOtherSide(),this.opts.newMeasureIdx!==this.opts.oldMeasureIdx&&(this.updateOtherSide(),this.updateContinues()),this.removeSlur(),this.addSlur()},m.getSlurData=function(){var a=this.measuresScroller.getMeasureData(this.opts.oldMeasureIdx),c=a.getVoice(this.opts.voiceIdx),d=c.getNote(this.opts.oldNoteIdx);this.slurType=b.getSlurType(d),this.staffIdx=b.getStaffIdx(d)},m.fetchOtherSide=function(){var b={voiceIdx:this.opts.voiceIdx,measureIdx:this.opts.oldMeasureIdx,noteIdx:this.opts.oldNoteIdx};if(this.slurType===c.START)this.otherSide=j(this.measuresScroller,b);else{if(this.slurType!==c.STOP)throw new a("Unexpected");this.otherSide=k(this.measuresScroller,b)}},m.updateOtherSide=function(){var a=this.otherSide.measureIdx;this.opts.newMeasureIdx===a&&this.opts.oldMeasureIdx!==a?this.setIsCrossMeasure(!1):this.opts.newMeasureIdx!==a&&this.opts.oldMeasureIdx===a&&this.setIsCrossMeasure(!0)},m.setIsCrossMeasure=function(a){var b={partIdx:this.opts.partIdx,measureIdx:this.otherSide.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.otherSide.noteIdx,isCrossMeasure:a},c=this.measuresScroller.getMeasureData(b.measureIdx);new h(c,b,this.cancelStack).perform()},m.updateContinues=function(){var a=this.opts.newMeasureIdx-this.opts.oldMeasureIdx;a>0?this.updateContinuesRight(a):this.updateContinuesLeft(-a)},m.updateContinuesRight=function(a){for(var b=this.getContinueAction(),c=this.measuresScroller.getScoreData(),d=0;d<a;d++){var e=this.opts.oldMeasureIdx+d;new b(c,{partIdx:this.opts.partIdx,measureIdx:e,voiceIdx:this.opts.voiceIdx,staffIdx:this.staffIdx},this.cancelStack).perform()}},m.updateContinuesLeft=function(a){for(var b=this.getContinueAction(),c=this.measuresScroller.getScoreData(),d=0;d<a;d++){var e=this.opts.oldMeasureIdx-(d+1);new b(c,{partIdx:this.opts.partIdx,measureIdx:e,voiceIdx:this.opts.voiceIdx,staffIdx:this.staffIdx},this.cancelStack).perform()}},m.getContinueAction=function(){var a=this.otherSide.measureIdx,b=Math.abs(a-this.opts.oldMeasureIdx),c=Math.abs(a-this.opts.newMeasureIdx);return b>c?f:b<c?g:null},m.removeSlur=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.oldMeasureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.oldNoteIdx},b=this.measuresScroller.getMeasureData(a.measureIdx);new d(b,a,this.cancelStack).perform()},m.addSlur=function(){var a=this.getIsCrossMeasure(),b={partIdx:this.opts.partIdx,measureIdx:this.opts.newMeasureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.newNoteIdx,isCrossMeasure:a,type:this.slurType},c=this.measuresScroller.getMeasureData(b.measureIdx);new e(c,b,this.cancelStack).perform()},m.getIsCrossMeasure=function(){return this.opts.newMeasureIdx!==this.otherSide.measureIdx}}.call(this),function(){"use strict";var a=Adagio.edit.common.noteLocation={};a.create=function(a,b){return{noteIdx:b,measureIdx:a}},a.isEqual=function(a,b){return a.measureIdx===b.measureIdx&&a.noteIdx===b.noteIdx},a.isGreater=function(a,b){var c=a.measureIdx-b.measureIdx;return c>0||!(c<0)&&a.noteIdx-b.noteIdx>0},a.isLower=function(a,b){var c=a.measureIdx-b.measureIdx;return c<0||!(c>0)&&a.noteIdx-b.noteIdx<0}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.edit.common.noteLocation;Adagio.edit.common.searchFarestLeftPossibleSlur=function(c,d,e){for(var f=null,g=null,h=d.measureIdx;h>=0;h--){var i=c.getMeasureData(h),j=i.getVoice(d.voiceIdx);for(g=null===g?d.noteIdx:j.size()-1;g>=0;g--){var k=b.create(h,g);if(!b.isEqual(k,d)){var l=j.getNote(g);if(a.hasSlur(l))return f;if(a.isRest(l)||(f=k),null!==e&&b.isEqual(k,e))return f}}}return f}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.edit.common.noteLocation;Adagio.edit.common.searchFarestRightPossibleSlur=function(c,d,e){for(var f=null,g=null,h=c.getNbMeasures(),i=d.measureIdx;i<h;i++){var j=c.getMeasureData(i),k=j.getVoice(d.voiceIdx),l=k.size();for(g=null===g?d.noteIdx:0;g<l;g++){var m=b.create(i,g);if(!b.isEqual(m,d)){var n=k.getNote(g);if(a.hasSlur(n))return f;if(a.isRest(n)||(f=m),null!==e&&b.isEqual(m,e))return f}}}return f}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadMeasureUuidError,b=Adagio.edit.common.measureUuidToMeasureIdx,c=Adagio.edit.common.getScoreData;Adagio.edit.common.convertMeasureUuidToOldNew=function(a,b){void 0!==b.oldMeasureUuid&&d(a,b),void 0!==b.newMeasureUuid&&e(a,b)};var d=function(d,e){if(d=c(d),!d.hasMeasureIdxByUuid(e.oldMeasureUuid))throw new a(e.oldMeasureUuid,a.GET);e.oldMeasureIdx=b(d.getMeasuresHeaders(),e.oldMeasureUuid),delete e.oldMeasureUuid},e=function(d,e){if(d=c(d),!d.hasMeasureIdxByUuid(e.newMeasureUuid))throw new a(e.newMeasureUuid,a.GET);e.newMeasureIdx=b(d.getMeasuresHeaders(),e.newMeasureUuid),delete e.newMeasureUuid}}.call(this),function(){"use strict";var a=Adagio.edit.common.convertTimePosToGetNoteIdx;Adagio.edit.common.convertTimePosToOldNew=function(a,d){void 0!==d.newTimePos&&void 0!==d.oldTimePos&&(b(a,d),c(a,d))};var b=function(b,c){var d=b.getMeasureData(c.newMeasureIdx),e={voiceIdx:c.voiceIdx,divisions:c.newDivisions,timePos:c.newTimePos};a(d,e),delete c.newTimePos,c.newNoteIdx=e.noteIdx},c=function(b,c){var d=b.getMeasureData(c.oldMeasureIdx),e={voiceIdx:c.voiceIdx,divisions:c.oldDivisions,timePos:c.oldTimePos};a(d,e),delete c.oldTimePos,c.oldNoteIdx=e.noteIdx}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Error.client.NoSlurToMoveError,c=Adagio.Error.client.BadSlurLocationError,d=Adagio.Utils.noteUtils,e=Adagio.edit.composite.MoveSlurSide,f=Adagio.edit.common.getMeasuresScroller,g=Adagio.edit.common.noteLocation,h=Adagio.edit.common.searchFarestLeftPossibleSlur,i=Adagio.edit.common.searchFarestRightPossibleSlur,j=Adagio.edit.common.convertPartUuidToGetPartIdx,k=Adagio.edit.common.convertMeasureUuidToOldNew,l=Adagio.edit.common.convertTimePosToOldNew,m=Adagio.edit.action.MoveSlurSide=function(a,b,c){this.init(a,b,c)};m.NAME="action.MoveSlurSide";var n=m.prototype;n.name=m.NAME,n.init=function(a,b,c){j(a,b),k(a,b),this.measuresScroller=f(a,b),this.cancelStack=c,this.opts=b,this.location=null,l(this.measuresScroller,this.opts)},n.checkPreconditions=function(){this.checkLocation(),this.checkPreviousNoteIdx(),this.checkNewNoteIdx()},n.checkLocation=function(){this.measuresScroller.checkMeasureIdx(this.opts.oldMeasureIdx);var a=this.measuresScroller.getMeasureData(this.opts.oldMeasureIdx);a.checkVoiceIdx(this.opts.voiceIdx),a.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.oldNoteIdx),this.measuresScroller.checkMeasureIdx(this.opts.newMeasureIdx);var b=this.measuresScroller.getMeasureData(this.opts.newMeasureIdx);b.checkVoiceIdx(this.opts.voiceIdx),b.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.newNoteIdx)},n.checkPreviousNoteIdx=function(){var a=this.getPreviousNote();if(!d.hasSlur(a))throw new b},n.getPreviousNote=function(){return this.measuresScroller.getMeasureData(this.opts.oldMeasureIdx).getVoice(this.opts.voiceIdx).getNote(this.opts.oldNoteIdx)},n.checkNewNoteIdx=function(){this.checkNotRest(),this.checkInterval()},n.checkNotRest=function(){this.measuresScroller.getMeasureData(this.opts.newMeasureIdx).getVoice(this.opts.voiceIdx).checkNotRest(this.opts.newNoteIdx)},n.checkInterval=function(){var b=g.create(this.opts.oldMeasureIdx,this.opts.oldNoteIdx);b.voiceIdx=this.opts.voiceIdx;var d,e=g.create(this.opts.newMeasureIdx,this.opts.newNoteIdx);if(g.isEqual(b,e))throw new c;if(g.isGreater(e,b))d=i(this.measuresScroller,b,e);else{if(!g.isLower(e,b))throw new a("Unexpected");d=h(this.measuresScroller,b,e)}if(null===d||!g.isEqual(d,e))throw new c},n.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.moveSlurSide(),this.updateCancelStack()},n.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={partUuid:a.partUuid,voiceIdx:this.opts.voiceIdx,oldMeasureUuid:a.oldMeasureUuid,oldDivisions:a.oldDivisions,oldTimePos:a.oldTimePos,newMeasureUuid:a.newMeasureUuid,newDivisions:a.newDivisions,newTimePos:a.newTimePos},c={actionName:this.name,opts:b};this.cancelStack.storeAction(c)}},n.moveSlurSide=function(){var a={partIdx:this.opts.partIdx,oldMeasureIdx:this.opts.oldMeasureIdx,newMeasureIdx:this.opts.newMeasureIdx,voiceIdx:this.opts.voiceIdx,oldNoteIdx:this.opts.oldNoteIdx,newNoteIdx:this.opts.newNoteIdx};new e(this.measuresScroller,a,this.cancelStack).perform()},n.updateCancelStack=function(){var a=this.getLocation(),b={partUuid:a.partUuid,voiceIdx:this.opts.voiceIdx,oldMeasureUuid:a.oldMeasureUuid,oldDivisions:a.oldDivisions,oldTimePos:a.oldTimePos,newMeasureUuid:a.newMeasureUuid,newDivisions:a.newDivisions,newTimePos:a.newTimePos},c={type:this.name,noDraw:!0,opts:b};this.cancelStack.push(c)},n.getLocation=function(){if(null===this.location){var a=this.measuresScroller.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.oldMeasureIdx),d=this.measuresScroller.getMeasureData(this.opts.oldMeasureIdx),e=d.getDpqValue(),f=d.getVoice(this.opts.voiceIdx),g=f.getRangeSpace(0,this.opts.oldNoteIdx),h=a.getMeasureUuid(this.opts.newMeasureIdx),i=this.measuresScroller.getMeasureData(this.opts.newMeasureIdx),j=i.getDpqValue(),k=i.getVoice(this.opts.voiceIdx),l=k.getRangeSpace(0,this.opts.newNoteIdx);this.location={partUuid:b,oldMeasureUuid:c,oldDivisions:e,oldTimePos:g,newMeasureUuid:h,newDivisions:j,newTimePos:l}}return this.location}}.call(this),function(){"use strict";var a=Adagio.edit.primitive.RemoveSlurSide,b=Adagio.edit.primitive.RemoveSlurContinue,c=Adagio.edit.common.getMeasuresScroller,d=Adagio.edit.composite.RemoveSlur=function(a,b,c){this.init(a,b,c)};d.NAME="composite.RemoveSlur";var e=d.prototype;e.name=d.NAME,e.getMeasuresScroller=c,e.init=function(a,b,d){this.measuresScroller=c(a,b),this.cancelStack=d,this.opts=b},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeSlurLeftSide(),this.removeSlurRightSide(),this.removeContinues()},e.removeSlurLeftSide=function(){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.startMeasureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.startNoteIdx},c=this.measuresScroller.getMeasureData(this.opts.startMeasureIdx);new a(c,b,this.cancelStack).perform()},e.removeSlurRightSide=function(){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.stopMeasureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.stopNoteIdx},c=this.measuresScroller.getMeasureData(this.opts.stopMeasureIdx);new a(c,b,this.cancelStack).perform()},e.removeContinues=function(){for(var a=this.opts.startMeasureIdx,b=this.opts.stopMeasureIdx,c=a;c<b;c++)this.removeContinue(c)},e.removeContinue=function(a){var c={partIdx:this.opts.partIdx,measureIdx:a,voiceIdx:this.opts.voiceIdx},d=this.measuresScroller.getScoreData();new b(d,c,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.client.NoSlurError,b=Adagio.Error.client.BadVoiceError,c=Adagio.edit.common.convertPartUuidToGetPartIdx,d=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,e=Adagio.edit.common.convertTimePosToGetNoteIdx,f=Adagio.edit.composite.RemoveSlur,g=Adagio.edit.common.getMeasuresScroller,h=Adagio.edit.common.fetchSlurStart,i=Adagio.edit.common.fetchSlurStop,j=Adagio.edit.action.RemoveSlur=function(a,b,c){this.init(a,b,c)};j.NAME="action.RemoveSlur";var k=j.prototype;k.name=j.NAME,k.init=function(a,b,e){c(a,b),d(a,b),this.measuresScroller=g(a,b),this.cancelStack=e,this.opts=b,this.startNoteIdx=null,this.startMeasureIdx=null,this.stopNoteIdx=null,this.stopMeasureIdx=null,this.location=null},k.checkPreconditions=function(){this.checkLocation(),this.searchSides()},k.checkLocation=function(){if(this.measuresScroller.checkMeasureIdx(this.opts.measureIdx),!this.measuresScroller.getScoreData().hasPartVoiceIdx(this.opts.partIdx,this.opts.voiceIdx))throw new b(this.opts.voiceIdx);var a=this.measuresScroller.getMeasureData(this.opts.measureIdx);if(a.hasVoice(this.opts.voiceIdx)){e(a,this.opts);a.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)}},k.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.hasSide()||this.searchSides(),this.storeAction();var a={partIdx:this.opts.partIdx,startMeasureIdx:this.startMeasureIdx,stopMeasureIdx:this.stopMeasureIdx,voiceIdx:this.opts.voiceIdx,startNoteIdx:this.startNoteIdx,stopNoteIdx:this.stopNoteIdx};new f(this.measuresScroller,a,this.cancelStack).perform(),this.updateStack()},k.hasSide=function(){return null!==this.startNoteIdx&&null!==this.stopNoteIdx},k.searchSides=function(){this.searchLeftSide(),this.searchRightSide()},k.searchLeftSide=function(){var b=h(this.measuresScroller,this.opts);if(null===b)throw new a;this.startMeasureIdx=b.measureIdx,this.startNoteIdx=b.noteIdx},k.searchRightSide=function(){var b=i(this.measuresScroller,this.opts);if(null===b)throw new a;this.stopMeasureIdx=b.measureIdx,this.stopNoteIdx=b.noteIdx},k.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,divisions:a.dpq,timePos:a.timePos,voiceIdx:this.opts.voiceIdx}};this.cancelStack.storeAction(b)}},k.updateStack=function(){var a=this.getLocation(),b={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,voiceIdx:this.opts.voiceIdx,startMeasureUuid:a.startMeasureUuid,startTimePos:a.startTimePos,startDivisions:a.startDpq,stopMeasureUuid:a.stopMeasureUuid,stopTimePos:a.stopTimePos,stopDivisions:a.stopDpq}};this.cancelStack.push(b)},k.getLocation=function(){if(null===this.location){var a,b=this.measuresScroller.getScoreData(),c=b.getPartUuid(this.opts.partIdx),d=b.getMeasureUuid(this.startMeasureIdx),e=this.measuresScroller.getMeasureData(this.startMeasureIdx),f=e.getDpqValue(),g=e.getVoice(this.opts.voiceIdx),h=g.getRangeSpace(0,this.startNoteIdx),i=b.getMeasureUuid(this.stopMeasureIdx),j=this.measuresScroller.getMeasureData(this.stopMeasureIdx),k=j.getDpqValue(),l=j.getVoice(this.opts.voiceIdx),m=l.getRangeSpace(0,this.stopNoteIdx),n=b.getMeasureUuid(this.opts.measureIdx),o=this.measuresScroller.getMeasureData(this.opts.measureIdx),p=o.getDpqValue();if(o.hasVoice(this.opts.voiceIdx)){a=o.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx)}else a=0;this.location={partUuid:c,startMeasureUuid:d,startDpq:f,startTimePos:h,stopMeasureUuid:i,stopDpq:k,stopTimePos:m,measureUuid:n,dpq:p,timePos:a}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.edit.common.noteLocation;Adagio.edit.common.searchClosestRightPossibleSlur=function(c,d){for(var e=null,f=c.getNbMeasures(),g=d.measureIdx;g<f;g++){var h=c.getMeasureData(g),i=h.getVoice(d.voiceIdx),j=i.size();for(e=null===e?d.noteIdx:0;e<j;e++){var k=b.create(g,e);if(!b.isEqual(k,d)){var l=i.getNote(e);if(a.hasSlur(l))return null;if(!a.isRest(l))return k}}}return null}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.edit.common.noteLocation;Adagio.edit.common.searchClosestLeftPossibleSlur=function(c,d){for(var e=null,f=d.measureIdx;f>=0;f--){var g=c.getMeasureData(f),h=g.getVoice(d.voiceIdx);for(e=null===e?d.noteIdx:h.size()-1;e>=0;e--){var i=b.create(f,e);if(!b.isEqual(i,d)){var j=h.getNote(e);if(a.hasSlur(j))return null;if(!a.isRest(j))return i}}}return null}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Values.SlurType,c=Adagio.Utils.noteUtils,d=Adagio.edit.action.MoveSlurSide,e=Adagio.edit.action.RemoveSlur,f=Adagio.edit.common.initMeasureData,g=Adagio.edit.common.searchClosestRightPossibleSlur,h=Adagio.edit.common.searchClosestLeftPossibleSlur,i=Adagio.edit.composite.DispatchSlurSide=function(a,b,c){this.init(a,b,c)};i.NAME="composite.DispatchSlurSide";var j=i.prototype;j.name=i.NAME,j.initMeasureData=f,j.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.slurType=null,this.newLocation=null},j.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.fetchSlurType(),this.fetchNewNoteIdx(),this.hasValidNoteIdx()?this.moveSlurSide():this.removeSlur()},j.fetchSlurType=function(){var b=this.measureData.getVoice(this.opts.voiceIdx),d=b.getNote(this.opts.noteIdx);if(!c.hasSlur(d))throw new a("SlurExpected");this.slurType=c.getSlurType(d)},j.fetchNewNoteIdx=function(){this.slurType===b.START?this.searchStartNoteIdx():this.slurType===b.STOP?this.searchStopNoteIdx():b.raiseError(this.slurType)},j.searchStartNoteIdx=function(){var a=this.measureData.getMeasuresScroller();this.newLocation=g(a,this.opts)},j.searchStopNoteIdx=function(){var a=this.measureData.getMeasuresScroller();this.newLocation=h(a,this.opts)},j.hasValidNoteIdx=function(){return null!==this.newLocation},j.moveSlurSide=function(){var a={partIdx:this.opts.partIdx,voiceIdx:this.opts.voiceIdx,oldMeasureIdx:this.opts.measureIdx,oldNoteIdx:this.opts.noteIdx,newMeasureIdx:this.newLocation.measureIdx,newNoteIdx:this.newLocation.noteIdx};new d(this.measureData,a,this.cancelStack).perform()},j.removeSlur=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new e(this.measureData,a,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.edit.common.initMeasureData,b=Adagio.edit.primitive.DeleteGraceNote=function(a,b,c){this.init(a,b,c)};b.NAME="primitive.DeleteGraceNote";var c=b.prototype;c.name=b.NAME,c.initMeasureData=a,c.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},c.perform=function(){this.getVoice().removeGrace(this.opts.noteIdx,this.opts.graceIdx),this.updateStack()},c.getVoice=function(){var a=this.opts.voiceIdx;return this.measureData.getVoice(a)},c.updateStack=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx},b={type:this.name,opts:a};this.cancelStack.push(b)}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.pitchUtils,c=Adagio.edit.composite.SetAccidentalIfNeeded,d=Adagio.edit.composite.SetGraceAccidentalIfNeeded,e=Adagio.edit.composite.RemoveAccidentalIfNeeded,f=Adagio.edit.composite.RemoveGraceAccidentalIfNeeded,g=Adagio.edit.common.getPreviousAlter,h=Adagio.edit.common.getNoteAtPitch,i=Adagio.edit.common.getGraceAtPitch,j=Adagio.edit.common.GracesScroller,k=Adagio.edit.common.initMeasureData,l=Adagio.edit.composite.UpdateGraceAccidental=function(a,b,c){this.init(a,b,c)};l.NAME="composite.UpdateGraceAccidental";var m=l.prototype;m.initMeasureData=k,m.name=l.NAME,m.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},m.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a=this.getPreviousAlter();a=this.updateCurrentAccidental(a),this.updateNextAccidental(a)},m.getPreviousAlter=function(){return g(this.measureData,this.opts.noteIdx,this.opts.voiceIdx,this.opts.staffIdx,this.opts.pitch,this.opts.graceIdx)},m.updateCurrentAccidental=function(c){var d=this.getGraceAtPitch();if(void 0!==d){var e=a.getPitch(d),f=b.getAlter(e);return this.updateAccidental(d,this.opts.noteIdx,c,this.opts.graceIdx),f}return c},m.getGraceAtPitch=function(){var a=this.measureData.getVoice(this.opts.voiceIdx);return i(a,this.opts.noteIdx,this.opts.graceIdx,this.opts.pitch)},m.updateNextAccidental=function(a){var b=this.measureData.getVoice(this.opts.voiceIdx),c=n(b,this.opts.noteIdx,this.opts.pitch,this.opts.graceIdx);if(null!==c){var d=this.getNextNoteAtPitch(c);this.updateAccidental(d,c.noteIdx,a,c.graceIdx)}},m.getNextNoteAtPitch=function(a){var b=this.measureData.getVoice(this.opts.voiceIdx);return null===a.graceIdx?h(b,a.noteIdx,this.opts.pitch):i(b,a.noteIdx,a.graceIdx,this.opts.pitch)};var n=function(a,b,c,d){for(var e=new j(a),f={noteIdx:b,graceIdx:d};e.hasNextEntity(f.noteIdx,f.graceIdx);)if(f=e.getNextCursor(f.noteIdx,f.graceIdx),o(a,f)){var g=h(a,f.noteIdx,c,f.graceIdx);if(void 0!==g)return f}return null},o=function(a,b){return null!==b.graceIdx||!a.isRest(b.noteIdx)};m.updateAccidental=function(c,d,e,f){var g=a.getPitch(c),h=b.getAlter(g);if(h===e)this.removeAccidental(d,f);else{var i=b.alterToAccidental(h);this.addAccidental(d,i,f)}},m.removeAccidental=function(a,c){var d,g={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:a,pitch:b.copy(this.opts.pitch)};null===c?d=new e(this.measureData,g,this.cancelStack):(g.graceIdx=c,d=new f(this.measureData,g,this.cancelStack)),d.perform()},m.addAccidental=function(a,e,f){var g,h={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:a,pitch:b.copy(this.opts.pitch),accidental:e};null===f?g=new c(this.measureData,h,this.cancelStack):(h.graceIdx=f,g=new d(this.measureData,h,this.cancelStack)),g.perform()}}.call(this),function(){"use strict"
;var a=Adagio.Utils.noteUtils,b=Adagio.edit.common.initMeasureData,c=Adagio.edit.primitive.RemoveGraceSlash=function(a,b,c){this.init(a,b,c)};c.NAME="primitive.RemoveGraceSlash";var d=c.prototype;d.initMeasureData=b,d.name=c.NAME,d.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeGraceSlash(),this.updateStack()},d.removeGraceSlash=function(){var b=this.measureData.getVoice(this.opts.voiceIdx),c=b.getGrace(this.opts.noteIdx,this.opts.graceIdx);a.makeGrace(c)},d.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.Error.noChange.NoChangeError,b=Adagio.Utils.noteUtils,c=Adagio.edit.primitive.RemoveGraceSlash,d=Adagio.edit.common.convertTimePosToGetNoteIdx,e=Adagio.edit.common.convertPartUuidToGetPartIdx,f=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,g=Adagio.edit.common.initMeasureData,h=Adagio.edit.action.RemoveGraceSlash=function(a,b,c){this.init(a,b,c)};h.NAME="action.RemoveGraceSlash",h.isNoChange=function(b){return b instanceof a};var i=h.prototype;i.name=h.NAME,i.initMeasureData=g,i.init=function(a,b,c){e(a,b),f(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.sanitized=!1,this.voice=null,this.graceAtPitch=null,this.location=null},i.checkPreconditions=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx),d(this.measureData,this.opts),this.checkGraceIdx(),this.checkSlash()},i.checkGraceIdx=function(){this.getVoice().checkGraceIdx(this.opts.noteIdx,this.opts.graceIdx)},i.checkSlash=function(){var c=this.getVoice(),d=c.getGrace(this.opts.noteIdx,this.opts.graceIdx);if(!b.isSlashedGrace(d))throw new a},i.getVoice=function(){return null===this.voice&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},i.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.removeGraceSlash(),this.updateStack()},i.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos,graceIdx:this.opts.graceIdx}};this.cancelStack.storeAction(b)}},i.removeGraceSlash=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx};new c(this.measureData,a,this.cancelStack).perform()},i.updateStack=function(){var a=this.getLocation(),b={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos,graceIdx:this.opts.graceIdx}};this.cancelStack.push(b)},i.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.noChange.NoChangeError,b=Adagio.Utils.pitchUtils,c=Adagio.Utils.noteUtils,d=Adagio.edit.primitive.DeleteGraceNote,e=Adagio.edit.composite.UpdateAccidental,f=Adagio.edit.composite.UpdateGraceAccidental,g=Adagio.edit.action.RemoveGraceSlash,h=Adagio.edit.common.assertPerform,i=Adagio.edit.common.initMeasureData,j=Adagio.edit.composite.DeleteGraceNote=function(a,b,c){this.init(a,b,c)};j.NAME="composite.DeleteGraceNote";var k=j.prototype;k.name=j.NAME,k.initMeasureData=i,k.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},k.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeSlash();var a=this.getNoteData();this.deleteGraceNote(),this.updateAccidental(a)},k.removeSlash=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx},b=new g(this.measureData,a,this.cancelStack);h(b,l)};var l=function(b){return b instanceof a};k.getNoteData=function(){var a=this.getVoice(),d=a.getGrace(this.opts.noteIdx,this.opts.graceIdx),e=c.getPitch(d);return{staffIdx:c.getStaffIdx(d),pitch:b.copyWithoutAlter(e)}},k.deleteGraceNote=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx};new d(this.measureData,a,this.cancelStack).perform()},k.updateAccidental=function(a){var c,d={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:a.staffIdx,noteIdx:this.opts.noteIdx,pitch:b.copy(a.pitch)},g=this.getVoice(),h=g.getNbGraces(this.opts.noteIdx);this.opts.graceIdx<h?(d.graceIdx=this.opts.graceIdx,c=new f(this.measureData,d,this.cancelStack)):c=new e(this.measureData,d,this.cancelStack),c.perform()},k.getVoice=function(){var a=this.opts.voiceIdx;return this.measureData.getVoice(a)}}.call(this),function(){"use strict";var a=Adagio.Error.client.NotPossibleOnUnpitchedError,b=Adagio.Utils.pitchUtils,c=Adagio.Utils.noteUtils,d=Adagio.edit.common.convertPartUuidToGetPartIdx,e=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,f=Adagio.edit.common.convertTimePosToGetNoteIdx,g=Adagio.edit.composite.DeleteGraceNote,h=Adagio.edit.common.initMeasureData,i=Adagio.edit.action.DeleteGraceNote=function(a,b,c){this.init(a,b,c)};i.NAME="action.DeleteGraceNote";var j=i.prototype;j.name=i.NAME,j.initMeasureData=h,j.init=function(a,b,c){d(a,b),e(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,f(this.measureData,this.opts),this.location=null},j.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx);var a=this.measureData.getVoice(this.opts.voiceIdx);a.checkGraceIdx(this.opts.noteIdx,this.opts.graceIdx),a.checkGraceNotChord(this.opts.noteIdx,this.opts.graceIdx)},j.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new a},j.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a=this.getNoteData();this.deleteGraceNote(),this.updateStack(a)},j.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,timePos:a.timePos,divisions:a.dpq,graceIdx:this.opts.graceIdx}};this.cancelStack.storeAction(b)}},j.getNoteData=function(){var a=this.measureData.getVoice(this.opts.voiceIdx),d=a.getGrace(this.opts.noteIdx,this.opts.graceIdx),e=c.getStaffIdx(d),f=c.getDurationType(d),g=c.getPitch(d),h=b.getAlter(g),i=b.alterToAccidental(h);return{staffIdx:e,durationType:f,pitch:b.copyWithoutAlter(g),accidental:i}},j.deleteGraceNote=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx};new g(this.measureData,a,this.cancelStack).perform()},j.updateStack=function(a){var c=this.getLocation(),d=b.copy(a.pitch),e={type:this.name,noDraw:!0,opts:{partUuid:c.partUuid,measureUuid:c.measureUuid,voiceIdx:this.opts.voiceIdx,staffIdx:a.staffIdx,graceIdx:this.opts.graceIdx,timePos:c.timePos,divisions:c.dpq,durationType:a.durationType,pitch:d,accidental:a.accidental}};this.cancelStack.push(e)},j.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.pitchUtils,c=Adagio.edit.common.initMeasureData,d=Adagio.edit.primitive.RemoveGraceFromChord=function(a,b,c){this.init(a,b,c)};d.NAME="primitive.RemoveGraceFromChord";var e=d.prototype;e.name=d.NAME,e.initMeasureData=c,e.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},e.perform=function(){var a=this.getVoice(),b=a.getGraceChord(this.opts.noteIdx,this.opts.graceIdx),c=b.findIndex(this.pitchPredicate,this);a.removeGraceFromChord(this.opts.noteIdx,this.opts.graceIdx,c),this.updateStack()},e.pitchPredicate=function(c){var d=a.getPitch(c),e=this.opts.pitch;return b.isSameLine(d,e)},e.getVoice=function(){var a=this.opts.voiceIdx;return this.measureData.getVoice(a)},e.updateStack=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx},b={type:this.name,opts:a};this.cancelStack.push(b)}}.call(this),function(){"use strict";var a=Adagio.Utils.pitchUtils,b=Adagio.Utils.noteUtils,c=Adagio.edit.primitive.RemoveGraceFromChord,d=Adagio.edit.composite.UpdateGraceAccidental,e=Adagio.edit.common.initMeasureData,f=Adagio.edit.composite.RemoveGraceFromChord=function(a,b,c){this.init(a,b,c)};f.NAME="composite.RemoveGraceFromChord";var g=f.prototype;g.name=f.NAME,g.initMeasureData=e,g.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},g.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a=this.getNoteData();this.removeGraceFromChord(),this.updateAccidental(a)},g.getNoteData=function(){var a=this.getVoice(),c=a.getGrace(this.opts.noteIdx,this.opts.graceIdx);return{staffIdx:b.getStaffIdx(c)}},g.removeGraceFromChord=function(){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,pitch:a.copy(this.opts.pitch)};new c(this.measureData,b,this.cancelStack).perform()},g.updateAccidental=function(b){var c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:b.staffIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,pitch:a.copy(this.opts.pitch)};new d(this.measureData,c,this.cancelStack).perform()},g.getVoice=function(){var a=this.opts.voiceIdx;return this.measureData.getVoice(a)}}.call(this),function(){"use strict";var a=Adagio.Error.client.NotPossibleOnUnpitchedError,b=Adagio.Error.client.PitchCollisionError,c=Adagio.Utils.pitchUtils,d=Adagio.Utils.noteUtils,e=Adagio.edit.common.checkOptsPitch,f=Adagio.edit.common.convertLineToPitch,g=Adagio.edit.common.convertPartUuidToGetPartIdx,h=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,i=Adagio.edit.common.convertTimePosToGetNoteIdx,j=Adagio.edit.common.transposePitchLineOpts,k=Adagio.edit.common.getGraceAtPitch,l=Adagio.edit.composite.RemoveGraceFromChord,m=Adagio.edit.common.initMeasureData,n=Adagio.edit.action.RemoveGraceFromChord=function(a,b,c){this.init(a,b,c)};n.NAME="action.RemoveGraceFromChord";var o=n.prototype;o.name=n.NAME,o.initMeasureData=m,o.init=function(a,b,c){g(a,b),h(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,i(this.measureData,this.opts),this.sanitized=!1,this.location=null},o.checkPreconditions=function(){this.checkValues(),this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx);var a=this.measureData.getVoice(this.opts.voiceIdx);a.checkGraceIdx(this.opts.noteIdx,this.opts.graceIdx),a.checkGraceChord(this.opts.noteIdx,this.opts.graceIdx),this.sanitizeIfNeeded(),this.checkPitch(),this.checkPitchExist()},o.checkValues=function(){e(this.opts)},o.checkPitch=function(){c.check(this.opts.pitch)},o.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new a},o.checkPitchExist=function(){this.sanitizeIfNeeded();var a=this.measureData.getVoice(this.opts.voiceIdx);if(void 0===k(a,this.opts.noteIdx,this.opts.graceIdx,this.opts.pitch)){var d=c.copy(this.opts.pitch);throw new b(b.action.GET,d)}},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded(),this.storeAction();var a=this.getNoteData();this.removeGraceFromChord(),this.updateStack(a)},o.sanitizeIfNeeded=function(){this.sanitized||(void 0!==this.opts.line&&f(this.measureData,this.opts,!0),this.opts.isConcertPitch&&j(this.measureData,this.opts),this.sanitized=!0)},o.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,timePos:a.timePos,divisions:a.dpq,graceIdx:this.opts.graceIdx,pitch:c.copyWithoutAlter(this.opts.pitch)}};this.cancelStack.storeAction(b)}},o.getNoteData=function(){var a=this.measureData.getVoice(this.opts.voiceIdx),b=k(a,this.opts.noteIdx,this.opts.graceIdx,this.opts.pitch),e=d.getStaffIdx(b),f=d.getPitch(b),g=c.getAlter(f);return{staffIdx:e,accidental:c.alterToAccidental(g)}},o.removeGraceFromChord=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,pitch:c.copy(this.opts.pitch)};new l(this.measureData,a,this.cancelStack).perform()},o.updateStack=function(a){var b=this.getLocation(),d={type:this.name,noDraw:!0,opts:{partUuid:b.partUuid,measureUuid:b.measureUuid,voiceIdx:this.opts.voiceIdx,staffIdx:a.staffIdx,graceIdx:this.opts.graceIdx,timePos:b.timePos,divisions:b.dpq,pitch:c.copyWithoutAlter(this.opts.pitch),accidental:a.accidental}};this.cancelStack.push(d)},o.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Utils.pitchUtils,b=Adagio.Utils.noteUtils,c=Adagio.Utils.typeUtils,d=Adagio.edit.action.DeleteGraceNote,e=Adagio.edit.action.RemoveGraceFromChord,f=Adagio.edit.common.initMeasureData,g=Adagio.edit.composite.DeleteGracesAtNote=function(a,b,c){this.init(a,b,c)};g.NAME="composite.DeleteGracesAtNote";var h=g.prototype;h.name=g.NAME,h.initMeasureData=f,h.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},h.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);for(var a=this.measureData.getVoice(this.opts.voiceIdx),b=a.getNbGraces(this.opts.noteIdx),d=0;d<b;d++){var e=a.getGraceChord(this.opts.noteIdx,0);e=c.makeArray(e),e=e.slice(),e.forEach(this.removeGraceHead,this)}},h.removeGraceHead=function(c,d,e){if(d===e.length-1)this.deleteGrace();else{var f=b.getPitch(c);f=a.copy(f),this.removeGraceFromChord(f)}},h.deleteGrace=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:0},b=new d(this.measureData,a,this.cancelStack);b.checkPreconditions(),b.perform()},h.removeGraceFromChord=function(a){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:0,pitch:a},c=new e(this.measureData,b,this.cancelStack);c.checkPreconditions(),c.perform()}}.call(this),function(){"use strict";var a=Adagio.Error.noChange.NoChangeError,b=Adagio.Values.ArticulationType,c=Adagio.Utils.noteUtils,d=Adagio.Utils.pitchUtils,e=Adagio.Utils.technicalUtils,f=Adagio.edit.primitive.RemoveSingleNote,g=Adagio.edit.action.RemoveTie,h=Adagio.edit.action.RemoveHammerOnPullOffs,i=Adagio.edit.action.RemoveGlissandos,j=Adagio.edit.action.UnbeamNote,k=Adagio.edit.action.UntieNote,l=Adagio.edit.action.RemoveEdgeHammerOnPullOffs,m=Adagio.edit.action.RemoveEdgeGlissandos,n=Adagio.edit.action.FormatBeamsRandPos,o=Adagio.edit.action.RemoveArticulation,p=Adagio.edit.action.RemoveTechnical,q=Adagio.edit.action.RemoveOrnament,r=Adagio.edit.action.RemoveLyrics,s=Adagio.edit.action.RemoveCourtesyAccidental,t=Adagio.edit.action.RemoveGhostNote,u=Adagio.edit.action.RemoveFingering,v=Adagio.edit.composite.AddRests,w=Adagio.edit.composite.AdaptDpqToTimeSignature,x=Adagio.edit.composite.UpdateAccidental,y=Adagio.edit.composite.DispatchSlurSide,z=Adagio.edit.composite.DeleteGracesAtNote,A=Adagio.edit.values.InsertMode,B=Adagio.edit.common.initMeasureData,C=Adagio.edit.common.assertPerform,D=Adagio.edit.composite.RemoveSingleNote=function(a,b,c){this.init(a,b,c)};D.NAME="composite.RemoveSingleNote";var E=D.prototype;E.name=D.NAME,E.initMeasureData=B,E.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},E.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.opts.insertMode===A.INSERT&&(this.removeLastNoteTie(),this.removeLastNoteHammerOnPullOff(),this.removeLastNoteGlissandos()),this.adaptDpqToTimeSignature(),this.unbeamNote(),this.untieNote(),this.removeGraces(),this.removeGlissandos();var a=this.getNote();this.removeHammerOnPullOff(a),this.removeCourtesyAccidental(a),this.removeFingering(a),this.removeGhostNote(a),this.removeArticulations(a),this.removeTechnicals(a),this.removeOrnaments(a),this.removeLyrics(),this.dispatchSlurSide(a),this.removeSingleNote(),this.restoreSpace(a),this.updateAccidental(a),this.opts.insertMode===A.INSERT&&this.formatBeams()},E.adaptDpqToTimeSignature=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx};new w(this.measureData,a,this.cancelStack).perform()},E.removeLastNoteTie=function(){var a=this.getVoiceOrTuplet(),b=a.getStopNoteIdx(),c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:b};new g(this.measureData,c,this.cancelStack).performIfPossible()},E.removeLastNoteGlissandos=function(){var a=this.getVoiceOrTuplet(),b=a.getStopNoteIdx(),c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:b};new i(this.measureData,c,this.cancelStack).performIfPossible()},E.removeLastNoteHammerOnPullOff=function(){var a=this.getVoiceOrTuplet(),b=a.getStopNoteIdx(),c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:b};new h(this.measureData,c,this.cancelStack).performIfPossible()},E.getVoiceOrTuplet=function(){var a=this.opts.voiceIdx,b=this.opts.noteIdx;return this.measureData.getVoiceOrTupletForGet(a,b)},E.unbeamNote=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new j(this.measureData,a,this.cancelStack).performIfPossible()},E.untieNote=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new k(this.measureData,a,this.cancelStack).performIfPossible()},E.removeHammerOnPullOff=function(a){var b=c.getPitch(a),e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:d.copy(b)};new l(this.measureData,e,this.cancelStack).performIfPossible()},E.removeCourtesyAccidental=function(a){var b=c.getPitch(a),e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:d.copy(b)},f=new s(this.measureData,e,this.cancelStack);C(f,F)},E.removeFingering=function(a){var b=c.getPitch(a),e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:d.copy(b)},f=new u(this.measureData,e,this.cancelStack);C(f,F)},E.removeGhostNote=function(a){var b=c.getPitch(a),e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:d.copy(b)},f=new t(this.measureData,e,this.cancelStack);C(f,F)};var F=function(b){return b instanceof a};E.removeGraces=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new z(this.measureData,a,this.cancelStack).perform()},E.removeGlissandos=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new m(this.measureData,a,this.cancelStack).performIfPossible()},E.getNote=function(){return this.getVoice().getNote(this.opts.noteIdx)},E.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},E.dispatchSlurSide=function(a){if(c.hasSlur(a)){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new y(this.measureData,b,this.cancelStack).perform()}},E.removeSingleNote=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new f(this.measureData,a,this.cancelStack).perform()},E.restoreSpace=function(a){var b=c.getDuration(a),d=c.getStaffIdx(a),e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:d,noteIdx:this.opts.noteIdx,duration:b,insertMode:this.opts.insertMode};new v(this.measureData,e,this.cancelStack).perform()},E.updateAccidental=function(a){var b=c.getStaffIdx(a),e=c.getPitch(a),f={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:b,noteIdx:this.opts.noteIdx,pitch:d.copy(e)};new x(this.measureData,f,this.cancelStack).perform()},E.formatBeams=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new n(this.measureData,a,this.cancelStack).performIfPossible()},E.removeArticulations=function(a){var d=c.getArticulationsList(a);d=d.filter(b.isValid),d.forEach(function(a){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,articulationType:a};new o(this.measureData,b,this.cancelStack).perform()},this)},E.removeTechnicals=function(a){var b=c.getTechnical(a);c.getTechnicalList(a).forEach(function(a){var c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,technicalType:a,technicalOpts:e.getTechnicalOpts(b,a)};new p(this.measureData,c,this.cancelStack).perform()},this)},E.removeOrnaments=function(a){c.getOrnamentsList(a).forEach(function(a){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,ornamentType:a};new q(this.measureData,b,this.cancelStack).perform()},this)},E.removeLyrics=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new r(this.measureData,a,this.cancelStack).performIfPossible()}}.call(this),function(){"use strict";var a=Adagio.Error.client.NotPossibleOnUnpitchedError,b=Adagio.Error.client.NotPossibleOnChordError,c=Adagio.edit.values.InsertMode,d=Adagio.edit.composite.RemoveSingleNote,e=Adagio.edit.common.initMeasureData,f=Adagio.edit.action.RemoveSingleNote=function(a,b,c){this.init(a,b,c)};f.NAME="action.RemoveSingleNote";var g=f.prototype;g.name=f.NAME,g.initMeasureData=e,g.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.sanitized=!1,this.voice=null},g.checkPreconditions=function(){this.sanitizeIfNeeded(),this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkNoteIdx(),this.checkNotChord(),this.checkNotRest()},g.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new a},g.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},g.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},g.checkNotChord=function(){if(this.getVoice().isChord(this.opts.noteIdx))throw new b},g.getVoice=function(){return null===this.voice&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},g.perform=function(){this.sanitizeIfNeeded(),this.cancelStack=this.cancelStack.createSubstack(this.name);var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,insertMode:this.opts.insertMode};new d(this.measureData,a,this.cancelStack).perform()},g.sanitizeIfNeeded=function(){this.sanitized||(void 0===this.opts.insertMode&&(this.opts.insertMode=c.REPLACE),this.sanitized=!0)}}.call(this),function(){"use strict";var a=Adagio.Utils.durationUtils,b=Adagio.Utils.timeModifUtils,c=Adagio.Error.client.ClientError,d=Adagio.Error.client.NotEnoughSpaceError=function(d,f,g,h){d=a.actualToNormal(d,h),f=a.actualToNormal(f,h);var i=1/a.extractSmallestBaseDuration(d);i>1&&(d*=i,f*=i,g*=i);var j=e(d,f,g),k=c.call(this,j);return this.name=k.name="NotEnoughSpaceError",this.stack=k.stack,this.message=k.message,this.requiredSpace=d,this.availableSpace=f,this.divisionsPerQuarter=g,this.timeModif=b.copy(h),this},e=function(b,c,d){return"There is not enough space available. Space needed: "+a.durationToFractionString(b,d)+" quarter notes, space available: "+a.durationToFractionString(c,d)+". "};d.prototype=Object.create(c.prototype,{constructor:{value:d}})}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.DurationTooSmallError=function(){var b="cannot have a duration frame lower than a sixty fourth",c=a.call(this,b);return this.name=c.name="DurationTooSmallError",this.stack=c.stack,this.message=c.message,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}})}.call(this),function(){"use strict";var a=Adagio.Error.value.BadDurationTypeError,b=Adagio.Error.value.BadNbDotsError,c=Adagio.Error.client.DurationTooSmallError,d=Adagio.Values.DurationType,e=Adagio.Utils.durationUtils;Adagio.edit.common.checkOptsDuration=function(c){if(!d.isValid(c.durationType))throw new a(c.durationType);if(!e.isNbDotsValid(c.nbDots))throw new b(c.nbDots);f(c)};var f=function(a){var b=a.durationType,e=d.toRoomForDots(b);if((a.nbDots||0)>e)throw new c}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.clone,c=Adagio.Utils.typeUtils,d=Adagio.Utils.math,e=Adagio.Utils.noteUtils,f=Adagio.Utils.durationUtils,g=Adagio.history.note.noteHistoryUtils,h=Adagio.edit.common.extractNoteDurationType,i=Adagio.edit.common.calcDuration,j=Adagio.edit.common.initMeasureData,k=Adagio.edit.primitive.ChangeDuration=function(a,b,c){this.init(a,b,c)};k.NAME="primitive.ChangeDuration";var l=k.prototype;l.name=k.NAME,l.initMeasureData=j,l.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,f.fillDefaultOpts(this.opts)},l.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a=this.getCurrentDurationOpts();this.changeDuration(),this.updateStack(a)},l.getCurrentDurationOpts=function(){var a=this.getNote();return{nbDots:e.getNbDots(a),durationType:this.getDurationType(a)}},l.getNote=function(){return this.getVoice().getNote(this.opts.noteIdx)},l.getDurationType=function(a){var b=this.measureData.getDpqValue();return h(a,b)},l.changeDuration=function(){var a=this.getVoice(),d=a.getChord(this.opts.noteIdx);if(d=c.makeArray(d),d.forEach(this.changeHeadDuration,this),this.cancelStack.hasPayload()){var e=a.getNote(this.opts.noteIdx),f=this.cancelStack.getPayload(),h=b(f.headCssClassesSet);g.setGlobalCssClassesSet(e,h)}},l.changeHeadDuration=function(a){var c=this.getDuration();if(e.setDuration(a,c),e.setNbDots(a,this.opts.nbDots),this.cancelStack.hasPayload()){var d=this.cancelStack.getPayload(),f=b(d.headCssClassesSet);g.setHeadCssClassesSet(a,f)}},l.getDuration=function(){var b=this.measureData.getDpqValue(),c=this.getVoiceOrTupletForGet(),e=c.getAbsoluteTimeModif(),f=i(this.opts,b,e);if(!d.isInteger(f)){throw new a("IntegerExpected","At this point, the divisions duration ["+f+"] should be an integer.")}return f},l.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},l.getVoiceOrTupletForGet=function(){var a=this.opts.voiceIdx,b=this.opts.noteIdx;return this.measureData.getVoiceOrTupletForGet(a,b)},l.updateStack=function(a){var b={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,durationType:this.opts.durationType,nbDots:this.opts.nbDots,previousDurationType:a.durationType,previousNbDots:a.nbDots}};this.cancelStack.push(b)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.noteUtils,c=Adagio.edit.values.InsertMode,d=Adagio.edit.composite.AddRests,e=Adagio.edit.primitive.RemoveRest,f=Adagio.edit.common.initMeasureData,g=Adagio.edit.composite.RemoveRests=function(a,b,c){this.init(a,b,c)};g.NAME="composite.RemoveRests";var h=g.prototype;h.name=g.NAME,h.initMeasureData=f,h.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},h.perform=function(){if(this.cancelStack=this.cancelStack.createSubstack(this.name),this.opts.insertMode===c.INSERT)this.removeAtEnd();else{if(this.opts.insertMode!==c.REPLACE){var b="Unexpected insert mode: ["+this.opts.insertMode+"].";throw new a("Unexpected",b)}this.removeAtIdx()}},h.removeAtEnd=function(){for(var a=this.opts.duration,b=this.getVoice(),c=b.getStopNoteIdx();a>0;c--)a=this.processRest(c,a)},h.removeAtIdx=function(){for(var a=this.opts.duration;a>0;)a=this.processRest(this.opts.noteIdx,a)},h.processRest=function(a,c){var d=this.getVoice(),e=d.getNote(a),f=b.getDuration(e);if(f<=c)c-=f,this.removeRest(a);else{var g=f-c;c=0;var h=b.getStaffIdx(e);this.removeRest(a),this.restoreRest(a,g,h)}return c},h.getVoice=function(){var a=this.opts.voiceIdx,b=this.opts.noteIdx;return this.measureData.getVoiceOrTupletForGet(a,b)},h.removeRest=function(a){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:a};new e(this.measureData,b,this.cancelStack).perform()},h.restoreRest=function(a,b,c){var e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:c,noteIdx:a,duration:b,insertMode:this.opts.insertMode};new d(this.measureData,e,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.DoesntHaveNotationError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="DoesntHaveNotationError",this.stack=e.stack,this.message=e.message,this.notationType=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"Note doesn't have a notation of the type ["+a+"]."}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadNotationTypeError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadNotationTypeError",this.stack=e.stack,this.message=e.message,this.type=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"Notation "+a+"is invalid."}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.edit.common.initMeasureData,c=Adagio.edit.primitive.RemoveNotation=function(a,b,c){this.init(a,b,c)};c.NAME="primitive.RemoveNotation";var d=c.prototype;d.name=c.NAME,d.initMeasureData=b,d.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},d.perform=function(){var b=this.measureData.getVoice(this.opts.voiceIdx),c=b.getNote(this.opts.noteIdx);a.removeNotation(c,this.opts.notationType),this.updateStack()},d.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,notationType:this.opts.notationType,noteIdx:this.opts.noteIdx}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.Error.value.BadNotationTypeError,b=Adagio.Error.client.DoesntHaveNotationError,c=Adagio.Utils.noteUtils,d=Adagio.Utils.timeModifUtils,e=Adagio.Values.NotationType,f=Adagio.edit.common.initMeasureData,g=Adagio.edit.common.convertTimePosToGetNoteIdx,h=Adagio.edit.common.convertPartUuidToGetPartIdx,i=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,j=Adagio.edit.primitive.RemoveNotation,k=Adagio.edit.action.RemoveNotation=function(a,b,c){this.init(a,b,c)};k.NAME="action.RemoveNotation";var l=k.prototype;l.initMeasureData=f,
l.name=k.NAME,l.init=function(a,b,c){h(a,b),i(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.location=null,g(this.measureData,this.opts)},l.checkPreconditions=function(){this.checkLocation(),this.checkExistence()},l.checkLocation=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.measureData.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},l.checkExistence=function(){if(!e.isValid(this.opts.notationType))throw new a(this.opts.notationType);var d=this.measureData.getVoice(this.opts.voiceIdx),f=d.getNote(this.opts.noteIdx);if(!c.hasNotation(f,this.opts.notationType))throw new b(this.opts.notationType)},l.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,notationType:this.opts.notationType,noteIdx:this.opts.noteIdx};new j(this.measureData,a,this.cancelStack).perform(),this.updateStack()},l.updateStack=function(){var a=this.getLocation(),b=d.copy(a.timeModif),c={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,notationType:this.opts.notationType,timePos:a.timePos,divisions:a.dpq,timeModif:b}};this.cancelStack.push(c)},l.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,notationType:this.opts.notationType,timePos:a.timePos,divisions:a.dpq}};this.cancelStack.storeAction(b)}},l.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),e=a.getMeasureUuid(this.opts.measureIdx),f=this.measureData.getDpqValue(),g=this.measureData.getVoice(this.opts.voiceIdx),h=g.getRangeSpace(0,this.opts.noteIdx),i=g.getNote(this.opts.noteIdx),j=c.getTimeModif(i);j=d.copy(j),this.location={partUuid:b,measureUuid:e,dpq:f,timePos:h,timeModif:j}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.client.DoesntHaveNotationError,b=Adagio.Error.InternalError,c=Adagio.edit.action.RemoveLyrics,d=Adagio.edit.action.RemoveNotation,e=Adagio.edit.common.initMeasureData,f=Adagio.edit.common.assertPerform,g=Adagio.Values.NotationType,h=Adagio.edit.composite.UnlockRest=function(a,b,c){this.init(a,b,c)};h.NAME="primitive.UnlockRest";var i=h.prototype;i.name=h.NAME,i.initMeasureData=e,i.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},i.perform=function(){this.assertRest(),this.removeLyrics(),this.removeFermata()},i.assertRest=function(){if(!this.measureData.getVoice(this.opts.voiceIdx).isRest(this.opts.noteIdx))throw new b("RestExpected")},i.removeLyrics=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new c(this.measureData,a,this.cancelStack).performIfPossible()},i.removeFermata=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,notationType:g.FERMATA},b=new d(this.measureData,a,this.cancelStack);f(b,j)};var j=function(b){return b instanceof a}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.noteUtils,c=Adagio.edit.values.InsertMode,d=Adagio.edit.composite.UnlockRest,e=Adagio.edit.common.initMeasureData,f=Adagio.edit.composite.UnlockRests=function(a,b,c){this.init(a,b,c)};f.NAME="composite.UnlockRests";var g=f.prototype;g.name=f.NAME,g.initMeasureData=e,g.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},g.perform=function(){if(this.cancelStack=this.cancelStack.createSubstack(this.name),this.opts.insertMode===c.INSERT)this.unlockAtEnd();else{if(this.opts.insertMode!==c.REPLACE){var b="Unexpected insert mode: ["+this.opts.insertMode+"].";throw new a("Unexpected",b)}this.unlockAtIdx()}},g.unlockAtEnd=function(){for(var a=this.opts.duration,b=this.getVoice(),c=b.getStopNoteIdx();a>0;c--)a=this.unlockRestAndConsumeDuration(c,a)},g.unlockAtIdx=function(){for(var a=this.opts.duration;a>0;this.opts.noteIdx++)a=this.unlockRestAndConsumeDuration(this.opts.noteIdx,a)},g.unlockRestAndConsumeDuration=function(a,c){var d=this.getVoice(),e=d.getNote(a);return c-=b.getDuration(e),this.unlockRest(a),c},g.getVoice=function(){var a=this.opts.voiceIdx,b=this.opts.noteIdx;return this.measureData.getVoiceOrTupletForGet(a,b)},g.unlockRest=function(a){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:a};new d(this.measureData,b,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.NotPossibleOnPitchedError=function(){var b="This operation is not allowed on a pitched part",c=a.call(this,b);return this.name=c.name="NotPossibleOnPitchedError",this.stack=c.stack,this.message=c.message,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}})}.call(this),function(){"use strict";var a=Adagio.Utils.drumsetUtils,b=Adagio.Error.client.ClientError,c=Adagio.Error.client.UnpitchedCollisionError=function(a,c,e){var f=d(a,c,e),g=b.call(this,f);return this.name=g.name="UnpitchedCollisionError",this.stack=g.stack,this.message=g.message,this.unpitched=c,this.action=a,this};c.prototype=Object.create(b.prototype,{constructor:{value:c}});var d=function(b,d,e){var f;if(b===c.INSERT)f="There is already an unpitched note at the line ";else{if(b!==c.GET)return"fail at failing, bad action provided: ["+b+"]";f="There is no unpitched note at the line "}return f+=a.pitchToLine(d,e)};c.INSERT="insert",c.GET="get"}.call(this),function(){"use strict";Adagio.edit.common.getStaffDetails=function(a,b){var c=a.getVoiceMainStaffIdx(b.voiceIdx);return a.getStaffDetails(c)}}.call(this),function(){"use strict";var a=Adagio.edit.common.getStaffDetails,b=Adagio.Utils.staffDetailsUtils;Adagio.edit.common.getNbStaffLines=function(c,d){var e=a(c,d);return b.getNbStaffLines(e)}}.call(this),function(){"use strict";var a=Adagio.edit.common.getNbStaffLines,b=Adagio.Utils.drumsetUtils,c=Adagio.Utils.unpitchedUtils;Adagio.edit.common.lineToDestUnpitched=function(){if(void 0!==this.opts.line){var d=a(this.measureData,this.opts),e=b.lineToPitch(this.opts.line,d);this.opts["display-octave"]=c.getOctave(e),this.opts["display-step"]=c.getStep(e),delete this.opts.line}}}.call(this),function(){"use strict";var a=Adagio.Error.client.NotPossibleOnRestsError,b=Adagio.Error.client.UnpitchedCollisionError,c=Adagio.Error.client.TieError,d=Adagio.Error.client.BadPartIdxError,e=Adagio.Error.client.BadMeasureIdxError,f=Adagio.Error.client.BadVoiceError,g=Adagio.Error.client.BadNoteIdxError,h=Adagio.Error.client.NotPossibleOnPitchedError,i=Adagio.Utils.noteUtils,j=Adagio.Utils.unpitchedUtils,k=Adagio.Data.tieAction,l=Adagio.edit.common.CrossMeasure,m=Adagio.edit.common.convertTimePosToGetNoteIdx,n=Adagio.edit.common.noteIdxToTimePos,o=Adagio.edit.common.convertPartUuidToGetPartIdx,p=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,q=Adagio.edit.common.initMeasureData,r=Adagio.edit.common.lineToDestUnpitched,s=Adagio.edit.common.getNbStaffLines,t=Adagio.edit.action.RemoveTieArcPercu=function(a,b,c){this.init(a,b,c)};t.NAME="action.RemoveTieArcPercu",t.isAuthorizedException=function(i){return i instanceof d||i instanceof e||i instanceof f||i instanceof g||i instanceof c||i instanceof a||i instanceof b||i instanceof h};var u=t.prototype;u.name=t.NAME,u.initMeasureData=q,u.lineToDestUnpitched=r,u.init=function(a,b,c){o(a,b),p(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,m(this.measureData,b),this.crossMeasure=new l(this.measureData,b.voiceIdx,b.noteIdx),this.location=null},u.checkPreconditions=function(){this.checkUnpitchedPart(),this.crossMeasure.checkVoiceIdx(),this.crossMeasure.checkNoteIdx(),this.checkNotRest(),this.lineToDestUnpitched(),this.checkUnpitched()},u.checkUnpitchedPart=function(){if(!this.measureData.isUnpitched())throw new h},u.checkNotRest=function(){if(this.isLeftRest()||this.isRightRest())throw new a},u.isLeftRest=function(){return this.crossMeasure.isLeftRest()},u.isRightRest=function(){return this.crossMeasure.isRightRest()},u.checkUnpitched=function(){var a=s(this.measureData,this.opts),d=this.getLeftChord(),e=this.getRightChord(),f=d.find(this.unpitchedPredicate,this);if(void 0===f)throw new b(b.GET,this.opts,a);var g=e.find(this.unpitchedPredicate,this);if(void 0===g)throw new b(b.GET,this.opts,a);var h=i.getUnpitched(f),l=i.getUnpitched(g);if(!j.isSame(h,l))throw new c(this.name,"notes must have the same pitch");if(!k.areNotesTied(f,g))throw new c(this.name,"notes are not tied")},u.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a=this.getLeftChord(),b=a.find(this.unpitchedPredicate,this),c=i.getUnpitched(b),d=this.getRightChord(),e=d.find(this.unpitchedPredicate,this);k.untieNotes(b,e),this.updateStack(c)},u.unpitchedPredicate=function(a){var b=i.getUnpitched(a);return j.isSameLine(b,this.opts)},u.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,divisions:a.dpq,timePos:a.timePos,voiceIdx:this.opts.voiceIdx,"display-octave":this.opts["display-octave"],"display-step":this.opts["display-step"]}};this.cancelStack.storeAction(b)}},u.getLeftChord=function(){return this.crossMeasure.getLeftChord()},u.getRightChord=function(){return this.crossMeasure.getRightChord()},u.updateStack=function(a){this.opts.leftNoteIdx=this.crossMeasure.getLeftNoteIdx(),this.opts.leftMeasureIdx=this.crossMeasure.getLeftMeasureIdx(),this.opts.rightNoteIdx=this.crossMeasure.getRightNoteIdx(),this.opts.rightMeasureIdx=this.crossMeasure.getRightMeasureIdx();var b=this.getLocation(),c={type:this.name,opts:{partIdx:this.opts.partIdx,partUuid:b.partUuid,measureIdx:this.opts.leftMeasureIdx,measureUuid:b.measureUuid,noteIdx:this.opts.leftNoteIdx,timePos:b.timePos,divisions:b.dpq,voiceIdx:this.opts.voiceIdx,unpitched:j.copy(a)}};this.cancelStack.push(c);var d={type:this.name+"-close",opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.rightMeasureIdx,noteIdx:this.opts.rightNoteIdx,voiceIdx:this.opts.voiceIdx,unpitched:j.copy(a)}};this.cancelStack.push(d)},u.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=this.crossMeasure.getLeftMeasureIdx(),d=a.getMeasureUuid(c),e=this.crossMeasure.getLeftMeasure().getDpqValue(),f=this.crossMeasure.getLeftVoice(),g=this.crossMeasure.getLeftNoteIdx(),h=n(f,g);this.location={partUuid:b,measureUuid:d,dpq:e,timePos:h}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.client.NotPossibleOnRestsError,b=Adagio.Error.client.TieError,c=Adagio.Error.client.BadPartIdxError,d=Adagio.Error.client.BadMeasureIdxError,e=Adagio.Error.client.BadNoteIdxError,f=Adagio.Error.client.NotPossibleOnPitchedError,g=Adagio.Error.client.BadVoiceError,h=Adagio.Utils.noteUtils,i=Adagio.Utils.unpitchedUtils,j=Adagio.Data.tieAction,k=Adagio.edit.action.RemoveTieArcPercu,l=Adagio.edit.common.CrossMeasure,m=Adagio.edit.common.noteIdxToTimePos,n=Adagio.edit.common.convertPartUuidToGetPartIdx,o=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,p=Adagio.edit.common.convertTimePosToGetNoteIdx,q=Adagio.edit.common.initMeasureData,r=Adagio.edit.action.RemoveTiePercu=function(a,b,c){this.init(a,b,c)};r.NAME="action.RemoveTiePercu",r.isAuthorizedException=function(h){return h instanceof c||h instanceof d||h instanceof b||h instanceof a||h instanceof e||h instanceof f||h instanceof g};var s=r.prototype;s.name=r.NAME,s.initMeasureData=q,s.init=function(a,b,c){n(a,b),o(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,p(this.measureData,b),this.crossMeasure=new l(this.measureData,b.voiceIdx,b.noteIdx),this.location=null},s.performIfPossible=function(){var a=!0;try{this.checkPreconditions()}catch(b){if(!r.isAuthorizedException(b))throw b;a=!1}a&&this.perform()},s.checkPreconditions=function(){this.checkUnpitchedPart(),this.crossMeasure.checkVoiceIdx(),this.crossMeasure.checkNoteIdx(),this.checkNotRest(),this.checkCanUntie()},s.checkUnpitchedPart=function(){if(!this.measureData.isUnpitched())throw new f},s.checkNotRest=function(){if(this.isLeftRest()||this.isRightRest())throw new a},s.isLeftRest=function(){return this.crossMeasure.isLeftRest()},s.isRightRest=function(){return this.crossMeasure.isRightRest()},s.checkCanUntie=function(){var a=this.getLeftChord(),c=this.getRightChord();if(!j.canUntieChords(a,c,!0))throw new b(this.name,"nothing can be tied")},s.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a=this.getLeftChord(),b=a.filter(h.hasTieStart).map(h.getUnpitched),c=this.getRightChord();j.untieChords(a,c,!0),this.updateStack(b)},s.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,divisions:a.dpq,timePos:a.timePos,voiceIdx:this.opts.voiceIdx}};this.cancelStack.storeAction(b)}},s.getLeftChord=function(){return this.crossMeasure.getLeftChord()},s.getRightChord=function(){return this.crossMeasure.getRightChord()},s.updateStack=function(a){this.opts.leftNoteIdx=this.crossMeasure.getLeftNoteIdx(),this.opts.leftMeasureIdx=this.crossMeasure.getLeftMeasureIdx(),this.opts.rightNoteIdx=this.crossMeasure.getRightNoteIdx(),this.opts.rightMeasureIdx=this.crossMeasure.getRightMeasureIdx();var b=this.getLocation();a.forEach(function(a){var c={type:k.NAME,opts:{partIdx:this.opts.partIdx,partUuid:b.partUuid,measureIdx:this.opts.leftMeasureIdx,measureUuid:b.measureUuid,noteIdx:this.opts.leftNoteIdx,timePos:b.timePos,divisions:b.dpq,voiceIdx:this.opts.voiceIdx,unpitched:i.copy(a)}};this.cancelStack.push(c);var d={type:k.NAME+"-close",opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.rightMeasureIdx,noteIdx:this.opts.rightNoteIdx,voiceIdx:this.opts.voiceIdx,unpitched:i.copy(a)}};this.cancelStack.push(d)},this)},s.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=this.crossMeasure.getLeftMeasureIdx(),d=a.getMeasureUuid(c),e=this.crossMeasure.getLeftMeasure().getDpqValue(),f=this.crossMeasure.getLeftVoice(),g=this.crossMeasure.getLeftNoteIdx(),h=m(f,g);this.location={partUuid:b,measureUuid:d,dpq:e,timePos:h}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.timeModifUtils,c=Adagio.edit.values.InsertMode,d=Adagio.edit.primitive.ChangeDuration,e=Adagio.edit.composite.AddRests,f=Adagio.edit.composite.RemoveRests,g=Adagio.edit.composite.AdaptDpqToDuration,h=Adagio.edit.composite.AdaptDpqToTimeSignature,i=Adagio.edit.composite.UnlockRests,j=Adagio.edit.action.RemoveTie,k=Adagio.edit.action.RemoveTiePercu,l=Adagio.edit.action.FormatBeamsRandPos,m=Adagio.edit.action.UnbeamNote,n=Adagio.edit.action.RemoveGlissandos,o=Adagio.edit.action.RemoveHammerOnPullOffs,p=Adagio.edit.common.calcDuration,q=Adagio.edit.common.initMeasureData,r=Adagio.edit.composite.ChangeDuration=function(a,b,c){this.init(a,b,c)};r.NAME="composite.ChangeDuration";var s=r.prototype;s.initMeasureData=q,s.name=r.NAME,s.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},s.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.adaptDpqToOptsDuration(),this.adaptDpqToTimeSignature(),this.unbeamIfPossible();var a=this.getActualDuration(),b=this.getRequiredDuration(),d=Math.abs(a-b);b>a&&(this.lockRests(d),this.consumeSpace(d)),this.changeDuration(),b<a&&((this.opts.insertMode===c.REPLACE||this.isLastNote())&&(this.untieIfPossible(),this.removeHammerOnPullOffsIfPossible(),this.removeGlissandosIfPossible()),this.opts.insertMode===c.INSERT&&(this.removeVoiceRightTie(),this.removeVoiceRightGlissandos()),this.addSpace(d)),this.formatBeams()},s.getActualDuration=function(){var b=this.getVoice(),c=b.getNote(this.opts.noteIdx);return a.getDuration(c)},s.getRequiredDuration=function(){var a=this.measureData.getDpqValue(),b=this.getTimeModif();return p(this.opts,a,b)},s.adaptDpqToOptsDuration=function(){var a=b.copy(this.getTimeModif()),c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,nbDots:this.opts.nbDots,durationType:this.opts.durationType,timeModif:a};new g(this.measureData,c,this.cancelStack).perform()},s.adaptDpqToTimeSignature=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx};new h(this.measureData,a,this.cancelStack).perform()},s.unbeamIfPossible=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new m(this.measureData,a,this.cancelStack).performIfPossible()},s.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},s.getTimeModif=function(){return this.getVoiceOrTupletForGet().getAbsoluteTimeModif()},s.getVoiceOrTupletForGet=function(){var a=this.opts.voiceIdx,b=this.opts.noteIdx;return this.measureData.getVoiceOrTupletForGet(a,b)},s.isLastNote=function(){var a=this.getVoiceOrTupletForGet();return this.opts.noteIdx===a.getStopNoteIdx()},s.changeDuration=function(){new d(this.measureData,this.opts,this.cancelStack).perform()},s.lockRests=function(a){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx+1,insertMode:this.opts.insertMode,duration:a};new i(this.measureData,b,this.cancelStack).perform()},s.consumeSpace=function(a){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx+1,insertMode:this.opts.insertMode,duration:a};new f(this.measureData,b,this.cancelStack).perform()},s.untieIfPossible=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new(this.measureData.isUnpitched()?k:j)(this.measureData,a,this.cancelStack).performIfPossible()},s.removeHammerOnPullOffsIfPossible=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new o(this.measureData,a,this.cancelStack).performIfPossible()},s.removeGlissandosIfPossible=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new n(this.measureData,a,this.cancelStack).performIfPossible()},s.addSpace=function(a){var b=this.getStaffIdx(),c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:b,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx+1,insertMode:this.opts.insertMode,duration:a};new e(this.measureData,c,this.cancelStack).perform()},s.getStaffIdx=function(){var b=this.getVoice(),c=b.getNote(this.opts.noteIdx);return a.getStaffIdx(c)},s.removeVoiceRightTie=function(){var a=this.getVoiceOrTupletForGet(),b=a.getStopNoteIdx(),c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:b};new(this.measureData.isUnpitched()?k:j)(this.measureData,c,this.cancelStack).performIfPossible()},s.removeVoiceRightGlissandos=function(){var a=this.getVoiceOrTupletForGet(),b=a.getStopNoteIdx(),c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:b};new n(this.measureData,c,this.cancelStack).performIfPossible()},s.formatBeams=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new l(this.measureData,a,this.cancelStack).performIfPossible()}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Error.client.NotEnoughSpaceError,c=Adagio.Error.noChange.NoChangeError,d=Adagio.Utils.noteUtils,e=Adagio.edit.values.InsertMode,f=Adagio.edit.common.convertTimePosToGetNoteIdx,g=Adagio.edit.common.extractNoteDurationType,h=Adagio.edit.common.convertPartUuidToGetPartIdx,i=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,j=Adagio.edit.common.calcDuration,k=Adagio.edit.common.checkOptsDuration,l=Adagio.edit.composite.ChangeDuration,m=Adagio.edit.common.initMeasureData,n=Adagio.edit.action.ChangeDuration=function(a,b,c){this.init(a,b,c)};n.NAME="action.ChangeDuration",n.isNoChange=function(a){return a instanceof c};var o=n.prototype;o.initMeasureData=m,o.name=n.NAME,o.init=function(a,b,c){h(a,b),i(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,f(this.measureData,this.opts),this.previousDurationType=null,this.previousNbDots=null,this.location=null},o.checkPreconditions=function(){k(this.opts),this.checkLocation(),this.checkAvailableSpace()},o.checkLocation=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.measureData.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},o.checkAvailableSpace=function(){var a=this.getRequiredDuration(),b=this.getActualDuration();if(!(b>a)){if(b===a)throw new c;a-=b;var d=this.getAvailableSpace();d<a&&this.raiseNotEnoughSpace(a,d)}},o.getRequiredDuration=function(){var a=this.measureData.getDpqValue(),b=this.getTimeModif();return j(this.opts,a,b)},o.getTimeModif=function(){return this.getVoiceOrTupletForGet().getAbsoluteTimeModif()},o.getActualDuration=function(){var a=this.getVoice(),b=a.getNote(this.opts.noteIdx);return d.getDuration(b)},o.getAvailableSpace=function(){var b,c=this.getVoiceOrTupletForGet(),d=this.opts.noteIdx+1;if(this.opts.insertMode===e.REPLACE)b=c.getAvailableSpaceAtIdx(d);else{if(this.opts.insertMode!==e.INSERT){var f="The insertion mode value ["+this.opts.insertMode+"] is invalid. ";throw new a("BadInsertMode",f)}b=c.getAvailableSpaceAtEnd(d)}return b},o.raiseNotEnoughSpace=function(a,c){var d=this.getVoiceOrTupletForGet(),e=this.measureData.getDpqValue(),f=d.getAbsoluteTimeModif();throw new b(a,c,e,f)},o.getVoiceOrTupletForGet=function(){var a=this.opts.voiceIdx,b=this.opts.noteIdx;return this.measureData.getVoiceOrTupletForGet(a,b)},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),void 0===this.opts.record&&(this.opts.record=!0),this.opts.record&&this.recordPreviousDuration(),this.storeAction(),this.changeDuration(),this.opts.record&&this.updateStack()},o.recordPreviousDuration=function(){var a=this.getVoice(),b=a.getNote(this.opts.noteIdx),c=this.measureData.getDpqValue();this.previousDurationType=g(b,c),this.previousNbDots=d.getNbDots(b)},o.changeDuration=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,insertMode:this.opts.insertMode,durationType:this.opts.durationType,nbDots:this.opts.nbDots};new l(this.measureData,a,this.cancelStack).perform()},o.updateStack=function(){var a=this.getLocation(),b={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos,previousNbDots:this.previousNbDots,previousDurationType:this.previousDurationType,insertMode:this.opts.insertMode}};this.cancelStack.push(b)},o.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos,nbDots:this.opts.nbDots,durationType:this.opts.durationType,insertMode:this.opts.insertMode}};this.cancelStack.storeAction(b)}},o.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location},o.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)}}.call(this),function(){"use strict";var a=Adagio.Values.DurationType,b=Adagio.Utils.noteUtils,c=Adagio.Utils.durationUtils,d=Adagio.Utils.timeModifUtils,e=Adagio.edit.values.InsertMode,f=Adagio.edit.action.ChangeDuration,g=Adagio.edit.composite.AdaptDpqToDuration,h=Adagio.edit.common.RestDispatcherLeft,i=Adagio.edit.common.initMeasureData,j=Adagio.edit.composite.FormatRests=function(a,b,c){this.init(a,b,c)};j.NAME="composite.FormatRests";var k=j.prototype;k.name=j.NAME,k.initMeasureData=i,k.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.availableSpace=null,this.dispatchedRests=null},k.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.adaptDpq(),this.gatherAvailableSpace(),this.divideSpace(),this.applyDivisions()},k.adaptDpq=function(){var a=this.getDivisionsPerBeat(),b=this.getVoice(),e=b.getAbsoluteTimeModif(),f=this.getDivisionsPerQuarter(),h=c.actualDivisionsToDurationOpts(a,f,e);e=d.copy(e);var i={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,durationType:h.durationType,nbDots:h.nbDots,timeModif:e};new g(this.measureData,i,this.cancelStack).perform()},k.gatherAvailableSpace=function(){for(var a=0,c=this.getVoice(),d=c.getStopNoteIdx(),e=this.opts.noteIdx;e<=d&&c.isRest(e);e++){var f=c.getNote(e);if(e!==this.opts.noteIdx&&(b.hasTupletStart(f)||b.needRestLock(f)))break;a+=b.getDuration(f)}this.availableSpace=a},k.divideSpace=function(){var a=this.getTimePosition(),b=this.availableSpace,c=this.getDivisionsPerBeat(),d=this.getDivisionsPerQuarter(),e=this.getTimeModif(),f=new h(a,b,c,d,e);f.dispatch(),this.dispatchedRests=f.getDispatchedRests()},k.getTimePosition=function(){for(var a=this.getVoice(),c=0,d=a.getStartNoteIdx();d<this.opts.noteIdx;d++){var e=a.getNote(d);c+=b.getDuration(e)}return c},k.getDivisionsPerBeat=function(){var a=this.getVoice();return a.isTuplet()?this.getDivPerBeatFromTimeModif(a):this.getDivPerBeatFromTimeSignature()},k.getDivPerBeatFromTimeSignature=function(){var a=this.measureData.getAnyTime(),b=c.getBeatQuarterDuration(a),d=this.getDivisionsPerQuarter();return c.quarterToDuration(b,d)},k.getDivPerBeatFromTimeModif=function(b){var d=b.getAbsoluteTimeModif(),e=b.getDurationType(),f=this.getDivisionsPerQuarter(),g=a.toQuarterDuration(e),h=c.quarterToDuration(g,f);return c.normalToActual(h,d)},k.getDivisionsPerQuarter=function(){return this.measureData.getDivisionsPerQuarterValue()},k.applyDivisions=function(){this.dispatchedRests.forEach(this.applyDivision,this)},k.applyDivision=function(a,c){var d=this.opts.noteIdx+c,e=this.getVoice(),f=e.getNote(d);b.getDuration(f)!==a&&this.changeDuration(d,a)},k.changeDuration=function(a,b){var c=this.divisionsToDurationOpts(b),d={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:a,insertMode:e.REPLACE,durationType:c.durationType,nbDots:c.nbDots};new f(this.measureData,d,this.cancelStack).perform()},k.divisionsToDurationOpts=function(a){var b=this.getDivisionsPerQuarter(),d=this.getTimeModif();return c.actualDivisionsToDurationOpts(a,b,d)},k.getTimeModif=function(){return this.getVoice().getAbsoluteTimeModif()},k.getVoice=function(){var a=this.opts.voiceIdx,b=this.opts.noteIdx;return this.measureData.getVoiceOrTupletForGet(a,b)}}.call(this),function(){"use strict";var a=Adagio.Error.client.NotPossibleOnNonRestsError,b=Adagio.edit.composite.FormatRests,c=Adagio.edit.common.initMeasureData,d=Adagio.edit.action.FormatRests=function(a,b,c){this.init(a,b,c)};d.NAME="action.FormatRests",d.isAuthorizedException=function(b){return b instanceof a};var e=d.prototype;e.name=d.NAME,e.initMeasureData=c,e.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},e.performIfPossible=function(){this.isPossible()&&this.perform()},e.isPossible=function(){var a=!0;try{this.checkPreconditions()}catch(b){if(!d.isAuthorizedException(b))throw b;a=!1}return a},e.checkPreconditions=function(){this.checkLocation()},e.checkLocation=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx);var a=this.measureData.getVoice(this.opts.voiceIdx);a.checkNoteIdx(this.opts.noteIdx),a.checkRest(this.opts.noteIdx)},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.formatRests()},e.formatRests=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new b(this.measureData,a,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.client.PitchCollisionError,b=Adagio.Error.client.NotPossibleOnUnpitchedError,c=Adagio.Utils.pitchUtils,d=Adagio.Utils.noteUtils,e=Adagio.Utils.timeModifUtils,f=Adagio.edit.values.InsertMode,g=Adagio.edit.common.convertLineToPitch,h=Adagio.edit.common.checkOptsPitch,i=Adagio.edit.common.getNoteAtPitch,j=Adagio.edit.common.convertTimePosToGetNoteIdx,k=Adagio.edit.common.extractNoteDurationType,l=Adagio.edit.common.convertPartUuidToGetPartIdx,m=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,n=Adagio.edit.common.transposePitchLineOpts,o=Adagio.edit.common.extractFret,p=Adagio.edit.action.RemoveFromChord,q=Adagio.edit.action.RemoveSingleNote,r=Adagio.edit.action.FormatRests,s=Adagio.edit.common.initMeasureData,t=!1,u=Adagio.edit.action.RemoveNote=function(a,b,c){this.init(a,b,c)};u.NAME="action.RemoveNote";var v=u.prototype;v.name=u.NAME,v.initMeasureData=s,v.init=function(a,b,c){l(a,b),m(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.sanitized=!1,this.voice=null,this.action=null,this.location=null,j(this.measureData,this.opts)},v.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),j(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),h(this.opts),this.sanitizeIfNeeded(),this.checkPitch(),this.checkAction()},v.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new b},v.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},v.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},v.isChord=function(){return this.getVoice().isChord(this.opts.noteIdx)},v.checkPitch=function(){if(void 0===this.getNoteAtPitch()){var b=c.copy(this.opts.pitch);throw new a(a.action.GET,b)}},v.getNoteAtPitch=function(){var a=this.getVoice();return i(a,this.opts.noteIdx,this.opts.pitch)},v.checkAction=function(){this.getAction().checkPreconditions()},v.getAction=function(){return null===this.action&&this.createAction(),this.action},v.createAction=function(){this.isChord()?this.createRemoveFromChord():this.createRemoveSingleNote()},v.createRemoveFromChord=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:c.copy(this.opts.pitch),record:!1};this.action=new p(this.measureData,a,this.cancelStack)},v.createRemoveSingleNote=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,insertMode:this.opts.insertMode,formatRests:this.opts.formatRests};this.action=new q(this.measureData,a,this.cancelStack)},v.getVoice=function(){return null===this.voice&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},v.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded();var a=this.getNoteAtPitch();this.storeAction(a);var b=this.getAction();b.cancelStack=this.cancelStack,b.perform(),this.updateStack(a),this.shouldFormatRests()&&this.formatRests()},v.sanitizeIfNeeded=function(){this.sanitized||(void 0!==this.opts.line&&g(this.measureData,this.opts,!0),this.opts.isConcertPitch&&n(this.measureData,this.opts),void 0===this.opts.insertMode&&(this.opts.insertMode=f.REPLACE),void 0===this.opts.formatRests&&(this.opts.formatRests=t),this.sanitized=!0)},v.updateStack=function(a){var b=d.getAlter(a),f=c.alterToAccidental(b),g=d.getStaffIdx(a),h=d.getNbDots(a),i=this.extractNoteDurationType(a),j=d.getTimeModif(a),k=this.extractFretData(a),l=this.getLocation(),m={partUuid:l.partUuid,measureUuid:l.measureUuid,
voiceIdx:this.opts.voiceIdx,staffIdx:g,timePos:l.timePos,divisions:l.dpq,pitch:c.copy(this.opts.pitch),accidental:f,fretData:k,nbDots:h,durationType:i,insertMode:this.opts.insertMode,timeModif:e.copy(j)},n={type:this.name,noDraw:!0,opts:m};this.cancelStack.push(n)},v.extractNoteDurationType=function(a){var b=this.measureData.getDivisionsPerQuarterValue();return k(a,b)},v.extractFretData=function(a){return o(a)},v.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,timePos:a.timePos,divisions:a.dpq,pitch:c.copy(this.opts.pitch),insertMode:this.opts.insertMode,formatRests:this.opts.formatRests}};this.cancelStack.storeAction(b)}},v.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location},v.shouldFormatRests=function(){return!!this.opts.formatRests&&this.getAction()instanceof q},v.formatRests=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new r(this.measureData,a,this.cancelStack).performIfPossible()}}.call(this),function(){"use strict";var a=Adagio.Error.client.NotPossibleOnPitchedError;Adagio.edit.common.checkUnpitchedMeasure=function(b){if(!b.isUnpitched())throw new a}}.call(this),function(){"use strict";var a=Adagio.Utils.drumsetUtils,b=Adagio.edit.common.getNbStaffLines;Adagio.edit.common.convertLineToUnpitched=function(c,d){if(void 0!==d.line){var e=b(c,d);d.unpitched=a.lineToPitch(d.line,e),delete d.line}}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.unpitchedUtils,c=Adagio.edit.common.initMeasureData,d=Adagio.edit.primitive.RemoveFromChordPercu=function(a,b,c){this.init(a,b,c)};d.NAME="primitive.RemoveFromChordPercu";var e=d.prototype;e.name=d.NAME,e.initMeasureData=c,e.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},e.perform=function(){var b=this.getVoice(),c=b.getChord(this.opts.noteIdx),d=c.map(a.getUnpitched),e=d.findIndex(f,this.opts.unpitched),g=c[e];b.removeNoteFromChord(this.opts.noteIdx,e),this.updateStack(g)},e.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)};var f=function(a){var c=this;return b.isSameLine(a,c)};e.updateStack=function(c){var d=a.getUnpitched(c),e=a.getHead(c),f={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,noteIdx:this.opts.noteIdx,voiceIdx:this.opts.voiceIdx,unpitched:b.copy(d),notehead:e}};this.cancelStack.push(f)}}.call(this),function(){"use strict";var a=Adagio.Error.client.UnpitchedCollisionError,b=Adagio.Error.client.TieError,c=Adagio.Error.client.NotPossibleOnPitchedError,d=Adagio.Utils.typeUtils,e=Adagio.Utils.noteUtils,f=Adagio.Utils.unpitchedUtils,g=Adagio.Utils.clone,h=Adagio.edit.action.RemoveTieArcPercu,i=Adagio.edit.common.initMeasureData,j=Adagio.edit.common.getVoice,k=Adagio.edit.common.lineToDestUnpitched,l=Adagio.edit.common.getNbStaffLines,m=Adagio.edit.action.UntieNoteHeadPercu=function(a,b,c){this.init(a,b,c)};m.NAME="action.UntieNoteHeadPercu",m.isAuthorizedException=function(a){return h.isAuthorizedException(a)};var n=m.prototype;n.name=m.NAME,n.initMeasureData=i,n.getVoice=j,n.lineToDestUnpitched=k,n.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.untieRight=null,this.untieLeft=null,this.rightAction=null,this.leftAction=null},n.performIfPossible=function(){this.isPossible()&&this.perform()},n.isPossible=function(){var a=!0;try{this.checkPreconditions()}catch(b){if(!m.isAuthorizedException(b))throw b;a=!1}return a},n.checkPreconditions=function(){this.checkUnpitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx);var a=this.getVoice();a.checkNoteIdx(this.opts.noteIdx),a.checkNotRest(this.opts.noteIdx),this.lineToDestUnpitched(),this.checkUnpitched()},n.checkUnpitchedPart=function(){if(!this.measureData.isUnpitched())throw new c},n.checkUnpitched=function(){var c=this.getVoice(),e=l(this.measureData,this.opts),f=c.getChord(this.opts.noteIdx);if(f=d.makeArray(f),void 0===f.find(this.unpitchedPredicate,this))throw new a(a.GET,this.opts,e);var g=this.canUntieLeft(),h=this.canUntieRight();if(!g&&!h)throw new b("There is nothing to untie")},n.unpitchedPredicate=function(a){var b=e.getUnpitched(a);return f.isSameLine(b,this.opts)},n.perform=function(){if(this.cancelStack=this.cancelStack.createSubstack(this.name),this.canUntieLeft()){var a=this.getLeftAction();a.cancelStack=this.cancelStack,a.perform()}if(this.canUntieRight()){var b=this.getRightAction();b.cancelStack=this.cancelStack,b.perform()}},n.canUntieRight=function(){if(null===this.untieRight){var a=this.getRightAction();try{a.checkPreconditions(),this.untieRight=!0}catch(a){if(!h.isAuthorizedException(a))throw a;this.untieRight=!1}}return this.untieRight},n.getRightAction=function(){if(null===this.rightAction){var a=g(this.opts);this.rightAction=new h(this.measureData,a,this.cancelStack)}return this.rightAction},n.canUntieLeft=function(){if(null===this.untieLeft){var a=this.getLeftAction();try{a.checkPreconditions(),this.untieLeft=!0}catch(a){if(!h.isAuthorizedException(a))throw a;this.untieLeft=!1}}return this.untieLeft},n.getLeftAction=function(){if(null===this.leftAction){var a=g(this.opts);a.noteIdx--,this.leftAction=new h(this.measureData,a,this.cancelStack)}return this.leftAction}}.call(this),function(){"use strict";var a=Adagio.Utils.typeUtils,b=Adagio.Utils.unpitchedUtils,c=Adagio.Utils.noteUtils;Adagio.edit.common.getNoteAtUnpitched=function(b,c,f,g){var h=d(b,c,g);return h=a.makeArray(h),h.find(e,f)};var d=function(a,b,c){return"number"==typeof c?a.getGraceChord(b,c):a.getChord(b)},e=function(a){var d=this,e=c.getUnpitched(a);return b.isSameLine(e,d)}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.edit.common.initMeasureData,c=Adagio.edit.common.getNoteAtUnpitched,d=Adagio.edit.primitive.RemoveGhostNotePercu=function(a,b,c){this.init(a,b,c)};d.NAME="primitive.RemoveGhostNotePercu";var e=d.prototype;e.name=d.NAME,e.initMeasureData=b,e.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},e.perform=function(){this.removeGhostNotePercu(),this.updateStack()},e.removeGhostNotePercu=function(){var b=this.measureData.getVoice(this.opts.voiceIdx),d=c(b,this.opts.noteIdx,this.opts.unpitched);a.removeHeadParentheses(d)},e.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.Error.noChange.NoChangeError,b=Adagio.Error.client.UnpitchedCollisionError,c=Adagio.Utils.noteUtils,d=Adagio.Utils.unpitchedUtils,e=Adagio.Utils.staffDetailsUtils,f=Adagio.edit.primitive.RemoveGhostNotePercu,g=Adagio.edit.common.getNoteAtUnpitched,h=Adagio.edit.common.convertLineToUnpitched,i=Adagio.edit.common.convertTimePosToGetNoteIdx,j=Adagio.edit.common.convertPartUuidToGetPartIdx,k=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,l=Adagio.edit.common.checkUnpitchedMeasure,m=Adagio.edit.common.initMeasureData,n=Adagio.edit.action.RemoveGhostNotePercu=function(a,b,c){this.init(a,b,c)};n.NAME="action.RemoveGhostNotePercus",n.isNoChange=function(b){return b instanceof a};var o=n.prototype;o.name=n.NAME,o.initMeasureData=m,o.init=function(a,b,c){j(a,b),k(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.noteHead=null,this.voice=null,this.location=null},o.checkPreconditions=function(){this.checkUnpitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),i(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),this.sanitizeIfNeeded(),this.checkNoteAtUnpitched(),this.checkGhost()},o.checkUnpitchedPart=function(){l(this.measureData)},o.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},o.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},o.sanitizeIfNeeded=function(){void 0!==this.opts.line&&h(this.measureData,this.opts)},o.checkNoteAtUnpitched=function(){if(void 0===this.getNoteAtUnpitched()){var a=d.copy(this.opts.unpitched),c=this.opts.staffIdx||0,f=this.measureData.getStaffDetails(c),g=e.getNbStaffLines(f);throw new b(b.GET,a,g)}},o.checkGhost=function(){var b=this.getNoteAtUnpitched();if(!c.hasHeadParentheses(b))throw new a},o.getNoteAtUnpitched=function(){if(null===this.noteHead){var a=this.getVoice();this.noteHead=g(a,this.opts.noteIdx,this.opts.unpitched)}return this.noteHead},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.removeGhostNotePercu(),this.updateStack()},o.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos,unpitched:d.copy(this.opts.unpitched)},c={actionName:this.name,opts:b};this.cancelStack.storeAction(c)}},o.removeGhostNotePercu=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,unpitched:d.copy(this.opts.unpitched)};new f(this.measureData,a,this.cancelStack).perform()},o.updateStack=function(){var a=this.getLocation(),b={partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos,unpitched:d.copy(this.opts.unpitched)},c={type:this.name,noDraw:!0,opts:b};this.cancelStack.push(c)},o.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.getVoice(),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f,isConcertPitch:!1}}return this.location},o.getVoice=function(){return null===this.voice&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice}}.call(this),function(){"use strict";var a=Adagio.Error.noChange.NoChangeError,b=Adagio.edit.primitive.RemoveFromChordPercu,c=Adagio.edit.action.UntieNoteHeadPercu,d=Adagio.edit.action.RemoveGhostNotePercu,e=Adagio.Utils.clone,f=Adagio.Utils.unpitchedUtils,g=Adagio.edit.common.initMeasureData,h=Adagio.edit.common.assertPerform,i=Adagio.edit.composite.RemoveFromChordPercu=function(a,b,c){this.init(a,b,c)};i.NAME="composite.RemoveFromChordPercu";var j=i.prototype;j.name=i.NAME,j.initMeasureData=g,j.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.sanitized=!1,this.voice=null,this.location=null},j.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeTie(),this.removeGhost(),this.removeFromChord()},j.removeTie=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,"display-step":f.getStep(this.opts.unpitched),"display-octave":f.getOctave(this.opts.unpitched)};new c(this.measureData,a,this.cancelStack).performIfPossible()},j.removeGhost=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,unpitched:f.copy(this.opts.unpitched)},b=new d(this.measureData,a,this.cancelStack);h(b,k)};var k=function(b){return b instanceof a};j.removeFromChord=function(){var a=e(this.opts);new b(this.measureData,a,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.client.UnpitchedCollisionError,b=Adagio.Error.client.NotPossibleOnSingleNoteError,c=Adagio.edit.common.checkUnpitchedMeasure,d=Adagio.edit.common.convertLineToUnpitched,e=Adagio.edit.common.convertPartUuidToGetPartIdx,f=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,g=Adagio.edit.common.convertTimePosToGetNoteIdx,h=Adagio.edit.composite.RemoveFromChordPercu,i=Adagio.Utils.clone,j=Adagio.Utils.typeUtils,k=Adagio.Utils.noteUtils,l=Adagio.Utils.unpitchedUtils,m=Adagio.Utils.staffDetailsUtils,n=Adagio.edit.common.initMeasureData,o=Adagio.edit.action.RemoveFromChordPercu=function(a,b,c){this.init(a,b,c)};o.NAME="action.RemoveFromChordPercu";var p=o.prototype;p.name=o.NAME,p.initMeasureData=n,p.init=function(a,b,c){e(a,b),f(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.sanitized=!1,this.voice=null,this.location=null,g(this.measureData,this.opts)},p.checkPreconditions=function(){this.checkUnpitched(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.sanitizeIfNeeded(),this.checkNoteIdx(),this.checkNotRest(),this.checkSingleNote(),this.checkPitch()},p.checkUnpitched=function(){c(this.measureData)},p.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},p.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},p.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},p.checkPitch=function(){if(this.sanitizeIfNeeded(),-1===this.getChord().findIndex(q,this.opts.unpitched)){var b=l.copy(this.opts.unpitched),c=this.opts.staffIdx||0,d=this.measureData.getStaffDetails(c),e=m.getNbStaffLines(d);throw new a(a.GET,b,e)}};var q=function(a){var b=k.getUnpitched(a),c=this;return l.isSameLine(b,c)};p.getChord=function(){var a=this.getVoice(),b=a.getChord(this.opts.noteIdx);return j.makeArray(b)},p.checkSingleNote=function(){if(!this.getVoice().isChord(this.opts.noteIdx))throw new b},p.perform=function(){var a=this.getVoice(),b=a.getChord(this.opts.noteIdx),c=b.find(q,this.opts.unpitched);this.sanitizeIfNeeded(),this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.removeFromChord(),this.updateStack(c)},p.sanitizeIfNeeded=function(){this.sanitized||(void 0!==this.opts.line&&d(this.measureData,this.opts),this.sanitized=!0)},p.removeFromChord=function(){var a=i(this.opts);new h(this.measureData,a,this.cancelStack).perform()},p.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b=l.copy(this.opts.unpitched),c={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos,unpitched:b}};this.cancelStack.storeAction(c)}},p.updateStack=function(a){var b=this.getLocation(),c=k.getUnpitched(a),d=k.getHead(a),e=k.getStaffIdx(a),f={type:this.name,noDraw:!0,opts:{partUuid:b.partUuid,measureUuid:b.measureUuid,voiceIdx:this.opts.voiceIdx,staffIdx:e,timePos:b.timePos,divisions:b.dpq,unpitched:l.copy(c),notehead:d}};this.cancelStack.push(f)},p.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.unpitchedUtils,c=Adagio.edit.common.extractNoteDurationType,d=Adagio.edit.common.initMeasureData,e=Adagio.edit.primitive.RemoveSingleNotePercu=function(a,b,c){this.init(a,b,c)};e.NAME="primitive.RemoveSingleNotePercu";var f=e.prototype;f.name=e.NAME,f.initMeasureData=d,f.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},f.perform=function(){var a=this.getVoice(),b=a.getNote(this.opts.noteIdx);a.removeNote(this.opts.noteIdx),this.updateStack(b)},f.getVoice=function(){var a=this.opts.voiceIdx,b=this.opts.noteIdx;return this.measureData.getVoiceOrTupletForGet(a,b)},f.updateStack=function(c){var d=this.getDurationType(c),e=a.getUnpitched(c),f={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,noteIdx:this.opts.noteIdx,voiceIdx:this.opts.voiceIdx,staffIdx:a.getStaffIdx(c),durationType:d,nbDots:a.getNbDots(c),notehead:a.getHead(c),unpitched:b.copy(e)}};this.cancelStack.push(f)},f.getDurationType=function(a){var b=this.measureData.getDivisionsPerQuarterValue();return c(a,b)}}.call(this),function(){"use strict";var a=Adagio.edit.action.UnbeamNote,b=Adagio.edit.composite.UnbeamIfPossible=function(a,b,c){this.init(a,b,c)};b.NAME="composite.UnbeamIfPossible";var c=b.prototype;c.name=b.NAME,c.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.measure=null},c.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),new a(this.scoreData,this.opts,this.cancelStack).performIfPossible()}}.call(this),function(){"use strict";var a=Adagio.edit.common.initMeasureData,b=Adagio.edit.primitive.DeleteGraceNotePercu=function(a,b,c){this.init(a,b,c)};b.NAME="primitive.DeleteGraceNotePercu";var c=b.prototype;c.name=b.NAME,c.initMeasureData=a,c.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},c.perform=function(){this.getVoice().removeGrace(this.opts.noteIdx,this.opts.graceIdx),this.updateStack()},c.getVoice=function(){var a=this.opts.voiceIdx;return this.measureData.getVoice(a)},c.updateStack=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx},b={type:this.name,opts:a};this.cancelStack.push(b)}}.call(this),function(){"use strict";var a=Adagio.Error.noChange.NoChangeError,b=Adagio.edit.primitive.DeleteGraceNotePercu,c=Adagio.edit.action.RemoveGraceSlash,d=Adagio.edit.common.assertPerform,e=Adagio.edit.common.initMeasureData,f=Adagio.edit.composite.DeleteGraceNotePercu=function(a,b,c){this.init(a,b,c)};f.NAME="composite.DeleteGraceNotePercu";var g=f.prototype;g.name=f.NAME,g.initMeasureData=e,g.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},g.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeSlash(),this.deleteGraceNote()},g.removeSlash=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx},b=new c(this.measureData,a,this.cancelStack);d(b,h)};var h=function(b){return b instanceof a};g.deleteGraceNote=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx};new b(this.measureData,a,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Utils.unpitchedUtils,b=Adagio.Utils.noteUtils,c=Adagio.edit.common.convertPartUuidToGetPartIdx,d=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,e=Adagio.edit.common.convertTimePosToGetNoteIdx,f=Adagio.edit.common.checkUnpitchedMeasure,g=Adagio.edit.composite.DeleteGraceNotePercu,h=Adagio.edit.common.initMeasureData,i=Adagio.edit.action.DeleteGraceNotePercu=function(a,b,c){this.init(a,b,c)};i.NAME="action.DeleteGraceNotePercu";var j=i.prototype;j.name=i.NAME,j.initMeasureData=h,j.init=function(a,b,f){c(a,b),d(a,b),this.initMeasureData(a,b),this.cancelStack=f,this.opts=b,e(this.measureData,this.opts),this.location=null},j.checkPreconditions=function(){this.checkUnpitched(),this.measureData.checkVoiceIdx(this.opts.voiceIdx);var a=this.measureData.getVoice(this.opts.voiceIdx);a.checkGraceIdx(this.opts.noteIdx,this.opts.graceIdx),a.checkGraceNotChord(this.opts.noteIdx,this.opts.graceIdx)},j.checkUnpitched=function(){f(this.measureData)},j.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a=this.getNoteData();this.deleteGraceNote(),this.updateStack(a)},j.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,timePos:a.timePos,divisions:a.dpq,graceIdx:this.opts.graceIdx}};this.cancelStack.storeAction(b)}},j.getNoteData=function(){var c=this.measureData.getVoice(this.opts.voiceIdx),d=c.getGrace(this.opts.noteIdx,this.opts.graceIdx),e=b.getStaffIdx(d),f=b.getDurationType(d),g=b.getUnpitched(d);return g=a.copy(g),{staffIdx:e,durationType:f,unpitched:g,notehead:b.getHead(d)}},j.deleteGraceNote=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx};new g(this.measureData,a,this.cancelStack).perform()},j.updateStack=function(b){var c=this.getLocation(),d=a.copy(b.unpitched),e={type:this.name,noDraw:!0,opts:{partUuid:c.partUuid,measureUuid:c.measureUuid,voiceIdx:this.opts.voiceIdx,staffIdx:b.staffIdx,timePos:c.timePos,divisions:c.dpq,graceIdx:this.opts.graceIdx,durationType:b.durationType,notehead:b.notehead,unpitched:d}};this.cancelStack.push(e)},j.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Utils.typeUtils,b=Adagio.Utils.unpitchedUtils,c=Adagio.Utils.noteUtils;Adagio.edit.common.getGraceAtUnpitched=function(b,c,e,f){var g=b.getGraceChord(c,e);return g=a.makeArray(g),g.find(d,f)};var d=function(a){var d=this,e=c.getUnpitched(a);return b.isSameLine(e,d)}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.unpitchedUtils,c=Adagio.edit.common.initMeasureData,d=Adagio.edit.primitive.RemoveGraceFromChordPercu=function(a,b,c){this.init(a,b,c)};d.NAME="primitive.RemoveGraceFromChordPercu";var e=d.prototype;e.name=d.NAME,e.initMeasureData=c,e.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},e.perform=function(){var a=this.getVoice(),b=a.getGraceChord(this.opts.noteIdx,this.opts.graceIdx),c=b.findIndex(this.unpitchedPredicate,this);a.removeGraceFromChord(this.opts.noteIdx,this.opts.graceIdx,c),this.updateStack()},e.unpitchedPredicate=function(c){var d=a.getUnpitched(c),e=this.opts.unpitched;return b.isSameLine(d,e)},e.getVoice=function(){var a=this.opts.voiceIdx;return this.measureData.getVoice(a)},e.updateStack=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx},b={type:this.name,opts:a};this.cancelStack.push(b)}}.call(this),function(){"use strict";var a=Adagio.Error.client.UnpitchedCollisionError,b=Adagio.Utils.unpitchedUtils,c=Adagio.Utils.noteUtils,d=Adagio.Utils.staffDetailsUtils,e=Adagio.edit.common.convertLineToUnpitched,f=Adagio.edit.common.convertPartUuidToGetPartIdx,g=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,h=Adagio.edit.common.convertTimePosToGetNoteIdx,i=Adagio.edit.common.checkUnpitchedMeasure,j=Adagio.edit.common.getGraceAtUnpitched,k=Adagio.edit.primitive.RemoveGraceFromChordPercu,l=Adagio.edit.common.initMeasureData,m=Adagio.edit.action.RemoveGraceFromChordPercu=function(a,b,c){this.init(a,b,c)};m.NAME="action.RemoveGraceFromChordPercu";var n=m.prototype;n.name=m.NAME,n.initMeasureData=l,n.init=function(a,b,c){f(a,b),g(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,h(this.measureData,this.opts),this.sanitized=!1,this.location=null},n.checkPreconditions=function(){this.checkUnpitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx);var a=this.measureData.getVoice(this.opts.voiceIdx);a.checkGraceIdx(this.opts.noteIdx,this.opts.graceIdx),a.checkGraceChord(this.opts.noteIdx,this.opts.graceIdx),this.sanitizeIfNeeded(),this.checkUnpitchedExist()},n.checkUnpitchedPart=function(){i(this.measureData)},n.checkUnpitchedExist=function(){this.sanitizeIfNeeded();var c=this.measureData.getVoice(this.opts.voiceIdx);if(void 0===j(c,this.opts.noteIdx,this.opts.graceIdx,this.opts.unpitched)){var e=b.copy(this.opts.unpitched),f=this.opts.staffIdx||0,g=this.measureData.getStaffDetails(f),h=d.getNbStaffLines(g);throw new a(a.GET,e,h)}},n.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded(),this.storeAction();var a=this.getNoteData();this.removeGraceFromChord(),this.updateStack(a)},n.sanitizeIfNeeded=function(){this.sanitized||(void 0!==this.opts.line&&e(this.measureData,this.opts),this.sanitized=!0)},n.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),c={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,timePos:a.timePos,divisions:a.dpq,graceIdx:this.opts.graceIdx,unpitched:b.copy(this.opts.unpitched)}};this.cancelStack.storeAction(c)}},n.getNoteData=function(){var a=this.measureData.getVoice(this.opts.voiceIdx),b=j(a,this.opts.noteIdx,this.opts.graceIdx,this.opts.unpitched);return{staffIdx:c.getStaffIdx(b),notehead:c.getHead(b)}},n.removeGraceFromChord=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,unpitched:b.copy(this.opts.unpitched)};new k(this.measureData,a,this.cancelStack).perform()},n.updateStack=function(a){var c=this.getLocation(),d={type:this.name,noDraw:!0,opts:{partUuid:c.partUuid,measureUuid:c.measureUuid,voiceIdx:this.opts.voiceIdx,staffIdx:a.staffIdx,graceIdx:this.opts.graceIdx,timePos:c.timePos,divisions:c.dpq,unpitched:b.copy(this.opts.unpitched),notehead:a.notehead}};this.cancelStack.push(d)},n.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Utils.unpitchedUtils,b=Adagio.Utils.noteUtils,c=Adagio.Utils.typeUtils,d=Adagio.edit.action.DeleteGraceNotePercu,e=Adagio.edit.action.RemoveGraceFromChordPercu,f=Adagio.edit.common.initMeasureData,g=Adagio.edit.composite.DeleteGracesAtNotePercu=function(a,b,c){this.init(a,b,c)};g.NAME="composite.DeleteGracesAtNote";var h=g.prototype;h.name=g.NAME,h.initMeasureData=f,h.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},h.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);for(var a=this.measureData.getVoice(this.opts.voiceIdx),b=a.getNbGraces(this.opts.noteIdx),d=0;d<b;d++){var e=a.getGraceChord(this.opts.noteIdx,0);e=c.makeArray(e),e=e.slice(),e.forEach(this.removeGraceHead,this)}},h.removeGraceHead=function(c,d,e){if(d===e.length-1)this.deleteGrace();else{var f=b.getUnpitched(c);f=a.copy(f),this.removeGraceFromChord(f)}},h.deleteGrace=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:0},b=new d(this.measureData,a,this.cancelStack);b.checkPreconditions(),b.perform()},h.removeGraceFromChord=function(a){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:0,unpitched:a},c=new e(this.measureData,b,this.cancelStack);c.checkPreconditions(),c.perform()}}.call(this),function(){"use strict";var a=Adagio.Error.client.TieError,b=Adagio.Error.client.NotPossibleOnPitchedError,c=Adagio.Utils.clone,d=Adagio.edit.action.RemoveTiePercu,e=Adagio.edit.common.initMeasureData,f=Adagio.edit.common.getVoice,g=Adagio.edit.action.UntieNotePercu=function(a,b,c){this.init(a,b,c)};g.isAuthorizedException=function(a){return d.isAuthorizedException(a)},g.NAME="action.UntieNotePercu";var h=g.prototype;h.performIfPossible=function(){this.isPossible()&&this.perform()},h.isPossible=function(){var a=!0;try{this.checkPreconditions()}catch(b){if(!g.isAuthorizedException(b))throw b;a=!1}return a},h.name=g.NAME,h.initMeasureData=e,h.getVoice=f,h.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.untieRight=null,this.untieLeft=null,this.rightAction=null,this.leftAction=null},h.checkPreconditions=function(){this.checkUnpitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx);var a=this.getVoice();a.checkNoteIdx(this.opts.noteIdx),a.checkNotRest(this.opts.noteIdx),this.checkCanUntie()},h.checkUnpitchedPart=function(){if(!this.measureData.isUnpitched())throw new b},h.checkCanUntie=function(){var b=this.canUntieLeft(),c=this.canUntieRight();if(!b&&!c)throw new a("There is nothing to untie")},h.perform=function(){if(this.cancelStack=this.cancelStack.createSubstack(this.name),this.canUntieLeft()){var a=this.getLeftAction();a.cancelStack=this.cancelStack,a.perform()}if(this.canUntieRight()){var b=this.getRightAction();b.cancelStack=this.cancelStack,b.perform()}},h.canUntieRight=function(){if(null===this.untieRight){var a=this.getRightAction();try{a.checkPreconditions(),this.untieRight=!0}catch(a){if(!d.isAuthorizedException(a))throw a;this.untieRight=!1}}return this.untieRight},h.getRightAction=function(){if(null===this.rightAction){var a=c(this.opts);this.rightAction=new d(this.measureData,a,this.cancelStack)}return this.rightAction},h.canUntieLeft=function(){if(null===this.untieLeft){var a=this.getLeftAction();try{a.checkPreconditions(),this.untieLeft=!0}catch(a){if(!d.isAuthorizedException(a))throw a;this.untieLeft=!1}}return this.untieLeft},h.getLeftAction=function(){if(null===this.leftAction){var a=c(this.opts);a.noteIdx--,this.leftAction=new d(this.measureData,a,this.cancelStack)}return this.leftAction}}.call(this),function(){"use strict";var a=Adagio.Error.noChange.NoChangeError,b=Adagio.Utils.noteUtils,c=Adagio.Utils.unpitchedUtils,d=Adagio.edit.values.InsertMode,e=Adagio.edit.composite.AddRests,f=Adagio.edit.primitive.RemoveSingleNotePercu,g=Adagio.edit.composite.AdaptDpqToTimeSignature,h=Adagio.edit.composite.DispatchSlurSide,i=Adagio.edit.composite.UnbeamIfPossible,j=Adagio.edit.composite.DeleteGracesAtNotePercu,k=Adagio.edit.action.FormatBeamsRandPos,l=Adagio.edit.action.RemoveTiePercu,m=Adagio.edit.action.UntieNotePercu,n=Adagio.edit.action.RemoveGhostNotePercu,o=Adagio.edit.common.initMeasureData,p=Adagio.edit.common.assertPerform,q=Adagio.edit.composite.RemoveSingleNotePercu=function(a,b,c){this.init(a,b,c)};q.NAME="composite.RemoveSingleNotePercu";var r=q.prototype;r.name=q.NAME,r.initMeasureData=o,r.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},r.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.opts.insertMode===d.INSERT&&this.removeLastNoteTie(),this.adaptDpqToTimeSignature(),this.untieNote(),this.removeGraces(),this.removeGhost(),this.unbeamIfPossible(),this.shiftSlurIfPossible();var a=this.getNote();this.removeNote(),this.insertRests(a),this.opts.insertMode===d.INSERT&&this.formatBeams()},r.removeLastNoteTie=function(){var a=this.measureData.getVoice(this.opts.voiceIdx),b=a.getStopNoteIdx(),c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:b};new l(this.measureData,c,this.cancelStack).performIfPossible()},r.adaptDpqToTimeSignature=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx};new g(this.measureData,a,this.cancelStack).perform()},r.untieNote=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new m(this.measureData,a,this.cancelStack).performIfPossible()},r.removeGhost=function(){var a=this.getNote(),d=b.getUnpitched(a);d=c.copy(d);var e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,unpitched:d},f=new n(this.measureData,e,this.cancelStack);p(f,s)};var s=function(b){return b instanceof a};r.unbeamIfPossible=function(){new i(this.measureData,this.opts,this.cancelStack).perform()},r.removeGraces=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new j(this.measureData,a,this.cancelStack).perform()},r.getNote=function(){
return this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx)},r.extractNoteDuration=function(){var a=this.measureData.getVoice(this.opts.voiceIdx),c=a.getNote(this.opts.noteIdx);return b.getDuration(c)},r.shiftSlurIfPossible=function(){var a=this.measureData.getVoice(this.opts.voiceIdx),c=a.getNote(this.opts.noteIdx);if(b.hasSlur(c)){var d={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new h(this.measureData,d,this.cancelStack).perform()}},r.removeNote=function(){new f(this.measureData,this.opts,this.cancelStack).perform()},r.insertRests=function(a){var c=b.getDuration(a),d=b.getStaffIdx(a),f={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:d,noteIdx:this.opts.noteIdx,duration:c,insertMode:this.opts.insertMode};new e(this.measureData,f,this.cancelStack).perform()},r.formatBeams=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new k(this.measureData,a,this.cancelStack).performIfPossible()}}.call(this),function(){"use strict";var a=Adagio.Error.client.NotPossibleOnChordError,b=Adagio.Utils.clone,c=Adagio.Utils.timeModifUtils,d=Adagio.Utils.noteUtils,e=Adagio.Utils.unpitchedUtils,f=Adagio.edit.values.InsertMode,g=Adagio.edit.common.checkUnpitchedMeasure,h=Adagio.edit.common.convertPartUuidToGetPartIdx,i=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,j=Adagio.edit.common.convertTimePosToGetNoteIdx,k=Adagio.edit.common.extractNoteDurationType,l=Adagio.edit.composite.RemoveSingleNotePercu,m=Adagio.edit.action.FormatRests,n=Adagio.edit.common.initMeasureData,o=!1,p=Adagio.edit.action.RemoveSingleNotePercu=function(a,b,c){this.init(a,b,c)};p.NAME="action.RemoveSingleNotePercu";var q=p.prototype;q.name=p.NAME,q.initMeasureData=n,q.init=function(a,b,c){h(a,b),i(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.sanitized=!1,this.voice=null,this.location=null,j(this.measureData,this.opts)},q.checkPreconditions=function(){this.sanitizeIfNeeded(),this.checkUnpitched(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkNoteIdx(),this.checkNotChord(),this.checkNotRest()},q.checkUnpitched=function(){g(this.measureData)},q.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},q.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},q.checkNotChord=function(){if(this.getVoice().isChord(this.opts.noteIdx))throw new a},q.getVoice=function(){return null===this.voice&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},q.perform=function(){this.sanitizeIfNeeded(),this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a=this.getVoice(),c=a.getNote(this.opts.noteIdx),d=b(this.opts);new l(this.measureData,d,this.cancelStack).perform(),this.updateStack(c),this.opts.formatRests&&this.formatRests()},q.sanitizeIfNeeded=function(){this.sanitized||(void 0===this.opts.insertMode&&(this.opts.insertMode=f.REPLACE),void 0===this.opts.formatRests&&(this.opts.formatRests=o),this.sanitized=!0)},q.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos,insertMode:this.opts.insertMode}};this.cancelStack.storeAction(b)}},q.updateStack=function(a){var b=this.getLocation(),f=this.getDurationType(a),g=d.getUnpitched(a),h=d.getTimeModif(a);h=c.copy(h);var i={type:this.name,noDraw:!0,opts:{partUuid:b.partUuid,measureUuid:b.measureUuid,voiceIdx:this.opts.voiceIdx,staffIdx:d.getStaffIdx(a),timePos:b.timePos,divisions:b.dpq,durationType:f,nbDots:d.getNbDots(a),notehead:d.getHead(a),unpitched:e.copy(g),timeModif:h}};this.cancelStack.push(i)},q.getDurationType=function(a){var b=this.measureData.getDivisionsPerQuarterValue();return k(a,b)},q.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location},q.formatRests=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new m(this.measureData,a,this.cancelStack).performIfPossible()}}.call(this),function(){"use strict";var a=Adagio.edit.values.InsertMode,b=Adagio.edit.common.checkUnpitchedMeasure,c=Adagio.edit.common.convertLineToUnpitched,d=Adagio.edit.common.convertPartUuidToGetPartIdx,e=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,f=Adagio.edit.common.convertTimePosToGetNoteIdx,g=Adagio.edit.action.RemoveFromChordPercu,h=Adagio.edit.action.RemoveSingleNotePercu,i=Adagio.Utils.clone,j=Adagio.Utils.unpitchedUtils,k=Adagio.edit.common.initMeasureData,l=!1,m=Adagio.edit.action.RemoveNotePercu=function(a,b,c){this.init(a,b,c)};m.NAME="action.RemoveNotePercu";var n=m.prototype;n.name=m.NAME,n.initMeasureData=k,n.init=function(a,b,c){d(a,b),e(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.sanitized=!1,this.voice=null,this.action=null,this.location=null,f(this.measureData,this.opts)},n.checkPreconditions=function(){this.sanitizeIfNeeded(),this.checkUnpitched(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkNoteIdx(),this.checkNotRest(),this.checkAction()},n.checkUnpitched=function(){b(this.measureData)},n.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},n.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},n.isChord=function(){return this.getVoice().isChord(this.opts.noteIdx)},n.checkAction=function(){this.getAction().checkPreconditions()},n.getAction=function(){return null===this.action&&this.createAction(),this.action},n.createAction=function(){var a;this.isChord()?(a=i(this.opts),this.action=new g(this.measureData,a,this.cancelStack)):(a=i(this.opts),this.action=new h(this.measureData,a,this.cancelStack))},n.getVoice=function(){return null===this.voice&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},n.perform=function(){this.sanitizeIfNeeded(),this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a=this.getAction();a.cancelStack=this.cancelStack,a.perform()},n.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b=j.copy(this.opts.unpitched),c={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos,insertMode:this.opts.insertMode,formatRests:!!this.opts.formatRests,unpitched:b}};this.cancelStack.storeAction(c)}},n.sanitizeIfNeeded=function(){this.sanitized||(void 0!==this.opts.line&&c(this.measureData,this.opts),void 0===this.opts.insertMode&&(this.opts.insertMode=a.REPLACE),void 0===this.opts.formatRests&&(this.opts.formatRests=l),this.sanitized=!0)},n.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.partContentUtils,c=Adagio.Utils.noteUtils,d=Adagio.Utils.pitchUtils,e=Adagio.Utils.unpitchedUtils,f=Adagio.Utils.typeUtils,g=Adagio.edit.values.InsertMode,h=Adagio.edit.common.MeasureData,i=Adagio.edit.common.CancelStack,j=Adagio.edit.primitive.RemoveRest,k=Adagio.edit.action.RemoveNote,l=Adagio.edit.action.RemoveNotePercu,m={REST:"rest",PITCHED:"pitched",UNPITCHED:"unpitched"};Adagio.import.removeNullDurations=function(a){var b=new n(a);b.analyze(),b.removeNullDurations()};var n=function(a){this.init(a)},o=n.prototype;o.init=function(a){this.scoreData=a,this.partIdx=null,this.measureIdx=null,this.voiceIdx=null,this.noteIdx=null,this.list=[]},o.analyze=function(){this.scoreData.getPartsContents().forEach(this.analyzePart,this)},o.analyzePart=function(a,c){this.partIdx=c,b.getMeasures(a).forEach(this.analyzeMeasure,this)},o.analyzeMeasure=function(a,b){this.measureIdx=b,new h(a).forEachVoice(this.analyzeVoice,this)},o.analyzeVoice=function(a,b){this.voiceIdx=b;for(var d=a.size(),e=0;e<d;e++){this.noteIdx=e;var f=a.getNote(e);if(0===c.getDuration(f)){var g=c.isRest(f);this.addNote(g)}}},o.addNote=function(a){var b;b=a?m.REST:this.scoreData.isPartUnpitched(this.partIdx)?m.UNPITCHED:m.PITCHED;var c={partIdx:this.partIdx,measureIdx:this.measureIdx,voiceIdx:this.voiceIdx,noteIdx:this.noteIdx,type:b};this.list.unshift(c)},o.removeNullDurations=function(){this.list.forEach(this.removeEntry,this)},o.removeEntry=function(b){if(b.type===m.REST)this.removeRest(b);else if(b.type===m.PITCHED)this.removePitched(b);else{if(b.type!==m.UNPITCHED)throw new a("Unexpected");this.removeUnpitched(b)}},o.removeRest=function(a){var b={partIdx:a.partIdx,measureIdx:a.measureIdx,voiceIdx:a.voiceIdx,noteIdx:a.noteIdx},c=new i;new j(this.scoreData,b,c).perform()},o.removePitched=function(a){var b=this.scoreData.getMeasure(a.partIdx,a.measureIdx),e=new h(b),j=e.getVoice(a.voiceIdx),l=j.getChord(a.noteIdx);l=f.makeArray(l),l.forEach(function(b){var e=c.getPitch(b),f={partIdx:a.partIdx,measureIdx:a.measureIdx,voiceIdx:a.voiceIdx,noteIdx:a.noteIdx,pitch:d.copyWithoutAlter(e),insertMode:g.REPLACE},h=new i,j=new k(this.scoreData,f,h);j.checkPreconditions(),j.perform()},this)},o.removeUnpitched=function(a){var b=this.scoreData.getMeasure(a.partIdx,a.measureIdx),d=new h(b),j=d.getVoice(a.voiceIdx),k=j.getChord(a.noteIdx);k=f.makeArray(k),k.forEach(function(b){var d=c.getUnpitched(b),f={partIdx:a.partIdx,measureIdx:a.measureIdx,voiceIdx:a.voiceIdx,noteIdx:a.noteIdx,unpitched:e.copy(d),insertMode:g.REPLACE},h=new i,j=new l(this.scoreData,f,h);j.checkPreconditions(),j.perform()},this)}}.call(this),function(){"use strict";var a=Adagio.Error.import.ImportError,b=Adagio.Utils.measureUtils,c=Adagio.Utils.noteUtils;Adagio.import.normalizeChordsDurations=function(a){var c=b.getNotes(a),e={duration:null,voiceIdx:null};c.forEach(d,e)};var d=function(a){var b=this;if(c.isChord(a)){var d=e(b,a);c.setDuration(a,d)}else f(b,a)},e=function(b,d){var e,f=c.getVoiceIdx(d);if(null===b.duration)throw e="No former duration for the chord.",new a("NoFormerDuration",e);if(f!==b.voiceIdx)throw e="Previous duration voiceIdx ["+b.voiceIdx+"] is different from the chord voiceIdx ["+f+"].",new a("BadVoiceIdx",e);return b.duration},f=function(a,b){c.isRest(b)?(a.voiceIdx=null,a.duration=null):(a.voiceIdx=c.getVoiceIdx(b),a.duration=c.getDuration(b))}}.call(this),function(){"use strict";var a=Adagio.Values.SlurType,b=Adagio.Utils.measureUtils,c=Adagio.Utils.noteUtils,d=Adagio.Utils.slurUtils;Adagio.import.filterSlurs=function(a){var c=a.map(b.getNotes),d=Array.prototype.concat.apply([],c);new e(d).filter()};var e=function(a){this.init(a)},f=e.prototype;f.init=function(a){this.notes=a,this.slurNotes={}},f.filter=function(){this.notes.forEach(this.analyzeNote,this),this.discardPendingSlurs()},f.analyzeNote=function(a){c.hasSlur(a)&&(c.isChord(a)?c.removeSlur(a):this.addNote(a))},f.addNote=function(b){var e=c.getSlur(b),f=c.getVoiceIdx(b),g=d.getType(e);g===a.START?this.startSlur(f,b):g===a.STOP?this.stopSlur(f,b):g===a.CONTINUE?c.removeSlur(b):a.raiseError(g)},f.startSlur=function(a,b){this.hasNote(a)&&this.discardPendingSlur(a),this.slurNotes[a]=b},f.stopSlur=function(a,b){if(!this.hasNote(a))return void c.removeSlur(b);var e=c.getSlur(b),f=d.getLevel(e);if(this.getSlurLevel(a)!==f)return this.discardPendingSlur(a),void c.removeSlur(b);this.closePendingSlur(a)},f.hasNote=function(a){return void 0!==this.slurNotes[a]},f.getSlurLevel=function(a){var b=this.slurNotes[a],e=c.getSlur(b);return d.getLevel(e)},f.closePendingSlur=function(a){delete this.slurNotes[a]},f.discardPendingSlurs=function(){Object.keys(this.slurNotes).forEach(this.discardPendingSlur,this)},f.discardPendingSlur=function(a){var b=this.slurNotes[a];c.removeSlur(b),delete this.slurNotes[a]}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.measureUtils,c=Adagio.Utils.noteUtils,d=Adagio.Utils.slurUtils;Adagio.import.fillSlurs=function(a){new e(a).fill()};var e=function(a){this.init(a)},f=e.prototype;f.init=function(a){this.measures=a,this.voices={}},f.fill=function(){this.measures.forEach(this.fillMeasure,this)},f.fillMeasure=function(a,c){this.measureIdx=c,b.getNotes(a).forEach(this.analyzeNote,this)},f.analyzeNote=function(a){c.hasSlurStart(a)?this.startSlur(a):c.hasSlurStop(a)&&this.stopSlur(a)},f.startSlur=function(b){var d=c.getVoiceIdx(b);if(this.hasOngoingSlur(d)){throw new a("AlreadyOngoingSlur","There is already an ongoing slur for the voice ["+d+"].")}var e={note:b,measureIdx:this.measureIdx};this.voices[d]=e},f.stopSlur=function(b){var d=c.getVoiceIdx(b);if(!this.hasOngoingSlur(d)){throw new a("NoOngoingSlur","There is no ongoing slur for the voice ["+d+"].")}this.closePendingSlur(b)},f.hasOngoingSlur=function(a){return void 0!==this.voices[a]},f.closePendingSlur=function(a){var b=c.getVoiceIdx(a),d=this.voices[b];d.measureIdx!==this.measureIdx&&this.fillCrossMeasures(d,a),delete this.voices[b]},f.fillCrossMeasures=function(a,e){var f=a.note,g=c.getSlur(f);d.addCrossMeasure(g);var h=c.getSlur(e);d.addCrossMeasure(h);for(var i=c.getStaffIdx(f),j=c.getVoiceIdx(f),k=a.measureIdx,l=this.measureIdx,m=k;m<l;m++){var n=this.measures[m],o={staffIdx:i};b.setRightSlur(n,j,o);var p=this.measures[m+1],q={staffIdx:i};b.setLeftSlur(p,j,q)}}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.noteUtils;Adagio.import.fixNoteVoice=function(b){var e=a.getNotes(b),f=e.reduce(c,null);f>0&&e.forEach(d,f)};var c=function(a,c){var d=0;if(b.hasVoiceIdx(c)){var e=b.getVoiceIdx(c);e<0&&(d=Math.abs(e))}return Math.max(a,d)},d=function(a){var c=this;if(b.hasVoiceIdx(a)){var d=b.getVoiceIdx(a);b.setVoiceIdx(a,d+c)}}}.call(this),function(){"use strict";var a=Adagio.Utils.partContentUtils,b=Adagio.Utils.measureUtils,c=Adagio.Utils.noteUtils;Adagio.import.generateUnpitchedInstrumentsIds=function(b){var c={instrumentsIds:[],unpitchedMap:{}};return a.getMeasures(b).forEach(d,c),c.instrumentsIds};var d=function(a){var c=this;b.getNotes(a).forEach(e,c)},e=function(a){var b=this;if(c.hasUnpitched(a)){var d=c.getUnpitchedStr(a);void 0===b.unpitchedMap[d]&&(b.unpitchedMap[d]={});var e=c.getHead(a);void 0===b.unpitchedMap[d][e]&&(b.unpitchedMap[d][e]=f(b.instrumentsIds));var g=b.unpitchedMap[d][e];c.setInstrumentId(a,g)}},f=function(a){var b="I"+a.length;return a.push(b),b}}.call(this),function(){"use strict";var a=Adagio.Utils.partHeaderUtils,b=Adagio.Utils.scoreInstrumentUtils,c=Adagio.Utils.MIDIInstrumentUtils,d=Adagio.Values.MIDIValues,e="Woodblock",f="77";Adagio.import.fillUnpitchedInstrumentIds=function(b,c){var d=g(c);a.setScoreInstruments(b,d);var e=i(c);a.setMIDIInstruments(b,e)};var g=function(a){return a.map(h)},h=function(a){var c=b.create(e);return b.setId(c,a),c},i=function(a){return a.map(j)},j=function(a){var b=c.createMIDIInstrument(d.UNPITCHED_PROGRAM);return c.setId(b,a),c.setMIDIChannel(b,d.PERCUSSION_CHANNEL),c.setUnpitched(b,f),b}}.call(this),function(){"use strict";var a=Adagio.Utils.partContentUtils,b=Adagio.Utils.measureUtils,c=Adagio.Utils.noteUtils,d=Adagio.Utils.pitchUtils,e=Adagio.Utils.unpitchedUtils;Adagio.import.convertPitchedToUnpitched=function(b){a.getMeasures(b).forEach(f)};var f=function(a){b.getNotes(a).forEach(g)},g=function(a){if(c.hasPitch(a)){var b=c.getPitch(a),f=d.getStep(b),g=d.getOctave(b),h=e.create(g,f);a.unpitched=h,delete a.pitch}}}.call(this),function(){"use strict";var a=Adagio.Error.import.ImportError,b=Adagio.Utils.partHeaderUtils,c=Adagio.Utils.partContentUtils,d=Adagio.Utils.measureUtils,e=Adagio.Utils.attributesUtils,f=Adagio.Utils.clefUtils,g=Adagio.Utils.noteUtils,h=Adagio.import.generateUnpitchedInstrumentsIds,i=Adagio.import.fillUnpitchedInstrumentIds,j=Adagio.import.convertPitchedToUnpitched;Adagio.import.inferUnidentifiedUnpitchedParts=function(b,c){for(var d=0;d<b.length;){var e=c[d],f=b[d];k(f,e)?o(f,e)?d++:(b.splice(d,1),c.splice(d,1)):d++}if(0===b.length)throw new a("NoPartRemaining")};var k=function(a,c){return l(c)&&!b.hasUnpitched(a)},l=function(a){var b=c.getFirstMeasure(a),g=d.getOwnAttributes(b),h=e.getClef(g);if(0===h.length)return m(a);var i=h[0];return"percussion"===f.getSign(i)},m=function(a){return c.getMeasures(a).some(n)},n=function(a){return d.getNotes(a).some(g.hasUnpitched)},o=function(a,b){j(b);var c=h(b);return c.length>0&&(i(a,c),!0)}}.call(this),function(){"use strict";var a=Adagio.Utils.partHeaderUtils,b=Adagio.Utils.MIDIInstrumentUtils,c=Adagio.Utils.partContentUtils,d=Adagio.Utils.measureUtils,e=Adagio.Utils.transposeUtils,f={9:{name:"pitched-percussion.celesta",chromatic:0,diatonic:0,octaveChange:1},10:{name:"pitched-percussion.glockenspiel",chromatic:0,diatonic:0,octaveChange:2},14:{name:"pitched-percussion.xylophone",chromatic:0,diatonic:0,octaveChange:1},57:{name:"brass.trumpet",chromatic:-2,diatonic:-1,octaveChange:0},61:{name:"brass.horn",chromatic:-7,diatonic:-4,octaveChange:0},65:{name:"woodwinds.soprano-saxophone",chromatic:-2,diatonic:-1,octaveChange:0},66:{name:"woodwinds.alto-saxophone",chromatic:-9,diatonic:-5,octaveChange:0},67:{name:"woodwinds.tenor-saxophone",chromatic:-2,diatonic:-1,octaveChange:-1},68:{name:"woodwinds.baritone-saxophone",chromatic:-9,diatonic:-5,octaveChange:-1},70:{name:"woodwinds.brass.english-horn",chromatic:-7,diatonic:-4,octaveChange:0},72:{name:"woodwinds.clarinet",chromatic:-2,diatonic:-1,octaveChange:0},110:{name:"woodwinds.bagpipe",chromatic:-2,diatonic:-1,octaveChange:0},269:{name:"brass.baritone-horn-treble",chromatic:-2,diatonic:-1,octaveChange:-1},272:{name:"woodwinds.bass-clarinet",chromatic:-2,diatonic:-1,octaveChange:-1},274:{name:"woodwinds.alto-flute",chromatic:-5,diatonic:-3,octaveChange:0}};Adagio.import.fixPartTransposeDiatonic=function(c,d){if(!(a.getNbInstruments(c)>1||a.hasUnpitched(c))){var e=a.getMIDIInstruments(c),h=e[0];if(b.hasMIDIProgram(h)){var i=b.getMIDIProgram(h);if(void 0!==f[i]){var j=f[i];g(d,j)}}}};var g=function(a,b){for(var f=c.getFirstMeasure(a),g=d.getNbStaves(f),h=d.getWrappedTranspose(f),i=0;i<g;i++){var j=h.getEntry(i),k=e.getChromatic(j),l=e.getOctaveChange(j);k===b.chromatic&&l===b.octaveChange&&e.setDiatonic(j,b.diatonic)}}}.call(this),function(){"use strict";var a=Adagio.import.fixPartTransposeDiatonic;Adagio.import.fixPartsTransposeDiatonic=function(a,c){a.forEach(b,c)};var b=function(b,c){var d=this,e=d[c];a(b,e)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.noteUtils,c=Adagio.Utils.timeModifUtils,d=Adagio.Utils.math,e=[{src:c.create(4,3),dest:c.create(2,3)},{src:c.create(8,6),dest:c.create(4,6)},{src:c.create(9,6),dest:c.create(3,2)},{src:c.create(6,9),dest:c.create(2,3)},{src:c.create(3,1),dest:c.create(3,2)},{src:c.create(6,2),dest:c.create(6,4)},{src:c.create(36,4),dest:c.create(9,8)},{src:c.create(5,1),dest:c.create(5,4)},{src:c.create(7,8),dest:c.create(7,4)},{src:c.create(7,1),dest:c.create(7,4)},{src:c.create(9,4),dest:c.create(9,8)},{src:c.create(5,3),dest:c.create(5,6)},{src:c.create(10,8),dest:c.create(5,4)}];Adagio.import.convertMeasureTimeModifs=function(b){a.getNotes(b).forEach(f)};var f=function(a){if(b.hasTimeModif(a)){var c=b.getTimeModif(a);c=g(c),b.setTimeModif(a,c)}},g=function(a){var b=c.getActual(a),e=c.getNormal(a),f=b/e;if(d.isInteger(f)&&f%2==0)return c.createDefault();var g=h(a);return null!==g?g=c.copy(g):a},h=function(a){var b=e.find(i,a);return void 0!==b?b.dest:null},i=function(a){var b=this;return c.isSame(a.src,b)}}.call(this),function(){"use strict";var a=Adagio.Values.Placement,b=Adagio.Utils.harmonyUtils;Adagio.import.harmony.filterStackedHarmonies=function(a){return a=new c(a).filter()};var c=function(a){this.init(a)},d=c.prototype;d.init=function(a){this.sourceHarmonies=a,this.filtered=[],this.stack=[]},d.filter=function(){return this.sourceHarmonies.forEach(this.filterHarmony,this),this.isStackEmpty()||this.flushStack(),this.filtered},d.filterHarmony=function(a){this.canPushInStack(a)||this.flushStack(),this.stack.push(a)},d.canPushInStack=function(a){return!!this.isStackEmpty()||b.getTimePos(a)===this.getStackTimePos()},d.isStackEmpty=function(){return 0===this.stack.length},d.getStackTimePos=function(){var a=this.stack[0];return b.getTimePos(a)},d.flushStack=function(){var a=this.stack.reduce(e);this.stack=[],this.filtered.push(a)};var e=function(c,d){var e=b.getStaffIdx(c),f=b.getStaffIdx(d);if(e<f)return c;if(f<e)return d;var g=b.getPlacement(c),h=b.getPlacement(d);return g===a.ABOVE&&h===a.BELOW?c:d}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.harmonyUtils,c=Adagio.import.fillEntityTimePosFromMapping,d=Adagio.import.harmony.filterStackedHarmonies;Adagio.import.harmony.importMeasureHarmony=function(c){var g=a.getHarmonies(c);g=g.filter(b.isSupported);var h=a.getImportMapping(c);g=g.filter(e,h),g.forEach(f,h),g.sort(b.compareTimePos),g=d(g),b.cleanNoteBefore(g),a.setHarmonies(c,g)};var e=function(a){var c=this,d=b.getNoteBefore(a),e=d+1;return void 0!==c[e]||void 0!==c[e-1]},f=function(a){c(a,this,b)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.harmonyUtils;Adagio.import.harmony.removeOutsideHarmonies=function(b){var d=a.getHarmonies(b),e=a.getNbDivisions(b);d=d.filter(c,e),a.setHarmonies(b,d)};var c=function(a){var c=this.valueOf(),d=b.getTimePos(a);return!(d<0)&&!(d>=c)}}.call(this),function(){"use strict";(Adagio.Values.values={}).MAX_NB_VOICES_PER_STAFF=2}.call(this),function(){"use strict";var a=Adagio.Utils.mapUtils,b=Adagio.Values.values;Adagio.import.voiceMapping.isCorrectVoiceMapping=function(b,d){var e={nbStaves:d,nbVoicesPerStaff:{}};return a.every(b,c,e)};var c=function(a,c){if(1!==c.length)return!1;var d=c[0];return!(d<0||d>=this.nbStaves)&&(void 0===this.nbVoicesPerStaff[d]?this.nbVoicesPerStaff[d]=1:this.nbVoicesPerStaff[d]++,!(this.nbVoicesPerStaff[d]>b.MAX_NB_VOICES_PER_STAFF))}}.call(this),function(){"use strict";var a=Adagio.import.voiceMapping.isCorrectVoiceMapping,b=Adagio.Utils.partHeaderUtils,c=Adagio.Utils.partContentUtils;Adagio.import.voiceMapping.shouldExtractVoiceMapping=function(d,e){if(b.hasVoiceMapping(d)){var f=b.getVoiceMapping(d),g=c.getNbStaves(e);return!a(f,g)}return!0}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.noteUtils;Adagio.import.voiceMapping.extractVoicesStats=function(a){return new c(a).extract()};var c=function(a){this.init(a)},d=c.prototype;d.init=function(a){this.measures=a,this.voices={}},d.extract=function(){return this.measures.forEach(this.addMeasure,this),this.voices},d.addMeasure=function(b){a.getNotes(b).forEach(this.addNote,this)},d.addNote=function(a){var c=b.getVoiceIdx(a),d=b.getStaffIdx(a);if(!isNaN(d)){var f=this.getVoice(c);e(f,d)}},d.getVoice=function(a){if(void 0===this.voices[a]){var b=this.createVoiceData(a);this.voices[a]=b}return this.voices[a]},d.createVoiceData=function(a){return{voiceIdx:a,nbNotes:0,staves:{}}};var e=function(a,b){a.nbNotes++,void 0===a.staves[b]?a.staves[b]={staffIdx:b,nbNotes:1}:a.staves[b].nbNotes++}}.call(this),function(){"use strict";var a=Adagio.Utils.mapUtils;Adagio.import.voiceMapping.voicesStatsToEntries=function(c){var d=a.getValues(c);return d.sort(b),d.reverse(),d};var b=function(a,b){return a.nbNotes-b.nbNotes}}.call(this),function(){"use strict";var a=Adagio.Values.values;Adagio.import.voiceMapping.hasExcedentVoices=function(b,c){var d=c*a.MAX_NB_VOICES_PER_STAFF;return b.length>d}}.call(this),function(){"use strict";var a=Adagio.Values.values;Adagio.import.voiceMapping.removeExcedentVoices=function(b,c){var d=c*a.MAX_NB_VOICES_PER_STAFF;return b=b.slice(0,d)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Values.values;Adagio.import.voiceMapping.assignStavesToVoices=function(a,b){var d=new c(a,b);return d.assign(),d.shouldUpdateNotes()};var c=function(a,b){this.init(a,b)},d=c.prototype;d.init=function(a,b){this.voicesEntries=a,this.nbStaves=b,this.usedStaves={},this.orphanVoices=[],this.unusedStaffIndexes=null,this.shouldUpdateNotesValue=!1},d.assign=function(){this.assignStaves(),this.hasOrphanVoices()&&this.assignToOrphanVoices()},d.shouldUpdateNotes=function(){return this.shouldUpdateNotesValue},d.assignStaves=function(){this.voicesEntries.forEach(this.assignVoiceStaff,this)},d.assignVoiceStaff=function(a){var b=e(a.staves),c=b.filter(this.isFreeStaffData,this);if(c.length>0){c.sort(f),c.reverse();var d=c[0],g=d.staffIdx;a.staffIdx=g,this.useStaff(g),b.length>1&&(this.shouldUpdateNotesValue=!0)}else this.orphanVoices.push(a)};var e=function(a){var b=[];for(var c in a){var d=a[c];b.push(d)}return b};d.useStaff=function(a){void 0===this.usedStaves[a]?this.usedStaves[a]=1:this.usedStaves[a]++};var f=function(a,b){return a.nbNotes-b.nbNotes};d.isFreeStaffData=function(a){return this.isFreeStaff(a.staffIdx)},d.isFreeStaff=function(a){return this.getNbVoicesOnStaff(a)<b.MAX_NB_VOICES_PER_STAFF},d.getNbVoicesOnStaff=function(a){return void 0===this.usedStaves[a]?0:this.usedStaves[a]},d.hasOrphanVoices=function(){return this.orphanVoices.length>0},d.assignToOrphanVoices=function(){this.initUnusedStaffIndexes(),this.orphanVoices.forEach(this.assignToOrphanVoice,this)},d.initUnusedStaffIndexes=function(){this.unusedStaffIndexes=[];for(var a=0;a<this.nbStaves;a++)for(;this.isFreeStaff(a);)this.unusedStaffIndexes.push(a),this.useStaff(a)},d.assignToOrphanVoice=function(a){var b=this.getUnusedStaffIdx();a.staffIdx=b,this.shouldUpdateNotesValue=!0},d.getUnusedStaffIdx=function(){if(0===this.unusedStaffIndexes.length)throw new a("Unexpected");return this.unusedStaffIndexes.pop()}}.call(this),function(){"use strict";Adagio.import.voiceMapping.voicesEntriesToMapping=function(b){var c={};return b.forEach(a,c),c};var a=function(a){this[a.voiceIdx]=[a.staffIdx]}}.call(this);(function(){"use strict";var a=Adagio.Utils.mapUtils;Adagio.import.voiceMapping.fillEmptyStaves=function(a,c){var d=b(a),g=e(d,c);f(g,a)};var b=function(b){var d={};return a.forEach(b,c,d),d},c=function(a,b){var c=this;b.forEach(d,c)},d=function(a){this[a]=!0},e=function(a,b){for(var c=[],d=0;d<b;d++)void 0===a[d]&&c.push(d);return c},f=function(a,b){var c={seedVoiceIdx:0,voiceMapping:b};a.forEach(g,c)},g=function(a){var b=this.seedVoiceIdx,c=this.voiceMapping,d=h(b,c);this.seedVoiceIdx=d,c[d]=[a]},h=function(a,b){for(;void 0!==b[a];)a++;return a}}).call(this),function(){"use strict";var a=Adagio.import.voiceMapping.extractVoicesStats,b=Adagio.import.voiceMapping.voicesStatsToEntries,c=Adagio.import.voiceMapping.hasExcedentVoices,d=Adagio.import.voiceMapping.removeExcedentVoices,e=Adagio.import.voiceMapping.assignStavesToVoices,f=Adagio.import.voiceMapping.voicesEntriesToMapping,g=Adagio.import.voiceMapping.fillEmptyStaves,h=Adagio.Utils.partContentUtils;Adagio.import.voiceMapping.extractVoiceMapping=function(i){var j=h.getMeasures(i),k=a(j),l=b(k),m=h.getNbStaves(i),n=!1;c(l,m)&&(n=!0,l=d(l,m)),e(l,m)&&(n=!0);var o=f(l);return g(o,m),{shouldUpdateNotes:n,voiceMapping:o}}}.call(this),function(){"use strict";var a=Adagio.Utils.partContentUtils,b=Adagio.Utils.measureUtils,c=Adagio.Utils.noteUtils;Adagio.import.voiceMapping.updatePartNotes=function(b,c){a.getMeasures(b).forEach(d,c)};var d=function(a){var c=this,d=b.getNotes(a);d=d.filter(e,c),d.forEach(f,c),b.setNotes(a,d)},e=function(a){return void 0!==this[c.getVoiceIdx(a)]},f=function(a){var b=this,d=c.getVoiceIdx(a),e=b[d][0];c.setStaffIdx(a,e)}}.call(this),function(){"use strict";var a=Adagio.import.voiceMapping.shouldExtractVoiceMapping,b=Adagio.import.voiceMapping.extractVoiceMapping,c=Adagio.import.voiceMapping.updatePartNotes,d=Adagio.Utils.partHeaderUtils;Adagio.import.voiceMapping.fillPartVoiceMapping=function(e,f){if(a(e,f)){var g=b(f),h=g.voiceMapping;d.setVoiceMapping(e,h),g.shouldUpdateNotes&&c(f,h)}}}.call(this),function(){"use strict";var a=Adagio.import.voiceMapping.fillPartVoiceMapping;Adagio.import.voiceMapping.fillPartsVoiceMapping=function(a,c){a.forEach(b,c)};var b=function(b,c){var d=this,e=d[c];a(b,e)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.partHeaderUtils,c=Adagio.Utils.partContentUtils,d=Adagio.Utils.measureUtils,e=Adagio.Utils.noteUtils;Adagio.import.fixPartsNaNStaffIdx=function(a,b){a.forEach(f,b)};var f=function(a,d){var e=this,f=e[d],h=b.getVoiceMapping(a);c.getMeasures(f).forEach(g,h)},g=function(a){var b=this;d.getNotes(a).forEach(h,b)},h=function(b){var c=e.getStaffIdx(b);if(isNaN(c)){if(void 0===(c=this[e.getVoiceIdx(b)][0]))throw new a("Unexpected","Was not able to fix a staffIdx");e.setStaffIdx(b,c)}}}.call(this),function(){"use strict";Adagio.import.staffMapping.isCorrectStaffMapping=function(b,c,d){if(b.length!==d)return!1;var e={usedVoices:{},voiceMapping:c};return b.every(a,e)};var a=function(a,c){var d=this,e=a.mainVoiceIdx;return!!a.voices.includes(e)&&(d.staffIdx=c,a.voices.every(b,d))},b=function(a){var b=this;return void 0!==b.voiceMapping[a]&&(b.voiceMapping[a][0]===b.staffIdx&&(void 0===b.usedVoices[a]&&(b.usedVoices[a]=!0,!0)))}}.call(this),function(){"use strict";var a=Adagio.import.staffMapping.isCorrectStaffMapping,b=Adagio.Utils.partHeaderUtils,c=Adagio.Utils.partContentUtils;Adagio.import.staffMapping.shouldExtractStaffMapping=function(d,e){if(b.hasStaffMapping(d)){var f=b.getStaffMapping(d),g=b.getVoiceMapping(d),h=c.getNbStaves(e);return!a(f,g,h)}return!0}}.call(this),function(){"use strict";Adagio.import.staffMapping.mergeStatsEntries=function(a,b){var c=a.nbNotes+b.nbNotes;return{nbNotes:c,pitchValue:(a.nbNotes*a.pitchValue+b.nbNotes*b.pitchValue)/c}}}.call(this),function(){"use strict";var a=Adagio.import.staffMapping.mergeStatsEntries,b=Adagio.Utils.measureUtils,c=Adagio.Utils.noteUtils,d=Adagio.Utils.pitchUtils,e=Adagio.Utils.unpitchedUtils,f=Adagio.Values.Step;Adagio.import.staffMapping.extractMeasureStavesStats=function(a){var c={};return b.getNotes(a).forEach(g,c),c};var g=function(a){var b,d=this;if(c.hasPitch(a))b=h(a);else{if(!c.hasUnpitched(a))return;b=i(a)}var e=c.getStaffIdx(a),f=c.getVoiceIdx(a);k(d,e,f,b)},h=function(a){var b=c.getPitch(a),e=d.getOctave(b),f=d.getStep(b);return j(e,f)},i=function(a){var b=c.getUnpitched(a),d=e.getOctave(b),f=e.getStep(b);return j(d,f)},j=function(a,b){return a*f.getSize()+f.getStepIdx(b)},k=function(b,c,d,e){void 0===b[c]&&(b[c]={});var f=l(e);if(void 0===b[c][d])b[c][d]=f;else{var g=b[c][d],h=a(g,f);b[c][d]=h}},l=function(a){return{pitchValue:a,nbNotes:1}}}.call(this),function(){"use strict";var a=Adagio.Utils.clone,b=Adagio.Utils.mapUtils,c=Adagio.import.staffMapping.mergeStatsEntries;Adagio.import.staffMapping.mergeStavesStats=function(c,e){var f=a(c);return b.forEach(e,d,f),f};var d=function(c,d){var f=this;void 0===f[c]?f[c]=a(d):b.forEach(d,e,f[c])},e=function(b,d){var e=this;if(void 0===e[b])e[b]=a(d);else{var f=e[b],g=c(f,d);e[b]=g}}}.call(this),function(){"use strict";var a=Adagio.import.staffMapping.extractMeasureStavesStats,b=Adagio.import.staffMapping.mergeStavesStats;Adagio.import.staffMapping.extractStavesStats=function(c){return c.map(a).reduce(b)}}.call(this),function(){"use strict";var a=Adagio.Utils.mapUtils;Adagio.import.staffMapping.addEmptyVoicesToStats=function(c,d){a.forEach(d,b,c)};var b=function(a,b){var c=this;void 0===c[b]&&(c[b]={}),void 0===c[b][a]&&(c[b][a]={nbNotes:0,pitchValue:null})}}.call(this),function(){"use strict";var a=Adagio.Utils.mapUtils;Adagio.import.staffMapping.staffStatsToMappingEntry=function(c){var d=a.toPairs(c);return{voices:b(d),mainVoiceIdx:e(d)}};var b=function(a){
return a.sort(c),a.map(h)},c=function(a,b){var c=d(b.value.pitchValue),e=d(a.value.pitchValue),f=c-e;return 0!==f?f:h(a)-h(b)},d=function(a){return null===a?-1:a},e=function(a){var b=a.reduce(f);return h(b)},f=function(a,b){return g(a,b)<0?a:b},g=function(a,b){var c=b.value.nbNotes-a.value.nbNotes;return 0!==c?c:h(a)-h(b)},h=function(a){return parseInt(a.key,10)}}.call(this),function(){"use strict";var a=Adagio.import.staffMapping.staffStatsToMappingEntry;Adagio.import.staffMapping.stavesStatsToMapping=function(b,c){for(var d=[],e=0;e<c;e++){var f=b[e],g=a(f);d.push(g)}return d}}.call(this),function(){"use strict";var a=Adagio.import.staffMapping.extractStavesStats,b=Adagio.import.staffMapping.addEmptyVoicesToStats,c=Adagio.import.staffMapping.stavesStatsToMapping,d=Adagio.Utils.partContentUtils,e=Adagio.Utils.partHeaderUtils;Adagio.import.staffMapping.extractStaffMapping=function(f,g){var h=d.getMeasures(g),i=a(h),j=e.getVoiceMapping(f);b(i,j);var k=d.getNbStaves(g);return c(i,k)}}.call(this),function(){"use strict";var a=Adagio.import.staffMapping.shouldExtractStaffMapping,b=Adagio.import.staffMapping.extractStaffMapping,c=Adagio.Utils.partHeaderUtils;Adagio.import.staffMapping.fillPartStaffMapping=function(d,e){if(a(d,e)){var f=b(d,e);c.setStaffMapping(d,f)}}}.call(this),function(){"use strict";var a=Adagio.import.staffMapping.fillPartStaffMapping;Adagio.import.staffMapping.fillPartsStaffMapping=function(a,c){a.forEach(b,c)};var b=function(b,c){var d=this,e=d[c];a(b,e)}}.call(this),function(){"use strict";var a=Adagio.Utils.directionUtils,b=Adagio.Utils.wedgeUtils,c=Adagio.Utils.directionTypeUtils;Adagio.Utils.direction.extractWedge=function(d,e){var f=a.extractCanvas(d),g=c.getWedge(e);g=b.copy(g);var h=c.createWedge(g);return a.setEntry(f,h),f}}.call(this),function(){"use strict";var a=Adagio.Utils.direction.extractWedge,b=Adagio.Utils.directionUtils,c=Adagio.Utils.directionTypeUtils,d=Adagio.Utils.typeUtils,e=Adagio.Values.DirectionType,f=d.pairsToMap([{key:e.WEDGE,value:a}]);Adagio.Utils.direction.splitDirection=function(a){var c=b.getEntries(a),e=c.map(g,a);return e=e.filter(d.isTruthy)};var g=function(a){var b=c.getType(a);if(h(b)){return i(b)(this,a)}},h=function(a){return void 0!==f[a]},i=function(a){return f[a]}}.call(this),function(){"use strict";var a=Adagio.Utils.directionUtils,b=Adagio.Utils.direction.splitDirection,c=null;Adagio.Data.direction.splitByType=function(a){return f().split(a)};var d=function(){},e=d.prototype;e.split=function(a){return this.reset(),a.forEach(this.splitDirection,this),this.map},e.reset=function(){this.map={}},e.splitDirection=function(a){b(a).forEach(this.addDirection,this)},e.addDirection=function(b){var c=a.getType(b);this.getDirections(c).push(b)},e.getDirections=function(a){return void 0===this.map[a]&&(this.map[a]=[]),this.map[a]};var f=function(){return null===c&&(c=new d),c}}.call(this),function(){"use strict";var a=Adagio.Values.DirectionType,b=Adagio.Utils.measureUtils,c=Adagio.Data.direction.splitByType;Adagio.import.wedge.splitMeasuresWedges=function(a){var e=a.map(b.getRawDirections),f=e.map(c);return d(f)};var d=function(a){var b=a.map(e);return{wedgeDirectionsByMeasures:b.map(g),otherDirectionsByTypeByMeasures:b.map(h)}},e=function(a){return{wedgeDirections:f(a),otherDirectionsByType:a}},f=function(b){if(void 0!==b[a.WEDGE]){var c=b[a.WEDGE];return delete b[a.WEDGE],c}return[]},g=function(a){return a.wedgeDirections},h=function(a){return a.otherDirectionsByType}}.call(this),function(){"use strict";var a=Adagio.Utils.directionUtils,b=Adagio.Utils.wedgeUtils,c=Adagio.Values.WedgeType;Adagio.import.wedge.groupWedges=function(a){return a=new d(a).group()};var d=function(a){this.init(a)},e=d.prototype;e.init=function(a){this.wrappedDirections=a,this.ongoingWedges={},this.previousLocation={},this.grouppedDirections=[]},e.group=function(){return this.wrappedDirections.forEach(this.analyzeWedge,this),this.grouppedDirections},e.analyzeWedge=function(d){var e=d.direction,f=a.getWedge(e),g=b.getRawType(f);g===c.CONTINUE||(g===c.CRESCENDO||g===c.DIMINUENDO?this.startWedge(d):g===c.STOP?this.stopWedge(d):c.raiseError(g))},e.startWedge=function(c){var d=c.direction,e=a.getWedge(d),g=b.getNumber(e),h=a.getTimePos(d),i=a.getStaffIdx(d),j=this.previousLocation[i];j&&f(j,c.measureIdx,h)||this.addWedgeStart(i,g,c)};var f=function(a,b,c){return a.measureIdx===b&&a.timePos===c};e.addWedgeStart=function(a,b,c){void 0===this.ongoingWedges[a]&&(this.ongoingWedges[a]={}),this.ongoingWedges[a][b]=c},e.stopWedge=function(c){var d=c.direction,e=a.getWedge(d),f=b.getNumber(e),i=a.getStaffIdx(d);if(this.hasWedgeStart(i,f)){var j=this.getWrappedStart(i,f),k=j.direction;if(!g(k,d)||h(j,c))this.discardDirection(i,f);else{this.ongoingWedges[i]={},this.addCompleteWedge(j,c);var l=a.getTimePos(d);this.previousLocation[i]={timePos:l,measureIdx:j.measureIdx}}}},e.hasWedgeStart=function(a,b){return void 0!==this.ongoingWedges[a]&&void 0!==this.ongoingWedges[a][b]},e.getWrappedStart=function(a,b){return this.ongoingWedges[a][b]},e.discardDirection=function(a,b){delete this.ongoingWedges[a][b]};var g=function(b,c){var d=a.getPlacement(b),e=a.getPlacement(c),f=a.getStaffIdx(b),g=a.getStaffIdx(c);return d===e&&f===g},h=function(a,b){return a.timePos===b.timePos&&a.measureIdx===b.measureIdx};e.addCompleteWedge=function(a,b){this.grouppedDirections.push(a),this.grouppedDirections.push(b)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Values.DirectionType;Adagio.import.wedge.insertMeasuresWedges=function(c,d){if(c.length!==d.length){throw new a("Unexpected","measures wedges and other directions array should have the same length.")}return c.forEach(function(a,c){var e=d[c];e.length>0&&(a[b.WEDGE]=e)}),c}}.call(this),function(){"use strict";Adagio.Data.direction.compareWrappedDirectionsInc=function(a,b){var c=a.measureIdx-b.measureIdx;return 0!==c?c:a.timePos-b.timePos}}.call(this),function(){"use strict";var a=Adagio.Utils.directionUtils,b=Adagio.Data.direction.compareWrappedDirectionsInc;Adagio.Data.direction.wrappMeasureDirections=function(a,d){var e=a.map(c,d);return e.sort(b),e};var c=function(b){var c=this.valueOf();return{timePos:a.getTimePos(b),measureIdx:c,direction:b}}}.call(this),function(){"use strict";var a=Adagio.Data.direction.wrappMeasureDirections;Adagio.Data.direction.wrappMeasuresDirections=function(b){var c=b.map(a);return Array.prototype.concat.apply([],c)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError;Adagio.Data.direction.unwrappDirections=function(a,c){return new b(a,c).unwrappDirections()};var b=function(a,b){this.init(a,b)},c=b.prototype;c.init=function(a,b){this.wrappedDirections=a,this.nbMeasures=b,this.directionsByMeasures=[]},c.unwrappDirections=function(){return this.wrappedDirections.forEach(this.unwrappDirection,this),this.fillEmptyMeasuresDirections(),this.directionsByMeasures},c.unwrappDirection=function(a){var b=a.measureIdx;this.getMeasureDirections(b).push(a.direction)},c.getMeasureDirections=function(b){if(b>=this.nbMeasures||b<0){throw new a("BadMeasureIdx","Invalid measure index: ["+b+"].")}return this.createMeasuresDirections(b),this.directionsByMeasures[b]},c.fillEmptyMeasuresDirections=function(){this.createMeasuresDirections(this.nbMeasures-1)},c.createMeasuresDirections=function(a){for(var b=this.directionsByMeasures.length,c=b;c<=a;c++)this.directionsByMeasures.push([])}}.call(this),function(){"use strict";var a=Adagio.Utils.directionUtils,b=Adagio.Utils.directionTypeUtils;Adagio.Utils.direction.addWedge=function(c,d){var e=a.getWedge(d),f=b.createWedge(e);a.addEntry(c,f)}}.call(this),function(){"use strict";var a=Adagio.Utils.direction.addWedge,b=Adagio.Utils.directionUtils;Adagio.Data.direction.insertWedge=function(b,d){if(d.some(c,b)){var e=d.find(c,b);a(e,b)}else d.push(b)};var c=function(a){var c=this;return b.isSameVerticalPos(a,c)}}.call(this),function(){"use strict";var a=Adagio.Utils.directionUtils,b=null;Adagio.Data.direction.indexDirectionsByTime=function(a){return e().index(a)};var c=function(){},d=c.prototype;d.index=function(a){return this.reset(),a.forEach(this.addDirection,this),this.map},d.reset=function(){this.map={}},d.addDirection=function(b){var c=a.getTimePos(b);this.getEntry(c).push(b)},d.getEntry=function(a){return void 0===this.map[a]&&(this.map[a]=[]),this.map[a]};var e=function(){return null===b&&(b=new c),b}}.call(this),function(){"use strict";Adagio.Data.direction.flattenIndexedDirections=function(a){var b=[];for(var c in a){var d=a[c];Array.prototype.push.apply(b,d)}return b}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Values.DirectionType,c=Adagio.Data.direction.insertWedge,d=Adagio.Data.direction.indexDirectionsByTime,e=Adagio.Data.direction.flattenIndexedDirections,f=function(a){return function(b){a(b,this)}},g=f(c);Adagio.Data.direction.mergeTypeDirections=function(a){var b={};for(var c in a){var f=a[c],g=d(f),i=h(c);for(var j in g){var k=g[j];void 0===b[j]&&(b[j]=[]);var l=b[j];k.forEach(i,l)}}return e(b)};var h=function(c){if(c===b.WEDGE)return g;throw new a("Unexpected","The direction type ["+c+"] is unexpected at this code location.")}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.measureUtils,c=Adagio.import.wedge.splitMeasuresWedges,d=Adagio.import.wedge.groupWedges,e=Adagio.import.wedge.insertMeasuresWedges,f=Adagio.Data.direction.wrappMeasuresDirections,g=Adagio.Data.direction.unwrappDirections,h=Adagio.Data.direction.mergeTypeDirections;Adagio.import.wedge.filterWedges=function(a){var b=a.length,j=c(a),k=j.wedgeDirectionsByMeasures,l=j.otherDirectionsByTypeByMeasures,m=f(k);m=d(m),k=g(m,b);var n=e(l,k),o=n.map(h);i(a,o)};var i=function(c,d){if(c.length!==d.length){throw new a("NotSameSize","Array size should be the same.")}c.forEach(function(a,c){var e=d[c];b.setDirections(a,e)})}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Data.wedge.wrappDirectionsWedges,c=Adagio.Data.wedge.compareWrappedWedges;Adagio.Data.wedge.wrappMeasureWedges=function(e,f){var g=a.getWedgeDirections(e),h=b(g);return h.sort(c),"number"==typeof f&&h.forEach(d,f),h};var d=function(a){var b=this.valueOf();a.measureIdx=b}}.call(this),function(){"use strict";var a=Adagio.Data.wedge.wrappMeasureWedges;Adagio.Data.wedge.wrappMeasuresWedges=function(c,d){var e=c.map(a);return"number"==typeof d&&b(e,d),Array.prototype.concat.apply([],e)};var b=function(a,b){a.forEach(c,b)},c=function(a){var b=this.valueOf();a.forEach(d,b)},d=function(a){var b=this.valueOf();a.measureIdx+=b}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.math;Adagio.edit.common.countWedgeNbNotes=function(a,b){var h=0;return 0===c(b)?h+=d(a,b):(h+=e(a,b),h+=g(a,b),h+=f(a,b)),h};var c=function(a){return a.stopMeasureIdx-a.startMeasureIdx},d=function(a,c){var d=a.getMeasureData(c.startMeasureIdx),e=c.startTimePos,f=c.stopTimePos,g=h(d);g.sort(b.cmp);var i=0;return g.some(function(a){if(a>=f)return!0;a>=e&&i++}),i},e=function(a,c){var d=a.getMeasureData(c.startMeasureIdx),e=c.startTimePos,f=h(d);f.sort(b.cmp);var g=0;return f.forEach(function(a){a>=e&&g++}),g},f=function(a,c){var d=a.getMeasureData(c.stopMeasureIdx),e=c.stopTimePos,f=h(d);f.sort(b.cmp);var g=0;return f.some(function(a){if(a>=e)return!0;g++}),g},g=function(a,b){for(var c=0,d=b.startMeasureIdx,e=b.stopMeasureIdx,f=d+1;f<e;f++){var g=a.getMeasureData(f);c+=h(g).length}return c},h=function(a){var c={};a.forEachVoice(i,c);var d=Object.keys(c);return d=d.map(b.intPart)},i=function(b){for(var c=this,d=0,e=b.size(),f=0;f<e;f++){c[d]=0;var g=b.getNote(f);d+=a.getDuration(g)}}}.call(this),function(){"use strict";var a=Adagio.Values.WedgeLocation,b=Adagio.Utils.measureUtils,c=Adagio.Utils.wedgeUtils,d=Adagio.Utils.directionTypeUtils,e=Adagio.Utils.directionUtils,f=Adagio.Utils.mapUtils,g=Adagio.Data.wedge.wrappMeasuresWedges,h=Adagio.edit.common.countWedgeNbNotes,i=Adagio.edit.common.MeasuresScroller;Adagio.import.wedge.fillWedges=function(a){var b=g(a),c=j(b);f.forEach(c,function(b,c){new l(c,a).fillWedges()})};var j=function(a){var b={};return a.forEach(k,b),b},k=function(a){var b=this,c=e.getStaffIdx(a.direction);void 0===b[c]&&(b[c]=[]),b[c].push(a)},l=function(a,b){this.init(a,b)},m=l.prototype;m.init=function(a,b){this.wrappedWedges=a,this.measures=b,this.measuresScroller=null},m.fillWedges=function(){for(var a=this.wrappedWedges.length,b=0;b<a-1;b+=2){var c=this.wrappedWedges[b],d=this.wrappedWedges[b+1];this.fillWedge(c,d)}},m.fillWedge=function(a,b){var d=a.wedge,e=b.wedge,f=c.getRawType(d),g=this.getNbNotes(a,b);c.fillStartTagInternalValues(d,f,g),c.fillStopTagInternalValues(e,f);var h=a.measureIdx,i=b.measureIdx;this.addContinues(h,i,a)},m.getNbNotes=function(a,b){var c=e.getTimePos(a.direction),d=e.getTimePos(b.direction),f={startMeasureIdx:a.measureIdx,startTimePos:c,stopMeasureIdx:b.measureIdx,stopTimePos:d},g=this.getMeasuresScroller();return h(g,f)},m.getMeasuresScroller=function(){if(null===this.measuresScroller){this.measuresScroller=new i(this.measures,null,null)}return this.measuresScroller},m.addContinues=function(a,b,c){for(var d=a;d<b;d++)this.addContinue(d,c)},m.addContinue=function(f,g){var h=c.getRawType(g.wedge),i=g.direction,j=e.getStaffIdx(i),k=this.measures[f],l=e.extractCanvas(i),m=c.create(a.RIGHT_CONTINUE,h),n=d.createWedge(m);e.addEntry(l,n),b.setRightWedge(k,j,l);var o=this.measures[f+1],p=e.extractCanvas(i),q=c.create(a.LEFT_CONTINUE,h),r=d.createWedge(q);e.addEntry(p,r),b.setLeftWedge(o,j,p)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.noteUtils,c=Adagio.Utils.arpeggiateUtils;Adagio.import.cleanMeasureArpeggios=function(a){d().clean(a)};var d=function(){return null===e&&(e=new f),e},e=null,f=function(){},g=f.prototype;g.clean=function(b){this.reset(),a.getNotes(b).forEach(this.addNote,this),this.analyzeChord()},g.reset=function(){this.currentChord=null},g.addNote=function(a){b.isChord(a)?this.addToChord(a):(this.hasCurrentChord()&&this.analyzeChord(),this.createChord(a))},g.addToChord=function(a){this.currentChord.push(a)},g.hasCurrentChord=function(){return null!==this.currentChord},g.createChord=function(a){this.currentChord=[a]},g.analyzeChord=function(){this.currentChord.some(b.hasArpeggiate)&&1!==this.currentChord.length?this.cleanArpeggio():this.removeArpeggio(),this.currentChord=null},g.removeArpeggio=function(){this.currentChord.forEach(b.removeArpeggiate)},g.cleanArpeggio=function(){this.currentChord.forEach(h)};var h=function(a){var d=c.create();b.setArpeggiate(a,d),b.removeTieStop(a)}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils;Adagio.import.groupChords=function(a){return new b(a).group(a)};var b=function(a){this.init(a)},c=b.prototype;c.init=function(a){this.notes=a,this.tmpChord=null,this.chords=[]},c.group=function(){return this.notes.forEach(this.addNote,this),this.dumpChord(),this.chords},c.addNote=function(b){a.isRest(b)?(this.dumpChord(),this.addRest()):a.isChord(b)?this.addToChord(b):(this.dumpChord(),this.addSingleNote(b))},c.dumpChord=function(){null!==this.tmpChord&&(this.chords.push(this.tmpChord),this.tmpChord=null)},c.addRest=function(){this.chords.push([])},c.addToChord=function(a){this.tmpChord.push(a)},c.addSingleNote=function(a){this.tmpChord=[a]}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.noteUtils,c=Adagio.import.ties.TieBuffer=function(){this.init()},d=c.prototype;d.init=function(){this.leftNotes={}},d.addChord=function(a){this.matchTies(a),this.dropStartedTies(),this.storeStartingTies(a)},d.matchTies=function(a){a=a.filter(b.hasTieStop),a=e(a);var c;for(c in this.leftNotes)void 0!==a[c]&&(delete this.leftNotes[c],delete a[c]);for(c in a){var d=a[c];b.removeTieStop(d)}},d.dropStartedTies=function(){for(var a in this.leftNotes){var c=this.leftNotes[a];b.removeTieStart(c)}this.leftNotes={}},d.storeStartingTies=function(a){a=a.filter(b.hasTieStart),this.leftNotes=e(a)};var e=function(c){var d={};return c.forEach(function(c){var e;if(b.hasPitch(c))e=b.getPitchStr(c);else{if(!b.hasUnpitched(c))throw new a("Unexpected");var f=b.getHead(c);e=b.getUnpitchedStr(c)+f}d[e]=c}),d};d.endReached=function(){this.dropStartedTies()}}.call(this),function(){"use strict";var a=Adagio.Utils.voiceUtils,b=Adagio.Utils.noteUtils,c=Adagio.import.groupChords,d=Adagio.import.ties.TieBuffer;Adagio.import.ties.removeOrphanTies=function(a){new e(a).filter()};var e=function(a){this.init(a)},f=e.prototype;f.init=function(a){this.measures=a,this.buffers={}},f.filter=function(){this.measures.forEach(this.filterMeasure,this),this.flushBuffers()},f.filterMeasure=function(b){var c=b.note,d=a.groupVoices(c);for(var e in d){var f=d[e];this.filterNotes(f)}},f.filterNotes=function(a){var b=g(a),d=this.getVoiceBuffer(b);c(a).forEach(d.addChord,d)};var g=function(a){var c=a[0];return b.getVoiceIdx(c)};f.getVoiceBuffer=function(a){return this.hasBuffer(a)||this.createBuffer(a),this.buffers[a]},f.hasBuffer=function(a){return void 0!==this.buffers[a]},f.createBuffer=function(a){this.buffers[a]=new d},f.flushBuffers=function(){for(var a in this.buffers){this.buffers[a].endReached()}}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Data.beam.createBeamEntry,c=Adagio.Data.beam.fillEntryConnections,d=Adagio.Data.beam.createNoteBeams;Adagio.Data.beam.fillNotesBeams=function(a,b){var c=a.map(e,b);c.forEach(f);var h=c.map(d);a.forEach(g,h)};var e=function(a){var c=this.valueOf();return b(a,c)},f=function(a,b,d){var e=null,f=null;b>0&&(e=d[b-1]),b<d.length-1&&(f=d[b+1]),c(e,a,f)},g=function(b,c){var d=this,e=d[c];a.setBeams(b,e)}}.call(this),function(){"use strict";var a=Adagio.Utils.beamUtils,b=Adagio.Utils.orderedBeamsUtils={};b.isVerticalConsistent=function(a){return a.every(c)};var c=function(b,c,d){if(a.getNumber(b)!==c)return!1;if(0===c)return a.isTopConsistent(b);var e=d[c-1];return a.isConsistentWithUpper(b,e)};b.isConsistentWithLeft=function(b,c){for(var d=c.length,e=b.length,f=Math.max(d,e),g=0;g<f;g++){var h=g>=d?null:c[g],i=g>=e?null:b[g];if(!a.isConsistentWithLeft(i,h))return!1}return!0},b.isConsistentBegin=function(b){return b.every(a.isConsistentBegin)},b.isConsistentEnd=function(b){return b.every(a.isConsistentEnd)}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.orderedBeamsUtils;Adagio.import.beam.isBeamConsistent=function(b){return b.map(a.getOrderedBeams).every(c)};var c=function(a,c,d){if(!b.isVerticalConsistent(a))return!1;if(0===c){if(!b.isConsistentBegin(a))return!1}else{if(c===d.length-1&&!b.isConsistentEnd(a))return!1;var e=d[c-1];if(!b.isConsistentWithLeft(a,e))return!1}return!0}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.noteUtils,c=Adagio.Utils.attributesUtils,d=Adagio.Data.beam.fillNotesBeams,e=Adagio.import.beam.isBeamConsistent,f=Adagio.import.beam.BeamBuffer=function(a,b){this.init(a,b)},g=f.prototype;g.init=function(a,b){this.voiceIdx=a,this.hasOngoingBeam=!1,this.beamNotes=[],this.attributes=b},g.addNote=function(c){var d=b.getVoiceIdx(c);if(d!==this.voiceIdx){throw new a("BadVoiceIdx","The voice idx ["+d+"] is invalid for this buffer.")}b.hasBeam(c)?b.hasFirstBeam(c)?b.isBeamBegin(c)?this.beginBeam(c):b.isBeamContinue(c)?this.continueBeam(c):b.isBeamEnd(c)?this.endBeam(c):(b.makeUnbeamed(c),this.dropBeam()):(b.makeUnbeamed(c),this.dropBeam()):this.dropBeam()},g.beginBeam=function(a){this.hasOngoingBeam&&this.dropBeam(),this.beamNotes.push(a),this.hasOngoingBeam=!0},g.dropBeam=function(){this.beamNotes.forEach(b.makeUnbeamed),this.beamNotes=[],this.hasOngoingBeam=!1},g.continueBeam=function(a){this.hasOngoingBeam?this.beamNotes.push(a):b.makeUnbeamed(a)},g.endBeam=function(a){this.hasOngoingBeam?(this.beamNotes.push(a),this.closeBeam()):b.makeUnbeamed(a)},g.closeBeam=function(){if(e(this.beamNotes)){var a=c.getDpq(this.attributes);d(this.beamNotes,a),this.hasOngoingBeam=!1,this.beamNotes=[]}else this.dropBeam()}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.attributesUtils,c=Adagio.Utils.noteUtils,d=Adagio.Utils.mapUtils,e=Adagio.import.beam.BeamBuffer;Adagio.import.beam.removeOrphanBeams=function(b){var c=a.getNotes(b),d=a.getAttributes(b);new f(c,d).filter()};var f=function(a,b){this.init(a,b)},g=f.prototype;g.init=function(a,b){this.notes=a,this.attributes=b,this.buffers={}},g.filter=function(){this.notes.forEach(this.analyzeNote,this),this.flushBuffers()},g.analyzeNote=function(a){if(this.shouldUnbeam(a))c.makeUnbeamed(a);else{var b=c.getVoiceIdx(a);this.getBuffer(b).addNote(a)}},g.shouldUnbeam=function(a){var d=b.getDpq(this.attributes);return c.isChord(a)||c.isGraceNote(a)||!c.canHoldFlag(a,d)},g.getBuffer=function(a){return void 0===this.buffers[a]&&(this.buffers[a]=new e(a,this.attributes)),this.buffers[a]},g.flushBuffers=function(){d.forEach(this.buffers,h)};var h=function(a,b){b.dropBeam()}}.call(this),function(){"use strict";Adagio.import.metadata.getTitleFromMovementTitle=function(a,b){if(a.hasMovementTitle()){var c=a.getMovementTitle();b.title=c}}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Values.CreditType={TITLE:"title",SUBTITLE:"subtitle",RIGHTS:"rights",COMPOSER:"composer",LYRICIST:"lyricist"};b.internalValues=[b.TITLE,b.SUBTITLE],b.assertInternal=function(a){b.isValidInternal(a)||b.raiseError(a)},b.isValidInternal=function(a){return b.internalValues.includes(a)},b.raiseError=function(b){throw new a("CreditType","Invalid internal value for wedge type: ["+b+"].")}}.call(this),function(){"use strict";var a=Adagio.Values.CreditType,b=Adagio.Utils.typeUtils,c=Adagio.Utils.mxlUtils,d=Adagio.Utils.creditUtils={};d.setText=function(a,b){a["credit-words"]=b},d.getFontSize=function(a){var c=d.getCreditWords(a);if(!b.isObject(c))return 0;if("string"!=typeof c["$font-size"])return 0;var e=parseFloat(c["$font-size"]);return isNaN(e)?0:e},d.getText=function(a){var b=d.getCreditWords(a);return void 0===b?"":c.stringOrContent(b)},d.getCreditWords=function(a){return c.getArray(a,"credit-words").find(c.hasStringOrContent)},d.isTitle=function(b){return d.isType(b,a.TITLE)},d.isSubtitle=function(b){return d.isType(b,a.SUBTITLE)},d.isRights=function(b){return d.isType(b,a.RIGHTS)},d.isComposer=function(b){return d.isType(b,a.COMPOSER)},d.isLyricist=function(b){return d.isType(b,a.LYRICIST)},d.isType=function(a,b){return d.getType(a)===b},d.getType=function(a){return a["credit-type"]},d.hasNoType=function(a){return!d.hasType(a)},d.hasType=function(a){return void 0!==a["credit-type"]},d.createTitle=function(b){return d.create(b,a.TITLE)},d.createSubtitle=function(b){return d.create(b,a.SUBTITLE)},d.create=function(b,c){return a.assertInternal(c),{"credit-type":c,"credit-words":b}}}.call(this),function(){"use strict";var a=Adagio.Utils.creditUtils,b=Adagio.Utils.creditsUtils={};b.hasComposer=function(b){return b.some(a.isComposer)},b.getComposer=function(b){var c=b.find(a.isComposer);return a.getText(c)},b.removeComposer=function(c){b.removeEntry(c,a.isComposer)},b.removeLyricist=function(c){b.removeEntry(c,a.isLyricist)},b.hasLyricist=function(b){return b.some(a.isLyricist)},b.getLyricist=function(b){var c=b.find(a.isLyricist);return a.getText(c)},b.setTitle=function(d,e){var f;c(e)?b.removeEntry(d,a.isTitle):b.hasTitle(d)?(f=b.getTitleEntry(d),a.setText(f,e)):(f=a.createTitle(e),d.push(f))},b.setSubtitle=function(d,e){var f;c(e)?b.removeEntry(d,a.isSubtitle):b.hasSubtitle(d)?(f=b.getSubtitleEntry(d),a.setText(f,e)):(f=a.createSubtitle(e),d.push(f))};var c=function(a){return""===a.trim()};b.hasTitle=function(b){return b.some(a.isTitle)},b.getTitle=function(c){var d=b.getTitleEntry(c);return a.getText(d)},b.getTitleEntry=function(b){return b.find(a.isTitle)},b.hasFallbackTitle=function(b){return b.some(a.hasNoType)},b.getFallbackTitle=function(b){var c=b.filter(a.hasNoType),e=c.reduce(d);return a.getText(e)};var d=function(b,c){return a.getFontSize(b)>=a.getFontSize(c)?b:c};b.hasRights=function(b){return b.some(a.isRights)},b.getRights=function(b){var c=b.find(a.isRights);return a.getText(c)},b.removeRights=function(c){b.removeEntry(c,a.isRights)},b.hasSubtitle=function(b){return b.some(a.isSubtitle)},b.getSubtitle=function(c){var d=b.getSubtitleEntry(c);return a.getText(d)},b.getSubtitleEntry=function(b){return b.find(a.isSubtitle)},b.removeEntry=function(a,b){var c=a.findIndex(b);-1!==c&&a.splice(c,1)}}.call(this),function(){"use strict";var a=Adagio.Utils.creditsUtils;Adagio.import.metadata.getTitleFromCredits=function(b,c){a.hasTitle(b)?c.title=a.getTitle(b):a.hasFallbackTitle(b)&&(c.title=a.getFallbackTitle(b))}}.call(this),function(){"use strict";var a=Adagio.Utils.creditsUtils;Adagio.import.metadata.getSubtitleFromCredits=function(b,c){a.hasSubtitle(b)&&(c.subtitle=a.getSubtitle(b))}}.call(this),function(){"use strict";var a=Adagio.Utils.creditsUtils;Adagio.import.metadata.getRightsFromCredits=function(b,c){a.hasRights(b)&&(c.rights=a.getRights(b))}}.call(this),function(){"use strict";var a=Adagio.Utils.creditsUtils;Adagio.import.metadata.getCreatorsFromCredits=function(b,c){a.hasComposer(b)&&(c.composer=a.getComposer(b)),a.hasLyricist(b)&&(c.lyricist=a.getLyricist(b))}}.call(this),function(){"use strict";Adagio.Values.CreatorType={COMPOSER:"composer",LYRICIST:"lyricist"}}.call(this),function(){"use strict";var a=Adagio.Utils.typedStringUtils={};a.getString=function(a){return"string"==typeof a.content?a.content:""},a.setString=function(a,b){a.content=b},a.getType=function(a){return a.$type},a.create=function(a,b){return{$type:a,content:b}}}.call(this),function(){"use strict";var a=Adagio.Values.CreatorType,b=Adagio.Utils.typedStringUtils,c=Adagio.Utils.creatorsUtils={};c.hasComposer=function(b){return c.hasCreatorType(b,a.COMPOSER)},c.getComposerStr=function(a){var d=c.getComposer(a);return b.getString(d)},c.setComposerStr=function(e,f){var g;d(f)?c.removeEntry(e,a.COMPOSER):c.hasComposer(e)?(g=c.getComposer(e),b.setString(g,f)):(g=b.create(a.COMPOSER,f),e.push(g))},c.getComposer=function(b){return c.getCreator(b,a.COMPOSER)},c.hasLyricist=function(b){return c.hasCreatorType(b,a.LYRICIST)},c.getLyricistStr=function(a){var d=c.getLyricist(a);return b.getString(d)},c.setLyricistStr=function(e,f){var g;d(f)?c.removeEntry(e,a.LYRICIST):c.hasLyricist(e)?(g=c.getLyricist(e),b.setString(g,f)):(g=b.create(a.LYRICIST,f),e.push(g))},c.getLyricist=function(b){return c.getCreator(b,a.LYRICIST)},c.hasCreatorType=function(a,b){return a.some(e,b)},c.getCreator=function(a,b){return a.find(e,b)};var d=function(a){return""===a.trim()};c.removeEntry=function(a,b){var c=a.findIndex(e,b);-1!==c&&a.splice(c,1)};var e=function(a){var c=this.valueOf();return b.getType(a)===c}}.call(this),function(){"use strict";var a=Adagio.Utils.mxlUtils,b=Adagio.Utils.creatorsUtils,c=Adagio.Utils.identificationUtils={};c.hasComposer=function(a){var d=c.getCreators(a);return b.hasComposer(d)},c.getComposerStr=function(a){var d=c.getCreators(a);return b.getComposerStr(d)},c.setComposerStr=function(a,d){var e=c.getCreators(a);b.setComposerStr(e,d),c.setCreators(a,e)},c.hasLyricist=function(a){var d=c.getCreators(a);return b.hasLyricist(d)},c.getLyricistStr=function(a){var d=c.getCreators(a);return b.getLyricistStr(d)},c.setLyricistStr=function(a,d){var e=c.getCreators(a);b.setLyricistStr(e,d),c.setCreators(a,e)},c.getCreators=function(b){return a.getArray(b,"creator")},c.setCreators=function(b,c){a.setArray(b,"creator",c)},c.hasRights=function(b){if(void 0===b.rights)return!1;var d=c.getRights(b);return a.hasStringOrContent(d)},c.getRightsStr=function(b){var d=c.getRights(b);return a.stringOrContent(d)},c.getRights=function(b){return a.getSingle(b,"rights")},c.setRightsStr=function(a,b){d(b)?delete a.rights:a.rights=b};var d=function(a){return""===a.trim()}}.call(this),function(){"use strict";var a=Adagio.Utils.identificationUtils;Adagio.import.metadata.getRightsFromIdentification=function(b,c){a.hasRights(b)&&(c.rights=a.getRightsStr(b))}}.call(this),function(){"use strict";var a=Adagio.Utils.identificationUtils;Adagio.import.metadata.getCreatorsFromIdentification=function(b,c){a.hasComposer(b)&&(c.composer=a.getComposerStr(b)),a.hasLyricist(b)&&(c.lyricist=a.getLyricistStr(b))}}.call(this),function(){"use strict";var a=Adagio.import.metadata.getTitleFromMovementTitle,b=Adagio.import.metadata.getTitleFromCredits,c=Adagio.import.metadata.getSubtitleFromCredits,d=Adagio.import.metadata.getRightsFromCredits,e=Adagio.import.metadata.getCreatorsFromCredits,f=Adagio.import.metadata.getRightsFromIdentification,g=Adagio.import.metadata.getCreatorsFromIdentification;Adagio.import.metadata.extractFields=function(h){var i={};a(h,i);var j=h.getCredits();b(j,i),c(j,i),d(j,i),e(j,i);var k=h.getIdentification();return f(k,i),g(k,i),i}}.call(this),function(){"use strict";var a=Adagio.Utils.creditUtils;Adagio.import.metadata.generateCredits=function(b){var c=[];if(void 0!==b.title){var d=a.createTitle(b.title);c.push(d)}if(void 0!==b.subtitle){var e=a.createSubtitle(b.subtitle);c.push(e)}return c}}.call(this),function(){"use strict";var a=Adagio.import.metadata.generateCredits;Adagio.import.metadata.applyFields=function(b,c){b.removeMovementTitle(),b.cleanCredits();var d=a(c);b.setCredits(d),void 0!==c.rights&&b.setRightsStr(c.rights),void 0!==c.lyricist&&b.setLyricistStr(c.lyricist),void 0!==c.composer&&b.setComposerStr(c.composer)}}.call(this),function(){"use strict";var a=Adagio.import.metadata.extractFields,b=Adagio.import.metadata.applyFields;Adagio.import.metadata.normalizeMetadata=function(c){var d=a(c);b(c,d)}}.call(this),function(){"use strict";var a=Adagio.Utils.attributeUtils,b=Adagio.Utils.attributesUtils,c=Adagio.Utils.keyUtils,d=Adagio.Utils.timeUtils,e=Adagio.Utils.clefUtils,f=Adagio.Utils.transposeUtils,g=Adagio.Utils.staffDetailsUtils,h=Adagio.Utils.rawAttributesUtils={};h.isInitial=function(a){return-1===h.getNoteBeforeIdx(a)},h.getNoteBeforeIdx=function(a){return void 0===a.noteBefore?-1:parseInt(a.noteBefore,10)},h.mergeInto=function(a,h){if(b.hasNbStaves(h)&&!b.hasNbStaves(a)){var j=b.getNbStaves(h);b.setNbStaves(a,j)}if(b.hasDpq(h)&&!b.hasDpq(a)){var k=b.getDpq(h);b.setDpq(a,k)}var l=b.getTime(a),m=b.getTime(h);m=m.map(i,d.copy),Array.prototype.push.apply(l,m),b.setTime(a,l);var n=b.getClef(a),o=b.getClef(h);o=o.map(i,e.copy),Array.prototype.push.apply(n,o),b.setClef(a,n);var p=b.getKey(a),q=b.getKey(h);q=q.map(i,c.copy),Array.prototype.push.apply(p,q),b.setKey(a,p);var r=b.getTranspose(a),s=b.getTranspose(h);s=s.map(i,f.copy),Array.prototype.push.apply(r,s),b.setTranspose(a,r);var t=b.getStaffDetails(a),u=b.getStaffDetails(h);return u=u.map(i,g.copy),Array.prototype.push.apply(t,u),b.setStaffDetails(a,t),a};var i=function(a){return j(a,this)},j=function(b,c){var d=c(b);if(a.hasStaffIdx(b)){var e=a.getStaffIdx(b);a.setStaffIdx(d,e)}return d}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError;(Adagio.import.attributes.AttributesLocation={LEFT:"left",RIGHT:"right",MIDDLE:"middle",AMBIGUOUS:"ambiguous"}).raiseError=function(b){throw new a("BadAttributesLocation","The attributes location ["+b+"] is invalid.")}}.call(this),function(){"use strict";var a=Adagio.import.attributes.AttributesLocation,b=Adagio.Utils.rawAttributesUtils,c=Adagio.Utils.typeUtils,d=Adagio.Utils.noteUtils;Adagio.import.attributes.splitRawsByLocation=function(a,b){var c=e(b);return a.reduce(f,c),c.attributesByLocation};var e=function(b){return{attributesByLocation:c.pairsToMap([{key:a.LEFT,value:[]},{key:a.RIGHT,value:[]},{key:a.MIDDLE,value:[]},{key:a.AMBIGUOUS,value:[]}]),notes:b}},f=function(a,b){var c=a.notes;return a.attributesByLocation[g(b,c)].push(b),a},g=function(c,e){if(b.isInitial(c))return a.LEFT;var f=b.getNoteBeforeIdx(c);if(f===e.length-1)return a.RIGHT;var g=e[f],h=e[f+1];return d.getVoiceIdx(g)===d.getVoiceIdx(h)?a.MIDDLE:a.AMBIGUOUS}}.call(this),function(){"use strict";var a=Adagio.Utils.attributesUtils
;Adagio.import.attributes.isAcceptableRightAttributes=function(b){return!(a.hasTime(b)||a.hasKey(b)||a.hasTranspose(b))}}.call(this),function(){"use strict";var a=Adagio.import.attributes.AttributesLocation,b=Adagio.Utils.noteUtils,c=Adagio.Utils.attributesUtils,d=Adagio.Utils.attributeUtils,e=Adagio.Utils.rawAttributesUtils;Adagio.import.attributes.solveAmbiguous=function(b,c){var d={rawsByLocation:b,notes:c};b[a.AMBIGUOUS].forEach(f,d)};var f=function(a){var b=this.rawsByLocation,c=this.notes;b[g(a,c)].push(a)},g=function(b,e){if(c.hasDivisions(b))return a.LEFT;if(!c.hasClef(b))return a.RIGHT;var f=c.getClef(b);return f.length>=2?a.RIGHT:(f=f[0],d.isGlobal(f)?a.RIGHT:h(b,e))},h=function(f,g){var h=c.getClef(f)[0],i=d.getStaffIdx(h),j=e.getNoteBeforeIdx(f),k=g[j];return i===b.getStaffIdx(k)?a.RIGHT:a.LEFT}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils;Adagio.import.attributes.computeTimePositionByNoteIdx=function(a){var d=b();return a.reduce(c,d),d.timePositionByNoteIdx};var b=function(){return{timePosition:0,timePositionByNoteIdx:{}}},c=function(b,c,d){if(a.hasForward(c)){var e=a.getForwardDuration(c);b.timePosition+=e}if(a.hasBackup(c)){var f=a.getBackupDuration(c);b.timePosition-=f}if(b.timePositionByNoteIdx[d]=b.timePosition,!a.isChord(c)&&a.hasDuration(c)){var g=a.getDuration(c);b.timePosition+=g}return b}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.math,c=Adagio.Utils.noteUtils,d=Adagio.Utils.rawAttributesUtils;Adagio.import.attributes.compareRaws=function(a,c){var g=this.timePositionByNoteIdx,h=this.notes,i=d.getNoteBeforeIdx(a),j=h[i],k=e(j),l=f(g,i),m=l+k,n=d.getNoteBeforeIdx(c),o=h[n],p=e(o),q=f(g,n),r=q+p;return b.cmp(m,r)};var e=function(a){return c.hasDuration(a)?c.getDuration(a):0},f=function(b,c){if(void 0===b[c]){throw new a("BadNoteIdx","The note idx ["+c+"] is invalid.")}return b[c]}}.call(this),function(){"use strict";var a=Adagio.import.attributes.computeTimePositionByNoteIdx,b=Adagio.import.attributes.compareRaws;Adagio.import.attributes.sortMiddleRaws=function(c,d){var e=a(d),f={timePositionByNoteIdx:e,notes:d};c.sort(b.bind(f))}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.rawAttributesUtils,c=Adagio.import.attributes.AttributesLocation,d=Adagio.import.attributes.splitRawsByLocation,e=Adagio.import.attributes.isAcceptableRightAttributes,f=Adagio.import.attributes.solveAmbiguous,g=Adagio.import.attributes.sortMiddleRaws;Adagio.import.attributes.dispatchMeasureAttributes=function(h,i){var j=a.getNotes(i),k=a.getAllRawAttributes(i),l=d(k,j);f(l,j);var m=l[c.LEFT];Array.prototype.unshift.apply(m,h);var n=l[c.MIDDLE];g(n,j);var o=l[c.RIGHT];Array.prototype.unshift.apply(o,n),o=o.filter(e);var p=m.reduce(b.mergeInto,{});return a.clearRawAttributes(i),a.setOwnAttributes(i,p),o}}.call(this),function(){"use strict";var a=Adagio.import.attributes.dispatchMeasureAttributes;Adagio.import.attributes.dispatchMeasuresAttributes=function(b){var c=[];b.reduce(a,c)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.direction.tempoMetronomeDirectionUtils;Adagio.import.common.extractMetronome=function(b){var d=a.getRawDirections(b),e={metronome:null};return d=d.some(c,e),e.metronome};var c=function(a){if(b.isInstanceOf(a)){var c=b.getMetronome(a);return this.metronome=c,!0}return!1}}.call(this),function(){"use strict";var a=Adagio.Utils.soundUtils;Adagio.import.common.extractQpmFromSounds=function(a){var c={tempo:null};return a.some(b,c),c.tempo};var b=function(b){var c=this;if(a.hasTempo(b)){var d=a.getTempo(b);return c.tempo=d,!0}}}.call(this),function(){"use strict";var a=Adagio.import.common.extractQpmFromSounds,b=Adagio.Utils.directionUtils;Adagio.import.common.extractQpmFromDirections=function(c){c=c.filter(b.hasSound);var d=c.map(b.getSound);return a(d)}}.call(this),function(){"use strict";var a=Adagio.import.common.extractQpmFromSounds,b=Adagio.import.common.extractQpmFromDirections,c=Adagio.Utils.measureUtils;Adagio.import.common.extractQpm=function(d){var e=null,f=c.getSounds(d);if(null!==(e=a(f)))return e;var g=c.getRawDirections(d);return e=b(g)}}.call(this),function(){"use strict";var a=Adagio.import.common.extractMetronome,b=Adagio.import.common.extractQpm,c=Adagio.Utils.tempoMetronomeUtils,d=Adagio.Utils.tempoUtils;Adagio.import.common.extractTempo=function(e){var f,g,h,i=a(e),j=b(e);if(null!==i)g=c.getNbDots(i),h=c.getDurationType(i),f=c.getBpm(i);else{if(null===j)return null;g=d.DEFAULT_NB_DOTS,h=d.DEFAULT_DURATION_TYPE,f=d.qpmToBpm(j,h,g)}return null===j&&(j=d.bpmToQpm(f,h,g)),d.createWithNote(j,h,g,f)}}.call(this),function(){"use strict";var a=Adagio.Utils.soundUtils;Adagio.import.common.extractSwingFromSounds=function(a){var c={swing:null};return a.some(b,c),c.swing};var b=function(b){var c=this;if(a.hasSwing(b)){var d=a.getSwing(b);return c.swing=d,!0}}}.call(this),function(){"use strict";var a=Adagio.import.common.extractSwingFromSounds,b=Adagio.Utils.directionUtils;Adagio.import.common.extractSwingFromDirections=function(c){c=c.filter(b.hasSound);var d=c.map(b.getSound);return a(d)}}.call(this),function(){"use strict";var a=Adagio.import.common.extractSwingFromSounds,b=Adagio.import.common.extractSwingFromDirections,c=Adagio.Utils.measureUtils;Adagio.import.common.extractSwing=function(d){var e=null,f=c.getSounds(d);if(null!==(e=a(f)))return e;var g=c.getRawDirections(d);return e=b(g)}}.call(this),function(){"use strict";var a=Adagio.Utils.direction.rehearsalDirectionUtils;Adagio.import.common.extractRehearsalFromDirections=function(b){var c=b.find(a.isInstanceOf);return void 0===c?null:a.getRehearsal(c)}}.call(this),function(){"use strict";var a=Adagio.import.common.extractRehearsalFromDirections,b=Adagio.Utils.measureUtils;Adagio.import.common.extractRehearsal=function(c){var d=b.getRawDirections(c);return a(d)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.swingUtils,c=Adagio.Utils.tempoUtils,d=Adagio.import.common.extractTempo,e=Adagio.import.common.extractSwing,f=Adagio.import.common.extractRehearsal,g=Adagio.Values.SoundType;Adagio.import.common.fillCommonContent=function(a,b){b.forEach(h,a)};var h=function(h,k){var l=this,m=i(l,k),n=j(l,k),o=d(h);null===o&&(o=m);var p=e(h);null===p&&(p=n),l.addMeasure(k,c.copy(o),p);var q=f(h);if(null!==q&&l.setRehearsal(k,q),c.isSame(o,m)&&0!==k||l.setOwnTempo(k,c.copy(o)),b.isSame(p,n)&&0!==k||l.setOwnSwing(k,p),a.hasLeftEnding(h)){var r=a.getLeftEndingNumbers(h);l.setEnding(k,r)}a.hasSegno(h)&&l.setJumpTag(k,g.SEGNO),a.hasCoda(h)&&l.setJumpTag(k,g.CODA),a.hasDalsegno(h)&&l.setJumpCall(k,g.DALSEGNO),a.hasDacapo(h)&&l.setJumpCall(k,g.DACAPO),a.hasFine(h)&&l.setJumpCall(k,g.FINE),a.hasToCoda(h)&&l.setJumpCall(k,g.TOCODA)},i=function(a,b){return 0===b?c.createDefault():a.getTempo(b-1)},j=function(a,c){return 0===c?b.createDefault():a.getSwing(c-1)}}.call(this),function(){"use strict";var a=Adagio.Utils.partContentUtils,b=Adagio.import.common.cleanQpm,c=Adagio.import.common.cleanSwing,d=Adagio.import.common.cleanRehearsal,e=Adagio.import.common.cleanMetronome,f=Adagio.import.common.fillCommonContent;Adagio.import.common.importCommonContent=function(g){var h=g.getPartContent(0),i=a.getMeasures(h),j=g.getCommonContent();f(j,i),g.forEachMeasure(b),g.forEachMeasure(c),g.forEachMeasure(d),g.forEachMeasure(e)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.measureUtils,c=Adagio.Utils.timeUtils;Adagio.import.common.importDisplayTime=function(a,b){var c={previousTime:null,commonContent:b};a.forEach(d,c)};var d=function(d,e){var f;if(b.hasOwnTime(d)){var g=b.getAnyOwnTime(d);this.previousTime=c.copy(g)}else if(null===this.previousTime){var h="Previous time is expected.";throw new a("NoPreviousTime",h)}f=c.copy(this.previousTime),this.commonContent.setDisplayedTime(e,f)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.attributesUtils,c=Adagio.Utils.keyUtils,d=Adagio.Utils.transposeUtils;Adagio.import.attributes.normalizeMeasureKey=function(c){var d=a.getAttributes(c),f=b.getKey(d);f=f.map(e),b.setKey(d,f)};var e=function(a){var b=c.getFifths(a);return b%=d.NB_CHROMATIC,c.setFifths(a,b),a}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadDynamicsStyleError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadDynamicsStyleError",this.stack=e.stack,this.message=e.message,this.style=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"Style "+a+"is invalid."}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Error.value.BadDynamicsStyleError,c=Adagio.Values.DynamicStyle={},d=["ppp","pp","p","mp","mf","f","ff","fff","sfz","rfz","pf","fp"];c.assert=function(a){c.isValid(a)||c.raiseError(a)},c.check=function(a){if(!c.isValid(a))throw new b(a)},c.isValid=function(a){return d.includes(a)},c.raiseError=function(b){throw new a("BadDynamicStyle","The dynamic style ["+b+"] is invalid.")}}.call(this),function(){"use strict";var a=Adagio.Utils.directionUtils,b=Adagio.Utils.directionTypeUtils,c=Adagio.Utils.dynamicDisplayUtils,d=Adagio.Values.DirectionType,e=Adagio.Values.DynamicStyle;Adagio.import.dynamic.isValidDynamic=function(b){return a.getEntries(b).some(f)};var f=function(a){if(b.getType(a)!==d.DYNAMIC)return!1;var f=b.getDynamic(a),g=c.getStyle(f);return e.isValid(g)}}.call(this),function(){"use strict";var a=Adagio.Utils.directionUtils,b=Adagio.Utils.directionTypeUtils,c=Adagio.Utils.dynamicDisplayUtils,d=Adagio.Utils.direction.dynamicDirectionUtils,e=Adagio.Values.DirectionType,f=Adagio.Values.DynamicStyle;Adagio.import.dynamic.extractDynamic=function(b){var c=a.getStaffIdx(b),e=a.getTimePos(b),f=a.getPlacement(b),h=g(b),j=i(b);return d.create(c,f,e,h,j)};var g=function(d){var e=a.getEntries(d),f=e.find(h),g=b.getDynamic(f);return c.getStyle(g)},h=function(a){if(b.getType(a)!==e.DYNAMIC)return!1;var d=b.getDynamic(a),g=c.getStyle(d);return f.isValid(g)},i=function(b){return a.hasSoundDynamic(b)?a.getSoundDynamic(b):null}}.call(this),function(){"use strict";var a=Adagio.import.dynamic.isValidDynamic,b=Adagio.import.dynamic.extractDynamic,c=Adagio.Utils.directionUtils;Adagio.import.dynamic.getDynamicsByStaff=function(a){return i().extract(a)};var d=function(){this.dynamicsByStaff=null},e=d.prototype;e.extract=function(a){this.reset(),a.forEach(this.processDirection,this);var b=this.dynamicsByStaff;return this.dynamicsByStaff=null,b},e.reset=function(){this.dynamicsByStaff={}},e.processDirection=function(c){if(a(c)){var d=b(c);this.addDynamic(d)}},e.addDynamic=function(a){var b=c.getStaffIdx(a),d=this.getStaffDynamics(b),e=c.getTimePos(a);f(d,e),d.push(a)},e.getStaffDynamics=function(a){return void 0===this.dynamicsByStaff[a]&&(this.dynamicsByStaff[a]=[]),this.dynamicsByStaff[a]};var f=function(a,b){g(a,b)&&a.pop()},g=function(a,b){if(0===a.length)return!1;var d=a.length-1,e=a[d];return c.getTimePos(e)===b},h=null,i=function(){return null===h&&(h=new d),h}}.call(this),function(){"use strict";var a=Adagio.Utils.mapUtils,b=Adagio.Utils.math,c=Adagio.Utils.measureUtils;Adagio.import.dynamic.fillMeasureDynamics=function(b,c){a.forEach(c,d,b)};var d=function(a,d){a=b.intPart(a);var e=this;c.setDynamics(e,a,d)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.import.dynamic.getDynamicsByStaff,c=Adagio.import.dynamic.fillMeasureDynamics;Adagio.import.dynamic.extractMeasureDynamics=function(d){var e=a.getRawDirections(d),f=b(e);c(d,f)}}.call(this),function(){"use strict";var a=Adagio.Utils.directionUtils,b=Adagio.Utils.soundUtils;Adagio.import.pizzicato.isValidPizzicato=function(c){if(!a.hasSound(c))return!1;var d=a.getSound(c);return!!b.hasPizzicato(d)&&b.hasValidPizzicato(d)}}.call(this),function(){"use strict";var a=Adagio.Utils.directionUtils,b=Adagio.Utils.soundUtils,c=Adagio.Utils.direction.pizzicatoDirectionUtils;Adagio.import.pizzicato.extractPizzicato=function(b){var e=a.getStaffIdx(b),f=a.getTimePos(b),g=a.getPlacement(b),h=d(b);return c.create(e,g,f,h)};var d=function(c){var d=a.getSound(c);return b.getPizzicato(d)}}.call(this),function(){"use strict";var a=Adagio.import.pizzicato.isValidPizzicato,b=Adagio.import.pizzicato.extractPizzicato,c=Adagio.Utils.directionUtils;Adagio.import.pizzicato.getPizzicatosByStaff=function(a){return i().extract(a)};var d=function(){this.pizzicatosByStaff=null},e=d.prototype;e.extract=function(a){this.reset(),a.forEach(this.processDirection,this);var b=this.pizzicatosByStaff;return this.pizzicatosByStaff=null,b},e.reset=function(){this.pizzicatosByStaff={}},e.processDirection=function(c){if(a(c)){var d=b(c);this.addPizzicato(d)}},e.addPizzicato=function(a){var b=c.getStaffIdx(a),d=this.getStaffPizzicatos(b),e=c.getTimePos(a);f(d,e),d.push(a)},e.getStaffPizzicatos=function(a){return void 0===this.pizzicatosByStaff[a]&&(this.pizzicatosByStaff[a]=[]),this.pizzicatosByStaff[a]};var f=function(a,b){g(a,b)&&a.pop()},g=function(a,b){if(0===a.length)return!1;var d=a.length-1,e=a[d];return c.getTimePos(e)===b},h=null,i=function(){return null===h&&(h=new d),h}}.call(this),function(){"use strict";var a=Adagio.Utils.mapUtils,b=Adagio.Utils.math,c=Adagio.Utils.measureUtils;Adagio.import.pizzicato.fillMeasurePizzicatos=function(b,c){a.forEach(c,d,b)};var d=function(a,d){a=b.intPart(a);var e=this;c.setPizzicatos(e,a,d)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.import.pizzicato.getPizzicatosByStaff,c=Adagio.import.pizzicato.fillMeasurePizzicatos;Adagio.import.pizzicato.extractMeasurePizzicatos=function(d){var e=a.getRawDirections(d),f=b(e);c(d,f)}}.call(this),function(){"use strict";var a=Adagio.Utils.directionUtils;Adagio.import.word.isValidWord=function(b){return!a.hasSound(b)&&a.hasValidWord(b)}}.call(this),function(){"use strict";var a=Adagio.Utils.directionUtils,b=Adagio.Utils.direction.wordDirectionUtils;Adagio.import.word.extractWord=function(c){var d=a.getStaffIdx(c),e=a.getTimePos(c),f=a.getPlacement(c),g=a.getWordText(c);return b.create(d,f,e,g)}}.call(this),function(){"use strict";var a=Adagio.import.word.isValidWord,b=Adagio.import.word.extractWord,c=Adagio.Utils.directionUtils;Adagio.import.word.getWordsByStaff=function(a){return i().extract(a)};var d=function(){this.wordsByStaff=null},e=d.prototype;e.extract=function(a){this.reset(),a.forEach(this.processDirection,this);var b=this.wordsByStaff;return this.wordsByStaff=null,b},e.reset=function(){this.wordsByStaff={}},e.processDirection=function(c){if(a(c)){var d=b(c);this.addWord(d)}},e.addWord=function(a){var b=c.getStaffIdx(a),d=this.getStaffWords(b),e=c.getTimePos(a);f(d,e),d.push(a)},e.getStaffWords=function(a){return void 0===this.wordsByStaff[a]&&(this.wordsByStaff[a]=[]),this.wordsByStaff[a]};var f=function(a,b){g(a,b)&&a.pop()},g=function(a,b){if(0===a.length)return!1;var d=a.length-1,e=a[d];return c.getTimePos(e)===b},h=null,i=function(){return null===h&&(h=new d),h}}.call(this),function(){"use strict";var a=Adagio.Utils.mapUtils,b=Adagio.Utils.math,c=Adagio.Utils.measureUtils;Adagio.import.word.fillMeasureWords=function(b,c){a.forEach(c,d,b)};var d=function(a,d){a=b.intPart(a);var e=this;c.setWords(e,a,d)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.import.word.getWordsByStaff,c=Adagio.import.word.fillMeasureWords;Adagio.import.word.extractMeasureWords=function(d){var e=a.getRawDirections(d),f=b(e);c(d,f)}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.glissandoUtils,c=Adagio.Values.GlissandoType,d=Adagio.import.glissandos.GlissandoBuffer=function(){this.init()},e=d.prototype;e.init=function(){this.leftNotes={}},e.addChord=function(a){this.matchGlissandos(a),this.dropStartedGlissandos(),this.storeStartingGlissandos(a)},e.matchGlissandos=function(b){b=b.filter(a.hasGlissandoStop),b=f(b,c.STOP);var d;for(d in this.leftNotes)void 0!==b[d]&&(delete this.leftNotes[d],delete b[d]);for(d in b){var e=b[d],g=a.getGlissando(e,c.STOP,parseInt(d,10));a.removeGlissando(e,g)}},e.dropStartedGlissandos=function(){for(var b in this.leftNotes){var d=this.leftNotes[b],e=a.getGlissando(d,c.START,parseInt(b,10));a.removeGlissando(d,e)}this.leftNotes={}},e.storeStartingGlissandos=function(b){b=b.filter(a.hasGlissandoStart),this.leftNotes=f(b,c.START)};var f=function(c,d){var e={};return c.forEach(function(c){a.getGlissandosType(c,d).slice().forEach(function(d){var f=b.getNumber(d);void 0!==e[f]?a.removeGlissando(c,d):e[f]=c})}),e};e.endReached=function(){this.dropStartedGlissandos()}}.call(this),function(){"use strict";var a=Adagio.Utils.voiceUtils,b=Adagio.Utils.noteUtils,c=Adagio.import.groupChords,d=Adagio.import.glissandos.GlissandoBuffer;Adagio.import.glissandos.removeOrphanGlissandos=function(a){new e(a).filter()};var e=function(a){this.init(a)},f=e.prototype;f.init=function(a){this.measures=a,this.buffers={}},f.filter=function(){this.measures.forEach(this.filterMeasure,this),this.flushBuffers()},f.filterMeasure=function(b){var c=b.note,d=a.groupVoices(c);for(var e in d){var f=d[e];this.filterNotes(f)}},f.filterNotes=function(a){var b=g(a),d=this.getVoiceBuffer(b);c(a).forEach(d.addChord,d)};var g=function(a){var c=a[0];return b.getVoiceIdx(c)};f.getVoiceBuffer=function(a){return this.hasBuffer(a)||this.createBuffer(a),this.buffers[a]},f.hasBuffer=function(a){return void 0!==this.buffers[a]},f.createBuffer=function(a){this.buffers[a]=new d},f.flushBuffers=function(){for(var a in this.buffers){this.buffers[a].endReached()}}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.noteUtils,c=Adagio.import.hammerOnPullOffs.HammerOnPullOffBuffer=function(){this.init()},d=c.prototype;d.init=function(){this.leftNotes={}},d.addChord=function(a){this.matchHammerOnPullOffs(a),this.dropStartedHammerOnPullOffs(),this.storeStartingHammerOnPullOffs(a)},d.matchHammerOnPullOffs=function(a){a.forEach(e),a=a.filter(b.hasHammerOnPullOffStop),a=f(a);var c;for(c in this.leftNotes)void 0!==a[c]&&(delete this.leftNotes[c],delete a[c]);for(c in a){var d=a[c];b.removeHammerOnPullOffStop(d)}};var e=function(a){if(!b.hasFretData(a))return void b.removeHammerOnPullOff(a);b.hasHammerOnStop(a)&&b.hasPullOffStop(a)&&b.removeHammerOnPullOffStop(a),b.hasHammerOnStart(a)&&b.hasPullOffStart(a)&&b.removeHammerOnPullOffStart(a)},f=function(c){var d={};return c.forEach(function(c){var e=b.getFretData(c),f=e.string+"-";if(b.hasPullOffStop(c))f+="p";else{if(!b.hasHammerOnStop(c))throw new a("Unexpected");f+="h"}void 0!==d[f]?b.removeHammerOnPullOffStop(c):d[f]=c}),d};d.dropStartedHammerOnPullOffs=function(){for(var a in this.leftNotes){var c=this.leftNotes[a];b.removeHammerOnPullOffStart(c)}this.leftNotes={}},d.storeStartingHammerOnPullOffs=function(a){a=a.filter(b.hasHammerOnPullOffStart),this.leftNotes=g(a)};var g=function(c){var d={};return c.forEach(function(c){var e=b.getFretData(c),f=e.string+"-";if(b.hasPullOffStart(c))f+="p";else{if(!b.hasHammerOnStart(c))throw new a("Unexpected");f+="h"}void 0!==d[f]?b.removeHammerOnPullOffStart(c):d[f]=c}),d};d.endReached=function(){this.dropStartedHammerOnPullOffs()}}.call(this),function(){"use strict";var a=Adagio.Utils.voiceUtils,b=Adagio.Utils.noteUtils,c=Adagio.import.groupChords,d=Adagio.import.hammerOnPullOffs.HammerOnPullOffBuffer;Adagio.import.hammerOnPullOffs.removeOrphanHammerOnPullOffs=function(a){new e(a).filter()};var e=function(a){this.init(a)},f=e.prototype;f.init=function(a){this.measures=a,this.buffers={}},f.filter=function(){this.measures.forEach(this.filterMeasure,this),this.flushBuffers()},f.filterMeasure=function(b){var c=b.note,d=a.groupVoices(c);for(var e in d){var f=d[e];this.filterNotes(f)}},f.filterNotes=function(a){var b=g(a),d=this.getVoiceBuffer(b);c(a).forEach(d.addChord,d)};var g=function(a){var c=a[0];return b.getVoiceIdx(c)};f.getVoiceBuffer=function(a){return this.hasBuffer(a)||this.createBuffer(a),this.buffers[a]},f.hasBuffer=function(a){return void 0!==this.buffers[a]},f.createBuffer=function(a){this.buffers[a]=new d},f.flushBuffers=function(){for(var a in this.buffers){this.buffers[a].endReached()}}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.attributesUtils,c=Adagio.Utils.clefUtils,d=Adagio.Utils.staffDetailsUtils;Adagio.import.convertTabsClefs=function(b){var c=a.getOwnAttributes(b),d=a.getAttributes(b);e(c,d),e(d,d)};var e=function(a,d){if(b.getClef(a).some(c.isTab)){for(var e=b.getWrappedClef(a),g=0;g<e.getNbStaves();g++)if(e.hasEntry(g)){var h=e.getEntry(g);h=f(h,g,d),e.setEntry(h,g)}b.setClef(a,e.dumpAttribute())}},f=function(a,e,f){if(c.isTab(a)){var g=b.getWrappedStaffDetailsOrDefault(f),h=g.getEntry(e);a=d.toClef(h)}return a}}.call(this),function(){"use strict";var a=Adagio.import.voiceMapping.updatePartNotes,b=Adagio.import.staffMapping.extractStaffMapping,c=Adagio.Values.values,d=Adagio.Utils.partHeaderUtils;Adagio.import.fixPartsStaffMapping=function(a,b){a.forEach(e,b)};var e=function(c,e){var g=this,h=g[e],i=d.getVoiceMapping(c);a(h,i);var j=d.getStaffMapping(c);f(j)&&(j=b(c,h),d.setStaffMapping(c,j))},f=function(a){return a.some(g)},g=function(a){return a.voices.length>c.MAX_NB_VOICES_PER_STAFF}}.call(this),function(){"use strict";var a=Adagio.Utils.directionUtils,b=Adagio.Utils.pedalDisplayUtils,c=Adagio.Values.PedalType;Adagio.import.pedal.groupPedals=function(a){return a=new d(a).group()};var d=function(a){this.init(a)},e=d.prototype;e.init=function(a){this.wrappedDirections=a,this.ongoingPedals={},this.previousLocation={},this.grouppedDirections=[]},e.group=function(){return this.wrappedDirections.forEach(this.analyzePedal,this),this.grouppedDirections},e.analyzePedal=function(d){var e=d.direction,f=a.getPedal(e),g=b.getType(f);c.assert(g),g===c.CONTINUE||g===c.CHANGE||(g===c.START?this.startPedal(d):g===c.STOP&&this.stopPedal(d))},e.startPedal=function(b){var c=b.direction,d=a.getTimePos(c),e=a.getStaffIdx(c),g=this.previousLocation[e];g&&f(g,b.measureIdx,d)||this.addPedalStart(e,b)};var f=function(a,b,c){return a.measureIdx===b&&a.timePos===c};e.addPedalStart=function(a,b){this.ongoingPedals[a]=b},e.stopPedal=function(b){var c=b.direction,d=a.getStaffIdx(c);if(this.hasPedalStart(d)){var e=this.getWrappedStart(d),f=e.direction;if(g(f,c)&&!h(e,b)){this.addCompletePedal(e,b);var i=a.getTimePos(c);this.previousLocation[d]={timePos:i,measureIdx:e.measureIdx}}this.discardDirection(d)}},e.hasPedalStart=function(a){return void 0!==this.ongoingPedals[a]},e.getWrappedStart=function(a){return this.ongoingPedals[a]},e.discardDirection=function(a){delete this.ongoingPedals[a]};var g=function(b,c){var d=a.getPlacement(b),e=a.getPlacement(c),f=a.getStaffIdx(b),g=a.getStaffIdx(c);return d===e&&f===g},h=function(a,b){return a.timePos===b.timePos&&a.measureIdx===b.measureIdx};e.addCompletePedal=function(a,b){this.grouppedDirections.push(a),this.grouppedDirections.push(b)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.math;Adagio.import.pedal.extractStaffMappingPedals=function(b){var e=b.map(a.getStaffContentMap),f=e.reduce(c,0);return d(b,f)};var c=function(a,c){return Object.keys(c).forEach(function(c){a=b.max2(a,b.toInt(c)+1)},this),a},d=function(a,b){for(var c=[],d=0;d<b;d++){var f=e(a,d);c.push(f)}return c},e=function(b,c){return b.map(function(b){return a.getPedals(b,c)})}}.call(this),function(){"use strict";var a=Adagio.import.pedal.groupPedals,b=Adagio.import.pedal.extractStaffMappingPedals,c=Adagio.Data.direction.wrappMeasuresDirections,d=Adagio.Data.direction.unwrappDirections,e=Adagio.Utils.measureUtils,f=Adagio.Error.InternalError;Adagio.import.pedal.filterPedals=function(e){var f=e.length,h=b(e),i=h.map(c);i=i.map(a),h=i.map(function(a){return d(a,f)}),h.forEach(g,e)};var g=function(a,b){var c=this;if(c.length!==a.length){throw new f("NotSameSize","Array size should be the same.")}c.forEach(function(c,d){var f=a[d];e.setPedals(c,b,f)})}}.call(this),function(){"use strict";var a=Adagio.Utils.directionUtils,b=Adagio.Utils.directionTypeUtils,c=Adagio.Utils.pedalDisplayUtils,d=Adagio.Values.DirectionType,e=Adagio.Values.PedalType;Adagio.import.pedal.isValidPedal=function(b){return a.getEntries(b).some(f)};var f=function(a){if(b.getType(a)!==d.PEDAL)return!1;var f=b.getPedal(a),g=c.getType(f);return e.isValid(g)}}.call(this),function(){"use strict";var a=Adagio.Utils.directionUtils,b=Adagio.Utils.directionTypeUtils,c=Adagio.Utils.pedalDisplayUtils,d=Adagio.Utils.direction.pedalDirectionUtils,e=Adagio.Values.DirectionType,f=Adagio.Values.PedalType;Adagio.import.pedal.extractPedal=function(b){var c=a.getStaffIdx(b),e=a.getTimePos(b),f=a.getPlacement(b),h=g(b);return d.create(c,f,e,h)};var g=function(d){var e=a.getEntries(d),f=e.find(h),g=b.getPedal(f);return c.getType(g)},h=function(a){if(b.getType(a)!==e.PEDAL)return!1;var d=b.getPedal(a),g=c.getType(d);return f.isValid(g)}}.call(this),function(){"use strict";var a=Adagio.import.pedal.isValidPedal,b=Adagio.import.pedal.extractPedal,c=Adagio.Utils.directionUtils;Adagio.import.pedal.getPedalsByStaff=function(a){return i().extract(a)};var d=function(){this.pedalsByStaff=null},e=d.prototype;e.extract=function(a){this.reset(),a.forEach(this.processDirection,this);var b=this.pedalsByStaff;return this.pedalsByStaff=null,b},e.reset=function(){this.pedalsByStaff={}},e.processDirection=function(c){if(a(c)){var d=b(c);this.addPedal(d)}},e.addPedal=function(a){var b=c.getStaffIdx(a),d=this.getStaffPedals(b),e=c.getTimePos(a);f(d,e),d.push(a)},e.getStaffPedals=function(a){return void 0===this.pedalsByStaff[a]&&(this.pedalsByStaff[a]=[]),this.pedalsByStaff[a]};var f=function(a,b){g(a,b)&&a.pop()},g=function(a,b){if(0===a.length)return!1;var d=a.length-1,e=a[d];return c.getTimePos(e)===b},h=null,i=function(){return null===h&&(h=new d),h}}.call(this),function(){"use strict";var a=Adagio.Utils.mapUtils,b=Adagio.Utils.math,c=Adagio.Utils.measureUtils;Adagio.import.pedal.fillMeasurePedals=function(b,c){a.forEach(c,d,b)};var d=function(a,d){a=b.intPart(a);var e=this;c.setPedals(e,a,d)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.import.pedal.getPedalsByStaff,c=Adagio.import.pedal.fillMeasurePedals;Adagio.import.pedal.extractMeasurePedals=function(d){var e=a.getRawDirections(d),f=b(e);c(d,f)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.direction.pedalDirectionUtils,c=Adagio.import.pedal.extractStaffMappingPedals,d=Adagio.Data.direction.wrappMeasuresDirections,e=Adagio.Values.PedalType;Adagio.import.pedal.fillPedals=function(a){c(a).map(d).forEach(function(b){new f(b,a).fillPedals()})};var f=function(a,b){this.init(a,b)},g=f.prototype;g.init=function(a,b){this.wrappedPedals=a,this.measures=b,this.measuresScroller=null},g.fillPedals=function(){for(var a=this.wrappedPedals.length,b=0;b<a-1;b+=2){var c=this.wrappedPedals[b],d=this.wrappedPedals[b+1];this.fillPedal(c,d)}},g.fillPedal=function(a,b){var c=a.measureIdx,d=b.measureIdx;this.addContinues(c,d,a)},g.addContinues=function(a,b,c){for(var d=a;d<b;d++)this.addContinue(d,c)},g.addContinue=function(c,d){var f=b.getStaffIdx(d.direction),g=b.getPlacement(d.direction),h=b.getTimePos(d.direction),i=this.measures[c],j=b.create(f,g,h,e.CONTINUE);a.setRightPedal(i,f,j);var k=this.measures[c+1],l=b.create(f,g,h,e.CONTINUE);a.setLeftPedal(k,f,l)}}.call(this),function(){"use strict";var a=Adagio.Error.import.ImportError,b=Adagio.Utils.math,c=Adagio.Utils.mapUtils,d=Adagio.Utils.noteUtils,e="ERR_CHORD_MISSING_FORMER",f="ERR_GRACE_CLOSED",g=Adagio.import.alignNotes.VoiceIndexer=function(){this.init()},h=g.prototype;h.init=function(){this.entries={},this.hasContentValue=null,this.purifiedContent=null,this.lastTimePos=0},h.getLastTimePos=function(){return this.lastTimePos},h.addEntity=function(b,c){if(c<0){var e="The time position is negative.",f=new a("ERR_TIME_NEGATIVE",e);return void Adagio.warn(f)}d.isGraceNote(b)?d.isChord(b)?this.addChordGrace(b,c):this.addGrace(b,c):d.isChord(b)?this.addChordNote(b,c):this.addNote(b,c),this.lastTimePos=c},h.addNote=function(b,c){var e,f,g=this.getEntry(c);g.note.length>0?(g.locked=!0,f="Cannot have two notes at the same time position.",e=new a("ERR_TIME_COLLISION",f),Adagio.warn(e)):0===d.getDuration(b)?(f="Cannot have note with null duration.",e=new a("ERR_NULL_DURATION",f),Adagio.warn(e)):(d.isRest(b)&&g.graces.length>0&&(f="Cannot have grace note before a rest.",e=new a("ERR_GRACE_REST",f),Adagio.warn(e),g.graces=[]),g.note.push(b))},h.addChordNote=function(b,c){var f=this.getEntry(c);if(!f.locked){if(0===f.note.length){var g="Cannot have a chord note without note before.",h=new a(e,g);return void Adagio.warn(h)}d.removeTimeJumps(b),f.note.push(b)}},h.addGrace=function(b,c){var d=this.getEntry(c);if(d.note.length>0){var e="Cannot add a grace after adding the base note.",g=new a(f,e);Adagio.warn(g)}else d.graces.push([b])},h.addChordGrace=function(b,c){var d,g,h=this.getEntry(c);if(h.note.length>0)d="Cannot add a grace after adding the base note.",g=new a(f,d),Adagio.warn(g);else if(0===h.graces.length)d="Cannot have a chord note without note before.",g=new a(e,d),Adagio.warn(g);else{var i=h.graces.length-1,j=h.graces[i];j.push(b)}},h.getEntry=function(a){return void 0===this.entries[a]&&(this.entries[a]={note:[],graces:[]}),this.entries[a]},h.hasContent=function(){if(null===this.hasContentValue){var a=this.getPurifiedContent();this.hasContentValue=a.length>0}return this.hasContentValue},h.getPurifiedContent=function(){if(null===this.purifiedContent){var a=c.toPairs(this.entries);a=a.filter(i),this.purifiedContent=a.map(j),this.purifiedContent.sort(k)}return this.purifiedContent};var i=function(a){return a.value.note.length>0},j=function(a){var c=b.intPart(a.key),e=a.value;e.timePos=c;var f=d.getDuration(e.note[0]);return e.duration=f,e},k=function(a,b){return a.timePos-b.timePos}}.call(this),function(){"use strict";var a=Adagio.Error.import.ImportError,b=Adagio.Error.InternalError,c=Adagio.import.alignNotes.VoiceIndexer,d=Adagio.Utils.mapUtils,e=Adagio.Utils.noteUtils,f="ERR_CHORD_BACKUP",g="ERR_CHORD_FORWARD";Adagio.import.alignNotes.indexVoicesNotes=function(a){return o().index(a)};var h=function(){},i=h.prototype;i.index=function(a){this.voicesIndexers={},this.timePos=0,this.previousVoiceIdx=null,a.forEach(this.addNote,this);var b=this.voicesIndexers;return this.voicesIndexers=null,b=d.filter(b,j),d.map(b,k)};var j=function(a,b){return b.hasContent()},k=function(a,b){return b.getPurifiedContent()};i.addNote=function(a){var b,c,d=this.timePos;if(e.isChord(a)?(l(a),b=this.getChordVoiceIdx(a),c=this.getVoice(b),d=c.getLastTimePos()):(b=e.getVoiceIdx(a),c=this.getVoice(b),d=m(a,d),this.updateTimePos(d)),this.previousVoiceIdx=b,c.addEntity(a,d),!e.isChord(a)&&!e.isGraceNote(a)){var f=e.getDuration(a);this.updateTimePos(d+f)}},i.getChordVoiceIdx=function(a){if(e.hasVoiceIdx(a)){return e.getVoiceIdx(a)}if(null!==this.previousVoiceIdx)return e.setVoiceIdx(a,this.previousVoiceIdx),this.previousVoiceIdx;throw new b("Unexpected")};var l=function(b){var c,d;e.hasBackup(b)&&(c="a chord note shoud not have backup data.",d=new a(f,c),Adagio.warn(d)),e.hasForward(b)&&(c="a chord note shoud not have forward data.",d=new a(g,c),Adagio.warn(d)),e.removeTimeJumps(b)},m=function(a,b){var c;return e.hasBackup(a)&&(c=e.getBackupDuration(a),b-=c),e.hasForward(a)&&(c=e.getForwardDuration(a),b+=c),b};i.getVoice=function(a){return void 0===this.voicesIndexers[a]&&(this.voicesIndexers[a]=new c),this.voicesIndexers[a]},i.updateTimePos=function(a){this.timePos=a,this.maxTimePos=Math.max(a,this.maxTimePos)};var n=null,o=function(){return null===n&&(n=new h),n}}.call(this),function(){"use strict";Adagio.import.alignNotes.addEmptySpace=function(a){for(var b=0,c=0;c<a.length;){var d=a[c],e=d.timePos-b;if(e>0)d={duration:e,timePos:b,isEmptySpace:!0},a.splice(c,0,d);else if(e<0){a.splice(c,1);continue}b+=d.duration,c++}}}.call(this),function(){"use strict"
;var a=Adagio.Values.DurationType,b=Adagio.Utils.math,c=2,d=Math.pow(2,c),e=a.toQuarterDuration(a.SIXTY_FOURTH);Adagio.import.alignNotes.quantizeQuarterDuration=function(a){if(a<=0)return 0;var c=0,f=b.log(a,2);f=Math.floor(f);var g=Math.pow(2,f);g=Math.max(g,e);for(var h=g/d,i=Math.max(h,e);;){if(g<i)break;if(a<g/2)return c;if(a<g)return a-=g,c+=g;a-=g,c+=g,g/=2}return a<i&&a>=i/2&&(c+=i),c}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.import.alignNotes.quantizeQuarterDuration;Adagio.import.alignNotes.quantizeQuarterNotes=function(a,b){a=a.filter(c),a.forEach(d,b)};var c=function(a){return!a.isEmptySpace},d=function(c){var d=this.valueOf(),e=c.note[0],f=a.getNormalQuarterDuration(e,d);f=b(f),c.quarterDuration=f}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.durationUtils,c=Adagio.import.alignNotes.quantizeQuarterDuration;Adagio.import.alignNotes.quantizeEmptySpaces=function(a,b){a.forEach(d,b)};var d=function(a,b,c){if(e(a,b,c)){var d=this.valueOf();f(a,d)}},e=function(b,c,d){if(!b.isEmptySpace)return!1;if(c>0){var e=d[c-1],f=e.note[0];if(!a.hasNormalTimeModif(f))return!1}if(c<d.length-1){var g=d[c+1],h=g.note[0];if(!a.hasNormalTimeModif(h))return!1}return!0},f=function(a,d){var e=b.divisionsToQuarter(a.duration,d);e=c(e),a.quarterDuration=e}}.call(this),function(){"use strict";Adagio.import.alignNotes.filterQuarterDurations=function(b){return b=b.filter(a)};var a=function(a){return"number"==typeof a.quarterDuration&&a.quarterDuration>0}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.durationUtils,c=Adagio.Utils.timeModifUtils;Adagio.import.alignNotes.computeEntityDpq=function(a){var c=d(a);return b.getQuarterRequiredDpq(a.quarterDuration,c)};var d=function(b){if(b.isEmptySpace)return c.createDefault();var d=b.note[0];return a.getTimeModif(d)}}.call(this),function(){"use strict";var a=Adagio.Utils.math,b=Adagio.import.alignNotes.computeEntityDpq;Adagio.import.alignNotes.computeVoiceDpq=function(c){return c.map(b).reduce(a.lcm,1)}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.durationUtils,c=Adagio.Utils.timeModifUtils;Adagio.import.alignNotes.fillEntityDpq=function(a,c){var f=d(a),g=b.quarterToDivisions(a.quarterDuration,c);g=b.normalToActual(g,f),a.duration=g,a.isEmptySpace||a.note.forEach(e,g)};var d=function(b){if(b.isEmptySpace)return c.createDefault();var d=b.note[0];return a.getTimeModif(d)},e=function(b){var c=this.valueOf();a.setDuration(b,c)}}.call(this),function(){"use strict";var a=Adagio.import.alignNotes.fillEntityDpq;Adagio.import.alignNotes.fillVoiceDpq=function(a,c){a.forEach(b,c)};var b=function(b){var c=this.valueOf();a(b,c)}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils;Adagio.import.alignNotes.voicesToNotes=function(a){var c={timePos:0,jump:0,notes:[]};return a.forEach(b,c),c.notes};var b=function(a){var b=this;b.jump=-b.timePos,b.timePos=0,a.forEach(c,b)},c=function(b){var c=this;if(c.timePos+=b.duration,b.isEmptySpace)c.jump+=b.duration;else{var f=d(b);a.removeTimeJumps(f),c.jump<0?a.addBackup(f,-c.jump):c.jump>0&&a.addForward(f,c.jump),c.jump=0,e(c.notes,b)}},d=function(b){return b.graces.length>0?(a.removeTimeJumps(b.note[0]),b.graces[0][0]):b.note[0]},e=function(a,b){b.graces.forEach(f,a),b.note.forEach(g,a)},f=function(a){var b=this;a.forEach(g,b)},g=function(a){this.push(a)}}.call(this),function(){"use strict";var a=Adagio.Utils.math,b=Adagio.Utils.timeModifUtils;Adagio.import.alignNotes.tuplet.sliceFirstMergeable=function(a){var b=a[0];if(b.locked)return{merged:[b],remaining:a.slice(1)};var d,e=b.actualQuarterDuration,f=a.length;for(d=1;d<f;d++){var g=a[d];if(g.locked)return c(e,b.timeModif)?{merged:a.slice(0,d),remaining:a.slice(d)}:{merged:[b],remaining:a.slice(1)};if(e+=g.actualQuarterDuration,c(e,b.timeModif))return{merged:a.slice(0,d+1),remaining:a.slice(d+1)}}return{merged:[b],remaining:a.slice(1)}};var c=function(c,d){return c/=b.getBinaryCoeff(d),a.isFloatPowerOfTwo(c)}}.call(this),function(){"use strict";var a=Adagio.Utils.math;Adagio.import.alignNotes.tuplet.getTupletNormalQuarterDuration=function(c){return c.notes.map(b).reduce(a.add,0)};var b=function(a){return a.quarterDuration}}.call(this),function(){"use strict";var a=Adagio.Utils.durationUtils,b=Adagio.import.alignNotes.tuplet.getTupletNormalQuarterDuration;Adagio.import.alignNotes.tuplet.updateTupletActualDuration=function(d){var e=b(d),f=a.normalToActual(e,d.timeModif);d.actualQuarterDuration=f,d.isValid=c(d)};var c=function(b){var c=b.actualQuarterDuration;return!!a.isValidQuarter(c)&&!!a.isValidTupletDuration(c,b.timeModif)}}.call(this),function(){"use strict";var a=Adagio.import.alignNotes.tuplet.updateTupletActualDuration,b=Adagio.Utils.timeModifUtils;Adagio.import.alignNotes.tuplet.joinTuplets=function(d){if(1===d.length)return d[0];var e=d.map(c),f=Array.prototype.concat.apply([],e),g=b.copy(d[0].timeModif),h={notes:f,timeModif:g};return a(h),h};var c=function(a){return a.notes}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.timeModifUtils;Adagio.import.alignNotes.tuplet.groupByTimeModif=function(a){return h().group(a)};var c=function(){},d=c.prototype;d.group=function(a){this.entities=[],this.tuplet=null,a.forEach(this.addNote,this),this.hasTuplet()&&this.closeTuplet();var b=this.entities;return this.entities=null,b},d.addNote=function(a){e(a)?this.addNoteToTuplet(a):this.addSingleNote(a)};var e=function(b){return!b.isEmptySpace&&!a.hasNormalTimeModif(b.note[0])};d.addSingleNote=function(a){this.hasTuplet()&&this.closeTuplet(),this.entities.push(a)},d.addNoteToTuplet=function(a){var b=f(a);this.hasTupletDifferent(b)&&this.closeTuplet(),this.getTuplet(a.note[0]).notes.push(a)};var f=function(b){return a.getTimeModif(b.note[0])};d.hasTupletDifferent=function(a){if(this.hasTuplet()){var c=this.getTuplet();return!b.isSame(a,c.timeModif)}return!1},d.getTuplet=function(c){if(!this.hasTuplet()){var d=a.getStaffIdx(c),e=a.getVoiceIdx(c),f=a.getTimeModif(c);f=b.copy(f),this.tuplet={timeModif:f,notes:[],staffIdx:d,voiceIdx:e}}return this.tuplet},d.hasTuplet=function(){return null!==this.tuplet},d.closeTuplet=function(){this.entities.push(this.tuplet),this.tuplet=null};var g=null,h=function(){return null===g&&(g=new c),g}}.call(this),function(){"use strict";var a=Adagio.Utils.timeModifUtils,b=Adagio.import.alignNotes.tuplet.updateTupletActualDuration;Adagio.import.alignNotes.tuplet.splitTupletLeft=function(a){return f().split(a)};var c=function(){},d=c.prototype;d.split=function(a){this.timeModif=a.timeModif,this.voiceIdx=a.voiceIdx,this.staffIdx=a.staffIdx,this.tuplets=[],this.tuplet=null,a.notes.forEach(this.addNote,this),this.hasTuplet()&&this.closeTuplet();var b=this.tuplets;return this.tuplets=null,b},d.addNote=function(a){var b=this.getTuplet();b.notes.push(a),this.updateTuplet(),b.isValid&&this.closeTuplet()},d.updateTuplet=function(){var a=this.getTuplet();b(a)},d.getTuplet=function(){if(!this.hasTuplet()){var b=a.copy(this.timeModif);this.tuplet={voiceIdx:this.voiceIdx,staffIdx:this.staffIdx,timeModif:b,notes:[]}}return this.tuplet},d.hasTuplet=function(){return null!==this.tuplet},d.closeTuplet=function(){this.tuplets.push(this.tuplet),this.tuplet=null};var e=null,f=function(){return null===e&&(e=new c),e}}.call(this),function(){"use strict";var a=Adagio.Utils.timeModifUtils,b=Adagio.import.alignNotes.tuplet.updateTupletActualDuration;Adagio.import.alignNotes.tuplet.splitTupletRight=function(a){return f().split(a)};var c=function(){},d=c.prototype;d.split=function(a){this.timeModif=a.timeModif,this.voiceIdx=a.voiceIdx,this.staffIdx=a.staffIdx,this.tuplets=[],this.tuplet=null;var b=a.notes.slice();b.reverse(),b.forEach(this.addNote,this),this.hasTuplet()&&this.closeTuplet();var c=this.tuplets;return this.tuplets=null,c},d.addNote=function(a){var b=this.getTuplet();b.notes.unshift(a),this.updateTuplet(),b.isValid&&this.closeTuplet()},d.updateTuplet=function(){var a=this.getTuplet();b(a)},d.getTuplet=function(){if(!this.hasTuplet()){var b=a.copy(this.timeModif);this.tuplet={voiceIdx:this.voiceIdx,staffIdx:this.staffIdx,timeModif:b,notes:[]}}return this.tuplet},d.hasTuplet=function(){return null!==this.tuplet},d.closeTuplet=function(){this.tuplets.unshift(this.tuplet),this.tuplet=null};var e=null,f=function(){return null===e&&(e=new c),e}}.call(this),function(){"use strict";var a=Adagio.import.alignNotes.tuplet.splitTupletLeft,b=Adagio.import.alignNotes.tuplet.splitTupletRight;Adagio.import.alignNotes.tuplet.splitTuplet=function(c){var d=a(c),e=d.length,f=d[e-1];if(!f.isValid){f=d.pop();var g=b(f);d.push.apply(d,g)}return d}}.call(this),function(){"use strict";var a=Adagio.Utils.math,b=Adagio.Utils.durationUtils,c=Adagio.Utils.timeModifUtils;Adagio.import.alignNotes.tuplet.computeNormalDurationToAdd=function(d,e){var f=b.normalToActual(d,e),g=c.getBinaryCoeff(e);f/=g;var h=a.log(f,2),i=Math.ceil(h),j=Math.pow(2,i);return j*=g,b.actualToNormal(j,e)-d}}.call(this),function(){"use strict";var a=Adagio.Utils.durationUtils;Adagio.import.alignNotes.tuplet.splitDuration=function(b){for(var c=[];b>0;){var d=a.extractBaseDuration(b);c.push(d),b-=d}return c.reverse(),c}}.call(this),function(){"use strict";var a=Adagio.Utils.timeModifUtils,b=Adagio.Utils.noteUtils,c=Adagio.import.alignNotes.tuplet.getTupletNormalQuarterDuration,d=Adagio.import.alignNotes.tuplet.computeNormalDurationToAdd,e=Adagio.import.alignNotes.tuplet.splitDuration,f=Adagio.import.alignNotes.tuplet.updateTupletActualDuration;Adagio.import.alignNotes.tuplet.fillInvalidTuplet=function(a){var b=c(a),h=d(b,a.timeModif),i=e(h),j=i.map(g,a);a.notes.push.apply(a.notes,j),f(a)};var g=function(c){var d=this,e=a.copy(d.timeModif),f={rest:{}};return b.setVoiceIdx(f,d.voiceIdx),b.setStaffIdx(f,d.staffIdx),b.setTimeModif(f,e),{quarterDuration:c,graces:[],note:[f]}}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils;Adagio.import.alignNotes.tuplet.canLock=function(b){var c=b.notes[0].note[0];if(!a.hasTupletStart(c))return!1;var d=b.notes.length,e=b.notes[d-1].note[0];return!!a.hasTupletStop(e)}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.tupletBoundUtils;Adagio.import.alignNotes.tuplet.lockTuplet=function(a){a.notes.forEach(c),a.locked=!0};var c=function(c,d,e){var f=c.note[0];if(c.note.forEach(a.removeTupletBounds),0===d){var g=b.createNakedStart();a.addTupletBounds(f,[g])}if(d===e.length-1){var h=b.createStop();a.addTupletBounds(f,[h])}}}.call(this),function(){"use strict";var a=Adagio.import.alignNotes.tuplet.canLock,b=Adagio.import.alignNotes.tuplet.lockTuplet;Adagio.import.alignNotes.tuplet.tryLockTuplets=function(c){c=c.filter(a),c.forEach(b)}}.call(this),function(){"use strict";var a=Adagio.import.alignNotes.tuplet.sliceFirstMergeable,b=Adagio.import.alignNotes.tuplet.joinTuplets,c=Adagio.import.alignNotes.tuplet.groupMergeableTuplets=function(d){if(0===d.length)return d;var e=a(d),f=e.merged,g=b(f),h=e.remaining;return h=c(h),h.unshift(g),h}}.call(this),function(){"use strict";var a=Adagio.import.alignNotes.tuplet.tryLockTuplets,b=Adagio.import.alignNotes.tuplet.groupMergeableTuplets;Adagio.import.alignNotes.tuplet.groupTupletsUntilFrozen=function(c){var d,e=c.length;do{a(c),c=b(c);var f=c.length;d=e-f,e=f}while(0!==d);return c}}.call(this),function(){"use strict";var a=Adagio.import.alignNotes.tuplet.lockTuplet;Adagio.import.alignNotes.tuplet.lockAllUnlocked=function(c){c=c.filter(b),c.forEach(a)};var b=function(a){return!a.locked}}.call(this),function(){"use strict";var a=Adagio.import.alignNotes.tuplet.splitTuplet,b=Adagio.import.alignNotes.tuplet.fillInvalidTuplet,c=Adagio.import.alignNotes.tuplet.groupTupletsUntilFrozen,d=Adagio.import.alignNotes.tuplet.lockAllUnlocked;Adagio.import.alignNotes.tuplet.processTuplet=function(b){var f=a(b);return e(f),f=c(f),d(f),f};var e=function(a){a=a.filter(f),a.forEach(b)},f=function(a){return!a.isValid}}.call(this),function(){"use strict";var a=Adagio.import.alignNotes.tuplet.processTuplet;Adagio.import.alignNotes.tuplet.processTuplets=function(a){return a=f().process(a)};var b=function(){},c=b.prototype;c.process=function(a){this.entities=[],a.forEach(this.addEntity,this);var b=this.entities;return this.entities=null,b},c.addEntity=function(a){d(a)?this.addTuplet(a):this.entities.push(a)};var d=function(a){return void 0!==a.timeModif};c.addTuplet=function(b){var c=a(b);this.entities.push.apply(this.entities,c)};var e=null,f=function(){return null===e&&(e=new b),e}}.call(this),function(){"use strict";Adagio.import.alignNotes.tuplet.restoreNotes=function(b){var c=[];return b.forEach(a,c),c};var a=function(a){var c=this;b(a)?c.push.apply(c,a.notes):c.push(a)},b=function(a){return void 0!==a.timeModif}}.call(this),function(){"use strict";var a=Adagio.import.alignNotes.tuplet.groupByTimeModif,b=Adagio.import.alignNotes.tuplet.processTuplets,c=Adagio.import.alignNotes.tuplet.restoreNotes;Adagio.import.alignNotes.tuplet.fixTuplets=function(d){var e=a(d);return e=b(e),d=c(e)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.attributesUtils,c=Adagio.Utils.mapUtils,d=Adagio.Utils.math,e=Adagio.import.alignNotes.indexVoicesNotes,f=Adagio.import.alignNotes.addEmptySpace,g=Adagio.import.alignNotes.quantizeQuarterNotes,h=Adagio.import.alignNotes.quantizeEmptySpaces,i=Adagio.import.alignNotes.filterQuarterDurations,j=Adagio.import.alignNotes.computeVoiceDpq,k=Adagio.import.alignNotes.fillVoiceDpq,l=Adagio.import.alignNotes.voicesToNotes,m=Adagio.import.alignNotes.tuplet.fixTuplets;Adagio.import.alignNotes.alignMeasureNotes=function(g){var h=a.getNotes(g),k=a.getDpq(g),q=e(h);q=c.getValues(q),q.forEach(f),q.forEach(n,k),q.forEach(o,k),q=q.map(i),q=q.map(m);var r=q.map(j),s=r.reduce(d.lcm,k);q.forEach(p,s),h=l(q),a.setNotes(g,h);var t=a.getAttributes(g);b.setDpq(t,s)};var n=function(a){var b=this.valueOf();g(a,b)},o=function(a){var b=this.valueOf();h(a,b)},p=function(a){var b=this.valueOf();k(a,b)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.directionUtils;Adagio.import.removeOutsideDirections=function(b){if(a.hasDirections(b)){var d=a.getRawDirections(b),e=a.getNbDivisions(b);d=d.filter(c,e),a.setDirections(b,d)}};var c=function(a){var c=this.valueOf(),d=b.getTimePos(a);return d>=0&&d<=c}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.noteUtils;Adagio.import.removeOrphanTupletTags=function(b){a.getNotes(b).forEach(c)};var c=function(a){b.hasNormalTimeModif(a)&&b.removeTupletBounds(a)}}.call(this),function(){"use strict";var a=Adagio.Utils.mapUtils,b=Adagio.Utils.measureUtils,c=Adagio.Utils.noteUtils,d=Adagio.Utils.lyricUtils;Adagio.import.filterLyrics=function(a){b.getNotes(a).forEach(e)};var e=function(b){var d=c.getLyricsMap(b);d=a.filter(d,f),c.setLyricsMap(b,d)},f=function(a,b){return d.hasText(b)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.attributesUtils,c=Adagio.Utils.clefUtils,d=Adagio.Utils.staffDetailsUtils,e=5;Adagio.import.fixMeasureNbStaffLines=function(a){f(a)&&i(a)&&k(a)};var f=function(b){var c=a.getAttributes(b);return!g(c)&&!h(c)},g=function(a){var c=b.getStaffDetails(a)[0];return d.hasStaffTuning(c)},h=function(a){var d=b.getClef(a)[0];return c.isPercussion(d)},i=function(c){var d=a.getAttributes(c);return b.getStaffDetails(d).some(j)},j=function(a){return d.getNbStaffLines(a)!==e},k=function(c){var d=a.getAttributes(c),e=b.getStaffDetails(d);e.forEach(l);var f=a.getOwnAttributes(c);b.hasStaffDetails(f)&&(e=b.getStaffDetails(f),e.forEach(l))},l=function(a){d.setNbStaffLines(a,e)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.noteUtils,c=Adagio.Utils.lyricUtils;Adagio.import.lyricLevel.getMeasureLevelsSet=function(b,c){return a.getNotes(c).reduce(d,b),b};var d=function(a,c){return b.getLyrics(c).reduce(e,a),a},e=function(a,b){return a[c.getRawLevel(b)]=!0,a}}.call(this),function(){"use strict";var a=Adagio.import.lyricLevel.getMeasureLevelsSet;Adagio.import.lyricLevel.getMeasuresLevelsSet=function(b){var c={};return b.reduce(a,c),c}}.call(this),function(){"use strict";var a=Adagio.Utils.math;Adagio.import.lyricLevel.isLevelInvalid=function(b){return b=parseInt(b,10),!a.isInteger(b)||b<1}}.call(this),function(){"use strict";var a=Adagio.Utils.setUtils,b=Adagio.import.lyricLevel.isLevelInvalid;Adagio.import.lyricLevel.shouldUpdateLevels=function(c){return a.toList(c).some(b)}}.call(this),function(){"use strict";var a=Adagio.Utils.setUtils,b=Adagio.import.lyricLevel.isLevelInvalid;Adagio.import.lyricLevel.generateUpdateMap=function(d){var e={},f=a.toList(d);f=f.filter(b);var g={updateMap:e,levelsSet:d,level:1};return f.forEach(c,g),e};var c=function(a){var b=this,c=b.level;c=d(c,b.levelsSet),b.updateMap[a]=c.toString(),b.level=c+1},d=function(a,b){for(;void 0!==b[a];)a++;return a}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.lyricUtils;Adagio.import.lyricLevel.updateNoteLevels=function(b,d){a.getLyrics(b).forEach(c,d)};var c=function(a){var c=this,d=b.getRawLevel(a);if(void 0!==c[d]){d=c[d];var e=parseInt(d,10)-1;b.setLevel(a,e)}}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.import.lyricLevel.updateNoteLevels;Adagio.import.lyricLevel.updateMeasureLevels=function(b,d){a.getNotes(b).forEach(c,d)};var c=function(a){b(a,this)}}.call(this),function(){"use strict";var a=Adagio.import.lyricLevel.updateMeasureLevels;Adagio.import.lyricLevel.updateMeasuresLevels=function(a,c){a.forEach(b,c)};var b=function(b){a(b,this)}}.call(this),function(){"use strict";var a=Adagio.import.lyricLevel.getMeasuresLevelsSet,b=Adagio.import.lyricLevel.shouldUpdateLevels,c=Adagio.import.lyricLevel.generateUpdateMap,d=Adagio.import.lyricLevel.updateMeasuresLevels;Adagio.import.lyricLevel.fixMeasuresLyricLevel=function(e){var f=a(e);if(b(f)){var g=c(f);d(e,g)}}}.call(this),function(){"use strict";var a=Adagio.Utils.directionUtils,b=Adagio.Utils.directionTypeUtils,c=Adagio.Utils.octaveShiftDisplayUtils,d=Adagio.Values.DirectionType,e=Adagio.Values.OctaveShiftType;Adagio.import.octaveShift.isValidOctaveShift=function(b){return a.getEntries(b).some(f)};var f=function(a){if(b.getType(a)!==d.OCTAVE_SHIFT)return!1;var f=b.getOctaveShift(a),g=c.getType(f);return e.isValid(g)}}.call(this),function(){"use strict";var a=Adagio.Utils.directionUtils,b=Adagio.Utils.directionTypeUtils,c=Adagio.Utils.octaveShiftDisplayUtils,d=Adagio.Utils.direction.octaveShiftDirectionUtils,e=Adagio.Values.DirectionType,f=Adagio.Values.OctaveShiftType;Adagio.import.octaveShift.extractOctaveShift=function(b){var c=a.getStaffIdx(b),e=a.getTimePos(b),f=a.getPlacement(b),k=g(b),l=h(b),m=i(b),n=j(b);return d.create(c,f,e,k,l,m,n)};var g=function(d){var e=a.getEntries(d),f=e.find(k),g=b.getOctaveShift(f);return c.getType(g)},h=function(d){var e=a.getEntries(d),f=e.find(k),g=b.getOctaveShift(f);return c.getSize(g)},i=function(d){var e=a.getEntries(d),f=e.find(k),g=b.getOctaveShift(f);return c.getLocation(g)},j=function(d){var e=a.getEntries(d),f=e.find(k),g=b.getOctaveShift(f);return c.getNumber(g)},k=function(a){if(b.getType(a)!==e.OCTAVE_SHIFT)return!1;var d=b.getOctaveShift(a),g=c.getType(d);return f.isValid(g)}}.call(this),function(){"use strict";var a=Adagio.import.octaveShift.isValidOctaveShift,b=Adagio.import.octaveShift.extractOctaveShift,c=Adagio.Utils.directionUtils;Adagio.import.octaveShift.getOctaveShiftsByStaff=function(a){return i().extract(a)};var d=function(){this.octaveShiftsByStaff=null},e=d.prototype;e.extract=function(a){this.reset(),a.forEach(this.processDirection,this);var b=this.octaveShiftsByStaff;return this.octaveShiftsByStaff=null,b},e.reset=function(){this.octaveShiftsByStaff={}},e.processDirection=function(c){if(a(c)){var d=b(c);this.addOctaveShift(d)}},e.addOctaveShift=function(a){var b=c.getStaffIdx(a),d=this.getStaffOctaveShifts(b),e=c.getTimePos(a);f(d,e),d.push(a)},e.getStaffOctaveShifts=function(a){return void 0===this.octaveShiftsByStaff[a]&&(this.octaveShiftsByStaff[a]=[]),this.octaveShiftsByStaff[a]};var f=function(a,b){g(a,b)&&a.pop()},g=function(a,b){if(0===a.length)return!1;var d=a.length-1,e=a[d];return c.getTimePos(e)===b},h=null,i=function(){return null===h&&(h=new d),h}}.call(this),function(){"use strict";var a=Adagio.Utils.mapUtils,b=Adagio.Utils.math,c=Adagio.Utils.measureUtils;Adagio.import.octaveShift.fillMeasureOctaveShifts=function(b,c){a.forEach(c,d,b)};var d=function(a,d){a=b.intPart(a);var e=this;c.setOctaveShifts(e,a,d)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.import.octaveShift.getOctaveShiftsByStaff,c=Adagio.import.octaveShift.fillMeasureOctaveShifts;Adagio.import.octaveShift.extractMeasureOctaveShifts=function(d){var e=a.getRawDirections(d),f=b(e);c(d,f)}}.call(this),function(){"use strict";var a=Adagio.Utils.directionUtils,b=Adagio.Utils.octaveShiftDisplayUtils,c=Adagio.Values.OctaveShiftType;Adagio.import.octaveShift.groupOctaveShifts=function(a){return a=new d(a).group()};var d=function(a){this.init(a)},e=d.prototype;e.init=function(a){this.wrappedDirections=a,this.ongoingOctaveShifts={},this.previousLocation={},this.grouppedDirections=[]},e.group=function(){return this.wrappedDirections.forEach(this.analyzeOctaveShift,this),this.grouppedDirections},e.analyzeOctaveShift=function(d){var e=d.direction,f=a.getDisplayOctaveShift(e),g=b.getType(f);c.assert(g),g===c.CONTINUE||(g===c.UP||g===c.DOWN?this.startOctaveShift(d):g===c.STOP&&this.stopOctaveShift(d))},e.startOctaveShift=function(b){var c=b.direction,d=a.getTimePos(c),e=a.getStaffIdx(c),g=this.previousLocation[e];g&&f(g,b.measureIdx,d)||this.addOctaveShiftStart(e,b)};var f=function(a,b,c){return a.measureIdx===b&&a.timePos===c};e.addOctaveShiftStart=function(a,b){this.ongoingOctaveShifts[a]=b},e.stopOctaveShift=function(b){var c=b.direction,d=a.getStaffIdx(c);if(this.hasOctaveShiftStart(d)){var e=this.getWrappedStart(d),f=e.direction;if(g(f,c)&&!h(e,b)){this.addCompleteOctaveShift(e,b);var i=a.getTimePos(c);this.previousLocation[d]={timePos:i,measureIdx:e.measureIdx}}this.discardDirection(d)}},e.hasOctaveShiftStart=function(a){return void 0!==this.ongoingOctaveShifts[a]},e.getWrappedStart=function(a){return this.ongoingOctaveShifts[a]},e.discardDirection=function(a){delete this.ongoingOctaveShifts[a]};var g=function(b,c){var d=a.getPlacement(b),e=a.getPlacement(c),f=a.getStaffIdx(b),g=a.getStaffIdx(c);return d===e&&f===g},h=function(a,b){return a.timePos===b.timePos&&a.measureIdx===b.measureIdx};e.addCompleteOctaveShift=function(a,b){this.grouppedDirections.push(a),this.grouppedDirections.push(b)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.math;Adagio.import.octaveShift.extractStaffMappingOctaveShifts=function(b){var e=b.map(a.getStaffContentMap),f=e.reduce(c,0);return d(b,f)};var c=function(a,c){return Object.keys(c).forEach(function(c){a=b.max2(a,b.toInt(c)+1)},this),a},d=function(a,b){for(var c=[],d=0;d<b;d++){var f=a.map(e,d);c.push(f)}return c},e=function(b){var c=this;return a.getOctaveShifts(b,c)}}.call(this),function(){"use strict";var a=Adagio.import.octaveShift.groupOctaveShifts,b=Adagio.import.octaveShift.extractStaffMappingOctaveShifts,c=Adagio.Data.direction.wrappMeasuresDirections,d=Adagio.Data.direction.unwrappDirections,e=Adagio.Utils.measureUtils,f=Adagio.Error.InternalError;Adagio.import.octaveShift.filterOctaveShifts=function(e){var f=e.length,h=b(e),i=h.map(c);i=i.map(a),h=i.map(function(a){return d(a,f)}),h.forEach(g,e)};var g=function(a,b){var c=this;if(c.length!==a.length){throw new f("NotSameSize","Array size should be the same.")}c.forEach(function(c,d){var f=a[d];e.setOctaveShifts(c,b,f)})}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.direction.octaveShiftDirectionUtils,c=Adagio.import.octaveShift.extractStaffMappingOctaveShifts,d=Adagio.Data.direction.wrappMeasuresDirections,e=Adagio.Values.OctaveShiftLocation;Adagio.import.octaveShift.fillOctaveShifts=function(a){c(a).map(d).forEach(function(b){new f(b,a).fillOctaveShifts()})};var f=function(a,b){this.init(a,b)},g=f.prototype;g.init=function(a,b){this.wrappedOctaveShifts=a,this.measures=b,this.measuresScroller=null},g.fillOctaveShifts=function(){for(var a=this.wrappedOctaveShifts.length,b=0;b<a-1;b+=2){var c=this.wrappedOctaveShifts[b],d=this.wrappedOctaveShifts[b+1];this.fillOctaveShift(c,d)}},g.fillOctaveShift=function(a,b){var c=a.measureIdx,d=b.measureIdx;this.addContinues(c,d,a)},g.addContinues=function(a,b,c){for(var d=a;d<b;d++)this.addContinue(d,c)},g.addContinue=function(c,d){var f=b.getStaffIdx(d.direction),g=b.getPlacement(d.direction),h=b.getTimePos(d.direction),i=b.getType(d.direction),j=b.getSize(d.direction),k=b.getNumber(d.direction),l=this.measures[c],m=b.create(f,g,h,i,j,e.RIGHT,k);a.setRightOctaveShift(l,f,m);var n=this.measures[c+1],o=b.create(f,g,h,i,j,e.LEFT,k);a.setLeftOctaveShift(n,f,o)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.import.octaveShift.extractStaffMappingOctaveShifts,c=Adagio.Utils.directionUtils,d=Adagio.Utils.octaveShiftDisplayUtils,e=Adagio.Utils.direction.octaveShiftDirectionUtils,f=Adagio.Values.DirectionPlacement,g=Adagio.Values.OctaveShiftType;Adagio.import.octaveShift.fixMeasuresOctaveShifts=function(a){b(a).forEach(h)};var h=function(a){a.forEach(i)},i=function(a){a.forEach(function(a){var b=e.getPlacement(a),c=e.getType(a);c===g.STOP||j(b,c)||k(a)})},j=function(a,b){return a===f.ABOVE&&b===g.DOWN||a===f.BELOW&&b===g.UP},k=function(a){var b=e.getPlacement(a),f=l(b),g=c.getDisplayOctaveShift(a);d.setType(g,f)},l=function(b){if(b===f.ABOVE)return g.DOWN;if(b===f.BELOW)return g.UP;throw new a("Unexpected")}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.barlineUtils;Adagio.import.normalizeMeasureBarlines=function(b){a.getBarlines(b).forEach(c)};var c=function(a){var c=b.getStyle(a);b.isSupportedStyle(c)||b.setStyle(a,b.DEFAULT_STYLE)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.noteUtils;Adagio.import.normalizeFullMeasureRest=function(b){a.getNotes(b).forEach(c)};var c=function(a){b.isRest(a)&&b.setFullMeasureRest(a,!1)}}.call(this),function(){"use strict";var a=Adagio.Utils.directionUtils,b=Adagio.Utils.directionTypeUtils,c=Adagio.Utils.tempoChangeUtils,d=Adagio.Values.DirectionType,e=Adagio.Values.TempoChangeType;Adagio.import.tempoChange.isValidTempoChange=function(b){return a.getEntries(b).some(f)};var f=function(a){if(b.getType(a)!==d.TEMPO_CHANGE)return!1;var f=b.getTempoChange(a),g=c.getType(f);return e.isValidInternal(g)}}.call(this),function(){"use strict";var a=Adagio.Utils.directionUtils,b=Adagio.Utils.directionTypeUtils,c=Adagio.Utils.tempoChangeUtils,d=Adagio.Utils.direction.tempoChangeDirectionUtils,e=Adagio.Values.DirectionType,f=Adagio.Values.TempoChangeType;Adagio.import.tempoChange.extractTempoChange=function(b,c){var e=a.getTimePos(b),f=g(b);return d.create(e,c,f)};var g=function(d){var e=a.getEntries(d),f=e.find(h),g=b.getTempoChange(f);return c.getType(g)},h=function(a){if(b.getType(a)!==e.TEMPO_CHANGE)return!1;var d=b.getTempoChange(a),g=c.getType(d);return f.isValidInternal(g)}}.call(this),function(){"use strict";var a=Adagio.import.tempoChange.isValidTempoChange,b=Adagio.import.tempoChange.extractTempoChange,c=Adagio.Utils.directionUtils;Adagio.import.tempoChange.getTempoChanges=function(a,b){return i().extract(a,b)};var d=function(){this.tempoChanges=null},e=d.prototype;e.extract=function(a,b){return this.reset(b),a.forEach(this.processDirection,this),this.tempoChanges},e.reset=function(a){this.dpq=a,this.tempoChanges=[]},e.processDirection=function(c){if(a(c)){var d=b(c,this.dpq);this.addTempoChange(d)}},e.addTempoChange=function(a){var b=c.getTimePos(a);f(this.tempoChanges,b),this.tempoChanges.push(a)};var f=function(a,b){g(a,b)&&a.pop()},g=function(a,b){if(0===a.length)return!1;var d=a.length-1,e=a[d];return c.getTimePos(e)===b},h=null,i=function(){return null===h&&(h=new d),h}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.import.tempoChange.getTempoChanges;Adagio.import.tempoChange.extractMeasureTempoChanges=function(c,d){var e=a.getRawDirections(c),f=a.getDpq(c),g=b(e,f);this.getCommonContent().setTempoChanges(d,g)}}.call(this),function(){"use strict";var a=Adagio.Utils.directionUtils,b=Adagio.Utils.tempoChangeUtils,c=Adagio.Values.TempoChangeType;Adagio.import.tempoChange.groupTempoChanges=function(a){return a=new d(a).group()};var d=function(a){this.init(a)},e=d.prototype;e.init=function(a){this.wrappedDirections=a,this.ongoingTempoChange=null,this.previousLocation=null,this.grouppedDirections=[]},e.group=function(){return this.wrappedDirections.forEach(this.analyzeTempoChange,this),this.grouppedDirections},e.analyzeTempoChange=function(d){var e=d.direction,f=a.getTempoChange(e),g=b.getType(f);c.assert(g),g===c.CONTINUE||(c.isStart(g)?this.startTempoChange(d):g===c.STOP&&this.stopTempoChange(d))},e.startTempoChange=function(b){var c=b.direction,d=a.getTimePos(c);this.previousLocation&&f(this.previousLocation,b.measureIdx,d)||this.addTempoChangeStart(b)};var f=function(a,b,c){return a.measureIdx===b&&a.timePos===c};e.addTempoChangeStart=function(a){this.ongoingTempoChange=a},e.stopTempoChange=function(b){var c=b.direction;if(this.hasTempoChangeStart()){var d=this.getWrappedStart();if(!g(d,b)){this.addCompleteTempoChange(d,b);var e=a.getTimePos(c);this.previousLocation={timePos:e,measureIdx:d.measureIdx}}this.discardDirection()}},e.hasTempoChangeStart=function(){return null!==this.ongoingTempoChange},e.getWrappedStart=function(){return this.ongoingTempoChange},e.discardDirection=function(){this.ongoingTempoChange=null};var g=function(a,b){return a.timePos===b.timePos&&a.measureIdx===b.measureIdx};e.addCompleteTempoChange=function(a,b){this.grouppedDirections.push(a),this.grouppedDirections.push(b)}}.call(this),function(){"use strict";var a=Adagio.import.tempoChange.groupTempoChanges,b=Adagio.Data.direction.wrappMeasuresDirections,c=Adagio.Data.direction.unwrappDirections,d=Adagio.Error.InternalError;Adagio.import.tempoChange.filterTempoChanges=function(d){var g=e(d),h=b(g);h=a(h),g=c(h,d.getNbMeasures()),f(g,d)};var e=function(a){for(var b=[],c=a.getNbMeasures(),d=0;d<c;d++){var e=a.getTempoChanges(d);b.push(e)}return b},f=function(a,b){if(b.getNbMeasures()!==a.length){throw new d("NotSameSize","Array size should be the same.")}a.forEach(function(a,c){b.setTempoChanges(c,a)})}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Values.TempoChangeLocation={LEFT:"left",RIGHT:"right"};b.values=[b.LEFT,b.RIGHT],b.isValid=function(a){return b.values.includes(a)},b.assert=function(a){b.isValid(a)||b.raiseError(a)},b.isLeft=function(a){return a===b.LEFT},b.isRight=function(a){return a===b.RIGHT},b.raiseError=function(b){throw new a("BadTempoChangeLocation","The tempo change location ["+b+"] is invalid.")}}.call(this),function(){"use strict";var a=Adagio.Utils.direction.tempoChangeDirectionUtils,b=Adagio.Data.direction.wrappMeasuresDirections,c=Adagio.Values.TempoChangeType,d=Adagio.Values.TempoChangeLocation;Adagio.import.tempoChange.fillTempoChanges=function(a){var c=e(a),d=b(c);new f(d,a).fillTempoChanges()};var e=function(a){for(var b=[],c=a.getNbMeasures(),d=0;d<c;d++){var e=a.getTempoChanges(d);b.push(e)}return b},f=function(a,b){this.init(a,b)},g=f.prototype;g.init=function(a,b){this.wrappedTempoChanges=a,this.commonContent=b,this.measuresScroller=null},g.fillTempoChanges=function(){for(var a=this.wrappedTempoChanges.length,b=0;b<a-1;b+=2){var c=this.wrappedTempoChanges[b],d=this.wrappedTempoChanges[b+1];this.fillTempoChange(c,d)}},g.fillTempoChange=function(a,b){var c=a.measureIdx,d=b.measureIdx;this.addContinues(c,d)},g.addContinues=function(a,b){for(var c=a;c<b;c++)this.addContinue(c)},g.addContinue=function(b){
var e=null,f=null,g=a.create(e,f,c.CONTINUE,d.RIGHT);this.commonContent.setRightTempoChange(b,g);var h=a.create(e,f,c.CONTINUE,d.LEFT);this.commonContent.setLeftTempoChange(b+1,h)}}.call(this),function(){"use strict";var a=Adagio.Utils.pitchUtils,b=Adagio.Error.InternalError,c=Adagio.edit.common.AlterationTable=function(a){this.init(a)},d=c.prototype;d.init=function(a){this.fifths=a,this.table={}};var e=function(b){return a.getStep(b)+"/"+a.getOctave(b)};d.getAlterValue=function(a){var b=e(a);return this.hasAlterValue(b)||this.initAlterValue(a),this.table[b]},d.hasAlterValue=function(a){return void 0!==this.table[a]},d.initAlterValue=function(b){var c=a.getStep(b),d=a.stepToAlter(c,this.fifths),f=e(b);this.table[f]=d},d.setAlterValue=function(c){var d=e(c);if(!this.hasAlterValue(d)){throw new b("NoEntry","Cannot set a value for key ["+d+"] when there are no prior entry.")}var f=a.getAlter(c);this.table[d]=f}}.call(this),function(){"use strict";var a=Adagio.Utils.clone,b=Adagio.Utils.keyUtils,c=Adagio.Utils.typeUtils,d=Adagio.Utils.noteUtils,e=Adagio.Utils.pitchUtils,f=Adagio.edit.common.AlterationTable,g=Adagio.edit.primitive.SetAccidental,h=Adagio.edit.primitive.RemoveAccidental,i=Adagio.edit.common.initMeasureData,j=Adagio.edit.primitive.UpdateAccidentals=function(a,b,c){this.init(a,b,c)};j.NAME="primitive.UpdateAccidentals";var k=j.prototype;k.initMeasureData=i,k.name=j.NAME,k.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},k.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a=this.measureData.getScoreData(),c=a.getPartVoiceMainStaffIdx(this.opts.partIdx,this.opts.voiceIdx),d=this.measureData.getKey(c),e=b.getFifths(d);this.alterationTable=new f(e);for(var g=this.getVoice(),h=g.getNbNotes(),i=0;i<h;i++)g.isRest(i)||this.updateChordNotes(i)},k.updateChordNotes=function(a){var b=this.getVoice(),d=b.getChord(a);d=c.makeArray(d),d.forEach(function(b){this.updateChordNote(a,b)},this)},k.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},k.updateChordNote=function(a,b){var c=d.getPitch(b),f=this.alterationTable.getAlterValue(c),g=e.getAlter(c);if(this.alterationTable.setAlterValue(c),f===g)d.hasAccidental(b)&&this.removeAccidental(a,c);else{var h=e.alterToAccidental(g);d.hasAccidental(b)&&d.getAccidental(b)===h||this.setAccidental(a,c,h)}},k.removeAccidental=function(b,c){var d={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:b,pitch:a(c)};new h(this.measureData,d,this.cancelStack).perform()},k.setAccidental=function(b,c,d){var e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:b,pitch:a(c),accidental:d};new g(this.measureData,e,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Utils.partHeaderUtils,b=Adagio.Utils.measureUtils,c=Adagio.Utils.noteUtils,d=Adagio.edit.common.MeasureData,e=Adagio.edit.common.CancelStack,f=Adagio.edit.primitive.UpdateAccidentals;Adagio.import.extractMeasureCourtesyAccidentals=function(a,c){var d={hasExtracted:!1};b.getNotes(a).forEach(g,d),d.hasExtracted&&h(a,c)};var g=function(a){if(!c.hasUnpitched(a)&&c.hasAccidentalWithParentheses(a)){c.addCourtesyAccidental(a),c.removeAccidental(a);this.hasExtracted=!0}},h=function(a,b){var c=new d(a),e=i(b);c.scoreData=e,c.forEachVoice(j,c)},i=function(b){return{getPartVoiceMainStaffIdx:function(c,d){return a.getVoiceMainStaffIdx(b,d)},checkPartIdx:function(){},checkMeasureIdx:function(){}}},j=function(a,b){var c=this,d={voiceIdx:b},g=new e;new f(c,d,g).perform()}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.clone;Adagio.import.seekFirstAttributes=function(d){var e=d[0];if(!a.hasOwnAttributes(e)){var f=d.slice(1),g={attributes:null};if(f.some(c,g),null!==g.attributes){var h=b(g.attributes);a.setOwnAttributes(e,h)}}};var c=function(b){var c=this;return!!a.hasOwnAttributes(b)&&(c.attributes=a.getOwnAttributes(b),!0)}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.clone,c=Adagio.Utils.hammerOnPullOffUtils,d=Adagio.Values.TechnicalType,e=Adagio.Values.HammerOnPullOffType,f=Adagio.Values.GlissandoType,g=Adagio.Values.NotationType;Adagio.import.splitNote=function(b,c){var d=a.getDuration(b);d/=c,a.setDuration(b,d);var e=h(b,c);return e.forEach(i),e};var h=function(a,c){for(var d=[],e=0;e<c;e++){var f=b(a);d.push(f)}return d},i=function(a,b,c){var d=0===b,e=b===c.length-1;d||j(a),e||r(a)},j=function(b){a.hasTieStop(b)||a.addTieStop(b),k(b),l(b),o(b)},k=function(b){a.removeAllArticulations(b),a.removeAllOrnaments(b),a.removeAllTechnicals(b,[d.STRING,d.FRET,d.HAMMER_ON,d.PULL_OFF]),a.removeLyrics(b),a.removeNotation(b,g.FERMATA),a.removeArpeggiate(b)},l=function(a){m(a),n(a)},m=function(b){var f;f={hammerOnPullOff:c.create(e.STOP)},a.hasTechnical(b,d.HAMMER_ON,f)&&a.removeTechnical(b,d.HAMMER_ON,f),a.hasTechnical(b,d.PULL_OFF,f)&&a.removeTechnical(b,d.PULL_OFF,f)},n=function(b){a.getGlissandosType(b,f.STOP).forEach(function(c){a.removeGlissando(b,c)})},o=function(a){q(a),p(a)},p=function(b){a.hasSlurStart(b)&&a.removeSlur(b)},q=function(b){if(a.hasTupletStart(b)){var c=a.getTupletStartLevel(b);a.removeTupletStartsWithin(b,c)}},r=function(b){a.hasTieStart(b)||a.addTieStart(b),s(b),v(b)},s=function(a){t(a),u(a)},t=function(b){var f;f={hammerOnPullOff:c.create(e.START)},a.hasTechnical(b,d.HAMMER_ON,f)&&a.removeTechnical(b,d.HAMMER_ON,f),a.hasTechnical(b,d.PULL_OFF,f)&&a.removeTechnical(b,d.PULL_OFF,f)},u=function(b){a.getGlissandosType(b,f.START).forEach(function(c){a.removeGlissando(b,c)})},v=function(a){x(a),w(a)},w=function(b){a.hasSlurStop(b)&&a.removeSlur(b)},x=function(b){if(a.hasTupletStop(b)){var c=a.getTupletStopLevel(b);a.removeTupletStopsWithin(b,c)}}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils;Adagio.import.groupChordsAndRest=function(a){return new b(a).group(a)};var b=function(a){this.init(a)},c=b.prototype;c.init=function(a){this.notes=a,this.tmpChord=null,this.chords=[]},c.group=function(){return this.notes.forEach(this.addNote,this),this.dumpChord(),this.chords},c.addNote=function(b){a.isRest(b)?(this.dumpChord(),this.addRest(b)):a.isChord(b)?this.addToChord(b):(this.dumpChord(),this.addSingleNote(b))},c.dumpChord=function(){null!==this.tmpChord&&(this.chords.push(this.tmpChord),this.tmpChord=null)},c.addRest=function(a){this.addSingleNote(a),this.dumpChord()},c.addToChord=function(a){this.tmpChord.push(a)},c.addSingleNote=function(a){this.tmpChord=[a]}}.call(this),function(){"use strict";var a=Adagio.Error.import.ImportError,b=Adagio.Utils.measureUtils,c=Adagio.Utils.attributesUtils,d=Adagio.Utils.noteUtils,e=Adagio.Utils.durationUtils,f=Adagio.Utils.tupletBoundUtils,g=Adagio.Values.DurationType,h=Adagio.import.groupChordsAndRest,i=Adagio.import.splitNote,j=4,k="BIG_NOTE_TUPLET";Adagio.import.splitMeasureBigDurations=function(a){var c=b.getNotes(a),d=h(c),e=b.getAttributes(a);d=l(d,e),c=Array.prototype.concat.apply([],d),b.setNotes(a,c)};var l=function(a,b){var c=a.map(m,b);return a=Array.prototype.concat.apply([],c)},m=function(b){var f=this,g=c.getDpq(f),h=b[0];if(d.hasTupletStart(h)&&n(h),d.isGraceNote(h))return[b];var i=d.getNormalQuarterDuration(h,g),l=e.extractBaseDuration(i);if(l<=j)return[b];if(!d.hasNormalTimeModif(h)){throw new a(k,"A note inside a tuplet has a duration over the whole note.")}var m=l/j,q=b.map(o,m);return p(q)},n=function(b){var c=d.getTupletStartLevel(b),e=d.getTupletStart(b,c),h=f.getDurationType(e);if(g.toQuarterDuration(h)*f.getNbNormal(e)>1.5*j)throw new a(k,"A note inside a tuplet has a duration over the whole note.")},o=function(a){var b=this.valueOf();return i(a,b)},p=function(a){for(var b=[],c=a[0].length,d=a.length,e=0;e<c;e++){for(var f=[],g=0;g<d;g++){var h=a[g][e];f.push(h)}b.push(f)}return b}}.call(this),function(){"use strict";var a=Adagio.Utils.partContentUtils,b=Adagio.Utils.partHeadersUtils,c=Adagio.import.renameMeasurePercussionClefs,d=Adagio.import.convertCustomKeys,e=Adagio.import.reconstructAttributes,f=Adagio.import.fixPartsContentsOrder,g=Adagio.import.fixHeadersInstrumentsOrder,h=Adagio.import.removeHeadersOrhpanMIDIInstruments,i=Adagio.import.fillMissingInstruments,j=Adagio.import.inferPitchMapping,k=Adagio.import.removeEmptyPitchMappingParts,l=Adagio.import.setPartsIds,m=Adagio.import.setInstrumentsIds,n=Adagio.import.setMeasureIds,o=Adagio.import.removeOrphanHeaders,p=Adagio.import.shiftDirectionsNotesRefs,q=Adagio.import.fillChordVoice,r=Adagio.import.fillDirectionsPlacement,s=Adagio.import.fillSimpleAttributes,t=Adagio.import.inferFirstOwnTimeSignature,u=Adagio.import.attributes.inferTimeSignatures,v=Adagio.import.fixDuplicateAttributes,w=Adagio.import.fillMissingClef,x=Adagio.import.fillMissingKeySignature,y=Adagio.import.fillMeasureVoicesGap,z=Adagio.import.checkMeasureTuplets,A=Adagio.import.fillMeasureTuplets,B=Adagio.import.checkDurations,C=Adagio.import.emptyStaves.fillPartsEmptyStaves,D=Adagio.import.checkTimeIntegrity,E=Adagio.import.fixDuplicateChordHead,F=Adagio.import.removeNullDurations,G=Adagio.import.normalizeChordsDurations,H=Adagio.import.filterSlurs,I=Adagio.import.fillSlurs,J=Adagio.import.fixNoteVoice,K=Adagio.import.fixPartsTransposeDiatonic,L=Adagio.import.inferUnidentifiedUnpitchedParts,M=Adagio.import.convertMeasureTimeModifs,N=Adagio.import.harmony.importMeasureHarmony,O=Adagio.import.harmony.removeOutsideHarmonies,P=Adagio.import.voiceMapping.fillPartsVoiceMapping,Q=Adagio.import.fixPartsNaNStaffIdx,R=Adagio.import.staffMapping.fillPartsStaffMapping,S=Adagio.import.wedge.filterWedges,T=Adagio.import.octaveShift.filterOctaveShifts,U=Adagio.import.wedge.fillWedges,V=Adagio.import.pedal.fillPedals,W=Adagio.import.octaveShift.fillOctaveShifts,X=Adagio.import.ties.removeOrphanTies,Y=Adagio.import.cleanMeasureArpeggios,Z=Adagio.import.beam.removeOrphanBeams,$=Adagio.import.metadata.normalizeMetadata,_=Adagio.import.attributes.dispatchMeasuresAttributes,aa=Adagio.import.common.importCommonContent,ba=Adagio.import.common.importDisplayTime,ca=Adagio.import.attributes.normalizeMeasureKey,da=Adagio.import.dynamic.extractMeasureDynamics,ea=Adagio.import.pizzicato.extractMeasurePizzicatos,fa=Adagio.import.word.extractMeasureWords,ga=Adagio.import.pedal.extractMeasurePedals,ha=Adagio.import.octaveShift.extractMeasureOctaveShifts,ia=Adagio.import.glissandos.removeOrphanGlissandos,ja=Adagio.import.hammerOnPullOffs.removeOrphanHammerOnPullOffs,ka=Adagio.import.convertTabsClefs,la=Adagio.import.fixPartsStaffMapping,ma=Adagio.import.pedal.filterPedals,na=Adagio.import.alignNotes.alignMeasureNotes,oa=Adagio.import.removeOutsideDirections,pa=Adagio.import.removeOrphanTupletTags,qa=Adagio.import.filterLyrics,ra=Adagio.import.fixMeasureNbStaffLines,sa=Adagio.import.lyricLevel.fixMeasuresLyricLevel,ta=Adagio.import.octaveShift.fixMeasuresOctaveShifts,ua=Adagio.import.normalizeMeasureBarlines,va=Adagio.import.normalizeFullMeasureRest,wa=Adagio.import.tempoChange.extractMeasureTempoChanges,xa=Adagio.import.tempoChange.filterTempoChanges,ya=Adagio.import.tempoChange.fillTempoChanges,za=Adagio.import.extractMeasureCourtesyAccidentals,Aa=Adagio.import.seekFirstAttributes,Ba=Adagio.import.splitMeasureBigDurations;Adagio.Data.prototype.import=function(ba){ba=ba||{},this.forEachMeasure(c),this.forEachMeasure(d),$(this);var za=this.getPartsHeaders(),Fa=this.getMeasuresHeaders(),Ga=this.getPartsContents();za=o(za,Ga),this.setPartsHeaders(za),f(za,Ga),g(za),h(za),i(za,Ga),L(za,Ga),j(za,Ga),k(za,Ga),l(za,Ga),m(za,Ga),b.updateMIDIChannels(za),n(Fa,this.getNbMeasures()),aa(this);var Ha=Ga.map(a.getMeasures),Ia=Ha.map(Ca),Ja=this.getPartMeasures(0);Ha.forEach(Aa),Ha.forEach(_),Ha.forEach(s),this.forEachMeasure(v),Ia.forEach(x),Ia.forEach(w),this.forEachMeasure(p),this.forEachMeasure(N),this.forEachMeasure(M),this.forEachMeasure(na),t(Ia),Da(this),u(this),Ha.forEach(e),this.forEachMeasure(ka),this.forEachMeasure(ra),this.forEachMeasure(oa),this.forEachMeasure(O),this.forEachMeasure(q),this.forEachMeasure(J),this.forEachMeasure(r),this.forEachMeasure(y),this.forEachMeasure(E),P(za,Ga),Q(za,Ga),R(za,Ga),la(za,Ga),C(za,Ga),this.forEachMeasure(Y),Ha.forEach(X),Ha.forEach(ia),Ha.forEach(ja),this.forEachMeasure(pa),this.forEachMeasure(z),this.forEachMeasure(A),this.forEachMeasure(Ba),this.forEachMeasure(B),this.forEachMeasure(D),this.forEachMeasure(B),F(this),this.forEachMeasure(da),this.forEachMeasure(ea),this.forEachMeasure(fa),this.forEachMeasure(ga),this.forEachMeasure(ha),Ja.forEach(wa,this),Ha.forEach(ma),Ha.forEach(S),Ha.forEach(T),xa(this.getCommonContent()),Ha.forEach(V),Ha.forEach(U),Ha.forEach(W),ya(this.getCommonContent()),Ha.forEach(ta),Ha.forEach(H),Ha.forEach(I),this.forEachMeasure(Z),this.forEachMeasure(qa),this.forEachMeasure(G),this.forEachMeasure(ca),this.forEachMeasure(ua),this.forEachMeasure(va),Ea(za,Ga),Ha.forEach(sa),K(za,Ga)};var Ca=function(a){return a[0]},Da=function(b){var c=b.getPartContent(0),d=b.getCommonContent(b),e=a.getMeasures(c);ba(e,d)},Ea=function(b,c){c.forEach(function(c,d){var e=b[d];a.getMeasures(c).forEach(function(a){za(a,e)})})}}.call(this),function(){"use strict";var a="There is a lock on the score json. You are not allowed to instanciate two Adagio.Data on the same json. You must call Data.exportData() to get an unlocked json. ",b=Adagio.Error.lock.LockError=function(){var b=Error.call(this,a);return this.name=b.name="LockError",this.stack=b.stack,this.message=b.message,this};b.prototype=Object.create(Error.prototype,{constructor:{value:b}})}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.math,c=Adagio.Data.common.CommonContent=function(){this.init()},d=c.prototype;d.init=function(){this.measures=[],this.scoreData=null},d.getNbMeasures=function(){return this.measures.length},d.addMeasure=function(a,b,c){this.checkInsertionIdx(a),e(b),e(c);var d={tempo:b,swing:c,ownTempo:null,ownSwing:null,ending:null,jumpTag:null,jumpCall:null,nbMultiMeasuresRest:null,tempoChanges:[],leftTempoChange:null,rightTempoChange:null,rehearsal:null};this.measures.splice(a,0,d)};var e=function(b){if(null===b||void 0===b)throw new a("Invalid Value","The common content value is invalid.")};d.removeMeasure=function(a){this.checkMeasureIdx(a),this.measures.splice(a,1)},d.checkInsertionIdx=function(c){var d=this.getNbMeasures();if(!b.isInteger(c)||c<0||c>d){throw new a("BadMeasureInsertionIdx","The insertion measure index ["+c+"] is out of bounds.")}},d.getMeasure=function(a){return this.checkMeasureIdx(a),this.measures[a]},d.checkMeasureIdx=function(c){var d=this.getNbMeasures(c);if(!b.isInteger(c)||c<0||c>=d){throw new a("BadMeasureIdx","The measure index ["+c+"] is out of bounds.")}},d.setScoreData=function(a){this.scoreData=a},d.getScoreData=function(){return this.scoreData}}.call(this),function(){"use strict";var a=Adagio.Data.common.CommonContent.prototype;a.getTempo=function(a){return this.getMeasure(a).tempo},a.setTempo=function(a,b){this.getMeasure(a).tempo=b},a.hasOwnTempo=function(a){return null!==this.getMeasure(a).ownTempo},a.getOwnTempo=function(a){return this.getMeasure(a).ownTempo},a.setOwnTempo=function(a,b){this.getMeasure(a).ownTempo=b},a.removeOwnTempo=function(a){this.getMeasure(a).ownTempo=null},a.getNextOwnTempo=function(a){this.checkMeasureIdx(a),this.hasOwnTempo(a)&&a++;for(var b=this.getNbMeasures();a<b;a++)if(this.hasOwnTempo(a))return a;return null}}.call(this),function(){"use strict";var a=Adagio.Data.common.CommonContent.prototype;a.getSwing=function(a){return this.getMeasure(a).swing},a.setSwing=function(a,b){this.getMeasure(a).swing=b},a.hasSwing=function(a){return null!==this.getMeasure(a).swing},a.hasOwnSwing=function(a){return null!==this.getMeasure(a).ownSwing},a.getOwnSwing=function(a){return this.getMeasure(a).ownSwing},a.setOwnSwing=function(a,b){this.getMeasure(a).ownSwing=b},a.removeOwnSwing=function(a){this.getMeasure(a).ownSwing=null},a.getNextOwnSwing=function(a){this.checkMeasureIdx(a),this.hasOwnSwing(a)&&a++;for(var b=this.getNbMeasures();a<b;a++)if(this.hasOwnSwing(a))return a;return null}}.call(this);(function(){"use strict";var a=Adagio.Data.common.CommonContent.prototype;a.hasEnding=function(a){return null!==this.getMeasure(a).ending},a.getEnding=function(a){return this.getMeasure(a).ending},a.setEnding=function(a,b){this.getMeasure(a).ending=b},a.removeEnding=function(a){this.getMeasure(a).ending=null}}).call(this),function(){"use strict";var a=Adagio.Data.common.CommonContent.prototype;a.hasDisplayedTime=function(a){return null!==this.getMeasure(a).displayedTime},a.getDisplayedTime=function(a){return this.getMeasure(a).displayedTime},a.setDisplayedTime=function(a,b){this.getMeasure(a).displayedTime=b},a.removeDisplayedTime=function(a){this.getMeasure(a).displayedTime=null}}.call(this),function(){"use strict";var a=Adagio.Data.common.CommonContent.prototype;a.hasJumpTag=function(a){return null!==this.getMeasure(a).jumpTag},a.setJumpTag=function(a,b){this.getMeasure(a).jumpTag=b},a.getJumpTag=function(a){return this.getMeasure(a).jumpTag},a.removeJumpTag=function(a){this.getMeasure(a).jumpTag=null}}.call(this),function(){"use strict";var a=Adagio.Data.common.CommonContent.prototype;a.hasJumpCall=function(a){return null!==this.getMeasure(a).jumpCall},a.setJumpCall=function(a,b){this.getMeasure(a).jumpCall=b},a.getJumpCall=function(a){return this.getMeasure(a).jumpCall},a.removeJumpCall=function(a){this.getMeasure(a).jumpCall=null}}.call(this),function(){"use strict";var a=Adagio.Data.common.CommonContent.prototype;a.hasMultiMeasuresRest=function(a){return null!==this.getMeasure(a).nbMultiMeasuresRest},a.setNbMultiMeasuresRest=function(a,b){this.getMeasure(a).nbMultiMeasuresRest=b},a.getNbMultiMeasuresRest=function(a){return this.getMeasure(a).nbMultiMeasuresRest}}.call(this),function(){"use strict";var a=Adagio.Utils.direction.tempoChangeDirectionUtils,b=Adagio.Data.common.CommonContent.prototype;b.hasTempoChanges=function(a){return this.getMeasure(a).tempoChanges.length>0},b.setTempoChanges=function(a,b){this.getMeasure(a).tempoChanges=b},b.addTempoChange=function(a,b){this.getTempoChanges(a).push(b)},b.removeTempoChange=function(b,c){var d=this.getTempoChanges(b),e=d.findIndex(function(b){return a.isSame(b,c)});-1!==e&&d.splice(e,1)},b.getTempoChanges=function(a){return this.getMeasure(a).tempoChanges},b.getLeftTempoChange=function(a){return this.getMeasure(a).leftTempoChange},b.hasLeftTempoChange=function(a){return null!==this.getMeasure(a).leftTempoChange},b.setLeftTempoChange=function(a,b){this.getMeasure(a).leftTempoChange=b},b.removeLeftTempoChange=function(a){this.getMeasure(a).leftTempoChange=null},b.getRightTempoChange=function(a){return this.getMeasure(a).rightTempoChange},b.hasRightTempoChange=function(a){return null!==this.getMeasure(a).rightTempoChange},b.setRightTempoChange=function(a,b){this.getMeasure(a).rightTempoChange=b},b.removeRightTempoChange=function(a){this.getMeasure(a).rightTempoChange=null}}.call(this),function(){"use strict";var a=Adagio.Utils.rehearsalUtils,b=Adagio.Data.common.CommonContent.prototype;b.hasRehearsalAuto=function(b){if(!this.hasRehearsal(b))return!1;var c=this.getRehearsal(b);return!!a.isAuto(c)},b.hasRehearsal=function(a){return null!==this.getMeasure(a).rehearsal},b.getRehearsal=function(a){return this.getMeasure(a).rehearsal},b.setRehearsal=function(a,b){this.getMeasure(a).rehearsal=b},b.removeRehearsal=function(a){this.getMeasure(a).rehearsal=null}}.call(this),function(){"use strict";var a=Adagio.Utils.lockUtils={};a.hasLock=function(a){return void 0!==a.$adagio&&void 0!==a.$adagio.lock},a.createLock=function(a){void 0===a.$adagio&&(a.$adagio={}),a.$adagio.lock={date:Date.now()}}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Error.client.BadPartIdxError,c=Adagio.Error.client.BadMeasureIdxError,d=Adagio.Error.lock.LockError,e=Adagio.Data.common.CommonContent,f=Adagio.Utils.partContentUtils,g=Adagio.Utils.partHeaderUtils,h=Adagio.Utils.measureHeaderUtils,i=Adagio.Utils.lockUtils,j=Adagio.Utils.math,k=Adagio.Utils.uuidUtils,l=Adagio.Data.prototype;l.init=function(b,c){if(1===arguments.length&&void 0===b)throw new a("score undefined","passing undefined as a score");if(this.partsHeaders=null,this.measuresHeaders=null,this.partsContents=null,this.dataUuid=k.generate(),this.readOnly=!1,this.commonContent=new e,void 0!==b){if(i.hasLock(b))throw new d;i.createLock(b),this.score=b,this.import(c)}else this.score={"score-partwise":{$version:"3.0","part-list":{"score-part":[]},"measure-list":{"score-measure":[]},part:[]}}},l.getScorePartWise=function(){return this.score["score-partwise"]},l.getDataUuid=function(){return this.dataUuid},l.getPartMeasures=function(a){var b=this.getPartContent(a);return f.getMeasures(b)},l.getPartContent=function(a){return this.checkPartIdx(a),this.getPartsContents()[a]},l.checkPartIdx=function(a){var c=this.getNbParts();if(!j.isInteger(a)||a<0||a>=c)throw new b(a)},l.getPartByIdx=function(a){return this.getPartContent(a)},l.hasPartByUuid=function(a){return this.getPartsHeaders().some(function(b){return g.getUuid(b)===a})},l.forEachPart=function(a,b){b=b||null,this.getPartsContents().forEach(a,b)},l.forEachMeasure=function(a){this.forEachPart(function(b){f.getMeasures(b).forEach(a)})},l.forEachFirstMeasure=function(a,b){this.forEachPart(function(c){var d=f.getMeasures(c),e=d[0];a.call(b,e)})},l.getMovementTitle=function(){return this.score["score-partwise"]["movement-title"]},l.hasMovementTitle=function(){return void 0!==this.score["score-partwise"]["movement-title"]},l.removeMovementTitle=function(){delete this.score["score-partwise"]["movement-title"]},l.getMeasure=function(a,b){var c=this.getPartContent(a);return this.checkMeasureIdx(b),f.getMeasure(c,b)},l.checkMeasureIdx=function(a){var b=this.getNbMeasures();if(!j.isInteger(a)||a<0||a>=b)throw new c(a)},l.getMeasures=function(a){var b=this.getPartContent(a);return f.getMeasures(b)},l.setPartsHeaders=function(a){this.partsHeaders=a,this.score["score-partwise"]["part-list"]["score-part"]=a},l.hasPartVoiceIdx=function(a,b){var c=this.getPartHeader(a);return g.hasVoiceIdx(c,b)},l.getPartNbStaves=function(a){var b=this.getPartHeader(a);return g.getStaffMapping(b).length},l.getPartStaffMapping=function(a){var b=this.getPartHeader(a);return g.getStaffMapping(b)},l.getPartStaffNbVoices=function(a,b){var c=this.getPartHeader(a);return g.getStaffNbVoices(c,b)},l.hasPartStaffVoiceAtIdx=function(a,b,c){var d=this.getPartStaffVoicesIndexes(a,b),e=d.length;return!(!j.isInteger(c)||c<0||c>=e)},l.getPartStaffVoiceAtIdx=function(b,c,d){var e=this.getPartStaffVoicesIndexes(b,c),f=e.length;if(!j.isInteger(d)||d<0||d>=f)throw new a("Unexpected","Bad idxInStaff: ["+d+"].");return e[d]},l.voiceIdxToIdxInMainStaff=function(b,c){var d=this.getPartVoiceMainStaffIdx(b,c),e=this.getPartStaffVoicesIndexes(b,d),f=e.indexOf(c);if(f<0)throw new a("Unexpected");return f},l.getPartStaffVoicesIndexes=function(a,b){var c=this.getPartHeader(a);return g.getStaffVoicesIndexes(c,b)},l.getPartVoiceMapping=function(a){var b=this.getPartHeader(a);return g.getVoiceMapping(b)},l.getPartVoiceMainStaffIdx=function(a,b){var c=this.getPartHeader(a);return g.getVoiceMainStaffIdx(c,b)},l.getPartStaffMainVoiceIdx=function(a,b){var c=this.getPartHeader(a);return g.getStaffMainVoiceIdx(c,b)},l.getPartVoicesIndexes=function(a){var b=this.getPartHeader(a);return g.getVoicesIndexes(b)},l.getPartHeader=function(a){return this.checkPartIdx(a),this.getPartsHeaders()[a]},l.getPartUuid=function(a){var b=this.getPartHeader(a);return g.getUuid(b)},l.getPartsHeaders=function(){return null===this.partsHeaders&&(this.partsHeaders=this.score["score-partwise"]["part-list"]["score-part"]),this.partsHeaders},l.getNbParts=function(){return this.getPartsHeaders().length},l.isPartUnpitched=function(a){var b=this.getPartHeader(a);return g.hasUnpitched(b)},l.isPartTab=function(a){var b=this.getPartContent(a);return f.isTab(b)},l.getPartsContents=function(){return null===this.partsContents&&(this.partsContents=this.score["score-partwise"].part),this.partsContents},l.getCommonContent=function(){return this.commonContent},l.getMeasureHeader=function(a){return this.getMeasuresHeaders()[a]},l.getMeasureUuids=function(a,b){for(var c=[],d=a;d<=b;d++){var e=this.getMeasureUuid(d);c.push(e)}return c},l.getMeasureUuid=function(a){var b=this.getMeasureHeader(a);return h.getUuid(b)},l.getNbMeasuresHeaders=function(){return this.getMeasuresHeaders().length},l.getMeasuresHeaders=function(){return null===this.measuresHeaders&&(void 0!==this.score["score-partwise"]["measure-list"]&&void 0!==this.score["score-partwise"]["measure-list"]["score-measure"]?this.measuresHeaders=this.score["score-partwise"]["measure-list"]["score-measure"]:this.initMeasuresHeaders()),this.measuresHeaders},l.initMeasuresHeaders=function(){var a={"score-measure":[]};this.score["score-partwise"]["measure-list"]=a,this.measuresHeaders=a["score-measure"]},l.setMeasuresHeaders=function(a){this.score["score-partwise"]["measure-list"]["score-measure"]=a,this.measuresHeaders=a},l.makeReadOnly=function(){this.readOnly=!0},l.assertWritable=function(){if(this.readOnly)throw new a("Unexpected","Trying to edit a read only score.")}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.partHeaderUtils,c=Adagio.Utils.MIDIInstrumentUtils,d=Adagio.Data.prototype;d.searchUnpitchedInstrumentId=function(d,f){var g=this.getPartHeader(d),h=b.getMIDIInstruments(g),i=h.find(e,f);if(void 0!==i){return c.getId(i)}throw new a("unreachable")},d.hasUnpitchedInstrument=function(a,c){var d=this.getPartHeader(a);return b.getMIDIInstruments(d).some(e,c)};var e=function(a){if(c.hasUnpitched(a)){var b=this.valueOf();return c.getUnpitched(a)===b}return!1};d.hasInstrumentId=function(a,c){var d=this.getPartHeader(a);return b.hasInstrumentId(d,c)},d.searchInstrumentMIDIUnpitched=function(a,c){var d=this.getPartHeader(a);return b.searchInstrumentMIDIUnpitched(d,c)}}.call(this),function(){"use strict";var a=Adagio.Utils.identificationUtils,b=Adagio.Utils.mxlUtils,c=Adagio.Data.prototype;c.hasComposer=function(){var b=this.getIdentification();return a.hasComposer(b)},c.getComposerStr=function(){var b=this.getIdentification();return a.getComposerStr(b)},c.setComposerStr=function(b){var c=this.getIdentification();a.setComposerStr(c,b),this.setIdentification(c)},c.hasLyricist=function(){var b=this.getIdentification();return a.hasLyricist(b)},c.getLyricistStr=function(){var b=this.getIdentification();return a.getLyricistStr(b)},c.setLyricistStr=function(b){var c=this.getIdentification();a.setLyricistStr(c,b),this.setIdentification(c)},c.hasRights=function(){var b=this.getIdentification();return a.hasRights(b)},c.getRightsStr=function(){var b=this.getIdentification();return a.getRightsStr(b)},c.setRightsStr=function(b){var c=this.getIdentification();a.setRightsStr(c,b),this.setIdentification(c)},c.setIdentification=function(a){b.setObject(this.score["score-partwise"],"identification",a)},c.getIdentification=function(){return b.getObject(this.score["score-partwise"],"identification")}}.call(this),function(){"use strict";var a=Adagio.Utils.mxlUtils,b=Adagio.Utils.creditsUtils,c=Adagio.Data.prototype;c.setTitle=function(a){var c=this.getCredits();b.setTitle(c,a),this.setCredits(c)},c.hasTitle=function(){var a=this.getCredits();return b.hasTitle(a)},c.getTitle=function(){var a=this.getCredits();return b.getTitle(a)},c.hasSubtitle=function(){var a=this.getCredits();return b.hasSubtitle(a)},c.setSubtitle=function(a){var c=this.getCredits();b.setSubtitle(c,a),this.setCredits(c)},c.getSubtitle=function(){var a=this.getCredits();return b.getSubtitle(a)},c.cleanCredits=function(){var a=this.getCredits();b.removeLyricist(a),b.removeComposer(a),b.removeRights(a),this.setCredits(a)},c.setCredits=function(a){this.score["score-partwise"].credit=a},c.getCredits=function(){return a.getArray(this.score["score-partwise"],"credit")}}.call(this),function(){"use strict";Adagio.Render=function(a,b,c,d){this.scoreData=a,this.scoreDataCache=b,this.scoreShard=c,this.parts=this.scoreData.getPartsContents(),this.displayOpts=d}}.call(this),function(){"use strict";Adagio.Render.harmony={}}.call(this),function(){"use strict";Adagio.Render.emptyMeasure={}}.call(this),function(){"use strict";Adagio.Render.mergeRests={}}.call(this),function(){"use strict";var a=Adagio.Utils;a.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)},a.FirstLast=function(a){return{first:0,last:a.length-1}};var b=function(a){return a[1].toUpperCase()};a.minusToCamelCase=function(a){return a.replace(/-([a-z])/g,b)},a.merge_options=function(b,c){var d={};return a.copyIn(b,d),a.copyIn(c,d),d},a.copyIn=function(a,b){for(var c in a)void 0!==a[c]&&(b[c]=a[c])}}.call(this),function(){"use strict";Adagio.Utils.svgUtils={},Adagio.Utils.svgUtils.createElement=function(a){var b=Adagio.document.createElementNS("http://www.w3.org/2000/svg",a);return"svg"===a&&(b.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),b.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns","http://www.w3.org/2000/svg")),b}}.call(this),function(){"use strict";function a(a){return c.createElement(a)}function b(b,c){void 0===b&&(b="svg"),this.elem=a(b),void 0!==c&&this.attr("class",c),this.temp=b}var c=Adagio.Utils.svgUtils;b.prototype.attr=function(a,b){if(void 0!==a)return void 0!==b?(this.elem.setAttribute(a,b),this):this.elem.getAttribute(a);throw"not enough argument for function attr()."},b.prototype.rattr=function(a){return this.elem.removeAttribute(a),this},b.prototype.style=function(a,b){if(void 0!==a)return void 0!==b?(this.elem.style[a]=b,this):this.elem.style[a];throw"not enough argument for function attr()."},b.prototype.text=function(a){return this.elem.appendChild(Adagio.document.createTextNode(a)),this},b.prototype.transform=function(a){return this.attr("transform",a)},b.prototype.prepend=function(a){var b=this.elem.firstChild;this.elem.insertBefore(a.elem,b)},b.prototype.append=function(a,c){var d;return d=a instanceof b?a:new b(a,c),this.elem.appendChild(d.elem),d},b.prototype.removeFromParent=function(){this.elem.parentNode.removeChild(this.elem)},b.prototype.insertBefore=function(a,b){this.elem.insertBefore(a.node(),b.node())},b.prototype.on=function(a,b,c){if(void 0!==a)return this.elem.addEventListener(a,b,void 0!==c&&c),this;throw"not enough argument for function on()."},b.prototype.getBBox=function(){var a=this.elem.getBBox();return{width:a.width,height:a.height}},b.prototype.node=function(){return this.elem},Adagio.Brush.SvgElement=b}.call(this),function(){"use strict";Adagio.Brush.Elem=Adagio.Brush.SvgElement}.call(this),function(){"use strict";var a=Adagio.Utils,b=Adagio.Brush.Elem,c=Adagio.Drawer.Text=function(a){this.init(a)},d=c.prototype;d.defaultOptions={"font-family":"Georgia, serif","font-style":"normal","stroke-width":"0",text:"New text."},d.init=function(b){this.options=a.merge_options(this.defaultOptions,b),this.fontSize=b["font-size"]||null,this.style={},delete b["font-size"],this.text=null,this.parent=null,this.drawingContext=null,this.x=0,this.y=0},d.setParent=function(a){this.parent=a},d.setDrawingContext=function(a){this.drawingContext=a},d.setFontSize=function(a){this.fontSize=a},d.getFontSize=function(){return this.fontSize},d.setCssClass=function(a){this.text.attr("class",a)},d.render=function(){this.text=new b("text");for(var a in this.options)"text"!==a&&this.text.attr(a,this.options[a]);for(var c in this.style){var d=this.style[c];this.text.style(c,d)}if(this.text.attr("font-size",this.fontSize),this.text.text(this.options.text),this.drawingContext.isTextMetricFromFont()){var e=this.getWidth();this.text.attr("textLength",e),this.text.attr("lengthAdjust","spacing")}},d.draw=function(){this.move(),this.bindToParent()},d.bindToParent=function(){this.parent.append(this.text)},d.getWidth=function(){
var a=this.fontSize,b=this.getFontFamilies(),c=this.options.text,d={};return void 0!==this.style["letter-spacing"]&&(d["letter-spacing"]=this.style["letter-spacing"]),"uppercase"===this.style["text-transform"]&&(c=c.toUpperCase()),void 0!==this.options["font-style"]&&(d["font-style"]=this.options["font-style"]),this.drawingContext.getComputedTextLength(c,b,a,d)},d.getXHeight=function(){var a=this.fontSize,b=this.getFontFamilies();return this.drawingContext.getTextXHeight(b,a)},d.getFontFamilies=function(){var a=this.options["font-family"],b=a.split(",");return b=b.map(e)};var e=function(a){return a.trim()};d.setXPos=function(a){this.x=a},d.setYPos=function(a){this.y=a},d.setPosition=function(a,b){this.x=a,this.y=b},d.move=function(){this.text.attr("transform","translate("+this.x+", "+this.y+")")},d.hide=function(){this.text.removeFromParent()}}.call(this),function(){"use strict";var a=Adagio.Brush.Elem,b=Adagio.Drawer.Brace=function(){this.init()};b.NAME="brace";var c=b.prototype;c.name=b.NAME,c.init=function(){this.drawingContext=null,this.inputHeight=null,this.nominalHeight=null,this.posX=null,this.scalingRatioX=null,this.scalingRatioY=null,this.glyph=null,this.pathText=null,this.parent=null,this.path=null},c.setDrawingContext=function(a){this.drawingContext=a},c.setPosition=function(a){this.posX=a},c.setParent=function(a){this.parent=a},c.setNominalHeight=function(a){this.nominalHeight=a,this.scalingRatioY=null,this.scalingRatioX=null},c.setInputHeight=function(a){a!==this.inputHeight&&(this.inputHeight=a,this.scalingRatioY=null)},c.draw=function(){this.renderIfNeeded(),this.update(),this.bindToParent()},c.renderIfNeeded=function(){this.isRendered()||this.render()},c.isRendered=function(){return null!==this.path},c.render=function(){this.path=new a("path"),this.path.attr("class",this.name)},c.update=function(){if(this.isRendered()){if(null===this.pathText){var a=this.getPathText();this.path.attr("d",a)}null===this.scalingRatioY&&this.canMove()&&this.move()}},c.canMove=function(){return null!==this.posX},c.move=function(){var a=this.posX,b=a,c=this.inputHeight/2,d="translate("+b+", "+c+")",e=this.getScalingRatioY(),f=this.getScalingRatioX(),g="scale("+f+" "+e+")";this.path.attr("transform",d+" "+g)},c.bindToParent=function(){this.parent.append(this.path)},c.getPathText=function(){return null===this.pathText&&(this.pathText=this.getGlyph().render()),this.pathText},c.getWidth=function(){var a=this.getScalingRatioX();return this.getGlyph().getWidth()*a},c.getScalingRatioX=function(){if(null===this.scalingRatioX){var a=this.getGlyphHeight();this.scalingRatioX=this.nominalHeight/a}return this.scalingRatioX},c.getScalingRatioY=function(){if(null===this.scalingRatioY){var a=this.getGlyphHeight();this.scalingRatioY=this.inputHeight/a}return this.scalingRatioY},c.getGlyphHeight=function(){return this.getGlyph().getHeight()},c.getGlyph=function(){return null===this.glyph&&this.createGlyph(),this.glyph},c.createGlyph=function(){this.glyph=this.drawingContext.getGlyph("brace")}}.call(this),function(){"use strict";var a=Adagio.Utils,b=Adagio.Brush.Elem,c=Adagio.Drawer.Line=function(a,b){this.init(a,b),this.line=null},d=c.prototype;d.defaultOptions={stroke_width:null,stroke_dasharray:[]},d.init=function(b,c){this.options=a.merge_options(this.defaultOptions,c),this.parent=b},d.getLine=function(){return this.line},d.render=function(a,c,d,e){return this.isRendered()?this:(this.x1=a,this.y1=c,this.x2=d,this.y2=e,this.line=new b("line").attr("x1",a).attr("y1",c).attr("x2",d).attr("y2",e).attr("stroke-width",this.options.stroke_width).attr("stroke-dasharray",this.options.stroke_dasharray),this)},d.getWidth=function(){return Math.abs(this.x1-this.x2)},d.setY2=function(a){this.y2=a,this.isRendered()&&this.line.attr("y2",a)},d.setY1=function(a){this.y1=a,this.isRendered()&&this.line.attr("y1",a)},d.setX1=function(a){this.x1=a,this.isRendered()&&this.line.attr("x1",a)},d.setX2=function(a){this.x2=a,this.isRendered()&&this.line.attr("x2",a)},d.isRendered=function(){return null!==this.line},d.draw=function(){this.parent.append(this.line)},d.getGroup=function(){return this.getLine()}}.call(this),function(){"use strict";var a=Adagio.Brush.Elem,b=Adagio.Drawer.Line,c=Adagio.Drawer.Bracket=function(){this.init()};c.NAME="bracket";var d=c.prototype;d.name=c.NAME,d.bracketTopGlyphId="bracketTop",d.bracketBottomGlyphId="bracketBottom",d.init=function(){this.drawingContext=null,this.inputHeight=null,this.parent=null,this.group=null,this.line=null,this.topGlyph=null,this.bottomGlyph=null,this.topBracket=null,this.bottomBracket=null,this.posX=null},d.setDrawingContext=function(a){this.drawingContext=a},d.setParent=function(a){this.parent=a},d.setInputHeight=function(a){this.inputHeight=a+2*this.drawingContext.getSpaceSize()},d.setPosition=function(a){this.posX=a},d.getInputHeight=function(){return this.inputHeight},d.getWidth=function(){return 0},d.getBracketTopGlyph=function(){return null===this.topGlyph&&(this.topGlyph=this.drawingContext.getGlyph(this.bracketTopGlyphId)),this.topGlyph},d.getBracketBottomGlyph=function(){return null===this.bottomGlyph&&(this.bottomGlyph=this.drawingContext.getGlyph(this.bracketBottomGlyphId)),this.bottomGlyph},d.draw=function(){this.renderIfNeeded(),this.drawGlyphs(),this.drawLine(),this.update(),this.bindToParent()},d.drawGlyphs=function(){this.drawBracketTop(),this.drawBracketBottom()},d.drawBracketTop=function(){var a=this.getBracketTopGlyph();null===this.topBracket&&(this.topBracket=this.group.append("path"),this.topBracket.attr("d",a.render()),this.topBracket.attr("class",this.bracketTopGlyphId)),this.moveTopBracket()},d.drawBracketBottom=function(){var a=this.getBracketBottomGlyph();null===this.bottomBracket&&(this.bottomBracket=this.group.append("path"),this.bottomBracket.attr("d",a.render()),this.bottomBracket.attr("class",this.bracketBottomGlyphId)),this.moveBottomBracket()},d.moveTopBracket=function(){var a=this.getInputHeight();this.topBracket.attr("transform","translate(0 "+.01*a+")")},d.moveBottomBracket=function(){var a=this.getInputHeight();this.bottomBracket.attr("transform","translate(0 "+.99*a+")")},d.drawLine=function(){this.line.draw()},d.update=function(){this.canMove()&&this.isRendered()&&(this.move(),this.moveTopBracket(),this.moveBottomBracket(),this.updateLine())},d.move=function(){var a=this.posX,b=this.getInputHeight()/2;this.group.attr("transform","translate("+a+" "+-b+")")},d.renderIfNeeded=function(){this.isRendered()||this.render()},d.render=function(){this.group=new a("g"),this.group.attr("class",this.name),this.renderLine()},d.renderLine=function(){var a={stroke_width:this.drawingContext.getBracketStrokeWidth()},c=this.drawingContext.getBracketHorizontalMargin(),d=this.getInputHeight();this.line=new b(this.group,a),this.line.render(c,0,c,d)},d.updateLine=function(){var a=this.getInputHeight();this.line.setY2(a)},d.isRendered=function(){return null!==this.group},d.bindToParent=function(){this.parent.append(this.group)},d.canMove=function(){return null!==this.posX}}.call(this),function(){"use strict";Adagio.Values.ClampType={BRACE:"brace",BRACKET:"bracket"}}.call(this),function(){"use strict";var a=Adagio.Drawer.Text,b=Adagio.Drawer.Brace,c=Adagio.Drawer.Bracket,d=Adagio.Brush.Elem,e=Adagio.Values.ClampType,f=Adagio.Drawer.SystemHeader=function(){this.init()};f.NAME="systemHeader";var g=f.prototype;g.name=f.NAME,g.init=function(){this.drawingContext=null,this.width=null,this.systemPosY=null,this.middleY=null,this.posX=null,this.clampHeight=null,this.nominalHeight=null,this.textString=null,this.clampType=null,this.clamp=null,this.text=null,this.parent=null,this.group=null},g.setDrawingContext=function(a){this.drawingContext=a,null!==this.text&&this.initText(),null!==this.clamp&&this.clamp.setDrawingContext(a)},g.setTextString=function(b){this.textString=b;var c={text:b};this.text=new a(c),this.hasDrawingContext()&&this.initText(),this.width=null},g.initText=function(){this.text.setDrawingContext(this.drawingContext),this.text.setFontSize(this.drawingContext.getPartNameFontSize()),this.text.options["font-family"]=this.drawingContext.getPartNameFontFamily(),this.text.options.fill=this.drawingContext.getPartNameFill();var a=this.drawingContext.getPartNameLetterSpacing();if(null!==a){var b=this.getSpaceSize();this.text.style["letter-spacing"]=a*b}var c=this.drawingContext.getPartNameTextTransform();null!==c&&(this.text.style["text-transform"]=c);var d=this.drawingContext.getPartNameFontWeight();this.text.style["font-weight"]=d},g.setNbStaves=function(a){a>1&&null===this.clamp&&(this.createClamp(),this.width=null)},g.setClampType=function(a){null===this.clamp&&(this.clampType=a)},g.createClamp=function(){this.initClamp(),this.hasDrawingContext()&&this.clamp.setDrawingContext(this.drawingContext),null!==this.nominalHeight&&this.clamp.setNominalHeight(this.nominalHeight),null!==this.clampHeight&&this.clamp.setInputHeight(this.clampHeight)},g.initClamp=function(){switch(this.getClampType()){case e.BRACE:this.clamp=new b;break;case e.BRACKET:this.clamp=new c;break;default:this.clamp=new b}},g.setNominalHeight=function(a){this.nominalHeight!==a&&(this.nominalHeight=a,null!==this.clamp&&this.clamp instanceof b&&(this.clamp.setNominalHeight(a),this.width=null))},g.setBraceHeight=function(a){this.clampHeight=a,null!==this.clamp&&this.clamp.setInputHeight(a)},g.setParent=function(a){this.parent=a},g.setPosX=function(a){this.posX=a},g.setSystemPosY=function(a){this.systemPosY=a},g.setMiddleY=function(a){this.middleY=a},g.format=function(){var a=0;if(null!==this.text){var b=this.text.getXHeight()/2;this.text.setPosition(a,b),a+=this.text.getWidth(),a+=this.getSpaceSize()}null!==this.clamp&&this.clamp.setPosition(a,0)},g.draw=function(){this.renderIfNeeded(),this.format(),this.drawContent(),this.move(),this.bindToParent()},g.renderIfNeeded=function(){this.isRendered()||this.render()},g.isRendered=function(){return null!==this.group},g.render=function(){this.group=new d("g"),this.group.attr("class",this.name),null!==this.text&&(this.text.setParent(this.group),this.text.render(),this.text.setCssClass("part-name")),null!==this.clamp&&(this.clamp.setParent(this.group),this.clamp.render())},g.drawContent=function(){null!==this.text&&this.text.draw(),null!==this.clamp&&this.clamp.draw()},g.move=function(){if(this.isRendered()){var a=this.systemPosY+this.middleY;this.group.attr("transform","translate("+this.posX+", "+a+")")}},g.bindToParent=function(){this.parent.append(this.group)},g.unbind=function(){this.group.removeFromParent()},g.update=function(){null!==this.clamp&&this.clamp.update()},g.getWidth=function(){return null===this.width&&this.calcWidth(),this.width},g.calcWidth=function(){this.width=0,null!==this.text&&(this.width+=this.getSpaceSize()+this.text.getWidth()),null!==this.clamp&&(this.width+=this.getSpaceSize()+this.clamp.getWidth())},g.hasDrawingContext=function(){return null!==this.drawingContext},g.getSpaceSize=function(){return this.drawingContext.getSpaceSize()},g.getClampType=function(){return this.clampType}}.call(this),function(){"use strict";var a=Adagio.Utils.math,b=Adagio.Utils.typeUtils,c=Adagio.Drawer.formatter.VoicesData=function(a,b,c){this.init(a,b,c)},d=c.prototype;d.init=function(a,b,c){this.voicesData=a,this.dpq=b,this.nbDivisions=c,this.alignmentSpace=null,this.totalDivisions=null},d.getDpq=function(){return this.dpq},d.getAlignmentSpace=function(){return null===this.alignmentSpace&&this.calcAlignmentSpace(),this.alignmentSpace},d.calcAlignmentSpace=function(){var b=this.getFirstNotes(),c=b.map(f);this.alignmentSpace=c.reduce(a.max2)},d.getFirstNotes=function(){var a=this.getVoicesData(),c=a.map(e);return c=c.filter(b.isTruthy)};var e=function(a){if(0===a.length)return null;var b=a[0];return 0!==b.timePos?null:b},f=function(a){return a.spaceBefore};d.getNbDivisions=function(){return this.nbDivisions},d.getAnyVoice=function(){return this.voicesData[0]},d.getVoicesData=function(){return this.voicesData}}.call(this),function(){"use strict";var a=Adagio.Values.TickableType={NOTE:"note",HARMONY:"harmony",DYNAMIC:"dynamic",MMR:"multi-measure-rest"};a.isInsideStaff=function(b){return b===a.NOTE||b===a.MMR}}.call(this),function(){"use strict";var a=Adagio.Utils.math,b=Adagio.Values.TickableType;Adagio.Drawer.formatter.calcNotesAttributesOverlap=function(a,b,d,e){var f=new c(a,b,d,e);return f.analyzeMeasures(),f.getOverlap()};var c=function(a,b,c,d){this.init(a,b,c,d)},d=c.prototype;d.init=function(a,b,c,d){this.measuresData=a,this.globalDpq=b,this.notesFormatter=c,this.drawingContext=d,this.spaceAfterNotes=null,this.attributesWidth=0},d.analyzeMeasures=function(){for(var a=this.measuresData.length,b=0;b<a&&!this.canStop();b++)this.analyzeMeasure(b);null===this.spaceAfterNotes&&this.computeGlobalSpaceAfterNotes()},d.canStop=function(){return 0===this.spaceAfterNotes},d.analyzeMeasure=function(a){this.hasAttributes(a)&&(this.gatherSpaceAvailable(a),this.gatherAttributesWidth(a))},d.hasAttributes=function(a){return this.getAttributesWidth(a)>0},d.gatherAttributesWidth=function(a){var b=this.getAttributesWidth(a);this.attributesWidth=Math.max(this.attributesWidth,b)},d.getAttributesWidth=function(a){return this.measuresData[a].rightAttributes},d.computeGlobalSpaceAfterNotes=function(){for(var a=this.measuresData.length,b=0;b<a&&!this.canStop();b++)this.gatherSpaceAvailable(b)},d.gatherSpaceAvailable=function(a){var b=this.getMeasureSpaceAfterNotes(a);null===this.spaceAfterNotes?this.spaceAfterNotes=b:this.spaceAfterNotes=Math.min(this.spaceAfterNotes,b)},d.getMeasureSpaceAfterNotes=function(b){return this.measuresData[b].tickablesContents.filter(e).map(this.getTickablesContentSpaceAfterNotes,this).reduce(a.min2)};var e=function(a){return b.isInsideStaff(a.type)};d.getTickablesContentSpaceAfterNotes=function(a){var b,c=a.entities.length,d=a.entities[c-1],e=this.drawingContext.getMarginSize();if(1===c&&d.isRest)b=this.notesFormatter.getMiddlePos(),b-=d.spaceAfter/2;else{var f=d.timePos*this.globalDpq/a.dpq;b=this.notesFormatter.getInternalPosX(f)}var g=b+d.spaceAfter+e;return this.notesFormatter.getNominalWidth()-g},d.getOverlap=function(){return Math.min(this.spaceAfterNotes,this.attributesWidth)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.mapUtils,c=Adagio.Utils.math,d=Adagio.Values.TickableType;Adagio.Drawer.formatter.getAttributesNotesDistanceByMeasurePos=function(a){return a.map(e).reduce(i,null)};var e=function(a){var b={},c=f(a);for(var d in a.leftAttributesByMeasurePos){var e=a.leftAttributesByMeasurePos[d],g=e+c;b[d]=g}return b},f=function(a){return a.tickablesContents.filter(g).map(h).reduce(c.max2)+a.spaceBeforeNotes},g=function(a){return d.isInsideStaff(a.type)},h=function(a){return a.entities[0].spaceBefore},i=function(c,d){if(null===c)return d;var e={};for(var f in c)if(void 0!==d[f]){var g=c[f],h=d[f];e[f]=Math.max(g,h)}if(b.isEmpty(e)){throw new a("IncompatibleMeasures","space before notes are incompatible when merging horizontal alignment data.")}return e}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Drawer.formatter.MeasureFormatting=function(a,b){this.init(a,b)};b.isSame=function(a,b){var c=a.formatting,d=b.formatting;for(var e in c){if(c[e]!==d[e])return!1}return a.measurePos===b.measurePos&&a.notesFormatter.isSame(b.notesFormatter)};var c=b.prototype;c.init=function(a,b){this.formatting=a,this.notesFormatter=b,this.measurePos=null},c.setWidth=function(a,b){var c=this.getNominalWidth(b);if(a>c){var d=a-c,e=this.getNotesNominalWidth(),f=e+d;this.setNotesWidth(f)}},c.setNotesWidth=function(a){this.getNotesFormatter().setWidth(a)},c.setMeasurePosition=function(a){this.checkMeasurePos(a),this.measurePos=a},c.getNominalWidth=function(a){return this.getRightBarlineNominalX(a)+this.formatting.barlineEndDistance},c.getRightBarlineNominalX=function(a){return this.getRightAttributesNominalX(a)+this.formatting.attributesBarlineDistance},c.getRightAttributesNominalX=function(a){return this.getNotesX(a)+this.getNotesNominalWidth()-this.formatting.notesAttributesOverlap},c.getNotesNominalWidth=function(){return this.getNotesFormatter().getNominalWidth()},c.getWidth=function(a){return this.getRightBarlineX(a)+this.formatting.barlineEndDistance},c.getRightBarlineX=function(a){return this.getRightAttributesX(a)+this.formatting.attributesBarlineDistance},c.getRightAttributesX=function(a){return this.getNotesX(a)+this.getNotesFormatter().getWidth()-this.formatting.notesAttributesOverlap},c.getNotesFormatter=function(){return this.notesFormatter},c.getNotesX=function(a){return this.getAttributesX()+this.getAttributesNotesDistance(a)},c.getAttributesX=function(){return this.formatting.barlineAttributesDistance},c.getAttributesNotesDistance=function(a){return a=this.getMeasurePos(a),this.checkMeasurePos(a),this.formatting.attributesNotesDistanceByMeasurePos[a]},c.getMeasurePos=function(b){if(void 0!==b)return b;if(this.hasMeasurePos())return this.measurePos;throw new a("MissingMeasurePos","There is no measure pos defined.")},c.hasMeasurePos=function(){return null!==this.measurePos},c.checkMeasurePos=function(b){if(void 0===this.formatting.attributesNotesDistanceByMeasurePos[b])throw new a("InvalidMeasurePos","There is no attributes specified for the measure position ["+b+"].")}}.call(this),function(){"use strict";Adagio.Drawer.formatter.globalizeTickablesContent=function(b){var c=this.valueOf(),d=c/b.dpq;return b.entities.map(a,d)};var a=function(a){var b=this.valueOf();return{spaceBefore:a.spaceBefore,spaceAfter:a.spaceAfter,timePos:a.timePos*b,isRest:a.isRest}}}.call(this),function(){"use strict";Adagio.Drawer.formatter.globalizeNbDivisions=function(a){var b=this.valueOf(),c=b/a.dpq;return a.nbDivisions*c}}.call(this),function(){"use strict";var a=Adagio.Utils.math,b=Adagio.Drawer.formatter.VoicesData,c=Adagio.Drawer.formatter.calcNotesAttributesOverlap,d=Adagio.Drawer.formatter.getAttributesNotesDistanceByMeasurePos,e=Adagio.Drawer.formatter.MeasureFormatting,f=Adagio.Drawer.formatter.globalizeTickablesContent,g=Adagio.Drawer.formatter.globalizeNbDivisions,h=Adagio.Drawer.formatter.MeasuresHorizontalFormatter=function(a,b,c,d){this.init(a,b,c,d)},i=h.prototype;i.init=function(a,b,c,d){this.NotesFormatter=c,this.drawingContext=a,this.measuresData=b,this.isMinimal=d,this.notesFormatter=null,this.barlineAttributesDistance=null,this.attributesNotesDistanceByMeasurePos=null,this.notesAttributesOverlap=null,this.attributesBarlineDistance=null,this.barlineEndDistance=null},i.format=function(){this.alignBarlineAttributesDistance(),this.alignAttributesNotesDistanceByMeasurePos(),this.gatherDpq(),this.gatherGlobalTickablesContents(),this.formatNotes(),this.gatherNotesAttributesOverlap(),this.alignAttributesBarlineDistance(),this.alignBarlineEndDistance()},i.alignBarlineAttributesDistance=function(){var b=this.measuresData.map(j);this.barlineAttributesDistance=b.reduce(a.max2)};var j=function(a){return a.leftBarline};i.alignAttributesNotesDistanceByMeasurePos=function(){this.attributesNotesDistanceByMeasurePos=d(this.measuresData)},i.gatherDpq=function(){var b=this.measuresData.map(k);this.dpq=b.reduce(a.lcm)};var k=function(b){return b.tickablesContents.map(l).reduce(a.lcm)},l=function(a){return a.dpq};i.gatherGlobalTickablesContents=function(){var b=this.getAllTickablesContents();this.tickablesContents=b.map(f,this.dpq);var c=b.map(g,this.dpq);this.nbDivisions=c.reduce(a.max2)},i.getAllTickablesContents=function(){var a=this.measuresData.map(m);return Array.prototype.concat.apply([],a)};var m=function(a){return a.tickablesContents};i.formatNotes=function(){var a=new b(this.tickablesContents,this.dpq,this.nbDivisions),c=this.NotesFormatter;this.notesFormatter=new c(a,this.drawingContext,this.isMinimal)},i.gatherNotesAttributesOverlap=function(){this.notesAttributesOverlap=c(this.measuresData,this.dpq,this.notesFormatter,this.drawingContext)},i.alignAttributesBarlineDistance=function(){var b=this.measuresData.map(n);this.attributesBarlineDistance=b.reduce(a.max2)};var n=function(a){return a.rightAttributes};i.alignBarlineEndDistance=function(){var b=this.measuresData.map(o);this.barlineEndDistance=b.reduce(a.max2)};var o=function(a){return a.rightBarline};i.getFormatting=function(){var a={barlineAttributesDistance:this.barlineAttributesDistance,attributesNotesDistanceByMeasurePos:this.attributesNotesDistanceByMeasurePos,notesAttributesOverlap:this.notesAttributesOverlap,attributesBarlineDistance:this.attributesBarlineDistance,barlineEndDistance:this.barlineEndDistance},b=this.notesFormatter;return new e(a,b)},i.getSettedWidth=function(){return this.measuresData.map(p).reduce(a.max2)};var p=function(a){return a.settedWidth}}.call(this),function(){"use strict";var a=Adagio.Drawer.formatter.MeasuresHorizontalFormatter;Adagio.Drawer.formatter.alignEntityHoriz=function(b,c){var d=b.getDrawingContext(),e=d.getMeasureLocationForMeasureIdx(c),f=b.getMeasuresHorizontalData(c),g=d.getNotesFormatter(),h=new a(d,f,g);h.format();var i=h.getSettedWidth(),j=h.getFormatting();j.setMeasurePosition(e),j.setWidth(i),b.setMeasureHorizontalFormatting(j,c)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Brush.Elem,c=Adagio.Drawer.formatter.alignEntityHoriz,d=Adagio.Utils.math,e=Adagio.Drawer.SystemContent=function(){this.init()};e.NAME="systemContent";var f=e.prototype;f.name=e.NAME,f.init=function(){this.drawingContext=null,this.posY=null,this.height=null,this.nominalInnerHeight=null,this.staves=[],this.parent=null,this.group=null},f.addStaff=function(a){this.staves.push(a),this.isRendered()&&this.dispatchGroup(a),this.hasDrawingContext()&&this.dispatchDrawingContext(a)},f.setParent=function(a){this.parent=a},f.setDrawingContext=function(a){this.drawingContext=a,this.staves.forEach(this.dispatchDrawingContext,this)},f.dispatchDrawingContext=function(a){a.setDrawingContext(this.drawingContext)},f.addSystemMeasure=function(a){a.forEach(this.addStaffMeasure,this)},f.addStaffMeasure=function(a,b){this.getStaff(b).addMeasure(a)},f.setPosition=function(a){this.posY=a},f.replaceMeasure=function(a,b){a.forEach(function(a,c){this.getStaff(c).replaceMeasure(a,b)},this)},f.insertMeasure=function(a,b){a.forEach(function(a,c){this.getStaff(c).insertMeasure(a,b)},this)},f.removeMeasure=function(a){this.staves.forEach(function(b){b.eraseMeasure(a)})},f.dispatchInsertionPoint=function(a){this.staves.forEach(function(b){b.dispatchInsertionPoint(a)})},f.draw=function(){this.renderIfNeeded(),this.drawContent(),this.move(),this.bindToParent()},f.renderIfNeeded=function(){this.isRendered()||this.render()},f.isRendered=function(){return null!==this.group},f.render=function(){this.group=new b("g"),this.group.attr("class",this.name),this.staves.forEach(this.dispatchGroup,this)},f.dispatchGroup=function(a){a.setParent(this.group)},f.drawContent=function(){this.staves.forEach(function(a){a.draw()})},f.move=function(){this.isRendered()&&this.group.attr("transform","translate(0, "+this.posY+")")},f.bindToParent=function(){this.parent.append(this.group)},f.getMeasuresHorizontalData=function(a){var b=this.staves.map(function(b){return b.getMeasuresHorizontalData(a)});return Array.prototype.concat.apply([],b)},f.getHorizontalFormatting=function(a){for(var b=this.staves.length,c=0;c<b;c++){var d=this.getStaff(c),e=d.getHorizontalFormatting(a);if(null!==e)return e}return null},f.setMeasureHorizontalFormatting=function(a,b){this.staves.forEach(function(c){c.setMeasureHorizontalFormatting(a,b)})},f.formatMeasureHorizontal=function(a){this.staves.forEach(function(b){b.formatMeasureHorizontal(a)})},f.drawCursor=function(a,b){this.getStaff(a.staffIdx).drawCursor(a,b)},f.drawGraceCursor=function(a,b){this.getStaff(a.staffIdx).drawGraceCursor(a,b)},f.drawTabCursor=function(a,b){var c=b.getNoteCursor();this.getStaff(0).drawCursor(a,c);var d=b.getFretCursor();this.getStaff(1).drawCursor(a,d)},f.drawDynamicCursor=function(a,b){this.getStaff(a.staffIdx).drawDynamicCursor(a,b)},f.drawPizzicatoCursor=function(a,b){this.getStaff(a.staffIdx).drawPizzicatoCursor(a,b)},f.drawHorizontalCursor=function(a,b){this.getStaff(a.staffIdx).drawHorizontalCursor(a,b)},f.drawHorizontalCursorTimePos=function(a,b){this.getStaff(a.staffIdx).drawHorizontalCursorTimePos(a,b)},f.drawHorizontalMeasureWideCursor=function(a,b){this.getStaff(a.staffIdx).drawHorizontalMeasureWideCursor(a,b)},f.drawCrossMeasureNoteCursor=function(a,b){this.getStaff(a.staffIdx).drawCrossMeasureNoteCursor(a,b)},f.updateMeasureNumbers=function(a){this.getFirstStaff().updateMeasureNumbers(a)},f.updateMeasureNumber=function(a){this.getFirstStaff().updateMeasureNumber(a)},f.setMeasureNumberingStart=function(a){this.staves.forEach(function(b){b.setMeasureNumberingStart(a)})},f.autoUpdateHorizontalDisplay=function(){for(var a=this.getNbMeasures(),b=0;b<a;b++)this.autoAlignMeasureHorizontal(b),this.formatMeasureHorizontal(b),this.updateHorizontalDisplay(b);this.moveMeasures()},f.autoAlignMeasureHorizontal=function(a){c(this,a)},f.updateHorizontalDisplay=function(a){this.staves.forEach(function(b){b.updateHorizontalDisplay(a)})},f.moveMeasures=function(a){this.staves.forEach(function(b){b.moveMeasures(a)})},f.autoUpdateVerticalDisplay=function(){for(var a=this.staves.length,b=0;b<a;b++)this.updateStaffVerticalDisplay(b);this.moveStaves(),this.extendInnerBarlines()},f.updateStaffVerticalDisplay=function(a){this.height=null,this.getStaff(a).updateVerticalDisplay()},f.moveStaves=function(a){a=a||0;var b=this.getPositionAfter(a-1);this.staves.slice(a).reduce(g,b)},f.getPositionAfter=function(b){if(-1===b)return 0;if(b>=0){var c=this.getStaff(b);return c.posY+c.getHeight()}throw new a("InvaldStaffIdx","The staffIdx ["+b+"] is invalid.")};var g=function(a,b){return b.setPosition(a),b.move(),a+b.getHeight()+b.getDrawingContext().getSpaceBetweenStaves()};f.updateStaffLines=function(){this.staves.forEach(function(a){a.updateStaffLines()})},f.extendInnerBarlines=function(){for(var a=0;a<this.staves.length-1;a++){var b=this.getStaff(a),c=this.getStaff(a+1);b.connectWith(c)}},f.reloadAllCrossMeasures=function(){for(var a=this.getNbStaves(),b=0;b<a;b++)this.reloadStaffCrossMeasures(b)},f.reloadStaffCrossMeasures=function(a){this.getStaff(a).reloadCrossMeasures()},f.updateCrossMeasuresHorizontalDisplay=function(){this.staves.forEach(function(a){a.updateCrossMeasuresHorizontalDisplay()})},f.bindMeasures=function(){this.staves.forEach(h)};var h=function(a){a.isRendered()&&a.bindMeasures()};f.getNbMeasures=function(){return this.getAnyStaff().getNbMeasures()},f.getNbStaves=function(){return this.staves.length},f.getWidth=function(){return this.getAnyStaff().getWidth()},f.getMiddleY=function(){var a=this.getInnerHeight();return this.getSpaceAboveFirstStaff()+a/2},f.getInnerHeight=function(){var a=this.getSpaceAboveFirstStaff(),b=this.getSpaceBelowLastStaff();return this.getHeight()-a-b},f.getSpaceAboveFirstStaff=function(){return this.getFirstStaff().getSpaceAbove()},f.getFirstStaff=function(){return this.staves[0]},f.getSpaceBelowLastStaff=function(){return this.getLastStaff().getSpaceBelow()},f.getLastStaff=function(){var a=this.getNbStaves(),b=a-1;return this.staves[b]},f.getHeight=function(){return null===this.height&&this.calcHeight(),this.height},f.calcHeight=function(){this.height=this.staves.reduce(i,0)};var i=function(a,b,c){(a+=b.getHeight(),c>0)&&(a+=b.getDrawingContext().getSpaceBetweenStaves());return a};f.getStaffLyricsUpY=function(a,b,c){return this.getStaff(a).getLyricsUpY(b,c)},f.getStaffWordsY=function(a,b,c){return this.getStaff(a).getMeasureWordsY(b,c)},f.getChordsY=function(a){return this.getStaff(0).getChordsY(a)},f.getMeasureWidth=function(a){return this.getStaff(0).getMeasureWidth(a)},f.getNoteXInMeasure=function(a,b,c,d){return this.getStaff(a).getNoteXInMeasure(b,c,d)},f.getStaffHeight=function(a){return this.getStaff(a).getHeight()},f.getSpaceAboveStaff=function(a){return this.getStaff(a).getSpaceAbove()},f.getMeasureNbNotes=function(a,b,c){return this.getStaff(a).getMeasureNbNotes(b,c)},f.resetGeometries=function(){this.staves.forEach(j)};var j=function(a){a.resetGeometries()};f.getMeasureGeometry=function(a){return this.staves.map(function(b){return b.getMeasureGeometry(a)}).filter(k)};var k=function(a){return a.isNew};f.hasDrawingContext=function(){return null!==this.drawingContext},f.getAnyStaff=function(){return this.getStaff(0)},f.getStaff=function(a){return this.checkStaffIdx(a),this.staves[a]},f.checkStaffIdx=function(b){if("number"!=typeof b||b<0||b>=this.staves.length){throw new a("BadStaffIdx","Invalid staffIdx: ["+b+"].")}},f.getPosY=function(){return this.posY},f.getStartMeasureIdx=function(){return this.getAnyStaff().getStartMeasureIdx()},f.getNominalInnerHeight=function(){if(null===this.nominalInnerHeight){var a=this.drawingContext.getSpaceBetweenStaves();a+=this.drawingContext.getMinimalSpaceAboveStaff(),a+=this.drawingContext.getMinimalSpaceBelowStaff();var b=a*(this.getNbStaves()-1),c=this.staves.map(l),e=c.reduce(d.add);this.nominalInnerHeight=e+b}return this.nominalInnerHeight};var l=function(a){return a.getStaffHeight()};f.drawVerticalDebug=function(){this.staves.forEach(function(a){a.drawVerticalDebug()})}}.call(this),function(){"use strict";var a=Adagio.Drawer.SystemHeader,b=Adagio.Drawer.SystemContent,c=Adagio.Drawer.System=function(){this.init()},d=c.prototype;d.init=function(){this.header=new a,this.content=new b,this.idx=null,this.drawingContext=null},d.setHeaderParent=function(a){this.header.setParent(a)},d.setContentParent=function(a){this.content.setParent(a)},d.setDrawingContext=function(a){this.drawingContext=a,this.content.setDrawingContext(a),this.header.setDrawingContext(a)},d.setName=function(a){this.header.setTextString(a)},d.addStaff=function(a){this.content.addStaff(a);var b=this.getNbStaves();this.header.setNbStaves(b)},d.setClampType=function(a){this.header.setClampType(a)},d.setHeaderX=function(a){this.header.setPosX(a)},d.setContentY=function(a){this.content.setPosition(a),this.header.setSystemPosY(a)},d.addSystemMeasure=function(a){this.content.addSystemMeasure(a)},d.setIdx=function(a){this.idx=a},d.replaceMeasure=function(a,b){this.content.replaceMeasure(a,b)},d.insertMeasure=function(a,b){this.content.insertMeasure(a,b)},d.removeMeasure=function(a){this.content.removeMeasure(a)},d.dispatchInsertionPoint=function(a){this.content.dispatchInsertionPoint(a)},d.draw=function(){this.header.draw(),this.content.draw()},d.move=function(){this.header.move(),this.content.move()},d.getMeasuresHorizontalData=function(a){return this.content.getMeasuresHorizontalData(a)},d.getHorizontalFormatting=function(a){return this.content.getHorizontalFormatting(a)},d.setMeasureHorizontalFormatting=function(a,b){this.content.setMeasureHorizontalFormatting(a,b)},d.formatMeasureHorizontal=function(a){this.content.formatMeasureHorizontal(a)},d.drawCursor=function(a,b){this.content.drawCursor(a,b)},d.drawGraceCursor=function(a,b){this.content.drawGraceCursor(a,b)},d.drawTabCursor=function(a,b){this.content.drawTabCursor(a,b)},d.drawDynamicCursor=function(a,b){this.content.drawDynamicCursor(a,b)},d.drawPizzicatoCursor=function(a,b){this.content.drawPizzicatoCursor(a,b)},d.drawHorizontalCursor=function(a,b){this.content.drawHorizontalCursor(a,b)},d.drawHorizontalCursorTimePos=function(a,b){this.content.drawHorizontalCursorTimePos(a,b)},d.drawHorizontalMeasureWideCursor=function(a,b){this.content.drawHorizontalMeasureWideCursor(a,b)},d.drawCrossMeasureNoteCursor=function(a,b){this.content.drawCrossMeasureNoteCursor(a,b)},d.updateMeasureNumbers=function(a){this.content.updateMeasureNumbers(a)},d.updateMeasureNumber=function(a){this.content.updateMeasureNumber(a)},d.setMeasureNumberingStart=function(a){this.content.setMeasureNumberingStart(a)},d.autoUpdateHorizontalDisplay=function(){this.content.autoUpdateHorizontalDisplay()},d.updateHorizontalDisplay=function(a){this.content.updateHorizontalDisplay(a)},d.moveMeasures=function(a){
this.content.moveMeasures(a)},d.autoUpdateVerticalDisplay=function(){this.content.autoUpdateVerticalDisplay(),this.updateHeader()},d.updateStaffVerticalDisplay=function(a){this.content.updateStaffVerticalDisplay(a)},d.moveStaves=function(a){this.content.moveStaves(a)},d.updateHeader=function(){var a=this.content.getMiddleY();this.header.setMiddleY(a);var b=this.content.getNominalInnerHeight();this.header.setNominalHeight(b);var c=this.content.getInnerHeight();this.header.setBraceHeight(c),this.header.update(),this.header.move()},d.moveHeader=function(a){this.header.setPosX(a),this.header.move()},d.extendInnerBarlines=function(){this.content.extendInnerBarlines()},d.reloadAllCrossMeasures=function(){this.content.reloadAllCrossMeasures()},d.reloadStaffCrossMeasures=function(a){this.content.reloadStaffCrossMeasures(a)},d.updateCrossMeasuresHorizontalDisplay=function(){this.content.updateCrossMeasuresHorizontalDisplay()},d.updateStaffLines=function(){this.content.updateStaffLines()},d.bindMeasures=function(){this.content.bindMeasures()},d.getHeight=function(){return this.content.getHeight()},d.getStaffLyricsUpY=function(a,b,c){return this.content.getStaffLyricsUpY(a,b,c)},d.getStaffWordsY=function(a,b,c){return this.content.getStaffWordsY(a,b,c)},d.getChordsY=function(a){return this.content.getChordsY(a)},d.getMeasureWidth=function(a){return this.content.getMeasureWidth(a)},d.getNoteXInMeasure=function(a,b,c,d){return this.content.getNoteXInMeasure(a,b,c,d)},d.getStaffHeight=function(a){return this.content.getStaffHeight(a)},d.getSpaceAboveStaff=function(a){return this.content.getSpaceAboveStaff(a)},d.getMeasureNbNotes=function(a,b,c){return this.content.getMeasureNbNotes(a,b,c)},d.resetGeometries=function(){this.content.resetGeometries()},d.getMeasureGeometry=function(a){return this.content.getMeasureGeometry(a)},d.getSpaceAboveFirstStaff=function(){return this.content.getSpaceAboveFirstStaff()},d.getSpaceBelowLastStaff=function(){return this.content.getSpaceBelowLastStaff()},d.getDrawingContext=function(){return this.drawingContext},d.getNbMeasures=function(){return this.content.getNbMeasures()},d.getNbStaves=function(){return this.content.getNbStaves()},d.getHeaderWidth=function(){return this.header.getWidth()},d.getContentWidth=function(){return this.content.getWidth()},d.getPosY=function(){return this.content.getPosY()},d.getStructure=function(){return this.idx},d.getStartMeasureIdx=function(){return this.content.getStartMeasureIdx()},d.injectHeader=function(a){var b=this.header.parent;a.setParent(b),this.extractHeader(),null!==b&&a.isRendered()&&a.bindToParent(),this.header=a},d.extractHeader=function(){var a=this.header;return a.unbind(),a.setParent(null),this.header=null,a},d.drawVerticalDebug=function(){this.content.drawVerticalDebug()}}.call(this),function(){"use strict";var a=Adagio.Drawer.System,b=Adagio.Utils.partHeaderUtils,c=Adagio.Render.SystemsBuilder=function(){},d=c.prototype;d.build=function(a,b){return a.map(function(a){return this.buildPartSystems(a,b)},this)},d.buildPartSystems=function(c,d){void 0===d&&(d=!0);var e;e=d?b.getName(c):b.hasAbbreviation(c)?b.getAbbreviation(c):b.inferAbbreviation(c);var f=new a;return e=e.trim(),""!==e&&f.setName(e),f}}.call(this),function(){"use strict";var a=Adagio.Utils.staffDetailsUtils,b=Adagio.Utils.clefUtils,c=Adagio.Utils.staffDataUtils={};c.DEFAULT_NB_STAFF_LINES=5,c.DEFAULT_IS_TAB_STAFF=!1,c.createDefault=function(){return c.create(c.DEFAULT_NB_STAFF_LINES,c.DEFAULT_IS_TAB_STAFF)},c.create=function(a,b){return{nbStaffLines:a,isTabStaff:b}},c.createFromClef=function(a,d){return b.isTab(d)?c.create(a,!c.DEFAULT_IS_TAB_STAFF):c.create(a,c.DEFAULT_IS_TAB_STAFF)},c.createFromStaffDetails=function(b){var d=a.getNbStaffLines(b);return a.hasStaffTuning(b)?c.create(d,!c.DEFAULT_IS_TAB_STAFF):c.create(d,c.DEFAULT_IS_TAB_STAFF)},c.hasNbStaffLines=function(a){return void 0!==a.nbStaffLines},c.hasIsTabStaff=function(a){return void 0!==a.isTabStaff},c.getNbStaffLines=function(a){return c.getIsTabStaff(a)&&c.hasNbStaffLines(a)?a.nbStaffLines:c.DEFAULT_NB_STAFF_LINES},c.getDisplayedNbStaffLines=function(a){return c.hasNbStaffLines(a)?a.nbStaffLines:c.DEFAULT_NB_STAFF_LINES},c.getIsTabStaff=function(a){return c.isTabStaff(a)},c.isTabStaff=function(a){return c.hasIsTabStaff(a)?a.isTabStaff:c.DEFAULT_IS_TAB_STAFF},c.setNbStaffLines=function(a,b){a.nbStaffLines=b},c.setIsTabStaff=function(a,b){a.isTabStaff=b}}.call(this),function(){"use strict";Adagio.Values.MeasureLocation={FIRST_OF_SCORE:"firstOfScore",FIRST_OF_LINE:"firstOfLine",OTHER:"other"}}.call(this),function(){"use strict";var a=Adagio.Utils.clone,b=Adagio.Utils.attributesUtils,c=Adagio.Utils.attributeWrapper.AttributeWrapper,d=Adagio.Utils.printedAttributesUtils={};d.extractRightAttributes=function(a,c){var d={},e=b.getNbStaves(a);if(b.setNbStaves(d,e),null!==c){var g=b.getWrappedClef(a),h=b.getWrappedClef(c),i=f(g,h);b.setClef(d,i)}return d},d.extractFromFirstMeasureOfScore=function(a){var c={},d=b.getNbStaves(a);b.setNbStaves(c,d);var e=b.getWrappedClef(a),f=e.dumpAttribute();b.setClef(c,f);var g=b.getWrappedKey(a),h=g.dumpAttribute();b.setKey(c,h);var i=b.getWrappedTime(a),j=i.dumpAttribute();return b.setTime(c,j),c},d.extractFromMiddleMeasure=function(a,c){var d=e(a,c);return b.removeClef(d),d},d.extractFromFirstMeasureOfLine=function(a,b){var c=g(a),d=e(a,b);return h(c,d)};var e=function(a,c){var d={},e=b.getNbStaves(a);b.setNbStaves(d,e);var g=b.getWrappedKey(a),h=b.getWrappedKey(c),i=f(h,g);b.setKey(d,i);var j=b.getWrappedClef(a),k=b.getWrappedClef(c),l=f(k,j);b.setClef(d,l);var m=b.getWrappedTime(a),n=b.getWrappedTime(c),o=f(n,m);return b.setTime(d,o),d},f=function(a,b){var d=b.getDiffWith(a);return d=new c(d,a.getNbStaves(),a.utils).dumpAttribute()},g=function(a){var c={},d=b.getNbStaves(a);b.setNbStaves(c,d);var e=b.getWrappedClef(a),f=e.dumpAttribute();b.setClef(c,f);var g=b.getWrappedKey(a),h=g.dumpAttribute();return b.setKey(c,h),c},h=function(a,c){var d={},e=b.getNbStaves(a);b.setNbStaves(d,e);var f=b.getWrappedKey(a),g=b.getWrappedKey(c),h=i(f,g);b.setKey(d,h);var j=b.getWrappedClef(a),k=b.getWrappedClef(c),l=i(j,k);b.setClef(d,l);var m=b.getWrappedTime(a),n=b.getWrappedTime(c),o=i(m,n);return b.setTime(d,o),d},i=function(b,d){c.checkCanCompare(b,d);for(var e=b.getNbStaves(),f=new c([],e,b.utils),g=0;g<e;g++){var h;b.hasEntry(g)?(h=b.getEntry(g),f.setEntry(a(h),g)):d.hasEntry(g)&&(h=d.getEntry(g),f.setEntry(a(h),g))}return f.dumpAttribute()}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.staffUtils={};b.groupStaves=function(a){return e.group(a)},b.resolvePos=function(b){for(var c=0,d=[],e=a.getStaffIdx(b[0]),f=0;f<b.length;f++)a.getStaffIdx(b[f])!==e&&(c=0),a.isChord(b[f])||c++,e=a.getStaffIdx(b[f]),d.push({note:c-1,staff:e+1});return d};var c=function(){},d=c.prototype;d.group=function(a){return this.reset(),a.forEach(this.addNote.bind(this)),this.staffs},d.reset=function(){this.staffs={}},d.addNote=function(b){var c=a.getStaffIdx(b);this.addNoteToStaff(b,c)},d.addNoteToStaff=function(a,b){void 0===this.staffs[b]&&(this.staffs[b]=[]),this.staffs[b].push(a)};var e=new c}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils;Adagio.Render.groupVoicesNotes=function(a){return b(a)};var b=function(a){var b={};return a.forEach(c,b),b},c=function(b){var c=this,d=a.getVoiceIdx(b);void 0===c[d]&&(c[d]=[]),c[d].push(b)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.noteUtils;Adagio.Render.formatVoiceNotes=function(a,b){return d().format(b)};var c=null,d=function(){return null===c&&(c=new e),c},e=function(){},f=e.prototype;f.format=function(b){if(this.reset(),b.forEach(this.addNote,this),this.hasChord()&&this.closeChord(),this.hasGraces())throw new a("Unexpected","There are orphan graces in draw.");return this.entries},f.reset=function(){this.timePos=0,this.graces=[],this.entries=[],this.chord=null},f.addNote=function(a){!b.isChord(a)&&this.hasChord()&&this.closeChord(),this.addToChord(a)},f.closeChord=function(){this.isChordGrace()?this.addChordToGraces():this.addChordToNotes()},f.isChordGrace=function(){return b.isGraceNote(this.chord[0])},f.addChordToGraces=function(){this.graces.push(this.chord),this.chord=null},f.addChordToNotes=function(){var a={graces:this.graces,chordJson:this.chord,timePos:this.timePos};this.entries.push(a);var c=b.getDuration(this.chord[0]);this.timePos+=c,this.graces=[],this.chord=null},f.addToChord=function(a){var b=this.getChord();g(b,a),b.push(a)},f.getChord=function(){return this.hasChord()||(this.chord=[]),this.chord},f.hasChord=function(){return null!==this.chord};var g=function(c,d){if(0!==c.length){var e=c[0];if(b.isGraceNote(e)!==b.isGraceNote(d))throw new a("Unexpected","Cannot mix grace and non grace in a chord for display.")}};f.hasGraces=function(){return this.graces.length>0}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.staffUtils,c=Adagio.Utils.mapUtils,d=Adagio.Utils.typeUtils,e=Adagio.Utils.noteUtils,f=Adagio.Utils.beamsUtils,g=Adagio.Render.groupVoicesNotes,h=Adagio.Render.formatVoiceNotes,i=Adagio.Data.beam.fillEntryConnections,j=Adagio.Data.beam.createNoteBeams,k=Adagio.Values.DurationType;(Adagio.Utils.graceNotesBeamsMeasureUtils={}).shapeMeasure=function(d,e){var f=l(d,e),g=b.groupStaves(f),h=a.getDpq(e);return c.forEach(g,function(a,b){m(a,b,h)}),e};var l=function(b,c){return b.isConcertPitch?a.getConcertNotes(c):a.getNotes(c)},m=function(a,b,d){var e=g(b);e=c.map(e,h),c.forEach(e,function(a,b){b.forEach(n,d)})},n=function(a){var b=this,c=a.graces;o(c,b),p(c)},o=function(a,b){a.forEach(function(a){a=d.makeArray(a),a.forEach(function(a){var c=e.getDurationType(a),d=k.toQuarterDuration(c);d*=b,e.setFloatingDuration(a,d)})})},p=function(a){for(var b=0;b<a.length-1;b++){var c=d.isArray(a[b])?a[b][0]:a[b],e=d.isArray(a[b+1])?a[b+1][0]:a[b+1],f=b-1<0?null:d.isArray(a[b-1])?a[b-1][0]:a[b-1],g=b+2<a.length?d.isArray(a[b+2])?a[b+2][0]:a[b+2]:null;t(c)&&t(e)&&(q(f,c,e),q(c,e,g))}},q=function(a,b,c){var d=null===a?null:r(a),e=r(b),f=null===c?null:r(c);s(b,d,e,f)},r=function(a){var b=e.getDurationType(a),c=k.toQuarterDuration(b),d=f.durationToNbBeams(c);return e.isSlashedGrace(a)&&(d=0),{nbBeams:d,left:[],right:[]}},s=function(a,b,c,d){i(b,c,d);var f=j(c);e.setBeams(a,f)},t=function(a){if(e.isSlashedGrace(a))return!1;switch(e.getDurationType(a)){case k.EIGHT:case k.SIXTEENTH:case k.THIRTY_SECOND:case k.SIXTY_FOURTH:return!0;default:return!1}}}.call(this),function(){"use strict";var a=Adagio.Utils.directionUtils,b=null;Adagio.Data.direction.indexDirectionsByStaffIdx=function(a){return e().index(a)};var c=function(){},d=c.prototype;d.index=function(a){return this.reset(),a.forEach(this.addDirection,this),this.map},d.reset=function(){this.map={}},d.addDirection=function(b){var c=a.getStaffIdx(b);this.getEntry(c).push(b)},d.getEntry=function(a){return void 0===this.map[a]&&(this.map[a]=[]),this.map[a]};var e=function(){return null===b&&(b=new c),b}}.call(this),function(){"use strict";var a=Adagio.Error.MusicXMLFeatureNotSupportedError=function(a){var b=Error.call(this,a);return this.name=b.name="MusicXMLFeatureNotSupportedError",this.stack=b.stack,this.message=b.message,this};a.prototype=Object.create(Error.prototype,{constructor:{value:a}})}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Brush.Elem,c={common:"timeSigCommon",cut:"timeSigCutCommon"},d=Adagio.Drawer.time.SymbolEntry=function(a){this.init(a)},e=d.prototype;e.init=function(a){f(a),this.glyphName=g(a),this.glyph=null,this.path=null,this.drawingContext=null,this.xPos=null,this.yPos=null,this.parent=null};var f=function(b){if(void 0===c[b]){throw new a("BadTimeSymbol","The time symbol ["+b+"] is invalid.")}},g=function(a){return c[a]};e.setParent=function(a){this.parent=a},e.setDrawingContext=function(a){this.drawingContext=a},e.getWidth=function(){return this.getGlyph().getWidth()},e.getHeight=function(){return this.getGlyph().getHeight()},e.getGlyph=function(){return null===this.glyph&&(this.glyph=this.drawingContext.getGlyph(this.glyphName)),this.glyph},e.render=function(){this.path=new b("path"),this.path.attr("d",this.glyph.render())},e.setPosition=function(a,b){this.xPos=a,this.yPos=b},e.setXPos=function(a){this.xPos=a},e.setYPos=function(a){this.yPos=a},e.draw=function(){this.needRender()&&this.render(),this.move(),this.bindToParent()},e.needRender=function(){return null===this.path},e.bindToParent=function(){this.parent.append(this.path)},e.move=function(){var a=this.getHeight(),b=this.yPos+a/2;this.path.attr("transform","translate("+this.xPos+", "+b+")")}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Brush.Elem,c=Adagio.Utils.math,d=["timeSig0","timeSig1","timeSig2","timeSig3","timeSig4","timeSig5","timeSig6","timeSig7","timeSig8","timeSig9"],e=Adagio.Drawer.time.NumberEntry=function(a){this.init(a)},f=e.prototype;f.init=function(a){g(a),this.list=h(a),this.drawingContext=null,this.width=null,this.xPos=null,this.yPos=null,this.parent=null,this.group=null};var g=function(b){if(!c.isInteger(b)||b<=0){throw new a("BadTimeNumber","The time number ["+b+"] is invalid. It has to be a strictly positive integer")}},h=function(a){for(var b=[];a>0;){var d=a%10;a=c.intPart(a/10);var e=i(d),f={glyphName:e,glyph:null,path:null,pos:null};b.unshift(f)}return b},i=function(a){return d[a]};f.setParent=function(a){this.parent=a},f.setDrawingContext=function(a){this.drawingContext=a},f.getWidth=function(){return this.areGlyphesLoaded()||this.loadGlyphes(),this.width},f.getHeight=function(){return this.areGlyphesLoaded()||this.loadGlyphes(),this.list[0].glyph.getHeight()},f.areGlyphesLoaded=function(){return null!==this.width},f.loadGlyphes=function(){this.width=this.list.reduce(this.loadGlyph.bind(this),0)},f.loadGlyph=function(a,b){if(a>0){a+=this.drawingContext.getTimeDigitMargin()}return b.pos=a,b.glyph=this.drawingContext.getGlyph(b.glyphName),a+b.glyph.getWidth()},f.render=function(){this.areGlyphesLoaded()||this.loadGlyphes(),this.group=new b("g"),this.list.forEach(this.renderEntry,this)},f.renderEntry=function(a){var b=this.group.append("path");b.attr("d",a.glyph.render());var c=a.pos,d=a.glyph.getHeight()/2;b.attr("transform","translate("+c+", "+d+")"),a.path=b},f.setPosition=function(a,b){this.xPos=a,this.yPos=b},f.setXPos=function(a){this.xPos=a},f.setYPos=function(a){this.yPos=a},f.draw=function(){this.needRender()&&this.render(),this.move(),this.bindToParent()},f.needRender=function(){return null===this.group},f.bindToParent=function(){this.parent.append(this.group)},f.move=function(){this.group.attr("transform","translate("+this.xPos+", "+this.yPos+")")}}.call(this),function(){"use strict";var a=Adagio.Brush.Elem,b=Adagio.Error.InternalError,c=Adagio.Utils.staffDataUtils,d=Adagio.Drawer.time.TimeSignature=function(){this.init()};d.cssClass="timeSignature";var e=d.prototype;e.cssClass=d.cssClass,e.init=function(){this.layout=null,this.drawingContext=null,this.staffData=null,this.height=null,this.xPos=null,this.formatted=!1,this.parent=null,this.group=null},e.setParent=function(a){this.parent=a},e.setLayout=function(a){this.layout=a},e.setStaffData=function(a){this.staffData=a},e.getWidth=function(){return this.layout.getWidth()},e.setDrawingContext=function(a){this.drawingContext=a,this.layout.setDrawingContext(a)},e.render=function(){this.isFormatted()||this.format(),this.group=new a("g"),this.group.attr("class",this.cssClass),this.layout.setParent(this.group),this.layout.render()},e.isFormatted=function(){return this.formatted},e.format=function(){this.checkHasStaffData();var a=this.isTabStaff()?this.drawingContext.getTabSpaceSize():this.drawingContext.getSpaceSize(),b=a*(this.getNbStaffLines()-1)/2;this.layout.setPosition(0,b),this.formatted=!0},e.getStaffData=function(){return this.staffData},e.getNbStaffLines=function(){return c.getNbStaffLines(this.staffData)},e.isTabStaff=function(){return c.isTabStaff(this.staffData)},e.checkHasStaffData=function(){if(null===this.staffData){throw new b("MissingNbStaves","The time signature needs to know the number of staff lines to be formatted.")}},e.setPosition=function(a){this.xPos=a},e.draw=function(){this.needRender()&&this.render(),this.layout.draw(),this.move(),this.bindToParent()},e.needRender=function(){return null===this.group},e.bindToParent=function(){this.parent.append(this.group)},e.move=function(){this.group.attr("transform","translate("+this.xPos+", 0)")},e.getUpOverflow=function(){return 0}}.call(this),function(){"use strict";var a=Adagio.Brush.Elem,b=Adagio.Drawer.time.SingleLayout=function(){this.init()},c=b.prototype;c.init=function(){this.entry=null,this.height=null,this.xPos=null,this.yPos=null,this.parent=null,this.group=null},c.setEntry=function(a){this.entry=a},c.setParent=function(a){this.parent=a},c.setDrawingContext=function(a){this.entry.setDrawingContext(a)},c.getWidth=function(){return this.entry.getWidth()},c.getHeight=function(){return this.isVerticallyAligned()||this.alignVertically(),this.height},c.isVerticallyAligned=function(){return null!==this.height},c.alignVertically=function(){var a=this.entry.getHeight();this.entry.setPosition(0,-a/2),this.height=a},c.render=function(){this.isVerticallyAligned()||this.alignVertically(),this.group=new a("g"),this.entry.setParent(this.group),this.entry.render()},c.setPosition=function(a,b){this.xPos=a,this.yPos=b},c.draw=function(){this.needRender()&&this.render(),this.entry.draw(),this.move(),this.bindToParent()},c.needRender=function(){return null===this.group},c.bindToParent=function(){this.parent.append(this.group)},c.move=function(){this.group.attr("transform","translate("+this.xPos+", "+this.yPos+")")}}.call(this),function(){"use strict";var a=Adagio.Brush.Elem,b=Adagio.Drawer.time.VerticalLayout=function(){this.init()},c=b.prototype;c.init=function(){this.numerator=null,this.denominator=null,this.drawingContext=null,this.width=null,this.height=null,this.xPos=null,this.yPos=null,this.parent=null,this.group=null},c.setNumerator=function(a){this.numerator=a},c.setDenominator=function(a){this.denominator=a},c.setParent=function(a){this.parent=a},c.setDrawingContext=function(a){this.drawingContext=a,this.numerator.setDrawingContext(a),this.denominator.setDrawingContext(a)},c.getWidth=function(){return this.isHorizontallyAligned()||this.alignHorizontally(),this.width},c.getHeight=function(){return this.isVerticallyAligned()||this.alignVertically(),this.height},c.isHorizontallyAligned=function(){return null!==this.width},c.alignHorizontally=function(){var a=this.denominator.getWidth(),b=this.numerator.getWidth(),c=Math.abs(a-b)/2;b>a?(this.denominator.setXPos(c),this.numerator.setXPos(0)):(this.denominator.setXPos(0),this.numerator.setXPos(c)),this.width=Math.max(a,b)},c.isVerticallyAligned=function(){return null!==this.height},c.alignVertically=function(){var a=this.numerator.getHeight(),b=this.denominator.getHeight(),c=2*this.drawingContext.getSpaceSize(),d=Math.max(c-a,0)/2,e=Math.max(c-b,0)/2;this.numerator.setYPos(-(a+d)),this.denominator.setYPos(e),this.width=a+d+b+e},c.render=function(){this.isHorizontallyAligned()||this.alignHorizontally(),this.isVerticallyAligned()||this.alignVertically(),this.group=new a("g"),this.numerator.setParent(this.group),this.denominator.setParent(this.group),this.numerator.render(),this.denominator.render()},c.setPosition=function(a,b){this.xPos=a,this.yPos=b},c.draw=function(){this.needRender()&&this.render(),this.numerator.draw(),this.denominator.draw(),this.move(),this.bindToParent()},c.needRender=function(){return null===this.group},c.bindToParent=function(){this.parent.append(this.group)},c.move=function(){this.group.attr("transform","translate("+this.xPos+", "+this.yPos+")")}}.call(this),function(){"use strict";var a=Adagio.Error.MusicXMLFeatureNotSupportedError,b=Adagio.Drawer.time.SymbolEntry,c=Adagio.Drawer.time.NumberEntry,d=Adagio.Drawer.time.TimeSignature,e=Adagio.Drawer.time.SingleLayout,f=Adagio.Drawer.time.VerticalLayout,g=Adagio.Utils.timeUtils,h=["cut","common","single-number"],i=["cut","common"],j={none:f},k=Adagio.Render.TimeSignatureBuilder=function(){this.init()},l=k.prototype;l.init=function(){this.timeSignature=null,this.layout=null,this.timeJson=null},l.build=function(a){return this.init(),g.check(a),this.timeJson=a,this.timeSignature=new d,this.createLayout(),this.createContent(),this.timeSignature},l.checkSymbol=function(){var a=this.getSymbol();g.checkSymbol(a)},l.createLayout=function(){this.isSingleLayout()?this.layout=new e:this.createDuplexLayout(),this.timeSignature.setLayout(this.layout)},l.createDuplexLayout=function(){this.checkSeparator();var a=this.getLayout();this.layout=new a},l.checkSeparator=function(){var b=this.getSeparator();if(void 0===j[b]){throw new a("The separator ["+b+"] is not supported. ")}},l.getLayout=function(){var a=this.getSeparator();return j[a]},l.getSeparator=function(){return g.getSeparator(this.timeJson)},l.createContent=function(){this.isSingleLayout()?this.createSingleLayoutContent():this.createDuplexLayoutContent()},l.isSingleLayout=function(){var a=this.getSymbol();return h.includes(a)},l.createSingleLayoutContent=function(){var a;if(this.isSymbol()){var d=this.getSymbol();a=new b(d)}else{var e=this.getBeatType();a=new c(e)}this.layout.setEntry(a)},l.isSymbol=function(){var a=this.getSymbol();return i.includes(a)},l.isSingleNumber=function(){return"single-number"===this.getSymbol()},l.createDuplexLayoutContent=function(){var a=this.createNumerator(),b=this.createDenominator();this.layout.setNumerator(a),this.layout.setDenominator(b)},l.createNumerator=function(){if(this.isDotted()){throw new a("time signature with dotted notes are not supported yet.")}var b=this.getBeats();return new c(b)},l.isDotted=function(){return"dotted-note"===this.getSymbol()},l.getBeats=function(){return g.getBeats(this.timeJson)},l.createDenominator=function(){if(this.isNormal()){var b=this.getBeatType();return new c(b)}var d=this.getSymbol();throw new a("The time signature symbol ["+d+"] is not supported yet. ")},l.isNormal=function(){return"normal"===this.getSymbol()},l.getBeatType=function(){return g.getBeatType(this.timeJson)},l.getSymbol=function(){return g.getSymbol(this.timeJson)}}.call(this),function(){"use strict";var a=Adagio.Brush.Elem,b=Adagio.Error.InternalError,c=Adagio.Utils.staffDataUtils,d=Adagio.Drawer.KeySignature=function(){this.init()};d.cssClass="keySignature";var e=d.prototype;e.cssClass=d.cssClass,e.init=function(){this.list=null,this.drawingContext=null,this.width=null,this.xPos=null,this.staffData=null,this.parent=null,this.group=null},e.setParent=function(a){this.parent=a},e.setStaffData=function(a){this.staffData=a},e.setList=function(a){this.list=f(a)};var f=function(a){return a.map(g)},g=function(a){return{pos:null,path:null,glyph:null,line:a.line,glyphName:a.glyphName}};e.setDrawingContext=function(a){this.drawingContext=a},e.getStaffData=function(){return this.staffData},e.getWidth=function(){return this.areGlyphesLoaded()||this.loadGlyphes(),this.width},e.areGlyphesLoaded=function(){return null!==this.width},e.loadGlyphes=function(){this.width=this.list.reduce(this.loadGlyph.bind(this),0)},e.loadGlyph=function(a,b){if(a>0){a+=this.drawingContext.getKeyAccidentalMargin()}return b.pos=a,b.glyph=this.drawingContext.getGlyph(b.glyphName),a+b.glyph.getWidth()},e.render=function(){this.areGlyphesLoaded()||this.loadGlyphes(),this.group=new a("g"),this.group.attr("class",this.cssClass),this.list.forEach(this.renderEntry,this)},e.renderEntry=function(a){var b=this.group.append("path");b.attr("d",a.glyph.render());var c=a.pos,d=this.lineToY(a.line);b.attr("transform","translate("+c+", "+d+")"),a.path=b},e.checkHasStaffData=function(){if(null===this.staffData){throw new b("MissingNbStaves","The key signature needs to know the number of staff lines to be formatted.")}},e.getNbStaffLines=function(){return c.getNbStaffLines(this.staffData)},e.isTabStaff=function(){return c.isTabStaff(this.staffData)},e.lineToY=function(a){this.checkHasStaffData();var b=this.isTabStaff()?this.drawingContext.getTabSpaceSize():this.drawingContext.getSpaceSize();return(this.getNbStaffLines()-a)*b},e.setPosition=function(a){this.xPos=a},e.draw=function(){this.needRender()&&this.render(),this.move(),this.bindToParent()},e.needRender=function(){return null===this.group},e.bindToParent=function(){this.parent.append(this.group)},e.move=function(){this.group.attr("transform","translate("+this.xPos+", 0)")},e.getUpOverflow=function(){return 0}}.call(this),function(){"use strict";var a=Adagio.Utils.pitchUtils,b=["A","B","C","D","E","F","G"],c=["F","G","A","B","C","D","E"],d=["F","C","G","D","A","E","B"],e=["B","E","A","D","G","C","F"],f=.5,g=5.5,h=b.length,i=h/2;(Adagio.Utils.drawKeyUtils={}).getLines=function(a,b){return 0===b?[]:b>0?j(a):l(a)};var j=function(a){var b=o(a);w(b)||(b=b.concat(p(a)));var c=y(b);return k(c)},k=function(a){return n(a,d)},l=function(a){var b=p(a);w(b)||(b=b.concat(o(a)));var c=y(b);return m(c)},m=function(a){return n(a,e)},n=function(a,b){var c=a.originLine,d=a.scale;return b.map(function(a){var b=s(d,a);return c+b})},o=function(a){return q(a,b)},p=function(a){return q(a,c)},q=function(a,b){var c=[],d=r(a,b);c.push(d);do{d=t(d),c.push(d)}while(0===d.excedentLines);return c},r=function(b,c){var d=a.lineToPitch(f,b),e=a.getStep(d),g=s(c,e),h=f-g,i={originLine:h,scale:c};return v(i),i},s=function(a,b){return a.indexOf(b)/2},t=function(a){return a=u(a),a.originLine+=i,v(a),a},u=function(a){return{scale:a.scale,originLine:a.originLine,excedentLines:a.excedentLines}},v=function(a){var b=a.originLine+i-.5;a.originLine<f?a.excedentLines=f-a.originLine:a.excedentLines=b>g?b-f:0},w=function(a){return a.some(x)},x=function(a){return 0===a.excedentLines},y=function(a){return a.reduce(z)},z=function(a,b){return b.excedentLines<a.excedentLines?b:a}}.call(this),function(){"use strict";var a=Adagio.Utils.keyUtils,b=Adagio.Utils.clefUtils,c=Adagio.Utils.drawKeyUtils,d={NATURAL:"accidentalNatural",SHARP:"accidentalSharp",FLAT:"accidentalFlat"},e=Adagio.Render.KeySignatureListBuilder=function(){this.init()},f=e.prototype;f.init=function(){this.keyJson=null,this.clefJson=null,this.list=[],this.fifthsLines=null},f.build=function(c,d){return this.init(),a.check(c),b.check(d),this.keyJson=c,this.clefJson=d,this.createList(),this.list},f.createList=function(){this.list=[],this.hasFullCancel()&&this.createFullCancel(),this.createFifths(),this.hasPartialCancel()&&this.createPartialCancel()},f.hasFullCancel=function(){return!!a.isBackToZero(this.keyJson)||a.hasCancel(this.keyJson)&&a.isSignChange(this.keyJson)},f.createFullCancel=function(){var a=this.getPreviousFifths(),b=c.getLines(this.clefJson,a),e=Math.abs(a);b=b.slice(0,e);var f=d.NATURAL;this.addLines(b,f)},f.createFifths=function(){var a=this.getFifths();this.fifthsLines=c.getLines(this.clefJson,a);var b=Math.abs(a),d=this.fifthsLines.slice(0,b),e=g(a);this.addLines(d,e)},f.hasPartialCancel=function(){if(a.hasCancel(this.keyJson)&&!a.isSignChange(this.keyJson)){var b=this.getFifths(),c=this.getPreviousFifths();return Math.abs(b)<Math.abs(c)}return!1},f.createPartialCancel=function(){var a=this.getFifths(),b=this.getPreviousFifths(),c=Math.abs(a),e=Math.abs(b),f=this.fifthsLines.slice(c,e),g=d.NATURAL;this.addLines(f,g)};var g=function(a){return a>0?d.SHARP:a<0?d.FLAT:d.NATURAL};f.getFifths=function(){return a.getFifths(this.keyJson)},f.getPreviousFifths=function(){return a.getPreviousFifths(this.keyJson)},f.addLines=function(a,b){a.forEach(function(a){var c={line:a,glyphName:b};this.list.push(c)},this)}}.call(this),function(){"use strict";var a=Adagio.Drawer.KeySignature,b=Adagio.Render.KeySignatureListBuilder,c=Adagio.Render.KeySignatureBuilder=function(){this.init()},d=c.prototype;d.init=function(){this.listBuilder=new b},d.build=function(b,c){var d=this.listBuilder.build(b,c),e=new a;return e.setList(d),e}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError;(Adagio.Values.StemStrategy={AUTO:"auto",UP:"up",DOWN:"down"}).raiseError=function(b){throw new a("BadStemStrategyError","Invalid value for stemStrategy: ["+b+"].")}}.call(this),function(){"use strict";Adagio.formatter.horizontal.createDynamicsHorizontalData=function(c,d){return c=c.concat(d),c.sort(a),b(c).map(e)};var a=function(a,b){var c=a.getTimePos()-b.getTimePos();return 0!==c?c:a.getHorizontalPosition()-b.getHorizontalPosition()},b=function(a){var b=[];return a.forEach(c,b),b},c=function(a){var b=this;d(a,b)&&b.push([]),b[b.length-1].push(a)},d=function(a,b){var c=b.length;if(0===c)return!0;var d=b[c-1],e=d[0].getTimePos();return a.getTimePos()!==e},e=function(a){var b=0,c=a.reduce(f,b);return{timePos:a[0].getTimePos(),spaceBefore:0,spaceAfter:c}},f=function(a,b,c){if(c>0){a+=b.getDrawingContext().getMarginSize()}return b.setHorizontalOffset(a),a+=b.getWidth()}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Brush.Elem,c=Adagio.Utils.math,d=Adagio.Values.TickableType,e=Adagio.formatter.horizontal.createDynamicsHorizontalData,f=Adagio.Drawer.TickableContentDrawer=function(){this.init()};f.cssClass="tickableContent";var g=f.prototype;g.cssClass=f.cssClass,g.init=function(){this.voices={},this.directions=[],this.pizzicatos=[],this.words=[],this.chords=[],this.leftWedgeAnchor=null,this.rightWedgeAnchor=null,this.middleWedgesAnchors=[],this.leftOctaveShiftAnchor=null,this.rightOctaveShiftAnchor=null,this.middleOctaveShiftsAnchors=[],this.drawingContext=null,this.staffData=null,this.xPos=null,this.dynamicsHorizontalData=null,this.horizontalData=null,this.verticalData=null,this.staticVerticalData=null,this.dynamicVerticalData=null,this.horizontalFormatter=null,this.verticalFormatting=null,this.chordsHeight=null,this.hasDynamicsAboveValue=null,this.hasDynamicsBelowValue=null,this.hasPizzicatosAboveValue=null,this.hasPizzicatosBelowValue=null,this.hasWordsAboveValue=null,this.hasWordsBelowValue=null,this.hasOctaveShiftsAboveValue=null,this.hasOctaveShiftsBelowValue=null,this.nbDivisions=null,this.dpq=null,this.voicesIndexes=null,this.group=new b("g"),this.group.attr("class",this.cssClass),this.parent=null},g.setParent=function(a){this.parent=a},g.setStaffData=function(a){this.staffData=a,this.forEachVoice(this.transferStaffData,this)},g.setVoicesIndexes=function(a){this.voicesIndexes=a},g.transferStaffData=function(a){a.setStaffData(this.staffData)},g.transferParent=function(a){a.setParent(this.group)},g.addChord=function(a){a.setParent(this.group),this.chords.push(a)},g.setDpq=function(a){this.dpq=a},g.setNbDivisions=function(a){this.nbDivisions=a},g.addDirection=function(a){a.setParent(this.group),this.directions.push(a)},g.addPizzicato=function(a){a.setParent(this.group),this.pizzicatos.push(a)},g.addWord=function(a){a.setParent(this.group),this.words.push(a)},g.addVoice=function(a){var b=a.getVoiceIdx();this.voices[b]=a,a.setParent(this.group)},g.setRightWedgeAnchor=function(a){this.rightWedgeAnchor=a,a.setMeasure(this)},g.setLeftWedgeAnchor=function(a){this.leftWedgeAnchor=a,a.setMeasure(this)},g.addMiddleWedgeAnchor=function(a){this.middleWedgesAnchors.push(a),a.setMeasure(this)},g.setRightOctaveShiftAnchor=function(a){this.rightOctaveShiftAnchor=a,a.setMeasure(this)},g.setLeftOctaveShiftAnchor=function(a){this.leftOctaveShiftAnchor=a,a.setMeasure(this)},g.addMiddleOctaveShiftAnchor=function(a){this.middleOctaveShiftsAnchors.push(a),a.setMeasure(this)},g.render=function(a){this.drawingContext=a,this.forEachVoice(this.renderEntity,this),this.directions.forEach(this.renderEntity,this),this.pizzicatos.forEach(this.renderEntity,this),this.words.forEach(this.renderEntity,this),this.middleWedgesAnchors.forEach(this.transferDrawingContext,this),this.middleOctaveShiftsAnchors.forEach(this.transferDrawingContext,this),this.chords.forEach(this.transferDrawingContext,this)},g.renderEntity=function(a){a.render(this.drawingContext)},
g.transferDrawingContext=function(a){a.setDrawingContext(this.drawingContext)},g.getHorizontalData=function(){return null===this.horizontalData&&this.computeHorizontalData(),this.horizontalData},g.computeHorizontalData=function(){if(this.horizontalData=this.getVoicesHorizontalData(),this.hasChords()){var a=this.getChordsHorizontalData();this.horizontalData.push(a)}if(this.hasDynamics()){var b=this.getDynamicsHorizontalData();this.horizontalData.push(b)}},g.getVoicesHorizontalData=function(){var a=[];for(var b in this.voices){var c=this.voices[b],d=c.getHorizontalData();a.push(d)}return a},g.hasDynamics=function(){return this.directions.length>0||this.middleWedgesAnchors.length>0},g.getDynamicsHorizontalData=function(){if(null===this.dynamicsHorizontalData){var a=this.getDpq(),b=this.getNbDivisions(),c=e(this.directions,this.middleWedgesAnchors);this.dynamicsHorizontalData={entities:c,dpq:a,nbDivisions:b,type:d.DYNAMIC}}return this.dynamicsHorizontalData},g.hasChords=function(){return this.chords.length>0},g.getChordsHorizontalData=function(){var a=this.getDpq(),b=this.getNbDivisions();return{entities:this.chords.map(this.extractChordHorizontalData,this),dpq:a,nbDivisions:b,type:d.HARMONY}},g.extractChordHorizontalData=function(a){return{timePos:a.getTimePos(),spaceBefore:0,spaceAfter:a.getWidth()}},g.setHorizontalFormatter=function(a){this.horizontalFormatter=a,this.verticalData=null,this.dynamicVerticalData=null,this.forEachVoice(this.transferHorizontalFormatter,this)},g.transferHorizontalFormatter=function(a){a.setHorizontalFormatter(this.horizontalFormatter)},g.formatHorizonal=function(){this.formatVoicesHorizontal(),this.formatChordsHorizontal(),this.formatDirectionsHorizontal(),this.setLocalCrossMeasuresNeedDrawUpdate()},g.formatVoicesHorizontal=function(){this.forEachVoice(h)};var h=function(a){a.formatHorizonal()};g.formatChordsHorizontal=function(){this.chords.forEach(this.formatChordHorizontal,this)},g.formatChordHorizontal=function(a){var b=a.getTimePos(),c=this.timePosToX(b);a.setPosX(c)},g.timePosToX=function(a){var b=this.getDpq();return this.horizontalFormatter.getPosX(a,b)},g.formatDirectionsHorizontal=function(){this.directions.forEach(this.formatDirectionHorizontal,this),this.pizzicatos.forEach(this.formatDirectionHorizontal,this),this.words.forEach(this.formatDirectionHorizontal,this)},g.formatDirectionHorizontal=function(a){var b=a.getTimePos(),c=this.timePosToX(b);a.setPosX(c)},g.getWidth=function(){return this.horizontalFormatter.getWidth()},g.setVerticalFormatting=function(a){this.verticalFormatting=a,this.forEachVoice(this.transferVerticalFormatting,this)},g.transferVerticalFormatting=function(a){a.setVerticalFormatting(this.verticalFormatting)},g.formatVertical=function(){this.formatVoicesVertical(),this.formatChordsVertical(),this.formatDirectionsVertical(),this.formatPizzicatosVertical(),this.formatWordsVertical(),this.setLocalCrossMeasuresNeedDrawUpdate()},g.formatVoicesVertical=function(){this.forEachVoice(i)};var i=function(a){a.formatVertical()};g.formatChordsVertical=function(){this.chords.forEach(this.formatChordVertical,this)},g.formatChordVertical=function(a){var b=a.getHeight(),c=this.verticalFormatting.getChordsY()-b;a.setPosY(c)},g.formatDirectionsVertical=function(){this.directions.forEach(this.formatDirectionVertical,this)},g.formatDirectionVertical=function(b){if(b.isAbove())this.formatAboveDirectionVertical(b);else{if(!b.isBelow())throw new a("Unexpected");this.formatBelowDirectionVertical(b)}},g.formatAboveDirectionVertical=function(a){var b=this.drawingContext.getDynamicsHeight(),c=this.verticalFormatting.getUpDynamicsY(),d=c-b/2;a.setPosY(d)},g.formatBelowDirectionVertical=function(a){var b=this.drawingContext.getDynamicsHeight(),c=this.verticalFormatting.getDownDynamicsY(),d=c+b/2;a.setPosY(d)},g.formatPizzicatosVertical=function(){this.pizzicatos.forEach(this.formatPizzicatoVertical,this)},g.formatPizzicatoVertical=function(b){if(b.isAbove())this.formatAbovePizzicatoVertical(b);else{if(!b.isBelow())throw new a("Unexpected");this.formatBelowPizzicatoVertical(b)}},g.formatAbovePizzicatoVertical=function(a){var b=a.getSpaceBelow(),c=this.verticalFormatting.getUpPizzicatoY(),d=c-b;a.setPosY(d)},g.formatBelowPizzicatoVertical=function(a){var b=a.getSpaceAbove(),c=this.verticalFormatting.getDownPizzicatoY(),d=c+b;a.setPosY(d)},g.formatWordsVertical=function(){this.words.forEach(this.formatWordVertical,this)},g.formatWordVertical=function(b){if(b.isAbove())this.formatAboveWordVertical(b);else{if(!b.isBelow())throw new a("Unexpected");this.formatBelowWordVertical(b)}},g.formatAboveWordVertical=function(a){var b=a.getSpaceBelow(),c=this.verticalFormatting.getUpWordY(),d=c-b;a.setPosY(d)},g.formatBelowWordVertical=function(a){var b=a.getSpaceAbove(),c=this.verticalFormatting.getDownWordY(),d=c+b;a.setPosY(d)},g.draw=function(){this.move(),this.forEachVoice(j),this.directions.forEach(j),this.pizzicatos.forEach(j),this.words.forEach(j),this.chords.forEach(j),this.bindToParent()};var j=function(a){a.draw(a)};g.bindToParent=function(){this.parent.append(this.group)},g.drawLyrics=function(){this.forEachVoice(k)};var k=function(a){a.drawLyrics()};g.setPosition=function(a){this.xPos=a},g.move=function(){this.group.attr("transform","translate("+this.xPos+" 0)")},g.setCrossMeasuresNeedDrawUpdate=function(){this.setLocalCrossMeasuresNeedDrawUpdate(),this.setVoicesCrossMeasuresNeedDrawUpdate()},g.setLocalCrossMeasuresNeedDrawUpdate=function(){this.getAllWedgesAnchors().forEach(l)};var l=function(a){a.setNeedDrawUpdate()};g.setVoicesCrossMeasuresNeedDrawUpdate=function(){this.forEachVoice(m)};var m=function(a){a.setCrossMeasuresNeedDrawUpdate()};g.purgeCrossMeasures=function(){this.getAllWedgesAnchors().forEach(n),this.forEachVoice(o)};var n=function(a){a.hasWedge()&&a.removeWedge()},o=function(a){a.purgeCrossMeasures()};g.drawCursor=function(a,b){this.getVoice(a.voiceIdx).drawCursor(a,b)},g.drawGraceCursor=function(a,b){this.getVoice(a.voiceIdx).drawGraceCursor(a,b)},g.drawDynamicCursor=function(a,b){var c=this.getVoice(a.voiceIdx),d=c.getNote(a.noteIdx),e=d.getXPos();b.setPosition(e),this.formatDirectionVertical(b.dynamic),b.setParent(this.group),b.draw()},g.drawPizzicatoCursor=function(a,b){var c=this.getVoice(a.voiceIdx),d=c.getNote(a.noteIdx),e=d.getXPos();b.setPosition(e),this.formatDirectionVertical(b.pizzicato),b.setParent(this.group),b.draw()},g.drawSlurCursor=function(a,b){this.getVoice(a.voiceIdx).drawSlurCursor(a,b)},g.getNoteX=function(a,b){var c=this.getVoice(a);return this.getXPos()+c.getNoteX(b)},g.getXPos=function(){return this.xPos},g.getNbNotes=function(a){return this.getVoice(a).getNbNotes()},g.getPreviousSpace=function(){return this.horizontalFormatter.getAlignmentSpace()},g.getVerticalData=function(){return null===this.verticalData&&this.computeVerticalData(),this.verticalData},g.computeVerticalData=function(){var a=this.getStaticVerticalData(),b=this.getDynamicVerticalData();this.verticalData=[a,b].reduce(q),this.verticalData.chordsHeight=this.getChordsHeight()},g.getStaticVerticalData=function(){return null===this.staticVerticalData&&this.computeStaticVerticalData(),this.staticVerticalData},g.computeStaticVerticalData=function(){var a=[];for(var b in this.voices){var c=this.voices[b],d=c.getStaticVerticalData();a.push(d)}this.staticVerticalData=a.reduce(q)},g.getDynamicVerticalData=function(){return null===this.dynamicVerticalData&&this.computeDynamicVerticalData(),this.dynamicVerticalData},g.computeDynamicVerticalData=function(){var a=[];for(var b in this.voices){var c=this.voices[b],d=c.getDynamicVerticalData();a.push(d)}var e=p();this.dynamicVerticalData=a.reduce(q,e)};var p=function(){return{notesUpOverflow:0,notesDownOverflow:0,hasLyric:!1,lyricHeight:0}},q=function(a,b){return{notesUpOverflow:Math.max(a.notesUpOverflow,b.notesUpOverflow),notesDownOverflow:Math.max(a.notesDownOverflow,b.notesDownOverflow),hasLyric:a.hasLyric||b.hasLyric,lyricHeight:Math.max(a.lyricHeight,b.lyricHeight)}};g.updateHorizontalDisplay=function(){this.forEachVoice(r),this.directions.forEach(t),this.pizzicatos.forEach(t),this.words.forEach(t),this.chords.forEach(t)};var r=function(a){a.updateHorizontalDisplay()};g.updateVerticalDisplay=function(){this.forEachVoice(s),this.directions.forEach(t),this.pizzicatos.forEach(t),this.words.forEach(t),this.chords.forEach(t)};var s=function(a){a.updateVerticalDisplay()},t=function(a){a.move()};g.hasPizzicatosAbove=function(){return null===this.hasPizzicatosAboveValue&&this.calcHasPizzicatosAbove(),this.hasPizzicatosAboveValue},g.calcHasPizzicatosAbove=function(){this.hasPizzicatosAboveValue=this.pizzicatos.some(u)},g.hasPizzicatosBelow=function(){return null===this.hasPizzicatosBelowValue&&this.calcHasPizzicatosBelow(),this.hasPizzicatosBelowValue},g.calcHasPizzicatosBelow=function(){this.hasPizzicatosBelowValue=this.pizzicatos.some(w)},g.hasWordsAbove=function(){return null===this.hasWordsAboveValue&&this.calcHasWordsAbove(),this.hasWordsAboveValue},g.calcHasWordsAbove=function(){this.hasWordsAboveValue=this.words.some(u)},g.hasWordsBelow=function(){return null===this.hasWordsBelowValue&&this.calcHasWordsBelow(),this.hasWordsBelowValue},g.calcHasWordsBelow=function(){this.hasWordsBelowValue=this.words.some(w)},g.hasDynamicsAbove=function(){return null===this.hasDynamicsAboveValue&&this.calcHasDynamicsAbove(),this.hasDynamicsAboveValue},g.calcHasDynamicsAbove=function(){this.hasDynamicsAboveValue=this.directions.some(u)},g.hasOctaveShiftsAbove=function(){return null===this.hasOctaveShiftsAboveValue&&this.calcHasOctaveShiftsAbove(),this.hasOctaveShiftsAboveValue},g.calcHasOctaveShiftsAbove=function(){this.hasOctaveShiftsAboveValue=this.hasLeftOctaveShiftAnchor()&&u(this.getLeftOctaveShiftAnchor())||this.hasRightOctaveShiftAnchor()&&u(this.getRightOctaveShiftAnchor())||this.middleOctaveShiftsAnchors.some(u)},g.hasOctaveShiftsBelow=function(){return null===this.hasOctaveShiftsBelowValue&&this.calcHasOctaveShiftsBelow(),this.hasOctaveShiftsBelowValue},g.calcHasOctaveShiftsBelow=function(){this.hasOctaveShiftsBelowValue=this.hasLeftOctaveShiftAnchor()&&w(this.getLeftOctaveShiftAnchor())||this.hasRightOctaveShiftAnchor()&&w(this.getRightOctaveShiftAnchor())||this.middleOctaveShiftsAnchors.some(w)};var u=function(a){return a.isAbove()};g.hasWedgeAbove=function(){return this.getAllWedgesAnchors().some(v)};var v=function(a){return a.hasWedge()&&a.isAbove()};g.hasDynamicsBelow=function(){return null===this.hasDynamicsBelowValue&&this.calcHasDynamicsBelow(),this.hasDynamicsBelowValue},g.calcHasDynamicsBelow=function(){this.hasDynamicsBelowValue=this.directions.some(w)};var w=function(a){return a.isBelow()};g.hasWedgeBelow=function(){return this.getAllWedgesAnchors().some(x)};var x=function(a){return a.hasWedge()&&a.isBelow()};g.getChordsHeight=function(){if(null===this.chordsHeight){var a=this.chords.map(y);this.chordsHeight=a.reduce(c.max2,0)}return this.chordsHeight};var y=function(a){return a.getHeight()};g.getNote=function(a,b){return this.getVoice(a).getNote(b)},g.getVoice=function(b){if(this.hasVoice(b))return this.voices[b];throw new a("BadVoiceIdx","Bad voice idx ["+b+"] in drawer.")},g.hasVoice=function(b){if(!c.isInteger(b))throw new a("BadVoiceIdx","Bad voice idx: ["+b+"].");return void 0!==this.voices[b]},g.forEachVoice=function(a,b){for(var c=this.getNbVoices(),d=0;d<c;d++){var e=this.voicesIndexes[d],f=this.voices[e];a.call(b,f,e)}},g.hasRightTieAnchor=function(a){if(this.hasVoice(a)){return this.getVoice(a).hasRightTieAnchor()}return!1},g.getRightTieAnchor=function(a){return this.getVoice(a).getRightTieAnchor()},g.hasLeftTieAnchor=function(a){if(this.hasVoice(a)){return this.getVoice(a).hasLeftTieAnchor()}return!1},g.getLeftTieAnchor=function(a){return this.getVoice(a).getLeftTieAnchor()},g.hasRightHyphenAnchor=function(a){if(this.hasVoice(a)){return this.getVoice(a).hasRightHyphenAnchor()}return!1},g.getRightHyphenAnchor=function(a){return this.getVoice(a).getRightHyphenAnchor()},g.hasLeftHyphenAnchor=function(a){if(this.hasVoice(a)){return this.getVoice(a).hasLeftHyphenAnchor()}return!1},g.getLeftHyphenAnchor=function(a){return this.getVoice(a).getLeftHyphenAnchor()},g.hasRightHammerOnPullOffAnchor=function(a){if(this.hasVoice(a)){return this.getVoice(a).hasRightHammerOnPullOffAnchor()}return!1},g.getRightHammerOnPullOffAnchor=function(a){return this.getVoice(a).getRightHammerOnPullOffAnchor()},g.hasLeftHammerOnPullOffAnchor=function(a){if(this.hasVoice(a)){return this.getVoice(a).hasLeftHammerOnPullOffAnchor()}return!1},g.getLeftHammerOnPullOffAnchor=function(a){return this.getVoice(a).getLeftHammerOnPullOffAnchor()},g.hasRightGlissandoAnchor=function(a){if(this.hasVoice(a)){return this.getVoice(a).hasRightGlissandoAnchor()}return!1},g.getRightGlissandoAnchor=function(a){return this.getVoice(a).getRightGlissandoAnchor()},g.hasLeftGlissandoAnchor=function(a){if(this.hasVoice(a)){return this.getVoice(a).hasLeftGlissandoAnchor()}return!1},g.getLeftGlissandoAnchor=function(a){return this.getVoice(a).getLeftGlissandoAnchor()},g.hasRightSlurAnchor=function(a){if(this.hasVoice(a)){return this.getVoice(a).hasRightSlurAnchor()}return!1},g.getRightSlurAnchor=function(a){return this.getVoice(a).getRightSlurAnchor()},g.hasLeftSlurAnchor=function(a){if(this.hasVoice(a)){return this.getVoice(a).hasLeftSlurAnchor()}return!1},g.getLeftSlurAnchor=function(a){return this.getVoice(a).getLeftSlurAnchor()},g.getMiddleSlursAnchors=function(a){if(this.hasVoice(a)){return this.getVoice(a).getMiddleSlursAnchors()}return[]},g.getAllSlursAnchors=function(a){if(this.hasVoice(a)){return this.getVoice(a).getAllSlursAnchors()}return[]},g.getAllWedgesAnchors=function(){var a=this.middleWedgesAnchors.slice();return this.hasLeftWedgeAnchor()&&a.push(this.getLeftWedgeAnchor()),this.hasRightWedgeAnchor()&&a.push(this.getRightWedgeAnchor()),a},g.hasRightWedgeAnchor=function(){return null!==this.rightWedgeAnchor},g.getRightWedgeAnchor=function(){return this.rightWedgeAnchor},g.hasLeftWedgeAnchor=function(){return null!==this.leftWedgeAnchor},g.getLeftWedgeAnchor=function(){return this.leftWedgeAnchor},g.getMiddleWedgesAnchors=function(){return this.middleWedgesAnchors},g.getAllOctaveShiftsAnchors=function(){var a=this.middleOctaveShiftsAnchors.slice();return this.hasLeftOctaveShiftAnchor()&&a.push(this.getLeftOctaveShiftAnchor()),this.hasRightOctaveShiftAnchor()&&a.push(this.getRightOctaveShiftAnchor()),a},g.hasRightOctaveShiftAnchor=function(){return null!==this.rightOctaveShiftAnchor},g.getRightOctaveShiftAnchor=function(){return this.rightOctaveShiftAnchor},g.hasLeftOctaveShiftAnchor=function(){return null!==this.leftOctaveShiftAnchor},g.getLeftOctaveShiftAnchor=function(){return this.leftOctaveShiftAnchor},g.getMiddleOctaveShiftsAnchors=function(){return this.middleOctaveShiftsAnchors},g.getDpq=function(){return this.dpq},g.getNbDivisions=function(){return this.nbDivisions},g.getStaffData=function(){return this.staffData},g.getOrderedVoices=function(){for(var a=[],b=this.getNbVoices(),c=0;c<b;c++){var d=this.voicesIndexes[c],e=this.getVoice(d);a.push(e)}return a},g.getNbVoices=function(){return this.voicesIndexes.length}}.call(this),function(){"use strict";Adagio.Values.HorizontalPosition={WEDGE_START:2,DYNAMIC:1,WEDGE_STOP:0}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Brush.Elem,c=Adagio.Values.DirectionPlacement,d=Adagio.Values.HorizontalPosition,e=Adagio.Drawer.Dynamics=function(a,b,c){this.init(a,b,c)};e.cssClass="dynamic";var f=e.prototype;f.cssClass=e.cssClass,Adagio.Drawer.Dynamics.values=["p","pp","ppp","pppp","ppppp","pppppp","f","ff","fff","ffff","fffff","ffffff","mp","mf","sf","sfp","sfpp","fp","rf","rfz","sfz","sffz","fz"];var g={p:.85,f:.6,m:.95,r:.7,s:.9,z:1},h={p:"dynamicPiano",f:"dynamicForte",m:"dynamicMezzo",r:"dynamicRinforzando",s:"dynamicSforzando",z:"dynamicZ"},i=function(b){if(void 0===h[b]){throw new a("BadDynamicLetter","Dynamic letter not supported: ["+b+"].")}return h[b]};f.init=function(a,b,c){this.list=j(b),this.style=b,this.placement=a,this.timePos=c,this.drawingContext=null,this.horizontalOffset=0,this.xPos=null,this.yPos=null,this.width=null,this.parent=null,this.group=null};var j=function(a){for(var b=[],c=a.length,d=0;d<c;d++){var e=a.charAt(d),f=i(e),g={dynamicLetter:e,glyphId:f,glyph:null,path:null,pos:null};b.push(g)}return b};f.setParent=function(a){this.parent=a},f.getWidth=function(){return this.areGlyphesLoaded()||this.loadGlyphes(),this.width},f.getHeight=function(){var a=this.getHeights();return Math.max.apply(null,a)},f.getHeights=function(){return this.areGlyphesLoaded()||this.loadGlyphes(),this.list.map(k)};var k=function(a){return a.glyph.getHeight()};f.areGlyphesLoaded=function(){return null!==this.width},f.loadGlyphes=function(){this.width=this.list.reduce(this.loadGlyph.bind(this),0)},f.loadGlyph=function(a,b,c,d){if(c>0){var e=d[c-1];"m"===e.dynamicLetter&&"f"===b.dynamicLetter&&(a-=.2*e.glyph.getWidth())}return b.pos=a,b.glyph=this.drawingContext.getGlyph(b.glyphId),a+b.glyph.getWidth()*g[b.dynamicLetter]},f.render=function(a){this.drawingContext=a,this.areGlyphesLoaded()||(this.loadGlyphes(),this.calcOpticalCenter()),this.group=new b("g"),this.group.attr("class",this.cssClass),this.list.forEach(this.renderEntry,this)},f.calcOpticalCenter=function(){var a=this.list[0],b=this.list.length,c=this.list[b-1],d=a.pos+a.glyph.getOpticalCenter().x,e=c.pos+c.glyph.getOpticalCenter().x;this.opticalCenter=(e-d)/2},f.renderEntry=function(a){var b=this.group.append("path");b.attr("d",a.glyph.render());var c=a.pos,d=this.drawingContext.getDynamicsMiddle();b.attr("transform","translate("+c+", "+d+")"),a.path=b},f.setPosX=function(a){this.xPos=a},f.setHorizontalOffset=function(a){this.horizontalOffset=a},f.setPosY=function(a){this.yPos=a},f.draw=function(){this.needRender()&&this.render(),this.move(),this.bindToParent()},f.needRender=function(){return null===this.group},f.bindToParent=function(){this.parent.append(this.group)},f.move=function(){var a=this.xPos+this.horizontalOffset-this.opticalCenter;null!==this.xPos&&null!==this.yPos&&this.group.attr("transform","translate("+a+", "+this.yPos+")")},f.unbindFromParent=function(){this.group.removeFromParent()},f.getHorizontalPosition=function(){return d.DYNAMIC},f.getDrawingContext=function(){return this.drawingContext},f.getTimePos=function(){return this.timePos},f.getTimePosition=function(){return this.timePos},f.getGroup=function(){return this.group},f.getDirectionType=function(){return"dynamics"},f.setCssClass=function(a){this.cssClass=a},f.isAbove=function(){return this.getPlacement()===c.ABOVE},f.isBelow=function(){return this.getPlacement()===c.BELOW},f.getPlacement=function(){return this.placement}}.call(this),function(){"use strict";var a=Adagio.Values.DirectionPlacement,b=Adagio.Values.PizzicatoType,c=Adagio.Drawer.Text,d=Adagio.Drawer.Pizzicato=function(a,b,c){this.init(a,b,c)};d.cssClass="pizzicato";var e=d.prototype;e.cssClass=d.cssClass,e.init=function(a,b,c){this.type=b,this.placement=a,this.timePos=c,this.drawingContext=null,this.horizontalOffset=0,this.xPos=null,this.yPos=null,this.parent=null,this.text=null},e.setParent=function(a){this.parent=a,null!==this.text&&this.text.setParent(a)},e.getWidth=function(){return this.text.getWidth()},e.getSpaceAbove=function(){return this.drawingContext.getPizzicatoFontSize()},e.getSpaceBelow=function(){return this.drawingContext.getPizzicatoFontSize()/2},e.render=function(a){this.drawingContext=a;var e={};e["font-size"]=a.getPizzicatoFontSize(),e["font-family"]=a.getPizzicatoFontFamily(),e["font-style"]=a.getPizzicatoFontStyle();var f=b.getText(this.type);e.text=f,this.text=new c(e),null!==this.parent&&this.text.setParent(this.parent),this.text.setDrawingContext(a),this.text.render(),this.text.setCssClass(d.cssClass)},e.setCssClass=function(a){this.text.setCssClass(a)},e.setPosX=function(a){this.xPos=a,this.text.setXPos(this.xPos+this.horizontalOffset)},e.setHorizontalOffset=function(a){this.horizontalOffset=a,this.text.setXPos(this.xPos+this.horizontalOffset)},e.setPosY=function(a){this.yPos=a,this.text.setYPos(this.yPos)},e.draw=function(){this.needRender()&&this.render(),this.text.draw()},e.needRender=function(){return null===this.text},e.move=function(){this.text.move()},e.getDrawingContext=function(){return this.drawingContext},e.getTimePos=function(){return this.timePos},e.isAbove=function(){return this.getPlacement()===a.ABOVE},e.isBelow=function(){return this.getPlacement()===a.BELOW},e.getPlacement=function(){return this.placement},e.getText=function(){return this.text},e.unbindFromParent=function(){this.text.hide()}}.call(this),function(){"use strict";var a=Adagio.Values.DirectionPlacement,b=Adagio.Drawer.Text,c=Adagio.Drawer.Word=function(a,b,c){this.init(a,b,c)};c.cssClass="word";var d=c.prototype;d.cssClass=c.cssClass,d.init=function(a,b,c){this.textString=b,this.placement=a,this.timePos=c,this.drawingContext=null,this.horizontalOffset=0,this.xPos=null,this.yPos=null,this.parent=null,this.text=null},d.setParent=function(a){this.parent=a,null!==this.text&&this.text.setParent(a)},d.getWidth=function(){return this.text.getWidth()},d.getSpaceAbove=function(){return this.drawingContext.getWordFontSize()},d.getSpaceBelow=function(){return this.drawingContext.getWordFontSize()/2},d.render=function(a){this.drawingContext=a;var d={};d["font-size"]=a.getWordFontSize(),d["font-family"]=a.getWordFontFamily(),d.text=this.textString,this.text=new b(d),null!==this.parent&&this.text.setParent(this.parent),this.text.setDrawingContext(a),this.text.render(),this.text.setCssClass(c.cssClass)},d.setPosX=function(a){this.xPos=a,this.text.setXPos(this.xPos+this.horizontalOffset)},d.setHorizontalOffset=function(a){this.horizontalOffset=a,this.text.setXPos(this.xPos+this.horizontalOffset)},d.setPosY=function(a){this.yPos=a,this.text.setYPos(this.yPos)},d.draw=function(){this.needRender()&&this.render(),this.text.draw()},d.needRender=function(){return null===this.text},d.move=function(){this.text.move()},d.getDrawingContext=function(){return this.drawingContext},d.getTimePos=function(){return this.timePos},d.isAbove=function(){return this.getPlacement()===a.ABOVE},d.isBelow=function(){return this.getPlacement()===a.BELOW},d.getPlacement=function(){return this.placement}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Brush.Elem,c=Adagio.Values.DirectionPlacement,d=Adagio.Values.HorizontalPosition,e=Adagio.Values.PedalType,f=Adagio.Utils.typeUtils,g=Adagio.Drawer.Pedal=function(a,b,c){this.init(a,b,c)};g.cssClass="pedal";var h=g.prototype;h.cssClass=g.cssClass;var i=f.pairsToMap([{key:e.START,value:"keyboardPedalPed"},{key:e.STOP,value:"keyboardPedalUp"}]),j={keyboardPedalPed:.75,keyboardPedalUp:1},k=function(b){if(void 0===i[b]){throw new a("BadPedalType","Pedal type not supported: ["+b+"].")}return i[b]};h.init=function(a,b,c){this.type=a,this.placement=b,this.timePos=c,this.glyph=null,this.drawingContext=null,this.horizontalOffset=0,this.xPos=null,this.yPos=null,this.width=null,this.parent=null,this.group=null},h.setParent=function(a){this.parent=a},h.getGlyph=function(){if(null===this.glyph){var a=k(this.type);this.glyph=this.drawingContext.getGlyph(a)}return this.glyph},h.getCoeff=function(){var a=k(this.type);return j[a]},h.getWidth=function(){var a=this.getGlyph(),b=this.getCoeff();return a.getWidth()*b},h.getHeight=function(){var a=this.getGlyph(),b=this.getCoeff();return a.getHeight()*b},h.render=function(a){this.drawingContext=a,this.group=new b("g"),this.group.attr("class",this.cssClass);var c=this.getGlyph(),d=this.group.append("path"),e=this.getCoeff();d.attr("d",c.render()),d.attr("transform","scale("+e+")")},h.setPosX=function(a){this.xPos=a},h.setHorizontalOffset=function(a){this.horizontalOffset=a},h.setPosY=function(a){this.yPos=a},h.draw=function(){this.needRender()&&this.render(),this.move(),this.bindToParent()},h.needRender=function(){return null===this.group},h.bindToParent=function(){this.parent.append(this.group)},h.move=function(){var a=this.xPos+this.horizontalOffset;a+=this.getOffset(),null!==this.xPos&&null!==this.yPos&&this.group.attr("transform","translate("+a+", "+this.yPos+")")},h.getOffset=function(){if(this.type===e.START)return 0;if(this.type===e.STOP)return-this.drawingContext.getSpaceSize();throw new a("Unexpected")},h.unbindFromParent=function(){this.group.removeFromParent()},h.getHorizontalPosition=function(){return d.DYNAMIC},h.getDrawingContext=function(){return this.drawingContext},h.getTimePos=function(){return this.timePos},h.getTimePosition=function(){return this.timePos},h.getGroup=function(){return this.group},h.getDirectionType=function(){return"pedal"},h.setCssClass=function(a){this.cssClass=a},h.isAbove=function(){return this.getPlacement()===c.ABOVE},h.isBelow=function(){return this.getPlacement()===c.BELOW},h.getPlacement=function(){return this.placement}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError;(Adagio.Values.Stem={DOWN:"down",UP:"up",DOUBLE:"double",NONE:"none"}).raiseError=function(b){throw new a("BadStemValue","Invalid stem value: ["+b+"].")}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Brush.Elem,c=Adagio.Utils.math,d=Adagio.Utils.staffDataUtils,e=Adagio.Utils.mapUtils,f=Adagio.Values.TickableType,g=Adagio.Drawer.VoiceDrawer=function(a){this.init(a)};g.cssClass="voice voice-";var h=g.prototype;h.cssClass=g.cssClass,h.init=function(a){this.voiceIdx=a,this.notes=[],this.beams=[],this.graceBeams=[],this.tuplets=[],this.graces={},this.internalTies=[],this.leftTieAnchor=null,this.rightTieAnchor=null,this.internalHyphens=[],this.leftHyphenAnchor=null,this.rightHyphenAnchor=null,this.internalHammerOnPullOffs=[],this.leftHammerOnPullOffAnchor=null,this.rightHammerOnPullOffAnchor=null,this.leftGlissandoAnchor=null,this.rightGlissandoAnchor=null,this.glissandos=[],this.leftSlurAnchor=null,this.rightSlurAnchor=null,this.middleSlursAnchors=[],this.drawingContext=null,this.staffData=null,this.horizontalData=null,this.horizontalFormatter=null,this.staticVerticalData=null,this.dynamicVerticalData=null,this.verticalFormatting=null,this.nbDivisions=null,this.dpq=null,this.group=new b("g"),this.group.attr("class",this.cssClass+a),this.parent=null},h.setParent=function(a){this.parent=a},h.setStaffData=function(a){this.staffData=a,this.tuplets.forEach(this.transferStaffData,this)},h.transferStaffData=function(a){a.setStaffData(this.staffData)},h.addNote=function(a){a.setParent(this.group),this.notes.push(a)},h.addNoteGraces=function(a,b){this.graces[a]=b},h.setDpq=function(a){this.dpq=a},h.setNbDivisions=function(a){this.nbDivisions=a},h.addTie=function(a){a.setParent(this.group),this.internalTies.push(a)},h.addHyphen=function(a){a.setParent(this.group),this.internalHyphens.push(a)},h.addTuplet=function(a){a.setParent(this.group),this.tuplets.push(a)},h.addBeam=function(a){a.setParent(this.group),this.beams.push(a)},h.addGraceBeam=function(a,b){var c=this.getNote(b),d=c.getGroup();a.setParent(d),this.graceBeams.push(a)},h.addHammerOnPullOff=function(a){a.setParent(this.group),this.internalHammerOnPullOffs.push(a)},h.setRightTieAnchor=function(a){this.rightTieAnchor=a},h.setLeftTieAnchor=function(a){this.leftTieAnchor=a},h.setRightHyphenAnchor=function(a){this.rightHyphenAnchor=a},h.setLeftHyphenAnchor=function(a){this.leftHyphenAnchor=a},h.setRightSlurAnchor=function(a){this.rightSlurAnchor=a},h.setLeftSlurAnchor=function(a){this.leftSlurAnchor=a},h.addMiddleSlurAnchor=function(a){this.middleSlursAnchors.push(a)},h.setRightGlissandoAnchor=function(a){this.rightGlissandoAnchor=a},h.setLeftGlissandoAnchor=function(a){this.leftGlissandoAnchor=a},h.setRightHammerOnPullOffAnchor=function(a){this.rightHammerOnPullOffAnchor=a},h.setLeftHammerOnPullOffAnchor=function(a){this.leftHammerOnPullOffAnchor=a},h.addGlissando=function(a){a.setParent(this.group),this.glissandos.push(a)},h.render=function(a){this.drawingContext=a,this.notes.forEach(this.renderNote,this),this.forEachGrace(this.renderEntity,this),this.internalTies.forEach(this.transferDrawingContext,this),this.internalHyphens.forEach(this.transferDrawingContext,this),this.beams.forEach(this.transferDrawingContext,this),this.graceBeams.forEach(this.transferDrawingContext,this),this.tuplets.forEach(this.transferDrawingContext,this),this.glissandos.forEach(this.transferDrawingContext,this),this.internalHammerOnPullOffs.forEach(this.transferDrawingContext,this)},h.renderNote=function(a,b){if(a.render(this.drawingContext),this.hasNoteGraces(b)){var c=this.getNoteGraces(b),d=a.getGroup();c.forEach(i,d)}};var i=function(a){var b=this;a.setParent(b)};h.renderEntity=function(a){a.render(this.drawingContext)},h.transferDrawingContext=function(a){a.setDrawingContext(this.drawingContext)},h.getHorizontalData=function(){return null===this.horizontalData&&this.computeHorizontalData(),this.horizontaldata},h.computeHorizontalData=function(){var a=this.getDpq(),b=this.getNbDivisions(),c=this.notes.map(this.extractNoteHorizontalData,this);this.horizontaldata={dpq:a,entities:c,nbDivisions:b,type:f.NOTE}},h.extractNoteHorizontalData=function(a,b){var c=a.getDuration(),d=a.calcLeadingSpace(),e=a.getTimePos();if(this.hasNoteGraces(b)){d+=this.computeNoteGracesHorizontalSpace(b)}return{timePos:e,duration:c,spaceBefore:d,spaceAfter:a.getMiddleHeadWidth()+a.calcTrailingSpace(),isRest:a.isRest()}},h.computeNoteGracesHorizontalSpace=function(a){var b=this.getNoteGraces(a),d=this.drawingContext.getGraceSizeCoeff(),e=this.drawingContext.getMarginSize()*d,f=b.length;return b.map(j).reduce(c.add,0)+f*e};var j=function(a){return a.calcLeadingSpace()+a.getMiddleHeadWidth()+a.calcTrailingSpace()};h.setHorizontalFormatter=function(a){this.horizontalFormatter=a,this.verticalData=null,this.dynamicVerticalData=null},h.formatHorizonal=function(){this.formatNotesHorizontal(),this.beams.forEach(l),this.graceBeams.forEach(l),this.tuplets.forEach(l),this.internalTies.forEach(m),this.internalHyphens.forEach(k),this.setCrossMeasuresNeedDrawUpdate(),this.glissandos.forEach(n),this.internalHammerOnPullOffs.forEach(m)};var k=function(a){a.updateHorizontalDisplay()},l=function(a){a.updateConnections()},m=function(a){a.updateArcs()},n=function(a){a.updateGlissandos()};h.formatNotesHorizontal=function(){if(this.hasSingleRest())this.formatSingleRest();else for(var a=this.notes.length,b=0;b<a;b++){var c=this.notes[b],d=c.getTimePos(),e=this.timePosToX(d);if(c.setPosition(e),this.hasNoteGraces(b)){var f=c.calcLeadingSpace(b);this.formatNoteGracesHorizontal(b,-f)}}},h.formatNoteGracesHorizontal=function(a,b){var c=this.drawingContext.getGraceSizeCoeff(),d=this.drawingContext.getMarginSize()*c,e=this.getNoteGraces(a),f=e.length;b-=d;for(var g=f-1;g>=0;g--){var h=e[g];b-=h.calcTrailingSpace()+h.getMiddleHeadWidth(),h.setPosition(b);b-=h.calcLeadingSpace()+d}},h.timePosToX=function(a){var b=this.getDpq();return this.horizontalFormatter.getPosX(a,b)},h.hasSingleRest=function(){return 1===this.notes.length&&this.notes[0].isRest()},h.formatSingleRest=function(){var a=this.notes[0],b=this.horizontalFormatter.getMiddlePos(),c=a.getMiddleHeadWidth()+a.calcTrailingSpace(),d=b-c/2;a.setPosition(d)},h.getWidth=function(){return this.horizontalFormatter.getWidth()},h.setVerticalFormatting=function(a){this.verticalFormatting=a},h.formatVertical=function(){this.formatNotesVertical(),this.internalHyphens.forEach(o)},h.formatNotesVertical=function(){this.notes.forEach(this.formatNoteVertical,this)},h.formatNoteVertical=function(a){if(a.hasLyric()){var b=this.verticalFormatting.getLyricsY();a.setLyricUpY(b)}};var o=function(a){a.updateVerticalDisplay()};h.draw=function(){this.notes.forEach(p),this.forEachGrace(p),this.internalTies.forEach(p),this.internalHyphens.forEach(p),this.beams.forEach(p),this.graceBeams.forEach(p),this.tuplets.forEach(p),this.glissandos.forEach(p),this.internalHammerOnPullOffs.forEach(p),this.bindToParent()},h.drawLyrics=function(){
this.notes.forEach(function(a){a.drawLyric()}),this.bindToParent()},h.bindToParent=function(){this.parent.append(this.group)};var p=function(a){a.draw(a)};h.setCrossMeasuresNeedDrawUpdate=function(){var a,b;this.hasLeftTieAnchor()&&(a=this.getLeftTieAnchor(),a.setNeedDrawUpdate()),this.hasRightTieAnchor()&&(b=this.getRightTieAnchor(),b.setNeedDrawUpdate()),this.hasLeftHyphenAnchor()&&(a=this.getLeftHyphenAnchor(),a.setNeedDrawUpdate()),this.hasRightHyphenAnchor()&&(b=this.getRightHyphenAnchor(),b.setNeedDrawUpdate()),this.hasLeftHammerOnPullOffAnchor()&&(a=this.getLeftHammerOnPullOffAnchor(),a.setNeedDrawUpdate()),this.hasRightHammerOnPullOffAnchor()&&(b=this.getRightHammerOnPullOffAnchor(),b.setNeedDrawUpdate()),this.getAllSlursAnchors().forEach(q)};var q=function(a){a.setNeedDrawUpdate()};h.purgeCrossMeasures=function(){if(this.hasLeftTieAnchor()){var a=this.getLeftTieAnchor();a.hasTie()&&a.removeTie()}if(this.hasRightTieAnchor()){var b=this.getRightTieAnchor();b.hasTie()&&b.removeTie()}if(this.hasLeftHyphenAnchor()){var c=this.getLeftHyphenAnchor();c.hasHyphen()&&c.removeHyphen()}if(this.hasRightHyphenAnchor()){var d=this.getRightHyphenAnchor();d.hasHyphen()&&d.removeHyphen()}if(this.hasLeftHammerOnPullOffAnchor()){var e=this.getLeftHammerOnPullOffAnchor();e.hasHammerOnPullOff()&&e.removeHammerOnPullOff()}if(this.hasRightHammerOnPullOffAnchor()){var f=this.getRightHammerOnPullOffAnchor();f.hasHammerOnPullOff()&&f.removeHammerOnPullOff()}this.getAllSlursAnchors().forEach(r)};var r=function(a){a.hasSlur()&&a.removeSlur()};h.drawCursor=function(a,b){var c=this.getNote(a.noteIdx),d=c.getXPos();b.setPosition(d),b.move(),b.setParent(this.group)},h.drawGraceCursor=function(a,b){var c=this.getNoteGraces(a.noteIdx),d=c[a.graceIdx],e=this.getNote(a.noteIdx),f=e.getXPos();f+=d.getXPos(),b.setPosition(f),b.move(),b.setParent(this.group)},h.drawDynamicCursor=function(a,b){var c=this.getNote(a.noteIdx),d=c.getXPos();b.setPosition(d),b.setParent(this.group),b.draw()},h.drawPizzicatoCursor=function(a,b){var c=this.getNote(a.noteIdx),d=c.getXPos();b.setPosition(d),b.setParent(this.group),b.draw()},h.drawSlurCursor=function(a,b){var c=this.notes.slice(a.startNoteIdx,a.stopNoteIdx+1);b.setParent(this.group),b.update(c)},h.getNoteX=function(a){return this.getNote(a).getXPos(a)},h.getNbNotes=function(){return this.notes.length},h.getPreviousSpace=function(){return this.horizontalFormatter.getAlignmentSpace()},h.getStaticVerticalData=function(){return null===this.staticVerticalData&&this.computeStaticVerticalData(),this.staticVerticalData},h.computeStaticVerticalData=function(){var a=this.notes.map(this.extractNoteVerticalData,this),b=this.tuplets.map(this.extractTupletVerticalData,this),c=[].concat(a,b);this.staticVerticalData=c.reduce(t)},h.extractNoteVerticalData=function(a){var b=a.getYInfos(),c=-b.highestY;c=Math.max(c,0);var d=this.getStaffHeight(),e=b.lowestY-d;e=Math.max(e,0);var f=a.hasLyric(),g=0;return f&&(g=a.getLyricHeight()),{notesUpOverflow:c,notesDownOverflow:e,hasLyric:f,lyricHeight:g}},h.extractTupletVerticalData=function(a){var b=a.getTopY(),c=a.getBottomY(),d=this.getStaffHeight();return{notesUpOverflow:Math.max(-b,0),notesDownOverflow:Math.max(c-d,0),hasLyric:!1,lyricHeight:0}},h.getDynamicVerticalData=function(){null===this.dynamicVerticalData&&this.computDynamicVerticalData();var a=this.getExternalTiesVerticalData(),b=t(a,this.dynamicVerticalData),c=this.getExternalHammerOnPullOffsVerticalData();return b=t(c,b)},h.computDynamicVerticalData=function(){var a=this.internalTies.map(this.extractTieVerticalData,this);a=a.concat(this.internalHammerOnPullOffs.map(this.extractTieVerticalData,this));var b=s();this.dynamicVerticalData=a.reduce(t,b)},h.getExternalTiesVerticalData=function(){var a=this.getExternalTies(),b=a.map(this.extractTieVerticalData,this),c=s();return b.reduce(t,c)},h.getExternalHammerOnPullOffsVerticalData=function(){var a=this.getExternalHammerOnPullOffs(),b=a.map(this.extractTieVerticalData,this),c=s();return b.reduce(t,c)},h.extractTieVerticalData=function(a){var b=a.getTopY(),c=Math.max(0,-b),d=a.getBottomY(),e=this.getStaffHeight();return{notesUpOverflow:c,notesDownOverflow:Math.max(0,d-e),hasLyric:!1,lyricHeight:0}};var s=function(){return{notesUpOverflow:0,notesDownOverflow:0,hasLyric:!1,lyricHeight:0}},t=function(a,b){return{notesUpOverflow:Math.max(a.notesUpOverflow,b.notesUpOverflow),notesDownOverflow:Math.max(a.notesDownOverflow,b.notesDownOverflow),hasLyric:a.hasLyric||b.hasLyric,lyricHeight:Math.max(a.lyricHeight,b.lyricHeight)}};h.updateHorizontalDisplay=function(){this.notes.forEach(w),this.notes.forEach(u),this.internalTies.forEach(u),this.internalHyphens.forEach(u),this.tuplets.forEach(u),this.internalHammerOnPullOffs.forEach(u)};var u=function(a){a.updateHorizontalDisplay()};h.updateVerticalDisplay=function(){this.notes.forEach(v),this.internalHyphens.forEach(v)};var v=function(a){a.updateVerticalDisplay()},w=function(a){a.move()};h.getStaffHeight=function(){var a=this.drawingContext.getSpaceSize();return(this.getNbStaffLines()-1)*a},h.getNbStaffLines=function(){var a=this.getStaffData();return d.getNbStaffLines(a)},h.getStaffData=function(){return null===this.staffData&&(this.staffData=d.createDefault()),this.staffData},h.getNote=function(b){var d=this.getNbNotes();if(!c.isInteger(b)||b<0||b>=d)throw new a("NoteIdx","Bad noteIdx ["+b+"] in drawer.");return this.notes[b]},h.getNoteGraces=function(a){return this.hasNoteGraces(a)?this.graces[a]:[]},h.hasNoteGraces=function(a){return void 0!==this.graces[a]},h.getDpq=function(){return this.dpq},h.getNbDivisions=function(){return this.nbDivisions},h.forEachGrace=function(a,b){e.forEach(this.graces,function(c,d){d.forEach(a,b)})},h.getExternalTies=function(){var a=[];if(this.hasLeftTieAnchor()){var b=this.getLeftTieAnchor();b.hasTie()&&a.push(b.getTie())}if(this.hasRightTieAnchor()){var c=this.getRightTieAnchor();c.hasTie()&&a.push(c.getTie())}return a},h.hasRightTieAnchor=function(){return null!==this.rightTieAnchor},h.getRightTieAnchor=function(){return this.rightTieAnchor},h.hasLeftTieAnchor=function(){return null!==this.leftTieAnchor},h.getLeftTieAnchor=function(){return this.leftTieAnchor},h.getAllSlursAnchors=function(){var a=this.middleSlursAnchors.slice();return this.hasLeftSlurAnchor()&&a.push(this.getLeftSlurAnchor()),this.hasRightSlurAnchor()&&a.push(this.getRightSlurAnchor()),a},h.hasRightSlurAnchor=function(){return null!==this.rightSlurAnchor},h.getRightSlurAnchor=function(){return this.rightSlurAnchor},h.hasLeftSlurAnchor=function(){return null!==this.leftSlurAnchor},h.getLeftSlurAnchor=function(){return this.leftSlurAnchor},h.getMiddleSlursAnchors=function(){return this.middleSlursAnchors},h.hasRightGlissandoAnchor=function(){return null!==this.rightGlissandoAnchor},h.getRightGlissandoAnchor=function(){return this.rightGlissandoAnchor},h.hasLeftGlissandoAnchor=function(){return null!==this.leftGlissandoAnchor},h.getLeftGlissandoAnchor=function(){return this.leftGlissandoAnchor},h.hasRightHyphenAnchor=function(){return null!==this.rightHyphenAnchor},h.getRightHyphenAnchor=function(){return this.rightHyphenAnchor},h.hasLeftHyphenAnchor=function(){return null!==this.leftHyphenAnchor},h.getLeftHyphenAnchor=function(){return this.leftHyphenAnchor},h.getExternalHammerOnPullOffs=function(){var a=[];if(this.hasLeftHammerOnPullOffAnchor()){var b=this.getLeftHammerOnPullOffAnchor();b.hasHammerOnPullOff()&&a.push(b.getHammerOnPullOff())}if(this.hasRightHammerOnPullOffAnchor()){var c=this.getRightHammerOnPullOffAnchor();c.hasHammerOnPullOff()&&a.push(c.getHammerOnPullOff())}return a},h.hasRightHammerOnPullOffAnchor=function(){return null!==this.rightHammerOnPullOffAnchor},h.getRightHammerOnPullOffAnchor=function(){return this.rightHammerOnPullOffAnchor},h.hasLeftHammerOnPullOffAnchor=function(){return null!==this.leftHammerOnPullOffAnchor},h.getLeftHammerOnPullOffAnchor=function(){return this.leftHammerOnPullOffAnchor},h.getVoiceIdx=function(){return this.voiceIdx}}.call(this),function(){"use strict";var a=Adagio.Utils.staffDetailsUtils,b=Adagio.Error.InternalError,c=Adagio.Utils.geometryUtils={};c.DEFAULT_NB_LINES=5,c.stringToY=function(a,c){if(a<1)throw new b("unexpected","Line has to be an integer above the value of 1");return(a-1)*c},c.lineToTabY=function(a,e,f,g){d(g);var h=g-a;if(a>=0&&a<=g+1)return c.lineToY(a,f,g);if(a>g+1)return(h+=1)*e-f;if(a<0)return h-=g,g*f+h*e;throw new b("Unexpected")},c.lineToY=function(a,b,c){return d(c),(c-a)*b},c.yToLine=function(a,b,c){return d(c),c-a/b};var d=function(c){if(!a.isNbStaffLinesValid(c)){throw new b("Unexpected","The number of staff lines ["+c+"] is invalid.")}}}.call(this),function(){"use strict";var a=3,b=Adagio.Drawer.AccidentalsTable=function(a,b){this.init(a,b)},c=b.prototype;c.init=function(a,b){this.minLine=a,this.columns=[],this.columnLength=2*(b-a)+1},c.getAvailableColumn=function(a,b){void 0===b&&(b=0);for(var c=b;!this.isAvailableColumn(c,a);)c++;return c},c.isAvailableColumn=function(a,b){return void 0===this.columns[a]||this.isAvailableLine(a,b)},c.isAvailableLine=function(a,b){return!!this.isLowerLinesAvailable(a,b)&&this.isThisAndHigherLinesAvailable(a,b)},c.isLowerLinesAvailable=function(b,c){var d=this.lineToIdx(c);d--;for(var e=d;e>=0&&d-e<a;e--)if(!this.isLineAvailable(b,e))return!1;return!0},c.isThisAndHigherLinesAvailable=function(b,c){for(var d=this.lineToIdx(c),e=d;e<this.columnLength&&e-d<a;e++)if(!this.isLineAvailable(b,e))return!1;return!0},c.isLineAvailable=function(a,b){return this.columns[a][b]},c.lineToIdx=function(a){return 2*(a-this.minLine)},c.makeSpaceTaken=function(a,b){void 0===this.columns[a]&&this.addColumn(),this.takeLowerLinesInColumn(a,b),this.takeThisAndHigherLinesInColumn(a,b)},c.addColumn=function(){for(var a=[],b=0;b<this.columnLength;b++)a.push(!0);this.columns.push(a)},c.takeLowerLinesInColumn=function(b,c){var d=this.lineToIdx(c);d--;for(var e=d;e>=0&&d-e<a;e--)this.makeLineTaken(b,e)},c.takeThisAndHigherLinesInColumn=function(b,c){for(var d=this.lineToIdx(c),e=d;e<this.columnLength&&e-d<a;e++)this.makeLineTaken(b,e)},c.makeLineTaken=function(a,b){this.columns[a][b]=!1}}.call(this),function(){"use strict";var a=Adagio.Drawer.AccidentalsScheduler=function(a){this.init(a)},b=a.prototype;b.init=function(a){this.accidentals=a,this.secondHighers=this.accidentals.filter(c),this.scheduledAccidentals=null,this.lowerProcessed=!1,this.higherProcessed=!1},b.getScheduledAccidentals=function(){return null===this.scheduledAccidentals&&this.calcScheduledAccidentals(),this.scheduledAccidentals},b.calcScheduledAccidentals=function(){this.scheduledAccidentals=[],this.scheduleSeconds(),this.scheduleOthers()},b.scheduleSeconds=function(){if(this.isHighestAccidentalSecondHigher()){var a=this.secondHighers[0];this.scheduleSecondHigher(a)}if(this.isLowestAccidentalSecondHigher()){var b=this.secondHighers.length-1,c=this.secondHighers[b];this.scheduleSecondHigher(c)}this.secondHighers.forEach(this.scheduleSecondHigher.bind(this))};var c=function(a){return!!a.secondHigher};b.isHighestAccidentalSecondHigher=function(){return 0!==this.secondHighers.length&&this.secondHighers[0]===this.accidentals[0]},b.isLowestAccidentalSecondHigher=function(){if(0===this.secondHighers.length)return!1;var a=this.secondHighers.length-1,b=this.accidentals.length-1,c=this.accidentals[b],d=this.secondHighers[a];if(d===c)return!0;if(this.accidentals.length<2)return!1;var e=this.accidentals.length-2;return d===this.accidentals[e]&&this.hasSecondLowerAccidental(d)},b.scheduleSecondHigher=function(a){if(this.scheduledAccidentals.push(a),this.hasSecondLowerAccidental(a)){a.hasSecondLowerAccidental=!0;var b=this.getSecondLowerAccidental(a);this.markAccidentalProcessed(b),this.scheduledAccidentals.push(b)}this.markAccidentalProcessed(a);var c=this.secondHighers.indexOf(a);this.secondHighers.splice(c,1)},b.hasSecondLowerAccidental=function(a){var b=this.accidentals.indexOf(a);if(b===this.accidentals.length-1)return!1;var c=this.accidentals[b+1];return a.line-c.line==.5},b.getSecondLowerAccidental=function(a){var b=this.accidentals.indexOf(a),c=b+1;return this.accidentals[c]},b.scheduleOthers=function(){if(this.hasFirst()){var a=this.accidentals[0];this.scheduleAccidental(a)}if(this.hasLast()){var b=this.accidentals.length-1,c=this.accidentals[b];this.scheduleAccidental(c)}this.accidentals.concat().forEach(this.scheduleAccidental.bind(this))},b.hasFirst=function(){return!this.higherProcessed&&this.accidentals.length>0},b.hasLast=function(){return!this.lowerProcessed&&this.accidentals.length>0},b.scheduleAccidental=function(a){this.scheduledAccidentals.push(a),this.markAccidentalProcessed(a)},b.markAccidentalProcessed=function(a){var b=this.accidentals.indexOf(a);0!==b||this.higherProcessed||(this.higherProcessed=!0),b!==this.accidentals.length-1||this.lowerProcessed||(this.lowerProcessed=!0),this.accidentals.splice(b,1)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Brush.Elem,c=Adagio.Utils.mapUtils,d=Adagio.Utils.geometryUtils,e=Adagio.Values.AccidentalStyle,f="accidentalParensLeft",g="accidentalParensRight",h=Adagio.Drawer.AccidentalDrawer=function(a,b){this.init(a,b)},i=h.prototype;i.init=function(a,b){this.list=j(a,b),this.drawingContext=null,this.displayData=null,this.width=null,this.line=null,this.posX=null,this.parent=null,this.group=null};var j=function(a,b){var c,d=[];return b&&(c={glyphName:f,glyph:null,path:null,pos:null},d.push(c)),c={glyphName:l(a),glyph:null,path:null,pos:null},d.push(c),b&&(c={glyphName:g,glyph:null,path:null,pos:null},d.push(c)),d},k=c.fromPairs([{key:e.SHARPSHARP,value:"accidentalDoubleSharp"},{key:e.DOUBLESHARP,value:"accidentalDoubleSharp"},{key:e.SHARP,value:"accidentalSharp"},{key:e.NATURAL,value:"accidentalNatural"},{key:e.FLAT,value:"accidentalFlat"},{key:e.FLATFLAT,value:"accidentalDoubleFlat"}]),l=function(a){return m(a),k[a]},m=function(b){if(void 0===k[b]){throw new a("FeatureNotSupported","the value "+b+" for accidentals is not supported")}};i.setParent=function(a){this.parent=a},i.setDrawingContext=function(a){this.drawingContext=a},i.setDisplayData=function(a){this.displayData=a},i.getWidth=function(){return this.areGlyphesLoaded()||this.loadGlyphes(),this.width},i.areGlyphesLoaded=function(){return null!==this.width},i.loadGlyphes=function(){this.width=this.list.reduce(this.loadGlyph.bind(this),0)},i.loadGlyph=function(a,b){return b.pos=a,b.glyph=this.drawingContext.getGlyph(b.glyphName),a+b.glyph.getWidth()},i.render=function(){this.areGlyphesLoaded()||this.loadGlyphes(),this.group=new b("g"),this.list.forEach(this.renderEntry,this)},i.renderEntry=function(a){var b=this.group.append("path");b.attr("d",a.glyph.render());var c=a.pos;b.attr("transform","translate("+c+", 0)"),a.path=b},i.setPosX=function(a){this.posX=a},i.setLine=function(a){this.line=a},i.draw=function(){this.needRender()&&this.render(),this.move(),this.bindToParent()},i.needRender=function(){return null===this.group},i.bindToParent=function(){this.parent.append(this.group)},i.move=function(){var a=this.getPosY();this.group.attr("transform","translate("+this.posX+", "+a+")")},i.getPosY=function(){var a=this.getSpaceSize(),b=this.displayData.getNbStaffLines();return d.lineToY(this.line,a,b)},i.getSpaceSize=function(){return this.displayData.isTabStaff()?this.drawingContext.getTabSpaceSize():this.drawingContext.getSpaceSize()},i.getGroup=function(){return this.group}}.call(this),function(){"use strict";var a=Adagio.Drawer.AccidentalsTable,b=Adagio.Drawer.AccidentalsScheduler,c=Adagio.Drawer.AccidentalDrawer,d=Adagio.Utils.math,e=Adagio.Drawer.AccidentalsDrawer=function(a){this.init(a)},f=e.prototype;f.init=function(a){this.displayData=a},f.canDraw=function(){return this.hasAccidental()&&!this.displayData.isTabStaff()},f.hasAccidental=function(){return this.displayData.hasAccidentals()},f.draw=function(a,c){this.renderedNote=a,this.svg=this.renderedNote.getGroup(),this.ctx=c;var d=this.displayData.getAccidentals();d.reverse();var e=new b(d),f=e.getScheduledAccidentals();g(f),this.fillDrawers(f);var h=j(f),i=this.getMarginSize()/2+h,k=this.getMarginSize()/2,l=0;k+=this.renderedNote.getLeftHeadWidth();for(var m=0;m<f.length;m++){var n=f[m],o=n.drawer;o.setParent(this.svg);var p=h-o.getWidth(),q=(n.column+1)*i-p,r=-q-k;o.setPosX(r),o.draw();var s=o.getGroup();this.renderedNote.addAccidental(s),l=Math.max(q,l)}this.renderedNote.setAccidentalsWidth(l)},f.getMarginSize=function(){if(this.displayData.isGrace()){var a=this.ctx.getGraceSizeCoeff();return this.ctx.getMarginSize()*a}return this.ctx.getMarginSize()},f.getGlyph=function(a){if(this.displayData.isGrace()){var b=this.ctx.getGraceSizeCoeff();return this.ctx.getScaledGlyph(a,b)}return this.ctx.getGlyph(a)};var g=function(b){for(var c=i(b),d=new a(c.min,c.max),e=0;e<b.length;e++){var f=b[e];if(h(d,f),f.hasSecondLowerAccidental){e++;var g=b[e],j=f.column+1;h(d,g,j)}}},h=function(a,b,c){var d=b.line,e=a.getAvailableColumn(d,c);a.makeSpaceTaken(e,d),b.column=e};f.fillDrawers=function(a){a.forEach(this.fillDrawer,this)},f.fillDrawer=function(a){var b=new c(a.accidental,a.parentheses);b.setDrawingContext(this.ctx),b.setDisplayData(this.displayData),b.setLine(a.line),a.drawer=b};var i=function(a){var b=null;return a.forEach(function(a){var c=a.line;null===b?b={min:c,max:c}:c>b.max?b.max=c:c<b.min&&(b.min=c)}),b},j=function(a){return a.map(k).reduce(d.max2)},k=function(a){return a.drawer.getWidth()}}.call(this),function(){"use strict";Adagio.Drawer.HeadSlot={LEFT:"left",RIGHT:"right",MIDDLE:"middle"}}.call(this),function(){"use strict";Adagio.Drawer.HeadDuration={WHOLE:"whole",HALF:"half",QUARTER:"quarter"}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Values.Notehead,c=Adagio.Drawer.HeadDuration,d=[{duration:c.WHOLE,head:b.NORMAL,glyphId:"noteheadWhole"},{duration:c.HALF,head:b.NORMAL,glyphId:"noteheadHalf"},{duration:c.QUARTER,head:b.NORMAL,glyphId:"noteheadBlack"},{duration:c.WHOLE,head:b.X,glyphId:"noteheadXWhole"},{duration:c.HALF,head:b.X,glyphId:"noteheadXHalf"},{duration:c.QUARTER,head:b.X,glyphId:"noteheadXBlack"},{duration:c.WHOLE,head:b.X_CIRCLE,glyphId:"noteheadCircleXWhole"},{duration:c.HALF,head:b.X_CIRCLE,glyphId:"noteheadCircleXHalf"},{duration:c.QUARTER,head:b.X_CIRCLE,glyphId:"noteheadCircleX"},{duration:c.WHOLE,head:b.DIAMOND,glyphId:"noteheadDiamondWhole"},{duration:c.HALF,head:b.DIAMOND,glyphId:"noteheadDiamondHalfWide"},{duration:c.QUARTER,head:b.DIAMOND,glyphId:"noteheadDiamondBlackWide"},{duration:c.WHOLE,head:b.SLASH,glyphId:"noteheadSlashWhiteWhole"},{duration:c.HALF,head:b.SLASH,glyphId:"noteheadSlashWhiteHalf"},{duration:c.QUARTER,head:b.SLASH,glyphId:"noteheadSlashHorizontalEnds"},{duration:c.WHOLE,head:b.TRIANGLE,glyphId:"noteheadTriangleUpWhole"},{duration:c.HALF,head:b.TRIANGLE,glyphId:"noteheadTriangleUpHalf"},{duration:c.QUARTER,head:b.TRIANGLE,glyphId:"noteheadTriangleUpBlack"},{duration:c.WHOLE,head:b.BACK_SLASHED,glyphId:"noteheadSlashedWhole2"},{duration:c.HALF,head:b.BACK_SLASHED,glyphId:"noteheadSlashedHalf2"},{duration:c.QUARTER,head:b.BACK_SLASHED,glyphId:"noteheadSlashedBlack2"}];Adagio.Drawer.getHeadGlyph=function(b,c){var f={notehead:b,headDuration:c},g=d.find(e,f);if(void 0===g){throw new a("NoHeadGlyph","there is no glyph id for the note head ["+b+"] and the duration ["+c+"]")}return g.glyphId};var e=function(a){return a.head===this.notehead&&a.duration===this.headDuration}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Drawer.HeadSlot,c=Adagio.Drawer.HeadDuration,d=Adagio.Drawer.getHeadGlyph,e=Adagio.Utils.geometryUtils,f=Adagio.Values.DurationType,g=Adagio.Values.Stem,h={4:"restWhole",2:"restHalf",1:"restQuarter",.5:"rest8th",.25:"rest16th",.125:"rest32nd",.0625:"rest64th"},i="noteheadParenthesis",j=Adagio.Drawer.HeadDrawer=function(a){this.init(a)};j.cssClass="head";var k=j.prototype;k.cssClass=j.cssClass,k.init=function(a){this.baseQuarterDuration=a.getBaseQuarterDuration(),this.displayData=a,this.glyphId=null,this.headGlyph=null,this.renderedNote=null,this.leftHeads=[],this.middleHeads=[],this.rightHeads=[],this.middleWidth=null,this.baseHead=null,this.baseLine=null,this.leftOffset=0,this.rightOffset=0},k.canDraw=function(){return!this.displayData.isTabStaff()},k.draw=function(a,b){this.renderedNote=a,this.ctx=b,this.baseLine=this.displayData.getFrontHeadLine(),this.createHeads(),this.fillGlyphes(),this.initStemPosition(),this.drawHeads(),this.fillRenderedNoteData()},k.createHeads=function(){this.displayData.isRest()?this.createRestHead():this.createSoundHeads()},k.createRestHead=function(){var a=l(this.baseQuarterDuration),c=this.displayData.getLines()[0];this.addHead(c,a,b.MIDDLE,"")};var l=function(b){var c=h[b];if(void 0===c){throw new a("NoRestGlyph","There is no rest glyph for the quarter duration ["+b+"].")}return c};k.createSoundHeads=function(){this.initHeadDuration(),this.displayData.getHeads().forEach(this.createSoundHead,this)},k.initHeadDuration=function(){this.isWhole()?this.headDuration=c.WHOLE:this.isHalf()?this.headDuration=c.HALF:this.headDuration=c.QUARTER},k.isWhole=function(){var a=f.toQuarterDuration(f.FULL);return this.baseQuarterDuration===a},k.isHalf=function(){var a=f.toQuarterDuration(f.HALF);return this.baseQuarterDuration===a},k.createSoundHead=function(a){var b=a.notehead,c=d(b,this.headDuration),e=a.line,f=this.getSlot(e),g=a.cssClassesStr,h=a.hasParentheses;this.addHead(e,c,f,g,h)},k.getSlot=function(a){var c=this.displayData.getStemValue();return c===g.UP&&this.displayData.isSecondHigher(a)?b.RIGHT:c===g.DOWN&&this.displayData.isSecondLower(a)?b.LEFT:b.MIDDLE},k.addHead=function(c,d,e,f,g){var h={glyphId:d,line:c,slot:e,glyph:null,path:null,cssClassesStr:f,hasParentheses:g};if(e===b.LEFT)this.leftHeads.push(h);else if(e===b.MIDDLE)this.middleHeads.push(h);else{if(e!==b.RIGHT)throw new a("unreachable");this.rightHeads.push(h)}c===this.baseLine&&(this.baseHead=h)},k.fillGlyphes=function(){this.leftHeads.forEach(this.fillGlyph,this),this.rightHeads.forEach(this.fillGlyph,this),this.middleHeads.forEach(this.fillGlyph,this)},k.fillGlyph=function(a){if(this.displayData.isGrace()){var b=this.ctx.getGraceSizeCoeff();a.glyph=this.ctx.getScaledGlyph(a.glyphId,b)}else a.glyph=this.ctx.getGlyph(a.glyphId)},k.initStemPosition=function(){var b=this.displayData.getStemValue(),c=this.ctx.getStemThickness();if(b===g.UP)this.rightStemX=o(this.baseHead),this.leftStemX=this.rightStemX-c,this.renderedNote.setStemYOffset(m(this.baseHead));else{if(b!==g.DOWN)throw new a("Unexpected");this.leftStemX=p(this.baseHead),this.rightStemX=this.leftStemX+c,this.renderedNote.setStemYOffset(n(this.baseHead))}this.renderedNote.setLeftStemX(this.leftStemX+c/2)};var m=function(a){return a.glyph.hasStemAnchor()?a.glyph.getStemUpSE().y:0},n=function(a){return a.glyph.hasStemAnchor()?a.glyph.getStemDownNW().y:0};k.drawHeads=function(){this.leftHeads.forEach(this.drawHead,this),this.rightHeads.forEach(this.drawHead,this),this.middleHeads.forEach(this.drawHead,this)},k.drawHead=function(a){var b=a.line,c=this.renderedNote.getHead(b);a.path=c.append("path"),a.path.attr("d",a.glyph.render());var d=this.ctx.getSpaceSize(),e=this.calcShiftValue(a),f=-(e+a.glyph.getBBoxSW().x),g=e+a.glyph.getBBoxNE().x-this.getMiddleWidth();this.leftOffset=Math.max(this.leftOffset,f),this.rightOffset=Math.max(this.rightOffset,g);var h=this.lineToY(b,d);this.renderedNote.setHighestY(h-.5*d),this.renderedNote.setLowestY(h+.5*d),c.attr("transform","translate("+e+" "+h+")");var j=a.cssClassesStr;if(c.attr("class",this.cssClass+" "+j),a.hasParentheses){var k=c.append("path"),l=this.ctx.getGlyph(i);k.attr("d",l.render())}},k.calcShiftValue=function(c){var d=c.slot;if(d===b.LEFT)return this.rightStemX-o(c);if(d===b.MIDDLE){return this.displayData.getStemValue()===g.UP?this.rightStemX-o(c):this.leftStemX-p(c)}if(d===b.RIGHT)return this.leftStemX-p(c);throw new a("unreachable")},k.lineToY=function(a){var b=this.displayData.isTabStaff()?this.ctx.getTabSpaceSize():this.ctx.getSpaceSize(),c=this.displayData.getNbStaffLines();return e.lineToY(a,b,c)},k.fillRenderedNoteData=function(){this.renderedNote.setLeftHeadWidth(this.leftOffset),this.renderedNote.setRightHeadWidth(this.rightOffset);var a=this.getMiddleWidth();this.renderedNote.setMiddleHeadWidth(a)},k.getMiddleWidth=function(){return null===this.middleWidth&&(this.middleWidth=o(this.baseHead)),this.middleWidth};var o=function(a){if(a.glyph.hasStemAnchor())return a.glyph.getStemUpSE().x;var b=0-a.glyph.getBBoxSW().x;return a.glyph.getBBoxNE().x-b},p=function(a){return a.glyph.hasStemAnchor()?a.glyph.getStemDownNW().x:0}}.call(this),function(){"use strict";var a=Adagio.Utils.geometryUtils,b=Adagio.Values.Stem,c=Adagio.Drawer.LegerLinesDrawer=function(a){this.init(a)};c.cssClass="legerLine";var d=c.prototype;d.cssClass=c.cssClass,d.init=function(a){this.displayData=a,this.renderedNote=null},d.canDraw=function(){return this.hasLegerLines()&&!this.displayData.isTabStaff()&&!this.isSmallRest()},d.hasLegerLines=function(){return this.hasUpLegerLines()||this.hasDownLegerLines()},d.isSmallRest=function(){return!!this.displayData.isRest()&&this.displayData.getBaseQuarterDuration()<=1},d.draw=function(a,b){this.renderedNote=a,this.svg=a.getGroup(),this.ctx=b,this.hasUpLegerLines()&&this.drawUpLegerLines(),this.hasDownLegerLines()&&this.drawDownLegerLines()},d.hasUpLegerLines=function(){return this.displayData.getHighestLine()>=6},d.hasDownLegerLines=function(){return this.displayData.getLowestLine()<=0},d.drawUpLegerLines=function(){for(var a=this.displayData.getHighestLine();a>=6;){if(this.drawLegerLine(Math.floor(a)),this.displayData.isRest())return;a--}},d.drawDownLegerLines=function(){for(var a=this.displayData.getLowestLine();a<=0;){if(this.drawLegerLine(Math.ceil(a)),this.displayData.isRest())return;a++}},d.drawLegerLine=function(a){var c=this.displayData.getStemValue(),d=this.ctx.getSpaceSize()/2,e=this.renderedNote.getMiddleHeadWidth(),f=-d,g=e+d;if(c===b.DOWN&&this.hasAdjacentSecondLower(a)){var h=this.renderedNote.getLeftHeadWidth();f-=h,this.hasAdjacentSecondHigher(a)||this.displayData.hasLine(a)||(g-=h)}if(c===b.UP&&this.hasAdjacentSecondHigher(a)){var i=this.renderedNote.getRightHeadWidth();g+=i,this.hasAdjacentSecondLower(a)||this.displayData.hasLine(a)||(f+=i)}var j=this.lineToY(a),k=this.svg.append("line"),l=this.getLegerLineThickness();k.attr("x1",f).attr("x2",g).attr("y1",j).attr("y2",j).style("stroke-width",l).attr("class",this.cssClass),this.renderedNote.addLegerLine(a)},d.getLegerLineThickness=function(){return this.ctx.getLegerLineThickness()},d.hasAdjacentSecondLower=function(a){return this.displayData.isSecondLower(a+.5)||this.displayData.isSecondLower(a)||this.displayData.isSecondLower(a-.5)},d.hasAdjacentSecondHigher=function(a){return this.displayData.isSecondHigher(a+.5)||this.displayData.isSecondHigher(a)||this.displayData.isSecondHigher(a-.5)},d.lineToY=function(b){var c=this.displayData.isTabStaff()?this.ctx.getTabSpaceSize():this.ctx.getSpaceSize(),d=this.displayData.getNbStaffLines();return a.lineToY(b,c,d)}}.call(this),function(){"use strict";var a=Adagio.Utils.geometryUtils,b=Adagio.Utils.math,c=Adagio.Drawer.DotDrawer=function(a){this.glyphPath=null,this.glyphWidth=null,this.renderedNote=null,this.offset=null,this.displayData=a},d=c.prototype;d.canDraw=function(){return this.hasDot()&&!this.displayData.isTabStaff()},d.hasDot=function(){return this.displayData.getNbDots()>0},d.draw=function(a,b){this.renderedNote=a,this.svg=a.getGroup(),this.ctx=b,this.createGlyph(),this.offset=a.getMiddleHeadWidth()+a.calcTrailingSpace(),this.drawDots()},d.createGlyph=function(){var a=this.ctx.getGlyph("augmentationDot");this.glyphPath=a.render(),this.glyphWidth=a.getWidth()},d.drawDots=function(){this.displayData.getLines().forEach(this.drawDot,this)},d.drawDot=function(a){var c=this.ctx.getMarginSize();b.isInteger(a)&&(this.displayData.isSecondLower(a)?a-=.5:a+=.5,!this.displayData.hasBeam()&&this.displayData.getNbFlags()>1&&(c+=this.ctx.getMarginSize()));for(var d=this.lineToY(a),e=this.displayData.getNbDots(),f=0;f<e;f++){var g=this.offset+c,h=this.svg.append("path");h.attr("d",this.glyphPath),h.attr("transform","translate("+g+" "+d+")"),this.renderedNote.addDot(h),this.renderedNote.setDotWidth(this.glyphWidth),this.renderedNote.setDotMargin(c),c+=this.glyphWidth+this.ctx.getMarginSize()}},d.lineToY=function(b){var c=this.displayData.isTabStaff()?this.ctx.getTabSpaceSize():this.ctx.getSpaceSize(),d=this.displayData.getNbStaffLines();return a.lineToY(b,c,d)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.math,c=["Whole","Half","Quarter","8th","16th","32nd","64th","128th","256th","512th","1024th"],d=c.length,e=Adagio.smufl.ordinalList={};e.fromDurationType=function(a){var b=a-1;return e.get(b)},e.get=function(e){if(!b.isInteger(e)||e<0||e>=d){throw new a("InvalidOrdinal","The value ["+e+"] is not an authorized ordinal.")}return c[e]}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Values.Stem,c=Adagio.smufl.ordinalList,d=Adagio.Drawer.FlagDrawer=function(a){this.displayData=a,this.nbFlags=a.getNbFlags(),this.stemValue=null,this.renderedNote=null,this.flagId=null},e=d.prototype;e.canDraw=function(){return this.hasFlag()&&!this.displayData.isTabStaff()},e.hasFlag=function(){return!this.displayData.isRest()&&this.nbFlags>0&&!this.displayData.hasBeam()},e.draw=function(a,b){this.renderedNote=a,this.svg=a.getStemBaseGroup(),this.ctx=b,this.stemValue=this.displayData.getStemValue(),this.checkStemValue(),this.retrieveFlagGlyphId(),this.glyph=this.getGlyph();var c=this.svg.append("g");c.append("path").attr("d",this.glyph.render());var d=this.getFlagX(),e=this.getFlagY();c.attr("transform","translate("+d+" "+e+")"),this.displayData.hasFlagDash()&&1===this.nbFlags&&this.addFlagDash(c);var f=this.getFlagWidth();this.renderedNote.setFlag(c,f)},e.getGlyph=function(){if(this.displayData.isGrace()){var a=this.ctx.getGraceFlagSizeCoeff();return this.ctx.getScaledGlyph(this.glyphId,a)}return this.ctx.getGlyph(this.glyphId)},e.getFlagWidth=function(){return this.glyph.getWidth()},e.addFlagDash=function(a){var c,d=a.append("path"),e=this.ctx.getGraceFlagSizeCoeff(),f=null;this.stemValue===b.UP?(f=this.glyph.getGraceNoteSlashSW(),c=this.ctx.getScaledGlyph("graceNoteSlashStemUp",e)):this.stemValue===b.DOWN?(f=this.glyph.getGraceNoteSlashNW(),c=this.ctx.getScaledGlyph("graceNoteSlashStemDown",e)):this.stemValueError(),d.attr("d",c.render()),d.attr("transform","translate("+f.x+" "+f.y+")")},e.checkStemValue=function(){this.stemValue!==b.UP&&this.stemValue!==b.DOWN&&this.stemValueError()},e.stemValueError=function(){var b="cannot draw flag for stem with "+this.stemValue+" value";throw new a("InconsistentValues",b)},e.retrieveFlagGlyphId=function(){this.glyphId=this.getFlagGlyphId()},e.getFlagGlyphId=function(){var a="flag";return a+=c.get(2+this.nbFlags),this.stemValue===b.UP?a+="Up":this.stemValue===b.DOWN&&(a+="Down"),a},e.getFlagX=function(){return-this.ctx.getStemThickness()/2},e.getFlagY=function(){return-(this.displayData.getStemQueueLine()-this.displayData.getStemBaseLine())*this.ctx.getSpaceSize()+this.getCounterOffset()},e.getCounterOffset=function(){var c=Math.max(0,this.nbFlags-2);this.displayData.isGrace()&&(c/=2);var d=c*this.ctx.getSpaceSize();if(this.stemValue===b.UP)return d;if(this.stemValue===b.DOWN)return-d;throw new a("unreachable")}}.call(this),function(){"use strict";var a=Adagio.Values.Stem,b=Adagio.Values.DurationType,c=Adagio.Error.InternalError,d=Adagio.Drawer.StemDrawer=function(a){this.init(a)};d.cssClass="stem";var e=d.prototype;e.init=function(a){this.displayData=a,this.baseQuarterDuration=a.getBaseQuarterDuration(),this.line=a.getLineAvg(),this.renderedNote=null,this.displayData.hasBeam()&&(this.beamData=a.getBeamData())},e.canDraw=function(){return this.hasStem()&&!this.displayData.isTabStaff()},e.hasStem=function(){var a=b.toQuarterDuration(b.HALF)
;return!this.displayData.isRest()&&this.baseQuarterDuration<=a},e.draw=function(a,b){this.svg=a.getStemBaseGroup(),this.ctx=b,this.renderedNote=a;var c=this.getStemValue();f(c);var e=this.getTailY(),g=0,h=this.svg.append("line"),i=this.getStemWidth(),j=a.getStemYOffset();h.attr("x1",g).attr("x2",g).attr("y1",j).attr("y2",e).style("stroke-width",i),h.attr("class",d.cssClass),this.renderedNote.setStem(h)};var f=function(b){b!==a.UP&&b!==a.DOWN&&g(b)},g=function(a){throw new c("FeatureNotSupported","cannot draw stem with "+a+" value")};e.getTailY=function(){var a=this.displayData.getStemQueueLine(),b=this.displayData.getStemBaseLine(),c=a-b,d=-c*this.ctx.getSpaceSize();return this.renderedNote.setHighestLowestYLine(a),d},e.getStemWidth=function(){return this.ctx.getStemThickness()},e.getStemValue=function(){return this.displayData.getStemValue()},e.getStemLength=function(){return this.displayData.getStemLength()}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Values.ArticulationType,c=Adagio.Values.Stem,d=Adagio.Values.StemStrategy,e=Adagio.Values.Placement,f=Adagio.Utils.typeUtils,g=Adagio.Utils.notationsUtils,h=Adagio.Utils.math,i=Adagio.Utils.geometryUtils,j={SPACE:"space",LINE:"line"},k=f.pairsToMap([{key:b.STACCATO,value:{above:"articStaccatoAbove",below:"articStaccatoBelow",anchor:j.SPACE,ligatures:f.pairsToMap([{key:b.ACCENT,value:{above:"articAccentStaccatoAbove",below:"articAccentStaccatoBelow",anchor:j.SPACE}},{key:b.STRONG,value:{above:"articMarcatoStaccatoAbove",below:"articMarcatoStaccatoBelow",anchor:j.SPACE}}])}},{key:b.STACCATO_TENUTO,value:{above:"articTenutoStaccatoAbove",below:"articTenutoStaccatoBelow",anchor:j.SPACE}},{key:b.TENUTO,value:{above:"articTenutoAbove",below:"articTenutoBelow",anchor:j.SPACE,ligatures:f.pairsToMap([{key:b.ACCENT,value:{above:"articTenutoAccentAbove",below:"articTenutoAccentBelow",anchor:j.SPACE}},{key:b.STRONG,value:{above:"articMarcatoTenutoAbove",below:"articMarcatoTenutoBelow",anchor:j.SPACE}}])}},{key:b.ACCENT,value:{above:"articAccentAbove",below:"articAccentBelow",anchor:j.LINE}},{key:b.STRONG,value:{above:"articMarcatoAbove",below:"articMarcatoBelow",anchor:null}},{key:b.STACCATISSIMO,value:{above:"articStaccatissimoAbove",below:"articStaccatissimoBelow",anchor:null}}]),l=Adagio.Drawer.ArticulationsDrawer=function(a){this.displayData=a,this.articulations=a.getArticulations(),this.stemValue=null,this.placement=null,this.renderedNote=null,this.currentArticulation=null},m=l.prototype;m.canDraw=function(){return this.hasArticulations()&&!this.displayData.isTabStaff()},m.hasArticulations=function(){return void 0!==this.articulations&&this.articulations.length>0},m.draw=function(a,b){g.sortArticulationsList(this.articulations),this.renderedNote=a,this.svg=a.getGroup(),this.ctx=b,this.stemValue=this.displayData.getStemValue(),this.getSymbols().forEach(this.drawSymbol,this)},m.getSymbols=function(){for(var a=this.articulations.filter(n),b=a.length,c=[],d=0;d<b;d++){var e=a[d],f=o(e),g=p(f,d,0,a);d+=g.nbLigatures,f=g.symbol,c.push(f)}return c};var n=function(a){return void 0!==k[a]},o=function(b){if(void 0!==k[b])return k[b];throw new a("BadArticulationType","Invalid articulation type: ["+b+"].")},p=function(a,b,c,d){var e={symbol:a,nbLigatures:c};if(void 0===a.ligatures)return e;if(b+c+1>=d.length)return e;var f=d[b+c+1],g=a.ligatures;if(void 0===g[f])return e;var h=g[f];return p(h,b,c+1,d)};m.drawSymbol=function(a){var b=this.getLine();b+=this.getLineMargin(),this.hasAnchor(a.anchor,b)?b=this.roundLine(a.anchor,b):b+=this.getLineMargin();var c=this.getGlyphId(a),d=this.ctx.getGlyph(c),e=this.svg.append("g"),f=e.append("path");f.attr("d",d.render()),f.attr("class","articulations");var g=this.getArticulationX(d),h=this.getArticulationY(b);e.attr("transform","translate("+g+" "+h+")"),this.renderedNote.setArticulation(e),this.updateLimit(h,d.getHeight())},m.getLine=function(){var b,c=this.getPlacement();if(c===e.BELOW)b=this.renderedNote.getLowestY();else{if(c!==e.ABOVE)throw new a("Unexpected");b=this.renderedNote.getHighestY()}var d=this.displayData.isTabStaff()?this.ctx.getTabSpaceSize():this.ctx.getSpaceSize(),f=this.displayData.getNbStaffLines();return i.yToLine(b,d,f)},m.getLineMargin=function(){return.25*this.getLineDirection()},m.getGlyphId=function(b){var c=this.getPlacement();if(c===e.BELOW)return b.below;if(c===e.ABOVE)return b.above;throw new a("Unexpected")},m.hasAnchor=function(b,c){if(null===b)return!1;var d=this.getPlacement();if(d===e.BELOW){if(c<=-.25)return!1}else{if(d!==e.ABOVE)throw new a("Unexpected");if(c>=5.25)return!1}return!0},m.roundLine=function(b,c){var d=h.floatPart(c);d<0&&(d+=1),this.getPlacement()===e.BELOW&&(d=1-d),d=Math.abs(d);var f=0;if(b===j.SPACE)f=d<=.5?.5-d:1-d;else{if(b!==j.LINE)throw new a("Unexpected");f=1-d}return c+=f*this.getLineDirection()},m.getLineDirection=function(){var b=this.getPlacement();if(b===e.BELOW)return-1;if(b===e.ABOVE)return 1;throw new a("Unexpected")},m.getArticulationX=function(a){return this.renderedNote.getMiddleHeadWidth()/2-a.getWidth()/2},m.getArticulationY=function(a){var b=this.displayData.isTabStaff()?this.ctx.getTabSpaceSize():this.ctx.getSpaceSize(),c=this.displayData.getNbStaffLines();return i.lineToY(a,b,c)},m.updateLimit=function(b,c){var d=this.getPlacement();if(d===e.BELOW)this.renderedNote.setLowestY(b+c);else{if(d!==e.ABOVE)throw new a("Unexpected");this.renderedNote.setHighestY(b-c)}},m.getPlacement=function(){return null===this.placement&&(this.placement=this.computePlacement()),this.placement},m.computePlacement=function(){var b=this.displayData.getStemStrategy();if(b===d.AUTO){if(this.stemValue===c.UP)return e.BELOW;if(this.stemValue===c.DOWN)return e.ABOVE;throw new a("Unexpected")}if(b===d.UP)return e.ABOVE;if(b===d.DOWN)return e.BELOW;throw new a("Unexpected")}}.call(this),function(){"use strict";var a=Adagio.Values.InternalError,b=Adagio.Values.OrnamentType,c=Adagio.Values.TechnicalType,d=Adagio.Values.NotationType,e=Adagio.Values.Placement,f=Adagio.Values.StemStrategy,g=Adagio.Utils.geometryUtils,h=Adagio.Utils.typeUtils,i=h.pairsToMap([{key:b.TRILLMARK,value:"ornamentTrill"},{key:c.UPBOW,value:{above:"stringsUpBow",below:"stringsUpBowTurned"}},{key:c.DOWNBOW,value:{above:"stringsDownBow",below:"stringsDownBowTurned"}},{key:c.SNAP_PIZZICATO,value:{above:"pluckedSnapPizzicatoAbove",below:"pluckedSnapPizzicatoBelow"}},{key:d.FERMATA,value:{above:"fermataAbove",below:"fermataBelow"}},{key:b.MORDENT,value:"ornamentMordentInverted"},{key:b.INVERTED_MORDENT,value:"ornamentMordent"},{key:b.LONG_MORDENT,value:"ornamentPrecompTrillWithMordent"},{key:b.LONG_INVERTED_MORDENT,value:"ornamentTremblement"},{key:b.ABOVE_APPROACH_MORDENT,value:"ornamentPrecompInvertedMordentUpperPrefix"},{key:b.BELOW_APPROACH_MORDENT,value:"ornamentPrecompSlideTrillBach"},{key:b.ABOVE_APPROACH_INVERTED_MORDENT,value:"ornamentPrecompMordentUpperPrefix"},{key:b.BELOW_APPROACH_INVERTED_MORDENT,value:"ornamentPrecompSlideTrillDAnglebert"},{key:b.ABOVE_DEPARTURE_INVERTED_MORDENT,value:"ornamentPrecompTrillSuffixDandrieu"},{key:b.BELOW_DEPARTURE_INVERTED_MORDENT,value:"ornamentPrecompTrillLowerSuffix"},{key:b.TURN,value:"ornamentTurn"},{key:b.INVERTED_TURN,value:"ornamentTurnSlash"}]),j=Adagio.Drawer.AboveNotationDrawer=function(a){this.displayData=a,this.ornaments=a.getOrnaments(),this.technical=a.getTechnical(),this.articulations=a.getArticulations(),this.renderedNote=null,this.placement=null},k=j.prototype;k.canDraw=function(){return!this.displayData.isTabStaff()},k.draw=function(a,b){this.renderedNote=a,this.svg=a.getGroup(),this.ctx=b,this.getGlyphIds().forEach(function(a){var b=this.ctx.getGlyph(a),c=this.svg.append("g"),d=c.append("path");d.attr("d",b.render()),d.attr("class","technical");var e=this.getPosX(b),f=this.getPosY(b);c.attr("transform","translate("+e+" "+f+")"),this.renderedNote.setTechnical(c),this.updateLimit(f,b)},this)},k.getGlyphIds=function(){var a=[],b=this.getPlacement();if(void 0!==this.ornaments){var c=this.ornaments.filter(l),d=c.map(m,b);Array.prototype.push.apply(a,d)}if(void 0!==this.technical){var e=this.technical.filter(l),f=e.map(m,b);Array.prototype.push.apply(a,f)}if(void 0!==this.articulations){var g=this.articulations.filter(l),h=g.map(m,b);Array.prototype.push.apply(a,h)}return a};var l=function(a){return void 0!==i[a]},m=function(b){var c=this.valueOf(),d=i[b];if("string"==typeof d)return d;if(h.isObject(d)){if(c===e.ABOVE)return d.above;if(c===e.BELOW)return d.below;throw new a("Unexpected")}throw new a("Unexpected")};k.getPosX=function(a){return this.renderedNote.getMiddleHeadWidth()/2-a.getWidth()/2},k.getPosY=function(b){var c,d=this.ctx.getSpaceSize(),f=this.getPlacement();if(f===e.ABOVE)return c=this.renderedNote.getLocalHighestYWithMarge(),c=Math.min(c,-d);if(f===e.BELOW){var g=this.displayData.getNbStaffLines();return c=this.renderedNote.getLocalLowestYWithMarge(),c=Math.max(c,d*g),c-=b.getBBoxNE().y}throw new a("Unexpected")},k.lineToY=function(a){var b=this.displayData.isTabStaff()?this.ctx.getTabSpaceSize():this.ctx.getSpaceSize(),c=this.displayData.getNbStaffLines();return g.lineToY(a,b,c)},k.updateLimit=function(b,c){var d=this.getPlacement();if(d===e.ABOVE)b+=c.getBBoxNE().y,this.renderedNote.setHighestY(b);else{if(d!==e.BELOW)throw new a("Unexpected");b+=c.getBBoxSW().y,this.renderedNote.setLowestY(b)}},k.getPlacement=function(){return null===this.placement&&(this.placement=this.calcPlacement()),this.placement},k.calcPlacement=function(){return this.displayData.getStemStrategy()===f.DOWN?e.BELOW:e.ABOVE}}.call(this),function(){"use strict";var a=Adagio.Values.ArticulationType,b=Adagio.Utils.typeUtils,c=b.pairsToMap([{key:a.BREATHMARK,value:"breathMarkComma"},{key:a.CAESURA,value:"caesura"}]),d=Adagio.Drawer.AboveRightNotationDrawer=function(a){this.displayData=a,this.articulations=a.getArticulations(),this.renderedNote=null},e=d.prototype;e.canDraw=function(){return!this.displayData.isTabStaff()},e.draw=function(a,b){this.renderedNote=a,this.svg=a.getGroup(),this.ctx=b,this.getGlyphIds().forEach(function(a){var b=this.ctx.getGlyph(a),c=this.svg.append("g"),d=c.append("path");d.attr("d",b.render()),d.attr("class","aboveright");var e=this.getPosX(),f=this.getPosY(b);c.attr("transform","translate("+e+" "+f+")"),this.renderedNote.setTechnical(c),this.updateLimit(f,b),this.renderedNote.setAboveRight(c,e+b.getWidth())},this)},e.getGlyphIds=function(){var a=[];if(void 0!==this.articulations){var b=this.articulations.filter(f),c=b.map(g);Array.prototype.push.apply(a,c)}return a};var f=function(a){return void 0!==c[a]},g=function(a){return c[a]};e.getPosX=function(){var a=this.ctx.getMinimalSpaceAboveRightRatio(),b=this.renderedNote.getWidth()+.5*this.ctx.getSpaceSize();return Math.max(a,b)},e.getPosY=function(a){var b=a.getHeight();return-(1.2*this.ctx.getSpaceSize()-b)},e.updateLimit=function(a,b){var c=b.getHeight();this.renderedNote.setHighestY(a-c)}}.call(this),function(){"use strict";var a=Adagio.Drawer.Text,b=Adagio.Utils.lyricUtils,c=Adagio.Drawer.LyricLine=function(a,b){this.init(a,b)};c.cssClass="lyricLine";var d=c.prototype;d.init=function(a,b){this.lyricJson=a,this.headWidth=b,this.text=null,this.drawingContext=null,this.parent=null},d.render=function(d){this.drawingContext=d;var e={};e["font-size"]=d.getLyricsFontSize(),e["font-family"]=d.getLyricFontFamily();var f=b.getText(this.lyricJson);e.text=f,this.text=new a(e),null!==this.parent&&this.text.setParent(this.parent),this.text.setDrawingContext(d),this.text.render(),this.text.setCssClass(c.cssClass)},d.setParent=function(a){this.parent=a,null!==this.text&&this.text.setParent(a)},d.setYPos=function(a){var b=this.drawingContext.getLyricsFontSize();a+=this.getLevel()*b,a+=this.getXHeight(),this.text.setYPos(a)},d.getTextPosY=function(){return this.text.y},d.getLevel=function(){return b.getLevel(this.lyricJson)},d.setXPos=function(a){a+=this.headWidth/2-this.getWidth()/2,this.text.setXPos(a)},d.draw=function(){this.text.draw()},d.move=function(){this.text.move()},d.getWidth=function(){return this.text.getWidth()},d.getHeight=function(){return 2*this.getXHeight()},d.getXHeight=function(){return this.text.getXHeight()},d.getFontSize=function(){return this.drawingContext.getLyricsFontSize()},d.getExceedingSpace=function(){var a=this.getWidth()/2-this.headWidth/2;return Math.max(a,0)}}.call(this),function(){"use strict";var a=Adagio.Brush.Elem,b=Adagio.Drawer.LyricLine,c=Adagio.Utils.lyricUtils,d=Adagio.Utils.math,e=Adagio.Utils.mapUtils,f=Adagio.Drawer.Lyric=function(a,b){this.init(a,b)};f.cssClass="lyric";var g=f.prototype;g.init=function(a,b){this.headWidth=b,this.lyricsJsons=a,this.lyricsLines=this.lyricsJsons.map(this.createLyricLine,this),this.lyricsPerLevel=e.fromList(this.lyricsLines,h),this.drawingContext=null,this.group=null,this.parent=null,this.height=null,this.width=null};var h=function(a){return a.getLevel()};g.createLyricLine=function(a){return new b(a,this.headWidth)},g.render=function(b){this.drawingContext=b,this.group=new a("g"),this.group.attr("class",this.cssClass),this.lyricsLines.forEach(this.transferDrawingContext,this)},g.transferDrawingContext=function(a){a.setParent(this.group),a.render(this.drawingContext)},g.setParent=function(a){this.parent=a},g.setYPos=function(a){this.posY=a,this.lyricsLines.forEach(this.transferPosY,this)},g.transferPosY=function(a){a.setYPos(this.posY)},g.setXPos=function(a){this.posX=a,this.lyricsLines.forEach(this.transferPosX,this)},g.transferPosX=function(a){a.setXPos(this.posX)},g.draw=function(){this.lyricsLines.forEach(i),this.bindToParent()};var i=function(a){a.draw()};g.bindToParent=function(){this.parent.append(this.group)},g.move=function(){this.lyricsLines.forEach(j)};var j=function(a){a.move()};g.getWidth=function(){if(null===this.width){var a=this.lyricsLines.map(k);this.width=a.reduce(d.max2)}return this.width};var k=function(a){return a.getWidth()};g.getHeight=function(){if(null===this.height){var a=this.lyricsJsons.length,b=this.lyricsJsons[a-1],d=c.getLevel(b),e=this.lyricsLines[a-1],f=e.getHeight(),g=e.getFontSize();this.height=f+g*d}return this.height},g.getExceedingSpace=function(){var a=this.getWidth()/2-this.headWidth/2;return Math.max(a,0)},g.hasLevel=function(a){return void 0!==this.lyricsPerLevel[a]},g.getLevelWidth=function(a){return this.getLevel(a).getWidth()},g.getLevelPosY=function(a){return this.getLevel(a).getTextPosY()},g.getLevel=function(a){return this.lyricsPerLevel[a]},g.getBeginLevels=function(){return this.lyricsJsons.filter(c.hasRightConnection).map(c.getLevel)},g.getEndLevels=function(){return this.lyricsJsons.filter(c.hasLeftConnection).map(c.getLevel)}}.call(this),function(){"use strict";var a=Adagio.Drawer.Lyric,b=Adagio.Drawer.LyricDrawer=function(a){this.displayData=a,this.stemValue=null,this.renderedNote=null},c=b.prototype;c.canDraw=function(){return this.displayData.hasLyrics()&&!this.displayData.isTabStaff()},c.draw=function(b,c){this.renderedNote=b,this.svg=b.getGroup(),this.ctx=c;var d=b.getMiddleHeadWidth(),e=this.displayData.getLyrics(),f=new a(e,d);f.render(c),b.addLyric(f)}}.call(this),function(){"use strict";var a=Adagio.Values.Stem,b=Adagio.Values.OrnamentType,c=Adagio.Utils.typeUtils,d=Adagio.Utils.geometryUtils,e=Adagio.Utils.ornamentsUtils,f=c.pairsToMap([{key:b.TREMOLO1,value:"tremolo1"},{key:b.TREMOLO2,value:"tremolo2"},{key:b.TREMOLO3,value:"tremolo3"},{key:b.TREMOLO4,value:"tremolo4"},{key:b.TREMOLO5,value:"tremolo5"},{key:b.BUZZ,value:"buzzRoll"}]),g=Adagio.Drawer.OnStemCenteredDrawer=function(a){this.displayData=a,this.ornaments=a.getOrnaments(),this.renderedNote=null},h=g.prototype;h.canDraw=function(){return!this.displayData.isTabStaff()},h.draw=function(a,b){this.renderedNote=a,this.svg=a.getGroup(),this.ctx=b,this.getGlyphesData().forEach(function(a){var b=this.ctx.getGlyph(a.id),c=this.svg.append("g"),d=c.append("path");d.attr("d",b.render()),d.attr("class","aboveright");var e=this.getPosX(b),f=this.getPosY(a.nbLines);c.attr("transform","translate("+e+" "+f+")"),this.renderedNote.setTechnical(c)},this)},h.getGlyphesData=function(){var a=[];if(void 0!==this.ornaments){var b=this.ornaments.filter(i),c=b.map(j);Array.prototype.push.apply(a,c)}return a};var i=function(a){return void 0!==f[a]},j=function(a){var b=e.ornamentToNbLines(a);return{id:f[a],nbLines:b}};h.getPosX=function(b){var c=this.renderedNote.getMiddleHeadWidth(),d=b.getWidth(),e=this.ctx.getStemThickness()/2,f=this.getStemValue();return this.hasStem()?f===a.UP?c/2+d/2-e:(a.DOWN,0):c/2},h.getPosY=function(a){var b=1+(a-1)/2;b+=this.displayData.getNbFlags();var c=this.displayData.getStemQueueLine(),e=this.getLinePLacementCoeff(),f=c-b*e,g=this.displayData.isTabStaff()?this.ctx.getTabSpaceSize():this.ctx.getSpaceSize(),h=this.displayData.getNbStaffLines();return d.lineToY(f,g,h)},h.getLinePLacementCoeff=function(){var b=this.displayData.getStemValue();return b===a.UP?1:b===a.DOWN?-1:void a.raiseError(b)},h.hasStem=function(){return this.displayData.hasStem()},h.getStemValue=function(){return this.displayData.getStemValue()}}.call(this),function(){"use strict";var a=Adagio.Values.FretType,b=Adagio.Utils.typeUtils,c=Adagio.Utils.geometryUtils,d=Adagio.Utils.math,e=b.pairsToMap([{key:a.FRET0,value:"luteItalianFret0"},{key:a.FRET1,value:"luteItalianFret1"},{key:a.FRET2,value:"luteItalianFret2"},{key:a.FRET3,value:"luteItalianFret3"},{key:a.FRET4,value:"luteItalianFret4"},{key:a.FRET5,value:"luteItalianFret5"},{key:a.FRET6,value:"luteItalianFret6"},{key:a.FRET7,value:"luteItalianFret7"},{key:a.FRET8,value:"luteItalianFret8"},{key:a.FRET9,value:"luteItalianFret9"}]),f=Adagio.Drawer.FretDrawer=function(a){this.displayData=a,this.frets=this.displayData.getFrets(),this.group=null,this.heads=null};f.cssClass="head";var g=f.prototype;g.cssClass=f.cssClass,g.canDraw=function(){return this.displayData.isTabStaff()},g.draw=function(a,b){this.renderedNote=a,this.svg=a.getGroup(),this.ctx=b,this.needRender()&&this.render(),this.initHeads(),this.drawFrets(),this.fillRenderedNoteData(a),a.setLeftStemX(0)},g.needRender=function(){return null===this.group},g.render=function(){this.group=this.svg.append("g")},g.drawFrets=function(){this.heads.forEach(this.drawFret,this)},g.drawFret=function(a){this.head=a,this.renderHeadGroup(),this.renderHeadRect(),a.glyphs.forEach(this.drawGlyph,this)},g.drawGlyph=function(a,b){var c=this.head.group.append("path"),d=this.getTotalWidthToIdx(b);c.attr("d",a.render()),c.attr("transform","translate("+d+" 0)")},g.renderHeadRect=function(){var a=this.getTotalWidth(),b=this.getHighestHeight(),c=this.head.group.append("rect");c.style("fill","rgb(255,255,255)"),c.style("stroke","rgb(255,255,255)"),c.attr("width",a+"px"),c.attr("height",b+"px"),c.attr("transform","translate(0 "+-b+")")},g.renderHeadGroup=function(){var a=this.getHighestHeight(),b=this.getYPos(a);this.head.group=this.svg.append("g"),this.head.group.attr("class",this.cssClass),this.head.group.attr("transform","translate(0 "+b+")"),this.renderedNote.setFret(this.getStringLine(),this.head.group)},g.getTotalWidth=function(){if(void 0!==this.head){var a=this.head.glyphs;return this.getTotalWidthToIdx(a.length)}return 0},g.getTotalWidthToIdx=function(a){if(void 0!==this.head){var b=this.head.glyphs,c=b.slice(0,a);return 0!==c.length?c.map(this.getWidth,this).reduce(j):0}return 0},g.getHighestHeight=function(){if(void 0!==this.head){var a=this.head.glyphs;return 0!==a.length?a.map(this.getHeight).reduce(d.max2):0}return 0},g.getYPos=function(a){var b=this.getStringLine(),d=this.getSpaceSize();return a/2+c.stringToY(b,d,this.displayData.getNbStaffLines())},g.getStringLine=function(){return this.head.string},g.initHeads=function(){this.heads=[],this.frets.forEach(function(a){if(null!==a&&a.string>0){var b={glyphs:this.getGlyphs(a.frets),string:a.string};this.heads.push(b)}},this)},g.getGlyphs=function(a){return this.getGlyphIds(a).map(this.ctx.getGlyph,this.ctx)},g.getGlyphIds=function(a){var b=[];if(void 0!==a){var c=a.filter(h),d=c.map(i);Array.prototype.push.apply(b,d)}return b},g.getSpaceSize=function(){return this.displayData.isTabStaff()?this.ctx.getTabSpaceSize():this.ctx.getSpaceSize()},g.getWidth=function(a){var b=.1*this.ctx.getSpaceSize();return a.getWidth()+b},g.getHeight=function(a){return a.getHeight()},g.fillRenderedNoteData=function(a){var b=this.getTotalWidth();a.setFretsWidth(b)};var h=function(a){return void 0!==e[a]},i=function(a){return e[a]},j=function(a,b){return a+b}}.call(this),function(){"use strict";var a=Adagio.Brush.Elem,b="wiggleArpeggiatoUp",c=Adagio.Drawer.Arpeggio=function(){this.init()};c.NAME="arpeggio";var d=c.prototype;d.name=c.NAME,d.init=function(){this.drawingContext=null,this.inputHeight=null,this.actualHeight=null,this.nbPaths=null,this.glyph=null,this.group=null,this.parent=null,this.paths=[]},d.setDrawingContext=function(a){this.drawingContext=a},d.setPosition=function(a,b){this.posX=a,this.posY=b},d.setParent=function(a){this.parent=a},d.setInputHeight=function(a){this.inputHeight=a},d.draw=function(){this.renderIfNeeded(),this.bindToParent()},d.renderIfNeeded=function(){this.isRendered()||this.render()},d.isRendered=function(){return null!==this.group},d.render=function(){this.group=new a("g"),this.group.attr("class",this.name);for(var b=this.getNbPaths(),c=this.getGlyph(),d=c.render(),e=c.getRepeatOffset(),f=this.actualHeight-this.inputHeight,g=-f/2,h=0,i=0;i<b;i++){var j=this.group.append("path");j.attr("d",d),j.attr("transform","translate("+g+", "+h+")"),g+=e.x,h+=e.y,this.paths.push(j)}},d.move=function(){var a=this.posX,b=this.posY,c="translate("+a+", "+b+")";this.group.attr("transform",c+" rotate(-90)")},d.bindToParent=function(){this.parent.append(this.group)},d.getNbPaths=function(){return null===this.nbPaths&&this.computeNbPaths(),this.nbPaths},d.getWidth=function(){return this.getGlyph().getHeight()},d.getTrailingSpace=function(){return 0},d.computeNbPaths=function(){var a=this.getGlyph(),b=a.getRepeatOffset(),c=b.x;this.nbPaths=Math.ceil(this.inputHeight/c),this.actualHeight=this.nbPaths*c},d.getGlyph=function(){return null===this.glyph&&(this.glyph=this.drawingContext.getGlyph(b)),this.glyph}}.call(this),function(){"use strict";var a=Adagio.Drawer.Arpeggio,b=Adagio.Utils.geometryUtils,c=1,d=Adagio.Drawer.ArpeggioDrawer=function(a){this.init(a)},e=d.prototype;e.init=function(a){this.displayData=a},e.canDraw=function(){return this.hasArpeggio()&&!this.displayData.isTabStaff()},e.hasArpeggio=function(){return this.displayData.hasArpeggio()},e.draw=function(b,d){this.renderedNote=b,this.svg=this.renderedNote.getGroup(),this.ctx=d;var e=this.ctx.getSpaceSize(),f=this.displayData.getLowestLine(),g=Math.abs(this.displayData.getHighestLine()-f)+c,h=g*e,i=new a;i.setParent(this.svg),i.setDrawingContext(this.ctx),i.setInputHeight(h);var j=this.lineToY(f-c/2),k=i.getTrailingSpace(),l=this.getInitialShift(),m=-(l+k);i.setPosition(m,j),i.draw(),i.move(),b.addArpeggio(i)},e.getInitialShift=function(){var a=0;return a+=this.renderedNote.getLeftHeadWidth(),this.renderedNote.accidentals.length>0&&(a+=this.renderedNote.accsWidth+this.ctx.getMarginSize()/2),a+=this.ctx.getMarginSize()/2},e.lineToY=function(a){var c=this.displayData.isTabStaff()?this.ctx.getTabSpaceSize():this.ctx.getSpaceSize(),d=this.displayData.getNbStaffLines();return b.lineToY(a,c,d)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Values.Stem,c=Adagio.smufl.ordinalList,d=Adagio.Drawer.TabFlagDrawer=function(a){this.displayData=a,this.nbFlags=a.getNbFlags(),this.stemValue=null,this.renderedNote=null,this.flagId=null},e=d.prototype;e.canDraw=function(){return this.hasFlag()&&this.displayData.isTabStaff()&&this.displayData.hasFrets()&&!this.displayData.isGrace()},e.hasFlag=function(){return!this.displayData.isRest()&&this.nbFlags>0&&!this.displayData.hasBeam()},e.draw=function(a,b){this.renderedNote=a,this.svg=a.getStemBaseGroup(),this.ctx=b,this.stemValue=this.displayData.getStemValue(),this.checkStemValue(),this.retrieveFlagGlyphId(),this.glyph=this.getGlyph();var c=this.svg.append("g");c.append("path").attr("d",this.glyph.render());var d=this.getFlagX(),e=this.getFlagY();c.attr("transform","translate("+d+" "+e+")");var f=this.getFlagWidth();this.renderedNote.setFlag(c,f)},e.getGlyph=function(){if(this.displayData.isGrace()){var a=this.ctx.getGraceFlagSizeCoeff();return this.ctx.getScaledGlyph(this.glyphId,a)}return this.ctx.getGlyph(this.glyphId)},e.getFlagWidth=function(){return this.glyph.getWidth()},e.checkStemValue=function(){this.stemValue!==b.UP&&this.stemValue!==b.DOWN&&this.stemValueError()},e.stemValueError=function(){var b="cannot draw tab flag for stem with "+this.stemValue+" value";throw new a("InconsistentValues",b)},e.retrieveFlagGlyphId=function(){this.glyphId=this.getFlagGlyphId()},e.getFlagGlyphId=function(){var a="flag";return a+=c.get(2+this.nbFlags),this.stemValue===b.UP?a+="Up":this.stemValue===b.DOWN&&(a+="Down"),a},e.getFlagX=function(){return this.renderedNote.getFretsWidth()/2-this.getStemWidth()/2},e.getFlagY=function(){return-(this.displayData.getStemQueueLine()-this.displayData.getStemBaseLine())*this.ctx.getSpaceSize()+this.getCounterOffset()},e.getCounterOffset=function(){var c=Math.max(0,this.nbFlags-2)/2;this.displayData.isGrace()&&(c/=2);var d=c*this.ctx.getTabSpaceSize();if(this.stemValue===b.UP)return d;if(this.stemValue===b.DOWN)return-d;throw new a("unreachable")},e.getStemWidth=function(){return this.ctx.getStemThickness()}}.call(this),function(){"use strict";var a=Adagio.Values.Stem,b=Adagio.Values.DurationType,c=Adagio.Error.InternalError,d=Adagio.Drawer.TabStemDrawer=function(a){this.init(a)};d.cssClass="tab-stem";var e=d.prototype;e.init=function(a){this.displayData=a,this.baseQuarterDuration=a.getBaseQuarterDuration(),this.renderedNote=null},e.canDraw=function(){return this.hasStem()&&this.displayData.isTabStaff()&&this.displayData.hasFrets()&&!this.displayData.isGrace()},e.hasStem=function(){var a=b.toQuarterDuration(b.HALF);return!this.displayData.isRest()&&this.baseQuarterDuration<=a},e.draw=function(a,b){this.svg=a.getStemBaseGroup(),this.ctx=b,this.renderedNote=a;var c=this.getStemValue();f(c);var e=this.getTailY(),g=this.getStemX(),h=this.svg.append("line"),i=this.getStemWidth();h.attr("x1",g).attr("x2",g).attr("y1",0).attr("y2",e).style("stroke-width",i),h.attr("class",d.cssClass),this.renderedNote.setStem(h)};var f=function(b){b!==a.UP&&b!==a.DOWN&&g(b)},g=function(a){throw new c("FeatureNotSupported","cannot draw stem with "+a+" value")};e.getTailY=function(){var a=this.displayData.getStemQueueLine(),b=this.displayData.getStemBaseLine(),c=a-b,d=-c*this.ctx.getSpaceSize();return this.renderedNote.setHighestLowestYLine(a),d},e.getStemX=function(){return this.renderedNote.getFretsWidth()/2-this.getStemWidth()/2},e.getStemWidth=function(){return this.ctx.getStemThickness()},e.getStemValue=function(){return this.displayData.getStemValue()}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Values.ArticulationType,c=Adagio.Utils.typeUtils,d=Adagio.Utils.geometryUtils,e={ABOVE:"above",BELOW:"below",LEFT:"left",RIGHT:"rigth"},f=c.pairsToMap([{key:b.DOIT,value:{glyphId:"brassDoitMedium",verticalDirection:e.ABOVE,horizontalDirection:e.RIGHT}},{key:b.FALLOFF,value:{glyphId:"brassFallRoughShort",verticalDirection:e.BELOW,horizontalDirection:e.RIGHT}},{key:b.PLOP,value:{glyphId:"brassPlop",verticalDirection:e.ABOVE,horizontalDirection:e.LEFT}},{key:b.SCOOP,value:{glyphId:"brassScoop",verticalDirection:e.BELOW,horizontalDirection:e.LEFT}}]),g=Adagio.Drawer.JazzArticulationsNotationDrawer=function(a){this.displayData=a,this.articulations=a.getArticulations(),this.renderedNote=null,this.svg=null,this.ctx=null},h=g.prototype;h.canDraw=function(){return this.hasArticulations()&&!this.displayData.isTabStaff()},h.hasArticulations=function(){return void 0!==this.articulations},h.draw=function(a,b){this.renderedNote=a,this.svg=a.getGroup(),this.ctx=b,this.getArticulations().forEach(function(a){var b=this.ctx.getGlyph(a.glyphId),c=this.svg.append("g"),d=c.append("path");d.attr("d",b.render()),d.attr("class","jazzarticulation");var e=this.getY(a.verticalDirection,b),f=this.getX(a.horizontalDirection,b);c.attr("transform","translate("+f+" "+e+")"),this.updateLimit(a.verticalDirection,e,b),this.setRenderedNoteWidth(a.horizontalDirection,b)},this)},h.getArticulations=function(){if(void 0!==this.articulations){return this.articulations.filter(i).map(j)}return[]},h.getY=function(b,c){var d=.2*this.ctx.getSpaceSize();if(b===e.ABOVE){var f=this.displayData.getHighestLine();return this.lineToY(f)-d}if(b===e.BELOW){var g=this.displayData.getLowestLine();return this.lineToY(g)+d+c.getHeight()}throw new a("Unexpected")},h.getX=function(b,c){var d=.2*this.ctx.getSpaceSize();if(b===e.LEFT){var f=-c.getWidth()-d;return f-=this.renderedNote.getLeftHeadWidth(),this.renderedNote.hasAccidentals()&&(f-=this.renderedNote.getAccidentalsWidth()),f}if(b===e.RIGHT){var g=this.renderedNote.getMiddleHeadWidth()+d;return g+=this.renderedNote.getRightHeadWidth()}throw new a("Unexpected")},h.lineToY=function(a){var b=this.displayData.isTabStaff()?this.ctx.getTabSpaceSize():this.ctx.getSpaceSize(),c=this.displayData.getNbStaffLines();return d.lineToY(a,b,c)},h.updateLimit=function(b,c,d){var f=d.getHeight();if(b===e.ABOVE)this.renderedNote.setHighestY(c-f);else{if(b!==e.BELOW)throw new a("Unexpected");this.renderedNote.setLowestY(c+f)}},h.setRenderedNoteWidth=function(b,c){var d=c.getWidth();if(b===e.LEFT)this.renderedNote.setLeftArticulationsWidth(d);else{if(b!==e.RIGHT)throw new a("Unexpected");this.renderedNote.setRightArticulationsWidth(d)}};var i=function(a){return void 0!==f[a]},j=function(a){return f[a]}}.call(this),function(){"use strict";var a=Adagio.Values.Placement,b=Adagio.Values.StemStrategy,c=Adagio.Drawer.Text,d=Adagio.Drawer.FingeringsDrawer=function(a){this.displayData=a,this.fingerings=a.getFingerings()},e=d.prototype;e.canDraw=function(){return this.hasFingerings()&&!this.displayData.isTabStaff()},e.hasFingerings=function(){return void 0!==this.fingerings&&this.fingerings.length>0},e.draw=function(b,c){this.renderedNote=b,this.drawingContext=c,this.fontSize=this.drawingContext.getFingeringFontSize();var d=this.getPlacement();d===a.ABOVE?this.drawAbove():d===a.BELOW?this.drawBelow():a.raiseError(d)},e.drawAbove=function(){var a=this.drawingContext.getSpaceSize(),b=this.renderedNote.getHighestY()-a/2,c=-a/2;this.yPos=Math.min(c,b);var d=this.displayData.getFingerings().slice();d.reverse(),d.forEach(this.drawFingeringAbove,this)},e.drawFingeringAbove=function(a){this.drawFingering(a),this.yPos-=this.fontSize,this.renderedNote.setHighestY(this.yPos)},e.drawBelow=function(){var a=this.drawingContext.getSpaceSize(),b=this.displayData.getNbStaffLines(),c=a*(b-1),d=this.renderedNote.getLowestY();this.yPos=Math.max(d,c),this.displayData.getFingerings().forEach(this.drawFingeringBelow,this)},e.drawFingeringBelow=function(a){this.yPos+=this.fontSize,this.drawFingering(a),this.renderedNote.setLowestY(this.yPos)},e.drawFingering=function(a){var b=this.drawingContext.getFingeringFontFamily(),d={text:a.toString(),"font-size":this.fontSize,"font-family":b},e=new c(d);e.setDrawingContext(this.drawingContext);var f=this.renderedNote.getGroup();e.setParent(f);var g=e.getWidth(),h=this.renderedNote.getMiddleHeadWidth(),i=h/2-g/2,j=this.yPos;e.setPosition(i,j),e.render(),e.draw()},e.getPlacement=function(){var c=this.displayData.getStemStrategy();return c===b.UP||c===b.AUTO?a.ABOVE:c===b.DOWN?a.BELOW:void b.raiseError(c)}}.call(this),function(){"use strict"
;var a=[Adagio.Drawer.HeadDrawer,Adagio.Drawer.AccidentalsDrawer,Adagio.Drawer.LegerLinesDrawer,Adagio.Drawer.DotDrawer,Adagio.Drawer.FlagDrawer,Adagio.Drawer.StemDrawer,Adagio.Drawer.ArticulationsDrawer,Adagio.Drawer.AboveNotationDrawer,Adagio.Drawer.LyricDrawer,Adagio.Drawer.AboveRightNotationDrawer,Adagio.Drawer.OnStemCenteredDrawer,Adagio.Drawer.FretDrawer,Adagio.Drawer.ArpeggioDrawer,Adagio.Drawer.JazzArticulationsNotationDrawer,Adagio.Drawer.TabFlagDrawer,Adagio.Drawer.TabStemDrawer,Adagio.Drawer.FingeringsDrawer],b=Adagio.Drawer.NoteDrawer=function(a){this.init(a)},c=b.prototype;c.init=function(a){this.renderedNote=a,this.noteSvg=a.noteSvg},c.drawNote=function(b){var c=this.renderedNote.getDisplayData();a.forEach(function(a){var d=new a(c);d.canDraw()&&d.draw(this.renderedNote,b)},this)}}.call(this),function(){"use strict";var a=Adagio.Utils.geometryUtils,b=Adagio.Utils.clone,c=Adagio.Utils.staffDataUtils,d=Adagio.Brush.Elem,e=Adagio.Drawer.NoteDrawer,f=Adagio.Drawer.RenderedNote=function(a){this.init(a)};f.cssClass="note",f.graceCssClass="graceNote";var g=f.prototype;g.cssClass=f.cssClass,g.init=function(a){a.isGrace()&&(this.cssClass=f.graceCssClass),this.parentSvg=null,this.noteSvg=new d("g");var b=this.cssClass+" "+a.getGlobalCssClassesStr();this.setCssClass(b),this.stemBaseGroup=null,this.xPos=0,this.displayData=a,this.beam=null,this.heads=null,this.frets={},this.accidentals=[],this.accidentalsWidth=null,this.articulations=[],this.technical=[],this.ornaments=[],this.dots=[],this.dotWidth=null,this.dotMargin=null,this.aboveRight=null,this.aboveRightWidth=null,this.stem=null,this.flag=null,this.flagWidth=null,this.legerLines={},this.middleHeadWidth=null,this.rightHeadWidth=null,this.leftHeadWidth=null,this.leftStemX=null,this.stemYOffset=null,this.fretsWidth=null,this.noteDrawer=null,this.rightArticulationsWidth=null,this.leftArticulationsWidth=null,this.lyric=null,this.arpeggio=null,this.localVerticalAlignment=null,this.timePos=null},g.getStaffData=function(){return this.displayData.getStaffData()},g.getVoiceIdx=function(){return this.displayData.getVoiceIdx()},g.getNbStaffLines=function(){var a=this.getStaffData();return c.getNbStaffLines(a)},g.isTabStaff=function(){var a=this.getStaffData();return c.isTabStaff(a)},g.setParent=function(a){this.parentSvg=a,this.hasLyric()&&this.lyric.setParent(a)},g.setCssClass=function(a){this.noteSvg.attr("class",a)},g.getDisplayData=function(){return this.displayData},g.getGroup=function(){return this.noteSvg},g.getStemBaseGroup=function(){if(null===this.stemBaseGroup){this.stemBaseGroup=this.noteSvg.append("g");var a=this.getDisplayData(),b=a.getStemBaseLine(),c=this.lineToY(b),d=this.getLeftStemX();this.stemBaseGroup.attr("transform","translate("+d+" "+c+")")}return this.stemBaseGroup},g.lineToY=function(b){var c=this.drawingContext.getSpaceSize(),d=this.displayData.getNbStaffLines();if(this.isTabStaff()){var e=this.drawingContext.getTabSpaceSize();return a.lineToTabY(b,c,e,d)}return a.lineToY(b,c,d)},g.getWrappedHeads=function(){var a=this.getHeads(),b={};for(var c in a){var d=a[c];b[c]=h(d,c)}return b};var h=function(a,b){return{line:b,headGroup:a,getGroup:function(){return this.headGroup}}};g.getHead=function(a){return this.getHeads()[a]},g.getHeads=function(){return null===this.heads&&this.initHeads(),this.heads},g.initHeads=function(){this.heads={},this.getDisplayData().getLines().forEach(this.initHead,this)},g.initHead=function(a){var b=this.noteSvg.append("g");this.heads[a]=b},g.getFret=function(a){return this.getFrets()[a]},g.getFrets=function(){return this.frets},g.setFret=function(a,b){this.frets[a]=b},g.addDot=function(a){this.dots.push(a)},g.setDotWidth=function(a){this.dotWidth=a},g.setDotMargin=function(a){this.dotMargin=a},g.hasAccidentals=function(){return 0!==this.accidentals.length},g.addAccidental=function(a){this.accidentals.push(a)},g.setAccidentalsWidth=function(a){this.accsWidth=a},g.getAccidentalsWidth=function(){return this.accsWidth},g.setFlag=function(a,b){this.flag=a,this.flagWidth=b},g.setAboveRight=function(a,b){this.aboveRight=a,this.aboveRightWidth=b},g.setArticulation=function(a){this.articulations.push(a)},g.setTechnical=function(a){this.technical.push(a)},g.setOrnament=function(a){this.ornaments.push(a)},g.setStem=function(a){this.stem=a},g.addLegerLine=function(a){this.legerLines[a]=!0},g.setLeftStemX=function(a){this.leftStemX=a},g.setStemYOffset=function(a){this.stemYOffset=a},g.setLeftHeadWidth=function(a){this.leftHeadWidth=a},g.setRightHeadWidth=function(a){this.rightHeadWidth=a},g.setMiddleHeadWidth=function(a){this.middleHeadWidth=a},g.hasFretsWidth=function(){return null!==this.fretsWidth},g.setFretsWidth=function(a){this.fretsWidth=a},g.hasArpeggio=function(){return null!==this.arpeggio},g.addArpeggio=function(a){this.arpeggio=a},g.addLyric=function(a){this.lyric=a,a.setParent(this.parentSvg)},g.hasLyric=function(){return null!==this.lyric},g.hasRightShiftedHead=function(){return null!==this.rightHeadWidth},g.hasLeftShiftedHead=function(){return null!==this.leftHeadWidth},g.getRightHeadWidth=function(){return this.rightHeadWidth},g.getLeftHeadWidth=function(){return this.leftHeadWidth},g.getMiddleHeadWidth=function(){return this.middleHeadWidth},g.getLeftStemX=function(){return this.leftStemX},g.getStemYOffset=function(){return this.stemYOffset},g.getFretsWidth=function(){return this.fretsWidth},g.setRightArticulationsWidth=function(a){this.rightArticulationsWidth=a},g.setLeftArticulationsWidth=function(a){this.leftArticulationsWidth=a},g.getPreviousSpace=function(){return this.calcLeadingSpace()},g.calcLeadingSpace=function(){var a=0,b=0;if(a+=this.getLeftHeadWidth(),this.hasFretsWidth()&&(a+=this.getFretsWidth()),this.accidentals.length>0&&(b+=this.accsWidth+this.drawingContext.getMarginSize()/2),this.hasTieStop()||this.hasHammerOnPullOffStop()?b=Math.max(b,this.drawingContext.getMinimalTieWidth()/2):this.hasArpeggio()&&(b+=this.arpeggio.getWidth()),this.hasGlissandoStops()&&(b=Math.max(b,this.drawingContext.getMinimalGlissandoWidth()/2)),this.hasLyric()){var c=this.lyric.getExceedingSpace()-a;b=Math.max(b,c)}return null!==this.leftArticulationsWidth&&(b+=this.leftArticulationsWidth+this.drawingContext.getMarginSize()/2),a+b},g.getWidth=function(){return this.getMiddleHeadWidth()+this.calcTrailingSpace()},g.calcTrailingSpace=function(){var a=this.getRightHeadWidth(),b=0;if(this.dots.length>0&&(b+=this.dotWidth+this.dotMargin),null!==this.flag&&(b=Math.max(b,this.flagWidth)),(this.hasTieStart()||this.hasHammerOnPullOffStart())&&(b=Math.max(b,this.drawingContext.getMinimalTieWidth()/2)),this.hasGlissandoStarts()&&(b=Math.max(b,this.drawingContext.getMinimalGlissandoWidth()/2)),this.hasLyric()){var c=this.lyric.getExceedingSpace()-a;b=Math.max(b,c)}return null!==this.aboveRight&&(b=Math.max(b,this.aboveRightWidth)),null!==this.rightArticulationsWidth&&(b+=this.rightArticulationsWidth+this.drawingContext.getMarginSize()/2),a+b},g.render=function(a){this.setDrawingContext(a),this.initLocalVerticalAlignment(),this.noteDrawer=new e(this),this.noteDrawer.drawNote(a)},g.initLocalVerticalAlignment=function(){var a=this.getNbStaffLines(),b=(a-1)/2+1;this.localVerticalAlignment={highestY:this.lineToY(b),lowestY:this.lineToY(b),highestTupletY:this.lineToY(b),lowestTupletY:this.lineToY(b)}},g.setDrawingContext=function(a){this.drawingContext=a},g.setTimePos=function(a){this.timePos=a},g.getTimePos=function(){return this.timePos},g.draw=function(){this.move(),this.drawLyric(),this.bindToParent()},g.drawLyric=function(){this.hasLyric()&&this.lyric.draw()},g.bindToParent=function(){this.parentSvg&&this.parentSvg.append(this.noteSvg)},g.unbindFromParent=function(){this.noteSvg.removeFromParent()},g.getMarginSize=function(){return this.drawingContext.getMarginSize()},g.setPosition=function(a){this.xPos=a,this.hasLyric()&&this.lyric.setXPos(a)},g.move=function(){var a=this.getXPos();this.noteSvg.attr("transform","translate("+a+" 0)")},g.getXPos=function(){return this.xPos},g.getDuration=function(){return this.displayData.getDuration()},g.getVoiceIdx=function(){return this.displayData.getVoiceIdx()},g.isRest=function(){return this.displayData.isRest()},g.hasTieStart=function(){return this.displayData.hasTieStart()},g.hasTieStop=function(){return this.displayData.hasTieStop()},g.hasHammerOnPullOffStart=function(){return this.displayData.hasHammerOnPullOffStart()},g.hasHammerOnPullOffStop=function(){return this.displayData.hasHammerOnPullOffStop()},g.hasGlissandoStops=function(){return this.displayData.hasGlissandoStops()},g.hasGlissandoStarts=function(){return this.displayData.hasGlissandoStarts()},g.getLocalHighestY=function(){return this.localVerticalAlignment.highestY},g.getLocalLowestY=function(){return this.localVerticalAlignment.lowestY},g.getHighestTupletY=function(){return Math.min(this.localVerticalAlignment.highestY,this.localVerticalAlignment.highestTupletY)},g.getLowestTupletY=function(){return Math.max(this.localVerticalAlignment.lowestY,this.localVerticalAlignment.lowestTupletY)},g.getLocalLowestYWithMarge=function(){var a=this.drawingContext.getSpaceSize();return this.getLocalLowestY()+.5*a},g.getLocalHighestYWithMarge=function(){var a=this.drawingContext.getSpaceSize();return this.getLocalHighestY()-.5*a},g.getHighestYWithMarge=function(){return this.getHighestY()-.5*this.drawingContext.getSpaceSize()},g.getHighestY=function(){return this.getVerticalAlignment().highestY},g.getLowestYWithMarge=function(){return this.getLowestY()+.5*this.drawingContext.getSpaceSize()},g.getLowestY=function(){return this.getVerticalAlignment().lowestY},g.getVerticalAlignment=function(){return this.localVerticalAlignment},g.setHighestY=function(a){var b=this.localVerticalAlignment.highestY,c=Math.min(b,a);this.localVerticalAlignment.highestY=c},g.setHighestTupletY=function(a){this.localVerticalAlignment.highestTupletY=a},g.setLowestTupletY=function(a){this.localVerticalAlignment.lowestTupletY=a},g.setLowestY=function(a){var b=this.localVerticalAlignment.lowestY,c=Math.max(b,a);this.localVerticalAlignment.lowestY=c},g.setHighestYLine=function(a){var b=this.lineToY(a);this.setHighestY(b)},g.setLowestYLine=function(a){var b=this.lineToY(a);this.setLowestY(b)},g.setHighestLowestY=function(a){this.setHighestY(a),this.setLowestY(a)},g.setHighestLowestYLine=function(a){this.setHighestYLine(a),this.setLowestYLine(a)},g.getYInfos=function(){return b(this.localVerticalAlignment)},g.setLyricUpY=function(a){this.lyric.setYPos(a)},g.getLyricHeight=function(){return this.lyric.getHeight()},g.getLyricLevelWidth=function(a){return this.lyric.getLevelWidth(a)},g.getLyricLevelPosY=function(a){return this.lyric.getLevelPosY(a)},g.hasLyricLevel=function(a){return!!this.hasLyric()&&this.lyric.hasLevel(a)},g.getLyricBeginLevels=function(){return this.hasLyric()?this.lyric.getBeginLevels():[]},g.getLyricEndLevels=function(){return this.hasLyric()?this.lyric.getEndLevels():[]},g.updateVerticalDisplay=function(){this.hasLyric()&&this.lyric.move()},g.updateHorizontalDisplay=function(){this.hasLyric()&&this.lyric.move()}}.call(this),function(){"use strict";var a=Adagio.Utils.noteLocationUtils={};a.copy=function(b){return a.create(b.measureIdx,b.voiceIdx,b.noteIdx)},a.create=function(a,b,c){return{measureIdx:a,voiceIdx:b,noteIdx:c}},a.isGreaterOrEqual=function(b,c){return a.isEqual(b,c)||a.isGreater(b,c)},a.isEqual=function(a,b){return a.measureIdx===b.measureIdx&&a.noteIdx===b.noteIdx},a.isGreater=function(a,b){var c=a.measureIdx-b.measureIdx;return c>0||!(c<0)&&a.noteIdx-b.noteIdx>0},a.isLower=function(a,b){var c=a.measureIdx-b.measureIdx;return c<0||!(c>0)&&a.noteIdx-b.noteIdx<0}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Values.SlurType,c=Adagio.Values.Stem,d=Adagio.Utils.noteLocationUtils,e=Adagio.Drawer.slur.SlurAnchor=function(a,b,c,d){this.init(a,b,c,d)},f=e.prototype;f.init=function(a,b,c,d){this.measure=null,this.slur=null,this.measureIdx=null,this.type=a,this.noteIdx=b,this.voiceIdx=c,this.stemStrategy=d},f.setMeasure=function(a){this.measure=a},f.hasPosition=function(){return null!==this.measure.getXPos()},f.getLocation=function(){var a=this.getNoteIdx();return d.create(this.measureIdx,this.voiceIdx,a)},f.getFirstStem=function(){var a=this.getNoteIdx(),b=this.measure.getNote(this.voiceIdx,a);return b.isRest()?c.UP:b.getDisplayData().getStemValue()},f.getStemStrategy=function(){return this.stemStrategy},f.getNoteIdx=function(){if(null!==this.noteIdx)return this.noteIdx;if(this.type===b.START)return 0;if(this.type===b.STOP){return this.measure.getNbNotes(this.voiceIdx)-1}throw new a("Unexpected")},f.getLeftCrossPoints=function(){if(this.type!==b.START||this.isMiddle()){throw new a("Unexpected","Cannot call `getLeftCrossPoints` on a non left cross measure anchor.")}var c=this.measure.tickableContent,d=this.measure.getXPos()+c.getXPos(),e=this.measure.drawingContext,f=e.getMarginSize(),g=d-(c.getPreviousSpace()+f);return this.createPoints(g)},f.getRightCrossPoints=function(){if(this.type!==b.STOP||this.isMiddle()){throw new a("Unexpected","Cannot call `getRightCrossPoints` on a non right cross measure anchor.")}var c=this.measure,d=c.tickableContent,e=c.getXPos()+d.getXPos(),f=e+d.getWidth();return this.createPoints(f)},f.createPoints=function(a){var b=this.getNoteIdx(),c=this.measure.getNote(this.voiceIdx,b),d={above:[],below:[]},e=g(c),f={x:a,y:e};d.above.push(f);var i=h(c),j={x:a,y:i};return d.below.push(j),d};var g=function(a){var b=a.drawingContext,c=b.getMarginSize(),d=-c,e=a.getHighestYWithMarge();return Math.min(d,e)},h=function(a){var b=a.getNbStaffLines(),c=a.drawingContext,d=a.isTabStaff()?c.getTabSpaceSize():c.getSpaceSize(),e=(b-.5)*d,f=a.getLowestYWithMarge();return Math.max(e,f)};f.isMiddle=function(){return null!==this.noteIdx},f.hasCrossMeasure=function(){return null===this.noteIdx},f.hasSlur=function(){return null!==this.slur},f.isLeft=function(){return this.type===b.START},f.isRight=function(){return this.type===b.STOP},f.setSlur=function(a){this.slur=a},f.getSlur=function(){return this.slur},f.removeSlur=function(){this.isLeft()?this.slur.removeLeftAnchor():this.isRight()?this.slur.removeRightAnchor():b.raiseError(this.type)},f.setNeedDrawUpdate=function(){if(this.hasSlur()){this.getSlur().setNeedDrawUpdate()}},f.setMeasureIdx=function(a){this.measureIdx=a},f.getMeasureIdx=function(){return this.measureIdx}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.noteUtils,c=Adagio.Utils.slurUtils,d=Adagio.Values.SlurType,e=Adagio.Drawer.slur.SlurAnchor,f=Adagio.Render.SlurAnchorsBuilder=function(){this.init()},g=f.prototype;g.init=function(){this.voice=null,this.measureJson=null,this.voiceNotes=null},g.build=function(a,b,c,d,e){this.voice=a,this.voiceNotes=c,this.measureJson=d,this.stemStrategy=e,this.voiceIdx=b,this.addMiddleAnchors(),this.addLeftContinueAnchors(),this.addRightContinueAnchors()},g.addMiddleAnchors=function(){for(var a=this.voiceNotes.length,b=0;b<a;b++){var c=this.voiceNotes[b].chordJson[0];if(h(c)){var d=i(c);this.addMiddleAnchor(d,b)}}};var h=function(a){return b.hasSlur(a)},i=function(a){return b.getSlur(a)};g.addMiddleAnchor=function(a,b){var d=c.getType(a),f=new e(d,b,this.voiceIdx,this.stemStrategy);this.voice.addMiddleSlurAnchor(f)},g.addLeftContinueAnchors=function(){if(a.hasLeftSlur(this.measureJson,this.voiceIdx)){var b=new e(d.START,null,this.voiceIdx,this.stemStrategy);this.voice.setLeftSlurAnchor(b,this.voiceIdx)}},g.addRightContinueAnchors=function(){if(a.hasRightSlur(this.measureJson,this.voiceIdx)){var b=new e(d.STOP,null,this.voiceIdx,this.stemStrategy);this.voice.setRightSlurAnchor(b,this.voiceIdx)}}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Values.Stem,c={UP:1,DOWN:2,HORIZ:3},d=Adagio.Drawer.BeamDisplayData=function(a){this.init(a)},e=d.prototype;e.init=function(a){this.stemValue=null,this.notes=[],this.avgLines=null,this.beamInnerDuration=null,this.opts=a},e.addNote=function(a){this.notes.push(a),a.setBeamData(this)},e.setStemValue=function(c){if(c!==b.UP&&c!==b.DOWN)throw new a("unexpected");this.stemValue=c},e.getStemValue=function(){return null===this.stemValue&&this.calcStemValue(),this.stemValue},e.assertNotTabStaff=function(){if(this.isTabStaff()){throw new a("Unexpected","Stem direction must be defined for beams on tab staff.")}},e.getStemCoeff=function(){return this.getStemValue()===b.UP?1:-1},e.calcStemValue=function(){this.isStemDefined()?this.isStemConsistent():(this.assertNotTabStaff(),this.inferStemFromLines())},e.isStemDefined=function(){return void 0===this.stemDefined&&this.parseStemDefinition(),this.stemDefined},e.isStemConsistent=function(){return void 0===this.stemConsistent&&this.parseStemDefinition(),this.stemConsistent},e.parseStemDefinition=function(){this.stemDefined=!1,this.stemConsistent=!0;for(var a=0;a<this.notes.length&&this.stemConsistent;){var b=this.notes[a];b.isStemSpecified()&&(this.stemDefined?b.getSpecifiedStem()!==this.stemValue&&(this.stemConsistent=!1):(this.stemDefined=!0,this.stemValue=b.getSpecifiedStem())),a++}},e.inferStemFromLines=function(){var a=this.getGlobalLineAvg();this.stemValue=a>=3?b.DOWN:b.UP},e.getGlobalLineAvg=function(){return this.getAvgLines().reduce(function(a,b){return a+b})/this.notes.length},e.getAvgLines=function(){return null===this.avgLines&&this.calcAvgLines(),this.avgLines},e.calcAvgLines=function(){this.avgLines=this.notes.map(function(a){return a.getLineAvg()})},e.computeStemQueueLines=function(){this.isHorizontal()?this.computeStemQueuesLinesHorizontal():this.computeStemQueuesLinesNonHorizontal()},e.isHorizontal=function(){return!!this.isTabStaff()||(!!this.areFirstAndLastLinesSame()||(!!this.isMajoritySameLine()||!!this.isChaotic()))},e.isTabStaff=function(){return this.opts.isTabStaff},e.areFirstAndLastLinesSame=function(){var a=this.getAvgLines();return a[0]===a[a.length-1]},e.isMajoritySameLine=function(){var a=this.getAvgLines();if(a.length<4)return!1;var b=a.reduce(function(a,b){return void 0===a[b]&&(a[b]=0),a[b]++,a},{});return f(b)>=a.length/2};var f=function(a){var b=0;for(var c in a){var d=a[c];b=Math.max(b,d)}return b};e.isChaotic=function(){return!1},e.getDirection=function(){var a=this.getGlobalLineAvg();return a[0]>a[a.length-1]?c.DOWN:c.UP},e.computeStemQueuesLinesHorizontal=function(){var a=this.getFarestStemQueueLine();this.applyMaxQueueLine(a)},e.getFarestStemQueueLine=function(){var a=this.getOrphanStemQueueLines(),c=this.getStemValue();return a.reduce(function(a,d){return c===b.UP?Math.max(a,d):Math.min(a,d)})},e.getOrphanStemQueueLines=function(){return this.notes.map(function(a){return a.getSingleNoteStemQueueLine()})},e.applyMaxQueueLine=function(a){this.notes.forEach(function(b){b.stemQueueLine=a})},e.computeStemQueuesLinesNonHorizontal=function(){this.initNotesStemQueueLine(),this.isBeamTooOblic()&&this.flattenBeam();var a=this.getRequiredStemOffset();this.applyOffset(a),this.alignQueuesToBeam()},e.initNotesStemQueueLine=function(){this.notes.forEach(g)};var g=function(a){var b=a.getSingleNoteStemQueueLine();a.stemQueueLine=b};e.isBeamTooOblic=function(){var a=this.notes[0].getStemQueueLine(),b=this.notes.length-1,c=this.notes[b].getStemQueueLine();return Math.abs(a-c)>.5},e.flattenBeam=function(){var a=this.getBeamExternalEndNote(),b=this.getBeamInternalEndNote(),c=b.getStemQueueLine();c+=.5*this.getStemCoeff(),a.stemQueueLine=c},e.getBeamExternalEndNote=function(){var a=this.notes[0],b=a.getStemQueueLine(),c=this.notes.length-1,d=this.notes[c],e=d.getStemQueueLine();return h(b,e,this.getStemValue())?a:d},e.getBeamInternalEndNote=function(){var a=this.notes[0],b=a.getStemQueueLine(),c=this.notes.length-1,d=this.notes[c],e=d.getStemQueueLine();return h(b,e,this.getStemValue())?d:a};var h=function(a,c,d){return d===b.UP&&a>c||d===b.DOWN&&a<c};e.getRequiredStemOffset=function(){var a=0,c=this.getStemValue();return this.notes.reduce(function(d,e){var f=this.calcQueueForTick(a),g=this.calcRequiredQueueLineInBeam(e);d=c===b.UP?i(g,f,d):k(g,f,d);var h=m(e);return a+=h,d}.bind(this),0)},e.calcRequiredQueueLineInBeam=function(a){var b=a.getTailHeadLine(),c=a.getNbFlags();return 1===c?b+2.5*this.getStemCoeff():b+(1+c)*this.getStemCoeff()};var i=function(a,b,c){return b+c<a&&(c=a-b,c=j(c)),c},j=function(a){return a*=2,a=Math.ceil(a),a/=2},k=function(a,b,c){return b+c>a&&(c=a-b,c=l(c)),c},l=function(a){return a*=2,a=Math.floor(a),a/=2};e.calcQueueForTick=function(a){var b=this.getBeamInnerDuration(),c=this.notes[0],d=c.getStemQueueLine(),e=this.notes.length-1;return d+a*(this.notes[e].getStemQueueLine()-d)/b},e.getBeamInnerDuration=function(){return null===this.beamInnerDuration&&this.calcBeamInnerDuration(),this.beamInnerDuration},e.calcBeamInnerDuration=function(){var a=this.getDurations(),b=a.slice(0,a.length-1);this.beamInnerDuration=b.reduce(function(a,b){return a+b})},e.getDurations=function(){return this.notes.map(m)};var m=function(a){return a.isGrace()?1:a.getDuration()};e.applyOffset=function(a){this.notes[0].stemQueueLine+=a;var b=this.notes.length-1;this.notes[b].stemQueueLine+=a},e.getDirectionCoeff=function(){return this.getStemValue()===b.UP?1:-1},e.alignQueuesToBeam=function(){if(this.notes.length>2){var a=this.notes[0],b=a.getDuration();this.notes.slice(1,this.notes.length-1).forEach(function(a){var c=this.calcQueueForTick(b);a.stemQueueLine=c;var d=a.getDuration();b+=d},this)}},e.getTicks=function(){var a=this.getDurations(),b=0;return a.map(function(a){var c=b;return b+=a,c})}}.call(this),function(){"use strict";var a=Adagio.Values.Stem,b=Adagio.Values.BeamType,c=Adagio.Utils.geometryUtils,d=Adagio.Utils.beamUtils,e=Adagio.Brush.Elem,f=Adagio.Drawer.BeamDisplayData,g=.75,h=Adagio.Drawer.RenderedBeam=function(a){this.init(a)},i=h.prototype;i.init=function(a){this.notes=[],this.displayData=new f(a),this.opts=a||{},this.parent=null,this.svgGroup=new e("g"),this.drawnBeams=[],this.drawingContext=null,this.headWidth=null,this.currentBeams={}},i.setParent=function(a){this.parent=a},i.addNote=function(a){this.notes.push(a),a.beam=this,this.displayData.addNote(a.getDisplayData())},i.setDrawingContext=function(a){this.drawingContext=a},i.forceStemValue=function(a){this.displayData.setStemValue(a)},i.draw=function(){this.parent&&this.bindToParent();var a=this.getXShift();a>0&&this.svgGroup.attr("transform","translate("+a+" 0)")},i.getXShift=function(){return this.isTabStaff()?0:this.displayData.getStemValue()===a.UP?this.getHeadWidth():0},i.getHeadWidth=function(){return this.notes[0].getMiddleHeadWidth()},i.bindToParent=function(){this.parent.append(this.svgGroup)},i.updateConnections=function(){this.hasConnections()&&this.removeConnections(),this.renderConnections()},i.hasConnections=function(){return this.drawnBeams.length>0},i.removeConnections=function(){for(;this.drawnBeams.length>0;)this.drawnBeams.shift().removeFromParent()},i.renderConnections=function(){this.slopeCoeff=null,this.notes.forEach(function(a){var b=a.getDisplayData();if(this.queueLine=b.getStemQueueLine(),this.xPos=a.getXPos(),this.isTabStaff()){var c=a.getFretsWidth(),d=this.drawingContext.getStemThickness();this.xPos+=c/2-d/2}this.drawSegment(b,a)},this)},i.drawSegment=function(a,c){a.getBeams().forEach(function(a){var e=d.getType(a),f=d.getNumber(a);e===b.CONTINUE||(e===b.BEGIN?this.startBeam(f):e===b.END?this.stopBeam(f):e===b.FORWARD?this.drawForwardHook(f,c):e===b.BACKWARD?this.drawBackwardHook(f,c):b.raiseError(e))},this)},i.startBeam=function(a){a=this.isGrace()?a*g:a;var b=this.queueLine-a*this.getStemCoeff(),c=b-this.getStemScale()*this.getStemCoeff(),d={x1:this.xPos,x2:this.xPos,y1:this.lineToY(b),y2:this.lineToY(c)};this.currentBeams[a]=d},i.stopBeam=function(a){a=this.isGrace()?a*g:a;var b=this.queueLine-a*this.getStemCoeff(),c=b-this.getStemScale()*this.getStemCoeff(),d=this.currentBeams[a];delete this.currentBeams[a];var e=this.svgGroup.append("polygon"),f=d.x1+","+d.y1+" "+d.x2+","+d.y2+" "+this.xPos+","+this.lineToY(c)+" "+this.xPos+","+this.lineToY(b)+" ";e.attr("points",f),this.drawnBeams.push(e)},i.drawForwardHook=function(a,b){a=this.isGrace()?a*g:a;var c=this.queueLine-a*this.getStemCoeff(),d=c-this.getStemScale()*this.getStemCoeff(),e=this.xPos,f=this.xPos+b.getMiddleHeadWidth(),h=this.lineToY(c),i=this.lineToY(d),j=this.getSlopeCoeff(),k=j*b.getMiddleHeadWidth(),l=h+k,m=i+k,n=this.svgGroup.append("polygon"),o=e+","+h+" "+e+","+i+" "+f+","+m+" "+f+","+l+" ";n.attr("points",o),this.drawnBeams.push(n)},i.drawBackwardHook=function(a,b){a=this.isGrace()?a*g:a;var c=this.queueLine-a*this.getStemCoeff(),d=c-this.getStemScale()*this.getStemCoeff(),e=this.xPos,f=this.xPos-b.getMiddleHeadWidth(),h=this.lineToY(c),i=this.lineToY(d),j=this.getSlopeCoeff(),k=j*-b.getMiddleHeadWidth(),l=h+k,m=i+k,n=this.svgGroup.append("polygon"),o=e+","+h+" "+e+","+i+" "+f+","+m+" "+f+","+l+" ";n.attr("points",o),this.drawnBeams.push(n)},i.getSlopeCoeff=function(){if(null===this.slopeCoeff)if(this.isTabStaff())this.slopeCoeff=0;else{var a=this.notes[0],b=this.notes.length-1,c=this.notes[b];this.slopeCoeff=this.calcSlope(a,c)}return this.slopeCoeff},i.calcSlope=function(a,b){var c=a.getXPos(),d=a.getDisplayData(),e=d.getStemQueueLine(),f=this.lineToY(e),g=b.getXPos(),h=b.getDisplayData(),i=h.getStemQueueLine();return(this.lineToY(i)-f)/(g-c)},i.lineToY=function(a){var b=this.notes[0],d=b.getDisplayData(),e=d.getNbStaffLines(),f=this.drawingContext.getSpaceSize();if(this.isTabStaff()){var g=this.drawingContext.getTabSpaceSize();return c.lineToTabY(a,f,g,e)}return c.lineToY(a,f,e)},i.isTabStaff=function(){return this.opts.isTabStaff},i.getStemCoeff=function(){return this.displayData.getStemCoeff()},i.getStemScale=function(){return this.isGrace()?.35:.5},i.isGrace=function(){return this.opts.isGrace||!1}}.call(this),function(){"use strict";var a=Adagio.Utils.typeUtils,b=Adagio.Utils.noteUtils,c=Adagio.Values.BeamType,d=Adagio.Drawer.RenderedBeam,e=Adagio.Render.BeamProcessor=function(a){this.init(a)};e.prototype.init=function(a){this.voiceId="1",this.beamNumber=0,this.beamType="",this.renderedNote=null,this.container=a,this.beamNotes={}},e.prototype.canProcess=function(c){return c=a.makeArray(c),c.some(b.hasBeam)},e.prototype.addNote=function(c,d){c=f(c),this.voiceId=b.getVoiceId(c),this.renderedNote=d;var e=a.makeArray(c.beam);this.processBeams(e)};var f=function(c){return c=a.makeArray(c),c.find(b.hasBeam)};e.prototype.processBeams=function(a){a.forEach(this.processBeam,this)},e.prototype.processBeam=function(a){this.extractBeamData(a),"1"===this.beamNumber&&(this.beamType===c.BEGIN?this.beginBeam():this.beamType===c.CONTINUE?this.continueBeam():this.endBeam())},e.prototype.beginBeam=function(){this.beamNotes[this.voiceId]=[],this.beamNotes[this.voiceId].push(this.renderedNote)},e.prototype.continueBeam=function(){void 0!==this.beamNotes[this.voiceId]&&this.beamNotes[this.voiceId].push(this.renderedNote)},e.prototype.endBeam=function(){var a=this.beamNotes[this.voiceId];a.push(this.renderedNote);var b={isTabStaff:this.renderedNote.isTabStaff()},c=new d(b);a.forEach(function(a){c.addNote(a)}),this.container.addBeam(c),this.beamNotes[this.voiceId]=null},e.prototype.extractBeamData=function(a){this.beamNumber=e.getBeamNumber(a),"1"===this.beamNumber?this.beamType=e.getBeamType(a):this.beamType=null},e.getBeamNumber=function(a){return a.$number.toString()};var g=a.arrayToSet([c.BEGIN,c.CONTINUE,c.END]);e.getBeamType=function(a){if(g[a.content])return a.content;throw new Error("the beam type "+a.content+" in not recognized")}}.call(this),function(){"use strict";var a=Adagio.Brush.Elem,b=Adagio.Drawer.tie.TieArc=function(a,b,c,d,e){this.init(a,b,c,d,e)};b.cssClass="tieArc";var c=b.prototype;c.cssClass=b.cssClass,c.init=function(b,c,d,e,f){this.parentGroup=b,this.path=new a("path"),this.path.attr("class",this.cssClass),this.drawingContext=null,this.width=null,this.height=null,this.placement=e,this.leftOffset=c,this.rightOffset=d,this.rightRefOffset=f,this.needRender=!0},c.setDrawingContext=function(a){this.drawingContext=a},c.setSize=function(a,b){this.width=a,this.tieHeight=b,this.needRender=!0},c.render=function(){this.computePoints(),this.renderPath(),this.needRender=!1},c.computePoints=function(){var a=this.getPlacementCoeff(),b=this.drawingContext.getTieEndpointThickness(),c=this.drawingContext.getTieMidpointThickness();this.upLeftY=-b/2,this.downLeftY=b/2,this.upRightY=-b/2+this.rightRefOffset,this.downRightY=b/2+this.rightRefOffset,this.upMidY=this.tieHeight*a-c/2+this.rightRefOffset/2,this.downMidY=this.tieHeight*a+c/2+this.rightRefOffset/2,this.upControlY=3*this.upMidY-2*this.upLeftY,this.downControlY=3*this.downMidY-2*this.downLeftY},c.renderPath=function(){var a=this.getXMiddle(),b=this.getXLeft(),c=this.getXRight(),d="M "+b+" "+this.upLeftY+" Q "+a+" "+this.upControlY+" "+c+" "+this.upRightY+" V "+this.downRightY+" Q "+a+" "+this.downControlY+" "+b+" "+this.downLeftY+" V "+this.upLeftY;this.path.attr("d",d)},c.getXLeft=function(){return this.leftOffset},c.getXRight=function(){return this.width+this.rightOffset},c.getXMiddle=function(){return(this.getXLeft()+this.getXRight())/2},c.getWidth=function(){return this.width},c.getHeight=function(){return this.needRender&&this.render(),Math.max(this.downLeftY,this.downRightY,this.downMidY)-Math.min(this.upLeftY,this.upRightY,this.upMidY)},c.getPlacementCoeff=function(){return"above"===this.placement?-1:1},c.draw=function(){this.needRender&&this.render(),this.move(),this.bindToParent()},c.bindToParent=function(){this.parentGroup.append(this.path)},c.erase=function(){null!==this.parent&&this.unbindFromParent()},c.unbindFromParent=function(){this.path.removeFromParent()},c.move=function(){this.path.attr("transform","translate("+this.posX+" "+this.posY+")")},c.setPosX=function(a){this.posX=a},c.setPosY=function(a){this.posY=a},c.updateHorizontalDisplay=function(){this.needRender&&this.render(),this.move()},c.getBottomY=function(){return this.needRender&&this.render(),Math.max(this.downLeftY,this.downMidY,this.downRightY)},c.getTopY=function(){return this.needRender&&this.render(),Math.min(this.upLeftY,this.upMidY,this.upRightY)}}.call(this),function(){"use strict";var a=Adagio.Values.Stem,b=Adagio.Drawer.tie.TieDisplayData=function(){this.init()},c=b.prototype;c.init=function(){this.lines=[],this.ties={}},c.setLeftNote=function(a){this.leftNote=a},c.setRightNote=function(a){this.rightNote=a},c.fillData=function(){this.extractTies(),this.fillPlacement(),this.fillAllExternals(),this.fillLeftTieColliding(),this.fillRightTieColliding(),this.fillLeftSideShift(),this.fillRightSideShift()},c.extractTies=function(){this.lines=this.leftNote.getTieStarts().slice();var a=this.rightNote.getTieStops().slice();d(this.lines,a),this.lines.forEach(function(b,c){var d=a[c];this.addTie(b,d)},this)};var d=function(a,b){var c=a.length-b.length;c>0?a.splice(0,c):c<0&&b.splice(0,c)};c.addTie=function(a,b){var c={line:a,rightLine:b,rightSide:{},leftSide:{},staffData:this.leftNote.getStaffData()};this.ties[a]=c},c.fillPlacement=function(){this.isChord()?this.fillChordPlacement():this.fillSingleNotePlacement()},c.isChord=function(){return this.lines.length>1},c.fillSingleNotePlacement=function(){var b=this.ties[this.lines[0]];if(this.hasSameStemDirection()){this.leftNote.getStemValue()===a.UP?b.placement="below":b.placement="above"}else{var c=b.line;b.placement=c>=3?"above":"below"}},c.hasSameStemDirection=function(){return this.leftNote.getStemValue()===this.rightNote.getStemValue()},c.fillChordPlacement=function(){var a=this.getHighestTie(),b=this.getLowestTie();a.placement="above",b.placement="below",this.getInternalLines().forEach(function(a){var b=this.ties[a];b.placement=a>=3?"above":"below"},this)},c.fillAllExternals=function(){var a=this.getHighestLine();if(this.fillExternal(a),this.isChord()){var b=this.getLowestLine();this.fillExternal(b);this.getInternalLines().forEach(this.setNotExternal,this)}},c.fillExternal=function(a){
var b=this.ties[a],c=b.placement,d=e(this.leftNote,a,c),f=e(this.rightNote,a,c);b.isExternal=d&&f};var e=function(a,b,c){return"above"===c?a.isHighestLine(b):a.isLowestLine(b)};c.getInternalLines=function(){return this.lines.slice(1,-1)},c.setNotExternal=function(a){this.ties[a].isExternal=!1},c.fillLeftTieColliding=function(){var b=this.getHighestTie(),c=this.leftNote.hasStem()&&this.leftNote.getStemValue()===a.UP&&"above"===b.placement;b.leftSide.stemColliding=c},c.getHighestTie=function(){var a=this.getHighestLine();return this.ties[a]},c.fillRightTieColliding=function(){var b=this.getLowestTie(),c=this.rightNote.hasStem()&&this.rightNote.getStemValue()===a.DOWN&&"below"===b.placement;b.rightSide.stemColliding=c},c.getLowestTie=function(){var a=this.getLowestLine();return this.ties[a]},c.getHighestLine=function(){return this.lines[0]},c.getLowestLine=function(){return this.lines[this.lines.length-1]},c.fillLeftSideShift=function(){this.fillShift(this.leftNote,function(a){return a.leftSide})},c.fillRightSideShift=function(){this.fillShift(this.rightNote,function(a){return a.rightSide})},c.fillShift=function(b,c){this.lines.forEach(function(d){var e=this.ties[d],f=c(e),g=b.getStemValue();g===a.UP&&b.isSecondHigher(d)?f.shiftRight=!0:g===a.DOWN&&b.isSecondLower(d)&&(f.shiftLeft=!0)},this)},c.forEachTie=function(a,b){this.lines.forEach(function(c,d){var e=this.ties[c];a.call(b,e,d)},this)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.staffDataUtils,c=Adagio.Drawer.tie.tieOffset={};c.getLeft=function(a,b){return a.isExternal&&!a.leftSide.stemColliding?b/2:a.leftSide.shiftRight?2*b:a.leftSide.shiftLeft?0:b},c.getRight=function(a,b){return a.isExternal&&!a.rightSide.stemColliding?b/2:a.leftSide.shiftRight?b:a.leftSide.shiftLeft?-b:0},c.getVertical=function(c,d){var e;if(e=c.isExternal?d.getTieVerticalMargin():b.isTabStaff(c.staffData)?d.getTabSpaceSize()/2:2*d.getSpaceSize()/10,"above"===c.placement)return-e;if("below"===c.placement)return e;throw new a("unreachable")}}.call(this),function(){"use strict";var a=Adagio.Drawer.tie.TieArc,b=Adagio.Drawer.tie.TieDisplayData,c=Adagio.Drawer.tie.tieOffset,d=Adagio.Brush.Elem,e=Adagio.Utils.geometryUtils,f=Adagio.Utils.math,g=Adagio.Utils.staffDataUtils,h=Adagio.Drawer.tie.InternalTie=function(){this.init()};h.cssClass="tie";var i=h.prototype;i.cssClass=h.cssClass,i.init=function(){this.arcs=null,this.displayData=new b,this.drawingContext=null,this.parent=null,this.svgGroup=new d("g"),this.svgGroup.attr("class",this.cssClass),this.needDrawUpdate=!1},i.setParent=function(a){this.parent=a},i.setLeftNote=function(a){this.leftNote=a,this.displayData.setLeftNote(a.getDisplayData())},i.setRightNote=function(a){this.rightNote=a,this.displayData.setRightNote(a.getDisplayData())},i.setDrawingContext=function(a){this.drawingContext=a},i.getArcs=function(){return null===this.arcs&&this.initArcs(),this.arcs},i.initArcs=function(){this.displayData.fillData(),this.arcs=[],this.displayData.forEachTie(this.initArc,this)},i.initArc=function(b){var d=this.leftNote.getMiddleHeadWidth(),e=c.getLeft(b,d),f=this.rightNote.getMiddleHeadWidth(),h=c.getRight(b,f),i=0,j=new a(this.getGroup(),e,h,b.placement,i),k=g.getNbStaffLines(b.staffData),l=g.isTabStaff(b.staffData),m=this.lineToY(b.line,l,k);m+=c.getVertical(b,this.drawingContext),j.setPosY(m),j.setDrawingContext(this.drawingContext),this.arcs.push(j)},i.lineToY=function(a,b,c){var d=b?this.drawingContext.getTabSpaceSize():this.drawingContext.getSpaceSize();return e.lineToY(a,d,c)},i.updateArcs=function(){this.getArcs().forEach(this.updateArc,this),this.needDrawUpdate=!1},i.updateArc=function(a){var b=this.drawingContext.getTieHorizontalMargin(),c=this.leftNote.getXPos()+b,d=this.rightNote.getXPos()-b,e=d-c,f=l(),g=f(e);a.setSize(e,g),a.setPosX(c)},i.setNeedDrawUpdate=function(){this.needDrawUpdate=!0},i.draw=function(){this.needDrawUpdate&&this.updateArcs(),this.getArcs().forEach(j),this.bindToParent()};var j=function(a){a.draw()};i.bindToParent=function(){this.parent.append(this.getGroup())},i.getGroup=function(){return this.svgGroup};var k=null,l=function(){if(null===k){var a=3,b=2/3,c=30,d=2,e=f.solveLinearA(a,b,c,d),g=f.solveLinearB(a,b,e);k=function(a){return e*a+g}}return k};i.updateHorizontalDisplay=function(){this.needDrawUpdate&&this.updateArcs(),this.getArcs().forEach(m)};var m=function(a){a.updateHorizontalDisplay()};i.getTopY=function(){var a=this.getTopArc(),b=a.getTopY();return a.posY+b},i.getTopArc=function(){return this.getArcs()[0]},i.getBottomY=function(){var a=this.getBottomArc(),b=a.getBottomY();return a.posY+b},i.getBottomArc=function(){var a=this.getArcs();return a[a.length-1]}}.call(this),function(){"use strict";Adagio.Drawer.tie.AnchorType={START:"start",STOP:"stop"}}.call(this),function(){"use strict";Adagio.Drawer.tie.TieType={LEFT:"left",RIGHT:"right",CROSS_MEASURE:"crossMeasure"}}.call(this),function(){"use strict";var a=Adagio.Drawer.tie.AnchorType,b=Adagio.Drawer.tie.TieType,c=Adagio.Error.InternalError,d=Adagio.Drawer.tie.TieAnchor=function(a,b){this.init(a,b)},e=d.prototype;e.init=function(b,c){this.note=b,this.measure=null,this.tie=null,this.type=c,this.type!==a.START&&this.type!==a.STOP&&f(c)},e.setMeasure=function(a){this.measure=a},e.hasTie=function(){return null!==this.tie},e.hasLeftTie=function(){if(this.type===a.START){throw new c("BadTieQuery","A begin anchor cannot have a tie incoming from the left")}if(this.hasTie()){return this.getTie().getType()===b.LEFT}return!1},e.hasCrossMeasureTie=function(){if(this.hasTie()){return this.getTie().getType()===b.CROSS_MEASURE}return!1},e.setTie=function(a){this.tie=a},e.getTie=function(){return this.tie},e.removeTie=function(){this.type===a.START?this.tie.removeLeftAnchor():this.type===a.STOP?this.tie.removeRightAnchor():f(this.type)};var f=function(a){throw new c("Unreachable","The anchor type ["+a+"] is invalid.")};e.setNeedDrawUpdate=function(){if(this.hasTie()){this.getTie().setNeedDrawUpdate()}}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.typeUtils,c=Adagio.Utils.noteUtils,d=Adagio.Drawer.tie.InternalTie,e=Adagio.Drawer.tie.TieAnchor,f=Adagio.Drawer.tie.AnchorType,g=Adagio.Render.TieProcessor=function(a){this.init(a)},h=g.prototype;h.init=function(a){this.container=a,this.leftNote=null},h.canProcess=function(c){c=b.makeArray(c);var d=i(c);if(this.shouldProcess()&&!d)throw new a("TieProcessor","a tie must stop at the next note");return d},h.shouldProcess=function(){return null!==this.leftNote};var i=function(a){return a.some(c.hasTie)};h.addNote=function(a,c,d,e){a=b.makeArray(a),k(a)&&(d?this.addLeftAnchor(c):this.stopTie(c)),j(a)&&(e?this.addRightAnchor(c):this.startTie(c))};var j=function(a){return a.some(c.hasTieStart)},k=function(a){return a.some(c.hasTieStop)};h.addLeftAnchor=function(a){var b=new e(a,f.STOP);this.container.setLeftTieAnchor(b)},h.addRightAnchor=function(a){var b=new e(a,f.START);this.container.setRightTieAnchor(b)},h.startTie=function(b){if(null!==this.leftNote)throw new a("TieProcessor","a tie is already started");this.leftNote=b},h.stopTie=function(b){if(null===this.leftNote)throw new a("TieProcessor","cannot stop a non started tie");var c=new d;c.setLeftNote(this.leftNote),c.setRightNote(b),this.container.addTie(c),this.leftNote=null}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError;(Adagio.Drawer.hyphen.HyphenPos={LEFT:"left",MIDDLE:"middle",RIGHT:"right"}).raiseError=function(b){throw new a("BadHyphenPos","The hyphen position ["+b+"] is invalid.")}}.call(this),function(){"use strict";var a=Adagio.Brush.Elem,b=Adagio.Drawer.Text,c=Adagio.Drawer.hyphen.HyphenPos,d=Adagio.Drawer.hyphen.Hyphen=function(a){this.init(a)};d.cssClass="hyphen";var e=d.prototype;e.cssClass=d.cssClass,e.init=function(a){this.position=a,this.parentGroup=null,this.text=null,this.group=null,this.drawn=!1,this.drawingContext=null,this.width=null,this.posX=null,this.posY=null,this.drawn=!1},e.setDrawingContext=function(a){this.drawingContext=a},e.setParent=function(a){this.parentGroup=a},e.setPosition=function(a){this.position=a},e.render=function(){this.group=new a("g"),this.group.attr("class",this.cssClass);var c={};c["font-size"]=this.drawingContext.getLyricsFontSize(),c["font-family"]=this.drawingContext.getLyricFontFamily(),c.text="-",this.text=new b(c),this.text.setParent(this.group),this.text.setDrawingContext(this.drawingContext),this.text.render(),null!==this.width&&this.updateTextPos()},e.setWidth=function(a){this.width=a,this.isRendered()&&this.updateTextPos()},e.updateTextPos=function(){var a=this.getTextXPos();this.text.setXPos(a),this.text.move()},e.getTextXPos=function(){var a=this.text.getWidth(),b=this.getWidth();return this.position===c.LEFT?a:this.position===c.MIDDLE?b/2-a/2:this.position===c.RIGHT?b-2*a:void c.raiseError(this.position)},e.getWidth=function(){return this.width},e.draw=function(){this.isRendered()||this.render(),this.text.draw(),this.move(),this.bindToParent()},e.isRendered=function(){return null!==this.group},e.bindToParent=function(){this.drawn||(this.parentGroup.append(this.group),this.drawn=!0)},e.erase=function(){this.unbindFromParent()},e.unbindFromParent=function(){this.drawn&&(this.parentGroup.removeFromParent(),this.drawn=!1)},e.move=function(){null!==this.posX&&null!==this.posY&&this.group.attr("transform","translate("+this.posX+" "+this.posY+")")},e.setPosX=function(a){this.posX=a},e.setPosY=function(a){this.posY=a}}.call(this),function(){"use strict";var a=Adagio.Drawer.hyphen.Hyphen,b=Adagio.Error.InternalError,c=Adagio.Brush.Elem,d=Adagio.Utils.mapUtils,e=Adagio.Drawer.hyphen.InternalHyphen=function(a){this.init(a)};e.cssClass="internalHyphen";var f=e.prototype;f.cssClass=e.cssClass,f.init=function(a){this.hyphens=null,this.positionsMap=a,this.drawingContext=null,this.parent=null,this.svgGroup=new c("g"),this.svgGroup.attr("class",this.cssClass)},f.setParent=function(a){this.parent=a},f.setLeftNote=function(a){this.leftNote=a},f.setRightNote=function(a){this.rightNote=a},f.setDrawingContext=function(a){this.drawingContext=a},f.updateHorizontalDisplay=function(){this.isRendered()||this.render(),this.updateHyphensHorizontal(),this.drawHyphens(),this.bindToParent()},f.updateHyphensHorizontal=function(){this.forEachHyphen(this.updateHyphenHorizontal,this)},f.updateHyphenHorizontal=function(a,b){var c=this.leftNote.getXPos();if(this.leftNote.hasLyricLevel(a)){c+=this.leftNote.getMiddleHeadWidth()/2+this.leftNote.getLyricLevelWidth(a)/2}var d=this.rightNote.getXPos();if(this.rightNote.hasLyricLevel(a)){var e=this.rightNote.getMiddleHeadWidth();d-=this.rightNote.getLyricLevelWidth(a)/2-e/2}var f=d-c;b.setWidth(f),b.setPosX(c)},f.updateVerticalDisplay=function(){this.isRendered()||this.render(),this.updateHyphensVertical(),this.drawHyphens(),this.bindToParent()},f.isRendered=function(){return null!==this.svgGroup},f.render=function(){this.svgGroup=new c("g"),this.svgGroup.attr("class",this.cssClass)},f.updateHyphensVertical=function(){this.forEachHyphen(this.updateHyphenVertical,this)},f.updateHyphenVertical=function(a,b){var c=this.getLevelPosY(a);b.setPosY(c)},f.getLevelPosY=function(a){if(this.leftNote.hasLyricLevel(a))return this.leftNote.getLyricLevelPosY(a);if(this.rightNote.hasLyricLevel(a))return this.rightNote.getLyricLevelPosY(a);throw new b("Unexpected","There should be at least one lyric side at the level ["+a+"].")},f.drawHyphens=function(){this.forEachHyphen(g)},f.forEachHyphen=function(a,b){var c=this.getHyphens();d.forEach(c,a,b)},f.getHyphens=function(){return null===this.hyphens&&this.initHyphens(),this.hyphens},f.initHyphens=function(){this.hyphens=d.map(this.positionsMap,this.initHyphen,this)},f.initHyphen=function(b,c){var d=new a(c);return d.setDrawingContext(this.drawingContext),d.setParent(this.svgGroup),d};var g=function(a,b){b.draw()};f.draw=function(){this.bindToParent()},f.bindToParent=function(){this.parent.append(this.getGroup())},f.getGroup=function(){return this.svgGroup}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Drawer.hyphen.HyphenPos;Adagio.Drawer.hyphen.connectionToPosition=function(c,d){if(d.left&&!d.right)return b.LEFT;if(d.left&&d.right)return b.MIDDLE;if(!d.left&&d.right)return b.RIGHT;throw new a("Unexpected")}}.call(this),function(){"use strict";var a=Adagio.Drawer.hyphen.HyphenPos,b=Adagio.Drawer.hyphen.HyphenAnchor=function(a,b){this.init(a,b)},c=b.prototype;c.init=function(a,b){this.measure=null,this.hyphen=null,this.measureIdx=null,this.note=a,this.position=b,this.drawingContext=null},c.setMeasure=function(a){this.measure=a},c.setDrawingContext=function(a){this.drawingContext=a},c.getDrawingContext=function(){return this.drawingContext},c.getWidth=function(){return 0},c.getX=function(b){if(null===this.note){if(this.position===a.LEFT)return this.getContinueLeftX();if(this.position===a.RIGHT)return this.getContinueRightX();a.raiseError(this.position)}else{if(this.position===a.LEFT)return this.getNoteLeftX(b);if(this.position===a.RIGHT)return this.getNoteRightX(b);a.raiseError(this.position)}},c.getContinueLeftX=function(){var a=this.measure.tickableContent;return this.measure.getXPos()+a.getXPos()-a.getPreviousSpace()},c.getContinueRightX=function(){var a=this.measure,b=a.tickableContent;return a.getXPos()+b.getXPos()+b.getWidth()},c.getNoteLeftX=function(a){var b=this.measure,c=b.tickableContent,d=this.note,e=b.getXPos()+c.getXPos()+d.getXPos();if(d.hasLyricLevel(a)){e+=d.getMiddleHeadWidth()/2+d.getLyricLevelWidth(a)/2}return e},c.getNoteRightX=function(a){var b=this.measure,c=b.tickableContent,d=this.note,e=b.getXPos()+c.getXPos()+d.getXPos();if(d.hasLyricLevel(a)){var f=d.getMiddleHeadWidth();e-=d.getLyricLevelWidth(a)/2-f/2}return e},c.hasLyricLevel=function(a){return null!==this.note&&this.note.hasLyricLevel(a)},c.getLyricLevelPosY=function(a){return this.note.getLyricLevelPosY(a)},c.getLevels=function(){return this.isLeft()?null===this.note?[]:this.note.getLyricBeginLevels():this.isRight()?null===this.note?[]:this.note.getLyricEndLevels():void a.raiseError(this.position)},c.hasHyphen=function(){return null!==this.hyphen},c.isLeft=function(){return this.position===a.LEFT},c.isRight=function(){return this.position===a.RIGHT},c.setHyphen=function(a){this.hyphen=a},c.getHyphen=function(){return this.hyphen},c.removeHyphen=function(){this.isLeft()?this.hyphen.removeLeftAnchor():this.isRight()?this.hyphen.removeRightAnchor():a.raiseError(this.position)},c.setNeedDrawUpdate=function(){if(this.hasHyphen()){this.getHyphen().setNeedDrawUpdate()}},c.setMeasureIdx=function(a){this.measureIdx=a},c.getMeasureIdx=function(){return this.measureIdx}}.call(this),function(){"use strict";var a=Adagio.Utils.typeUtils,b=Adagio.Utils.mapUtils,c=Adagio.Utils.noteUtils,d=Adagio.Utils.lyricUtils,e=Adagio.Drawer.hyphen.InternalHyphen,f=Adagio.Drawer.hyphen.connectionToPosition,g=Adagio.Drawer.hyphen.HyphenAnchor,h=Adagio.Drawer.hyphen.HyphenPos,i=Adagio.Render.HyphenProcessor=function(a){this.init(a)},j=i.prototype;j.init=function(a){this.container=a,this.leftNote=null},j.canProcess=function(a,b){return!!this.canProcessRight(a)||!!this.canProcessLeft(b)},j.canProcessRight=function(a){return l(a).some(d.hasRightConnection)},j.canProcessLeft=function(a){return l(a).some(d.hasLeftConnection)},j.addConnection=function(a,c,d,g){var h=k(a,d),i=b.map(h,f),j=new e(i);j.setLeftNote(c),j.setRightNote(g),this.container.addHyphen(j)};var k=function(a,b){var c={},e=l(a);e=e.filter(d.hasRightConnection),e.forEach(n,c);var f=l(b);return f=f.filter(d.hasLeftConnection),f.forEach(o,c),c},l=function(a){return a=m(a),c.getLyrics(a)},m=function(b){return b=a.makeArray(b),b=b[0]},n=function(a){var b=this,c=d.getLevel(a);p(b,c).left=!0},o=function(a){var b=this,c=d.getLevel(a);p(b,c).right=!0},p=function(a,b){return void 0===a[b]&&(a[b]={left:!1,right:!1}),a[b]};j.addLeftAnchor=function(a){var b=new g(a,h.RIGHT);this.container.setLeftHyphenAnchor(b)},j.addRightAnchor=function(a){var b=new g(a,h.LEFT);this.container.setRightHyphenAnchor(b)}}.call(this),function(){"use strict";Adagio.Drawer.tuplet.TupletSlant={UP:"up",HORIZONTAL:"horizontal",DOWN:"down"}}.call(this),function(){"use strict";var a=Adagio.Drawer.tuplet.TupletSlant,b=Adagio.Drawer.tuplet.TupletDisplayData=function(){this.direction=null,this.init()},c=b.prototype;c.init=function(){this.notes=[],this.avgLines=null,this.slant=null},c.addNote=function(a){this.notes.push(a)},c.getSlant=function(){return null===this.slant&&this.computeSlant(),this.slant},c.computeSlant=function(){if(this.isHorizontal())this.slant=a.HORIZONTAL;else{var b=this.getAvgLines(),c=b[0],d=b.length-1,e=b[d];this.slant=c>e?a.DOWN:a.UP}},c.isHorizontal=function(){return!!this.areFirstAndLastLinesSame()||(!!this.isMajoritySameLine()||!!this.isChaotic())},c.areFirstAndLastLinesSame=function(){var a=this.getAvgLines();return a[0]===a[a.length-1]},c.isMajoritySameLine=function(){var a=this.getAvgLines();if(a.length<4)return!1;var b=a.reduce(function(a,b){return void 0===a[b]&&(a[b]=0),a[b]++,a},{});return d(b)>=a.length/2};var d=function(a){var b=0;for(var c in a){var d=a[c];b=Math.max(b,d)}return b};c.getAvgLines=function(){return null===this.avgLines&&this.calcAvgLines(),this.avgLines},c.calcAvgLines=function(){this.avgLines=this.notes.map(function(a){return a.getLineAvg()})},c.isChaotic=function(){return!1}}.call(this),function(){"use strict";var a=Adagio.Brush.Elem,b=Adagio.Drawer.Line,c=Adagio.Drawer.tuplet.TupletSlant,d=Adagio.Values.Placement,e=Adagio.Drawer.tuplet.TupletBracket=function(a,b){this.init(a,b)};e.cssClass="tupletBracket";var f=e.prototype;f.cssClass=e.cssClass,f.init=function(a,b){this.parent=null,this.group=null,this.leftVertical=null,this.leftSlant=null,this.rightSlant=null,this.rightVertical=null,this.drawingContext=null,this.slant=a,this.placement=b,this.width=null,this.gap=null,this.posX=null,this.posY=null},f.setParent=function(a){this.parent=a},f.createGroup=function(){this.group=new a("g"),this.group.attr("class",this.cssClass)},f.setDrawingContext=function(a){this.drawingContext=a},f.draw=function(){this.bindToParent(),this.move()},f.bindToParent=function(){this.parent.append(this.group)},f.move=function(){var a=this.posX,b=this.posY;this.group.attr("transform","translate("+a+" "+b+")")},f.render=function(){this.isRendered()||(this.createGroup(),this.renderLeftVertical(),this.renderLeftSlant(),this.renderRightSlant(),this.renderRightVertical())},f.isRendered=function(){return null!==this.group},f.renderLeftVertical=function(){var a=this.getLeftExternalY(),c=this.getLeftInternalY(),d=this.drawingContext.getTupletBracketThickness(),e={stroke_width:d},f=new b(this.group,e),g=0;f.render(g,a,g,c),f.draw(),this.leftVertical=f},f.renderLeftSlant=function(){var a=this.getLeftExternalY(),c=this.getLeftSlantY(),d=this.getLeftSlantX(),e=this.drawingContext.getTupletBracketThickness(),f={stroke_width:e},g=new b(this.group,f);g.render(0,a,d,c),g.draw(),this.leftSlant=g},f.renderRightSlant=function(){var a=this.getRightSlantY(),c=this.getRightExternalY(),d=this.getRightSlantX(),e=this.width,f=this.drawingContext.getTupletBracketThickness(),g={stroke_width:f},h=new b(this.group,g);h.render(d,a,e,c),h.draw(),this.rightSlant=h},f.renderRightVertical=function(){var a=this.getRightExternalY(),c=this.getRightInternalY(),d=this.drawingContext.getTupletBracketThickness(),e={stroke_width:d},f=new b(this.group,e),g=this.width;f.render(g,a,g,c),f.draw(),this.rightVertical=f},f.setWidth=function(a){this.width=a},f.setGap=function(a){this.gap=a},f.updateDisplay=function(){this.updateWidth()},f.updateWidth=function(){var a=this.getLeftSlantX(),b=this.getLeftSlantY();this.leftSlant.setX2(a),this.leftSlant.setY2(b);var c=this.getRightSlantX(),d=this.getRightSlantY();this.rightSlant.setX1(c),this.rightSlant.setY1(d),this.rightSlant.setX2(this.width),this.rightVertical.setX1(this.width),this.rightVertical.setX2(this.width)},f.getLeftInternalY=function(){if(this.isLeftShifted()){var a=this.getPlacementCoeff();return this.drawingContext.getSpaceSize()/2*a}return 0},f.isLeftShifted=function(){return this.slant===c.DOWN&&this.plaement===d.ABOVE||this.slant===c.UP&&this.placement===d.BELOW},f.getLeftExternalY=function(){var a=this.drawingContext.getTupletBracketHeight(),b=this.getPlacementCoeff();return this.getLeftInternalY()+a*b},f.getRightInternalY=function(){if(this.isRightShifted()){var a=this.getPlacementCoeff();return this.drawingContext.getSpaceSize()/2*a}return 0},f.isRightShifted=function(){return this.slant===c.UP&&this.plaement===d.ABOVE||this.slant===c.DOWN&&this.placement===d.BELOW},f.getRightExternalY=function(){var a=this.drawingContext.getTupletBracketHeight(),b=this.getPlacementCoeff();return this.getRightInternalY()+a*b},f.getExternalYFromXRatio=function(a){var b=this.getLeftExternalY();return(this.getRightExternalY()-b)*a+b},f.getInternalYFromXRatio=function(a){var b=this.drawingContext.getTupletBracketHeight(),c=this.getPlacementCoeff();return this.getExternalYFromXRatio(a)-b*c},f.getPlacementCoeff=function(){return this.placement===d.ABOVE?-1:this.placement===d.BELOW?1:void d.raiseError(this.placement)},f.getXRatio=function(a){return a/this.width},f.getLeftSlantX=function(){return this.width/2-this.gap/2},f.getLeftSlantY=function(){var a=this.getLeftSlantX(),b=this.getXRatio(a);return this.getExternalYFromXRatio(b)},f.getRightSlantY=function(){var a=this.getRightSlantX(),b=this.getXRatio(a);return this.getExternalYFromXRatio(b)},f.getRightSlantX=function(){return this.width/2+this.gap/2},f.getMiddleY=function(){return this.getExternalYFromXRatio(.5)},f.getMiddleX=function(){return this.width/2},f.setPosX=function(a){this.posX=a},f.setPosY=function(a){this.posY=a},f.getPosX=function(){return this.posX},f.getPosY=function(){return this.posY}}.call(this),function(){"use strict";var a=Adagio.Brush.Elem,b=Adagio.Drawer.tuplet.TupletDisplayData,c=Adagio.Drawer.tuplet.TupletBracket,d=Adagio.Drawer.Text,e=Adagio.Values.Placement,f=Adagio.Utils.staffDataUtils,g=Adagio.Drawer.tuplet.Tuplet=function(a,b,c){this.init(a,b,c)};g.cssClass="tuplet";var h=g.prototype;h.cssClass=g.cssClass,h.init=function(a,c,d){this.displayData=new b,this.parent=null,this.group=null,this.drawingContext=null,this.staffData=null,this.isMinimalWidth=null,this.notes=[],this.number=c,this.bracket=null,this.digitText=null,this.placement=d},h.setParent=function(a){this.parent=a},h.addNote=function(a){this.notes.push(a),a.beam=this,this.displayData.addNote(a.getDisplayData())},h.setDrawingContext=function(a){this.drawingContext=a},h.setStaffData=function(a){this.staffData=a},h.bindToParent=function(){this.parent.append(this.group)},h.updateConnections=function(){this.isRendered()?this.updateFormating():this.render()},h.isRendered=function(){return null!==this.group},h.render=function(){this.createGroup(),this.createDigit(),this.createBracket(),this.renderDigit(),this.renderBracket(),this.format()},h.createGroup=function(){this.group=new a("g"),this.group.attr("class",this.cssClass)},h.createDigit=function(){var a={"font-family":"Georgia, serif","font-style":"normal","font-size":1,text:this.number.toString()};this.digitText=new d(a),this.digitText.setParent(this.group)},h.createBracket=function(){var a=this.getSlant();this.bracket=new c(a,this.placement),this.bracket.setParent(this.group)},h.renderDigit=function(){this.digitText.setDrawingContext(this.drawingContext),this.adaptFontSize(),this.digitText.render()},h.adaptFontSize=function(){var a=this.digitText.getXHeight(),b=this.drawingContext.getSpaceSize(),c=b/a;this.digitText.setFontSize(c)},h.renderBracket=function(){var a=this.getWidth(),b=this.getGap();this.bracket.setWidth(a),this.bracket.setGap(b),this.bracket.setDrawingContext(this.drawingContext),this.bracket.render(),this.dispatchYToNotes()},h.getGap=function(){return this.digitText.getWidth()+this.drawingContext.getSpaceSize()},h.getSlant=function(){return this.displayData.getSlant()},h.format=function(){this.formatBracket(),this.formatDigit()},h.formatBracket=function(){this.fillBracketPosX(),this.fillBracketPosY()},h.fillBracketPosX=function(){var a=this.getBracketStartX();this.bracket.setPosX(a)},h.fillBracketPosY=function(){var a=this.getInitialPosY();this.bracket.setPosY(a);for(var b=this.notes.length,c=0;c<b;c++){var d=Math.abs(this.getBracketInternalYAt(c)),e=Math.abs(this.getNoteExternalY(c));if(e>d){var f=e-d,g=this.bracket.getPosY();g+=f*this.getPlacementCoeff(),this.bracket.setPosY(g)}}},h.getInitialPosY=function(){var a=this.drawingContext.getSpaceSize();if(this.placement===e.ABOVE)return-a;if(this.placement===e.BELOW){return this.getNbStaffLines()*a}e.raiseError(this.placement)},h.getNbStaffLines=function(){return f.getNbStaffLines(this.staffData)},h.getPlacementCoeff=function(){return this.placement===e.ABOVE?-1:this.placement===e.BELOW?1:void e.raiseError(this.placement)},h.formatDigit=function(){var a=this.bracket.getPosX()+this.bracket.getMiddleX();a-=this.digitText.getWidth()/2;var b=this.bracket.getPosY()+this.bracket.getMiddleY();this.placement===e.BELOW?b+=this.digitText.getFontSize()/4:this.placement===e.ABOVE?b+=0:e.raiseError(this.placement),this.digitText.setPosition(a,b)},h.draw=function(){this.bracket.draw(),this.digitText.draw(),this.bindToParent()},h.updateFormating=function(){var a=this.getWidth();this.bracket.setWidth(a),this.bracket.updateDisplay(),this.format(),this.dispatchYToNotes()},h.getNoteExternalY=function(a){var b=this.drawingContext.getSpaceSize();return this.placement===e.ABOVE?this.notes[a].getHighestY()-b:this.placement===e.BELOW?this.notes[a].getLowestY()+b:void e.raiseError(this.placement)},h.getBracketInternalYAt=function(a){var b=this.getXRatioAt(a),c=this.bracket.getPosY();return this.bracket.getInternalYFromXRatio(b)+c},h.getBracketExternalYAt=function(a){var b=this.getXRatioAt(a),c=this.bracket.getPosY();return this.bracket.getExternalYFromXRatio(b)+c},h.getWidth=function(){var a=this.getNotesWidth(),b=this.getMinimalWidth(),c=Math.max(a,b);return this.isMinimalWidth=c===b,c},h.getNotesWidth=function(){var a=this.getFirstNoteStartX();return this.getLastNoteStopX()-a},h.getMinimalWidth=function(){return this.digitText.getWidth()+2*this.drawingContext.getMarginSize()+2*this.drawingContext.getSpaceSize()},h.getBracketStartX=function(){var a=this.getBracketOffset();return this.getFirstNoteStartX()-a},h.getBracketStopX=function(){var a=this.getBracketOffset();return this.getLastNoteStopX()+a},h.getXRatioAt=function(a){var b=this.getBracketStartX();return(this.notes[a].getXPos()-b)/this.getWidth()},h.getBracketOffset=function(){if(this.isMinimalWidth){return(this.getMinimalWidth()-this.getNotesWidth())/2}return 0},h.getFirstNoteStartX=function(){var a=this.getFirstNote(),b=a.getXPos();return a.hasLeftShiftedHead()&&(b-=a.getLeftHeadWidth()),b},h.getFirstNote=function(){return this.notes[0]},h.getLastNoteStopX=function(){var a=this.getLastNote(),b=a.getXPos()+a.getMiddleHeadWidth();return a.hasRightShiftedHead()&&(b+=a.getRightHeadWidth()),b},h.getLastNote=function(){var a=this.notes.length-1;return this.notes[a]},h.updateHorizontalDisplay=function(){this.bracket.move(),this.digitText.move()},h.getTopY=function(){return this.placement===e.ABOVE?this.digitText.y-2*this.digitText.getXHeight():this.placement===e.BELOW?this.bracket.getPosY():void e.raiseError(this.placement)},h.getBottomY=function(){return this.placement===e.ABOVE?this.bracket.getPosY():this.placement===e.BELOW?this.digitText.y:void e.raiseError(this.placement)},h.dispatchYToNotes=function(){this.notes.forEach(this.dispatchYToNote,this)},h.dispatchYToNote=function(a,b){var c=this.getYPosAtNote(b);this.placement===e.ABOVE?a.setHighestTupletY(c):this.placement===e.BELOW?a.setLowestTupletY(c):e.raiseError(this.placement)},h.getYPosAtNote=function(a){return this.isMiddleNote(a)?this.placement===e.ABOVE?this.getTopY():this.placement===e.BELOW?this.getBottomY():void e.raiseError(this.placement):this.getBracketExternalYAt(a)},h.isMiddleNote=function(a){var b=this.notes.length;if(b%2==1)return a===b/2-.5;var c=b/2;return a===c||a===c-1}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.noteUtils,c=Adagio.Utils.tupletBoundUtils,d=Adagio.Utils.timeModifUtils,e=Adagio.Utils.typeUtils,f=Adagio.Values.StemStrategy,g=Adagio.Values.Placement,h=Adagio.Drawer.tuplet.Tuplet,i=Adagio.Render.TupletProcessor=function(a,b){this.init(a,b)},j=i.prototype;j.init=function(a,b){this.placement=k(b),this.container=a,this.tuplets=[],this.timeModif=d.createDefault(),this.timeModifStack=[],this.level=0};var k=function(a){return a===f.AUTO||a===f.UP?g.ABOVE:a===f.DOWN?g.BELOW:void f.raiseError(a)};j.canProcess=function(a){return a=l(a),!!b.hasTupletBounds(a)||!(!this.hasOngoingTuplet()||!b.hasTimeModif(a))};var l=function(a){return e.isArray(a)?a[0]:a};j.hasOngoingTuplet=function(){return this.tuplets.length>0},j.addNote=function(c,d){if(c=l(c),b.hasTupletStart(c)&&this.startTuplet(c),!this.isSameTimeModif(c)){throw new a("Unexpected","There is a note outside of the current tuplet timeModif.")}this.addNoteToTuplets(d),b.hasTupletStop(c)&&this.stopTuplet(c)},j.isSameTimeModif=function(a){var c=b.getTimeModif(a),e=this.timeModif;return d.isSame(c,e)},j.startTuplet=function(a){var c=b.getTupletStarts(a);c.sort(m),c.forEach(this.createTuplet,this)};var m=function(a,b){return c.getLevel(a)-c.getLevel(b)},n=function(a,b){return m(b,a)};j.createTuplet=function(b){var e=c.getLevel(b);if(e!==this.level+1){throw new a("Unexpected","Expecting an other tuplet level on tuplet start.")}var f=c.getNbActual(b),g=new h(e,f,this.placement);this.tuplets.push(g);var i=c.getTimeModif(b);this.timeModifStack.push(d.copy(i)),this.timeModif=d.combine(this.timeModif,i),this.container.addTuplet(g),this.level++},j.addNoteToTuplets=function(a){this.tuplets.forEach(function(b){b.addNote(a)})},j.stopTuplet=function(a){var c=b.getTupletStops(a);c.sort(n),c.forEach(this.closeTuplet,this)},j.closeTuplet=function(b){var e=c.getLevel(b);if(this.level!==e)throw new a("Unexpected","Unexpected tuplet level for closing tuplet.");this.tuplets.pop(),this.level--;var f=this.timeModifStack.pop();this.timeModif=d.subtract(this.timeModif,f)}}.call(this),function(){"use strict";var a=Adagio.Brush.Elem,b=Adagio.Drawer.glissando.Glissando=function(){this.init()},c=b.prototype;c.cssClass="glissando",c.glyphId="wiggleGlissando",c.init=function(){this.drawingContext=null,this.group=null,this.parent=null,this.wiggles=[],this.glyph=null,this.posX1=null,this.posY1=null,this.posX2=null,this.posY2=null},c.setDrawingContext=function(a){this.drawingContext=a},c.setParent=function(a){this.parent=a},c.setPosY1=function(a){this.posY1=a},c.setPosX1=function(a){this.posX1=a},c.setPosX2=function(a){this.posX2=a},c.setPosY2=function(a){this.posY2=a},c.getGlyph=function(){return null===this.glyph&&(this.glyph=this.drawingContext.getGlyph(this.glyphId)),this.glyph},c.getHeight=function(){return Math.abs(this.posY2-this.posY1)},c.getWidth=function(){var a=Math.pow(this.posX2-this.posX1,2),b=Math.pow(this.posY2-this.posY1,2);return Math.sqrt(a+b)},c.needRender=function(){return null===this.group},c.render=function(){this.group=new a("g"),this.group.attr("class",this.cssClass)},c.draw=function(){this.needRender()&&this.render(),this.drawPieces(),this.move(),this.bindToParent()},c.update=function(){this.draw()},c.drawPieces=function(){var a=this.getGlyph(),b=a.getWidth()-this.drawingContext.getGlissandoExcessWidth(),c=this.getWidth(),d=Math.floor(c/b);if(this.wiggles.length>d){this.wiggles.splice(d,this.wiggles.length-d).forEach(this.removeWiggle)}else for(var e=this.wiggles.length;e<d;e++){var f=this.group.append("path");f.attr("d",a.render()),f.attr("transform","translate("+e*b+" 0)"),this.wiggles.push(f)}},c.getAngle=function(){return Math.atan2(this.posY2-this.posY1,this.posX2-this.posX1)*(180/Math.PI)},c.move=function(){
var a=this.getGlyph(),b=a.getWidth()-this.drawingContext.getGlissandoExcessWidth(),c=this.getWidth(),d=Math.floor(c/b)*b,e=this.posX1+(c-d)/2,f=this.posY1+this.drawingContext.getSpaceSize(),g=this.getAngle();this.group.attr("transform","translate("+e+" "+f+") rotate("+g+")")},c.bindToParent=function(){null!==this.parent&&this.parent.append(this.group)},c.removeWiggle=function(a){a.removeFromParent()}}.call(this),function(){"use strict";var a=Adagio.Drawer.glissando.GlissandoDisplayData=function(){this.init()},b=a.prototype;b.init=function(){this.leftNote=null,this.rightNote=null},b.setLeftNote=function(a){this.leftNote=a},b.setRightNote=function(a){this.rightNote=a},b.hasLeftNote=function(){return null!==this.leftNote},b.hasRightNote=function(){return null!==this.rightNote},b.getGlissandoStarts=function(){return this.hasLeftNote()?this.leftNote.getGlissandoStarts():[]},b.getGlissandoStops=function(){return this.hasRightNote()?this.rightNote.getGlissandoStops():[]},b.getNbStaffLines=function(){return this.leftNote.getNbStaffLines()}}.call(this),function(){"use strict";var a=Adagio.Brush.Elem,b=Adagio.Utils.geometryUtils,c=Adagio.Utils.mapUtils,d=Adagio.Drawer.glissando.Glissando,e=Adagio.Drawer.glissando.GlissandoDisplayData,f=Adagio.Drawer.glissando.InternalGlissando=function(){this.init()},g=f.prototype;g.cssClass="internalGlissando",g.init=function(){this.leftNote=null,this.rightNote=null,this.group=null,this.parent=null,this.drawingContext=null,this.glissandos=null,this.displayData=new e},g.setParent=function(a){this.parent=a},g.setDrawingContext=function(a){this.drawingContext=a},g.setLeftNote=function(a){this.leftNote=a,this.displayData.setLeftNote(a.getDisplayData())},g.setRightNote=function(a){this.rightNote=a,this.displayData.setRightNote(a.getDisplayData())},g.needRender=function(){return null===this.group},g.render=function(){this.group=new a("g"),this.group.attr("class",this.cssClass)},g.draw=function(){this.needRender()&&this.render(),this.drawGlissandos(),this.bindToParent()},g.updateGlissandos=function(){if(null!==this.glissandos){this.displayData.getGlissandoStarts().forEach(function(a,b){var c=this.getRightGlissandoData(a);if(void 0!==c){var d=this.glissandos[b],e=a.line,f=c.line;d.setPosX1(this.getLeftPosX()),d.setPosY1(this.lineToY(e)),d.setPosX2(this.getRightPosX()),d.setPosY2(this.lineToY(f)),d.update()}},this)}},g.bindToParent=function(){null!==this.parent&&this.parent.append(this.group)},g.drawGlissandos=function(){var a=this.getGlissandos();c.forEach(a,this.drawGlissando)},g.getGlissandos=function(){if(null===this.glissandos){this.glissandos={};this.displayData.getGlissandoStarts().forEach(function(a,b){var c=this.getRightGlissandoData(a);if(void 0!==c){var e=new d,f=a.line,g=c.line;e.setDrawingContext(this.drawingContext),e.setParent(this.group),e.setPosX1(this.getLeftPosX()),e.setPosY1(this.lineToY(f)),e.setPosX2(this.getRightPosX()),e.setPosY2(this.lineToY(g)),this.glissandos[b]=e}},this)}return this.glissandos},g.getRightGlissandoData=function(a){var b=this.displayData.getGlissandoStops(),c=a.number;return b.find(function(a){var b=a.number;return c===b})},g.drawGlissando=function(a,b){b.draw()},g.getLeftPosX=function(){return this.leftNote.getXPos()+this.leftNote.getMiddleHeadWidth()+this.drawingContext.getGlissandoHorizontalMargin()},g.getRightPosX=function(){return this.rightNote.getXPos()-this.drawingContext.getGlissandoHorizontalMargin()},g.lineToY=function(a){var c=this.drawingContext.getSpaceSize(),d=this.displayData.getNbStaffLines();return b.lineToY(a,c,d)}}.call(this),function(){"use strict";var a=Adagio.Drawer.glissando.GlissandoAnchor=function(a,b){this.init(a,b)},b=a.prototype;b.init=function(a,b){this.measure=null,this.note=a,this.glissandoType=b,this.leftNote=null,this.rightNote=null,this.glissando=null},b.getGlissandoType=function(){return this.glissandoType},b.getNote=function(){return this.note},b.setMeasure=function(a){this.measure=a},b.getMeasure=function(){return this.measure},b.setRightNote=function(a){this.rightNote=a},b.setLeftNote=function(a){this.leftNote=a},b.hasRightNote=function(){return null!==this.rightNote},b.hasLeftNote=function(){return null!==this.leftNote},b.getRightNote=function(){return this.rightNote},b.getLeftNote=function(){return this.leftNote},b.hasGlissando=function(){return null!==this.glissando},b.setGlissando=function(a){this.glissando=a},b.getGlissando=function(){return this.glissando}}.call(this),function(){"use strict";var a=Adagio.Utils.typeUtils,b=Adagio.Utils.noteUtils,c=Adagio.Values.GlissandoType,d=Adagio.Drawer.glissando.InternalGlissando,e=Adagio.Drawer.glissando.GlissandoAnchor,f=Adagio.Render.GlissandoProcessor=function(a){this.init(a)},g=f.prototype;g.init=function(a){this.container=a,this.leftNote=null},g.canProcess=function(b){return b=a.makeArray(b),this.hasGlissando(b)},g.hasGlissando=function(a){return a.some(b.hasGlissandos)},g.addInternalNote=function(b,d){b=a.makeArray(b),this.hasGlissandoType(b,c.STOP)&&this.addStop(d),this.hasGlissandoType(b,c.START)&&this.addStart(d)},g.addFirstNote=function(b,d,e){b=a.makeArray(b),this.hasGlissandoType(b,c.STOP)&&this.addStopAnchor(d,e)},g.addLastNote=function(b,d,e){b=a.makeArray(b),this.hasGlissandoType(b,c.START)&&this.addStartAnchor(d,e)},g.hasGlissandoType=function(a,c){return a.some(function(a){return b.hasGlissandoType(a,c)})},g.hasLeftNote=function(){return null!==this.leftNote},g.addStart=function(a){this.leftNote=a},g.addStop=function(a){if(this.hasLeftNote()){var b=new d;b.setLeftNote(this.leftNote),b.setRightNote(a),this.container.addGlissando(b),this.leftNote=null}},g.addStopAnchor=function(a,b){var d=new e(a,c.STOP);d.setLeftNote(b),this.container.setLeftGlissandoAnchor(d)},g.addStartAnchor=function(a,b){var d=new e(a,c.STOP);d.setRightNote(b),this.container.setRightGlissandoAnchor(d)}}.call(this),function(){"use strict";var a=Adagio.Drawer.hammerOnPullOff.HammerOnPullOffDisplayData=function(){this.init()},b=a.prototype;b.init=function(){this.strings=[],this.higherHammerOnPullOff=null,this.lowerHammerOnPullOff=null},b.setLeftNote=function(a){this.leftNote=a},b.setRightNote=function(a){this.rightNote=a},b.fillData=function(){this.extractHammerOnPullOffs()},b.extractHammerOnPullOffs=function(){this.strings=this.leftNote.getHammerOnPullOffStarts();var a=this.rightNote.getHammerOnPullOffStops();this.strings.forEach(function(b,c){b<=3?(null===this.higherHammerOnPullOff||this.higherHammerOnPullOff.string>b)&&this.setHigherHammerOnPullOff(b,a[c]):(null===this.lowerHammerOnPullOff||this.lowerHammerOnPullOff.string<b)&&this.setLowerHammerOnPullOff(b,a[c])},this)},b.setHigherHammerOnPullOff=function(a,b){var c={string:a,rightString:b,staffData:this.leftNote.getStaffData(),placement:"above",rightSide:{},leftSide:{},isExternal:!0};this.higherHammerOnPullOff=c},b.setLowerHammerOnPullOff=function(a,b){var c={string:a,rightString:b,staffData:this.leftNote.getStaffData(),placement:"below",rightSide:{},leftSide:{},isExternal:!0};this.lowerHammerOnPullOff=c},b.hasHammerOnPullOffs=function(){return null!==this.higherHammerOnPullOff||null!==this.lowerHammerOnPullOff},b.getHammerOnPullOffs=function(){var a=[];return null!==this.higherHammerOnPullOff&&a.push(this.higherHammerOnPullOff),null!==this.lowerHammerOnPullOff&&a.push(this.lowerHammerOnPullOff),a}}.call(this),function(){"use strict";var a=Adagio.Drawer.Text,b=Adagio.Drawer.tie.TieArc,c=Adagio.Drawer.tie.tieOffset,d=Adagio.Brush.Elem,e=Adagio.Utils.geometryUtils,f=Adagio.Utils.math,g=Adagio.Utils.staffDataUtils,h=Adagio.Drawer.hammerOnPullOff.HammerOnPullOffDisplayData,i=Adagio.Error.InternalError,j=Adagio.Values.TechnicalType,k=Adagio.Drawer.hammerOnPullOff.InternalHammerOnPullOff=function(a){this.init(a)};k.cssClass="hammerOnPullOff";var l=k.prototype;l.cssClass=k.cssClass,l.init=function(a){this.technicalType=a,this.text=null,this.arcs=null,this.displayData=new h,this.drawingContext=null,this.parent=null,this.svgGroup=new d("g"),this.svgGroup.attr("class",this.cssClass),this.needDrawUpdate=!1},l.setParent=function(a){this.parent=a},l.setLeftNote=function(a){this.leftNote=a,this.displayData.setLeftNote(a.getDisplayData())},l.setRightNote=function(a){this.rightNote=a,this.displayData.setRightNote(a.getDisplayData())},l.setDrawingContext=function(a){this.drawingContext=a},l.getArcs=function(){return this.hasArcs()||this.initArcs(),this.arcs},l.hasArcs=function(){return null!==this.arcs},l.initArcs=function(){if(this.displayData.fillData(),this.arcs=[],this.displayData.hasHammerOnPullOffs()){this.displayData.getHammerOnPullOffs().forEach(this.renderArc,this)}},l.getText=function(){return this.hasText()||this.initText(),this.text},l.hasText=function(){return null!==this.text},l.initText=function(){if(this.text=null,this.displayData.hasHammerOnPullOff()){var b=this.displayData.getHammerOnPullOff(),d=this.getTextValue(),e=new a({text:d,"font-size":this.drawingContext.getHammerOnPullOffFontSize()});e.setDrawingContext(this.drawingContext),e.setParent(this.getGroup());var h=g.isTabStaff(b.staffData),i=this.stringToY(b.string,h);i+=c.getVertical(b,this.drawingContext);var j=f.min2(i-e.getXHeight()-this.drawingContext.getTieVerticalMargin(),-e.getXHeight());e.setYPos(j),e.render(),this.text=e}},l.renderArc=function(a){var d=this.leftNote.getFretsWidth()/2,e=c.getLeft(a,d),f=this.rightNote.getFretsWidth()/2,h=c.getRight(a,f),i=c.getVertical(a,this.drawingContext),j=g.isTabStaff(a.staffData),k=this.stringToY(a.string,j)+i,l=this.stringToY(a.rightString,j)+i,m=l-k,n=new b(this.getGroup(),e,h,a.placement,m);n.setPosY(k),n.setDrawingContext(this.drawingContext),this.arcs.push(n)},l.stringToY=function(a,b){var c=b?this.drawingContext.getTabSpaceSize():this.drawingContext.getSpaceSize();return e.stringToY(a,c)},l.getTextValue=function(){if(this.technicalType===j.HAMMER_ON)return"H";if(this.technicalType===j.PULL_OFF)return"P";throw new i("Unexpected")},l.updateArc=function(){this.updateArcs()},l.updateArcs=function(){this.getArcs().forEach(function(a){var b=this.drawingContext.getTieHorizontalMargin(),c=this.leftNote.getXPos()+b,d=this.rightNote.getXPos()-b,e=d-c,f=n(),g=f(e);a.setSize(e,g),a.setPosX(c)},this),this.needDrawUpdate=!1},l.setNeedDrawUpdate=function(){this.needDrawUpdate=!0},l.draw=function(){this.hasArcs()&&(this.needDrawUpdate&&this.updateArc(),this.getArcs().forEach(function(a){a.draw()}),this.bindToParent())},l.bindToParent=function(){this.parent.append(this.getGroup())},l.getGroup=function(){return this.svgGroup};var m=null,n=function(){if(null===m){var a=3,b=2/3,c=30,d=2,e=f.solveLinearA(a,b,c,d),g=f.solveLinearB(a,b,e);m=function(a){return e*a+g}}return m};l.updateHorizontalDisplay=function(){this.hasArcs()&&(this.needDrawUpdate&&this.updateArc(),this.getArcs().forEach(function(a){a.updateHorizontalDisplay()}))},l.getTopY=function(){var a=this.getTopArc(),b=a.getTopY();return a.posY+b},l.getTopArc=function(){return this.getArcs()[0]},l.getBottomY=function(){var a=this.getBottomArc(),b=a.getBottomY();return a.posY+b},l.getBottomArc=function(){var a=this.getArcs();return a[a.length-1]}}.call(this),function(){"use strict";var a=Adagio.Drawer.tie.AnchorType,b=Adagio.Drawer.tie.TieType,c=Adagio.Error.InternalError,d=Adagio.Values.TechnicalType,e=Adagio.Drawer.hammerOnPullOff.HammerOnPullOffAnchor=function(a,b,c){this.init(a,b,c)},f=e.prototype;f.init=function(b,c,e){this.note=b,this.measure=null,this.hammerOnPullOff=null,this.technicalType=c,this.type=e,this.type!==a.START&&this.type!==a.STOP&&h(e),this.technicalType!==d.HAMMER_ON&&this.technicalType!==d.PULL_OFF&&g(c)},f.setMeasure=function(a){this.measure=a},f.hasHammerOnPullOff=function(){return null!==this.hammerOnPullOff},f.hasLeftHammerOnPullOff=function(){if(this.type===a.START){throw new c("BadHammerOnPullOffQuery","A begin anchor cannot have a hammerOnPullOff incoming from the left")}if(this.hasHammerOnPullOff()){return this.getHammerOnPullOff().getType()===b.LEFT}return!1},f.hasCrossMeasureHammerOnPullOff=function(){if(this.hasHammerOnPullOff()){return this.getHammerOnPullOff().getType()===b.CROSS_MEASURE}return!1},f.setHammerOnPullOff=function(a){this.hammerOnPullOff=a},f.getHammerOnPullOff=function(){return this.hammerOnPullOff},f.getTechnicalType=function(){return this.technicalType},f.removeHammerOnPullOff=function(){this.type===a.START?this.hammerOnPullOff.removeLeftAnchor():this.type===a.STOP?this.hammerOnPullOff.removeRightAnchor():h(this.type)};var g=function(a){throw new c("Unreachable","The technical type ["+a+"] is invalid.")},h=function(a){throw new c("Unreachable","The anchor type ["+a+"] is invalid.")};f.setNeedDrawUpdate=function(){if(this.hasHammerOnPullOff()){this.getHammerOnPullOff().setNeedDrawUpdate()}}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.typeUtils,c=Adagio.Utils.noteUtils,d=Adagio.Utils.hammerOnPullOffUtils,e=Adagio.Drawer.hammerOnPullOff.InternalHammerOnPullOff,f=Adagio.Drawer.hammerOnPullOff.HammerOnPullOffAnchor,g=Adagio.Drawer.tie.AnchorType,h=Adagio.Values.TechnicalType,i=Adagio.Values.HammerOnPullOffType,j=Adagio.Render.HammerOnPullOffProcessor=function(a){this.init(a)},k=j.prototype;k.init=function(a){this.container=a,this.leftNote=null},k.canProcess=function(c){c=b.makeArray(c);var d=l(c);if(this.shouldProcess()&&!d)throw new a("HammerOnPullOffProcessor","a hammer-on/pull-off must stop at the next note");return d},k.shouldProcess=function(){return null!==this.leftNote};var l=function(a){return a.some(function(a){return c.hasTechnical(a,h.HAMMER_ON)||c.hasTechnical(a,h.PULL_OFF)})};k.addNote=function(a,c,d,e){var f;a=b.makeArray(a),n(a)&&(f=p(a),d?this.addLeftAnchor(f,c):this.stopTie(f,c)),m(a)&&(f=p(a),e?this.addRightAnchor(f,c):this.startTie(c))};var m=function(a){var b=o(i.START);return a.some(function(a){return c.hasTechnical(a,h.HAMMER_ON,b)||c.hasTechnical(a,h.PULL_OFF,b)})},n=function(a){var b=o(i.STOP);return a.some(function(a){return c.hasTechnical(a,h.HAMMER_ON,b)||c.hasTechnical(a,h.PULL_OFF,b)})},o=function(a){return{hammerOnPullOff:d.create(a)}},p=function(b){if(b.some(function(a){return c.hasTechnical(a,h.HAMMER_ON)}))return h.HAMMER_ON;if(b.some(function(a){return c.hasTechnical(a,h.PULL_OFF)}))return h.PULL_OFF;throw new a("Unexpected")};k.addLeftAnchor=function(a,b){var c=new f(b,a,g.STOP);this.container.setLeftHammerOnPullOffAnchor(c)},k.addRightAnchor=function(a,b){var c=new f(b,a,g.START);this.container.setRightHammerOnPullOffAnchor(c)},k.startTie=function(b){if(null!==this.leftNote)throw new a("HammerOnPullOffProcessor","a tie is already started");this.leftNote=b},k.stopTie=function(b,c){if(null===this.leftNote)throw new a("HammerOnPullOffProcessor","cannot stop a non started tie");var d=new e(b);d.setLeftNote(this.leftNote),d.setRightNote(c),this.container.addHammerOnPullOff(d),this.leftNote=null}}.call(this),function(){"use strict";var a=Adagio.Utils.typeUtils,b=Adagio.Utils.noteUtils,c=Adagio.Values.BeamType,d=Adagio.Values.Stem,e=Adagio.Values.StemStrategy,f=Adagio.Drawer.RenderedBeam,g=a.arrayToSet([c.BEGIN,c.CONTINUE,c.END]),h=Adagio.Render.GraceBeamProcessor=function(a,b){this.init(a,b)},i=h.prototype;i.init=function(a,b){this.voiceId="1",this.renderedNote=null,this.noteIdx=-1,this.stemStrategy=b,this.container=a,this.beamNotes={}},i.setNoteIdx=function(a){this.noteIdx=a},i.canProcess=function(c){return c=a.makeArray(c),c.some(b.hasBeam)},i.addNote=function(c,d){var e=j(c);this.voiceId=b.getVoiceId(e),this.renderedNote=d;var f=a.makeArray(e.beam);this.processBeams(f)};var j=function(c){return c=a.makeArray(c),c.find(b.hasBeam)};i.processBeams=function(a){a.forEach(this.processBeam,this)},i.processBeam=function(a){this.extractBeamData(a),"1"===this.beamNumber&&(this.beamType===c.BEGIN?this.beginBeam():this.beamType===c.CONTINUE?this.continueBeam():this.endBeam())},i.beginBeam=function(){this.beamNotes[this.voiceId]=[],this.beamNotes[this.voiceId].push(this.renderedNote)},i.continueBeam=function(){void 0!==this.beamNotes[this.voiceId]&&this.beamNotes[this.voiceId].push(this.renderedNote)},i.endBeam=function(){var a=this.beamNotes[this.voiceId],b=new f({isGrace:!0});this.stemStrategy===e.DOWN?b.forceStemValue(d.DOWN):b.forceStemValue(d.UP),a.push(this.renderedNote),a.forEach(function(a){b.addNote(a)}),this.container.addGraceBeam(b,this.noteIdx),this.beamNotes[this.voiceId]=null},i.extractBeamData=function(a){this.beamNumber=this.getBeamNumber(a),"1"===this.beamNumber?this.beamType=this.getBeamType(a):this.beamType=null},i.getBeamNumber=function(a){return a.$number.toString()},i.getBeamType=function(a){if(g[a.content])return a.content;throw new Error("the beam type "+a.content+" in not recognized")}}.call(this),function(){"use strict";var a=Adagio.Utils,b=Adagio.Utils.typeUtils,c=Adagio.Utils.durationUtils,d=Adagio.Utils.ornamentsUtils,e=Adagio.Utils.staffDataUtils,f=Adagio.Values.Stem,g=Adagio.Values.DurationType,h=Adagio.Error.InternalError,i=3.5,j=2.5,k=2,l={nbDots:0,accidentals:[],isRest:!1,hasBeam:!1,voiceIdx:0,tieStarts:[],tieStops:[],ornaments:[],frets:[],glissandoStarts:[],glissandoStops:[],hammerOnPullOffStarts:[],hammerOnPullOffStops:[],staffData:e.createDefault()},m=Adagio.Drawer.NoteDisplayData=function(a){this.init(a)},n=m.prototype;n.init=function(c){c=a.merge_options(l,c),this.opts=c,this.linesSet=b.arrayToSet(this.opts.lines),this.accidentals=null,this.secondHighers=null,this.lineAvg=null,this.stemQueueLine=null,this.singleNoteStemQueueLine=null,this.nbFlags=null,this.nbOrnaments=null,this.beamDisplayData=null},n.setLine=function(a){this.opts.lines=[a],this.linesSet=b.arrayToSet(this.opts.lines)},n.isRest=function(){return this.opts.isRest},n.getSecondHighers=function(){return null===this.secondHighers&&this.initSecondHighers(),this.secondHighers},n.initSecondHighers=function(){this.secondHighers={},this.getStemValue()===f.UP?this.initSecondHighersStemUp():this.initSecondHighersStemDown()},n.initSecondHighersStemDown=function(){var a=null;this.getLines().forEach(function(b){null===a?a=b:a-b>.5?a=b:(this.secondHighers[a]=!0,a=null)}.bind(this))},n.initSecondHighersStemUp=function(){var a=this.getLines().slice(0);a.reverse();var b=null;a.forEach(function(a){null===b?b=a:a-b>.5?b=a:(this.secondHighers[a]=!0,b=null)}.bind(this))},n.hasSecond=function(){var a=this.getSecondHighers();return!b.isObjectEmpty(a)},n.isSecondLower=function(a){return!!this.hasLine(a)&&!!this.getSecondHighers()[a+.5]},n.hasLine=function(a){return!!this.linesSet[a]},n.isSecondHigher=function(a){return!!this.getSecondHighers()[a]},n.hasAccidentals=function(){return this.getAccidentals().length>0},n.getAccidentals=function(){return null===this.accidentals&&(this.accidentals=this.opts.accidentals,this.initAccidentals()),this.accidentals},n.initAccidentals=function(){this.accidentals.forEach(function(a){var b=a.line;a.secondHigher=this.isSecondHigher(b)},this)},n.getBaseQuarterDuration=function(){return this.opts.quarterBaseDuration},n.getDuration=function(){return this.opts.duration},n.getLines=function(){return this.opts.lines},n.getHeads=function(){return this.opts.heads},n.getStaffData=function(){return this.opts.staffData},n.getDisplayedNbStaffLines=function(){var a=this.getStaffData();return e.getDisplayedNbStaffLines(a)},n.getNbStaffLines=function(){var a=this.getStaffData();return e.getNbStaffLines(a)},n.isTabStaff=function(){var a=this.getStaffData();return e.isTabStaff(a)},n.getLineAvg=function(){return null===this.lineAvg&&this.calcLineAvg(),this.lineAvg},n.calcLineAvg=function(){var a=this.getLines(),b=a.reduce(function(a,b){return a+b},0);this.lineAvg=b/a.length},n.getHighestLine=function(){return this.getLines()[0]},n.getLowestLine=function(){var a=this.getLines();return a[a.length-1]},n.getFrontHeadLine=function(){var a=this.getStemValue();if(a===f.UP)return this.getLowestLine();if(a===f.DOWN)return this.getHighestLine();var b="base head line concept has no meanings for "+a;throw b+=" stem value",new h("InconsistentOperation",b)},n.getTailHeadLine=function(){var a=this.getStemValue();if(a===f.UP)return this.getHighestLine();if(a===f.DOWN)return this.getLowestLine();var b="queue head line concept has no meanings for "+a;throw b+=" stem value",new h("InconsistentOperation",b)},n.getStemBaseLine=function(){return this.isTabStaff()?this.getTabFretLine():this.getFrontHeadLine()},n.getTabFretLine=function(){var a=this.getStemValue();if(a===f.UP)return this.getNbStaffLines()+1;if(a===f.DOWN)return 0;var b="tab line concept has no meanings for "+a;throw b+=" stem value",new h("InconsistentOperation",b)},n.getStemValue=function(){return this.isStemSpecified()?this.getSpecifiedStem():this.hasBeam()?this.getStemValueFromBeam():this.computeStemValueFromPitch()},n.hasBeam=function(){return this.opts.hasBeam},n.getBeams=function(){return this.opts.beams},n.isStemSpecified=function(){return void 0!==this.opts.definedStem},n.getSpecifiedStem=function(){return this.opts.definedStem},n.setSpeficiedStem=function(a){this.opts.definedStem=a},n.getStemValueFromBeam=function(){return this.beamDisplayData.getStemValue()},n.computeStemValueFromPitch=function(){if(this.isGrace())return f.UP;var a=this.getLineAvg();return 1===this.getDisplayedNbStaffLines()&&3===a?f.UP:a>=3?f.DOWN:f.UP},n.getSingleNoteStemQueueLine=function(){return null===this.singleNoteStemQueueLine&&(this.singleNoteStemQueueLine=this.isTabStaff()?this.computeTabNoteStemQueueLine():this.computeSingleNoteStemQueueLine()),this.singleNoteStemQueueLine},n.getStemQueueLine=function(){return null===this.stemQueueLine&&this.calcStemQueueLine(),this.stemQueueLine},n.calcStemQueueLine=function(){this.beamDisplayData?this.beamDisplayData.computeStemQueueLines():this.stemQueueLine=this.getSingleNoteStemQueueLine()},n.computeSingleNoteStemQueueLine=function(){return this.isGrace()?this.computeSingleNoteStemQueueLineGrace():this.computeSingleNoteStemQueueLineNormal()},n.computeTabNoteStemQueueLine=function(){return this.isGrace()?0:this.computeTabNoteStemQueueLineNormal()},n.computeSingleNoteStemQueueLineGrace=function(){var a=2,b=this.getNbFlags();b>k&&(a+=(b-k)/2);var c=this.getStemDirectionCoeff(),d=c*a;return this.getTailHeadLine()+d},n.computeSingleNoteStemQueueLineNormal=function(){var a=i,b=2,c=this.getDistanceToThirdLine();c>a&&(a=c,b+=Math.max(c-i,0));var d=0;d+=this.getNbFlags(),this.hasTremolo()&&(d+=this.getNbOrnaments()),d>b&&(a+=d-b);var e=this.getStemDirectionCoeff(),f=e*a;return this.getTailHeadLine()+f},n.computeTabNoteStemQueueLineNormal=function(){var a=g.toQuarterDuration(g.HALF),b=a===this.getBaseQuarterDuration()?j/2:j,c=this.getNbFlags();c>k&&(b+=c-k);var d=this.getStemDirectionCoeff();return this.getTabFretLine()+d*b},n.getDistanceToThirdLine=function(){var a=this.getStemValue(),b=this.getTailHeadLine();return a===f.UP?Math.max(Math.ceil(this.getNbStaffLines()/2),1)-b:a===f.DOWN?b-Math.max(Math.ceil(this.getNbStaffLines()/2),1):void 0},n.getNbFlags=function(){return null===this.nbFlags&&this.calcNbFlags(),this.nbFlags},n.calcNbFlags=function(){var a=this.getBaseQuarterDuration();this.nbFlags=c.quarterToNbFlags(a)},n.getNbOrnaments=function(){return null===this.nbOrnaments&&this.calcNbOrnaments(),this.nbOrnaments},n.calcNbOrnaments=function(){var a=0;this.opts.ornaments.forEach(function(b){a=Math.max(a,d.ornamentToNbLines(b))}),this.nbOrnaments=a},n.hasTremolo=function(){return this.opts.ornaments.some(function(a){return d.isTremoloType(a)})},n.getArticulations=function(){return this.opts.articulations},n.hasLyrics=function(){return this.opts.lyrics.length>0},n.getLyrics=function(){return this.opts.lyrics},n.getTechnical=function(){return this.opts.technical},n.getOrnaments=function(){return this.opts.ornaments},n.getFrets=function(){return this.opts.frets},n.hasFrets=function(){return this.opts.frets.length>0},n.getStemDirectionCoeff=function(){return this.getStemValue()===f.UP?1:-1},n.getBeamData=function(){return this.beamDisplayData},n.setBeamData=function(a){this.beamDisplayData=a},n.getNbDots=function(){return this.opts.nbDots},n.getVoiceIdx=function(){return this.opts.voiceIdx},n.hasStem=function(){return this.getBaseQuarterDuration()<4},n.isHighestLine=function(a){return a===this.getHighestLine()},n.isLowestLine=function(a){return a===this.getLowestLine()},n.getTieStarts=function(){return this.opts.tieStarts},n.getTieStops=function(){return this.opts.tieStops},n.hasTieStart=function(){return this.opts.tieStarts.length>0},n.hasTieStop=function(){return this.opts.tieStops.length>0},n.getHammerOnPullOffStarts=function(){return this.opts.hammerOnPullOffStarts},n.getHammerOnPullOffStops=function(){return this.opts.hammerOnPullOffStops},n.hasHammerOnPullOffStart=function(){return this.opts.hammerOnPullOffStarts.length>0},n.hasHammerOnPullOffStop=function(){return this.opts.hammerOnPullOffStops.length>0},n.hasArpeggio=function(){return this.opts.hasArpeggio},n.isGrace=function(){return this.opts.isGrace},n.getVoiceIdx=function(){return this.opts.voiceIdx},n.hasGlissandoStarts=function(){return this.opts.glissandoStarts.length>0},n.getGlissandoStarts=function(){return this.opts.glissandoStarts},n.hasGlissandoStops=function(){return this.opts.glissandoStops.length>0},n.getGlissandoStops=function(){return this.opts.glissandoStops},n.getGlobalCssClassesStr=function(){return this.opts.globalCssClassesStr},n.hasFlagDash=function(){return this.opts.hasFlagDash},n.getStemStrategy=function(){return this.opts.stemStrategy},n.getFingerings=function(){return this.opts.fingerings}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.durationUtils,c=Adagio.Utils.pitchUtils,d=Adagio.Utils.drumsetUtils,e=Adagio.Utils.clone,f=Adagio.Utils.beamUtils,g=Adagio.Utils.staffDataUtils,h=Adagio.Utils.lyricUtils,i=Adagio.Utils.hammerOnPullOffUtils,j=Adagio.Utils.glissandoUtils,k=Adagio.history.note.noteHistoryUtils,l=Adagio.Values.DurationType,m=Adagio.Values.TechnicalType,n=Adagio.Values.NotationType,o=Adagio.Values.FretType,p=Adagio.Values.GlissandoType,q=Adagio.Values.StemStrategy,r=Adagio.Values.HammerOnPullOffType,s=Adagio.Drawer.NoteDisplayData;Adagio.Render.extractNoteDisplayData=function(a,b,c){return new t(a,b,c).getDisplayData()};var t=function(a,b,c){this.init(a,b,c)},u=t.prototype;u.init=function(a,b,c){this.notes=a.slice(),this.note=a[0],this.attrs=b,this.stemStrategy=c,this.clef=null,this.staffData=null},u.getDisplayData=function(){this.extractData();var b={lines:this.lines,nbDots:this.nbDots,accidentals:this.accidentals,quarterBaseDuration:this.quarterBaseDuration,duration:this.duration,isRest:this.isRest,hasBeam:this.hasBeam,beams:this.beams,voiceIdx:this.voiceIdx,tieStops:this.tieStops,tieStarts:this.tieStarts,heads:this.heads,staffData:this.staffData,technical:a.getTechnicalList(this.note).filter(m.isValid),articulations:a.getFullArticulationsList(this.note).filter(a.isValidArticulation),ornaments:a.getOrnamentsListForDrawer(this.note),frets:this.frets,hasArpeggio:this.hasArpeggio,isGrace:a.isGraceNote(this.note),lyrics:this.lyrics,glissandoStarts:this.glissandoStarts,glissandoStops:this.glissandoStops,globalCssClassesStr:this.globalCssClassesStr,hammerOnPullOffStarts:this.hammerOnPullOffStarts,hammerOnPullOffStops:this.hammerOnPullOffStops,hasFlagDash:this.hasFlagDash,stemStrategy:this.stemStrategy,fingerings:this.fingerings};return new s(b)},u.extractData=function(){this.staffIdx=a.getStaffIdx(this.note),this.extractDuration(),this.extractLyric(),this.extractQuarterBaseDuration(),this.extractNbDots(),this.extractStaffData(),this.extractLines(),this.sortLinesAndNotes(),this.extractAccidentals(),this.extractHeads(),this.extractFingerings(),this.extractArticulations(),this.extractFrets(),this.initTies(),this.initHammerOnPullOffs(),this.isRest=a.isRest(this.note),this.extractBeams(),this.voiceIdx=a.getVoiceIdx(this.note),this.extractArpeggiate(),this.extractGlissandos(),this.extractCommonHistory(),this.extractHasFlagDash()},u.extractDuration=function(){a.hasDuration(this.note)?this.duration=a.getFloatingDuration(this.note):this.duration=null},u.extractQuarterBaseDuration=function(){a.isGraceNote(this.note)?this.extractQuarterBaseDurationFromGrace():this.extractQuarterBaseDurationFromNormal()},u.extractQuarterBaseDurationFromGrace=function(){var b=a.getDurationType(this.note);this.quarterBaseDuration=l.toQuarterDuration(b)},u.extractQuarterBaseDurationFromNormal=function(){if(a.isFullMeasureRest(this.note))this.quarterBaseDuration=l.toQuarterDuration(l.FULL);else{var c=this.attrs.getDpq(),d=a.getNormalQuarterDuration(this.note,c);this.quarterBaseDuration=b.extractBaseDuration(d)}},u.extractNbDots=function(){a.isFullMeasureRest(this.note)?this.nbDots=0:this.nbDots=a.getNbDots(this.note)},u.extractLines=function(){this.lines=this.notes.map(this.extractLine,this)},u.extractLine=function(b){return a.isRest(b)&&void 0===b["display-octave"]?this.getDefaultRestLine():this.getSpecifiedLine(b)},u.extractArticulations=function(){this.articulations=e(a.getArticulations(this.note)),a.hasNotation(this.note,n.FERMATA)&&(this.articulations[n.FERMATA]={})},u.extractLyric=function(){var b=a.getLyrics(this.note);b=b.map(h.copy),b.sort(h.compare),this.lyrics=b},u.getDefaultRestLine=function(){var a,b=this.quarterBaseDuration;if(b===l.toQuarterDuration(l.FULL)){var c=2*Math.round(this.getNbStaffLines()/2);switch(c){case 2:a=Math.max(Math.ceil(this.getNbStaffLines()/2),1);break;default:a=c-2}}else a=Math.max(Math.ceil(this.getNbStaffLines()/2),1);return this.stemStrategy===q.UP?a+=2:this.stemStrategy===q.DOWN&&(a-=2),a},u.getSpecifiedLine=function(b){if(a.hasUnpitched(b)){var e=this.getStaffData(),f=g.getDisplayedNbStaffLines(e),h=a.getUnpitched(b);return d.pitchToLine(h,f)}var i,j=this.getClef();return i=a.isRest(b)?{step:b["display-step"],octave:b["display-octave"]}:b.pitch,c.pitchToLine(i,j)},u.getClef=function(){return this.attrs.getClef(this.staffIdx)},u.getNbStaffLines=function(){var a=this.getStaffData();return g.getNbStaffLines(a)},u.getStaffData=function(){return null===this.staffData&&this.extractStaffData(),this.staffData},u.extractStaffData=function(){var a=this.attrs.getStaffDetails(this.staffIdx);this.staffData=g.createFromStaffDetails(a)},u.sortLinesAndNotes=function(){for(var a=[];this.notes.length>0;){var b=this.notes.shift(),c=this.lines.shift();a.push({note:b,line:c})}for(a.sort(v);a.length>0;){var d=a.shift();this.notes.push(d.note),this.lines.push(d.line)}};var v=function(a,b){return w(a.line,b.line)},w=function(a,b){return b-a};u.extractAccidentals=function(){this.accidentals=[],this.notes.forEach(function(b,d){var e,f=this.lines[d];if(a.hasCourtesyAccidental(b)){var g=a.getAlter(b);e={accidental:c.alterToAccidental(g),line:f,parentheses:!0},this.accidentals.push(e)}else a.hasAccidental(b)&&(e={accidental:a.getAccidental(b),line:f,parentheses:!1},this.accidentals.push(e));a.hasAccidental(b)},this)},u.extractHeads=function(){this.heads=[],this.notes.forEach(function(b,c){var d=k.getHeadCssClassesStr(b),e=this.lines[c],f=a.getHead(b),g=a.hasHeadParentheses(b),h={line:e,notehead:f,cssClassesStr:d,hasParentheses:g};this.heads.push(h)},this)},u.extractFingerings=function(){this.fingerings=this.notes.filter(a.hasFingering).map(a.getFingering)},u.extractFrets=function(){this.frets=[],this.notes.forEach(function(b){if(a.hasFretData(b)){var c={frets:a.getFretListForDrawer(b).filter(o.isValid),string:a.getTechnicalContent(b,m.STRING)};this.frets.push(c)}else this.frets.push(null)},this)},u.initTies=function(){this.tieStops=[],this.tieStarts=[],this.notes.forEach(function(b,c){var d=this.lines[c];a.hasTieStart(b)&&this.tieStarts.push(d),a.hasTieStop(b)&&this.tieStops.push(d)},this)},u.initHammerOnPullOffs=function(){this.hammerOnPullOffStarts=[],this.hammerOnPullOffStops=[],this.notes.forEach(function(b,c){var d=this.frets[c];if(null!==d){var e=this.getHammerOnPullOffTechnicalOpts(r.START);(a.hasTechnical(b,m.HAMMER_ON,e)||a.hasTechnical(b,m.PULL_OFF,e))&&this.hammerOnPullOffStarts.push(d.string);var f=this.getHammerOnPullOffTechnicalOpts(r.STOP)
;(a.hasTechnical(b,m.HAMMER_ON,f)||a.hasTechnical(b,m.PULL_OFF,f))&&this.hammerOnPullOffStops.push(d.string)}},this)},u.getHammerOnPullOffTechnicalOpts=function(a){return{hammerOnPullOff:i.create(a)}},u.extractBeams=function(){if(this.hasBeam=a.hasBeam(this.note),this.hasBeam){var b=a.getBeams(this.note);b=b.map(f.copy),b.sort(f.compare),this.beams=b}},u.extractArpeggiate=function(){this.hasArpeggio=a.hasArpeggiate(this.note)},u.extractGlissandos=function(){this.glissandoStarts=[],this.glissandoStops=[],this.notes.forEach(function(a,b){var c=this.lines[b];this.extractGlissandoStarts(a,c),this.extractGlissandoStops(a,c)},this)},u.extractGlissandoStarts=function(b,c){if(a.hasGlissandoType(b,p.START)){a.getGlissandosType(b,p.START).forEach(function(a){var b={line:c,number:j.getNumber(a)};this.glissandoStarts.push(b)},this)}},u.extractGlissandoStops=function(b,c){if(a.hasGlissandoType(b,p.STOP)){a.getGlissandosType(b,p.STOP).forEach(function(a){var b={line:c,number:j.getNumber(a)};this.glissandoStops.push(b)},this)}},u.extractCommonHistory=function(){this.globalCssClassesStr=k.getGlobalCssClassesStr(this.note)},u.extractHasFlagDash=function(){this.hasFlagDash=a.isSlashedGrace(this.note)}}.call(this),function(){"use strict";var a=Adagio.Utils.staffDetailsUtils,b=Adagio.Values.StemStrategy,c=Adagio.Values.Stem,d=Adagio.Drawer.VoiceDrawer,e=Adagio.Drawer.RenderedNote,f=Adagio.Render.SlurAnchorsBuilder,g=Adagio.Render.BeamProcessor,h=Adagio.Render.TieProcessor,i=Adagio.Render.HyphenProcessor,j=Adagio.Render.TupletProcessor,k=Adagio.Render.GlissandoProcessor,l=Adagio.Render.HammerOnPullOffProcessor,m=Adagio.Render.GraceBeamProcessor,n=Adagio.Render.extractNoteDisplayData,o=Adagio.Render.VoiceBuilder=function(){this.init()},p=o.prototype;p.init=function(){this.slurAnchorsBuilder=new f},p.build=function(a,b,c,d,e,f,g){return this.reset(c,d,e,f,g),this.fillNotes(a),this.fillNotesGraces(a),this.fillNotesBeams(a),this.isTabStaff()?this.fillNotesHammerOnPullOffs(a):(this.fillSlurs(a,b),this.fillNotesGracesBeams(a),this.fillNotesTies(a),this.fillNotesHyphens(a),this.fillNotesTuplets(a),this.fillNotesGlissandos(a)),this.voice},p.reset=function(a,b,c,e,f){this.attrs=a,this.location=b,this.voice=new d(b.voiceIdx),this.renderedNotes=null;var n=a.getDpq();this.voice.setDpq(n);var o=a.getNbDivisions();this.voice.setNbDivisions(o),this.beamProcessor=new g(this.voice),this.tieProcessor=new h(this.voice),this.hyphenProcessor=new i(this.voice),this.tupletProcessor=new j(this.voice,f),this.glissandoProcessor=new k(this.voice),this.hammerOnPullOffProcessor=new l(this.voice),this.graceBeamProcessor=new m(this.voice,f),this.previousMeasure=c,this.nextMeasure=e,this.stemStrategy=f},p.fillNotes=function(a){this.renderedNotes=a.map(this.createTickableNote,this),this.renderedNotes.forEach(this.voice.addNote,this.voice)},p.createTickableNote=function(a){var b=this.createNote(a.chordJson);return b.setTimePos(a.timePos),b},p.fillNotesGraces=function(a){a.forEach(this.fillNoteGraces,this)},p.fillNoteGraces=function(a,b){var c=a.graces.map(this.createNote,this);this.voice.addNoteGraces(b,c)},p.createNote=function(a){var d=n(a,this.attrs,this.stemStrategy);return this.stemStrategy===b.UP?d.setSpeficiedStem(c.UP):this.stemStrategy===b.DOWN&&d.setSpeficiedStem(c.DOWN),new e(d,null)},p.isTabStaff=function(){var b=this.attrs.getStaffDetails(this.location.staffIdx);return a.hasStaffTuning(b)},p.fillSlurs=function(a,b){var c=this.voice.getVoiceIdx();this.slurAnchorsBuilder.build(this.voice,c,a,b,this.stemStrategy)},p.fillNotesBeams=function(a){a.forEach(this.fillNoteBeam,this)},p.fillNoteBeam=function(a,b){var c=a.chordJson;if(this.beamProcessor.canProcess(c)){var d=this.renderedNotes[b];this.beamProcessor.addNote(c,d)}},p.fillNotesGracesBeams=function(a){a.forEach(this.fillNoteGracesBeam,this)},p.fillNoteGracesBeam=function(a,b){var c=this.voice.getNoteGraces(b);this.graceBeamProcessor.setNoteIdx(b),a.graces.forEach(function(a,b){if(this.graceBeamProcessor.canProcess(a)){var d=c[b];this.graceBeamProcessor.addNote(a,d)}},this)},p.fillNotesTies=function(a){a.forEach(this.fillNoteTie,this)},p.fillNoteTie=function(a,b,c){var d=0===b,e=b===c.length-1,f=a.chordJson;if(this.tieProcessor.canProcess(f)){var g=this.renderedNotes[b];this.tieProcessor.addNote(f,g,d,e)}},p.fillNotesHyphens=function(a){for(var b=a.length,c=0;c+1<b;c++){var d=a[c].chordJson,e=a[c+1].chordJson;this.fillNoteHyphen(d,c,e)}var f=a[0].chordJson;this.fillLeftHyphenAnchor(f);var g=b-1,h=a[g].chordJson;this.fillRightHyphenAnchor(h,g)},p.fillNoteHyphen=function(a,b,c){if(this.hyphenProcessor.canProcess(a,c)){var d=this.renderedNotes[b],e=this.renderedNotes[b+1];this.hyphenProcessor.addConnection(a,d,c,e)}},p.fillLeftHyphenAnchor=function(a){if(this.hyphenProcessor.canProcessLeft(a)){var b=this.renderedNotes[0];this.hyphenProcessor.addLeftAnchor(b)}},p.fillRightHyphenAnchor=function(a,b){if(this.hyphenProcessor.canProcessRight(a)){var c=this.renderedNotes[b];this.hyphenProcessor.addRightAnchor(c)}},p.fillNotesTuplets=function(a){a.forEach(this.fillNoteTuplet,this)},p.fillNoteTuplet=function(a,b){var c=a.chordJson;if(this.tupletProcessor.canProcess(c)){var d=this.renderedNotes[b];this.tupletProcessor.addNote(c,d)}},p.fillNotesGlissandos=function(a){a.forEach(this.fillNoteGlissando,this)},p.fillNoteGlissando=function(a,b,c){var d=this.location.voiceIdx,e=0===b,f=b===c.length-1,g=a.chordJson;if(this.glissandoProcessor.canProcess(g)){var h=this.renderedNotes[b];if(e){var i=null!==this.previousMeasure&&this.previousMeasure.hasVoice(d)?this.previousMeasure.getLastNoteDisplayData(d):null;this.glissandoProcessor.addFirstNote(g,h,i)}if(this.glissandoProcessor.addInternalNote(g,h),f){var j=null!==this.nextMeasure&&this.nextMeasure.hasVoice(d)?this.nextMeasure.getFirstNoteDisplayData(d):null;this.glissandoProcessor.addLastNote(g,h,j)}}},p.fillNotesHammerOnPullOffs=function(a){a.forEach(this.fillNoteHammerOnPullOff,this)},p.fillNoteHammerOnPullOff=function(a,b,c){var d=0===b,e=b===c.length-1,f=a.chordJson;if(this.hammerOnPullOffProcessor.canProcess(f)){var g=this.renderedNotes[b];this.hammerOnPullOffProcessor.addNote(f,g,d,e)}}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError;(Adagio.Drawer.wedge.SpreadType={OPEN:"open",OPEN_CONTINUE:"open-continue",CLOSED:"closed",CLOSED_CONTINUE:"closed-continue"}).raiseError=function(b){throw new a("BadWedgeSpreadType","The wedge spread type ["+b+"] is invalid.")}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Drawer.wedge.SpreadType,c=Adagio.Values.WedgeType,d=Adagio.Values.DirectionPlacement,e=Adagio.Values.WedgeLocation,f=Adagio.Values.HorizontalPosition,g=Adagio.Drawer.wedge.WedgeAnchor=function(a,b,c,d){this.init(a,b,c,d)},h=g.prototype;h.init=function(a,b,c,d){this.measure=null,this.wedge=null,this.measureIdx=null,this.type=a,this.placement=b,this.location=c,this.drawingContext=null,this.horizontalOffset=0,this.timePosition=void 0!==d?d:null},h.setMeasure=function(a){this.measure=a},h.isAbove=function(){return this.getPlacement()===d.ABOVE},h.isBelow=function(){return this.getPlacement()===d.BELOW},h.getPlacement=function(){return this.placement},h.getTimePos=function(){return this.timePosition},h.getHorizontalPosition=function(){if(this.location===e.LEFT)return f.WEDGE_START;if(this.location===e.RIGHT)return f.WEDGE_STOP;throw new a("Unexpected")},h.setDrawingContext=function(a){this.drawingContext=a},h.getDrawingContext=function(){return this.drawingContext},h.getWidth=function(){return 0},h.getX=function(){return this.location===e.LEFT_CONTINUE?this.getLeftX():this.location===e.RIGHT_CONTINUE?this.getRightX():this.isMiddle()?this.getMiddleX():void e.raiseError(this.location)},h.isMiddle=function(){return e.isMiddle(this.location)},h.getLeftX=function(){var a=this.measure.tickableContent;return this.measure.getXPos()+a.getXPos()-a.getPreviousSpace()},h.getRightX=function(){var a=this.measure,b=a.tickableContent;return a.getXPos()+b.getXPos()+b.getWidth()},h.getMiddleX=function(){if(null===this.timePosition){throw new a("Unexpected","Cannot compute a middleX position without time position")}var b=this.measure,c=b.tickableContent,d=b.getXPos()+c.getXPos()+this.horizontalOffset,f=d+c.timePosToX(this.timePosition);return this.location===e.RIGHT&&(f-=this.drawingContext.getSpaceSize()),f},h.getY=function(){if(this.isAbove())return this.measure.getUpDynamicsY();if(this.isBelow())return this.measure.getDownDynamicsY();throw new a("Unexpected")},h.getSpreadType=function(){if(this.isSpreadOpen())return b.OPEN;if(this.isSpreadOpenContinue())return b.OPEN_CONTINUE;if(this.isSpreadClose())return b.CLOSED;if(this.isSpreadCloseContinue())return b.CLOSED_CONTINUE;var c="The combination of the wedge location ["+this.location+"] and the type ["+this.type+"] is unexpected.";throw new a("Unexpected",c)},h.isSpreadOpen=function(){return this.location===e.LEFT&&this.type===c.DIMINUENDO||this.location===e.RIGHT&&this.type===c.CRESCENDO},h.isSpreadOpenContinue=function(){return this.location===e.LEFT_CONTINUE&&this.type===c.DIMINUENDO||this.location===e.RIGHT_CONTINUE&&this.type===c.CRESCENDO},h.isSpreadClose=function(){return this.location===e.LEFT&&this.type===c.CRESCENDO||this.location===e.RIGHT&&this.type===c.DIMINUENDO},h.isSpreadCloseContinue=function(){return this.location===e.LEFT_CONTINUE&&this.type===c.CRESCENDO||this.location===e.RIGHT_CONTINUE&&this.type===c.DIMINUENDO},h.hasWedge=function(){return null!==this.wedge},h.isLeft=function(){return e.isLeft(this.location)},h.isRight=function(){return e.isRight(this.location)},h.setWedge=function(a){this.wedge=a},h.getWedge=function(){return this.wedge},h.removeWedge=function(){this.isLeft()?this.wedge.removeLeftAnchor():this.isRight()?this.wedge.removeRightAnchor():e.raiseError(this.location)},h.setNeedDrawUpdate=function(){if(this.hasWedge()){this.getWedge().setNeedDrawUpdate()}},h.setHorizontalOffset=function(a){this.horizontalOffset=a},h.setMeasureIdx=function(a){this.measureIdx=a},h.getMeasureIdx=function(){return this.measureIdx}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.directionUtils,c=Adagio.Utils.wedgeUtils,d=Adagio.Values.DirectionType,e=Adagio.Drawer.wedge.WedgeAnchor,f=Adagio.Render.WedgeAnchorsBuilder=function(){this.init()},g=f.prototype;g.init=function(){this.tickableContent=null,this.measureJson=null,this.staffIdx=null},g.build=function(a,b,c,d){this.measureJson=c,this.staffIdx=d,this.tickableContent=a,this.addMiddleAnchors(b),this.addLeftContinueAnchors(),this.addRightContinueAnchors()},g.addMiddleAnchors=function(a){h(a).forEach(this.addMiddleAnchor,this)};var h=function(a){if(void 0!==a[d.WEDGE]){var c=a[d.WEDGE];return c.sort(b.compareTimePosInc),c}return[]};g.addMiddleAnchor=function(a){var d=b.getTimePos(a),f=b.getPlacement(a),g=b.getWedge(a),h=c.getLocation(g),i=c.getType(g),j=new e(i,f,h,d);this.tickableContent.addMiddleWedgeAnchor(j)},g.addLeftContinueAnchors=function(){if(a.hasLeftWedge(this.measureJson,this.staffIdx)){var d=a.getLeftWedge(this.measureJson,this.staffIdx);if(b.getStaffIdx(d)===this.staffIdx){var f=b.getPlacement(d),g=b.getWedge(d),h=c.getLocation(g),i=c.getType(g),j=new e(i,f,h);this.tickableContent.setLeftWedgeAnchor(j)}}},g.addRightContinueAnchors=function(){if(a.hasRightWedge(this.measureJson,this.staffIdx)){var d=a.getRightWedge(this.measureJson,this.staffIdx);if(b.getStaffIdx(d)===this.staffIdx){var f=b.getPlacement(d),g=b.getWedge(d),h=c.getLocation(g),i=c.getType(g),j=new e(i,f,h);this.tickableContent.setRightWedgeAnchor(j)}}}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Values.DirectionPlacement,c=Adagio.Values.OctaveShiftType,d=Adagio.Values.OctaveShiftLocation,e=Adagio.Drawer.octaveShift.OctaveShiftAnchor=function(a,b,c,d,e){this.init(a,b,c,d,e)},f=e.prototype;f.init=function(a,b,c,d,e){this.measure=null,this.octaveShift=null,this.measureIdx=null,this.type=a,this.size=b,this.location=e,this.placement=c,this.timePos=void 0!==d?d:null,this.drawingContext=null},f.setLocation=function(a){this.location=a},f.setMeasure=function(a){this.measure=a},f.isAbove=function(){return this.getPlacement()===b.ABOVE},f.isBelow=function(){return this.getPlacement()===b.BELOW},f.getPlacement=function(){return this.placement},f.getTimePos=function(){return this.timePos},f.getSize=function(){return this.size},f.isLeft=function(){return this.hasLocation()?d.isLeft(this.location):this.isStart()},f.isRight=function(){return this.hasLocation()?d.isRight(this.location):this.isStop()},f.isStop=function(){return this.type===c.STOP},f.isStart=function(){return this.type===c.UP||this.type===c.DOWN},f.hasLocation=function(){return void 0!==this.location},f.setDrawingContext=function(a){this.drawingContext=a},f.getDrawingContext=function(){return this.drawingContext},f.getX=function(){if(d.isLeft(this.location))return this.getLeftX();if(d.isRight(this.location))return this.getRightX();if(this.isStart()||this.isStop())return this.getMiddleX();throw new a("Unexpected")},f.getLeftX=function(){var a=this.measure.tickableContent;return this.measure.getXPos()+a.getXPos()-a.getPreviousSpace()},f.getRightX=function(){var a=this.measure,b=a.tickableContent;return a.getXPos()+b.getXPos()+b.getWidth()},f.getMiddleX=function(){if(null===this.timePos){throw new a("Unexpected","Cannot compute a middleX position without time position")}var b=this.measure,c=b.tickableContent;return b.getXPos()+c.getXPos()+c.timePosToX(this.timePos)},f.getY=function(){if(this.isAbove())return this.measure.getUpOctaveShiftsY();if(this.isBelow())return this.measure.getDownOctaveShiftsY();throw new a("Unexpected")},f.hasOctaveShift=function(){return null!==this.octaveShift},f.setOctaveShift=function(a){this.octaveShift=a},f.removeOctaveShift=function(){d.isLeft(this.location)?this.octaveShift.removeLeftAnchor():d.isRight(this.location)?this.octaveShift.removeRightAnchor():this.isStart()||this.isStop()||d.raiseError(this.location),this.octaveShift=null},f.getOctaveShift=function(){return this.octaveShift},f.setNeedDrawUpdate=function(){if(this.hasOctaveShift()){this.getOctaveShift().setNeedDrawUpdate()}}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.directionUtils,c=Adagio.Utils.direction.octaveShiftDirectionUtils,d=Adagio.Drawer.octaveShift.OctaveShiftAnchor,e=Adagio.Render.OctaveShiftAnchorsBuilder=function(){this.init()},f=e.prototype;f.init=function(){this.tickableContent=null,this.measureJson=null,this.staffIdx=null},f.build=function(a,b,c,d){this.measureJson=c,this.staffIdx=d,this.tickableContent=a,this.addMiddleAnchors(b),this.addLeftContinueAnchors(),this.addRightContinueAnchors()},f.addMiddleAnchors=function(a){a.sort(b.compareTimePosInc),a.forEach(this.addMiddleAnchor,this)},f.addMiddleAnchor=function(a){var b=c.getTimePos(a),e=c.getPlacement(a),f=c.getType(a),g=c.getSize(a),h=new d(f,g,e,b);this.tickableContent.addMiddleOctaveShiftAnchor(h)},f.addLeftContinueAnchors=function(){if(a.hasLeftOctaveShift(this.measureJson,this.staffIdx)){var b=a.getLeftOctaveShift(this.measureJson,this.staffIdx);if(c.getStaffIdx(b)===this.staffIdx){var e=c.getPlacement(b),f=c.getType(b),g=c.getSize(b),h=c.getLocation(b),i=new d(f,g,e,0,h);this.tickableContent.setLeftOctaveShiftAnchor(i)}}},f.addRightContinueAnchors=function(){if(a.hasRightOctaveShift(this.measureJson,this.staffIdx)){var e=a.getRightOctaveShift(this.measureJson,this.staffIdx);if(b.getStaffIdx(e)===this.staffIdx){var f=c.getPlacement(e),g=c.getType(e),h=c.getSize(e),i=c.getLocation(e),j=new d(g,h,f,0,i);this.tickableContent.setRightOctaveShiftAnchor(j)}}}}.call(this),function(){"use strict";Adagio.Drawer.chord.settings={GLOBAL_RATIO:.7,SMALL_FONT_SIZE:.7,SUBSCRIPT_BASELINE:.14,SUPSCRIPT_BASELINE:.35,MINOR_TEXT:"m",MAJOR_TEXT:"maj",SUS4_TEXT:"(sus4)",SUS2_TEXT:"(sus2)",MAJOR_CAPS:!1}}.call(this),function(){"use strict";var a=Adagio.Drawer.Text,b=Adagio.Drawer.chord.settings,c=Adagio.Drawer.chord.RootStep=function(a){this.init(a)};c.NAME="chord.rootStep";var d=c.prototype;d.name=c.NAME,d.init=function(a){this.step=a,this.text=null,this.parent=null,this.drawingContext=null,this.rendered=!1,this.posX=null,this.posY=null,this.createText()},d.createText=function(){var b={text:this.step};this.text=new a(b)},d.setParent=function(a){this.parent=a,this.text.setParent(a)},d.setPosX=function(a){this.posX=a},d.setPosY=function(a){this.posY=a},d.setDrawingContext=function(a){this.drawingContext=a,this.text.setDrawingContext(a);var c=a.getPixelPointSize();this.text.setFontSize(c*b.GLOBAL_RATIO);var d=a.getHarmonyFontFamily();this.text.options["font-family"]=d},d.draw=function(){this.rendered||this.render(),this.move()},d.render=function(){this.text.render(),this.text.setCssClass(this.name),this.text.draw(),this.rendered=!0},d.move=function(){this.rendered&&null!==this.posX&&null!==this.posY&&(this.text.setPosition(this.posX,this.posY),this.text.move())},d.getWidth=function(){return this.text.getWidth()},d.getHeight=function(){return this.getSpaceAbove()+this.getSpaceBelow()},d.getSpaceAbove=function(){return this.drawingContext.getPixelPointSize()*b.GLOBAL_RATIO},d.getSpaceBelow=function(){return this.drawingContext.getPixelPointSize()*b.GLOBAL_RATIO/2}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Brush.Elem,c=Adagio.Utils.mapUtils,d=Adagio.Drawer.chord.settings,e=c.fromPairs([{key:1,value:{glyphId:"accidentalSharp",offset:1.5}},{key:2,value:{glyphId:"accidentalDoubleSharp",offset:1.5}},{key:-1,value:{glyphId:"accidentalFlat",offset:1}},{key:-2,value:{glyphId:"accidentalDoubleFlat",offset:1}}]),f=Adagio.Drawer.chord.RootAlter=function(a){this.init(a)};f.NAME="chord.rootAlter";var g=f.prototype;g.name=f.NAME,g.init=function(a){this.alter=a,this.path=null,this.parent=null,this.drawingContext=null,this.glyph=null,this.posX=null,this.posY=null},g.setParent=function(a){this.parent=a},g.setPosX=function(a){this.posX=a},g.setPosY=function(a){this.posY=a},g.setDrawingContext=function(a){this.drawingContext=a},g.draw=function(){this.isRendered()||this.render(),this.move(),this.bindToParent()},g.render=function(){var a=this.getGlyph(),c=new b("path"),d=a.render();c.attr("d",d),c.attr("class",this.name),this.path=c},g.isRendered=function(){return null!==this.path},g.move=function(){if(this.isRendered()&&null!==this.posX&&null!==this.posY){var a=this.getOffset(),b=this.posY-a;this.path.attr("transform","translate("+this.posX+", "+b+")")}},g.bindToParent=function(){this.parent.append(this.path)},g.getWidth=function(){return this.getGlyph().getWidth()},g.getHeight=function(){return this.getSpaceAbove()+this.getSpaceBelow()},g.getSpaceAbove=function(){var a=this.getOffset();return-this.getGlyph().getBBoxNE().y+a},g.getSpaceBelow=function(){var a=this.getOffset();return this.getGlyph().getBBoxSW().y-a},g.getGlyph=function(){if(null===this.glyph){var a=h(this.alter);this.glyph=this.drawingContext.getScaledGlyph(a,d.GLOBAL_RATIO)}return this.glyph},g.getOffset=function(){var a=i(this.alter);return this.drawingContext.getSpaceSize()*d.GLOBAL_RATIO*a};var h=function(a){return j(a).glyphId},i=function(a){return j(a).offset},j=function(b){if(void 0===e[b]){throw new a("BadAlterValue","The alter value ["+b+"] is invalid.")}return e[b]}}.call(this),function(){"use strict";var a=Adagio.Drawer.Text,b=Adagio.Drawer.chord.settings,c=Adagio.Drawer.chord.Major=function(){this.init()};c.NAME="chord.major";var d=c.prototype;d.name=c.NAME,d.init=function(){this.text=null,this.parent=null,this.drawingContext=null,this.rendered=!1,this.posX=null,this.posY=null,this.createText()},d.createText=function(){var c={text:b.MAJOR_TEXT};b.MAJOR_CAPS&&(c["font-variant"]="small-caps"),this.text=new a(c)},d.setParent=function(a){this.parent=a,this.text.setParent(a)},d.setPosX=function(a){this.posX=a},d.setPosY=function(a){this.posY=a},d.setDrawingContext=function(a){this.drawingContext=a,this.text.setDrawingContext(a);var b=this.getFontSize();this.text.setFontSize(b);var c=a.getHarmonyFontFamily();this.text.options["font-family"]=c},d.draw=function(){this.rendered||this.render(),this.move()},d.render=function(){this.text.render(),this.text.setCssClass(this.name),this.text.draw(),this.rendered=!0},d.move=function(){if(this.rendered&&null!==this.posX&&null!==this.posY){var a=this.getYShift(),b=this.posY-a;this.text.setPosition(this.posX,b),this.text.move()}},d.getWidth=function(){return this.text.getWidth()},d.getHeight=function(){return this.getSpaceAbove()+this.getSpaceBelow()},d.getSpaceAbove=function(){return this.getYShift()+this.getFontSize()},d.getYShift=function(){return this.drawingContext.getPixelPointSize()*b.SUPSCRIPT_BASELINE*b.GLOBAL_RATIO},d.getFontSize=function(){return this.drawingContext.getPixelPointSize()*b.SMALL_FONT_SIZE*b.GLOBAL_RATIO},d.getSpaceBelow=function(){return this.drawingContext.getPixelPointSize()*b.GLOBAL_RATIO/2}}.call(this),function(){"use strict";var a=Adagio.Drawer.Text,b=Adagio.Drawer.chord.settings,c=Adagio.Drawer.chord.Minor=function(){this.init()};c.NAME="chord.minor";var d=c.prototype;d.name=c.NAME,d.init=function(){this.text=null,this.parent=null,this.drawingContext=null,this.rendered=!1,this.posX=null,this.posY=null,this.createText()},d.createText=function(){var c={text:b.MINOR_TEXT};this.text=new a(c)},d.setParent=function(a){this.parent=a,this.text.setParent(a)},d.setPosX=function(a){this.posX=a},d.setPosY=function(a){this.posY=a},d.setDrawingContext=function(a){this.drawingContext=a,this.text.setDrawingContext(a);var c=a.getPixelPointSize(),d=c*b.SMALL_FONT_SIZE*b.GLOBAL_RATIO;this.text.setFontSize(d);var e=a.getHarmonyFontFamily();this.text.options["font-family"]=e},d.draw=function(){this.rendered||this.render(),this.move()},d.render=function(){this.text.render(),this.text.setCssClass(this.name),this.text.draw(),this.rendered=!0},d.move=function(){this.rendered&&null!==this.posX&&null!==this.posY&&(this.text.setPosition(this.posX,this.posY),this.text.move())},d.getWidth=function(){return this.text.getWidth()},d.getHeight=function(){return this.getSpaceAbove()+this.getSpaceBelow()},d.getSpaceAbove=function(){return this.drawingContext.getPixelPointSize()*b.GLOBAL_RATIO},d.getSpaceBelow=function(){return this.drawingContext.getPixelPointSize()*b.GLOBAL_RATIO/2}}.call(this),function(){"use strict";var a="csymAugmented",b=Adagio.Brush.Elem,c=Adagio.Drawer.chord.settings,d=Adagio.Drawer.chord.Augmented=function(){this.init()};d.NAME="chord.augmented";var e=d.prototype;e.name=d.NAME,e.init=function(){this.path=null,this.parent=null,this.drawingContext=null,this.glyph=null,this.posX=null,this.posY=null},e.setParent=function(a){this.parent=a},e.setPosX=function(a){this.posX=a},e.setPosY=function(a){this.posY=a},e.setDrawingContext=function(a){this.drawingContext=a},e.draw=function(){this.isRendered()||this.render(),this.move(),this.bindToParent()},e.render=function(){var a=this.getGlyph(),c=new b("path"),d=a.render();c.attr("d",d),c.attr("class",this.name),this.path=c},e.isRendered=function(){return null!==this.path},e.move=function(){if(this.isRendered()&&null!==this.posX&&null!==this.posY){var a=this.getYShift(),b=this.posY-a,c=this.getLeftPadding(),d=this.posX+c;this.path.attr("transform","translate("+d+", "+b+")")}},e.bindToParent=function(){this.parent.append(this.path)},e.getWidth=function(){return this.getGlyph().getWidth()+this.getLeftPadding()},e.getLeftPadding=function(){return this.drawingContext.getSpaceSize()*c.SUPSCRIPT_BASELINE*c.GLOBAL_RATIO/2},e.getHeight=function(){return this.getSpaceAbove()+this.getSpaceBelow()},e.getSpaceAbove=function(){var a=this.getYShift();return-this.getGlyph().getBBoxNE().y+a},e.getYShift=function(){return this.drawingContext.getPixelPointSize()*c.SUPSCRIPT_BASELINE*c.GLOBAL_RATIO},e.getSpaceBelow=function(){return this.getGlyph().getBBoxSW().y},e.getGlyph=function(){if(null===this.glyph){var b=c.SMALL_FONT_SIZE*c.GLOBAL_RATIO;this.glyph=this.drawingContext.getScaledGlyph(a,b)}return this.glyph}}.call(this),function(){"use strict";var a="csymDiminished",b=Adagio.Brush.Elem,c=Adagio.Drawer.chord.settings,d=Adagio.Drawer.chord.Diminished=function(){this.init()};d.NAME="chord.diminished";var e=d.prototype;e.name=d.NAME,e.init=function(){this.path=null,this.parent=null,this.drawingContext=null,this.glyph=null,this.posX=null,this.posY=null},e.setParent=function(a){this.parent=a},e.setPosX=function(a){this.posX=a},e.setPosY=function(a){this.posY=a},e.setDrawingContext=function(a){this.drawingContext=a},e.draw=function(){this.isRendered()||this.render(),this.move(),this.bindToParent()},e.render=function(){var a=this.getGlyph(),c=new b("path"),d=a.render();c.attr("d",d),c.attr("class",this.name),this.path=c},e.isRendered=function(){return null!==this.path},e.move=function(){if(this.isRendered()&&null!==this.posX&&null!==this.posY){var a=this.getYShift(),b=this.posY-a,c=this.getSidePadding(),d=this.posX+c;this.path.attr("transform","translate("+d+", "+b+")")}},e.bindToParent=function(){this.parent.append(this.path)},e.getWidth=function(){return this.getGlyph().getWidth()+2*this.getSidePadding()},e.getSidePadding=function(){return this.drawingContext.getSpaceSize()*c.SUPSCRIPT_BASELINE*c.GLOBAL_RATIO/4},e.getHeight=function(){return this.getSpaceAbove()+this.getSpaceBelow()},e.getSpaceAbove=function(){var a=this.getYShift();return-this.getGlyph().getBBoxNE().y+a},e.getYShift=function(){return this.drawingContext.getPixelPointSize()*c.SUPSCRIPT_BASELINE*c.GLOBAL_RATIO},e.getSpaceBelow=function(){return this.getGlyph().getBBoxSW().y},e.getGlyph=function(){if(null===this.glyph){var b=c.SMALL_FONT_SIZE*c.GLOBAL_RATIO;this.glyph=this.drawingContext.getScaledGlyph(a,b)}return this.glyph}}.call(this),function(){"use strict";var a="csymHalfDiminished",b=Adagio.Brush.Elem,c=Adagio.Drawer.chord.settings,d=Adagio.Drawer.chord.HalfDiminished=function(){this.init()};d.NAME="chord.diminished";var e=d.prototype;e.name=d.NAME,e.init=function(){this.path=null,this.parent=null,this.drawingContext=null,this.glyph=null,this.posX=null,this.posY=null},e.setParent=function(a){this.parent=a},e.setPosX=function(a){this.posX=a},e.setPosY=function(a){this.posY=a},e.setDrawingContext=function(a){this.drawingContext=a},e.draw=function(){this.isRendered()||this.render(),this.move(),this.bindToParent()},e.render=function(){var a=this.getGlyph(),c=new b("path"),d=a.render();c.attr("d",d),c.attr("class",this.name),this.path=c},e.isRendered=function(){return null!==this.path},e.move=function(){if(this.isRendered()&&null!==this.posX&&null!==this.posY){var a=this.getYShift(),b=this.posY-a;this.path.attr("transform","translate("+this.posX+", "+b+")")}},e.bindToParent=function(){this.parent.append(this.path)},e.getWidth=function(){return this.getGlyph().getWidth()},e.getHeight=function(){return this.getSpaceAbove()+this.getSpaceBelow()},e.getSpaceAbove=function(){var a=this.getYShift();return-this.getGlyph().getBBoxNE().y+a},e.getYShift=function(){return this.drawingContext.getPixelPointSize()*c.SUPSCRIPT_BASELINE*c.GLOBAL_RATIO},e.getSpaceBelow=function(){return this.getGlyph().getBBoxSW().y},e.getGlyph=function(){if(null===this.glyph){var b=c.SMALL_FONT_SIZE*c.GLOBAL_RATIO;this.glyph=this.drawingContext.getScaledGlyph(a,b)}return this.glyph}}.call(this),function(){"use strict";var a=Adagio.Drawer.Text,b=Adagio.Drawer.chord.settings,c=Adagio.Drawer.chord.SuperScript=function(a,b){this.init(a,b)};c.NAME="chord.superScript";var d=c.prototype;d.name=c.NAME,d.init=function(a,b){this.str=a,"string"==typeof b&&(this.name=b),this.text=null,this.parent=null,this.drawingContext=null,this.rendered=!1,this.posX=null,this.posY=null,this.createText()},d.createText=function(){var b={text:this.str};this.text=new a(b)},d.setParent=function(a){this.parent=a,this.text.setParent(a)},d.setPosX=function(a){this.posX=a},d.setPosY=function(a){this.posY=a},d.setDrawingContext=function(a){this.drawingContext=a,this.text.setDrawingContext(a);var b=this.getFontSize();this.text.setFontSize(b);var c=a.getHarmonyFontFamily();this.text.options["font-family"]=c},d.draw=function(){this.rendered||this.render(),this.move()},d.render=function(){this.text.render(),this.text.setCssClass(this.name),this.text.draw(),this.rendered=!0},d.move=function(){if(this.rendered&&null!==this.posX&&null!==this.posY){var a=this.getYShift(),b=this.posY-a;this.text.setPosition(this.posX,b),this.text.move()}},d.getWidth=function(){return this.text.getWidth()},d.getHeight=function(){return this.getSpaceAbove()+this.getSpaceBelow()},d.getSpaceAbove=function(){return this.getYShift()+this.getFontSize()},d.getYShift=function(){return this.drawingContext.getPixelPointSize()*b.SUPSCRIPT_BASELINE*b.GLOBAL_RATIO},d.getFontSize=function(){return this.drawingContext.getPixelPointSize()*b.SMALL_FONT_SIZE*b.GLOBAL_RATIO},d.getSpaceBelow=function(){return this.drawingContext.getPixelPointSize()*b.GLOBAL_RATIO/2}}.call(this),function(){"use strict";var a=Adagio.Drawer.chord.SuperScript,b=Adagio.Drawer.chord.KindDegree=function(a){this.init(a)};b.NAME="chord.kindDegree";var c=b.prototype;c.name=b.NAME,c.init=function(b){this.superScript=new a(b.toString(),this.name)},c.setParent=function(a){this.superScript.setParent(a)},c.setPosX=function(a){this.superScript.setPosX(a)},c.setPosY=function(a){this.superScript.setPosY(a)},c.setDrawingContext=function(a){this.superScript.setDrawingContext(a)},c.draw=function(){this.superScript.draw()},c.move=function(){this.superScript.move()},c.getWidth=function(){return this.superScript.getWidth()},c.getHeight=function(){return this.superScript.getHeight()},c.getSpaceAbove=function(){return this.superScript.getSpaceAbove()},c.getSpaceBelow=function(){return this.superScript.getSpaceBelow()}}.call(this),function(){"use strict";var a=Adagio.Drawer.chord.settings,b=Adagio.Drawer.chord.SuperScript,c=Adagio.Drawer.chord.Sus2=function(){this.init()};c.NAME="chord.sus4";var d=c.prototype;d.name=c.NAME,d.init=function(){this.superScript=new b(a.SUS2_TEXT,this.name)},d.setParent=function(a){this.superScript.setParent(a)},d.setPosX=function(a){this.superScript.setPosX(a)},d.setPosY=function(a){this.superScript.setPosY(a)},d.setDrawingContext=function(a){this.superScript.setDrawingContext(a)},d.draw=function(){this.superScript.draw()},d.move=function(){this.superScript.move()},d.getWidth=function(){return this.superScript.getWidth()},d.getHeight=function(){return this.superScript.getHeight()},d.getSpaceAbove=function(){return this.superScript.getSpaceAbove()},d.getSpaceBelow=function(){return this.superScript.getSpaceBelow()}}.call(this),function(){"use strict";var a=Adagio.Brush.Elem,b=Adagio.Utils.math,c=Adagio.Drawer.chord.Chord=function(){this.init()};c.NAME="chord";var d=c.prototype;d.name=c.NAME,d.init=function(){this.group=null,this.parent=null,this.drawingContext=null,this.symbols=[],this.timePos=null,this.posX=null,this.posY=null,this.width=null,this.spaceBelow=null,this.spaceAbove=null},d.setTimePos=function(a){this.timePos=a},d.setParent=function(a){this.parent=a},d.setPosX=function(a){this.posX=a},d.setPosY=function(a){this.posY=a},d.addSymbol=function(a){this.symbols.push(a)},d.setDrawingContext=function(a){this.drawingContext=a,this.symbols.forEach(this.transferDrawingContext,this)},d.transferDrawingContext=function(a){a.setDrawingContext(this.drawingContext)},d.draw=function(){this.isRendered()||(this.render(),this.format()),this.drawContent(),this.move(),this.bindToParent()},d.isRendered=function(){return null!==this.group},d.render=function(){this.group=new a("g"),this.group.attr("class",this.name),this.symbols.forEach(this.transferParent,this)},d.transferParent=function(a){a.setParent(this.group)},d.format=function(){this.formatVertical(),this.formatHorizontal()},d.formatVertical=function(){this.symbols.forEach(this.transferPosY,this)},d.transferPosY=function(a){var b=this.getSpaceAbove();a.setPosY(b)},d.formatHorizontal=function(){this.symbols.reduce(e,0)};var e=function(a,b){return b.setPosX(a),a+b.getWidth()}
;d.drawContent=function(){this.symbols.forEach(f)};var f=function(a){a.draw()};d.move=function(){this.isRendered()&&null!==this.posX&&null!==this.posY&&this.group.attr("transform","translate("+this.posX+", "+this.posY+")")},d.bindToParent=function(){this.parent.append(this.group)},d.getWidth=function(){if(null===this.width){var a=this.symbols.map(g);this.width=a.reduce(b.add,0)}return this.width};var g=function(a){return a.getWidth()};d.getHeight=function(){return this.getSpaceAbove()+this.getSpaceBelow()},d.getSpaceAbove=function(){if(null===this.spaceAbove){var a=this.symbols.map(h);this.spaceAbove=a.reduce(b.max2,0)}return this.spaceAbove};var h=function(a){return a.getSpaceAbove()};d.getSpaceBelow=function(){if(null===this.spaceBelow){var a=this.symbols.map(i);this.spaceBelow=a.reduce(b.max2,0)}return this.spaceBelow},d.getTimePos=function(){return this.timePos};var i=function(a){return a.getSpaceBelow()}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Brush.Elem,c=Adagio.Utils.mapUtils,d=Adagio.Drawer.chord.settings,e=c.fromPairs([{key:1,value:{glyphId:"accidentalSharp",offset:2}},{key:-1,value:{glyphId:"accidentalFlat",offset:2}}]),f=Adagio.Drawer.chord.DegreeAlter=function(a){this.init(a)};f.NAME="chord.degreeAlter";var g=f.prototype;g.name=f.NAME,g.init=function(a){this.alter=a,this.path=null,this.parent=null,this.drawingContext=null,this.glyph=null,this.posX=null,this.posY=null},g.setParent=function(a){this.parent=a},g.setPosX=function(a){this.posX=a},g.setPosY=function(a){this.posY=a},g.setDrawingContext=function(a){this.drawingContext=a},g.draw=function(){this.isRendered()||this.render(),this.move(),this.bindToParent()},g.render=function(){var a=this.getGlyph(),c=new b("path"),d=a.render();c.attr("d",d),c.attr("class",this.name),this.path=c},g.isRendered=function(){return null!==this.path},g.move=function(){if(this.isRendered()&&null!==this.posX&&null!==this.posY){var a=this.getOffset(),b=this.posY-a;this.path.attr("transform","translate("+this.posX+", "+b+")")}},g.bindToParent=function(){this.parent.append(this.path)},g.getWidth=function(){return this.getGlyph().getWidth()},g.getHeight=function(){return this.getSpaceAbove()+this.getSpaceBelow()},g.getSpaceAbove=function(){var a=this.getOffset();return-this.getGlyph().getBBoxNE().y+a},g.getSpaceBelow=function(){var a=this.getOffset();return this.getGlyph().getBBoxSW().y-a},g.getGlyph=function(){if(null===this.glyph){var a=h(this.alter),b=d.GLOBAL_RATIO;this.glyph=this.drawingContext.getScaledGlyph(a,b)}return this.glyph},g.getOffset=function(){var a=i(this.alter);return this.drawingContext.getSpaceSize()*d.GLOBAL_RATIO*a};var h=function(a){return j(a).glyphId},i=function(a){return j(a).offset},j=function(b){if(void 0===e[b]){throw new a("BadAlterValue","The alter value ["+b+"] is invalid.")}return e[b]}}.call(this),function(){"use strict";var a=Adagio.Utils.degreeUtils;Adagio.Render.harmony.getFiller=function(a,c){var d=a.find(b,c);return void 0!==d?d.filler:null};var b=function(a){var b=this;return a.degrees.length===b.length&&a.degrees.every(c,b)},c=function(b,c){var d=this,e=d[c];return a.isSame(b,e)}}.call(this),function(){"use strict";var a=Adagio.Values.DegreeType,b=Adagio.Utils.degreeUtils,c=Adagio.Drawer.chord.DegreeAlter,d=Adagio.Drawer.chord.SuperScript,e=Adagio.Drawer.chord.KindDegree,f=Adagio.Render.harmony.getFiller;Adagio.Render.harmony.DominantBuilder=function(a,b){if(b.length>0){var c=f(p,b);null!==c&&c(a)}else o(a)};var g=function(a){o(a);var b=new d("(");a.addBeforeDegree(b);var f=new c(1);a.addBeforeDegree(f);var g=new e(5);a.addBeforeDegree(g);var h=new d(")");a.addBeforeDegree(h)},h=function(a){o(a);var b=new d("(");a.addBeforeDegree(b);var f=new c(-1);a.addBeforeDegree(f);var g=new e(5);a.addBeforeDegree(g);var h=new d(")");a.addBeforeDegree(h)},i=function(a){o(a);var b=new d("(");a.addBeforeDegree(b);var f=new c(1);a.addBeforeDegree(f);var g=new e(11);a.addBeforeDegree(g);var h=new d(")");a.addBeforeDegree(h)},j=function(a){o(a);var b=new d("(");a.addBeforeDegree(b);var f=new c(-1);a.addBeforeDegree(f);var g=new e(11);a.addBeforeDegree(g);var h=new d(")");a.addBeforeDegree(h)},k=function(a){o(a);var b=new d("(");a.addBeforeDegree(b);var f=new c(1);a.addBeforeDegree(f);var g=new e(9);a.addBeforeDegree(g);var h=new d(")");a.addBeforeDegree(h)},l=function(a){o(a);var b=new d("(");a.addBeforeDegree(b);var f=new c(-1);a.addBeforeDegree(f);var g=new e(9);a.addBeforeDegree(g);var h=new d(")");a.addBeforeDegree(h)},m=function(a){o(a);var b=new d("(");a.addBeforeDegree(b);var f=new c(-1);a.addBeforeDegree(f);var g=new e(13);a.addBeforeDegree(g);var h=new d(")");a.addBeforeDegree(h)},n=function(a){o(a);var b=new d("(");a.addBeforeDegree(b);var f=new c(1);a.addBeforeDegree(f);var g=new e(13);a.addBeforeDegree(g);var h=new d(")");a.addBeforeDegree(h)},o=function(a){var b=new e(7);a.addBeforeDegree(b)},p=[{degrees:[b.create(5,a.ALTER,1)],filler:g},{degrees:[b.create(5,a.ALTER,-1)],filler:h},{degrees:[b.create(11,a.ADD,1)],filler:i},{degrees:[b.create(11,a.ADD,-1)],filler:j},{degrees:[b.create(9,a.ADD,1)],filler:k},{degrees:[b.create(9,a.ADD,-1)],filler:l},{degrees:[b.create(13,a.ADD,-1)],filler:m},{degrees:[b.create(13,a.ADD,1)],filler:n}]}.call(this),function(){"use strict";var a=Adagio.Values.DegreeType,b=Adagio.Utils.degreeUtils,c=Adagio.Drawer.chord.DegreeAlter,d=Adagio.Drawer.chord.SuperScript,e=Adagio.Drawer.chord.KindDegree,f=Adagio.Drawer.chord.Minor,g=Adagio.Render.harmony.getFiller;Adagio.Render.harmony.Minor7Builder=function(a,b){if(b.length>0){var c=g(l,b);null!==c&&c(a)}else k(a)};var h=function(a){k(a);var b=new d("(");a.addBeforeDegree(b);var f=new c(-1);a.addBeforeDegree(f);var g=new e(5);a.addBeforeDegree(g);var h=new d(")");a.addBeforeDegree(h)},i=function(a){k(a);var b=new d("(");a.addBeforeDegree(b);var f=new c(1);a.addBeforeDegree(f);var g=new e(5);a.addBeforeDegree(g);var h=new d(")");a.addBeforeDegree(h)},j=function(a){k(a);var b=new d("(add");a.addBeforeDegree(b);var c=new e(4);a.addBeforeDegree(c);var f=new d(")");a.addBeforeDegree(f)},k=function(a){var b=new f;a.addBeforeDegree(b);var c=new e(7);a.addBeforeDegree(c)},l=[{degrees:[b.create(5,a.ALTER,-1)],filler:h},{degrees:[b.create(5,a.ALTER,1)],filler:i},{degrees:[b.create(4,a.ADD,0)],filler:j}]}.call(this),function(){"use strict";var a=Adagio.Values.DegreeType,b=Adagio.Utils.degreeUtils,c=Adagio.Drawer.chord.DegreeAlter,d=Adagio.Drawer.chord.SuperScript,e=Adagio.Drawer.chord.KindDegree,f=Adagio.Drawer.chord.Major,g=Adagio.Drawer.chord.Minor,h=Adagio.Render.harmony.getFiller;Adagio.Render.harmony.Minor9Builder=function(a,b){if(b.length>0){var c=h(l,b);null!==c&&c(a)}else k(a)};var i=function(a){var b=new g;a.addBeforeDegree(b);var c=new d("(");a.addBeforeDegree(c);var h=new f;a.addBeforeDegree(h);var i=new e(9);a.addBeforeDegree(i);var j=new d(")");a.addBeforeDegree(j)},j=function(a){k(a);var b=new d("(");a.addBeforeDegree(b);var f=new c(-1);a.addBeforeDegree(f);var g=new e(5);a.addBeforeDegree(g);var h=new d(")");a.addBeforeDegree(h)},k=function(a){var b=new g;a.addBeforeDegree(b);var c=new e(9);a.addBeforeDegree(c)},l=[{degrees:[b.create(7,a.ALTER,0)],filler:i},{degrees:[b.create(5,a.ALTER,-1)],filler:j}]}.call(this),function(){"use strict";var a=Adagio.Drawer.chord.settings,b=Adagio.Drawer.chord.SuperScript,c=Adagio.Drawer.chord.Sus4=function(){this.init()};c.NAME="chord.sus4";var d=c.prototype;d.name=c.NAME,d.init=function(){this.superScript=new b(a.SUS4_TEXT,this.name)},d.setParent=function(a){this.superScript.setParent(a)},d.setPosX=function(a){this.superScript.setPosX(a)},d.setPosY=function(a){this.superScript.setPosY(a)},d.setDrawingContext=function(a){this.superScript.setDrawingContext(a)},d.draw=function(){this.superScript.draw()},d.move=function(){this.superScript.move()},d.getWidth=function(){return this.superScript.getWidth()},d.getHeight=function(){return this.superScript.getHeight()},d.getSpaceAbove=function(){return this.superScript.getSpaceAbove()},d.getSpaceBelow=function(){return this.superScript.getSpaceBelow()}}.call(this),function(){"use strict";var a=Adagio.Values.DegreeType,b=Adagio.Utils.degreeUtils,c=Adagio.Drawer.chord.DegreeAlter,d=Adagio.Drawer.chord.SuperScript,e=Adagio.Drawer.chord.Sus4,f=Adagio.Drawer.chord.KindDegree,g=Adagio.Render.harmony.getFiller;Adagio.Render.harmony.Sus4Builder=function(a,b){if(b.length>0){var c=g(m,b);null!==c&&c(a)}else h(a)};var h=function(a){var b=new e;a.addAfterDegree(b)},i=function(a){var b=new f(7);a.addBeforeDegree(b);var c=new e;a.addAfterDegree(c)},j=function(a){var b=new f(7);a.addBeforeDegree(b);var e=new d("(");a.addBeforeDegree(e);var g=new c(-1);a.addBeforeDegree(g);var h=new f(9);a.addBeforeDegree(h);var i=new d("sus4)");a.addBeforeDegree(i)},k=function(a){var b=new f(9);a.addBeforeDegree(b);var c=new e;a.addAfterDegree(c)},l=function(a){var b=new d("(sus4, ");a.addBeforeDegree(b);var e=new c(-1);a.addBeforeDegree(e);var g=new f(5);a.addBeforeDegree(g);var h=new d(")");a.addBeforeDegree(h)},m=[{degrees:[b.create(7,a.ADD,-1)],filler:i},{degrees:[b.create(7,a.ADD,-1),b.create(9,a.ADD,-1)],filler:j},{degrees:[b.create(7,a.ADD,-1),b.create(9,a.ADD,0)],filler:k},{degrees:[b.create(5,a.ALTER,-1)],filler:l}]}.call(this),function(){"use strict";var a=Adagio.Values.DegreeType,b=Adagio.Utils.degreeUtils,c=Adagio.Drawer.chord.DegreeAlter,d=Adagio.Drawer.chord.SuperScript,e=Adagio.Drawer.chord.KindDegree,f=Adagio.Render.harmony.getFiller;Adagio.Render.harmony.Dominant13Builder=function(a,b){if(b.length>0){var c=f(j,b);null!==c&&c(a)}else i(a)};var g=function(a){i(a);var b=new d("(");a.addBeforeDegree(b);var f=new c(1);a.addBeforeDegree(f);var g=new e(11);a.addBeforeDegree(g);var h=new d(")");a.addBeforeDegree(h)},h=function(a){i(a);var b=new d("(");a.addBeforeDegree(b);var f=new c(-1);a.addBeforeDegree(f);var g=new e(9);a.addBeforeDegree(g);var h=new d(")");a.addBeforeDegree(h)},i=function(a){var b=new e(13);a.addBeforeDegree(b)},j=[{degrees:[b.create(11,a.ALTER,1)],filler:g},{degrees:[b.create(9,a.ALTER,-1)],filler:h}]}.call(this),function(){"use strict";var a=Adagio.Values.DegreeType,b=Adagio.Utils.degreeUtils,c=Adagio.Drawer.chord.DegreeAlter,d=Adagio.Drawer.chord.SuperScript,e=Adagio.Drawer.chord.KindDegree,f=Adagio.Drawer.chord.Minor,g=Adagio.Render.harmony.getFiller;Adagio.Render.harmony.Minor6Builder=function(a,b){if(b.length>0){var c=g(j,b);null!==c&&c(a)}else i(a)};var h=function(a){i(a);var b=new d("(");a.addBeforeDegree(b);var f=new c(1);a.addBeforeDegree(f);var g=new e(11);a.addBeforeDegree(g);var h=new d(")");a.addBeforeDegree(h)},i=function(a){var b=new f;a.addBeforeDegree(b);var c=new e(6);a.addBeforeDegree(c)},j=[{degrees:[b.create(5,a.ALTER,1)],filler:h}]}.call(this),function(){"use strict";var a=Adagio.Values.DegreeType,b=Adagio.Utils.degreeUtils,c=Adagio.Drawer.chord.SuperScript,d=Adagio.Drawer.chord.KindDegree,e=Adagio.Render.harmony.getFiller;Adagio.Render.harmony.MajorBuilder=function(a,b){if(b.length>0){var c=e(i,b);null!==c&&c(a)}else h(a)};var f=function(a){h(a);var b=new c("(add");a.addBeforeDegree(b);var e=new d(9);a.addBeforeDegree(e);var f=new c(")");a.addBeforeDegree(f)},g=function(a){h(a);var b=new d(2);a.addBeforeDegree(b)},h=function(){},i=[{degrees:[b.create(9,a.ADD,0)],filler:f},{degrees:[b.create(2,a.ADD,0)],filler:g}]}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Values.ChordKind,c=Adagio.Utils.harmonyUtils,d=Adagio.Utils.rootUtils,e=Adagio.Utils.bassUtils,f=Adagio.Drawer.chord.RootStep,g=Adagio.Drawer.chord.RootAlter,h=Adagio.Drawer.chord.Major,i=Adagio.Drawer.chord.Minor,j=Adagio.Drawer.chord.Augmented,k=Adagio.Drawer.chord.Diminished,l=Adagio.Drawer.chord.HalfDiminished,m=Adagio.Drawer.chord.KindDegree,n=Adagio.Drawer.chord.SuperScript,o=Adagio.Drawer.chord.Sus2,p=Adagio.Drawer.chord.Chord,q=Adagio.Render.harmony.DominantBuilder,r=Adagio.Render.harmony.Minor7Builder,s=Adagio.Render.harmony.Minor9Builder,t=Adagio.Render.harmony.Sus4Builder,u=Adagio.Render.harmony.Dominant13Builder,v=Adagio.Render.harmony.Minor6Builder,w=Adagio.Render.harmony.MajorBuilder,x=Adagio.Render.harmony.HarmonyBuilder=function(){this.init()},y=x.prototype;y.init=function(){},y.build=function(a){this.reset();var b=c.getRoot(a);this.createRoot(b);var d=c.getKindValue(a),e=c.getDegrees(a);if(this.createKind(d,e),c.hasBass(a)){var f=c.getBass(a);this.createBass(f)}var g=c.getTimePos(a);return this.createChord(g),this.chord},y.reset=function(){this.rootDrawers=[],this.beforeDegreeDrawers=[],this.afterDegreeDrawers=[],this.harmonyDrawer=null},y.createRoot=function(a){var b=d.getStep(a),c=new f(b);this.addRoot(c);var e=d.getAlter(a);if(0!==e){var h=new g(e);this.addRoot(h)}},y.addRoot=function(a){this.rootDrawers.push(a)},y.createBass=function(a){var b=e.getStep(a),c=new f("/"+b);this.addAfterDegree(c);var d=e.getAlter(a);if(0!==d){var h=new g(d);this.addAfterDegree(h)}},y.createKind=function(a,b){z(a)(this,b)};var z=function(b){if(void 0!==A[b])return A[b];throw new a("BadKind","There is no builder for the kind ["+b+"].")},A={};A[b.MAJOR]=w,A[b.MINOR]=function(a){var b=new i;a.addBeforeDegree(b)},A[b.AUGMENTED]=function(a){var b=new j;a.addBeforeDegree(b)},A[b.DIMINISHED]=function(a){var b=new k;a.addBeforeDegree(b)},A[b.MAJOR_6]=function(a){var b=new m(6);a.addBeforeDegree(b)},A[b.MINOR_6]=v,A[b.DOMINANT]=q,A[b.MAJOR_7]=function(a){var b=new h;a.addBeforeDegree(b);var c=new m(7);a.addBeforeDegree(c)},A[b.MINOR_7]=r,A[b.DIMINISHED_7]=function(a){var b=new k;a.addBeforeDegree(b);var c=new m(7);a.addBeforeDegree(c)},A[b.HALF_DIMINISHED]=function(a){var b=new l;a.addBeforeDegree(b);var c=new m(7);a.addBeforeDegree(c)},A[b.AUGMENTED_7]=function(a){var b=new j;a.addBeforeDegree(b);var c=new m(7);a.addBeforeDegree(c)},A[b.MAJOR_MINOR]=function(a){var b=new i;a.addBeforeDegree(b);var c=new n("(");a.addBeforeDegree(c);var d=new h;a.addBeforeDegree(d);var e=new m(7);a.addBeforeDegree(e);var f=new n(")");a.addBeforeDegree(f)},A[b.DOMINANT_9]=function(a){var b=new m(9);a.addBeforeDegree(b)},A[b.MAJOR_9]=function(a){var b=new h;a.addBeforeDegree(b);var c=new m(9);a.addBeforeDegree(c)},A[b.MINOR_9]=s,A[b.DOMINANT_11]=function(a){var b=new m(11);a.addBeforeDegree(b)},A[b.MAJOR_11]=function(a){var b=new h;a.addBeforeDegree(b);var c=new m(11);a.addBeforeDegree(c)},A[b.MINOR_11]=function(a){var b=new i;a.addBeforeDegree(b);var c=new m(11);a.addBeforeDegree(c)},A[b.DOMINANT_13]=u,A[b.MAJOR_13]=function(a){var b=new h;a.addBeforeDegree(b);var c=new m(13);a.addBeforeDegree(c)},A[b.MINOR_13]=function(a){var b=new i;a.addBeforeDegree(b);var c=new m(13);a.addBeforeDegree(c)},A[b.SUS_4]=t,A[b.SUS_2]=function(a){var b=new o;a.addAfterDegree(b)},y.addBeforeDegree=function(a){this.beforeDegreeDrawers.push(a)},y.addAfterDegree=function(a){this.afterDegreeDrawers.push(a)},y.createChord=function(a){var b=new p;b.setTimePos(a),this.rootDrawers.forEach(b.addSymbol,b),this.beforeDegreeDrawers.forEach(b.addSymbol,b),this.afterDegreeDrawers.forEach(b.addSymbol,b),this.chord=b}}.call(this),function(){"use strict";var a=2.5;Adagio.Render.shiftRests=function(a){for(var c=a[0],d=c.getNbNotes(),e=0,f=0,g=a[1],h=g.getNbNotes(),i=0,j=0;e<d&&i<h;){var k=c.getNote(e),l=g.getNote(i);f===j?(b(k,l),e++,i++,f+=k.getDuration(),j+=l.getDuration()):f<=j?(e++,f+=k.getDuration()):j<=f&&(i++,j+=l.getDuration())}};var b=function(a,b){a.isRest()&&!b.isRest()?c(a,b):!a.isRest()&&b.isRest()&&d(a,b)},c=function(b,c){var d=b.getDisplayData(),e=c.getDisplayData(),f=d.getLowestLine(),g=e.getHighestLine(),h=f-g;if(h<a){var i=a-h;d.isRest()&&d.getBaseQuarterDuration()>1&&(i=Math.ceil(i)),f+=i,d.setLine(f)}},d=function(b,c){var d=b.getDisplayData(),e=c.getDisplayData(),f=d.getLowestLine(),g=e.getHighestLine(),h=f-g;if(h<a){var i=a-h;e.isRest()&&e.getBaseQuarterDuration()>1&&(i=Math.ceil(i)),g-=i,e.setLine(g)}}}.call(this),function(){"use strict";var a=Adagio.Utils.math,b=Adagio.Utils.mapUtils,c=Adagio.Utils.measureUtils,d=Adagio.Utils.staffDetailsUtils,e=Adagio.Utils.direction.dynamicDirectionUtils,f=Adagio.Utils.direction.pizzicatoDirectionUtils,g=Adagio.Utils.direction.wordDirectionUtils,h=Adagio.Utils.direction.pedalDirectionUtils,i=Adagio.Values.StemStrategy,j=Adagio.Data.direction.splitByType,k=Adagio.Drawer.TickableContentDrawer,l=Adagio.Drawer.Dynamics,m=Adagio.Drawer.Pizzicato,n=Adagio.Drawer.Word,o=Adagio.Drawer.Pedal,p=Adagio.Render.VoiceBuilder,q=Adagio.Render.WedgeAnchorsBuilder,r=Adagio.Render.OctaveShiftAnchorsBuilder,s=Adagio.Render.harmony.HarmonyBuilder,t=Adagio.Render.shiftRests,u=Adagio.Render.TickableContentBuilder=function(){this.init()},v=u.prototype;v.init=function(){this.voiceBuilder=new p,this.wedgeAnchorsBuilder=new q,this.octaveShiftAnchorsBuilder=new r,this.harmonyBuilder=new s},v.build=function(a,b,c,d,e,f,g,h,i){if(this.reset(a,c,d,e,f,g,h,i),this.buildVoices(i,a),!this.isTabStaff()){var k=j(b);this.buildWedges(k),this.buildOctaveShifts(),this.buildDynamics(),this.buildPizzicatos(),this.buildWords(),this.buildPedal()}return 0===e&&this.buildChords(),this.tickableContent},v.reset=function(a,c,d,e,f,g,h,i){this.measureJson=c,this.attrs=d,this.staffIdx=e,this.displayOpts=f,this.previousMeasure=g,this.nextMeasure=h,this.voicesData=i,this.nbVoices=b.getSize(a),this.voicesNotes=a,this.tickableContent=new k;var j=d.getDpq();this.tickableContent.setDpq(j);var l=d.getNbDivisions();this.tickableContent.setNbDivisions(l)},v.buildVoices=function(a,b){var c=a.voices.filter(w,b);this.tickableContent.setVoicesIndexes(c),c.forEach(this.buildVoice,this),c.length>1&&this.shiftRests()};var w=function(a){return void 0!==this[a]};v.buildVoice=function(b){var c=this.voicesNotes[b];b=a.intPart(b);var d=this.getStemStrategy(b),e={staffIdx:this.staffIdx,voiceIdx:a.intPart(b)},f=this.voiceBuilder.build(c,this.measureJson,this.attrs,e,this.previousMeasure,this.nextMeasure,d);this.tickableContent.addVoice(f)},v.getStemStrategy=function(a){return 1===this.nbVoices?this.isTabStaff()?i.DOWN:i.AUTO:a===this.voicesData.voices[0]?i.UP:i.DOWN},v.shiftRests=function(){var a=this.tickableContent.getOrderedVoices();t(a)},v.isTabStaff=function(){var a=this.attrs.getStaffDetails(this.staffIdx);return d.hasStaffTuning(a)},v.buildWedges=function(a){this.wedgeAnchorsBuilder.build(this.tickableContent,a,this.measureJson,this.staffIdx)},v.buildOctaveShifts=function(){var a=c.getOctaveShifts(this.measureJson,this.staffIdx);this.octaveShiftAnchorsBuilder.build(this.tickableContent,a,this.measureJson,this.staffIdx)},v.buildDynamics=function(){c.getDynamics(this.measureJson,this.staffIdx).map(x).forEach(this.tickableContent.addDirection,this.tickableContent)};var x=function(a){var b=e.getPlacement(a),c=e.getStyle(a),d=e.getTimePos(a);return new l(b,c,d)};v.buildPizzicatos=function(){c.getPizzicatos(this.measureJson,this.staffIdx).map(y).forEach(this.tickableContent.addPizzicato,this.tickableContent)};var y=function(a){var b=f.getPlacement(a),c=f.getType(a),d=f.getTimePos(a);return new m(b,c,d)};v.buildWords=function(){c.getWords(this.measureJson,this.staffIdx).map(z).forEach(this.tickableContent.addWord,this.tickableContent)};var z=function(a){var b=g.getPlacement(a),c=g.getText(a),d=g.getTimePos(a);return new n(b,c,d)};v.buildChords=function(){this.getHarmonies().map(this.harmonyBuilder.build,this.harmonyBuilder).forEach(this.tickableContent.addChord,this.tickableContent)},v.getHarmonies=function(){return this.displayOpts.isConcertPitch?c.getConcertHarmonies(this.measureJson):c.getHarmonies(this.measureJson)},v.buildPedal=function(){c.getPedals(this.measureJson,this.staffIdx).map(A).forEach(this.tickableContent.addDirection,this.tickableContent)};var A=function(a){var b=h.getTimePos(a),c=h.getPlacement(a),d=h.getType(a);return new o(d,c,b)}}.call(this),function(){"use strict";var a=Adagio.Brush.Elem,b=Adagio.Drawer.SingleContentDrawer=function(){this.init()};b.cssClass="tickableContent";var c=b.prototype;c.cssClass=b.cssClass,c.init=function(){this.voices={},this.leftWedgeAnchor=null,this.rightWedgeAnchor=null,this.leftOctaveShiftAnchor=null,this.rightOctaveShiftAnchor=null,this.leftTempoChangeAnchor=null,this.rightTempoChangeAnchor=null,this.content=null,this.drawingContext=null,this.staffData=null,this.xPos=null,this.horizontalData=null,this.horizontalFormatter=null,this.verticalData=null,this.verticalFormatting=null,this.nbDivisions=null,this.dpq=null,this.group=new a("g"),this.group.attr("class",this.cssClass),this.parent=null},c.setParent=function(a){this.parent=a},c.setContent=function(a){this.content=a,this.content.setParent(this.group)},c.setStaffData=function(a){this.staffData=a,this.content.setStaffData(this.staffData)},c.setDpq=function(a){this.dpq=a},c.setNbDivisions=function(a){this.nbDivisions=a},c.setRightWedgeAnchor=function(a){this.rightWedgeAnchor=a,a.setMeasure(this)},c.setLeftWedgeAnchor=function(a){this.leftWedgeAnchor=a,a.setMeasure(this)},c.setRightOctaveShiftAnchor=function(a){this.rightOctaveShiftAnchor=a,a.setMeasure(this)},c.setLeftOctaveShiftAnchor=function(a){this.leftOctaveShiftAnchor=a,a.setMeasure(this)},c.setRightTempoChangeAnchor=function(a){this.rightTempoChangeAnchor=a,a.setMeasure(this)},c.setLeftTempoChangeAnchor=function(a){this.leftTempoChangeAnchor=a,a.setMeasure(this)},c.setLeftSlurAnchor=function(a,b){this.getVoice(b).leftSlurAnchor=a},c.setRightSlurAnchor=function(a,b){this.getVoice(b).rightSlurAnchor=a},c.render=function(a){this.drawingContext=a,this.content.render(this.drawingContext)},c.getHorizontalData=function(){return[this.content.getHorizontalData()]},c.setHorizontalFormatter=function(a){this.horizontalFormatter=a,this.content.setHorizontalFormatter(a)},c.formatHorizonal=function(){this.content.formatHorizonal()},c.getWidth=function(){return this.horizontalFormatter.getWidth()},c.getVerticalData=function(){var a=d();return a.chordsHeight=0,a};var d=function(){return{notesUpOverflow:0,notesDownOverflow:0,hasLyric:!1,lyricHeight:0}};c.setVerticalFormatting=function(a){this.verticalFormatting=a,this.content.setVerticalFormatting(a)},c.formatVertical=function(){this.content.formatVertical(),this.setCrossMeasuresNeedDrawUpdate()},c.draw=function(){this.move(),this.content.draw(),this.bindToParent()},c.bindToParent=function(){this.parent.append(this.group)},c.setPosition=function(a){this.xPos=a},c.move=function(){this.group.attr("transform","translate("+this.xPos+" 0)")},c.setCrossMeasuresNeedDrawUpdate=function(){this.setWedgeNeedDrawUpdate(),this.setOctaveShiftNeedDrawUpdate(),this.setTempoChangeNeedDrawUpdate()},c.setWedgeNeedDrawUpdate=function(){this.getAllWedgesAnchors().forEach(e)},c.setOctaveShiftNeedDrawUpdate=function(){this.getAllOctaveShiftsAnchors().forEach(e)},c.setTempoChangeNeedDrawUpdate=function(){this.getAllTempoChangesAnchors().forEach(e)};var e=function(a){a.setNeedDrawUpdate()};c.purgeCrossMeasures=function(){this.getAllWedgesAnchors().forEach(f),this.getAllOctaveShiftsAnchors().forEach(g),this.getAllTempoChangesAnchors().forEach(h)};var f=function(a){a.hasWedge()&&a.removeWedge()},g=function(a){a.hasOctaveShift()&&a.removeOctaveShift()},h=function(a){a.hasTempoChange()&&a.removeTempoChange()};c.drawCursor=function(a,b){this.getVoice(a.voiceIdx).drawCursor(a,b)},c.drawGraceCursor=function(a,b){this.getVoice(a.voiceIdx).drawGraceCursor(a,b)},c.drawDynamicCursor=function(a,b){var c=this.getVoice(a.voiceIdx),d=c.getNote(a.noteIdx),e=d.getXPos();b.setPosition(e),this.formatDirectionVertical(b.dynamic),b.setParent(this.group),b.draw()},c.drawSlurCursor=function(a,b){this.getVoice(a.voiceIdx).drawSlurCursor(a,b)},c.getXPos=function(){return this.xPos},c.getPreviousSpace=function(){return this.horizontalFormatter.getAlignmentSpace()},c.updateHorizontalDisplay=function(){this.content.updateHorizontalDisplay()},c.updateVerticalDisplay=function(){this.content.updateVerticalDisplay()},c.hasPizzicatosAbove=function(){return!1},c.hasPizzicatosBelow=function(){return!1},c.hasWordsAbove=function(){return!1},c.hasWordsBelow=function(){return!1},c.hasDynamicsAbove=function(){return!1},c.hasWedgeAbove=function(){return this.getAllWedgesAnchors().some(i)};var i=function(a){return a.hasWedge()&&a.isAbove()};c.hasDynamicsBelow=function(){return!1},c.hasWedgeBelow=function(){return this.getAllWedgesAnchors().some(j)};var j=function(a){return a.hasWedge()&&a.isBelow()};c.hasOctaveShiftsAbove=function(){return this.getAllOctaveShiftsAnchors().some(k)};var k=function(a){return a.hasOctaveShift()&&a.isAbove()};c.hasOctaveShiftsBelow=function(){return this.getAllOctaveShiftsAnchors().some(l)};var l=function(a){return a.hasOctaveShift()&&a.isBelow()};c.hasTempoChangesAbove=function(){return this.getAllTempoChangesAnchors().some(m)};var m=function(a){return a.hasTempoChange()&&a.isAbove()};c.hasTempoChangesBelow=function(){return this.getAllTempoChangesAnchors().some(n)};var n=function(a){return a.hasTempoChange()&&a.isBelow()};c.hasRightTieAnchor=function(){return!1},c.hasLeftTieAnchor=function(){return!1},c.hasRightHyphenAnchor=function(){return!1},c.hasLeftHyphenAnchor=function(){return!1},c.hasLeftHammerOnPullOffAnchor=function(){return!1},c.hasRightHammerOnPullOffAnchor=function(){return!1},c.hasRightGlissandoAnchor=function(){return!1},c.hasLeftGlissandoAnchor=function(){return!1},c.getMiddleSlursAnchors=function(){return[]},c.hasRightSlurAnchor=function(a){if(this.hasVoice(a)){return void 0!==this.getVoice(a).rightSlurAnchor}return!1},c.getRightSlurAnchor=function(a){return this.getVoice(a).rightSlurAnchor},c.hasLeftSlurAnchor=function(a){if(this.hasVoice(a)){return void 0!==this.getVoice(a).leftSlurAnchor}return!1},c.getLeftSlurAnchor=function(a){return this.getVoice(a).leftSlurAnchor},c.getAllSlursAnchors=function(a){var b=[];if(this.hasLeftSlurAnchor(a)){var c=this.getLeftSlurAnchor(a);b.push(c)}if(this.hasRightSlurAnchor(a)){var d=this.getRightSlurAnchor(a);b.push(d)}return b},c.hasVoice=function(a){return void 0!==this.voices[a]},c.getVoice=function(a){return this.hasVoice(a)||(this.voices[a]={}),this.voices[a]},c.getAllWedgesAnchors=function(){var a=[];return this.hasLeftWedgeAnchor()&&a.push(this.getLeftWedgeAnchor()),this.hasRightWedgeAnchor()&&a.push(this.getRightWedgeAnchor()),a},c.getAllOctaveShiftsAnchors=function(){var a=[];return this.hasLeftOctaveShiftAnchor()&&a.push(this.getLeftOctaveShiftAnchor()),this.hasRightOctaveShiftAnchor()&&a.push(this.getRightOctaveShiftAnchor()),a},c.getAllTempoChangesAnchors=function(){var a=[];return this.hasLeftTempoChangeAnchor()&&a.push(this.getLeftTempoChangeAnchor()),this.hasRightTempoChangeAnchor()&&a.push(this.getRightTempoChangeAnchor()),a},c.getDpq=function(){return this.dpq},c.getNbDivisions=function(){return this.nbDivisions},c.hasRightWedgeAnchor=function(){return null!==this.rightWedgeAnchor},c.getRightWedgeAnchor=function(){return this.rightWedgeAnchor},c.hasLeftWedgeAnchor=function(){return null!==this.leftWedgeAnchor},c.getLeftWedgeAnchor=function(){return this.leftWedgeAnchor},c.getMiddleWedgesAnchors=function(){return[]},c.hasRightOctaveShiftAnchor=function(){return null!==this.rightOctaveShiftAnchor},c.getRightOctaveShiftAnchor=function(){return this.rightOctaveShiftAnchor},c.hasLeftOctaveShiftAnchor=function(){return null!==this.leftOctaveShiftAnchor},c.getLeftOctaveShiftAnchor=function(){return this.leftOctaveShiftAnchor},c.getMiddleOctaveShiftsAnchors=function(){return[]},c.hasRightTempoChangeAnchor=function(){return null!==this.rightTempoChangeAnchor},c.getRightTempoChangeAnchor=function(){return this.rightTempoChangeAnchor},c.hasLeftTempoChangeAnchor=function(){return null!==this.leftTempoChangeAnchor},c.getLeftTempoChangeAnchor=function(){return this.leftTempoChangeAnchor},c.getMiddleTempoChangesAnchors=function(){return[]},c.getStaffData=function(){return this.staffData},c.getNbNotes=function(){return 0}}.call(this),function(){"use strict";var a=Adagio.Brush.Elem,b=Adagio.Drawer.Line,c=Adagio.Drawer.mmr.MMRSymbol=function(){this.init()};c.cssClass="MMRSymbol";var d=c.prototype;d.cssClass=c.cssClass,d.init=function(){this.parent=null,this.group=null,this.leftVertical=null,this.middleLine=null,this.rightVertical=null,this.drawingContext=null,this.width=null,this.posX=null,this.posY=null},d.setParent=function(a){this.parent=a},d.createGroup=function(){this.group=new a("g"),this.group.attr("class",this.cssClass)},d.setDrawingContext=function(a){this.drawingContext=a},d.draw=function(){this.bindToParent(),this.move()},d.bindToParent=function(){this.parent.append(this.group)},d.move=function(){var a=this.posX,b=this.posY;this.group.attr("transform","translate("+a+" "+b+")")},d.render=function(){this.isRendered()||(this.createGroup(),this.renderLeftVertical(),this.renderMiddleLine(),this.renderRightVertical())},d.isRendered=function(){return null!==this.group},d.renderLeftVertical=function(){var a=this.getUpY(),c=this.getDownY(),d=this.drawingContext.getMMRExternalThickness(),e={stroke_width:d,stroke:"black"},f=new b(this.group,e),g=this.drawingContext.getSpaceSize(),h=g;f.render(h,a,h,c),f.draw(),this.leftVertical=f},d.renderMiddleLine=function(){var a=this.drawingContext.getSpaceSize(),c=0,d=a,e=this.width-a,f=this.drawingContext.getMMRInternalThickness(),g={stroke_width:f,stroke:"black"},h=new b(this.group,g);h.render(d,c,e,c),h.draw(),this.middleLine=h},d.renderRightVertical=function(){var a=this.getUpY(),c=this.getDownY(),d=this.drawingContext.getMMRExternalThickness(),e={stroke_width:d,stroke:"black"},f=new b(this.group,e),g=this.drawingContext.getSpaceSize(),h=this.width-g;f.render(h,a,h,c),f.draw(),this.rightVertical=f},d.setWidth=function(a){this.width=a},d.updateDisplay=function(){this.updateWidth()},d.updateWidth=function(){var a=this.drawingContext.getSpaceSize(),b=this.width-a;this.middleLine.setX2(b),this.rightVertical.setX1(b),this.rightVertical.setX2(b)},d.getDownY=function(){return this.drawingContext.getSpaceSize()},d.getUpY=function(){return-this.drawingContext.getSpaceSize()},d.setPosX=function(a){this.posX=a},d.setPosY=function(a){this.posY=a},d.getPosX=function(){return this.posX},d.getPosY=function(){return this.posY},d.getWidth=function(){return this.width},d.getHeight=function(){return 2*this.drawingContext.getSpaceSize()}}.call(this),function(){"use strict";var a=Adagio.Brush.Elem,b=Adagio.Drawer.mmr.MMRSymbol,c=Adagio.Drawer.Text,d=Adagio.Utils.staffDataUtils,e=Adagio.Values.TickableType,f=6,g=Adagio.Drawer.mmr.MultiMeasureRest=function(a){this.init(a)};g.cssClass="multiMeasureRest";var h=g.prototype;h.cssClass=g.cssClass,h.init=function(a){this.parent=null,this.group=null,this.drawingContext=null,this.staffData=null,this.isMinimalWidth=null,this.horizontalData=null,this.horizontalFormatter=null,this.verticalFormatting=null,this.nbMeasures=a,this.symbol=null,this.digitText=null},h.setParent=function(a){this.parent=a},h.setStaffData=function(a){this.staffData=a},h.setDpq=function(a){this.dpq=a},h.setNbDivisions=function(a){this.nbDivisions=a},h.bindToParent=function(){this.parent.append(this.group)},h.isRendered=function(){return null!==this.group},h.render=function(a){this.drawingContext=a,this.createGroup(),this.createDigit(),this.createSymbol(),this.renderDigit(),this.renderSymbol()},h.createGroup=function(){this.group=new a("g"),this.group.attr("class",this.cssClass)},h.createDigit=function(){var a={"font-family":"Georgia, serif","font-style":"normal","font-size":1,fill:"black",text:this.nbMeasures.toString()};this.digitText=new c(a),this.digitText.setParent(this.group)},h.createSymbol=function(){this.symbol=new b,this.symbol.setParent(this.group)},h.renderDigit=function(){this.digitText.setDrawingContext(this.drawingContext);var a=this.getFontSize();this.digitText.setFontSize(a),this.digitText.render()},h.renderSymbol=function(){var a=this.getMinimalWidth();this.symbol.setWidth(a),this.symbol.setDrawingContext(this.drawingContext),this.symbol.render()},h.getHorizontalData=function(){return null===this.horizontalData&&this.computeHorizontalData(),this.horizontalData},h.computeHorizontalData=function(){
var a=this.getDpq(),b=this.getNbDivisions(),c=this.getMinimalWidth(),d=[{timePos:0,spaceBefore:0,spaceAfter:c,isRest:!0}];this.horizontalData={dpq:a,entities:d,nbDivisions:b,type:e.MMR}},h.setHorizontalFormatter=function(a){this.horizontalFormatter=a},h.formatHorizonal=function(){this.formatSymbol(),this.formatDigitHorizontal()},h.formatSymbol=function(){var a=this.getWidth();this.symbol.setWidth(a),this.symbol.updateDisplay(),this.fillSymbolPosX(),this.fillSymbolPosY()},h.fillSymbolPosX=function(){var a=this.horizontalFormatter.getMiddlePos(),b=this.symbol.getWidth(),c=a-b/2;this.symbol.setPosX(c)},h.fillSymbolPosY=function(){var a=this.drawingContext.getSpaceSize(),b=(this.getNbStaffLines()-1)*a/2;this.symbol.setPosY(b)},h.getNbStaffLines=function(){return d.getNbStaffLines(this.staffData)},h.formatDigitHorizontal=function(){var a=this.horizontalFormatter.getMiddlePos(),b=this.digitText.getWidth(),c=a-b/2;this.digitText.setXPos(c)},h.getTopY=function(){return this.getFontSize()+this.getDigitMargin()},h.getFontSize=function(){return 2*this.drawingContext.getSpaceSize()},h.setVerticalFormatting=function(a){this.verticalFormatting=a},h.formatVertical=function(){var a=this.getDigitMargin();this.digitText.setYPos(-a)},h.getDigitMargin=function(){return this.drawingContext.getSpaceSize()/2},h.draw=function(){this.symbol.draw(),this.digitText.draw(),this.bindToParent()},h.getMinimalWidth=function(){return this.drawingContext.getSpaceSize()*f},h.updateHorizontalDisplay=function(){this.symbol.move(),this.digitText.move()},h.updateVerticalDisplay=function(){this.symbol.move(),this.digitText.move()},h.getDpq=function(){return this.dpq},h.getNbDivisions=function(){return this.nbDivisions},h.getWidth=function(){return this.horizontalFormatter.getWidth()},h.getPreviousSpace=function(){return this.horizontalFormatter.getAlignmentSpace()}}.call(this),function(){"use strict";var a=Adagio.Utils.staffDetailsUtils,b=Adagio.Values.StemStrategy,c=Adagio.Drawer.SingleContentDrawer,d=Adagio.Drawer.mmr.MultiMeasureRest,e=Adagio.Render.WedgeAnchorsBuilder,f=Adagio.Render.SlurAnchorsBuilder,g=Adagio.Render.SingleContentBuilder=function(){this.init()},h=g.prototype;h.init=function(){this.wedgeAnchorsBuilder=new e,this.slurAnchorsBuilder=new f},h.build=function(a,b,c,d,e,f,g,h){return this.reset(b,c,d,e,f,g,h),this.buildVoices(h),this.isTabStaff()||this.buildWedges(),this.buildContent(a),this.content},h.reset=function(a,b,d,e,f,g,h){this.measureJson=a,this.attrs=b,this.staffIdx=d,this.displayOpts=e,this.previousMeasure=f,this.nextMeasure=g,this.voicesData=h,this.nbVoices=h.voices.length,this.content=new c;var i=b.getDpq();this.content.setDpq(i);var j=b.getNbDivisions();this.content.setNbDivisions(j)},h.buildVoices=function(a){a.voices.forEach(this.buildVoice,this)},h.buildVoice=function(a){var b=[];this.slurAnchorsBuilder.build(this.content,a,b,this.measureJson,this.stemStrategy)},h.getStemStrategy=function(a){return 1===this.nbVoices?b.AUTO:a===this.voicesData.voices[0]?b.UP:b.DOWN},h.isTabStaff=function(){var b=this.attrs.getStaffDetails(this.staffIdx);return a.hasStaffTuning(b)},h.buildWedges=function(){var a={};this.wedgeAnchorsBuilder.build(this.content,a,this.measureJson,this.staffIdx)},h.buildContent=function(a){var b=new d(a),c=this.attrs.getDpq();b.setDpq(c);var e=this.attrs.getNbDivisions();b.setNbDivisions(e),this.content.setContent(b)}}.call(this),function(){"use strict";Adagio.Drawer.metronome.settings={GLOBAL_RATIO:.8}}.call(this),function(){"use strict";var a=Adagio.Drawer.Text,b=Adagio.Drawer.metronome.settings,c=Adagio.Brush.Elem,d=2.75,e=Adagio.Drawer.metronome.Metronome=function(){this.init()};e.NAME="metronome";var f=e.prototype;f.name=e.NAME,f.init=function(){this.group=null,this.parent=null,this.drawingContext=null,this.note=null,this.text=null,this.spaceAbove=null,this.posX=null,this.posY=null},f.setParent=function(a){this.parent=a},f.setNote=function(a){this.note=a},f.setTextStr=function(b){var c={text:b};this.text=new a(c)},f.setPosX=function(a){this.posX=a},f.setPosY=function(a){this.posY=a},f.setDrawingContext=function(a){if(this.drawingContext=a,null!==this.text){this.text.setDrawingContext(a);var c=this.drawingContext.getSpaceSize();this.text.setFontSize(c*d*b.GLOBAL_RATIO);var e=this.drawingContext.getTempoFontFamily();this.text.options["font-family"]=e}null!==this.note&&this.note.setDrawingContext(a)},f.draw=function(){this.isRendered()||(this.render(),this.format()),this.drawContent(),this.move(),this.bindToParent()},f.isRendered=function(){return null!==this.group},f.render=function(){this.group=new c("g"),this.group.attr("class",this.name),null!==this.text&&this.text.setParent(this.group),null!==this.note&&this.note.setParent(this.group)},f.format=function(){this.formatX(),this.formatY()},f.formatX=function(){var a=0;null!==this.note&&(this.note.setPosX(0),a+=this.note.getWidth()),null!==this.text&&(a>0&&(a+=this.getMargin()),this.text.setXPos(a))},f.getMargin=function(){return this.drawingContext.getSpaceSize()/2*b.GLOBAL_RATIO},f.formatY=function(){var a=this.getSpaceAbove();null!==this.note&&this.note.setPosY(a),null!==this.text&&this.text.setYPos(a)},f.drawContent=function(){this.note.draw(),this.text.render(),this.text.setCssClass("metronome.text"),this.text.draw()},f.move=function(){this.isRendered()&&null!==this.posX&&null!==this.posY&&this.group.attr("transform","translate("+this.posX+", "+this.posY+")")},f.bindToParent=function(){this.parent.append(this.group)},f.getWidth=function(){var a=0;return null!==this.note&&(a+=this.note.getWidth()),null!==this.text&&(a>0&&(a+=this.getMargin()),a+=this.text.getWidth()),a},f.getHeight=function(){return this.getSpaceAbove()+this.getSpaceBelow()},f.getSpaceAbove=function(){if(null===this.spaceAbove){var a=0;if(null!==this.text){var b=this.text.fontSize;a=Math.max(a,b)}if(null!==this.note){var c=this.note.getSpaceAbove();a=Math.max(a,c)}this.spaceAbove=a}return this.spaceAbove},f.getSpaceBelow=function(){return this.drawingContext.getSpaceSize()*d/2*b.GLOBAL_RATIO},f.getPreviousSpace=function(){return this.drawingContext.getSpaceSize()}}.call(this),function(){"use strict";var a=Adagio.Brush.Elem,b=Adagio.Values.DurationType,c=Adagio.smufl.ordinalList,d=Adagio.Drawer.metronome.settings,e=Adagio.Drawer.metronome.NoteIcon=function(a){this.init(a)};e.NAME="metronome.note";var f=e.prototype;f.name=e.NAME,f.init=function(a){this.durationType=a,this.group=null,this.parent=null,this.drawingContext=null,this.dots=null,this.noteBodyPath=null,this.noteBodyGlyph=null,this.posX=null,this.posY=null},f.setDots=function(a){this.dots=a},f.setParent=function(a){this.parent=a},f.setDisplayData=function(a){this.displayData=a},f.setDrawingContext=function(a){this.drawingContext=a,null!==this.dots&&this.dots.setDrawingContext(a)},f.draw=function(){this.isRendered()||(this.render(),this.format()),this.drawContent(),this.move(),this.bindToParent()},f.isRendered=function(){return null!==this.group},f.render=function(){this.group=new a("g"),this.group.attr("class",this.name);var b=this.getNoteGlyph();this.noteBodyPath=new a("path"),this.noteBodyPath.attr("class","metronome.noteBody"),this.noteBodyPath.attr("d",b.render()),this.group.append(this.noteBodyPath),null!==this.dots&&this.dots.setParent(this.group)},f.format=function(){var a=this.getNoteBodyY();if(this.noteBodyPath.attr("transform","translate(0, "+a+")"),null!==this.dots){var b=this.getHeadWidth(),c=this.getMargin(),e=b+c,f=this.drawingContext.getSpaceSize()*d.GLOBAL_RATIO,g=a+f/4;this.dots.setPosition(e,g)}},f.drawContent=function(){null!==this.dots&&this.dots.draw()},f.setPosX=function(a){this.posX=a},f.setPosY=function(a){this.posY=a},f.move=function(){this.group.attr("transform","translate("+this.posX+", "+this.posY+")")},f.bindToParent=function(){this.parent.append(this.group)},f.getSpaceAbove=function(){var a=this.getNoteGlyph(),b=-this.getNoteBodyY();return-a.getBBoxNE().y+b},f.getWidth=function(){var a=this.getNoteGlyph().getWidth();if(null!==this.dots){var b=this.getMargin(),c=this.getHeadWidth(),d=this.dots.getWidth(),e=c+b+d;a=Math.max(a,e)}return a},f.getNoteGlyph=function(){if(null===this.noteBodyGlyph){var a="metNote",b=c.fromDurationType(this.durationType),e=this.hasNoStem()?"":"Up",f=a+b+e;this.noteBodyGlyph=this.drawingContext.getScaledGlyph(f,d.GLOBAL_RATIO)}return this.noteBodyGlyph},f.getMargin=function(){return this.drawingContext.getSpaceSize()/2*d.GLOBAL_RATIO},f.getHeadWidth=function(){var a;return this.durationType===b.FULL?a="metNoteWhole":this.durationType===b.HALF?a="metNoteHalfUp":this.durationType>=b.QUARTER?a="metNoteQuarterUp":b.raiseError(this.durationType),this.drawingContext.getScaledGlyph(a,d.GLOBAL_RATIO).getWidth()},f.getNoteBodyY=function(){var a=this.drawingContext.getSpaceSize()*d.GLOBAL_RATIO;return this.hasNoStem()?-a/2:-a/4},f.hasNoStem=function(){return this.durationType===b.FULL}}.call(this),function(){"use strict";var a=Adagio.Brush.Elem,b=Adagio.Drawer.metronome.settings,c="metAugmentationDot",d=Adagio.Drawer.metronome.Dots=function(a){this.init(a)};d.NAME="metronome.dots";var e=d.prototype;e.name=d.NAME,e.init=function(a){this.parent=null,this.group=null,this.dots=[],this.glyph=null,this.width=null,this.drawingContext=null,this.posX=null,this.posY=null,this.nbDots=a},e.setParent=function(a){this.parent=a},e.setDrawingContext=function(a){this.drawingContext=a},e.setPosition=function(a,b){this.posX=a,this.posY=b},e.draw=function(){this.isRendered()||(this.render(),this.format()),this.move(),this.bindToParent()},e.isRendered=function(){return null!==this.group},e.render=function(){this.group=new a("g"),this.group.attr("class",this.name);for(var b=0;b<this.nbDots;b++)this.renderDot()},e.renderDot=function(){var b=this.getGlyph(),c=b.render(),d=b.getWidth(),e=0===this.dots.length,f=e?0:this.getMargin(),g=new a("path");g.attr("class","metronome.dots"),g.attr("d",c),this.group.append(g);var h={path:g,width:d,spaceBefore:f};this.dots.push(h)},e.format=function(){this.dots.reduce(f,0)};var f=function(a,b){return a+=b.spaceBefore,b.path.attr("transform","translate("+a+", 0)"),a+=b.width};e.move=function(){this.group.attr("transform","translate("+this.posX+", "+this.posY+")")},e.bindToParent=function(){this.parent.append(this.group)},e.getWidth=function(){if(null===this.width){var a=this.getGlyph(),b=a.getWidth(),c=this.getMargin();this.width=b*this.nbDots+c*(this.nbDots-1)}return this.width},e.getMargin=function(){return this.drawingContext.getSpaceSize()*b.GLOBAL_RATIO/2},e.getGlyph=function(){return null===this.glyph&&(this.glyph=this.drawingContext.getScaledGlyph(c,b.GLOBAL_RATIO)),this.glyph}}.call(this),function(){"use strict";var a=Adagio.Drawer.metronome.NoteIcon,b=Adagio.Drawer.metronome.Metronome,c=Adagio.Drawer.metronome.Dots,d=Adagio.Render.MetronomeBuilder=function(){},e=d.prototype;e.buildFromJson=function(){return this.build()},e.build=function(a,c,d){var e=new b;e.setTextStr(d);var f=this.createNote(a,c);return e.setNote(f),e},e.createNote=function(b,d){var e=new a(b);if(d>0){var f=new c(d);e.setDots(f)}return e}}.call(this),function(){"use strict";var a=Adagio.Utils.attributesUtils,b=Adagio.Utils.durationUtils,c=Adagio.Render.AttrsData=function(a){this.init(a)},d=c.prototype;d.init=function(a){this.attrs=a,this.clefs=null,this.staffsDetails=null,this.keys=null,this.times=null,this.transposes=null,this.nbDivisions=null},d.getDpq=function(){return a.getDpq(this.attrs)},d.getClef=function(a){return this.getClefs().getEntry(a)},d.getClefs=function(){return null===this.clefs&&(this.clefs=a.getWrappedClef(this.attrs)),this.clefs},d.getStaffDetails=function(a){return this.getStaffsDetails().getEntry(a)},d.getStaffsDetails=function(){return null===this.staffsDetails&&(this.staffsDetails=a.getWrappedStaffDetailsOrDefault(this.attrs)),this.staffsDetails},d.getKey=function(a){return this.getKeys().getEntry(a)},d.getKeys=function(){return null===this.keys&&(this.keys=a.getWrappedKey(this.attrs)),this.keys},d.getAnyTime=function(){return this.getTimes().getAnyEntry()},d.getTimes=function(){return null===this.times&&(this.times=a.getWrappedTime(this.attrs)),this.times},d.getTranspose=function(a){return this.getTransposes().getEntry(a)},d.getTransposes=function(){return null===this.transposes&&(this.transposes=a.getWrappedTranspose(this.attrs)),this.transposes},d.getNbDivisions=function(){if(null===this.nbDivisions){var a=this.getAnyTime(),c=this.getDpq(),d=b.timeToQuarter(a);this.nbDivisions=b.quarterToDivisions(d,c)}return this.nbDivisions}}.call(this),function(){"use strict";var a=Adagio.Utils.mapUtils,b=Adagio.Utils.measureUtils,c=Adagio.Render.extractNoteDisplayData,d=Adagio.Render.groupVoicesNotes,e=Adagio.Render.formatVoiceNotes,f=Adagio.Render.AttrsData,g=Adagio.Render.AdjacentMeasureData=function(a){this.init(a)},h=g.prototype;h.init=function(a){this.measureJson=a,this.voicesNotes=null,this.attrs=null},h.getFirstNoteDisplayData=function(a){var b=this.getFirstNoteJson(a),d=this.getAttrs();return c(b,d)},h.getFirstNoteJson=function(a){return this.getVoiceNotes(a)[0].chordJson},h.getLastNoteDisplayData=function(a){var b=this.getLastNoteJson(a),d=this.getAttrs();return c(b,d)},h.getLastNoteJson=function(a){var b=this.getVoiceNotes(a);return b[b.length-1].chordJson},h.getVoiceNotes=function(a){return this.getVoicesNotes()[a]},h.hasVoice=function(a){return void 0!==this.getVoicesNotes()[a]},h.getVoicesNotes=function(){if(null===this.voicesNotes){var c=b.getNotes(this.measureJson),f=d(c);this.voicesNotes=a.map(f,e)}return this.voicesNotes},h.getAttrs=function(){if(null===this.attrs){var a=b.getAttributes(this.measureJson);this.attrs=new f(a)}return this.attrs}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Values.DirectionPlacement,c=Adagio.Values.TempoChangeType,d=Adagio.Values.TempoChangeLocation,e=Adagio.Drawer.tempoChange.TempoChangeAnchor=function(a,b,c,d){this.init(a,b,c,d)},f=e.prototype;f.init=function(a,b,c,d){this.measure=null,this.tempoChange=null,this.measureIdx=null,this.type=a,this.placement=b,this.location=d,this.timePos=void 0!==c?c:null,this.drawingContext=null},f.setLocation=function(a){this.location=a},f.setMeasure=function(a){this.measure=a},f.setMeasureIdx=function(a){this.measureIdx=a},f.isAbove=function(){return this.getPlacement()===b.ABOVE},f.isBelow=function(){return this.getPlacement()===b.BELOW},f.getPlacement=function(){return this.placement},f.getTimePos=function(){return this.timePos},f.isLeft=function(){return this.hasLocation()?d.isLeft(this.location):this.isStart()},f.isRight=function(){return this.hasLocation()?d.isRight(this.location):this.isStop()},f.isStop=function(){return this.type===c.STOP},f.isStart=function(){return c.isStart(this.type)},f.hasLocation=function(){return void 0!==this.location},f.setDrawingContext=function(a){this.drawingContext=a},f.getDrawingContext=function(){return this.drawingContext},f.getType=function(){return this.type},f.getX=function(){if(d.isLeft(this.location))return this.getLeftX();if(d.isRight(this.location))return this.getRightX();if(this.isStart()||this.isStop())return this.getMiddleX();throw new a("Unexpected")},f.getLeftX=function(){var a=this.measure,b=a.tickableContent;return this.measure.getXPos()+b.getXPos()-b.getPreviousSpace()},f.getRightX=function(){var a=this.measure,b=a.tickableContent;return a.getXPos()+b.getXPos()+b.getWidth()},f.getMiddleX=function(){if(null===this.timePos){throw new a("Unexpected","Cannot compute a middleX position without time position")}var b=this.measure,c=b.tickableContent,d=b.getXPos()+c.getXPos(),e=d+c.timePosToX(this.timePos);return this.isStop()&&(e-=this.drawingContext.getSpaceSize()),e},f.getY=function(){if(this.isAbove())return this.measure.getUpTempoChangesY();if(this.isBelow())return this.measure.getDownTempoChangesY();throw new a("Unexpected")},f.hasTempoChange=function(){return null!==this.tempoChange},f.setTempoChange=function(a){this.tempoChange=a},f.removeTempoChange=function(){d.isLeft(this.location)?this.tempoChange.removeLeftAnchor():d.isRight(this.location)?this.tempoChange.removeRightAnchor():this.isStart()||this.isStop()||d.raiseError(this.location),this.octaveShift=null},f.getTempoChange=function(){return this.tempoChange},f.setNeedDrawUpdate=function(){if(this.hasTempoChange()){this.getTempoChange().setNeedDrawUpdate()}}}.call(this),function(){"use strict";var a=Adagio.Utils.directionUtils,b=Adagio.Utils.direction.tempoChangeDirectionUtils,c=Adagio.Drawer.tempoChange.TempoChangeAnchor,d=Adagio.Values.DirectionPlacement,e=Adagio.Render.TempoChangeAnchorsBuilder=function(){},f=e.prototype;f.build=function(a,b,c,d,e){this.measure=a,this.dpq=b,this.tempoChanges=c,this.leftTempoChange=d,this.rightTempoChange=e,this.addMiddleAnchors(),this.addLeftContinueAnchors(),this.addRightContinueAnchors()},f.addMiddleAnchors=function(){var b=null!==this.tempoChanges?this.tempoChanges.slice():[];b.sort(a.compareTimePosInc),b.forEach(this.addMiddleAnchor,this)},f.addMiddleAnchor=function(a){var e=b.getTimePos(a),f=b.getDpq(a);e*=this.dpq/f;var g=b.getType(a),h=new c(g,d.ABOVE,e);this.measure.addMiddleTempoChangeAnchor(h)},f.addLeftContinueAnchors=function(){if(null!==this.leftTempoChange){var a=b.getType(this.leftTempoChange),e=b.getLocation(this.leftTempoChange),f=new c(a,d.ABOVE,0,e);this.measure.setLeftTempoChangeAnchor(f)}},f.addRightContinueAnchors=function(){if(null!==this.rightTempoChange){var a=b.getType(this.rightTempoChange),e=b.getLocation(this.rightTempoChange),f=new c(a,d.ABOVE,0,e);this.measure.setRightTempoChangeAnchor(f)}}}.call(this),function(){"use strict";var a=Adagio.Drawer.Text,b=Adagio.Brush.Elem,c=Adagio.Drawer.MeasureNumber=function(a){this.init(a)},d=c.prototype;d.init=function(a){this.group=new b("g"),this.setParentGroup(a),this.text=null,this.fontSize=null,this.posX=null,this.posY=null},d.setPosX=function(a){this.posX=a},d.setPosY=function(a){this.posY=a},d.setParentGroup=function(a){this.parentGroup=a,this.bindToParent()},d.render=function(a){this.drawingContext=a},d.bindToParent=function(){this.parentGroup.append(this.group)},d.getFontSize=function(){return null===this.fontSize&&(this.fontSize=this.drawingContext.getMeasureNumberSize()),this.fontSize},d.update=function(b){null!==this.text&&this.hide();var c=(b+1).toString(),d=this.getFontSize(),e=this.drawingContext.getMeasureNumberFontFamily(),f={text:c,"font-size":d,"font-family":e};this.text=new a(f),this.text.setParent(this.group),this.text.setDrawingContext(this.drawingContext),this.text.render(),this.draw()},d.draw=function(){this.updateTextPosition(),this.text.draw()},d.getPreviousSpace=function(){return this.drawingContext.getSpaceSize()/4},d.getMarginSize=function(){return this.getFontSize()/2},d.updateTextPosition=function(){null!==this.posX&&null!==this.posY&&this.text.setPosition(this.posX,this.posY)},d.move=function(){null!==this.text&&(this.updateTextPosition(),this.text.move())},d.hide=function(){null!==this.text&&(this.text.hide(),this.text=null)},d.getHeight=function(){return this.drawingContext.getMeasureNumberSize()},d.getWidth=function(){return this.text.getWidth()}}.call(this),function(){"use strict";var a=Adagio.formatter.vertical.MeasureFormatting=function(a){this.init(a)},b=a.prototype;b.init=function(a){this.verticalData=a,this.reset()},b.reset=function(){this.upLimitY=null,this.endingY=null,this.upDynamicsY=null,this.downDynamicsY=null,this.upOctaveShiftsY=null,this.downOctaveShiftsY=null,this.upWordY=null,this.downWordY=null,this.upTempoChangesY=null,this.downTempoChangesY=null,this.chordsY=null,this.lyricsY=null,this.downLimitY=null},b.getHeight=function(){return this.getSpaceAboveStaff()+this.getDownLimitY()},b.getSpaceAboveStaff=function(){return-this.getUpLimitY()},b.setUpLimitY=function(a){this.upLimitY=a},b.getUpLimitY=function(){if(null!==this.upLimitY)return this.upLimitY;var a=0,b=this.getMetronomeY()-this.verticalData.metronomeHeight;a=Math.min(a,b);var c=this.getUpTempoChangesY()-this.verticalData.upTempoChangesHeight;return a=Math.min(a,c)},b.getMetronomeY=function(){var a=0,b=this.getRehearsalY()-this.verticalData.rehearsalHeight;if(a=Math.min(a,b),0===this.verticalData.metronomeHeight)return b;if(this.isMetronomeOverNotes()){var c=this.getJumpCallY()-this.verticalData.jumpCallHeight;a=Math.min(a,c)}return a},b.isMetronomeOverNotes=function(){return this.verticalData.metronomeRightX>this.verticalData.notesLeftX},b.getRehearsalY=function(){var a=0,b=this.getJumpTagY()-this.verticalData.jumpTagHeight;if(a=Math.min(a,b),0===this.verticalData.rehearsalHeight)return a;if(this.isRehearsalOverNotes()){var c=this.getJumpCallY()-this.verticalData.jumpCallHeight;a=Math.min(a,c)}return a},b.isRehearsalOverNotes=function(){return this.verticalData.rehearsalRightX>this.verticalData.notesLeftX},b.getJumpCallY=function(){var a=0,b=this.getUpTempoChangesY()-this.verticalData.upTempoChangesHeight;if(a=Math.min(a,b),0===this.verticalData.jumpCallHeight)return a;if(this.verticalData.jumpTagHeight>0){var c=this.getEndingY()-this.verticalData.endingHeight;a=Math.min(a,c)}return a-this.verticalData.jumpCallMargin},b.getJumpTagY=function(){var a=0,b=this.getEndingY()-this.verticalData.endingHeight;if(a=Math.min(a,b),0===this.verticalData.jumpHeight)return a;if(this.isJumpOverNotes()||this.verticalData.jumpCallHeight>0){var c=this.getUpTempoChangesY()-this.verticalData.upTempoChangesHeight;a=Math.min(a,c)}return a-this.verticalData.jumpTagMargin},b.isJumpOverNotes=function(){return this.verticalData.jumpRightX>this.verticalData.notesLeftX},b.setEndingY=function(a){this.endingY=a},b.getEndingY=function(){if(null!==this.endingY)return this.endingY;var a=0,b=this.getMeasureNumberY()-this.verticalData.measureNumberHeight;if(a=Math.min(a,b),this.verticalData.endingHeight>0){var c=this.getUpTempoChangesY()-this.verticalData.upTempoChangesHeight;a=Math.min(a,c)}return a},b.setUpTempoChangesY=function(a){this.upTempoChangesY=a},b.getUpTempoChangesY=function(){if(null!==this.upTempoChangesY)return this.upTempoChangesY;var a=0,b=this.getChordsY()-this.verticalData.chordsHeight;return a=Math.min(a,b)},b.setChordsY=function(a){this.chordsY=a},b.getChordsY=function(){return null!==this.chordsY?this.chordsY:this.getUpWordY()-this.verticalData.upWordHeight},b.setUpWordY=function(a){this.upWordY=a},b.getUpWordY=function(){return null!==this.upWordY?this.upWordY:this.getUpOctaveShiftsY()-this.verticalData.upOctaveShiftsHeight},b.setUpOctaveShiftsY=function(a){this.upOctaveShiftsY=a},b.getUpOctaveShiftsY=function(){return null!==this.upOctaveShiftsY?this.upOctaveShiftsY:this.getUpPizzicatoY()-(this.verticalData.upPizzicatoHeight+this.verticalData.upOctaveShiftsMargin)},b.getUpPizzicatoY=function(){return this.getUpDynamicsY()-this.verticalData.upDynamicsHeight},b.setUpDynamicsY=function(a){this.upDynamicsY=a},b.getUpDynamicsY=function(){if(null!==this.upDynamicsY)return this.upDynamicsY;var a=-this.verticalData.notesUpOverflow;if(this.verticalData.measureNumberHeight>0&&this.isMeasureNumberOverNotes()){var b=this.getMeasureNumberY()-this.verticalData.measureNumberHeight;a=Math.min(a,b)}return a-this.verticalData.upDynamicsMargin},b.getMeasureNumberY=function(){var a=0,b=-this.verticalData.upAttributesOverflow;if(a=Math.min(a,b),0===this.verticalData.measureNumberHeight)return a;if(this.isMeasureNumberOverNotes()){var c=this.verticalData.notesUpOverflow;a=Math.min(a,-c)}return a-this.verticalData.measureNumberMargin},b.isMeasureNumberOverNotes=function(){return 0===this.verticalData.notesLeftX},b.setDownLimitY=function(a){this.downLimitY=a},b.getDownLimitY=function(){return null!==this.downLimitY?this.downLimitY:this.getLyricsY()+this.verticalData.lyricsHeight},b.setLyricsY=function(a){this.lyricsY=a},b.getLyricsY=function(){return null!==this.lyricsY?this.lyricsY:this.getDownWordY()+this.verticalData.downWordHeight+this.verticalData.lyricsMargin},b.setDownWordY=function(a){this.downWordY=a},b.getDownWordY=function(){return null!==this.downWordY?this.downWordY:this.getDownOctaveShiftsY()+this.verticalData.downOctaveShiftsHeight},b.setDownOctaveShiftsY=function(a){this.downOctaveShiftsY=a},b.getDownOctaveShiftsY=function(){return null!==this.downOctaveShiftsY?this.downOctaveShiftsY:this.getDownPizzicatoY()+this.verticalData.downPizzicatoHeight+this.verticalData.downOctaveShiftsMargin},b.getDownPizzicatoY=function(){return this.getDownDynamicsY()+this.verticalData.downDynamicsHeight},b.setDownDynamicsY=function(a){this.downDynamicsY=a},b.getDownDynamicsY=function(){return null!==this.downDynamicsY?this.downDynamicsY:this.getDownTempoChangesY()+this.verticalData.downTempoChangesHeight+this.verticalData.downDynamicsMargin},b.setDownTempoChangesY=function(a){this.downTempoChangesY=a},b.getDownTempoChangesY=function(){return null!==this.downTempoChangesY?this.downTempoChangesY:0+this.verticalData.staffHeight+this.verticalData.notesDownOverflow+this.verticalData.downTempoChangesMargin},b.hasLyrics=function(){return null!==this.lyricsY}}.call(this),function(){"use strict";Adagio.formatter.vertical.alignAboveSlurs=function(b,d){b=b.filter(c),b.forEach(a,d)};var a=function(a){for(var c=this,d=a.getLeftMeasureIdx(),e=a.getRightMeasureIdx(),f=a.getUpOverflow(),g=d;g<=e;g++){var h=c[g];b(h,f)}},b=function(a,b){var c=a.verticalData.notesUpOverflow;a.verticalData.notesUpOverflow=Math.max(c,b)},c=function(a){return a.isAbove()}}.call(this),function(){"use strict";Adagio.formatter.vertical.alignBelowSlurs=function(b,d){b=b.filter(c),b.forEach(a,d)};var a=function(a){for(var c=this,d=a.getLeftMeasureIdx(),e=a.getRightMeasureIdx(),f=a.getDownOverflow(),g=d;g<=e;g++){var h=c[g];b(h,f)}},b=function(a,b){var c=a.verticalData.notesDownOverflow;a.verticalData.notesDownOverflow=Math.max(c,b)},c=function(a){return a.isBelow()}}.call(this),function(){"use strict";Adagio.formatter.vertical.getOrderedWedgesRanges=function(c){var d=c.map(a);return d.sort(b),d};var a=function(a){for(var b=a.getLeftMeasureIdx(),c=a.getRightMeasureIdx(),d=[],e=b;e<=c;e++)d.push(e);return d},b=function(a,b){return a[0]-b[0]}}.call(this),function(){"use strict";var a=Adagio.Utils.setUtils;Adagio.formatter.vertical.mergeSetsList=function(a){var c=[],d={mergedSets:c,currentSet:null};return a.map(b,d),null!==d.currentSet&&c.push(d.currentSet),c};var b=function(b){var c=this,d=c.currentSet;null===d?c.currentSet=b:a.haveInter(b,d)?c.currentSet=a.merge(b,d):(c.mergedSets.push(d),c.currentSet=b)}}.call(this),function(){"use strict";var a=Adagio.Utils.math,b=Adagio.Utils.setUtils,c=Adagio.formatter.vertical.getOrderedWedgesRanges,d=Adagio.formatter.vertical.mergeSetsList;Adagio.formatter.vertical.getGrouppedWedgesRanges=function(a){var f=c(a),g=f.map(b.fromList);return g=d(g),g.map(b.toList).map(e)};var e=function(b){return b.map(a.intPart)}}.call(this),function(){"use strict";Adagio.formatter.vertical.rangesToMeasuresGroups=function(b,c){return b.map(a,c)};var a=function(a){var c=this;return a.map(b,c)},b=function(a){return this[a]}}.call(this),function(){"use strict";var a=Adagio.formatter.vertical.getGrouppedWedgesRanges,b=Adagio.formatter.vertical.rangesToMeasuresGroups;Adagio.formatter.vertical.getWedgesMeasuresGroups=function(c,d){var e=a(d);return b(e,c)}}.call(this),function(){"use strict";var a=Adagio.Utils.math;Adagio.formatter.vertical.alignAboveDynamicsFormattings=function(d){var e=d.map(b),f=e.reduce(a.min2);d.forEach(c,f)};var b=function(a){return a.getUpDynamicsY()},c=function(a){var b=parseFloat(this);a.setUpDynamicsY(b)}}.call(this),function(){"use strict";var a=Adagio.formatter.vertical.getWedgesMeasuresGroups,b=Adagio.formatter.vertical.alignAboveDynamicsFormattings;Adagio.formatter.vertical.alignAboveWedges=function(d,e){d=d.filter(c),a(e,d).forEach(b)};var c=function(a){return a.isAbove()}}.call(this),function(){"use strict";var a=Adagio.Utils.math;Adagio.formatter.vertical.alignBelowDynamicsFormattings=function(d){var e=d.map(b),f=e.reduce(a.max2);d.forEach(c,f)};var b=function(a){return a.getDownDynamicsY()},c=function(a){var b=parseFloat(this);a.setDownDynamicsY(b)}}.call(this),function(){"use strict";var a=Adagio.formatter.vertical.getWedgesMeasuresGroups,b=Adagio.formatter.vertical.alignBelowDynamicsFormattings;Adagio.formatter.vertical.alignBelowWedges=function(d,e){d=d.filter(c),a(e,d).forEach(b)};var c=function(a){return a.isBelow()}}.call(this),function(){"use strict";var a=Adagio.Utils.math;Adagio.formatter.vertical.alignLyrics=function(e){if(e=e.filter(b),e.length>0){var f=e.map(c),g=f.reduce(a.max2);e.forEach(d,g)}};var b=function(a){return a.verticalData.lyricsHeight>0},c=function(a){return a.getLyricsY()},d=function(a){var b=parseFloat(this);a.setLyricsY(b)}}.call(this),function(){"use strict";var a=Adagio.Utils.math;Adagio.formatter.vertical.alignEndings=function(e){if(e=e.filter(b),e.length>0){var f=e.map(c),g=f.reduce(a.min2);e.forEach(d,g)}};var b=function(a){return a.verticalData.endingHeight>0},c=function(a){return a.getEndingY()},d=function(a){var b=parseFloat(this);a.setEndingY(b)}}.call(this),function(){"use strict";var a=Adagio.Utils.math;Adagio.formatter.vertical.alignAboveOctaveShifts=function(e){if(e=e.filter(b),e.length>0){var f=e.map(c),g=f.reduce(a.min2);e.forEach(d,g)}};var b=function(a){return a.verticalData.upOctaveShiftsHeight>0},c=function(a){return a.getUpOctaveShiftsY()},d=function(a){var b=parseFloat(this);a.setUpOctaveShiftsY(b)}}.call(this),function(){"use strict";var a=Adagio.Utils.math;Adagio.formatter.vertical.alignBelowOctaveShifts=function(e){if(e=e.filter(b),e.length>0){var f=e.map(c),g=f.reduce(a.max2);e.forEach(d,g)}};var b=function(a){return a.verticalData.downOctaveShiftsY>0},c=function(a){return a.getDownOctaveShiftsY()},d=function(a){var b=parseFloat(this);a.setDownOctaveShiftsY(b)}}.call(this),function(){"use strict";var a=Adagio.Utils.math;Adagio.formatter.vertical.alignAboveWords=function(e){if(e=e.filter(b),e.length>0){var f=e.map(c),g=f.reduce(a.min2);e.forEach(d,g)}};var b=function(a){return a.verticalData.upWordHeight>0},c=function(a){return a.getUpWordY()},d=function(a){var b=parseFloat(this);a.setUpWordY(b)}}.call(this),function(){"use strict";var a=Adagio.Utils.math;Adagio.formatter.vertical.alignBelowWords=function(e){if(e=e.filter(b),e.length>0){var f=e.map(c),g=f.reduce(a.max2);e.forEach(d,g)}};var b=function(a){return a.verticalData.downWordHeight>0},c=function(a){return a.getDownWordY()},d=function(a){var b=parseFloat(this);a.setDownWordY(b)}}.call(this),function(){"use strict";var a=Adagio.Utils.math;Adagio.formatter.vertical.alignChords=function(e){if(e=e.filter(b),e.length>0){var f=e.map(c),g=f.reduce(a.min2);e.forEach(d,g)}};var b=function(a){return a.verticalData.chordsHeight>0},c=function(a){return a.getChordsY()},d=function(a){var b=parseFloat(this);a.setChordsY(b)}}.call(this),function(){"use strict";var a=Adagio.Utils.math;Adagio.formatter.vertical.alignUpLimit=function(d,e){var f=d.map(b);f.push(e);var g=f.reduce(a.min2);d.forEach(c,g)};var b=function(a){return a.getUpLimitY()},c=function(a){var b=parseFloat(this);a.setUpLimitY(b)}}.call(this),function(){"use strict";var a=Adagio.Utils.math;Adagio.formatter.vertical.alignDownLimit=function(d,e){var f=d.map(b);f.push(e);var g=f.reduce(a.max2);d.forEach(c,g)};var b=function(a){return a.getDownLimitY()},c=function(a){var b=parseFloat(this);a.setDownLimitY(b)}}.call(this);(function(){"use strict";var a=Adagio.formatter.vertical.alignAboveSlurs,b=Adagio.formatter.vertical.alignBelowSlurs,c=Adagio.formatter.vertical.alignAboveWedges,d=Adagio.formatter.vertical.alignBelowWedges,e=Adagio.formatter.vertical.alignLyrics,f=Adagio.formatter.vertical.alignEndings,g=Adagio.formatter.vertical.alignAboveOctaveShifts,h=Adagio.formatter.vertical.alignBelowOctaveShifts,i=Adagio.formatter.vertical.alignAboveWords,j=Adagio.formatter.vertical.alignBelowWords,k=Adagio.formatter.vertical.alignChords,l=Adagio.formatter.vertical.alignUpLimit,m=Adagio.formatter.vertical.alignDownLimit;Adagio.formatter.vertical.alignFormattings=function(l,m,p,q){a(p,l),b(p,l),c(m,l),d(m,l),
e(l),f(l),g(l),h(l),i(l),j(l),k(l),n(l,q),o(l,q)};var n=function(a,b){var c=-b.getMinimalSpaceAboveStaff();l(a,c)},o=function(a,b){var c=a[0],d=c.verticalData.staffHeight,e=d+b.getMinimalSpaceBelowStaff();m(a,e)}}).call(this),function(){"use strict";var a=Adagio.formatter.vertical.MeasureFormatting,b=Adagio.formatter.vertical.alignFormattings;Adagio.formatter.vertical.alignStaffContent=function(a,e,f){var g=a[0],h=g.drawingContext,i=a.map(c);b(i,e,f,h),i.forEach(d,a)};var c=function(b){var c=b.getVerticalData();return new a(c)},d=function(a,b){this[b].setVerticalFormatting(a)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Drawer.formatter.MeasuresHorizontalFormatter,c=Adagio.Drawer.MeasureNumber,d=Adagio.Drawer.Line,e=Adagio.Brush.Elem,f=Adagio.formatter.vertical.alignStaffContent,g=Adagio.Utils.staffDataUtils,h=Adagio.Values.DirectionPlacement,i=Adagio.Drawer.Measure=function(){this.init()};i.cssClass="measure";var j=i.prototype;j.cssClass=Adagio.Drawer.Measure.cssClass,j.init=function(){this.group=new e("g"),this.parent=null,this.insertionPoint=null,this.drawn=!1,this.leftBarline=null,this.drawnAttributes=null,this.attributesByMeasurePos={},this.tickableContent=null,this.rightAttributes=null,this.rightBarline=null,this.measureNumber=null,this.metronome=null,this.rehearsal=null,this.ending=null,this.jumpTag=null,this.jumpCall=null,this.staffData=null,this.leftTempoChangeAnchor=null,this.rightTempoChangeAnchor=null,this.middleTempoChangesAnchors=[],this.hasTempoChangesAboveValue=null,this.hasTempoChangesBelowValue=null,this.drawingContext=null,this.settedWidth=0,this.horizontalFormatting=null,this.verticalFormatting=null,this.needHorizontalFormatting=!0,this.needVerticalFormatting=!0,this.geometry=null,this.hasSystemBreakBeforeValue=!1,this.hasSystemBreakAfterValue=!1,this.xPos=null,this.yPos=null,this.group.attr("class",this.cssClass)},j.setParent=function(a){this.parent=a},j.setStaffData=function(a){this.staffData=a;for(var b in this.attributesByMeasurePos){this.getAttributes(b).setStaffData(this.staffData)}this.tickableContent.setStaffData(this.staffData),this.hasLeftBarline()&&this.leftBarline.setStaffData(this.staffData),this.hasRightBarline()&&this.rightBarline.setStaffData(this.staffData),this.rightAttributes.setStaffData(this.staffData)},j.setLeftBarline=function(a){a.setParent(this.getGroup()),this.leftBarline=a},j.setRightBarline=function(a){a.setParent(this.getGroup()),this.rightBarline=a},j.setTickableContent=function(a){a.setParent(this.getGroup()),this.tickableContent=a},j.addAttributes=function(a,b){b.setParent(this.getGroup()),this.attributesByMeasurePos[a]=b},j.setRightAttributes=function(a){a.setParent(this.getGroup()),this.rightAttributes=a},j.setMetronome=function(a){this.metronome=a,a.setParent(this.getGroup())},j.hasMetronome=function(){return null!==this.metronome},j.setRehearsal=function(a){this.rehearsal=a,a.setParent(this.getGroup())},j.hasRehearsal=function(){return null!==this.rehearsal},j.setEnding=function(a){this.ending=a,a.setParent(this.getGroup())},j.hasEnding=function(){return null!==this.ending},j.setJumpTag=function(a){this.jumpTag=a,a.setParent(this.getGroup())},j.hasJumpTag=function(){return null!==this.jumpTag},j.setJumpCall=function(a){this.jumpCall=a,a.setParent(this.getGroup())},j.hasJumpCall=function(){return null!==this.jumpCall},j.setRightTempoChangeAnchor=function(a){this.rightTempoChangeAnchor=a,a.setMeasure(this)},j.setLeftTempoChangeAnchor=function(a){this.leftTempoChangeAnchor=a,a.setMeasure(this)},j.addMiddleTempoChangeAnchor=function(a){this.middleTempoChangesAnchors.push(a),a.setMeasure(this)},j.hasSystemBreakAfter=function(){return this.hasSystemBreakAfterValue},j.hasSystemBreakBefore=function(){return this.hasSystemBreakBeforeValue},j.setHasSystemBreakBefore=function(a){this.hasSystemBreakBeforeValue=a},j.setHasSystemBreakAfter=function(a){this.hasSystemBreakAfterValue=a},j.hasLeftBarline=function(){return null!==this.leftBarline},j.hasRightBarline=function(){return null!==this.rightBarline},j.getWidth=function(){return this.horizontalFormatting.getWidth()},j.getSettedWidth=function(){return this.settedWidth},j.getHeight=function(){return this.verticalFormatting.getHeight()},j.getUpDynamicsY=function(){var a=this.drawingContext.getDynamicsHeight();return this.verticalFormatting.getUpDynamicsY()-a/2},j.getDownDynamicsY=function(){var a=this.drawingContext.getDynamicsHeight();return this.verticalFormatting.getDownDynamicsY()+a/2},j.getUpTempoChangesY=function(){return this.verticalFormatting.getUpTempoChangesY()},j.getDownTempoChangesY=function(){return this.verticalFormatting.getDownTempoChangesY()},j.getUpOctaveShiftsY=function(){return this.verticalFormatting.getUpOctaveShiftsY()},j.getDownOctaveShiftsY=function(){var a=this.drawingContext.getOctaveShiftHeight();return this.verticalFormatting.getDownOctaveShiftsY()+a},j.hasTempoChangesAbove=function(){return null===this.hasTempoChangesAboveValue&&this.calHasTempoChangesAbove(),this.hasTempoChangesAboveValue},j.calHasTempoChangesAbove=function(){this.hasTempoChangesAboveValue=this.hasLeftTempoChangeAnchor()&&k(this.getLeftTempoChangeAnchor())||this.hasRightTempoChangeAnchor()&&k(this.getRightTempoChangeAnchor())||this.middleTempoChangesAnchors.some(k)},j.hasTempoChangesBelow=function(){return null===this.hasTempoChangesBelowValue&&this.calcHasTempoChangesBelow(),this.hasTempoChangesBelowValue},j.calcHasTempoChangesBelow=function(){this.hasTempoChangesBelowValue=this.hasLeftTempoChangeAnchor()&&l(this.getLeftTempoChangeAnchor())||this.hasRightTempoChangeAnchor()&&l(this.getRightTempoChangeAnchor())||this.middleTempoChangesAnchors.some(l)};var k=function(a){return a.isAbove()},l=function(a){return a.isBelow()};j.getSpaceAboveStaff=function(){return this.verticalFormatting.getSpaceAboveStaff()},j.getSpaceBelowStaff=function(){return this.verticalFormatting.getDownLimitY()-this.getStaffHeight()},j.getGroup=function(){return this.group},j.render=function(a){if(null===this.drawingContext){this.drawingContext=a,this.middleTempoChangesAnchors.forEach(this.transferDrawingContext,this),this.settedWidth=a.getMeasureWidth(),this.hasLeftBarline()&&this.leftBarline.render(a);for(var b in this.attributesByMeasurePos)this.getAttributes(b).setDrawingContext(a);this.tickableContent.render(a),this.rightAttributes.setDrawingContext(a),this.hasRightBarline()&&this.rightBarline.render(a),this.hasMetronome()&&this.metronome.setDrawingContext(a),this.hasRehearsal()&&this.rehearsal.setDrawingContext(a),this.hasEnding()&&this.ending.setDrawingContext(a),this.hasJumpTag()&&this.jumpTag.setDrawingContext(a),this.hasJumpCall()&&this.jumpCall.setDrawingContext(a),this.formatStaticElements()}},j.transferDrawingContext=function(a){a.setDrawingContext(this.drawingContext)},j.formatStaticElements=function(){this.hasLeftBarline()&&this.leftBarline.setPosition(0)},j.autoAlignHorizontal=function(a){this.checkMeasurePos(a);var c=this.getHorizontalData(),d=this.drawingContext.getNotesFormatter(),e=new b(this.drawingContext,[c],d);e.format();var f=e.getSettedWidth(),g=e.getFormatting();g.setMeasurePosition(a),g.setWidth(f),this.setHorizontalFormatting(g)},j.setHorizontalFormatting=function(a){this.horizontalFormatting=a,this.needHorizontalFormatting=!0;var b=this.horizontalFormatting.getNotesFormatter();this.tickableContent.setHorizontalFormatter(b),this.updateAttributes()},j.updateAttributes=function(){if(null!==this.drawnAttributes){var a=this.getAttributes();a!==this.drawnAttributes&&(this.drawnAttributes.unbind(),a.draw(),this.drawnAttributes=a)}},j.getHorizontalFormatting=function(){return this.horizontalFormatting},j.autoAlignVertical=function(){f([this],[],[])},j.setVerticalFormatting=function(a){this.verticalFormatting=a,this.tickableContent.setVerticalFormatting(a),this.needVerticalFormatting=!0},j.getDivisions=function(){return this.tickableContent.getDivisions()},j.draw=function(){this.move(),this.formatIfNeeded(),this.drawContent(),this.bindToParent()},j.drawContent=function(){this.hasLeftBarline()&&this.leftBarline.draw(),this.getAttributes().draw(),this.drawnAttributes=this.getAttributes(),this.tickableContent.draw(),this.rightAttributes.draw(),this.hasRightBarline()&&this.rightBarline.draw(),this.hasMetronome()&&this.metronome.draw(),this.hasRehearsal()&&this.rehearsal.draw(),this.hasEnding()&&this.ending.draw(),this.hasJumpTag()&&this.jumpTag.draw(),this.hasJumpCall()&&this.jumpCall.draw()},j.bindToParent=function(){this.drawn||(null===this.insertionPoint?this.parent.append(this.group):this.parent.insertBefore(this.group,this.insertionPoint),this.drawn=!0)},j.unbind=function(){this.drawn&&(this.getGroup().removeFromParent(),this.drawn=!1)},j.getAttributes=function(a){return a=this.getMeasurePos(a),this.attributesByMeasurePos[a]},j.getMeasurePos=function(b){if(void 0!==b)return this.checkMeasurePos(b),b;if(this.hasHorizontalFormatting()){return this.getHorizontalFormatting().getMeasurePos()}throw new a("MissingGlobalFormatting","The formatting data must be setted in order to have the default measure position")},j.checkMeasurePos=function(b){if(!this.hasAttributes(b)){throw new a("BadMeasurePos","There is no attributes for the measure position ["+b+"].")}},j.hasAttributes=function(a){return void 0!==this.attributesByMeasurePos[a]},j.hasHorizontalFormatting=function(){return null!==this.horizontalFormatting},j.formatIfNeeded=function(){this.needHorizontalFormatting&&this.formatHorizontal(),this.needVerticalFormatting&&this.formatVertical()},j.formatHorizontal=function(){if(null===this.horizontalFormatting){throw new a("MissingFormatting","Cannot format without formatting data.")}var b=this.horizontalFormatting.getAttributesX(),c=this.getAttributes(),d=c.getPreviousSpace(),e=this.getWidth();c.setPosition(b+d);var f=this.horizontalFormatting.getNotesX();if(this.tickableContent.setPosition(f),this.tickableContent.formatHorizonal(),this.hasRightBarline()){var g=this.horizontalFormatting.getRightBarlineX();this.rightBarline.setPosition(g)}var h=this.horizontalFormatting.getRightAttributesX();if(this.rightAttributes.setPosition(h),this.hasMetronome()){var i=this.metronome.getPreviousSpace();this.metronome.setPosX(i)}if(this.hasRehearsal()){var j=this.rehearsal.getPreviousSpace();this.rehearsal.setPosX(j)}if(this.hasEnding()&&this.ending.setWidth(e),this.hasJumpTag()&&this.jumpTag.setPosX(0),this.hasJumpCall()&&this.jumpCall.setMeasureWidth(e),this.hasRealNumber()){var k=this.measureNumber.getPreviousSpace();this.measureNumber.setPosX(k)}this.needHorizontalFormatting=!1},j.setCrossMeasuresNeedDrawUpdate=function(){this.tickableContent.setCrossMeasuresNeedDrawUpdate()},j.formatVertical=function(){if(this.tickableContent.formatVertical(),this.hasMetronome()){var a=this.verticalFormatting.getMetronomeY(),b=this.metronome.getHeight();this.metronome.setPosY(a-b)}if(this.hasRehearsal()){var c=this.verticalFormatting.getRehearsalY(),d=this.rehearsal.getHeight();this.rehearsal.setPosY(c-d)}if(this.hasEnding()){var e=this.verticalFormatting.getEndingY();this.ending.setPosY(e)}if(this.hasJumpTag()){var f=this.verticalFormatting.getJumpTagY();this.jumpTag.setPosY(f)}if(this.hasJumpCall()){var g=this.verticalFormatting.getJumpCallY();this.jumpCall.setPosY(g)}if(this.hasRealNumber()){var h=this.verticalFormatting.getMeasureNumberY();this.measureNumber.setPosY(h)}},j.setPosX=function(a){this.setCrossMeasuresNeedDrawUpdate(),this.xPos=a},j.setPosY=function(a){this.setCrossMeasuresNeedDrawUpdate(),this.yPos=a},j.move=function(){null!==this.xPos&&null!==this.yPos&&this.group.attr("transform","translate("+this.xPos+" "+this.yPos+")")},j.getXPos=function(){return this.xPos},j.getNote=function(a,b){return this.getTickableContent().getNote(a,b)},j.getNoteX=function(a,b){return this.getXPos()+this.tickableContent.getNoteX(a,b)},j.extendBarlines=function(a){this.hasLeftBarline()&&this.leftBarline.extend(a),this.hasRightBarline()&&this.rightBarline.extend(a)},j.setInsertionPoint=function(a){this.insertionPoint=a},j.drawCursor=function(a,b){this.tickableContent.drawCursor(a,b)},j.drawGraceCursor=function(a,b){this.tickableContent.drawGraceCursor(a,b)},j.drawDynamicCursor=function(a,b){this.tickableContent.drawDynamicCursor(a,b)},j.drawPizzicatoCursor=function(a,b){this.tickableContent.drawPizzicatoCursor(a,b)},j.drawSlurCursor=function(a,b){this.tickableContent.drawSlurCursor(a,b)},j.updateMeasureNumber=function(a){var b=this.getMeasureNumber();null!==b&&b.update(a)},j.removeMeasureNumber=function(a){var b=this.getMeasureNumber();null!==b&&b.hide(a)},j.setMeasureNumber=function(a){this.measureNumber=a},j.getMeasureNumber=function(){return this.hasNumber()||this.hasRehearsal()||(this.measureNumber=new c(this.getGroup()),this.measureNumber.render(this.drawingContext)),this.measureNumber},j.resetGeometry=function(){this.geometry=null},j.getGeometry=function(){var a=this.calcGeometry();if(null===this.geometry)a.isNew=!0;else{var b=this.geometry;a.isNew=!m(a,b)}return this.geometry=a,a},j.calcGeometry=function(){var a=this.drawingContext.getSpaceBetweenStaves()/2;return{staffHeight:this.getStaffHeight(),spaceAbove:this.getSpaceAboveStaff()+a,spaceBelow:this.getSpaceBelowStaff()+a,width:this.getWidth(),svg:this.getGroup()}};var m=function(a,b){return a.staffHeight===b.staffHeight&&a.spaceAbove===b.spaceAbove&&a.spaceBelow===b.spaceBelow&&a.width===b.width&&a.svg===b.svg};j.getTickableContent=function(){return this.tickableContent},j.getHorizontalData=function(){var a=this.getLeftBarlineWidth(),b=this.getLeftAttributesWidthByMeasurePos(),c=this.getTickableHorizontalData(),d=this.getRightAttributesWidth(),e=this.getRightBarlineWidth(),f=this.settedWidth;return{leftBarline:a,leftAttributesByMeasurePos:b,spaceBeforeNotes:this.drawingContext.getSpaceBeforeNotes(),tickablesContents:c,rightAttributes:d,rightBarline:e,settedWidth:f}},j.getLeftBarlineWidth=function(){return this.hasLeftBarline()?this.leftBarline.getWidth():0},j.getLeftAttributesWidthByMeasurePos=function(){var a={};for(var b in this.attributesByMeasurePos){var c=this.getAttributes(b),d=c.getWidth()+c.getPreviousSpace();a[b]=d}return a},j.getTickableHorizontalData=function(){return this.tickableContent.getHorizontalData()},j.getRightAttributesWidth=function(){return this.rightAttributes.getWidth()+this.rightAttributes.getNextSpace()},j.getRightBarlineWidth=function(){return this.hasRightBarline()?this.rightBarline.getWidth():0},j.getVerticalData=function(){var a=this.getNotesVerticalData(),b=this.getStaffHeight(),c=0,d=0,e=0,f=0,g=0,h=0,i=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0,t=0,u=0,v=0,w=0,x=0,y=0,z=0,A=0,B=0,C=0,D=this.getUpAttributesOverflow(),E=0,F=0,G=this.horizontalFormatting.getAttributesX(),H=this.getAttributes(),I=G+H.getPreviousSpace()+H.getWidth();return this.hasUpDynamics()&&(d=this.drawingContext.getMarginSize(),c=this.drawingContext.getDynamicsHeight()),this.hasDownDynamics()&&(f=this.drawingContext.getMarginSize(),e=this.drawingContext.getDynamicsHeight()),this.tickableContent.hasPizzicatosAbove()&&(g=this.drawingContext.getPizzicatoHeight()),this.tickableContent.hasPizzicatosBelow()&&(h=this.drawingContext.getPizzicatoHeight()),this.tickableContent.hasOctaveShiftsAbove()&&(w=this.drawingContext.getOctaveShiftHeight(),x=this.drawingContext.getMarginSize()),this.tickableContent.hasOctaveShiftsBelow()&&(y=this.drawingContext.getOctaveShiftHeight(),z=this.drawingContext.getMarginSize()),this.hasTempoChangesAbove()&&(A=this.drawingContext.getTempoChangeHeight()),this.hasTempoChangesBelow()&&(B=this.drawingContext.getTempoChangeHeight(),C=this.drawingContext.getMarginSize()),this.tickableContent.hasWordsAbove()&&(i=this.drawingContext.getWordHeight()),this.tickableContent.hasWordsBelow()&&(j=this.drawingContext.getWordHeight()),a.hasLyric&&(l=this.drawingContext.getSpaceSize(),k=a.lyricHeight),this.hasMetronome()&&(m=this.metronome.getHeight(),n=this.metronome.getPreviousSpace()+this.metronome.getWidth()),this.hasRehearsal()&&(o=this.rehearsal.getHeight(),p=this.rehearsal.getPreviousSpace()+this.rehearsal.getWidth()),this.hasEnding()&&(q=this.ending.getHeight()),this.hasJumpTag()&&(r=this.jumpTag.getHeight(),t=this.jumpTag.getWidth(),s=this.jumpTag.getMarginSize()),this.hasJumpCall()&&(u=this.jumpCall.getHeight(),v=this.jumpCall.getMarginSize()),this.hasRealNumber()&&(E=this.measureNumber.getHeight(),F=this.measureNumber.getMarginSize()),{notesUpOverflow:a.notesUpOverflow,upAttributesOverflow:D,notesLeftX:I,measureNumberHeight:E,measureNumberMargin:F,upDynamicsHeight:c,upDynamicsMargin:d,upPizzicatoHeight:g,upOctaveShiftsHeight:w,upOctaveShiftsMargin:x,upWordHeight:i,chordsHeight:a.chordsHeight,endingHeight:q,upTempoChangesHeight:A,jumpTagHeight:r,jumpTagMargin:s,jumpTagRightX:t,jumpCallHeight:u,jumpCallMargin:v,rehearsalHeight:o,rehearsalRightX:p,metronomeHeight:m,metronomeRightX:n,staffHeight:b,notesDownOverflow:a.notesDownOverflow,downDynamicsMargin:f,downDynamicsHeight:e,downPizzicatoHeight:h,downOctaveShiftsHeight:y,downOctaveShiftsMargin:z,downTempoChangesHeight:B,downTempoChangesMargin:C,downWordHeight:j,lyricsMargin:l,lyricsHeight:k}},j.getUpAttributesOverflow=function(){return this.getAttributes().getUpOverflow()},j.getNumberOverflow=function(){var a=Math.round(this.drawingContext.getMeasureNumberSize());return this.drawingContext.getSpaceSize()/4+a},j.getNotesVerticalData=function(){return this.tickableContent.getVerticalData()},j.getStaffData=function(){return this.hasStaffData()||this.setStaffData(g.createDefault()),this.staffData},j.getNbStaffLines=function(){var a=this.getStaffData();return g.getNbStaffLines(a)},j.isTabStaff=function(){var a=this.getStaffData();return g.isTabStaff(a)},j.getStaffHeight=function(){return(this.isTabStaff()?this.drawingContext.getTabSpaceSize():this.drawingContext.getSpaceSize())*(this.getNbStaffLines()-1)},j.hasUpDynamics=function(){return this.tickableContent.hasDynamicsAbove()||this.tickableContent.hasWedgeAbove()},j.hasDownDynamics=function(){return this.tickableContent.hasDynamicsBelow()||this.tickableContent.hasWedgeBelow()},j.updateHorizontalDisplay=function(){this.getAttributes().move(),this.tickableContent.move(),this.tickableContent.updateHorizontalDisplay(),this.rightAttributes.move(),this.hasRightBarline()&&this.rightBarline.move(),this.hasMetronome()&&this.metronome.move(),this.hasRehearsal()&&this.rehearsal.move(),this.hasEnding()&&this.ending.updateHorizontalDisplay(),this.hasNumber()&&this.measureNumber.move(),this.hasJumpTag()&&this.jumpTag.move(),this.hasJumpCall()&&this.jumpCall.move()},j.updateVerticalDisplay=function(){this.tickableContent.updateVerticalDisplay(),this.hasMetronome()&&this.metronome.move(),this.hasRehearsal()&&this.rehearsal.move(),this.hasEnding()&&this.ending.updateVerticalDisplay()},j.purgeCrossMeasures=function(){this.tickableContent.purgeCrossMeasures()},j.drawVerticalDebug=function(){var a=this.verticalFormatting.getUpLimitY();this.drawVerticalDebugLine(a,"red");var b=this.verticalFormatting.getDownLimitY();this.drawVerticalDebugLine(b,"red");var c=this.verticalFormatting.getLyricsY();this.drawVerticalDebugLine(c,"blue");var d=this.verticalFormatting.getUpDynamicsY();this.drawVerticalDebugLine(d,"green");var e=this.verticalFormatting.getDownDynamicsY();this.drawVerticalDebugLine(e,"green")},j.drawVerticalDebugLine=function(a,b){var c={stroke_width:1,stroke:b},e=new d(this.group,c),f=this.getWidth();e.render(0,a,f,a),e.draw()},j.hasLyrics=function(){return this.verticalFormatting.hasLyrics()},j.getLyricsUpY=function(){return this.verticalFormatting.getLyricsY()},j.getChordsY=function(){return this.verticalFormatting.getChordsY()},j.getWordsY=function(b){if(b===h.ABOVE)return this.verticalFormatting.getUpWordY()-this.drawingContext.getWordFontSize()/2;if(b===h.BELOW)return this.verticalFormatting.getDownWordY()+this.drawingContext.getWordFontSize();throw new a("Unexpected","The placement ["+b+"] is invalid.")},j.hasStaffData=function(){return null!==this.staffData},j.hasRealNumber=function(){return!!this.hasNumber()&&this.measureNumber instanceof c},j.hasNumber=function(){return null!==this.measureNumber},j.hasRightTieAnchor=function(a){return this.tickableContent.hasRightTieAnchor(a)},j.getRightTieAnchor=function(a){var b=this.tickableContent.getRightTieAnchor(a);return b.setMeasure(this),b},j.hasLeftTieAnchor=function(a){return this.tickableContent.hasLeftTieAnchor(a)},j.getLeftTieAnchor=function(a){var b=this.tickableContent.getLeftTieAnchor(a);return b.setMeasure(this),b},j.hasRightHyphenAnchor=function(a){return this.tickableContent.hasRightHyphenAnchor(a)},j.getRightHyphenAnchor=function(a){var b=this.tickableContent.getRightHyphenAnchor(a);return b.setMeasure(this),b},j.hasLeftHyphenAnchor=function(a){return this.tickableContent.hasLeftHyphenAnchor(a)},j.getLeftHyphenAnchor=function(a){var b=this.tickableContent.getLeftHyphenAnchor(a);return b.setMeasure(this),b},j.hasRightHammerOnPullOffAnchor=function(a){return this.tickableContent.hasRightHammerOnPullOffAnchor(a)},j.getRightHammerOnPullOffAnchor=function(a){var b=this.tickableContent.getRightHammerOnPullOffAnchor(a);return b.setMeasure(this),b},j.hasLeftHammerOnPullOffAnchor=function(a){return this.tickableContent.hasLeftHammerOnPullOffAnchor(a)},j.getLeftHammerOnPullOffAnchor=function(a){var b=this.tickableContent.getLeftHammerOnPullOffAnchor(a);return b.setMeasure(this),b},j.hasRightGlissandoAnchor=function(a){return this.tickableContent.hasRightGlissandoAnchor(a)},j.getRightGlissandoAnchor=function(a){var b=this.tickableContent.getRightGlissandoAnchor(a);return b.setMeasure(this),b},j.hasLeftGlissandoAnchor=function(a){return this.tickableContent.hasLeftGlissandoAnchor(a)},j.getLeftGlissandoAnchor=function(a){var b=this.tickableContent.getLeftGlissandoAnchor(a);return b.setMeasure(this),b},j.hasRightSlurAnchor=function(a){return this.tickableContent.hasRightSlurAnchor(a)},j.getRightSlurAnchor=function(a){var b=this.tickableContent.getRightSlurAnchor(a);return b.setMeasure(this),b},j.hasLeftSlurAnchor=function(a){return this.tickableContent.hasLeftSlurAnchor(a)},j.getLeftSlurAnchor=function(a){var b=this.tickableContent.getLeftSlurAnchor(a);return b.setMeasure(this),b},j.getMiddleSlursAnchors=function(a){var b=this.tickableContent.getMiddleSlursAnchors(a);return b.forEach(this.dispatchMeasure,this),b},j.getAllSlursAnchors=function(a){var b=this.tickableContent.getAllSlursAnchors(a);return b.forEach(this.dispatchMeasure,this),b},j.hasRightWedgeAnchor=function(){return this.tickableContent.hasRightWedgeAnchor()},j.getRightWedgeAnchor=function(){var a=this.tickableContent.getRightWedgeAnchor();return a.setMeasure(this),a},j.hasLeftWedgeAnchor=function(){return this.tickableContent.hasLeftWedgeAnchor()},j.getLeftWedgeAnchor=function(){var a=this.tickableContent.getLeftWedgeAnchor();return a.setMeasure(this),a},j.getMiddleWedgesAnchors=function(){var a=this.tickableContent.getMiddleWedgesAnchors();return a.forEach(this.dispatchMeasure,this),a},j.getAllWedgesAnchors=function(){var a=this.tickableContent.getAllWedgesAnchors();return a.forEach(this.dispatchMeasure,this),a},j.hasRightOctaveShiftAnchor=function(){return this.tickableContent.hasRightOctaveShiftAnchor()},j.getRightOctaveShiftAnchor=function(){var a=this.tickableContent.getRightOctaveShiftAnchor();return a.setMeasure(this),a},j.hasLeftOctaveShiftAnchor=function(){return this.tickableContent.hasLeftOctaveShiftAnchor()},j.getLeftOctaveShiftAnchor=function(){var a=this.tickableContent.getLeftOctaveShiftAnchor();return a.setMeasure(this),a},j.getMiddleOctaveShiftsAnchors=function(){var a=this.tickableContent.getMiddleOctaveShiftsAnchors();return a.forEach(this.dispatchMeasure,this),a},j.getAllOctaveShiftsAnchors=function(){var a=this.tickableContent.getAllOctaveShiftsAnchors();return a.forEach(this.dispatchMeasure,this),a},j.getAllTempoChangesAnchors=function(){var a=this.middleTempoChangesAnchors.slice();return this.hasLeftTempoChangeAnchor()&&a.push(this.getLeftTempoChangeAnchor()),this.hasRightTempoChangeAnchor()&&a.push(this.getRightTempoChangeAnchor()),a.forEach(this.dispatchMeasure,this),a},j.hasRightTempoChangeAnchor=function(){return null!==this.rightTempoChangeAnchor},j.getRightTempoChangeAnchor=function(){var a=this.rightTempoChangeAnchor;return a.setMeasure(this),a},j.hasLeftTempoChangeAnchor=function(){return null!==this.leftTempoChangeAnchor},j.getLeftTempoChangeAnchor=function(){var a=this.leftTempoChangeAnchor;return a.setMeasure(this),a},j.getMiddleTempoChangesAnchors=function(){var a=this.middleTempoChangesAnchors;return a.forEach(this.dispatchMeasure,this),a},j.dispatchMeasure=function(a){a.setMeasure(this)},j.getNbNotes=function(a){return this.tickableContent.getNbNotes(a)},j.hasVoice=function(a){return this.tickableContent.hasVoice(a)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Error.MusicXMLFeatureNotSupportedError,c=Adagio.Utils.barlineUtils,d=Adagio.Drawer.Line,e=Adagio.Brush.Elem,f=Adagio.Utils.staffDataUtils,g=Adagio.Drawer.barline.SingleBar=function(a,b){this.init(a,b)},h=g.prototype;h.init=function(a,b){this.line=null,this.drawingContext=null,this.staffData=null,this.width=null,this.xPos=null,this.margin=null,this.group=new e("g"),this.parent=null,"none"===a&&(a="regular"),i(a),j(b),this.style=a,this.pos=b};var i=function(d){var e;if(!c.validSingleStyles.includes(d))throw e="The bar style ["+d+"] is invalid.",new a("BadBarStyle",e);if(!c.supportedSingleStyles.includes(d))throw e="The bar style ["+d+"] is not yet supported.",new b(e)},j=function(b){if(b!==c.POS_FIRST&&b!==c.POS_SECOND){throw new a("BadBarlinePosition","The bar position ["+b+"] is invalid.")}};h.setStaffData=function(a){this.staffData=a},h.setParent=function(a){this.parent=a},h.render=function(a){this.drawingContext=a,this.margin=a.getBarlineSeparation();var b=this.getWidth(),c=b/2,e=c,f=c,g=this.getHeight();this.line=new d(this.group,{stroke_width:b}),this.line.render(e,0,f,g)},h.getHeight=function(){return this.checkHasStaffData(),(this.getNbStaffLines()-1)*this.getSpaceSize()},h.checkHasStaffData=function(){if(null===this.staffData){throw new a("MissingNbStaves","The barline needs to know the number of staff lines to be rendered with the good height.")}},h.getNbStaffLines=function(){return f.getNbStaffLines(this.staffData)},h.getSpaceSize=function(){return this.isTabStaff()?this.drawingContext.getTabSpaceSize():this.drawingContext.getSpaceSize()},h.isTabStaff=function(){return f.isTabStaff(this.staffData)},h.getWidth=function(){return null===this.width&&(this.width=this.getThickness()),this.width},h.getThickness=function(){return"regular"===this.style||"light"===this.style?this.drawingContext.getThinBarlineThickness():this.drawingContext.getThickBarlineThickness()},h.getPreviousSpace=function(){return this.pos===c.POS_SECOND?this.margin:0},h.getNextSpace=function(){return 0},h.draw=function(){this.move(),this.line.draw(),this.bindToParent()},h.bindToParent=function(){this.parent.append(this.group)},h.setPosition=function(a){this.xPos=a},h.move=function(){this.group.attr("transform","translate("+this.xPos+" 0)")},h.extend=function(a){var b=this.getHeight();this.line.setY2(b+a)}}.call(this),function(){"use strict";(Adagio.Utils.funcUtils={}).noOp=function(){}}.call(this),function(){"use strict";var a=Adagio.Utils,b=Adagio.Brush.Elem;Adagio.Drawer.Circle=function(a,b){this.init(a,b),this.circle=null},Adagio.Drawer.Circle.prototype.defaultOptions={},Adagio.Drawer.Circle.prototype.init=function(b,c){this.options=a.merge_options(this.defaultOptions,c),this.svgGroup=b},Adagio.Drawer.Circle.prototype.getLine=function(){return this.line},Adagio.Drawer.Circle.prototype.render=function(a,c){return null!==this.circle?this:(this.c1=a,this.y1=c,this.circle=new b("circle").attr("cx",a).attr("cy",c).attr("r",this.options.r),void 0!==this.options.fill&&this.circle.attr("fill",this.options.fill),void 0!==this.options.stroke_width&&this.circle.attr("stroke-width",this.options.stroke_width),void 0!==this.options.stroke&&this.circle.attr("stroke",this.options.stroke),this)},Adagio.Drawer.Circle.prototype.draw=function(){this.svgGroup.append(this.circle)},Adagio.Drawer.Circle.prototype.getGroup=function(){return this.getLine()}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.repeatUtils,c=Adagio.Utils.funcUtils,d=Adagio.Drawer.Circle,e=Adagio.Brush.Elem,f=Adagio.Utils.staffDataUtils,g=Adagio.Drawer.barline.RepeatDots=function(a){this.init(a)},h=g.prototype;h.init=function(a){this.upperDot=null,this.lowerDot=null,this.drawingContext=null,this.staffData=null,this.width=null,this.xPos=null,this.margin=null,this.group=new e("g"),this.parent=null,i(a),this.repeatDirection=a};var i=function(c){if(c!==b.DIRECTION_BACKWARD&&c!==b.DIRECTION_FORWARD){throw new a("BadRepeatDirection","The repeat direction ["+c+"] is invalid.")}};h.setParent=function(a){this.parent=a},h.setStaffData=function(a){this.staffData=a},h.render=function(a){this.drawingContext=a;var b=a.getRepeatDotRadius();this.width=2*b,this.margin=a.getRepeatBarlineDotSeparation();var c=this.getSpaceSize(),e=this.getCoeff(),f=-e*c,g=e*c,h=b;this.upperDot=new d(this.group,{r:b}),this.upperDot.render(h,f),this.lowerDot=new d(this.group,{r:b}),this.lowerDot.render(h,g)},h.getCoeff=function(){return f.getNbStaffLines(this.staffData)%2==0?1:.5},h.getSpaceSize=function(){return this.isTabStaff()?this.drawingContext.getTabSpaceSize():this.drawingContext.getSpaceSize()},h.isTabStaff=function(){return f.isTabStaff(this.staffData)},h.getWidth=function(){return this.width},h.getPreviousSpace=function(){return this.repeatDirection===b.DIRECTION_BACKWARD?0:this.margin},h.getNextSpace=function(){return this.repeatDirection===b.DIRECTION_BACKWARD?this.margin:0},h.draw=function(){this.move(),this.upperDot.draw(),this.lowerDot.draw(),this.bindToParent()},h.bindToParent=function(){this.parent.append(this.group)},h.setPosition=function(a){this.xPos=a},h.move=function(){this.checkHasStaffData();var a=this.getSpaceSize(),b=(this.getNbStaffLines()-1)*a/2;this.group.attr("transform","translate("+this.xPos+" "+b+")")},h.getNbStaffLines=function(){return f.getNbStaffLines(this.staffData)},h.checkHasStaffData=function(){if(null===this.staffData){throw new a("MissingNbStaves","The repeat dots needs to know the number of staff lines to be drawn at the good Y.")}},h.extend=c.noOp}.call(this),function(){"use strict";var a=Adagio.Utils.barlineUtils,b=Adagio.Utils.repeatUtils,c=Adagio.Drawer.barline.SingleBar,d=Adagio.Drawer.barline.RepeatDots,e=Adagio.Brush.Elem,f="-",g=Adagio.Drawer.barline.Barline=function(a){this.init(a)};g.cssClass="barline";var h=g.prototype;h.cssClass=g.cssClass,h.init=function(a){this.list=[],this.drawingContext=null,this.staffData=null,this.width=null,this.xPos=null,this.group=new e("g"),this.group.attr("class",this.cssClass),this.parent=null,this.initContent(a)},h.initContent=function(b){a.hasRepeatBackward(b)&&this.addRepeatBackward();var c=a.getStyle(b),d=c.split(f);this.addFirstBar(d[0]),2===d.length&&this.addSecondBar(d[1]),a.hasRepeatForward(b)&&this.addRepeatForward()},h.addRepeatForward=function(){var a=b.DIRECTION_FORWARD,c=new d(a);this.addEntity(c)},h.addFirstBar=function(b){var d=a.POS_FIRST,e=new c(b,d);this.addEntity(e)},h.addSecondBar=function(b){var d=a.POS_SECOND,e=new c(b,d);this.addEntity(e)},h.addRepeatBackward=function(){var a=b.DIRECTION_BACKWARD,c=new d(a);this.addEntity(c)},h.addEntity=function(a){a.setParent(this.group),this.list.push(a)},h.setParent=function(a){this.parent=a},h.setStaffData=function(a){this.staffData=a,this.list.forEach(this.transferStaffData,this)},h.transferStaffData=function(a){a.setStaffData(this.staffData)},h.render=function(a){this.drawingContext=a,this.list.forEach(this.renderEntity,this),this.computePositions()},h.renderEntity=function(a){a.render(this.drawingContext)},h.computePositions=function(){this.width=this.list.reduce(i,0)};var i=function(a,b){return a+=b.getPreviousSpace(),b.setPosition(a),
a+b.getWidth()+b.getNextSpace()};h.getWidth=function(){return this.width},h.draw=function(){this.move(),this.list.forEach(j),this.bindToParent()},h.bindToParent=function(){this.parent.append(this.group)};var j=function(a){a.draw()};h.setPosition=function(a){this.xPos=a},h.move=function(){this.group.attr("transform","translate("+this.xPos+" 0)")},h.extend=function(a){this.list.forEach(function(b){b.extend(a)})}}.call(this),function(){"use strict";var a=Adagio.Brush.Elem,b=Adagio.Utils.math,c=0,d=1,e=2,f=Adagio.Drawer.AttributesSet=function(){this.init()};f.cssClass="attributes";var g=f.prototype;g.cssClass=f.cssClass,g.init=function(){this.list=[],this.drawingContext=null,this.staffData=null,this.width=null,this.xPos=null,this.drawn=!1,this.group=null,this.parent=null},g.setParent=function(a){this.parent=a},g.setStaffData=function(a){this.staffData=a,this.list.forEach(this.transferStaffData,this)},g.transferStaffData=function(a){a.attr.setStaffData(this.staffData)},g.setClef=function(a){this.addAttr(a,c)},g.setKey=function(a){this.addAttr(a,d)},g.setTime=function(a){this.addAttr(a,e)},g.addAttr=function(a,b){var c={attr:a,type:b};this.list.push(c)},g.setDrawingContext=function(a){this.drawingContext=a,this.list.forEach(this.transferDrawingContext,this)},g.transferDrawingContext=function(a){a.attr.setDrawingContext(this.drawingContext)},g.getWidth=function(){return this.isAligned()||this.align(),this.width},g.getPreviousSpace=function(){return this.list.length>0?this.drawingContext.getMarginSize():0},g.getNextSpace=function(){return this.list.length>0?this.drawingContext.getMarginSize():0},g.isAligned=function(){return null!==this.width},g.align=function(){this.width=this.list.reduce(this.alignEntry.bind(this),0,this)},g.alignEntry=function(a,b){if(a>0){a+=this.getMarginSize()}return b.attr.setPosition(a),a+b.attr.getWidth()},g.getMarginSize=function(){return this.drawingContext.getAttributesOffset()},g.render=function(){this.group=new a("g"),this.group.attr("class",this.cssClass),this.list.forEach(this.renderEntry,this)},g.renderEntry=function(a){this.isAligned()||this.align(),a.attr.setParent(this.group),a.attr.render()},g.draw=function(){this.needRender()&&(this.render(),this.list.forEach(h)),this.move(),this.bindToParent()},g.needRender=function(){return null===this.group};var h=function(a){a.attr.draw()};g.bindToParent=function(){this.drawn||(this.parent.append(this.group),this.drawn=!0)},g.unbind=function(){this.drawn&&(this.group.removeFromParent(),this.drawn=!1)},g.setPosition=function(a){this.xPos=a},g.move=function(){this.needRender()||null===this.xPos||this.group.attr("transform","translate("+this.xPos+" 0)")},g.getUpOverflow=function(){return this.list.map(i).reduce(b.max2,0)};var i=function(a){return a.attr.getUpOverflow()}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Error.MusicXMLFeatureNotSupportedError,c=Adagio.Brush.Elem,d=Adagio.Utils.clefUtils,e=Adagio.Utils.staffDataUtils,f={C:"cClef",F:"fClef",G:"gClef",percussion:"unpitchedPercussionClef1",TAB:"6stringTabClef"},g="6stringTabClef",h="4stringTabClef",i="15ma",j="8va",k="15mb",l="8vb",m=Adagio.Drawer.Clef=function(a){this.init(a)};m.cssClass="clef";var n=m.prototype;n.cssClass=m.cssClass,n.init=function(a){d.check(a),o(a),this.clef=a,this.glyphName=p(a),this.line=d.getDisplayLine(a),this.glyph=null,this.path=null,this.drawingContext=null,this.staffData=null,this.xPos=null,this.parent=null,this.group=null};var o=function(a){var c=d.getSign(a);if(void 0===f[c]){throw new b("BadTimeSymbol","The clef sign ["+c+"] is not supported yet.")}},p=function(a){if(d.isTab(a))switch(d.getLine(a)){case 4:return h;default:return g}var b=d.getSign(a);return f[b]+q(a)},q=function(a){if(d.isPercussion(a))return"";var b=d.getOctaveChange(a);if(0===b)return"";var c=d.getSign(a);return 1!==b||"G"!==c&&"F"!==c?2!==b||"G"!==c&&"F"!==c?-1!==b||"G"!==c&&"F"!==c&&"C"!==c?-2!==b||"G"!==c&&"F"!==c?"":k:l:i:j};n.setParent=function(a){this.parent=a},n.setStaffData=function(a){this.staffData=a},n.setDrawingContext=function(a){this.drawingContext=a},n.getStaffData=function(){return this.staffData},n.getWidth=function(){return this.getGlyph().getWidth()},n.getHeight=function(){return this.getGlyph().getHeight()},n.getGlyph=function(){return null===this.glyph&&(this.glyph=this.drawingContext.getGlyph(this.glyphName)),this.glyph},n.render=function(){this.group=new c("g"),this.group.attr("class",this.cssClass),this.path=this.group.append("path"),this.path.attr("d",this.glyph.render())},n.setPosition=function(a){this.xPos=a},n.draw=function(){this.needRender()&&this.render(),this.move(),this.bindToParent()},n.needRender=function(){return null===this.group},n.bindToParent=function(){this.parent.append(this.group)},n.move=function(){var a=this.getPathY();this.group.attr("transform","translate("+this.xPos+", "+a+")")},n.getPathY=function(){this.checkHasStaffData();var a=this.isTabStaff()?this.drawingContext.getTabSpaceSize():this.drawingContext.getSpaceSize();return d.isTab(this.clef)?(this.getNbStaffLines()-1)*a/2:(this.getNbStaffLines()-this.line)*a},n.checkHasStaffData=function(){if(null===this.staffData){throw new a("MissingNbStaves","The clef needs to know the number of staff lines to be moved to the right y pos.")}},n.getNbStaffLines=function(){return this.checkHasStaffData(),e.getNbStaffLines(this.staffData)},n.isTabStaff=function(){return this.checkHasStaffData(),e.isTabStaff(this.staffData)},n.getUpOverflow=function(){return-this.glyph.getBBoxNE().y-this.getPathY()}}.call(this),function(){"use strict";var a=Adagio.Brush.Elem,b=Adagio.Drawer.Line,c=.9,d=Adagio.Drawer.ending.EndingBracket=function(a){this.init(a)};d.cssClass="endingBracket";var e=d.prototype;e.cssClass=d.cssClass,e.init=function(a){this.parent=null,this.group=null,this.leftLine=null,this.middleLine=null,this.rightLine=null,this.drawingContext=null,this.width=null,this.posY=null,this.rightClosed=a},e.setParent=function(a){this.parent=a},e.createGroup=function(){this.group=new a("g"),this.group.attr("class",this.cssClass)},e.setDrawingContext=function(a){this.drawingContext=a},e.draw=function(){this.render(),this.move(),this.bindToParent()},e.bindToParent=function(){this.parent.append(this.group)},e.move=function(){var a=this.posY;this.group.attr("transform","translate(0 "+a+")")},e.render=function(){this.isRendered()||(this.createGroup(),this.renderLeftLine(),this.renderMiddleLine(),this.isRightClosed()&&this.renderRightLine())},e.isRendered=function(){return null!==this.group},e.renderLeftLine=function(){var a=this.getX1(),c=this.getY2(),d=this.drawingContext.getRepeatEndingLineThickness(),e={stroke_width:d},f=new b(this.group,e);f.render(a,0,a,c),f.draw(),this.leftLine=f},e.renderMiddleLine=function(){var a=this.getX1(),c=this.getX2(),d=this.getY2(),e=this.drawingContext.getRepeatEndingLineThickness(),f={stroke_width:e},g=new b(this.group,f);g.render(a,d,c,d),g.draw(),this.middleLine=g},e.isRightClosed=function(){return this.rightClosed},e.renderRightLine=function(){var a=this.getX2(),c=this.getY2(),d=this.drawingContext.getRepeatEndingLineThickness(),e={stroke_width:d},f=new b(this.group,e);f.render(a,c,a,0),f.draw(),this.rightLine=f},e.getX1=function(){return this.drawingContext.getThinBarlineThickness()},e.getX2=function(){var a;return a=this.isRightClosed()?this.width:this.width*c,a-=this.drawingContext.getThinBarlineThickness()},e.getY2=function(){return 2*-this.drawingContext.getSpaceSize()},e.setWidth=function(a){this.width=a},e.getWidth=function(){return this.width},e.updateDisplay=function(){this.updateWidth()},e.updateWidth=function(){if(this.isRendered()){var a=this.getX2();this.isRightClosed()&&(this.rightLine.setX1(a),this.rightLine.setX2(a)),this.middleLine.setX2(a)}},e.setPosY=function(a){this.posY=a},e.getPosX=function(){return this.posX},e.getPosY=function(){return this.posY}}.call(this),function(){"use strict";var a=Adagio.Drawer.Text,b=Adagio.Drawer.ending.EndingBracket,c=Adagio.Brush.Elem,d=2,e=Adagio.Drawer.ending.Ending=function(a,b){this.init(a,b)};e.NAME="ending";var f=e.prototype;f.name=e.NAME,f.init=function(c,d){this.group=null,this.parent=null,this.drawingContext=null,this.text=null,this.bracket=new b(d);var e={text:c};this.text=new a(e),this.hasRight=null,this.posY=null},f.setParent=function(a){this.parent=a},f.setTextStr=function(b){var c={text:b};this.text=new a(c)},f.setPosY=function(a){this.posY=a},f.setWidth=function(a){this.bracket.setWidth(a)},f.setDrawingContext=function(a){this.drawingContext=a,this.bracket.setDrawingContext(a),this.text.setDrawingContext(a);var b=this.drawingContext.getSpaceSize();this.text.setFontSize(b*d)},f.draw=function(){this.isRendered()||(this.render(),this.format()),this.drawContent(),this.move(),this.bindToParent()},f.isRendered=function(){return null!==this.group},f.render=function(){this.group=new c("g"),this.group.attr("class",this.name),this.text.setParent(this.group),this.bracket.setParent(this.group)},f.format=function(){this.formatX(),this.formatY()},f.formatX=function(){var a=this.drawingContext.getSpaceSize();this.text.setXPos(a)},f.formatY=function(){var a=this.getSpaceBelow();this.text.setYPos(-a),this.bracket.setPosY(-a)},f.function=function(){return this.drawingContext.getSpaceSize()},f.drawContent=function(){this.text.render(),this.text.setCssClass("ending.text"),this.text.draw(),this.bracket.draw()},f.move=function(){this.isRendered()&&null!==this.posY&&this.group.attr("transform","translate(0, "+this.posY+")")},f.updateVerticalDisplay=function(){this.move()},f.updateHorizontalDisplay=function(){this.bracket.updateDisplay()},f.bindToParent=function(){this.parent.append(this.group)},f.getWidth=function(){return this.bracket.getWidth()},f.getHeight=function(){return this.getSpaceAbove()+this.getSpaceBelow()},f.getSpaceAbove=function(){return this.drawingContext.getSpaceSize()*d},f.getSpaceBelow=function(){return this.drawingContext.getSpaceSize()*d/2}}.call(this),function(){"use strict";var a=Adagio.Utils.typeUtils,b=Adagio.Values.SoundType,c=Adagio.Brush.Elem,d=a.pairsToMap([{key:b.SEGNO,value:"segno"},{key:b.CODA,value:"coda"}]),e=Adagio.Drawer.JumpTag=function(a){this.init(a)},f=e.prototype;f.cssClass="jumpTag",f.init=function(a){this.group=null,this.parentGroup=null,this.drawingContext=null,this.posX=null,this.posY=null,this.glyph=null,this.jumpType=a},f.needRender=function(){return null===this.group},f.setParent=function(a){this.parentGroup=a},f.bindToParent=function(){this.parentGroup.append(this.group)},f.setDrawingContext=function(a){this.drawingContext=a},f.setPosX=function(a){this.posX=a},f.setPosY=function(a){this.posY=a},f.render=function(){this.group=new c("g"),this.group.attr("class",this.cssClass)},f.draw=function(){this.needRender()&&this.render();var a=this.getGlyph();this.drawContent(a),this.move(),this.bindToParent()},f.drawContent=function(a){this.group.append("path").attr("d",a.render())},f.getGlyphId=function(){return d[this.jumpType]},f.getGlyph=function(){if(null===this.glyph){var a=this.getGlyphId();this.glyph=this.drawingContext.getGlyph(a)}return this.glyph},f.move=function(){if(!this.needRender()){var a=this.getGlyph(),b=this.posX-a.getWidth()/2,c=this.posY;this.group.attr("transform","translate("+b+" "+c+")")}},f.getHeight=function(){return this.getGlyph().getHeight()},f.getWidth=function(){return this.getGlyph().getWidth()},f.getMarginSize=function(){return this.drawingContext.getSpaceSize()/2}}.call(this),function(){"use strict";var a=Adagio.Utils.typeUtils,b=Adagio.Values.SoundType,c=Adagio.Brush.Elem,d=Adagio.Drawer.Text,e=a.pairsToMap([{key:b.DALSEGNO,value:"dalSegno"},{key:b.DACAPO,value:"daCapo"}]),f=a.pairsToMap([{key:b.FINE,value:"Fine"},{key:b.TOCODA,value:"To Coda"}]),g=Adagio.Drawer.JumpCall=function(a){this.init(a)},h=g.prototype;h.cssClass="jumpCall",h.init=function(a){this.group=null,this.parentGroup=null,this.drawingContext=null,this.measureWidth=null,this.posY=null,this.glyph=null,this.text=null,this.jumpType=a},h.needRender=function(){return null===this.group},h.setParent=function(a){this.parentGroup=a},h.bindToParent=function(){this.parentGroup.append(this.group)},h.setDrawingContext=function(a){this.drawingContext=a,null!==this.text&&this.text.setDrawingContext(a)},h.setMeasureWidth=function(a){this.measureWidth=a},h.setPosY=function(a){this.posY=a},h.render=function(){this.group=new c("g"),this.group.attr("class",this.cssClass),null!==this.text&&this.text.setParent(this.group)},h.draw=function(){this.needRender()&&this.render(),this.drawContent(),this.move(),this.bindToParent()},h.drawContent=function(){if(this.hasGlyph()){var a=this.getGlyph();this.group.append("path").attr("d",a.render())}else if(this.hasText()){var b=this.getText();b.render(),b.draw()}},h.getGlyphId=function(){return e[this.jumpType]},h.getTextValue=function(){return f[this.jumpType]},h.getGlyph=function(){if(null===this.glyph){var a=this.getGlyphId();this.glyph=this.drawingContext.getGlyph(a)}return this.glyph},h.getText=function(){if(null===this.text){var a=new d({text:this.getTextValue(),"font-size":this.drawingContext.getJumpsFontSize()});a.setParent(this.group),a.setDrawingContext(this.drawingContext),this.text=a}return this.text},h.move=function(){if(!this.needRender()&&(this.hasGlyph()||this.hasText())){var a=this.hasGlyph()?this.getGlyph():this.getText(),b=this.measureWidth-a.getWidth(),c=this.posY;this.group.attr("transform","translate("+b+" "+c+")")}},h.getHeight=function(){if(this.hasGlyph()){return this.getGlyph().getHeight()}if(this.hasText()){return this.getText().getXHeight()}return 0},h.hasGlyph=function(){return void 0!==e[this.jumpType]},h.hasText=function(){return void 0!==f[this.jumpType]},h.getMarginSize=function(){return this.drawingContext.getSpaceSize()/2}}.call(this),function(){"use strict";var a=Adagio.Drawer.Line,b=Adagio.Brush.Elem,c=Adagio.Drawer.rehearsal.RehearsalBox=function(a,b){this.init(a,b)};c.cssClass="rehearsalBox";var d=c.prototype;d.cssClass=c.cssClass,d.init=function(a,b){this.drawingContext=null,this.parent=null,this.group=null,this.bottomLine=null,this.topLine=null,this.leftLine=null,this.rightLine=null,this.lines=[],this.width=a,this.height=b},d.setDrawingContext=function(a){this.drawingContext=a},d.setParent=function(a){this.parent=a},d.draw=function(){this.isRendered()||this.render(),this.forEachLine(e),this.bindToParent()},d.render=function(){if(!this.isRendered()){this.group=new b("g"),this.group.attr("class",this.cssClass);var c=this.drawingContext.getTextEnclosureThickness(),d={stroke_width:c};this.bottomLine=new a(this.group,d),this.bottomLine.render(0,0,this.width,0),this.lines.push(this.bottomLine),this.topLine=new a(this.group,d),this.topLine.render(0,this.height,this.width,this.height),this.lines.push(this.topLine),this.leftLine=new a(this.group,d),this.leftLine.render(0,0,0,this.height),this.lines.push(this.leftLine),this.rightLine=new a(this.group,d),this.rightLine.render(this.width,0,this.width,this.height),this.lines.push(this.rightLine)}},d.isRendered=function(){return null!==this.group},d.forEachLine=function(a,b){this.lines.forEach(a,b)};var e=function(a){a.draw()};d.bindToParent=function(){this.parent.append(this.group)},d.hide=function(){this.group.removeFromParent()}}.call(this),function(){"use strict";var a=Adagio.Drawer.Text,b=Adagio.Drawer.rehearsal.RehearsalText=function(a){this.init(a)};b.cssClass="rehearsalText";var c=b.prototype;c.cssClass=b.cssClass,c.init=function(a){this.letter=a,this.drawingContext=null,this.parent=null,this.text=null},c.setParent=function(a){this.parent=a},c.setCssClass=function(a){this.cssClass=a},c.setDrawingContext=function(a){this.drawingContext=a},c.render=function(){var b=this.drawingContext.getRehearsalFontFamily(),c=new a({"font-family":b,text:this.letter});c.setParent(this.parent),c.setDrawingContext(this.drawingContext),this.fontSize=this.drawingContext.getRehearsalFontSize(),this.padding=this.drawingContext.getRehearsalPadding(),c.setFontSize(this.fontSize),this.text=c,this.text.render(),this.text.setXPos(this.padding),this.text.setYPos(this.fontSize-1.1*this.padding)},c.draw=function(){this.isRendered()||this.render(),this.text.draw()},c.getWidth=function(){return this.isRendered()||this.render(),this.text.getWidth()+2*this.padding},c.getHeight=function(){return this.isRendered()||this.render(),this.fontSize},c.isRendered=function(){return null!==this.text},c.hide=function(){this.text.hide()}}.call(this),function(){"use strict";var a=Adagio.Brush.Elem,b=Adagio.Drawer.rehearsal.RehearsalBox,c=Adagio.Drawer.rehearsal.RehearsalText,d=Adagio.Drawer.rehearsal.Rehearsal=function(a){this.init(a)};d.cssClass="rehearsal";var e=d.prototype;e.cssClass=d.cssClass,e.init=function(a){this.letter=a,this.text=null,this.box=null,this.drawingContext=null,this.parent=null,this.group=null,this.posX=null,this.posY=null,this.drawn=!1},e.setParent=function(a){this.parent=a},e.setDrawingContext=function(a){this.drawingContext=a},e.draw=function(){this.isRendered()||this.render(),this.drawContent(),this.move(),this.bindToParent(),this.drawn=!0},e.render=function(){this.group=new a("g"),this.group.attr("class",this.name),this.createContent()},e.drawContent=function(){this.text.draw(),this.box.draw()},e.move=function(){this.isRendered()&&null!==this.posX&&null!==this.posY&&this.group.attr("transform","translate("+this.posX+", "+this.posY+")")},e.setPosX=function(a){this.posX=a},e.setPosY=function(a){this.posY=a},e.isRendered=function(){return null!==this.group},e.bindToParent=function(){this.parent.append(this.group)},e.getWidth=function(){return this.isRendered()||this.render(),this.text.getWidth()},e.getHeight=function(){return this.isRendered()||this.render(),this.text.getHeight()},e.getGroup=function(){return this.group},e.hide=function(a){this.update(a)},e.update=function(a){this.letter=(a+1).toString(),this.isRendered()&&(this.hideContent(),this.createContent()),this.drawn&&this.drawContent()},e.hideContent=function(){this.drawn&&(this.text.hide(),this.box.hide()),this.text=null,this.box=null},e.createContent=function(){this.text=new c(this.letter),this.text.setDrawingContext(this.drawingContext),this.text.setParent(this.group);var a=this.text.getWidth(),d=this.text.getHeight();this.box=new b(a,d),this.box.setDrawingContext(this.drawingContext),this.box.setParent(this.group)},e.getPreviousSpace=function(){return 2*this.drawingContext.getSpaceSize()}}.call(this),function(){"use strict";var a=Adagio.Values.MeasureLocation,b=Adagio.Values.SoundType,c=Adagio.Utils.measureUtils,d=Adagio.Utils.printedAttributesUtils,e=Adagio.Utils.attributesUtils,f=Adagio.Utils.staffUtils,g=Adagio.Utils.barlineUtils,h=Adagio.Utils.endingUtils,i=Adagio.Utils.clone,j=Adagio.Utils.staffDataUtils,k=Adagio.Utils.clefUtils,l=Adagio.Utils.mapUtils,m=Adagio.Utils.tempoUtils,n=Adagio.Utils.rehearsalUtils,o=Adagio.Utils.graceNotesBeamsMeasureUtils,p=Adagio.Data.direction.indexDirectionsByStaffIdx,q=Adagio.Render.TimeSignatureBuilder,r=Adagio.Render.KeySignatureBuilder,s=Adagio.Render.TickableContentBuilder,t=Adagio.Render.SingleContentBuilder,u=Adagio.Render.MetronomeBuilder,v=Adagio.Render.AttrsData,w=Adagio.Render.groupVoicesNotes,x=Adagio.Render.formatVoiceNotes,y=Adagio.Render.AdjacentMeasureData,z=Adagio.Render.TempoChangeAnchorsBuilder,A=Adagio.Drawer.Measure,B=Adagio.Drawer.barline.Barline,C=Adagio.Drawer.AttributesSet,D=Adagio.Drawer.Clef,E=Adagio.Drawer.ending.Ending,F=Adagio.Drawer.JumpTag,G=Adagio.Drawer.JumpCall,H=Adagio.Drawer.rehearsal.Rehearsal,I=Adagio.Render.MeasureRenderer=function(a){this.init(a)},J=I.prototype;J.init=function(a){this.displayOpts=a||{},this.timeSignatureBuilder=new q,this.keySignatureBuilder=new r,this.metronomeBuilder=new u,this.tickableContentBuilder=new s,this.singleContentBuilder=new t,this.tempoChangeAnchorsBuilder=new z},J.renderMeasure=function(a){return this.shapeMeasureData(a),this.extractMeasureData(a),this.createMeasureStaves(),this.measureStaves},J.shapeMeasureData=function(a){var b=a.current;o.shapeMeasure(this.displayOpts,b)},J.extractMeasureData=function(a){if(this.measureData=a.current,this.previousMeasure=a.previous,this.nextMeasure=a.next,this.displayedTime=a.displayedTime,this.previousDisplayedTime=a.previousDisplayedTime,this.staffMapping=a.staffMapping,this.nbMmr=a.nbMmr,null===a.nbMmr){var b=this.getNotes();this.notesByStaff=f.groupStaves(b)}this.extractLeftAttrsByMeasurePos(),this.extractRightAttributes(),this.extractDirections(),this.attrs=c.getAttributes(a.current),this.barlinesData=c.getBarlines(a.current),this.nbStaves=e.getNbStaves(this.attrs),this.staffDetails=c.getWrappedStaffDetails(a.current),a.isFirstPart&&null!==a.ownTempo?this.ownTempo=a.ownTempo:this.ownTempo=null,a.isFirstPart&&null!==a.rehearsal?this.rehearsal=a.rehearsal:this.rehearsal=null,a.isFirstPart&&null!==a.ending?this.ending=a.ending:this.ending=null,a.isFirstPart&&null!==a.jumpTag?this.jumpTag=a.jumpTag:this.jumpTag=null,a.isFirstPart&&null!==a.jumpCall?this.jumpCall=a.jumpCall:this.jumpCall=null,a.isFirstPart&&null!==a.tempoChanges?this.tempoChanges=a.tempoChanges:this.tempoChanges=null,a.isFirstPart&&null!==a.leftTempoChange?this.leftTempoChange=a.leftTempoChange:this.leftTempoChange=null,a.isFirstPart&&null!==a.rightTempoChange?this.rightTempoChange=a.rightTempoChange:this.rightTempoChange=null,this.attrsData=null,null!==this.previousMeasure?this.previousMeasureData=new y(this.previousMeasure):this.previousMeasureData=null,null!==this.nextMeasure?this.nextMeasureData=new y(this.nextMeasure):this.nextMeasureData=null},J.getNotes=function(){return this.displayOpts.isConcertPitch?c.getConcertNotes(this.measureData):c.getNotes(this.measureData)},J.extractLeftAttrsByMeasurePos=function(){this.leftAttrsByMeasurePos={};var b=c.getAttributes(this.measureData);b=i(b);var f=this.getKeys(this.measureData);e.setKey(b,f),e.setTime(b,this.displayedTime);var g;if(g=d.extractFromFirstMeasureOfScore(b),this.leftAttrsByMeasurePos[a.FIRST_OF_SCORE]=K(g),!this.isFirstMeasure()){var h=c.getAttributes(this.previousMeasure);h=i(h);var j=this.getKeys(this.previousMeasure);e.setKey(h,j),e.setTime(h,this.previousDisplayedTime),g=d.extractFromMiddleMeasure(b,h),this.leftAttrsByMeasurePos[a.OTHER]=K(g),g=d.extractFromFirstMeasureOfLine(b,h),this.leftAttrsByMeasurePos[a.FIRST_OF_LINE]=K(g)}},J.getKeys=function(a){if(this.displayOpts.isConcertPitch)return c.getConcertKeys(a);var b=c.getAttributes(a);return e.getKey(b)},J.extractRightAttributes=function(){var a=null;null!==this.nextMeasure&&(a=c.getAttributes(this.nextMeasure));var b=c.getAttributes(this.measureData);this.rightAttributes=d.extractRightAttributes(b,a)},J.extractDirections=function(){var a=c.getWedgeDirections(this.measureData);this.directionsByStaffIdx=p(a)},J.isFirstMeasure=function(){return null===this.previousMeasure};var K=function(a){return{clef:e.getWrappedClef(a),key:e.getWrappedKey(a),time:e.getWrappedTime(a)}};J.createMeasureStaves=function(){for(this.measureStaves=[],this.staffIdx=0;this.staffIdx<this.nbStaves;this.staffIdx++)this.createMeasureStaff(),this.measureStaves.push(this.measureStaff)},J.createMeasureStaff=function(){this.measureStaff=new A(null),null===this.nbMmr?this.createTickableContent():this.createMmrContent(),this.createLeftAttrs(),this.createRightAttrs(),this.createBarlines(),this.createStaffData(),0===this.staffIdx&&null!==this.ownTempo&&this.createMetronome(),0===this.staffIdx&&null!==this.rehearsal&&this.createRehearsal(),0===this.staffIdx&&null!==this.ending&&this.createEnding(),0===this.staffIdx&&null!==this.jumpTag&&this.createJumpTag(),0===this.staffIdx&&null!==this.jumpCall&&this.createJumpCall(),0===this.staffIdx&&this.createTempoChanges()},J.createTickableContent=function(){var a=this.getVoicesData(),b=this.getStaffNotes(),c=w(b);c=l.map(c,x);var d=this.getAttrsData(),e=this.getStaffDirections(),f=this.tickableContentBuilder.build(c,e,this.measureData,d,this.staffIdx,this.displayOpts,this.previousMeasureData,this.nextMeasureData,a);this.measureStaff.setTickableContent(f)},J.getStaffNotes=function(){return this.notesByStaff[this.staffIdx]},J.getStaffDirections=function(){return void 0!==this.directionsByStaffIdx[this.staffIdx]?this.directionsByStaffIdx[this.staffIdx]:[]},J.createMmrContent=function(){var a=this.getVoicesData(),b=this.getAttrsData(),c=this.singleContentBuilder.build(this.nbMmr,this.measureData,b,this.staffIdx,this.displayOpts,this.previousMeasureData,this.nextMeasureData,a);this.measureStaff.setTickableContent(c)},J.getVoicesData=function(){return this.isTabStaff()?this.staffMapping[0]:this.staffMapping[this.staffIdx]},J.createLeftAttrs=function(){for(var a in this.leftAttrsByMeasurePos)this.currentAttrsToDisplay=this.leftAttrsByMeasurePos[a],this.attributesSet=new C,this.measureStaff.addAttributes(a,this.attributesSet),this.createClefIfNeeded(),this.createKeySignatureIfNeeded(),this.createTimeSignatureIfNeeded()},J.isTabStaff=function(){var a=this.getClef();return k.isTab(a)},J.createClefIfNeeded=function(){var a=this.currentAttrsToDisplay.clef;if(a.hasEntry(this.staffIdx)){var b=a.getEntry(this.staffIdx),c=new D(b);this.attributesSet.setClef(c)}},J.createKeySignatureIfNeeded=function(){var a=this.currentAttrsToDisplay.key;if(a.hasEntry(this.staffIdx)){var b=a.getEntry(this.staffIdx),c=this.getClef(),d=this.createKeySignature(b,c);this.attributesSet.setKey(d)}},J.createKeySignature=function(a,b){return this.keySignatureBuilder.build(a,b)},J.getClef=function(){return this.getAttrsData().getClef(this.staffIdx)},J.createTimeSignatureIfNeeded=function(){var a=this.currentAttrsToDisplay.time;if(a.hasEntry(this.staffIdx)&&!this.isTabStaff()){var b=a.getEntry(this.staffIdx),c=this.createTimeSignature(b);this.attributesSet.setTime(c)}},J.createTimeSignature=function(a){return this.timeSignatureBuilder.build(a)},J.createRightAttrs=function(){var a=new C;this.measureStaff.setRightAttributes(a);var b=e.getWrappedClef(this.rightAttributes);if(b.hasEntry(this.staffIdx)){var c=b.getEntry(this.staffIdx),d=new D(c);a.setClef(d)}},J.createBarlines=function(){if(c.hasLeftBarline(this.measureData)){var a=c.getLeftBarline(this.measureData),b=new B(a);this.measureStaff.setLeftBarline(b)}var d;d=c.hasRightBarline(this.measureData)?c.getRightBarline(this.measureData):g.createDefaultBarline();var e=new B(d);this.measureStaff.setRightBarline(e)},J.createMetronome=function(){var a=m.getBpm(this.ownTempo),b="= "+a,c=m.getDurationType(this.ownTempo),d=m.getNbDots(this.ownTempo),e=this.metronomeBuilder.build(c,d,b);this.measureStaff.setMetronome(e)},J.createRehearsal=function(){var a=n.getText(this.rehearsal),b=new H(a);this.measureStaff.setRehearsal(b),n.isMeasureNumber(this.rehearsal)&&this.measureStaff.setMeasureNumber(b)},J.createEnding=function(){var a=h.numbersToText(this.ending),b=c.hasRightSpecificBarline(this.measureData),d=new E(a,b);this.measureStaff.setEnding(d)},J.createJumpTag=function(){var a=new F(this.jumpTag);this.measureStaff.setJumpTag(a),this.jumpTag===b.CODA&&this.measureStaff.setHasSystemBreakBefore(!0)},J.createJumpCall=function(){var a=new G(this.jumpCall);this.measureStaff.setJumpCall(a)},J.createTempoChanges=function(){var a=c.getDpq(this.measureData);this.tempoChangeAnchorsBuilder.build(this.measureStaff,a,this.tempoChanges,this.leftTempoChange,this.rightTempoChange)},J.createStaffData=function(){var a=this.staffDetails.getEntry(this.staffIdx),b=j.createFromStaffDetails(a);this.measureStaff.setStaffData(b)},J.getAttrsData=function(){return null===this.attrsData&&(this.attrsData=new v(this.attrs)),this.attrsData}}.call(this),function(){"use strict";var a=Adagio.formatter.vertical.alignStaffContent;Adagio.formatter.vertical.alignStaff=function(d){var e=d.getWedges(),f=d.getAllSlurs(),g=d.getMeasures();a(g,e,f);var h=g[0];b(d,h),c(d,g)};var b=function(a,b){var c=b.getHeight();a.setHeight(c);var d=b.getSpaceAboveStaff();a.setSpaceAbove(d);var e=b.getSpaceBelowStaff();a.setSpaceBelow(e)},c=function(a,b){var c=d(b);a.setLyricsUpY(c)},d=function(a){var b=a.find(e);return void 0!==b?b.getLyricsUpY():null},e=function(a){return a.hasLyrics()}}.call(this),function(){"use strict";var a=Adagio.Drawer.tie.TieArc,b=Adagio.Drawer.tie.TieDisplayData,c=Adagio.Drawer.tie.tieOffset,d=Adagio.Drawer.tie.TieType,e=Adagio.Drawer.NoteDisplayData,f=Adagio.Brush.Elem,g=Adagio.Utils.geometryUtils,h=Adagio.Utils.math,i=Adagio.Utils.clone,j=Adagio.Utils.staffDataUtils,k=Adagio.Drawer.tie.LeftTie=function(a){this.init(a)};k.cssClass="tie";var l=k.prototype;l.cssClass=k.cssClass,l.init=function(a){this.arcs=null,this.anchor=a,a.tie=this,this.displayData=new b,this.drawingContext=null,this.parent=null,this.svgGroup=new f("g"),this.svgGroup.attr("class",this.cssClass),this.needDrawUpdate=!0,this.drawn=!1},l.setParent=function(a){this.parent=a},l.setDrawingContext=function(a){this.drawingContext=a},l.getArcs=function(){return null===this.arcs&&this.initArcs(),this.arcs},l.initArcs=function(){var a=this.anchor.note,b=a.getDisplayData(),c=i(b.opts);c.tieStarts=c.tieStops.slice();var d=new e(c),f=b.getBeamData();d.setBeamData(f),this.displayData.setLeftNote(d),this.displayData.setRightNote(b),this.displayData.fillData(),this.arcs=[],this.displayData.forEachTie(this.initArc,this)},l.initArc=function(b){var d=0,e=this.anchor.note.getMiddleHeadWidth(),f=c.getRight(b,e),g=0,h=new a(this.getGroup(),d,f,b.placement,g),i=j.getNbStaffLines(b.staffData),k=j.isTabStaff(b.staffData),l=this.lineToY(b.line,k,i);l+=c.getVertical(b,this.drawingContext),h.setPosY(l),h.setDrawingContext(this.drawingContext),this.arcs.push(h)},l.lineToY=function(a,b,c){var d=b?this.drawingContext.getTabSpaceSize():this.drawingContext.getSpaceSize();return g.lineToY(a,d,c)},l.updateArcs=function(){this.getArcs().forEach(this.updateArc,this),this.needDrawUpdate=!1},l.updateArc=function(a){var b=this.anchor.note,c=this.anchor.measure,d=c.tickableContent,e=c.getXPos()+d.getXPos(),f=e-d.getPreviousSpace(),g=this.drawingContext.getTieHorizontalMargin(),h=e+b.getXPos()-g,i=h-f,j=o(),k=j(i);a.setSize(i,k),a.setPosX(f)},l.setNeedDrawUpdate=function(){this.needDrawUpdate=!0},l.draw=function(){this.needDrawUpdate&&this.updateArcs(),this.getArcs().forEach(m),this.bindToParent()};var m=function(a){a.draw()};l.bindToParent=function(){null!==this.parent&&(this.parent.append(this.getGroup()),this.drawn=!0)},l.getGroup=function(){return this.svgGroup},l.erase=function(){this.anchor.tie=null,this.drawn&&this.unbindFromParent()},l.unbindFromParent=function(){this.svgGroup.removeFromParent(),this.drawn=!1},l.getType=function(){return d.LEFT},l.isComplete=function(){return!0};var n=null,o=function(){if(null===n){var a=3,b=2/3,c=30,d=2,e=h.solveLinearA(a,b,c,d),f=h.solveLinearB(a,b,e);n=function(a){return e*a+f}}return n};l.getTopY=function(){var a=this.getTopArc(),b=a.getTopY();return a.posY+b},l.getTopArc=function(){return this.getArcs()[0]},l.getBottomY=function(){var a=this.getBottomArc(),b=a.getBottomY();return a.posY+b},l.getBottomArc=function(){var a=this.getArcs();return a[a.length-1]}}.call(this),function(){"use strict";var a=Adagio.Drawer.tie.TieArc,b=Adagio.Drawer.tie.TieDisplayData,c=Adagio.Drawer.tie.tieOffset,d=Adagio.Drawer.tie.TieType,e=Adagio.Drawer.NoteDisplayData,f=Adagio.Brush.Elem,g=Adagio.Utils.geometryUtils,h=Adagio.Utils.math,i=Adagio.Utils.clone,j=Adagio.Utils.staffDataUtils,k=Adagio.Drawer.tie.RightTie=function(a){this.init(a)};k.cssClass="tie";var l=k.prototype;l.cssClass=k.cssClass,l.init=function(a){this.arcs=null,this.anchor=a,a.tie=this,this.displayData=new b,this.drawingContext=null,this.parent=null,this.svgGroup=new f("g"),this.svgGroup.attr("class",this.cssClass),this.needDrawUpdate=!0,this.drawn=!1},l.setParent=function(a){this.parent=a},l.setDrawingContext=function(a){this.drawingContext=a},l.getArcs=function(){return null===this.arcs&&this.initArcs(),this.arcs},l.initArcs=function(){var a=this.anchor.note,b=a.getDisplayData(),c=i(b.opts);c.tieStops=c.tieStarts.slice();var d=new e(c),f=b.getBeamData();d.setBeamData(f),
this.displayData.setLeftNote(b),this.displayData.setRightNote(d),this.displayData.fillData(),this.arcs=[],this.displayData.forEachTie(this.initArc,this)},l.initArc=function(b){var d=0,e=this.anchor.note.getMiddleHeadWidth(),f=c.getLeft(b,e),g=0,h=new a(this.getGroup(),f,d,b.placement,g),i=j.getNbStaffLines(b.staffData),k=j.isTabStaff(b.staffData),l=this.lineToY(b.line,k,i);l+=c.getVertical(b,this.drawingContext),h.setPosY(l),h.setDrawingContext(this.drawingContext),this.arcs.push(h)},l.lineToY=function(a,b,c){var d=b?this.drawingContext.getTabSpaceSize():this.drawingContext.getSpaceSize();return g.lineToY(a,d,c)},l.updateArcs=function(){this.getArcs().forEach(this.updateArc,this),this.needDrawUpdate=!1},l.updateArc=function(a){var b=this.anchor.note,c=this.anchor.measure,d=c.tickableContent,e=c.getXPos()+d.getXPos(),f=e+d.getWidth(),g=this.drawingContext.getTieHorizontalMargin(),h=e+b.getXPos()+g,i=f-h,j=o(),k=j(i);a.setSize(i,k),a.setPosX(h)},l.setNeedDrawUpdate=function(){this.needDrawUpdate=!0},l.draw=function(){this.needDrawUpdate&&this.updateArcs(),this.getArcs().forEach(m),this.bindToParent()};var m=function(a){a.draw()};l.bindToParent=function(){null!==this.parent&&(this.parent.append(this.getGroup()),this.drawn=!0)},l.getGroup=function(){return this.svgGroup},l.erase=function(){this.anchor.tie=null,this.drawn&&this.unbindFromParent()},l.unbindFromParent=function(){this.svgGroup.removeFromParent(),this.drawn=!1},l.getType=function(){return d.RIGHT},l.isComplete=function(){return!0};var n=null,o=function(){if(null===n){var a=3,b=2/3,c=30,d=2,e=h.solveLinearA(a,b,c,d),f=h.solveLinearB(a,b,e);n=function(a){return e*a+f}}return n};l.getTopY=function(){var a=this.getTopArc(),b=a.getTopY();return a.posY+b},l.getTopArc=function(){return this.getArcs()[0]},l.getBottomY=function(){var a=this.getBottomArc(),b=a.getBottomY();return a.posY+b},l.getBottomArc=function(){var a=this.getArcs();return a[a.length-1]}}.call(this),function(){"use strict";var a=Adagio.Drawer.tie.TieArc,b=Adagio.Drawer.tie.TieDisplayData,c=Adagio.Drawer.tie.TieType,d=Adagio.Drawer.tie.tieOffset,e=Adagio.Brush.Elem,f=Adagio.Utils.geometryUtils,g=Adagio.Utils.math,h=Adagio.Utils.staffDataUtils,i=Adagio.Drawer.tie.CrossMeasureTie=function(){this.init()};i.cssClass="tie";var j=i.prototype;j.cssClass=i.cssClass,j.init=function(){this.arcs=null,this.leftAnchor=null,this.rightAnchor=null,this.displayData=null,this.drawingContext=null,this.parent=null,this.svgGroup=new e("g"),this.svgGroup.attr("class",this.cssClass),this.needDrawUpdate=!0,this.drawn=!1},j.setParent=function(a){this.parent=a},j.setLeftAnchor=function(a){this.hasLeftAnchor()&&this.leftAnchor!==a&&this.removeLeftAnchor(),this.leftAnchor=a,this.leftAnchor.tie=this},j.hasLeftAnchor=function(){return null!==this.leftAnchor},j.removeLeftAnchor=function(){this.discardArcs(),this.leftAnchor.tie=null,this.leftAnchor=null},j.setRightAnchor=function(a){this.hasRightAnchor()&&this.rightAnchor!==a&&this.removeRightAnchor(),this.rightAnchor=a,this.rightAnchor.tie=this},j.hasRightAnchor=function(){return null!==this.rightAnchor},j.removeRightAnchor=function(){this.discardArcs(),this.rightAnchor.tie=null,this.rightAnchor=null},j.discardArcs=function(){this.displayData=null,null!==this.arcs&&(this.arcs.forEach(k),this.arcs=null),this.needDrawUpdate=!0};var k=function(a){a.erase()};j.setDrawingContext=function(a){this.drawingContext=a},j.getArcs=function(){return null===this.arcs&&this.initArcs(),this.arcs},j.initArcs=function(){this.displayData=new b;var a=this.rightAnchor.note;this.displayData.setRightNote(a.getDisplayData());var c=this.leftAnchor.note;this.displayData.setLeftNote(c.getDisplayData()),this.displayData.fillData(),this.arcs=[],this.displayData.forEachTie(this.initArc,this)},j.initArc=function(b){var c=this.leftAnchor.note,e=c.getMiddleHeadWidth(),f=d.getLeft(b,e),g=this.rightAnchor.note,i=g.getMiddleHeadWidth(),j=d.getRight(b,i),k=d.getVertical(b,this.drawingContext),l=h.getNbStaffLines(b.staffData),m=h.isTabStaff(b.staffData),n=this.lineToY(b.line,m,l)+k,o=this.lineToY(b.rightLine,m,l)+k,p=o-n,q=new a(this.getGroup(),f,j,b.placement,p);q.setPosY(n),q.setDrawingContext(this.drawingContext),this.arcs.push(q)},j.lineToY=function(a,b,c){var d=b?this.drawingContext.getTabSpaceSize():this.drawingContext.getSpaceSize();return f.lineToY(a,d,c)},j.updateArcs=function(){this.getArcs().forEach(this.updateArc,this),this.needDrawUpdate=!1},j.updateArc=function(a){var b=this.drawingContext.getTieHorizontalMargin(),c=this.getLeftOffset(),d=this.leftAnchor.note,e=d.getXPos()+b+c,f=this.getRightOffset(),g=this.rightAnchor.note,h=g.getXPos()-b+f,i=h-e,j=n(),k=j(i);a.setSize(i,k),a.setPosX(e)},j.getLeftOffset=function(){var a=this.leftAnchor.measure,b=a.tickableContent;return a.getXPos()+b.getXPos()},j.getRightOffset=function(){var a=this.rightAnchor.measure,b=a.tickableContent;return a.getXPos()+b.getXPos()},j.setNeedDrawUpdate=function(){this.needDrawUpdate=!0},j.draw=function(){this.needDrawUpdate&&this.updateArcs(),this.getArcs().forEach(l),this.bindToParent()};var l=function(a){a.draw()};j.bindToParent=function(){null!==this.parent&&(this.parent.append(this.getGroup()),this.drawn=!0)},j.getGroup=function(){return this.svgGroup},j.erase=function(){this.drawn&&this.unbindFromParent(),this.hasLeftAnchor()&&this.removeLeftAnchor(),this.hasRightAnchor()&&this.removeRightAnchor()},j.unbindFromParent=function(){this.svgGroup.removeFromParent(),this.drawn=!1},j.getType=function(){return c.CROSS_MEASURE},j.isComplete=function(){return this.hasLeftAnchor()&&this.hasRightAnchor()};var m=null,n=function(){if(null===m){var a=3,b=2/3,c=30,d=2,e=g.solveLinearA(a,b,c,d),f=g.solveLinearB(a,b,e);m=function(a){return e*a+f}}return m};j.getTopY=function(){var a=this.getTopArc(),b=a.getTopY();return a.posY+b},j.getTopArc=function(){return this.getArcs()[0]},j.getBottomY=function(){var a=this.getBottomArc(),b=a.getBottomY();return a.posY+b},j.getBottomArc=function(){var a=this.getArcs();return a[a.length-1]}}.call(this),function(){"use strict";var a=Adagio.Drawer.tie.LeftTie,b=Adagio.Drawer.tie.RightTie,c=Adagio.Drawer.tie.CrossMeasureTie,d=Adagio.Drawer.tie.TieType,e=Adagio.Drawer.tie.TiesLinkerLax=function(){},f=e.prototype;f.reset=function(a){this.pendingTie=null,this.ties=[],this.voiceIdx=a},f.updateMeasuresTies=function(a,b){return this.reset(b),a.forEach(this.updateMeasureTies,this),this.ties=this.ties.filter(j),this.ties},f.updateMeasureTies=function(a,b,c){var d=0===b,e=b===c.length-1;a.hasLeftTieAnchor(this.voiceIdx)&&this.updateLeftAnchor(a.getLeftTieAnchor(this.voiceIdx),d),a.hasRightTieAnchor(this.voiceIdx)&&this.updateRightAnchor(a.getRightTieAnchor(this.voiceIdx),e)},f.updateLeftAnchor=function(a,b){b?(g(a),this.addLeftTie(a)):(i(a),this.closePending(a))};var g=function(a){if(a.hasTie()){a.getTie().getType()===d.CROSS_MEASURE&&a.removeTie()}};f.addLeftTie=function(b){var c;c=b.hasTie()?b.getTie():new a(b),this.ties.push(c)},f.closePending=function(a){if(this.hasPendingTie()){this.removeTieIfDifferentFromPending(a);var b=this.getPendingTie();a.hasTie()||b.setRightAnchor(a),this.ties.push(b),this.pendingTie=null}else a.hasTie()&&a.removeTie()},f.removeTieIfDifferentFromPending=function(a){if(a.hasTie()){a.getTie()!==this.getPendingTie()&&a.removeTie()}},f.getPendingTie=function(){return this.pendingTie},f.hasPendingTie=function(){return null!==this.pendingTie},f.updateRightAnchor=function(a,b){b?(h(a),this.addRightTie(a)):(i(a),this.openPendingTie(a))};var h=function(a){if(a.hasTie()){var b=a.getTie();b.getType()===d.CROSS_MEASURE&&b.erase()}};f.addRightTie=function(a){var c;c=a.hasTie()?a.getTie():new b(a),this.ties.push(c)};var i=function(a){if(a.hasTie()){var b=a.getTie();b.getType()!==d.CROSS_MEASURE&&b.erase()}};f.openPendingTie=function(a){this.hasPendingTie()&&this.discardPendingTie();var b;a.hasTie()?b=a.getTie():(b=new c,b.setLeftAnchor(a)),this.pendingTie=b},f.discardPendingTie=function(){this.pendingTie.erase(),this.pendingTie=null};var j=function(a){return!!a.isComplete()||(a.erase(),!1)}}.call(this),function(){"use strict";var a=Adagio.Drawer.tie.TiesLinkerLax,b=Adagio.Brush.Elem,c=Adagio.Drawer.tie.StaffTies=function(a){this.init(a)};c.cssClass="staffTies";var d=c.prototype;d.cssClass=c.cssClass,d.init=function(b){this.voiceIdx=b,this.tiesLinker=new a,this.ties=[],this.drawingContext=null,this.posY=null,this.staffData=null,this.parent=null,this.group=null},d.updateMeasuresTies=function(a){this.ties=this.tiesLinker.updateMeasuresTies(a,this.voiceIdx),this.ties.forEach(this.transferDrawingContext,this),this.isRendered()&&this.ties.forEach(this.transfertParent,this)},d.transfertParent=function(a){a.setParent(this.group)},d.removeMeasure=function(a){if(a.hasLeftTieAnchor(this.voiceIdx)){var b=a.getLeftTieAnchor(this.voiceIdx);b.hasLeftTie()?this.removeTie(b.getTie()):b.hasCrossMeasureTie()&&b.removeTie()}if(a.hasRightTieAnchor(this.voiceIdx)){var c=a.getRightTieAnchor(this.voiceIdx);c.hasTie()&&this.removeTie(c.getTie())}},d.removeTie=function(a){var b=this.ties.indexOf(a);this.ties.splice(b,1),a.erase()},d.setDrawingContext=function(a){this.drawingContext=a,this.ties.forEach(this.transferDrawingContext,this)},d.transferDrawingContext=function(a){a.setDrawingContext(this.drawingContext)},d.setParent=function(a){this.parent=a},d.setPosition=function(a){this.posY=a},d.setStaffData=function(a){this.staffData=a},d.draw=function(){this.renderIfNeeded(),this.ties.forEach(f),this.move(),this.bindToParent()},d.renderIfNeeded=function(){this.isRendered()||this.render()},d.isRendered=function(){return null!==this.group},d.render=function(){this.group=new b("g"),this.group.attr("class",this.cssClass),this.ties.forEach(this.transfertParent,this)},d.move=function(){this.isRendered()&&this.group.attr("transform","translate(0, "+this.posY+")")},d.bindToParent=function(){null!==this.parent&&this.parent.append(this.group)},d.updateHorizontalDisplay=function(){this.ties.forEach(e)};var e=function(a){a.draw()},f=function(a){a.draw()}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Drawer.hyphen.Hyphen,c=Adagio.Drawer.hyphen.connectionToPosition,d=Adagio.Brush.Elem,e=Adagio.Utils.mapUtils,f=Adagio.Drawer.hyphen.CrossMeasureHyphen=function(){this.init()};f.cssClass="crossMeasureHyphen";var g=f.prototype;g.cssClass=f.cssClass,g.init=function(){this.leftAnchor=null,this.rightAnchor=null,this.hyphens={},this.drawingContext=null,this.parent=null,this.svgGroup=null,this.needDrawUpdate=!0,this.drawn=!1},g.setParent=function(a){this.parent=a},g.setLeftAnchor=function(a){this.hasLeftAnchor()&&this.leftAnchor!==a&&this.removeLeftAnchor(),this.leftAnchor=a,this.leftAnchor.hyphen=this},g.setRightAnchor=function(a){this.hasRightAnchor()&&this.rightAnchor!==a&&this.removeRightAnchor(),this.rightAnchor=a,this.rightAnchor.hyphen=this},g.setDrawingContext=function(a){this.drawingContext=a,this.isRendered()&&this.forEachHyphen(this.dispatchDrawingContext,this)},g.dispatchDrawingContext=function(a,b){b.setDrawingContext(this.drawingContext)},g.setNeedDrawUpdate=function(){this.needDrawUpdate=!0},g.isComplete=function(){return this.hasLeftAnchor()&&this.hasRightAnchor()},g.erase=function(){this.hide(),this.hasLeftAnchor()&&this.removeLeftAnchor(),this.hasRightAnchor()&&this.removeRightAnchor()},g.hasLeftAnchor=function(){return null!==this.leftAnchor},g.hasRightAnchor=function(){return null!==this.rightAnchor},g.removeLeftAnchor=function(){this.hide(),this.leftAnchor.hyphen=null,this.leftAnchor=null},g.removeRightAnchor=function(){this.hide(),this.rightAnchor.hyphen=null,this.rightAnchor=null},g.hide=function(){this.drawn&&this.unbindFromParent()},g.unbindFromParent=function(){this.svgGroup.removeFromParent(),this.drawn=!1},g.getLeftMeasureIdx=function(){return this.getLeftAnchor().getMeasureIdx()},g.getRightMeasureIdx=function(){return this.getRightAnchor().getMeasureIdx()},g.updateHorizontalDisplay=function(){this.isRendered()||this.render(),this.needDrawUpdate&&(this.updateHyphens(),this.updateHyphensHorizontal()),this.drawHyphens(),this.bindToParent()},g.updateHyphens=function(){var a=this.computeConnections();this.removeUnreferencedHyphens(a),this.addMissingHyphens(a);var b=e.map(a,c);this.updateHyphensPositions(b)},g.computeConnections=function(){var a={};return this.getLeftAnchor().getLevels().forEach(h,a),this.getRightAnchor().getLevels().forEach(i,a),a};var h=function(a){j(this,a).left=!0},i=function(a){j(this,a).right=!0},j=function(a,b){return void 0===a[b]&&(a[b]={left:!1,right:!1}),a[b]};g.removeUnreferencedHyphens=function(a){for(var b in this.hyphens)if(void 0===a[b]){var c=this.hyphens[b];c.erase(),delete this.hyphens[b]}},g.addMissingHyphens=function(a){for(var c in a)if(void 0===this.hyphens[c]){var d=null,e=new b(d);e.setDrawingContext(this.drawingContext),e.setParent(this.svgGroup),this.hyphens[c]=e}},g.updateHyphensPositions=function(a){e.forEach(a,this.updateHyphenPosition,this)},g.updateHyphenPosition=function(a,b){this.hyphens[a].setPosition(b)},g.updateHyphensHorizontal=function(){this.forEachHyphen(this.updateHyphenHorizontal,this),this.needDrawUpdate=!1},g.updateHyphenHorizontal=function(a,b){var c=this.getLeftAnchor(),d=c.getX(a),e=this.getRightAnchor(),f=e.getX(a),g=f-d;b.setWidth(g),b.setPosX(d)},g.updateVerticalDisplay=function(){this.isRendered()||this.render(),this.updateHyphensVertical(),this.drawHyphens(),this.bindToParent()},g.isRendered=function(){return null!==this.svgGroup},g.render=function(){this.svgGroup=new d("g"),this.svgGroup.attr("class",this.cssClass)},g.updateHyphensVertical=function(){this.forEachHyphen(this.updateHyphenVertical,this)},g.updateHyphenVertical=function(a,b){var c=this.getLevelPosY(a);b.setPosY(c)},g.getLevelPosY=function(b){var c=this.getLeftAnchor(),d=this.getRightAnchor();if(c.hasLyricLevel(b))return c.getLyricLevelPosY(b);if(d.hasLyricLevel(b))return d.getLyricLevelPosY(b);throw new a("Unexpected","There should be at least one lyric side at the level ["+b+"].")},g.getLeftAnchor=function(){return this.leftAnchor},g.getRightAnchor=function(){return this.rightAnchor},g.drawHyphens=function(){this.forEachHyphen(k)},g.forEachHyphen=function(a,b){e.forEach(this.hyphens,a,b)};var k=function(a,b){b.draw()};g.draw=function(){this.bindToParent()},g.bindToParent=function(){null!==this.parent&&(this.parent.append(this.getGroup()),this.drawn=!0)},g.getGroup=function(){return this.svgGroup}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Drawer.hyphen.CrossMeasureHyphen,c=Adagio.Drawer.hyphen.HyphenPos,d=Adagio.Drawer.hyphen.HyphenAnchor,e=Adagio.Drawer.hyphen.HyphensLinkerLax=function(){},f=e.prototype;f.reset=function(a,b,c,d){this.pendingHyphen=null,this.hyphens=[],this.anchors=[],this.currentMeasureIdx=null,this.leftContinueAnchor=b,this.rightContinueAnchor=c,this.voiceIdx=d;var e=a[0];this.leftContinueAnchor.setMeasure(e);var f=a.length,g=a[f-1];this.rightContinueAnchor.setMeasure(g)},f.updateMeasuresHyphens=function(a,b,c,d){return this.reset(a,b,c,d),this.parseFirstHyphenAnchor(a),this.parseMeasuresHyphenAnchors(a),this.parseLastHyphenAnchor(a),this.createHyphens(),this.hyphens},f.parseFirstHyphenAnchor=function(a){var b=0,c=a[b];if(c.hasLeftHyphenAnchor(this.voiceIdx)){this.addAnchor(this.leftContinueAnchor,b);var d=c.getLeftHyphenAnchor(this.voiceIdx);this.addAnchor(d,b)}},f.parseMeasuresHyphenAnchors=function(a){for(var b=a.length,c=0;c+1<b;c++){this.currentMeasureIdx=c;var d=a[c],e=a[c+1];this.parseMeasureHyphenAnchors(d,e)}},f.parseMeasureHyphenAnchors=function(a,b){this.hasConnection(a,b)&&(a.hasRightHyphenAnchor(this.voiceIdx)?this.addAnchor(a.getRightHyphenAnchor(this.voiceIdx),this.currentMeasureIdx):this.addFakeLeftAnchor(a,this.currentMeasureIdx),b.hasLeftHyphenAnchor(this.voiceIdx)?this.addAnchor(b.getLeftHyphenAnchor(this.voiceIdx),this.currentMeasureIdx+1):this.addFakeRightAnchor(b,this.currentMeasureIdx+1))},f.hasConnection=function(a,b){return a.hasRightHyphenAnchor(this.voiceIdx)||b.hasLeftHyphenAnchor(this.voiceIdx)},f.addFakeLeftAnchor=function(a,b){var e=null,f=new d(e,c.LEFT);f.setMeasure(a),this.addAnchor(f,b)},f.addFakeRightAnchor=function(a,b){var e=null,f=new d(e,c.RIGHT);f.setMeasure(a),this.addAnchor(f,b)},f.parseLastHyphenAnchor=function(a){var b=a.length-1,c=a[b];if(c.hasRightHyphenAnchor(this.voiceIdx)){var d=c.getRightHyphenAnchor(this.voiceIdx);this.addAnchor(d,b),this.addAnchor(this.rightContinueAnchor,b)}},f.addAnchor=function(a,b){a.setMeasureIdx(b),this.anchors.push(a)},f.createHyphens=function(){this.anchors.forEach(this.useAnchor,this),this.hasPendingHyphen()&&this.discardPendingHyphen()},f.useAnchor=function(b){if(b.isLeft())this.openPendingHyphen(b);else{if(!b.isRight(b))throw new a("Unexpected");this.closePending(b)}},f.openPendingHyphen=function(a){this.hasPendingHyphen()&&this.discardPendingHyphen();var c;a.hasHyphen()?c=a.getHyphen():(c=new b,c.setLeftAnchor(a)),this.pendingHyphen=c},f.discardPendingHyphen=function(){this.pendingHyphen.erase(),this.pendingHyphen=null},f.closePending=function(a){if(this.hasPendingHyphen()){this.removeHyphenIfDifferentFromPendinf(a);var b=this.getPendingHyphen();a.hasHyphen()||b.setRightAnchor(a),this.hyphens.push(b),this.pendingHyphen=null}else a.hasHyphen()&&a.removeHyphen()},f.hasPendingHyphen=function(){return null!==this.pendingHyphen},f.removeHyphenIfDifferentFromPendinf=function(a){if(a.hasHyphen()){a.getHyphen()!==this.getPendingHyphen()&&a.removeHyphen()}},f.getPendingHyphen=function(){return this.pendingHyphen}}.call(this),function(){"use strict";var a=Adagio.Drawer.hyphen.HyphensLinkerLax,b=Adagio.Drawer.hyphen.HyphenPos,c=Adagio.Drawer.hyphen.HyphenAnchor,d=Adagio.Brush.Elem,e=Adagio.Drawer.hyphen.StaffHyphens=function(a){this.init(a)};e.cssClass="staffHyphens";var f=e.prototype;f.cssClass=e.cssClass,f.init=function(d){this.voiceIdx=d,this.hyphensLinker=new a,this.hyphens=[],this.drawingContext=null,this.posY=null,this.staffData=null;var e=null;this.leftContinueAnchor=new c(e,b.LEFT),this.rightContinueAnchor=new c(e,b.RIGHT),this.parent=null,this.group=null},f.updateFromMeasures=function(a){this.hyphens=this.hyphensLinker.updateMeasuresHyphens(a,this.leftContinueAnchor,this.rightContinueAnchor,this.voiceIdx),this.hyphens.forEach(this.transferDrawingContext,this),this.isRendered()&&this.hyphens.forEach(this.transfertParent,this)},f.transfertParent=function(a){a.setParent(this.group)},f.removeMeasure=function(a){if(a.hasLeftHyphenAnchor(this.voiceIdx)){var b=a.getLeftHyphenAnchor(this.voiceIdx);b.hasHyphen()&&this.removeHyphen(b.getHyphen())}if(a.hasRightHyphenAnchor(this.voiceIdx)){var c=a.getRightHyphenAnchor(this.voiceIdx);c.hasHyphen()&&this.removeHyphen(c.getHyphen())}},f.removeHyphen=function(a){var b=this.hyphens.indexOf(a);this.hyphens.splice(b,1),a.erase()},f.setDrawingContext=function(a){this.drawingContext=a,this.hyphens.forEach(this.transferDrawingContext,this)},f.transferDrawingContext=function(a){a.setDrawingContext(this.drawingContext)},f.setParent=function(a){this.parent=a},f.setPosition=function(a){this.posY=a},f.setStaffData=function(a){this.staffData=a},f.draw=function(){this.renderIfNeeded(),this.hyphens.forEach(g),this.move(),this.bindToParent()},f.renderIfNeeded=function(){this.isRendered()||this.render()},f.isRendered=function(){return null!==this.group},f.render=function(){this.group=new d("g"),this.group.attr("class",this.cssClass),this.hyphens.forEach(this.transfertParent,this)};var g=function(a){a.draw()};f.move=function(){this.isRendered()&&this.group.attr("transform","translate(0, "+this.posY+")")},f.bindToParent=function(){null!==this.parent&&this.parent.append(this.group)},f.updateVerticalDisplay=function(){this.hyphens.forEach(h)};var h=function(a){a.updateVerticalDisplay()};f.updateHorizontalDisplay=function(){this.hyphens.forEach(i)};var i=function(a){a.updateHorizontalDisplay()}}.call(this),function(){"use strict";var a=Adagio.Drawer.tie.TieArc,b=Adagio.Drawer.tie.tieOffset,c=Adagio.Drawer.tie.TieType,d=Adagio.Drawer.hammerOnPullOff.HammerOnPullOffDisplayData,e=Adagio.Drawer.NoteDisplayData,f=Adagio.Brush.Elem,g=Adagio.Utils.geometryUtils,h=Adagio.Utils.math,i=Adagio.Utils.clone,j=Adagio.Utils.staffDataUtils,k=Adagio.Drawer.Text,l=Adagio.Values.TechnicalType,m=Adagio.Error.InternalError,n=Adagio.Drawer.hammerOnPullOff.LeftHammerOnPullOff=function(a){this.init(a)};n.cssClass="hammerOnPullOff";var o=n.prototype;o.cssClass=n.cssClass,o.init=function(a){this.arcs=null,this.text=null,this.anchor=a,this.technicalType=a.getTechnicalType(),a.hammerOnPullOff=this,this.displayData=new d,this.drawingContext=null,this.parent=null,this.svgGroup=new f("g"),this.svgGroup.attr("class",this.cssClass),this.needDrawUpdate=!0,this.drawn=!1},o.setParent=function(a){this.parent=a},o.setDrawingContext=function(a){this.drawingContext=a},o.getText=function(){return this.hasText()||this.initText(),this.text},o.hasText=function(){return null!==this.text},o.initText=function(){if(this.text=null,this.displayData.hasHammerOnPullOff()){var a=this.displayData.getHammerOnPullOff(),c=this.getTextValue(),d=new k({text:c,"font-size":this.drawingContext.getHammerOnPullOffFontSize()});d.setDrawingContext(this.drawingContext),d.setParent(this.getGroup());var e=j.isTabStaff(a.staffData),f=this.stringToY(a.string,e);f+=b.getVertical(a,this.drawingContext);var g=h.min2(f-d.getXHeight()-this.drawingContext.getTieVerticalMargin(),-d.getXHeight());d.setYPos(g),d.render(),this.text=d}},o.getTextValue=function(){if(this.technicalType===l.HAMMER_ON)return"H";if(this.technicalType===l.PULL_OFF)return"P";throw new m("Unexpected")},o.getArcs=function(){return null===this.arcs&&this.initArcs(),this.arcs},o.initArcs=function(){var a=this.anchor.note,b=a.getDisplayData(),c=i(b.opts);c.hammerOnPullOffStarts=c.hammerOnPullOffStops.slice();var d=new e(c),f=b.getBeamData();if(d.setBeamData(f),this.displayData.setLeftNote(d),this.displayData.setRightNote(b),this.displayData.fillData(),this.arcs=[],this.displayData.hasHammerOnPullOffs()){this.displayData.getHammerOnPullOffs().forEach(this.renderArc,this)}},o.renderArc=function(c){var d=0,e=this.anchor.note.getFretsWidth()/2,f=b.getRight(c,e),g=0,h=new a(this.getGroup(),d,f,c.placement,g),i=j.isTabStaff(c.staffData),k=this.stringToY(c.string,i);k+=b.getVertical(c,this.drawingContext),h.setPosY(k),h.setDrawingContext(this.drawingContext),this.arcs.push(h)},o.stringToY=function(a,b){var c=b?this.drawingContext.getTabSpaceSize():this.drawingContext.getSpaceSize();return g.stringToY(a,c)},o.updateArc=function(){this.updateArcs()},o.updateArcs=function(){this.getArcs().forEach(function(a){var b=this.anchor.note,c=this.anchor.measure,d=c.tickableContent,e=c.getXPos()+d.getXPos(),f=e-d.getPreviousSpace(),g=this.drawingContext.getTieHorizontalMargin(),h=e+b.getXPos()-g,i=h-f,j=q(),k=j(i);a.setSize(i,k),a.setPosX(f)},this),this.needDrawUpdate=!1},o.setNeedDrawUpdate=function(){this.needDrawUpdate=!0},o.draw=function(){this.needDrawUpdate&&this.updateArc(),this.getArcs().forEach(function(a){a.draw()}),this.bindToParent()},o.bindToParent=function(){null!==this.parent&&(this.parent.append(this.getGroup()),this.drawn=!0)},o.getGroup=function(){return this.svgGroup},o.erase=function(){this.anchor.hammerOnPullOff=null,this.drawn&&this.unbindFromParent()},o.unbindFromParent=function(){this.svgGroup.removeFromParent(),this.drawn=!1},o.getType=function(){return c.LEFT},o.isComplete=function(){return!0};var p=null,q=function(){if(null===p){var a=3,b=2/3,c=30,d=2,e=h.solveLinearA(a,b,c,d),f=h.solveLinearB(a,b,e);p=function(a){return e*a+f}}return p};o.getTopY=function(){var a=this.getTopArc(),b=a.getTopY();return a.posY+b},o.getTopArc=function(){return this.getArcs()[0]},o.getBottomY=function(){var a=this.getBottomArc(),b=a.getBottomY();return a.posY+b},o.getBottomArc=function(){var a=this.getArcs();return a[a.length-1]}}.call(this),function(){"use strict";var a=Adagio.Drawer.tie.TieArc,b=Adagio.Drawer.tie.tieOffset,c=Adagio.Drawer.tie.TieType,d=Adagio.Drawer.hammerOnPullOff.HammerOnPullOffDisplayData,e=Adagio.Drawer.NoteDisplayData,f=Adagio.Brush.Elem,g=Adagio.Utils.geometryUtils,h=Adagio.Utils.math,i=Adagio.Utils.clone,j=Adagio.Utils.staffDataUtils,k=Adagio.Drawer.Text,l=Adagio.Values.TechnicalType,m=Adagio.Error.InternalError,n=Adagio.Drawer.hammerOnPullOff.RightHammerOnPullOff=function(a){this.init(a)};n.cssClass="hammerOnPullOff";var o=n.prototype;o.cssClass=n.cssClass,o.init=function(a){this.arcs=null,this.text=null,this.anchor=a,this.technicalType=a.getTechnicalType(),a.hammerOnPullOff=this,this.displayData=new d,this.drawingContext=null,this.parent=null,this.svgGroup=new f("g"),this.svgGroup.attr("class",this.cssClass),this.needDrawUpdate=!0,this.drawn=!1},o.setParent=function(a){this.parent=a},o.setDrawingContext=function(a){this.drawingContext=a},o.getText=function(){return this.hasText()||this.initText(),this.text},o.hasText=function(){return null!==this.text},o.initText=function(){if(this.text=null,this.displayData.hasHammerOnPullOff()){var a=this.displayData.getHammerOnPullOff(),c=this.getTextValue(),d=new k({text:c,"font-size":this.drawingContext.getHammerOnPullOffFontSize()});d.setDrawingContext(this.drawingContext),d.setParent(this.getGroup());var e=j.isTabStaff(a.staffData),f=this.stringToY(a.string,e);f+=b.getVertical(a,this.drawingContext);var g=h.min2(f-d.getXHeight()-this.drawingContext.getTieVerticalMargin(),-d.getXHeight());d.setYPos(g),d.render(),this.text=d}},o.getTextValue=function(){if(this.technicalType===l.HAMMER_ON)return"H";if(this.technicalType===l.PULL_OFF)return"P";throw new m("Unexpected")},o.getArcs=function(){return null===this.arcs&&this.initArcs(),this.arcs},o.initArcs=function(){var a=this.anchor.note,b=a.getDisplayData(),c=i(b.opts);c.hammerOnPullOffStops=c.hammerOnPullOffStarts.slice();var d=new e(c),f=b.getBeamData();if(d.setBeamData(f),this.displayData.setLeftNote(b),this.displayData.setRightNote(d),this.displayData.fillData(),this.arcs=[],this.displayData.hasHammerOnPullOffs()){this.displayData.getHammerOnPullOffs().forEach(this.renderArc,this)}},o.renderArc=function(c){var d=0,e=this.anchor.note.getFretsWidth()/2,f=b.getLeft(c,e),g=0,h=new a(this.getGroup(),f,d,c.placement,g),i=j.isTabStaff(c.staffData),k=this.stringToY(c.string,i);k+=b.getVertical(c,this.drawingContext),h.setPosY(k),h.setDrawingContext(this.drawingContext),this.arcs.push(h)},o.stringToY=function(a,b){var c=b?this.drawingContext.getTabSpaceSize():this.drawingContext.getSpaceSize();return g.stringToY(a,c)},o.updateArc=function(){this.updateArcs()},o.updateArcs=function(){this.getArcs().forEach(function(a){var b=this.anchor.note,c=this.anchor.measure,d=c.tickableContent,e=c.getXPos()+d.getXPos(),f=e+d.getWidth(),g=this.drawingContext.getTieHorizontalMargin(),h=e+b.getXPos()+g,i=f-h,j=q(),k=j(i);a.setSize(i,k),a.setPosX(h)},this),this.needDrawUpdate=!1},o.setNeedDrawUpdate=function(){this.needDrawUpdate=!0},o.draw=function(){this.needDrawUpdate&&this.updateArc(),this.getArcs().forEach(function(a){a.draw()}),this.bindToParent()},o.bindToParent=function(){null!==this.parent&&(this.parent.append(this.getGroup()),this.drawn=!0)},o.getGroup=function(){return this.svgGroup},o.erase=function(){this.anchor.hammerOnPullOff=null,this.drawn&&this.unbindFromParent()},o.unbindFromParent=function(){this.svgGroup.removeFromParent(),this.drawn=!1},o.getType=function(){return c.RIGHT},o.isComplete=function(){return!0};var p=null,q=function(){if(null===p){var a=3,b=2/3,c=30,d=2,e=h.solveLinearA(a,b,c,d),f=h.solveLinearB(a,b,e);p=function(a){return e*a+f}}return p};o.getTopY=function(){var a=this.getTopArc(),b=a.getTopY();return a.posY+b},o.getTopArc=function(){return this.getArcs()[0]},o.getBottomY=function(){var a=this.getBottomArc(),b=a.getBottomY();return a.posY+b},o.getBottomArc=function(){var a=this.getArcs();return a[a.length-1]}}.call(this),function(){"use strict";var a=Adagio.Drawer.tie.TieArc,b=Adagio.Drawer.tie.TieType,c=Adagio.Drawer.tie.tieOffset,d=Adagio.Drawer.hammerOnPullOff.HammerOnPullOffDisplayData,e=Adagio.Brush.Elem,f=Adagio.Utils.geometryUtils,g=Adagio.Utils.math,h=Adagio.Utils.staffDataUtils,i=Adagio.Drawer.Text,j=Adagio.Values.TechnicalType,k=Adagio.Error.InternalError,l=Adagio.Drawer.hammerOnPullOff.CrossMeasureHammerOnPullOff=function(a){this.init(a)};l.cssClass="hammerOnPullOff";var m=l.prototype;m.cssClass=l.cssClass,m.init=function(a){this.technicalType=a,this.arcs=null,this.text=null,this.leftAnchor=null,this.rightAnchor=null,this.displayData=null,this.drawingContext=null,this.parent=null,this.svgGroup=new e("g"),this.svgGroup.attr("class",this.cssClass),this.needDrawUpdate=!0,this.drawn=!1},m.setParent=function(a){this.parent=a},m.setLeftAnchor=function(a){this.hasLeftAnchor()&&this.leftAnchor!==a&&this.removeLeftAnchor(),this.leftAnchor=a,this.leftAnchor.hammerOnPullOff=this},m.hasLeftAnchor=function(){return null!==this.leftAnchor},m.removeLeftAnchor=function(){this.discardArc(),this.leftAnchor.hammerOnPullOff=null,this.leftAnchor=null},m.setRightAnchor=function(a){this.hasRightAnchor()&&this.rightAnchor!==a&&this.removeRightAnchor(),this.rightAnchor=a,this.rightAnchor.hammerOnPullOff=this},m.hasRightAnchor=function(){return null!==this.rightAnchor},m.removeRightAnchor=function(){this.discardArc(),this.rightAnchor.hammerOnPullOff=null,this.rightAnchor=null},m.discardArc=function(){this.displayData=null,null!==this.arcs&&(this.arcs.forEach(function(a){a.erase()}),this.arcs=null),this.needDrawUpdate=!0},m.setDrawingContext=function(a){this.drawingContext=a},m.getText=function(){return this.hasText()||this.initText(),this.text},m.hasText=function(){return null!==this.text},m.initText=function(){if(this.text=null,this.displayData.hasHammerOnPullOff()){var a=this.displayData.getHammerOnPullOff(),b=this.getTextValue(),d=new i({text:b,"font-size":this.drawingContext.getHammerOnPullOffFontSize()});d.setDrawingContext(this.drawingContext),d.setParent(this.getGroup());var e=h.isTabStaff(a.staffData),f=this.stringToY(a.string,e);f+=c.getVertical(a,this.drawingContext);var j=g.min2(f-d.getXHeight()-this.drawingContext.getTieVerticalMargin(),-d.getXHeight());d.setYPos(j),d.render(),this.text=d}},m.getTextValue=function(){if(this.technicalType===j.HAMMER_ON)return"H";if(this.technicalType===j.PULL_OFF)return"P";throw new k("Unexpected")},m.getArcs=function(){return null===this.arcs&&this.initArcs(),this.arcs},m.initArcs=function(){this.displayData=new d;var a=this.rightAnchor.note;this.displayData.setRightNote(a.getDisplayData());var b=this.leftAnchor.note;if(this.displayData.setLeftNote(b.getDisplayData()),this.displayData.fillData(),this.arcs=[],this.displayData.hasHammerOnPullOffs()){this.displayData.getHammerOnPullOffs().forEach(this.renderArc,this)}},m.renderArc=function(b){var d=this.leftAnchor.note,e=d.getFretsWidth()/2,f=c.getLeft(b,e),g=this.rightAnchor.note,i=g.getFretsWidth()/2,j=c.getRight(b,i),k=c.getVertical(b,this.drawingContext),l=h.isTabStaff(b.staffData),m=this.stringToY(b.string,l)+k,n=this.stringToY(b.rightString,l)+k,o=n-m,p=new a(this.getGroup(),f,j,b.placement,o);p.setPosY(m),p.setDrawingContext(this.drawingContext),this.arcs.push(p)},m.stringToY=function(a,b){var c=b?this.drawingContext.getTabSpaceSize():this.drawingContext.getSpaceSize();return f.stringToY(a,c)},m.updateArc=function(){this.updateArcs()},m.updateArcs=function(){this.getArcs().forEach(function(a){var b=this.drawingContext.getTieHorizontalMargin(),c=this.getLeftOffset(),d=this.leftAnchor.note,e=d.getXPos()+b+c,f=this.getRightOffset(),g=this.rightAnchor.note,h=g.getXPos()-b+f,i=h-e,j=o(),k=j(i);a.setSize(i,k),a.setPosX(e)},this),this.needDrawUpdate=!1},m.getLeftOffset=function(){var a=this.leftAnchor.measure,b=a.tickableContent;return a.getXPos()+b.getXPos()},m.getRightOffset=function(){var a=this.rightAnchor.measure,b=a.tickableContent;return a.getXPos()+b.getXPos()},m.setNeedDrawUpdate=function(){this.needDrawUpdate=!0},m.draw=function(){this.needDrawUpdate&&this.updateArc(),
this.getArcs().forEach(function(a){a.draw()}),this.bindToParent()},m.bindToParent=function(){null!==this.parent&&(this.parent.append(this.getGroup()),this.drawn=!0)},m.getGroup=function(){return this.svgGroup},m.erase=function(){this.drawn&&this.unbindFromParent(),this.hasLeftAnchor()&&this.removeLeftAnchor(),this.hasRightAnchor()&&this.removeRightAnchor()},m.unbindFromParent=function(){this.svgGroup.removeFromParent(),this.drawn=!1},m.getType=function(){return b.CROSS_MEASURE},m.isComplete=function(){return this.hasLeftAnchor()&&this.hasRightAnchor()};var n=null,o=function(){if(null===n){var a=3,b=2/3,c=30,d=2,e=g.solveLinearA(a,b,c,d),f=g.solveLinearB(a,b,e);n=function(a){return e*a+f}}return n};m.getTopY=function(){var a=this.getTopArc(),b=a.getTopY();return a.posY+b},m.getTopArc=function(){return this.getArcs()[0]},m.getBottomY=function(){var a=this.getBottomArc(),b=a.getBottomY();return a.posY+b},m.getBottomArc=function(){var a=this.getArcs();return a[a.length-1]}}.call(this),function(){"use strict";var a=Adagio.Drawer.hammerOnPullOff.LeftHammerOnPullOff,b=Adagio.Drawer.hammerOnPullOff.RightHammerOnPullOff,c=Adagio.Drawer.hammerOnPullOff.CrossMeasureHammerOnPullOff,d=Adagio.Drawer.tie.TieType,e=Adagio.Drawer.hammerOnPullOff.HammerOnPullOffsLinkerLax=function(){},f=e.prototype;f.reset=function(a){this.pendingHammerOnPullOff=null,this.hammerOnPullOffs=[],this.voiceIdx=a},f.updateMeasuresHammerOnPullOffs=function(a,b){return this.reset(b),a.forEach(this.updateMeasureHammerOnPullOffs,this),this.hammerOnPullOffs=this.hammerOnPullOffs.filter(j),this.hammerOnPullOffs},f.updateMeasureHammerOnPullOffs=function(a,b,c){var d=0===b,e=b===c.length-1;a.hasLeftHammerOnPullOffAnchor(this.voiceIdx)&&this.updateLeftAnchor(a.getLeftHammerOnPullOffAnchor(this.voiceIdx),d),a.hasRightHammerOnPullOffAnchor(this.voiceIdx)&&this.updateRightAnchor(a.getRightHammerOnPullOffAnchor(this.voiceIdx),e)},f.updateLeftAnchor=function(a,b){b?(g(a),this.addLeftHammerOnPullOff(a)):(i(a),this.closePending(a))};var g=function(a){if(a.hasHammerOnPullOff()){a.getHammerOnPullOff().getType()===d.CROSS_MEASURE&&a.removeHammerOnPullOff()}};f.addLeftHammerOnPullOff=function(b){var c;c=b.hasHammerOnPullOff()?b.getHammerOnPullOff():new a(b),this.hammerOnPullOffs.push(c)},f.closePending=function(a){if(this.hasPendingHammerOnPullOff()){this.removeHammerOnPullOffIfDifferentFromPending(a);var b=this.getPendingHammerOnPullOff();a.hasHammerOnPullOff()||b.setRightAnchor(a),this.hammerOnPullOffs.push(b),this.pendingHammerOnPullOff=null}else a.hasHammerOnPullOff()&&a.removeHammerOnPullOff()},f.removeHammerOnPullOffIfDifferentFromPending=function(a){if(a.hasHammerOnPullOff()){a.getHammerOnPullOff()!==this.getPendingHammerOnPullOff()&&a.removeHammerOnPullOff()}},f.getPendingHammerOnPullOff=function(){return this.pendingHammerOnPullOff},f.hasPendingHammerOnPullOff=function(){return null!==this.pendingHammerOnPullOff},f.updateRightAnchor=function(a,b){b?(h(a),this.addRightHammerOnPullOff(a)):(i(a),this.openPendingHammerOnPullOff(a))};var h=function(a){if(a.hasHammerOnPullOff()){var b=a.getHammerOnPullOff();b.getType()===d.CROSS_MEASURE&&b.erase()}};f.addRightHammerOnPullOff=function(a){var c;c=a.hasHammerOnPullOff()?a.getHammerOnPullOff():new b(a),this.hammerOnPullOffs.push(c)};var i=function(a){if(a.hasHammerOnPullOff()){var b=a.getHammerOnPullOff();b.getType()!==d.CROSS_MEASURE&&b.erase()}};f.openPendingHammerOnPullOff=function(a){this.hasPendingHammerOnPullOff()&&this.discardPendingHammerOnPullOff();var b;if(a.hasHammerOnPullOff())b=a.getHammerOnPullOff();else{var d=a.getTechnicalType();b=new c(d),b.setLeftAnchor(a)}this.pendingHammerOnPullOff=b},f.discardPendingHammerOnPullOff=function(){this.pendingHammerOnPullOff.erase(),this.pendingHammerOnPullOff=null};var j=function(a){return!!a.isComplete()||(a.erase(),!1)}}.call(this),function(){"use strict";var a=Adagio.Drawer.hammerOnPullOff.HammerOnPullOffsLinkerLax,b=Adagio.Brush.Elem,c=Adagio.Drawer.hammerOnPullOff.StaffHammerOnPullOffs=function(a){this.init(a)};c.cssClass="staffHammerOnPullOffs";var d=c.prototype;d.cssClass=c.cssClass,d.init=function(b){this.voiceIdx=b,this.hammerOnPullOffsLinker=new a,this.hammerOnPullOffs=[],this.drawingContext=null,this.posY=null,this.staffData=null,this.parent=null,this.group=null},d.updateMeasuresHammerOnPullOffs=function(a){this.hammerOnPullOffs=this.hammerOnPullOffsLinker.updateMeasuresHammerOnPullOffs(a,this.voiceIdx),this.hammerOnPullOffs.forEach(this.transferDrawingContext,this),this.isRendered()&&this.hammerOnPullOffs.forEach(this.transfertParent,this)},d.transfertParent=function(a){a.setParent(this.group)},d.removeMeasure=function(a){if(a.hasLeftHammerOnPullOffAnchor(this.voiceIdx)){var b=a.getLeftHammerOnPullOffAnchor(this.voiceIdx);b.hasLeftHammerOnPullOff()?this.removeHammerOnPullOff(b.getHammerOnPullOff()):b.hasCrossMeasureHammerOnPullOff()&&b.removeHammerOnPullOff()}if(a.hasRightHammerOnPullOffAnchor(this.voiceIdx)){var c=a.getRightHammerOnPullOffAnchor(this.voiceIdx);c.hasHammerOnPullOff()&&this.removeHammerOnPullOff(c.getHammerOnPullOff())}},d.removeHammerOnPullOff=function(a){var b=this.hammerOnPullOffs.indexOf(a);this.hammerOnPullOffs.splice(b,1),a.erase()},d.setDrawingContext=function(a){this.drawingContext=a,this.hammerOnPullOffs.forEach(this.transferDrawingContext,this)},d.transferDrawingContext=function(a){a.setDrawingContext(this.drawingContext)},d.setParent=function(a){this.parent=a},d.setPosition=function(a){this.posY=a},d.setStaffData=function(a){this.staffData=a},d.draw=function(){this.renderIfNeeded(),this.hammerOnPullOffs.forEach(f),this.move(),this.bindToParent()},d.renderIfNeeded=function(){this.isRendered()||this.render()},d.isRendered=function(){return null!==this.group},d.render=function(){this.group=new b("g"),this.group.attr("class",this.cssClass),this.hammerOnPullOffs.forEach(this.transfertParent,this)},d.move=function(){this.isRendered()&&this.group.attr("transform","translate(0, "+this.posY+")")},d.bindToParent=function(){null!==this.parent&&this.parent.append(this.group)},d.updateHorizontalDisplay=function(){this.hammerOnPullOffs.forEach(e)};var e=function(a){a.draw()},f=function(a){a.draw()}}.call(this),function(){"use strict";var a=Adagio.Brush.Elem,b=Adagio.Drawer.Line,c=Adagio.Drawer.wedge.WedgeLines=function(){this.init()};c.cssClass="wedgeLines";var d=c.prototype;d.cssClass=c.cssClass,d.init=function(){this.parentGroup=null,this.group=null,this.upLine=null,this.downLine=null,this.drawingContext=null,this.width=null,this.leftSpread=null,this.rightSpread=null,this.posX=null,this.posY=null,this.needRender=!0},d.setDrawingContext=function(a){this.drawingContext=a},d.setParent=function(a){this.parentGroup=a},d.setSize=function(a,b){this.width=a,this.tieHeight=b,this.needRender=!0},d.render=function(){this.group=new a("g"),this.group.attr("class",this.cssClass);var c=this.drawingContext.getHairpinThickness(),d={stroke_width:c};this.upLine=new b(this.group,d);var e=this.getUpLeftY(),f=this.getUpRightY();this.upLine.render(0,e,this.width,f),this.upLine.draw();var g={stroke_width:c};this.downLine=new b(this.group,g);var h=this.getDownLeftY(),i=this.getDownRightY();this.downLine.render(0,h,this.width,i),this.downLine.draw()},d.setWidth=function(a){this.width=a,this.isRendered()&&(this.upLine.setX2(a),this.downLine.setX2(a))},d.setLeftSpread=function(a){if(this.leftSpread=a,this.height=Math.max(this.leftSpread,this.rightSpread),this.isRendered()){var b=this.getUpLeftY(),c=this.getDownLeftY();this.upLine.setY1(b),this.downLine.setY1(c)}},d.getUpLeftY=function(){return-this.leftSpread/2},d.getDownLeftY=function(){return this.leftSpread/2},d.setRightSpread=function(a){if(this.rightSpread=a,this.height=Math.max(this.leftSpread,this.rightSpread),this.isRendered()){var b=this.getUpRightY(),c=this.getDownRightY();this.upLine.setY2(b),this.downLine.setY2(c)}},d.getUpRightY=function(){return-this.rightSpread/2},d.getDownRightY=function(){return this.rightSpread/2},d.getWidth=function(){return this.width},d.getHeight=function(){return Math.max(this.rightSpread,this.leftSpread)},d.draw=function(){this.isRendered()||this.render(),this.move(),this.bindToParent()},d.isRendered=function(){return null!==this.group},d.bindToParent=function(){this.parentGroup.append(this.group)},d.move=function(){null!==this.posX&&null!==this.posY&&this.group.attr("transform","translate("+this.posX+" "+this.posY+")")},d.setPosX=function(a){this.posX=a},d.setPosY=function(a){this.posY=a}}.call(this),function(){"use strict";var a=Adagio.Drawer.wedge.SpreadType,b=Adagio.Drawer.wedge.WedgeLines,c=Adagio.Brush.Elem,d=Adagio.Values.DirectionPlacement,e=Adagio.Drawer.wedge.Wedge=function(){this.init()};e.cssClass="wedge";var f=e.prototype;f.cssClass=e.cssClass,f.init=function(){this.leftAnchor=null,this.rightAnchor=null,this.wedgeLines=null,this.drawingContext=null,this.staffData=null,this.parent=null,this.group=null,this.needDrawUpdate=!0,this.drawn=!1},f.setParent=function(a){this.parent=a},f.setCssClass=function(a){this.cssClass=a},f.setStaffData=function(a){this.staffData=a},f.setLeftAnchor=function(a){this.hasLeftAnchor()&&this.leftAnchor!==a&&this.removeLeftAnchor(),this.leftAnchor=a,this.leftAnchor.wedge=this},f.hasLeftAnchor=function(){return null!==this.leftAnchor},f.removeLeftAnchor=function(){this.hide(),this.leftAnchor.wedge=null,this.leftAnchor=null},f.setRightAnchor=function(a){this.hasRightAnchor()&&this.rightAnchor!==a&&this.removeRightAnchor(),this.rightAnchor=a,this.rightAnchor.wedge=this},f.hasRightAnchor=function(){return null!==this.rightAnchor},f.removeRightAnchor=function(){this.hide(),this.rightAnchor.wedge=null,this.rightAnchor=null},f.hide=function(){this.drawn&&this.unbindFromParent()},f.setDrawingContext=function(a){this.drawingContext=a,this.isRendered()&&this.wedgeLines.setDrawingContext(a)},f.updateLinesHorizontal=function(){var a=this.getLeftAnchor(),b=a.getX(),c=this.spreadTypeToY(a.getSpreadType()),d=this.getRightAnchor(),e=d.getX(),f=this.spreadTypeToY(d.getSpreadType()),g=e-b;this.wedgeLines.setWidth(g),this.wedgeLines.setLeftSpread(c),this.wedgeLines.setRightSpread(f),this.wedgeLines.setPosX(b),this.needDrawUpdate=!1},f.isAbove=function(){return this.getPlacement===d.ABOVE},f.isBelow=function(){return this.getPlacement()===d.BELOW},f.getPlacement=function(){return this.getLeftAnchor().getPlacement()},f.spreadTypeToY=function(b){return b===a.OPEN?this.drawingContext.getHairpinOpenSpread():b===a.OPEN_CONTINUE?this.drawingContext.getHairpinOpenContinueSpread():b===a.CLOSED?this.drawingContext.getHairpinCloseSpread():b===a.CLOSED_CONTINUE?this.drawingContext.getHairpinCloseContinueSpread():void a.raiseError(b)},f.updateLinesVertical=function(){var a=this.getY();this.wedgeLines.setPosY(a)},f.getY=function(){return this.getLeftAnchor().getY()},f.getLeftAnchor=function(){return this.leftAnchor},f.getRightAnchor=function(){return this.rightAnchor},f.setNeedDrawUpdate=function(){this.needDrawUpdate=!0},f.updateHorizontalDisplay=function(){this.isRendered()||this.render(),this.needDrawUpdate&&this.updateLinesHorizontal(),this.wedgeLines.draw(),this.bindToParent()},f.updateVerticalDisplay=function(){this.isRendered()||this.render(),this.updateLinesVertical(),this.wedgeLines.draw(),this.bindToParent()},f.draw=function(){this.bindToParent()},f.isRendered=function(){return null!==this.group},f.render=function(){this.group=new c("g"),this.group.attr("class",this.cssClass),this.wedgeLines=new b,this.wedgeLines.setParent(this.group),this.wedgeLines.setDrawingContext(this.drawingContext)},f.bindToParent=function(){null!==this.parent&&(this.parent.append(this.getGroup()),this.drawn=!0)},f.getGroup=function(){return this.group},f.erase=function(){this.hide(),this.hasLeftAnchor()&&this.removeLeftAnchor(),this.hasRightAnchor()&&this.removeRightAnchor()},f.unbindFromParent=function(){this.group.removeFromParent(),this.drawn=!1},f.isComplete=function(){return this.hasLeftAnchor()&&this.hasRightAnchor()},f.getGroup=function(){return this.group},f.getLeftMeasureIdx=function(){return this.getLeftAnchor().getMeasureIdx()},f.getRightMeasureIdx=function(){return this.getRightAnchor().getMeasureIdx()}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Drawer.wedge.Wedge,c=Adagio.Drawer.wedge.WedgesLinkerLax=function(){},d=c.prototype;d.reset=function(){this.pendingWedge=null,this.wedges=[],this.anchors=[],this.currentMeasureIdx=null},d.parseMeasuresWedges=function(a){return this.reset(),a.forEach(this.parseMeasureWedgeAnchors,this),this.createWedges(),this.wedges},d.parseMeasureWedgeAnchors=function(a,b,c){this.currentMeasureIdx=b;var d=0===b,e=b===c.length-1;a.hasLeftWedgeAnchor()&&this.updateLeftAnchor(a.getLeftWedgeAnchor(),d);var f=a.getMiddleWedgesAnchors();this.addAnchors(f),a.hasRightWedgeAnchor()&&this.updateRightAnchor(a.getRightWedgeAnchor(),e)},d.updateLeftAnchor=function(a,b){if(b)this.addAnchor(a);else if(a.hasWedge()){var c=a.getWedge();c.erase()}},d.updateRightAnchor=function(a,b){if(b)this.addAnchor(a);else if(a.hasWedge()){var c=a.getWedge();c.erase()}},d.addAnchors=function(a){a.forEach(this.addAnchor,this)},d.addAnchor=function(a){a.setMeasureIdx(this.currentMeasureIdx),this.anchors.push(a)},d.createWedges=function(){this.anchors.forEach(this.useAnchor,this),this.hasPendingWedge()&&this.discardPendingWedge()},d.useAnchor=function(b){if(b.isLeft())this.openPendingWedge(b);else{if(!b.isRight(b))throw new a("Unexpected");this.closePending(b)}},d.openPendingWedge=function(a){this.hasPendingWedge()&&this.discardPendingWedge();var c;a.hasWedge()?c=a.getWedge():(c=new b,c.setLeftAnchor(a)),this.pendingWedge=c},d.discardPendingWedge=function(){this.pendingWedge.erase(),this.pendingWedge=null},d.closePending=function(a){if(this.hasPendingWedge()){this.removeWedgeIfDifferentFromPending(a);var b=this.getPendingWedge();a.hasWedge()||b.setRightAnchor(a),this.wedges.push(b),this.pendingWedge=null}else a.hasWedge()&&a.removeWedge()},d.hasPendingWedge=function(){return null!==this.pendingWedge},d.removeWedgeIfDifferentFromPending=function(a){if(a.hasWedge()){a.getWedge()!==this.getPendingWedge()&&a.removeWedge()}},d.getPendingWedge=function(){return this.pendingWedge}}.call(this),function(){"use strict";var a=Adagio.Drawer.wedge.WedgesLinkerLax,b=Adagio.Brush.Elem,c=Adagio.Drawer.wedge.StaffWedges=function(){this.init()};c.cssClass="staffWedges";var d=c.prototype;d.cssClass=c.cssClass,d.init=function(){this.wedgesLinker=new a,this.wedges=[],this.drawingContext=null,this.staffData=null,this.posY=null,this.parent=null,this.group=null},d.setStaffData=function(a){this.staffData=a},d.updateMeasuresWedges=function(a){this.wedges=this.wedgesLinker.parseMeasuresWedges(a),this.wedges.forEach(this.transferDrawingContext,this),this.wedges.forEach(this.transferStaffData,this),this.isRendered()&&this.wedges.forEach(this.transfertParent,this)},d.transfertParent=function(a){a.setParent(this.group)},d.transferStaffData=function(a){a.setStaffData(this.staffData)},d.removeMeasure=function(a){a.getAllWedgesAnchors().forEach(this.unbindAnchor,this)},d.unbindAnchor=function(a){if(a.hasWedge()){var b=a.getWedge();this.removeWedge(b)}},d.removeWedge=function(a){var b=this.wedges.indexOf(a);this.wedges.splice(b,1),a.erase()},d.setPosition=function(a){this.posY=a},d.setDrawingContext=function(a){this.drawingContext=a,this.wedges.forEach(this.transferDrawingContext,this)},d.transferDrawingContext=function(a){a.setDrawingContext(this.drawingContext)},d.setParent=function(a){this.parent=a},d.draw=function(){this.renderIfNeeded(),this.wedges.forEach(e),this.move(),this.bindToParent()},d.renderIfNeeded=function(){this.isRendered()||this.render()},d.isRendered=function(){return null!==this.group},d.render=function(){this.group=new b("g"),this.group.attr("class",this.cssClass),this.wedges.forEach(this.transfertParent,this)},d.move=function(){this.isRendered()&&this.group.attr("transform","translate(0, "+this.posY+")")},d.bindToParent=function(){null!==this.parent&&this.parent.append(this.group)};var e=function(a){a.draw()};d.updateVerticalDisplay=function(){this.wedges.forEach(f)};var f=function(a){a.updateVerticalDisplay()};d.updateHorizontalDisplay=function(){this.wedges.forEach(g)};var g=function(a){a.updateHorizontalDisplay()};d.getWedges=function(){return this.wedges},d.getGroup=function(){return this.group}}.call(this),function(){"use strict";var a=Adagio.Drawer.Line,b=Adagio.Drawer.octaveShift.OctaveShiftLine=function(){this.init()};b.cssClass="octaveShiftLine";var c=b.prototype;c.cssClass=b.cssClass,c.init=function(){this.drawingContext=null,this.parent=null,this.line=null,this.x1=0,this.x2=0,this.y1=0,this.y2=0},c.setDrawingContext=function(a){this.drawingContext=a},c.setParent=function(a){this.parent=a},c.setX1=function(a){this.x1=a,this.isRendered()&&this.line.setX1(a)},c.setX2=function(a){this.x2=a,this.isRendered()&&this.line.setX2(a)},c.setY1=function(a){this.y1=a,this.isRendered()&&this.line.setY1(a)},c.setY2=function(a){this.y2=a,this.isRendered()&&this.line.setY2(a)},c.draw=function(){this.isRendered()||this.render(),this.line.draw()},c.render=function(){if(!this.isRendered()){var b=this.drawingContext.getOctaveLineThickness(),c=this.drawingContext.getOctaveShiftDashArrayWidth(),d={stroke_width:b,stroke_dasharray:[c,c/3]};this.line=new a(this.parent,d),this.line.render(this.x1,this.y1,this.x2,this.y2)}},c.isRendered=function(){return null!==this.line}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Values.DirectionPlacement,c=Adagio.Values.OctaveShiftSize,d=Adagio.Utils.mapUtils,e=Adagio.Brush.Elem,f=function(a,b){return a+"-"+b},g=d.fromPairs([{key:f(c.EIGHT,b.ABOVE),value:"ottavaAlta"},{key:f(c.EIGHT,b.BELOW),value:"ottavaBassaBa"},{key:f(c.FIFTEEN,b.ABOVE),value:"quindicesimaAlta"},{key:f(c.FIFTEEN,b.BELOW),value:"quindicesimaBassa"},{key:f(c.TWENTY_TWO,b.ABOVE),value:"ventiduesimaAlta"},{key:f(c.TWENTY_TWO,b.BELOW),value:"ventiduesimaBassa"}]),h=Adagio.Drawer.octaveShift.OctaveShiftText=function(a,b){this.init(a,b)};h.cssClass="OctaveShiftText";var i=h.prototype;i.cssClass=h.cssClass,i.init=function(a,b){this.leftAnchor=null,this.rightAnchor=null,this.availableSpace=null,this.drawingContext=null,this.parent=null,this.path=null,this.glyphId=j(a,b),this.glyph=null,this.pathStr=null};var j=function(b,c){var d=f(b,c);if(void 0===g[d]){throw new a("Unexpected","There is no glyph for the ottava size ["+b+"] and the placement ["+c+"].")}return g[d]};i.setParent=function(a){this.parent=a},i.setCssClass=function(a){this.cssClass=a},i.setDrawingContext=function(a){this.drawingContext=a},i.updateHorizontalDisplay=function(a){if(this.availableSpace=a,this.isRendered()||this.render(),null===this.pathStr){var b=this.getGlyph();this.pathStr=b.render(),this.path.attr("d",this.pathStr)}this.draw()},i.getGlyph=function(){return null===this.glyph&&(this.glyph=this.drawingContext.getGlyph(this.glyphId)),this.glyph},i.draw=function(){this.bindToParent()},i.bindToParent=function(){null!==this.parent&&this.parent.append(this.path)},i.render=function(){this.path=new e("path"),this.path.attr("class",this.cssClass)},i.isRendered=function(){return null!==this.path},i.getWidth=function(){return this.getGlyph().getWidth()},i.getHeight=function(){return this.getGlyph().getHeight()}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Brush.Elem,c=Adagio.Drawer.Line,d=Adagio.Drawer.octaveShift.OctaveShiftLine,e=Adagio.Drawer.octaveShift.OctaveShiftText,f=Adagio.Drawer.octaveShift.OctaveShift=function(){this.init()};f.cssClass="octaveShift";var g=f.prototype;g.cssClass=f.cssClass,g.init=function(){this.leftAnchor=null,this.rightAnchor=null,this.sizeText=null,this.upperLine=null,this.closingLine=null,this.drawingContext=null,this.staffData=null,this.parent=null,this.group=null,this.posX=null,this.posY=null,this.drawn=!1},g.setParent=function(a){this.parent=a},g.setCssClass=function(a){this.cssClass=a},g.setStaffData=function(a){this.staffData=a},g.setDrawingContext=function(a){this.drawingContext=a},g.setLeftAnchor=function(a){this.hasLeftAnchor()&&this.leftAnchor!==a&&this.removeLeftAnchor(),this.leftAnchor=a,this.leftAnchor.setOctaveShift(this)},g.hasLeftAnchor=function(){return null!==this.leftAnchor},g.removeLeftAnchor=function(){this.hide(),this.leftAnchor.octaveShift=null,this.leftAnchor=null},g.setRightAnchor=function(a){this.hasRightAnchor()&&this.rightAnchor!==a&&this.removeRightAnchor(),this.rightAnchor=a,this.rightAnchor.setOctaveShift(this)},g.hasRightAnchor=function(){return null!==this.rightAnchor},g.removeRightAnchor=function(){this.hide(),this.rightAnchor.octaveShift=null,this.rightAnchor=null},g.erase=function(){this.hide(),this.hasLeftAnchor()&&this.removeLeftAnchor(),this.hasRightAnchor()&&this.removeRightAnchor()},g.hide=function(){this.drawn&&this.unbindFromParent()},g.isAbove=function(){return this.getLeftAnchor().isAbove()},g.isBelow=function(){return this.getLeftAnchor().isBelow()},g.getY=function(){return this.getLeftAnchor().getY()},g.getLeftAnchor=function(){return this.leftAnchor},g.getRightAnchor=function(){return this.rightAnchor},g.setNeedDrawUpdate=function(){this.needDrawUpdate=!0},g.updateHorizontalDisplay=function(){this.isRendered()||this.render();var a=this.getWidth();this.sizeText.updateHorizontalDisplay(a);var b=this.sizeText.getWidth()+this.drawingContext.getOctaveShiftTextMargin();this.upperLine.setX1(b),null!==this.closingLine&&(a-=this.drawingContext.getMarginSize(),this.closingLine.setX1(a),this.closingLine.setX2(a)),this.upperLine.setX2(a),this.posX=this.getX(),this.draw()},g.updateVerticalDisplay=function(){this.isRendered()||this.render(),this.posY=this.getY(),this.draw()},g.draw=function(){this.upperLine.draw(),this.sizeText.draw(),null!==this.closingLine&&this.closingLine.draw(),this.move(),this.bindToParent()},g.bindToParent=function(){null!==this.parent&&(this.parent.append(this.group),this.drawn=!0)},g.unbindFromParent=function(){this.group.removeFromParent(),this.drawn=!1},g.render=function(){this.group=new b("g"),this.group.attr("class",this.cssClass);var a=this.getLeftAnchor(),f=a.getSize(),g=a.getPlacement();this.sizeText=new e(f,g),this.sizeText.setParent(this.group),this.sizeText.setDrawingContext(this.drawingContext),this.upperLine=new d,this.upperLine.setParent(this.group),this.upperLine.setDrawingContext(this.drawingContext);var h=this.getUpperLineY();if(this.upperLine.setY1(h),this.upperLine.setY2(h),this.getRightAnchor().isStop()){var i=this.drawingContext.getOctaveLineThickness(),j={stroke_width:i};this.closingLine=new c(this.group,j),this.closingLine.render(0,h,0,this.getClosingLineY())}},g.getUpperLineY=function(){var b=this.getHeight();if(this.isAbove())return-b/4*3;if(this.isBelow())return-b/4*1;throw new a("Unexpected")},g.getClosingLineY=function(){var b=this.getHeight();if(this.isAbove())return 0;if(this.isBelow())return-b;throw new a("Unexpected")},g.move=function(){null!==this.posX&&null!==this.posY&&this.group.attr("transform","translate ("+this.posX+", "+this.posY+")")},g.isRendered=function(){return null!==this.group},g.getWidth=function(){var a=this.getX();return this.getRightAnchor().getX()-a},g.getHeight=function(){return this.sizeText.getHeight()},g.getX=function(){return this.getLeftAnchor().getX()},g.getY=function(){return this.getLeftAnchor().getY()},g.getGroup=function(){return this.group}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Drawer.octaveShift.OctaveShift,c=Adagio.Drawer.octaveShift.OctaveShiftsLinkerLax=function(){},d=c.prototype;d.reset=function(){this.pendingOctaveShift=null,this.octaveShifts=[],this.anchors=[],this.currentMeasureIdx=null},d.parseMeasuresOctaveShifts=function(a){return this.reset(),a.forEach(this.parseMeasureOctaveShiftAnchors,this),this.createOctaveShifts(),this.octaveShifts},d.parseMeasureOctaveShiftAnchors=function(a,b,c){this.currentMeasureIdx=b;var d=0===b,e=b===c.length-1;a.hasLeftOctaveShiftAnchor()&&this.updateLeftAnchor(a.getLeftOctaveShiftAnchor(),d);var f=a.getMiddleOctaveShiftsAnchors();this.addAnchors(f),a.hasRightOctaveShiftAnchor()&&this.updateRightAnchor(a.getRightOctaveShiftAnchor(),e)},d.updateLeftAnchor=function(a,b){if(b)this.addAnchor(a);else if(a.hasOctaveShift()){var c=a.getOctaveShift();c.erase()}},d.updateRightAnchor=function(a,b){if(b)this.addAnchor(a);else if(a.hasOctaveShift()){var c=a.getOctaveShift();c.erase()}},d.addAnchors=function(a){a.forEach(this.addAnchor,this)},d.addAnchor=function(a){this.anchors.push(a)},d.createOctaveShifts=function(){this.anchors.forEach(this.useAnchor,this),this.hasPendingOctaveShift()&&this.discardPendingOctaveShift()},d.useAnchor=function(b){if(b.isLeft())this.openPendingOctaveShift(b);else{if(!b.isRight())throw new a("Unexpected");this.closePending(b)}},d.openPendingOctaveShift=function(a){this.hasPendingOctaveShift()&&this.discardPendingOctaveShift();var c;a.hasOctaveShift()?c=a.getOctaveShift():(c=new b,c.setLeftAnchor(a)),this.pendingOctaveShift=c},d.discardPendingOctaveShift=function(){this.pendingOctaveShift.erase(),this.pendingOctaveShift=null},d.closePending=function(a){if(this.hasPendingOctaveShift()){this.removeOctaveShiftIfDifferentFromPending(a);var b=this.getPendingOctaveShift();a.hasOctaveShift()||b.setRightAnchor(a),this.octaveShifts.push(b),this.pendingOctaveShift=null}else a.hasOctaveShift()&&a.removeOctaveShift()},d.removeOctaveShiftIfDifferentFromPending=function(a){if(a.hasOctaveShift()){a.getOctaveShift()!==this.getPendingOctaveShift()&&a.removeOctaveShift()}},d.hasPendingOctaveShift=function(){return null!==this.pendingOctaveShift},d.getPendingOctaveShift=function(){return this.pendingOctaveShift}}.call(this),function(){"use strict";var a=Adagio.Drawer.octaveShift.OctaveShiftsLinkerLax,b=Adagio.Brush.Elem,c=Adagio.Drawer.octaveShift.StaffOctaveShifts=function(){this.init()};c.cssClass="staffOctaveShifts";var d=c.prototype;d.cssClass=c.cssClass,d.init=function(){this.octaveShiftsLinker=new a,this.octaveShifts=[],this.drawingContext=null,this.staffData=null,this.posY=null,this.parent=null,this.group=null},d.setStaffData=function(a){this.staffData=a},d.updateMeasuresOctaveShifts=function(a){this.octaveShifts=this.octaveShiftsLinker.parseMeasuresOctaveShifts(a),this.octaveShifts.forEach(this.transferDrawingContext,this),this.octaveShifts.forEach(this.transferStaffData,this),this.isRendered()&&this.octaveShifts.forEach(this.transfertParent,this)},d.transfertParent=function(a){a.setParent(this.group)},d.transferStaffData=function(a){a.setStaffData(this.staffData)},d.removeMeasure=function(a){a.getAllOctaveShiftsAnchors().forEach(this.unbindAnchor,this)},d.unbindAnchor=function(a){if(a.hasOctaveShift()){var b=a.getOctaveShift();this.removeOctaveShift(b)}},d.removeOctaveShift=function(a){var b=this.octaveShifts.indexOf(a);this.octaveShifts.splice(b,1),a.erase()},d.setPosition=function(a){this.posY=a},d.setDrawingContext=function(a){this.drawingContext=a,this.octaveShifts.forEach(this.transferDrawingContext,this)},d.transferDrawingContext=function(a){a.setDrawingContext(this.drawingContext)},d.setParent=function(a){this.parent=a},d.draw=function(){this.renderIfNeeded(),this.octaveShifts.forEach(this.drawEntity),this.move(),this.bindToParent()},d.renderIfNeeded=function(){this.isRendered()||this.render()},d.isRendered=function(){return null!==this.group},d.render=function(){this.group=new b("g"),this.group.attr("class",this.cssClass),this.octaveShifts.forEach(this.transfertParent,this)},d.move=function(){this.isRendered()&&this.group.attr("transform","translate(0 ,"+this.posY+")")},d.bindToParent=function(){null!==this.parent&&this.parent.append(this.group)},d.drawEntity=function(a){a.draw()},d.updateVerticalDisplay=function(){this.octaveShifts.forEach(this.updateVerticalDisplayEntity)},d.updateVerticalDisplayEntity=function(a){a.updateVerticalDisplay()},d.updateHorizontalDisplay=function(){this.octaveShifts.forEach(this.updateHorizontalDisplayEntity)},d.updateHorizontalDisplayEntity=function(a){a.updateHorizontalDisplay()},d.getOctaveShifts=function(){return this.octaveShifts},d.getGroup=function(){return this.group}}.call(this),function(){"use strict";var a=Adagio.Utils.noteLocationUtils;Adagio.Drawer.slur.extractCrossPoints=function(i,j,k){for(var l={above:[],below:[]},m=j.getLocation(),n=k.getLocation(),o=a.copy(m);!o.endReached;)if(g(i,o)){var p=d(i,o),q=e(i,o),r=f(q,o,m,n);p+=r;var s=b(q),t={x:p,y:s};l.above.push(t);var u=c(q),v={x:p,y:u};l.below.push(v),h(i,o,n)}else h(i,o,n);return l};var b=function(a){var b=a.drawingContext,c=b.getMarginSize(),d=-c,e=a.getHighestTupletY()-c;return Math.min(d,e)},c=function(a){var b=a.getNbStaffLines(),c=a.drawingContext,d=a.isTabStaff()?c.getTabSpaceSize():c.getSpaceSize(),e=c.getMarginSize(),f=(b-.5)*d,g=a.getLowestTupletY()+e;return Math.max(f,g)},d=function(a,b){return a.getMeasure(b.measureIdx).getNoteX(b.voiceIdx,b.noteIdx)},e=function(a,b){return a.getMeasure(b.measureIdx).getNote(b.voiceIdx,b.noteIdx)},f=function(b,c,d,e){var f=b.getMiddleHeadWidth();return a.isEqual(c,d)?0:a.isEqual(c,e)?f:f/2},g=function(a,b){var c=a.getMeasure(b.measureIdx),d=c.getNbNotes(b.voiceIdx);return b.noteIdx<d&&b.noteIdx>=0},h=function(b,c,d){if(a.isGreaterOrEqual(c,d))return void(c.endReached=!0);c.noteIdx++;var e=b.getMeasure(c.measureIdx),f=e.getNbNotes(c.voiceIdx);for(c.noteIdx>=f&&(c.measureIdx++,c.noteIdx=0),e=b.getMeasure(c.measureIdx);!e.hasVoice(c.voiceIdx);)c.measureIdx++,e=b.getMeasure(c.measureIdx)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError;(Adagio.Values.SlurPlacement={ABOVE:"above",BELOW:"below"}).raiseError=function(b){throw new a("BadSlurPlacement","Invalid value for slur placement: ["+b+"].")}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError;Adagio.Drawer.slur.splitHull=function(a,d,e,f,g){return{above:b(a,d,e),below:c(a,f,g)}};var b=function(a,b,c){var f=a.indexOf(c);d(f);var g=a.indexOf(b);d(g);var h=e(a,f,g+1);return h.reverse(),h},c=function(a,b,c){var f=a.indexOf(b);d(f);var g=a.indexOf(c);return d(g),e(a,f,g+1)},d=function(b){if(-1===b){throw new a("PointNotFound","an extreme point is outside the hull.")}},e=function(a,b,c){if(c>b)return a.slice(b,c);var d=a.slice(b),e=a.slice(0,c);return d.concat(e)}}.call(this),function(){"use strict";Adagio.math.calcConvexPolygonArea.triangulateConvexPolygon=function(a){for(var b=a.length,c=[],d=a[0],e=1;e+1<b;e++){var f=a[e],g=a[e+1],h=[d,f,g];c.push(h)}return c}}.call(this),function(){"use strict";var a=Adagio.math.calcVector,b=Adagio.math.calcCrossProductZ;Adagio.math.calcConvexPolygonArea.calcTriangleArea=function(c){var d=a(c[0],c[1]),e=a(c[0],c[2]),f=b(d,e);return Math.abs(f)/2}}.call(this),function(){"use strict";var a=Adagio.Utils.math,b=Adagio.math.calcConvexPolygonArea.triangulateConvexPolygon,c=Adagio.math.calcConvexPolygonArea.calcTriangleArea;Adagio.math.calcConvexPolygonArea.calcConvexPolygonArea=function(d){return d.length<=2?0:b(d).map(c).reduce(a.add)}}.call(this),function(){"use strict";var a=Adagio.Values.SlurPlacement,b=Adagio.math.calcConvexPolygonArea.calcConvexPolygonArea;Adagio.Drawer.slur.chooseBiggestHull=function(c,d){return b(c)>b(d)?a.ABOVE:a.BELOW}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Values.Stem,c=Adagio.Values.SlurPlacement,d=Adagio.Values.StemStrategy,e=Adagio.Drawer.slur.chooseBiggestHull;Adagio.Drawer.slur.choosePlacement=function(f,g,h){if(g===d.UP)return c.ABOVE;if(g===d.DOWN)return c.BELOW;if(g!==d.AUTO)throw new a("Unexpected");return f===b.DOWN?c.ABOVE:f===b.UP?e(h.above,h.below):void b.raiseError(f)}}.call(this),function(){"use strict";Adagio.math.calcDotProduct=function(a,b){return a.x*b.x+a.y*b.y}}.call(this),function(){"use strict";var a=Adagio.math.calcNorm,b=Adagio.math.calcDotProduct;Adagio.math.calcVectorsCosine=function(c,d){var e=a(c),f=a(d);return b(c,d)/(e*f)}}.call(this),function(){"use strict";Adagio.math.createVector=function(a,b){return{x:a,y:b}}}.call(this),
function(){"use strict";var a=Adagio.math.createVector;Adagio.math.calcRotatedVector=function(b,c){var d=Math.cos(c),e=Math.sin(c),f=b.x*d-b.y*e,g=b.x*e+b.y*d;return a(f,g)}}.call(this),function(){"use strict";var a=Adagio.Values.SlurPlacement,b=Adagio.Utils.math,c=Adagio.math.calcVector,d=Adagio.math.calcVectorsCosine,e=Adagio.math.calcRotatedVector,f=b.degreesToGradians(30),g=Math.PI-f,h=Math.cos(g);Adagio.Drawer.slur.computeControlVectors=function(a,b){var c=i(a);return j(c)&&k(c,b),c};var i=function(a){var b=a.length,d=a[0],e=a[1],f=a[b-1],g=a[b-2];return{left:c(d,e),right:c(f,g)}},j=function(a){return d(a.left,a.right)<h},k=function(a,b){var c=l(b),d=c*f/2,g=-d;a.left=e(a.left,d),a.right=e(a.right,g),a.increased=!0},l=function(b){return b===a.ABOVE?-1:b===a.BELOW?1:void a.raiseError(b)}}.call(this),function(){"use strict";Adagio.math.scaleVectorX=function(a,b){var c=b/a.x;a.x*=c,a.y*=c}}.call(this),function(){"use strict";var a=Adagio.math.createVector;Adagio.math.addVectors=function(b,c){var d=b.x+c.x,e=b.y+c.y;return a(d,e)}}.call(this),function(){"use strict";var a=Adagio.math.scaleVectorX,b=Adagio.math.addVectors,c=1/3;Adagio.Drawer.slur.computeControlPoints=function(d,e,f){var g=d.length,h=d[0],i=d[g-1],j=i.x-h.x;if(e.increased){var k=f.getSpaceSize();j=Math.min(j,24*k)}return a(e.left,j*c),a(e.right,-j*c),{left:b(h,e.left),right:b(i,e.right)}}}.call(this),function(){"use strict";Adagio.Drawer.slur.computeBezierPath=function(a,b,c,d,e,f){return"M "+a.x+" "+(a.y-e)+" C "+b.x+" "+(b.y-f)+" "+c.x+" "+(c.y-f)+" "+d.x+" "+(d.y-e)+" L "+d.x+" "+(d.y+e)+" C "+c.x+" "+(c.y+f)+" "+b.x+" "+(b.y+f)+" "+a.x+" "+(a.y+e)+" Z"}}.call(this),function(){"use strict";var a=Adagio.Values.SlurPlacement,b=Adagio.math.grahamScan.grahamScan,c=Adagio.Drawer.slur.splitHull,d=Adagio.Drawer.slur.choosePlacement,e=Adagio.Drawer.slur.computeControlVectors,f=Adagio.Drawer.slur.computeControlPoints,g=Adagio.Drawer.slur.computeBezierPath;Adagio.Drawer.slur.computeBezierData=function(a,i,j,k,l){var m={},n=a.length,o=a[0],p=a[n-1],q=i[0],r=i[n-1],s=a.concat(i),t=b(s),u=c(t,o,p,q,r);m.placement=d(j,k,u),t=h(m.placement,u);var v=e(t,m.placement),w=f(t,v,l);m.controlPoint1=w.left,m.controlPoint2=w.right;var x=l.getSlurEndpointThickness(),y=l.getSlurMidpointThickness(),z=t.length,A=t[0],B=t[z-1],C=g(A,w.left,w.right,B,x,y);return m.leftPoint=A,m.rightPoint=B,m.pathStr=C,m};var h=function(b,c){return b===a.ABOVE?c.above:b===a.BELOW?c.below:void a.raiseError(b)}}.call(this),function(){"use strict";Adagio.math.cubicBezier.calcBBox=function(a){for(var b,c,d,e,f,g,h,i,j=[],k=[[],[]],l=0;l<2;++l)if(0===l?(c=6*a[0].x-12*a[1].x+6*a[2].x,b=-3*a[0].x+9*a[1].x-9*a[2].x+3*a[3].x,d=3*a[1].x-3*a[0].x):(c=6*a[0].y-12*a[1].y+6*a[2].y,b=-3*a[0].y+9*a[1].y-9*a[2].y+3*a[3].y,d=3*a[1].y-3*a[0].y),Math.abs(b)<1e-12){if(Math.abs(c)<1e-12)continue;0<(e=-d/c)&&e<1&&j.push(e)}else h=c*c-4*d*b,i=Math.sqrt(h),h<0||(f=(-c+i)/(2*b),0<f&&f<1&&j.push(f),0<(g=(-c-i)/(2*b))&&g<1&&j.push(g));for(var m,n=j.length,o=n;n--;)e=j[n],m=1-e,k[0][n]=m*m*m*a[0].x+3*m*m*e*a[1].x+3*m*e*e*a[2].x+e*e*e*a[3].x,k[1][n]=m*m*m*a[0].y+3*m*m*e*a[1].y+3*m*e*e*a[2].y+e*e*e*a[3].y;return k[0][o]=a[0].x,k[1][o]=a[0].y,k[0][o+1]=a[3].x,k[1][o+1]=a[3].y,k[0].length=k[1].length=o+2,{min:{x:Math.min.apply(0,k[0]),y:Math.min.apply(0,k[1])},max:{x:Math.max.apply(0,k[0]),y:Math.max.apply(0,k[1])}}}}.call(this),function(){"use strict";var a=Adagio.Values.SlurPlacement,b=Adagio.Brush.Elem,c=Adagio.Drawer.slur.computeBezierData,d=Adagio.math.cubicBezier.calcBBox,e=Adagio.Drawer.slur.SlurCurve=function(){this.init()};e.cssClass="slurCurve";var f=e.prototype;f.cssClass=e.cssClass,f.init=function(){this.abovePoints=null,this.belowPoints=null,this.firstStem=null,this.stemStrategy=null,this.drawingContext=null,this.bBox=null,this.bezierData=null,this.drawn=!1,this.path=null,this.parent=null},f.setData=function(a,b,c,d){this.abovePoints=a,this.belowPoints=b,this.firstStem=c,this.stemStrategy=d,this.bezierData=null,this.bBox=null},f.setParent=function(a){this.parent!==a&&(this.drawn=!1),this.parent=a,this.isRendered()&&this.bindToParent()},f.setDrawingContext=function(a){this.drawingContext=a},f.draw=function(){if(this.renderIfNeeded(),this.hasData()){var a=this.getPathStr();this.path.attr("d",a)}this.bindToParent()},f.renderIfNeeded=function(){this.isRendered()||this.render()},f.isRendered=function(){return null!==this.path},f.render=function(){if(this.path=new b("path"),this.path.attr("class",this.cssClass),this.hasData()){var a=this.getPathStr();this.path.attr("d",a)}},f.bindToParent=function(){this.drawn||(this.parent.append(this.path),this.drawn=!0)},f.unbindFromParent=function(){this.drawn&&(this.path.removeFromParent(),this.drawn=!1)},f.updateHorizontalDisplay=function(){if(this.isRendered()&&this.hasData()){var a=this.getPathStr();this.path.attr("d",a)}},f.hasData=function(){return null!==this.abovePoints&&null!==this.belowPoints&&null!==this.firstStem&&null!==this.stemStrategy},f.getTopY=function(){var b=this.getBBox(),c=this.getPlacement();if(c===a.ABOVE){return this.getBottomPointY()-b}if(c===a.BELOW)return this.getTopPointY();a.raiseError(c)},f.getBottomY=function(){var b=this.getBBox(),c=this.getPlacement();if(c===a.ABOVE)return this.getBottomPointY();if(c===a.BELOW){return this.getTopPointY()+b}a.raiseError(c)},f.getPlacement=function(){return this.getBezierData().placement},f.getBottomPointY=function(){var a=this.getBezierData(),b=a.leftPoint.y,c=a.rightPoint.y;return Math.max(b,c)},f.getTopPointY=function(){var a=this.getBezierData(),b=a.leftPoint.y,c=a.rightPoint.y;return Math.min(b,c)},f.getBBox=function(){return null===this.bBox&&this.calcBBox(),this.bBox},f.calcBBox=function(){var a=this.getBezierData(),b=[a.leftPoint,a.controlPoint1,a.controlPoint2,a.rightPoint];this.bBox=d(b)},f.getPathStr=function(){return this.getBezierData().pathStr},f.getBezierData=function(){return null===this.bezierData&&this.calcBezierData(),this.bezierData},f.calcBezierData=function(){this.bezierData=c(this.abovePoints,this.belowPoints,this.firstStem,this.stemStrategy,this.drawingContext)},f.getGroup=function(){return this.path}}.call(this),function(){"use strict";var a=Adagio.Drawer.slur.extractCrossPoints,b=Adagio.Drawer.slur.SlurCurve,c=Adagio.Brush.Elem,d=Adagio.Utils.staffDataUtils,e=Adagio.Values.SlurPlacement,f=Adagio.Drawer.slur.SlurCrossMeasure=function(){this.init()};f.cssClass="slur";var g=f.prototype;g.cssClass=f.cssClass,g.init=function(){this.leftAnchor=null,this.rightAnchor=null,this.staff=null,this.curve=new b,this.drawingContext=null,this.staffData=null,this.parent=null,this.group=null,this.needDrawUpdate=!0,this.drawn=!1},g.setStaff=function(a){this.staff=a},g.setParent=function(a){this.parent=a},g.setCssClass=function(a){this.cssClass=a},g.setStaffData=function(a){this.staffData=a},g.setLeftAnchor=function(a){this.hasLeftAnchor()&&this.leftAnchor!==a&&this.removeLeftAnchor(),this.leftAnchor=a,this.leftAnchor.slur=this},g.hasLeftAnchor=function(){return null!==this.leftAnchor},g.removeLeftAnchor=function(){this.hide(),this.leftAnchor.slur=null,this.leftAnchor=null},g.setRightAnchor=function(a){this.hasRightAnchor()&&this.rightAnchor!==a&&this.removeRightAnchor(),this.rightAnchor=a,this.rightAnchor.slur=this},g.hasRightAnchor=function(){return null!==this.rightAnchor},g.removeRightAnchor=function(){this.hide(),this.rightAnchor.slur=null,this.rightAnchor=null},g.hide=function(){this.drawn&&this.unbindFromParent()},g.setDrawingContext=function(a){this.drawingContext=a,this.curve.setDrawingContext(this.drawingContext)},g.updateCurveHorizontal=function(){if(!this.hasMissingPosition()){var b=this.getLeftAnchor(),c=b.getStemStrategy(),d=b.getFirstStem(),e=this.getRightAnchor(),f=this.getStaff(),g=a(f,b,e);if(b.hasCrossMeasure()){var j=b.getLeftCrossPoints();i(g,j)}if(e.hasCrossMeasure()){var k=e.getRightCrossPoints();h(g,k)}this.curve.setData(g.above,g.below,d,c),this.needDrawUpdate=!1}},g.hasMissingPosition=function(){for(var a=this.getLeftMeasureIdx(),b=this.getRightMeasureIdx(),c=this.getStaff(),d=a;d<=b;d++){if(null===c.getMeasure(d).getXPos())return!0}return!1},g.getStaff=function(){return this.staff};var h=function(a,b){Array.prototype.push.apply(a.above,b.above),Array.prototype.push.apply(a.below,b.below)},i=function(a,b){Array.prototype.unshift.apply(a.above,b.above),Array.prototype.unshift.apply(a.below,b.below)};g.getLeftAnchor=function(){return this.leftAnchor},g.getRightAnchor=function(){return this.rightAnchor},g.setNeedDrawUpdate=function(){this.needDrawUpdate=!0},g.updateHorizontalDisplay=function(){this.isRendered()||this.render(),this.needDrawUpdate&&this.updateCurveHorizontal(),this.curve.draw(),this.bindToParent()},g.updateVerticalDisplay=function(){this.isRendered()||this.render(),this.curve.draw(),this.bindToParent()},g.draw=function(){this.bindToParent()},g.isRendered=function(){return null!==this.group},g.render=function(){this.group=new c("g"),this.group.attr("class",this.cssClass),this.curve.setParent(this.group)},g.bindToParent=function(){null!==this.parent&&(this.parent.append(this.getGroup()),this.drawn=!0)},g.getGroup=function(){return this.group},g.erase=function(){this.hide(),this.hasLeftAnchor()&&this.removeLeftAnchor(),this.hasRightAnchor()&&this.removeRightAnchor()},g.unbindFromParent=function(){this.group.removeFromParent(),this.drawn=!1},g.isComplete=function(){return this.hasLeftAnchor()&&this.hasRightAnchor()},g.getGroup=function(){return this.group},g.getLeftMeasureIdx=function(){return this.getLeftAnchor().getMeasureIdx()},g.getRightMeasureIdx=function(){return this.getRightAnchor().getMeasureIdx()},g.getUpOverflow=function(){return-this.curve.getBBox().min.y},g.getDownOverflow=function(){var a=this.drawingContext.getSpaceSize(),b=a*(this.getNbStaffLines()-1);return this.curve.getBBox().max.y-b},g.getNbStaffLines=function(){return d.getNbStaffLines(this.staffData)},g.isAbove=function(){return this.curve.getPlacement()===e.ABOVE},g.isBelow=function(){return this.curve.getPlacement()===e.BELOW}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Drawer.slur.SlurCrossMeasure,c=Adagio.Drawer.slur.SlursLinkerLax=function(){},d=c.prototype;d.reset=function(a){this.pendingSlur=null,this.slurs=[],this.anchors=[],this.currentMeasureIdx=null,this.voiceIdx=a},d.setStaff=function(a){this.staff=a},d.parseMeasuresSlurs=function(a,b){return this.reset(b),a.forEach(this.parseMeasureSlurAnchors,this),this.createSlurs(),this.slurs},d.parseMeasureSlurAnchors=function(a,b,c){this.currentMeasureIdx=b;var d=0===b,e=b===c.length-1;a.hasLeftSlurAnchor(this.voiceIdx)&&this.updateLeftAnchor(a.getLeftSlurAnchor(this.voiceIdx),d);var f=a.getMiddleSlursAnchors(this.voiceIdx);this.addAnchors(f),a.hasRightSlurAnchor(this.voiceIdx)&&this.updateRightAnchor(a.getRightSlurAnchor(this.voiceIdx),e)},d.updateLeftAnchor=function(a,b){if(b)this.addAnchor(a);else if(a.hasSlur()){var c=a.getSlur();c.erase()}},d.updateRightAnchor=function(a,b){if(b)this.addAnchor(a);else if(a.hasSlur()){var c=a.getSlur();c.erase()}},d.addAnchors=function(a){a.forEach(this.addAnchor,this)},d.addAnchor=function(a){a.setMeasureIdx(this.currentMeasureIdx),this.anchors.push(a)},d.createSlurs=function(){this.anchors.forEach(this.useAnchor,this),this.hasPendingSlur()&&this.discardPendingSlur()},d.useAnchor=function(b){if(b.isLeft())this.openPendingSlur(b);else{if(!b.isRight(b))throw new a("Unexpected");this.closePending(b)}},d.openPendingSlur=function(a){this.hasPendingSlur()&&this.discardPendingSlur();var c;a.hasSlur()?c=a.getSlur():(c=new b,c.setStaff(this.staff),c.setLeftAnchor(a)),this.pendingSlur=c},d.discardPendingSlur=function(){this.pendingSlur.erase(),this.pendingSlur=null},d.closePending=function(a){if(this.hasPendingSlur()){this.removeSlurIfDifferentFromPending(a);var b=this.getPendingSlur();a.hasSlur()||b.setRightAnchor(a),this.slurs.push(b),this.pendingSlur=null}else a.hasSlur()&&a.removeSlur()},d.hasPendingSlur=function(){return null!==this.pendingSlur},d.removeSlurIfDifferentFromPending=function(a){if(a.hasSlur()){a.getSlur()!==this.getPendingSlur()&&a.removeSlur()}},d.getPendingSlur=function(){return this.pendingSlur}}.call(this),function(){"use strict";var a=Adagio.Drawer.slur.SlursLinkerLax,b=Adagio.Brush.Elem,c=Adagio.Drawer.slur.StaffSlurs=function(a){this.init(a)};c.cssClass="staffSlurs slurs-";var d=c.prototype;d.cssClass=c.cssClass,d.init=function(b){this.voiceIdx=b,this.slursLinker=new a,this.slurs=[],this.drawingContext=null,this.staffData=null,this.posY=null,this.parent=null,this.group=null},d.setStaff=function(a){this.slursLinker.setStaff(a)},d.updateMeasuresSlurs=function(a){this.slurs=this.slursLinker.parseMeasuresSlurs(a,this.voiceIdx),this.slurs.forEach(this.transferDrawingContext,this),this.slurs.forEach(this.transferStaffData,this),this.isRendered()&&this.slurs.forEach(this.transfertParent,this)},d.transfertParent=function(a){a.setParent(this.group)},d.removeMeasure=function(a){a.getAllSlursAnchors(this.voiceIdx).forEach(this.unbindAnchor,this)},d.unbindAnchor=function(a){if(a.hasSlur()){var b=a.getSlur();this.removeSlur(b)}},d.removeSlur=function(a){var b=this.slurs.indexOf(a);this.slurs.splice(b,1),a.erase()},d.setPosition=function(a){this.posY=a},d.setDrawingContext=function(a){this.drawingContext=a,this.slurs.forEach(this.transferDrawingContext,this)},d.transferDrawingContext=function(a){a.setDrawingContext(this.drawingContext)},d.setStaffData=function(a){this.staffData=a,this.slurs.forEach(this.transferStaffData,this)},d.transferStaffData=function(a){a.setStaffData(this.staffData)},d.setParent=function(a){this.parent=a},d.draw=function(){this.renderIfNeeded(),this.slurs.forEach(e),this.move(),this.bindToParent()},d.renderIfNeeded=function(){this.isRendered()||this.render()},d.isRendered=function(){return null!==this.group},d.render=function(){this.group=new b("g"),this.group.attr("class",this.cssClass+this.voiceIdx),this.slurs.forEach(this.transfertParent,this)},d.move=function(){this.isRendered()&&this.group.attr("transform","translate(0, "+this.posY+")")},d.bindToParent=function(){null!==this.parent&&this.parent.append(this.group)};var e=function(a){a.draw()};d.updateVerticalDisplay=function(){this.slurs.forEach(f)};var f=function(a){a.updateVerticalDisplay()};d.updateHorizontalDisplay=function(){this.slurs.forEach(g)};var g=function(a){a.updateHorizontalDisplay()};d.getSlurs=function(){return this.slurs},d.getGroup=function(){return this.group}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Drawer.Line,c=Adagio.Brush.Elem,d=Adagio.Utils.staffDataUtils,e=Adagio.Drawer.StaffLines=function(){return this.init(),this};e.cssClass="staffLines";var f=e.prototype;f.cssClass=e.cssClass,f.init=function(){this.lines=[],this.drawingContext=null,this.staffData=null,this.posY=null,this.width=null,this.parent=null,this.group=null},f.setParent=function(a){this.parent=a},f.setDrawingContext=function(a){this.drawingContext=a},f.setStaffData=function(a){this.staffData=a},f.getStaffData=function(){return null===this.staffData&&(this.staffData=d.createDefault()),this.staffData},f.isTabStaff=function(){var a=this.getStaffData();return d.isTabStaff(a)},f.setWidth=function(a){a!==this.width&&(this.width=a,this.isRendered()&&this.updateWidth())},f.updateWidth=function(){this.lines.forEach(this.updateLineWidth,this)},f.updateLineWidth=function(a){a.setX2(this.width)},f.setPosition=function(a){this.posY=a},f.draw=function(){this.renderIfNeeded(),this.drawLines(),this.move(),this.bindToParent()},f.drawLines=function(){this.lines.forEach(g)};var g=function(a){a.draw()};f.move=function(){this.isRendered()&&this.group.attr("transform","translate(0, "+this.posY+")")},f.bindToParent=function(){this.parent.append(this.group)},f.renderIfNeeded=function(){this.isRendered()||this.render()},f.isRendered=function(){return null!==this.group},f.render=function(){this.createGroup(),this.createLines()},f.createGroup=function(){this.group=new c("g"),this.group.attr("class",this.cssClass)},f.createLines=function(){for(var a=0;a<this.getDisplayedNbStaffLines();a++)this.createLine(a)},f.createLine=function(a){var c=this.getLineY(a),d=this.getStaffLineThickness(),e={stroke_width:d},f=new b(this.group,e);f.render(0,c,this.width,c),this.lines.push(f)},f.getLineY=function(b){var c=this.getDisplayedNbStaffLines(),d=this.getSpaceSize();if(this.isTabStaff())return d*b;if(5===c)return d*b;if(3===c)return d*b*2;if(1===c)return 2*d;throw new a("Unexpected","The number of staff line ["+c+"] is not supported for a non tab staff.")},f.getDisplayedNbStaffLines=function(){var a=this.getStaffData();return d.getDisplayedNbStaffLines(a)},f.getSpaceSize=function(){return this.isTabStaff()?this.drawingContext.getTabSpaceSize():this.drawingContext.getSpaceSize()},f.getStaffLineThickness=function(){return this.drawingContext.getStaffLineThickness()},f.getGroup=function(){return this.group},f.getWidth=function(){return this.width}}.call(this),function(){"use strict";var a=Adagio.Drawer.glissando.Glissando,b=Adagio.Drawer.glissando.GlissandoDisplayData,c=Adagio.Utils.geometryUtils,d=Adagio.Utils.mapUtils,e=Adagio.Brush.Elem,f=Adagio.Drawer.glissando.CrossMeasureGlissando=function(a){this.init(a)},g=f.prototype;g.cssClass="crossMeasureGlissando",g.init=function(){this.drawn=!1,this.leftAnchor=null,this.rightAnchor=null,this.group=null,this.parent=null,this.drawingContext=null,this.glissandos={},this.displayData=new b},g.setLeftAnchor=function(a){this.leftAnchor=a,this.leftAnchor.setGlissando(this),this.displayData.setLeftNote(a.getNote().getDisplayData())},g.setRightAnchor=function(a){this.rightAnchor=a,this.rightAnchor.setGlissando(this),this.displayData.setRightNote(a.getNote().getDisplayData())},g.setParent=function(a){this.parent=a},g.setDrawingContext=function(a){this.drawingContext=a},g.needRender=function(){return null===this.group},g.render=function(){this.group=new e("g"),this.group.attr("class",this.cssClass)},g.draw=function(){this.needRender()&&this.render();var a=this.getGlissandos();d.forEach(a,this.drawGlissando),this.bindToParent()},g.getGlissandos=function(){return this.displayData.getGlissandoStarts().forEach(function(b,c){var d=this.getRightGlissandoData(b);if(void 0!==d){var e,f=b.line,g=d.line;void 0!==this.glissandos[c]?e=this.glissandos[c]:(e=new a,this.glissandos[c]=e),e.setDrawingContext(this.drawingContext),e.setParent(this.group),e.setPosX1(this.getLeftPosX()),e.setPosY1(this.lineToY(f)),e.setPosX2(this.getRightPosX()),e.setPosY2(this.lineToY(g))}},this),this.glissandos},g.getRightGlissandoData=function(a){var b=this.displayData.getGlissandoStops(),c=a.number;return b.find(function(a){var b=a.number;return c===b})},g.getLeftPosX=function(){var a=this.leftAnchor.getNote(),b=this.leftAnchor.getMeasure(),c=b.tickableContent;return b.getXPos()+c.getXPos()+a.getXPos()+a.getMiddleHeadWidth()+this.drawingContext.getGlissandoHorizontalMargin()},g.getRightPosX=function(){var a=this.rightAnchor.getNote(),b=this.rightAnchor.getMeasure(),c=b.tickableContent;return b.getXPos()+c.getXPos()+a.getXPos()-this.drawingContext.getGlissandoHorizontalMargin()},g.lineToY=function(a){var b=this.drawingContext.getSpaceSize(),d=this.displayData.getNbStaffLines();return c.lineToY(a,b,d)},g.drawGlissando=function(a,b){b.draw()},g.bindToParent=function(){null!==this.parent&&(this.drawn=!0,this.parent.append(this.group))},g.remove=function(){this.drawn&&this.unbindFromParent(),this.hasLeftAnchor()&&this.removeLeftAnchor(),this.hasRightAnchor()&&this.removeRightAnchor()},g.unbindFromParent=function(){this.group.removeFromParent(),this.drawn=!1},g.hasLeftAnchor=function(){return null!==this.leftAnchor},g.removeLeftAnchor=function(){this.leftAnchor.glissando=null,this.leftAnchor=null},g.hasRightAnchor=function(){return null!==this.rightAnchor},g.removeRightAnchor=function(){this.rightAnchor.glissando=null,this.rightAnchor=null}}.call(this),function(){"use strict";var a=Adagio.Drawer.glissando.Glissando,b=Adagio.Drawer.glissando.GlissandoDisplayData,c=Adagio.Brush.Elem,d=Adagio.Utils.geometryUtils,e=Adagio.Utils.mapUtils,f=Adagio.Drawer.glissando.RightGlissando=function(a){this.init(a)},g=f.prototype;g.cssClass="rightGlissando",g.init=function(a){this.anchor=a,this.anchor.setGlissando(this),this.group=null,this.parent=null,this.drawingContext=null,this.glissandos={},this.displayData=new b,this.initDisplayData()},g.initDisplayData=function(){var a=this.anchor.getNote().getDisplayData(),b=this.anchor.getRightNote();this.displayData.setLeftNote(a),this.displayData.setRightNote(b)},g.setParent=function(a){this.parent=a},g.setDrawingContext=function(a){this.drawingContext=a},g.needRender=function(){return null===this.group},g.render=function(){this.group=new c("g"),this.group.attr("class",this.cssClass)},g.draw=function(){this.needRender()&&this.render();var a=this.getGlissandos();e.forEach(a,this.drawGlissando),this.bindToParent()},g.getGlissandos=function(){return this.displayData.getGlissandoStarts().forEach(function(b,c){var d=this.getRightGlissandoData(b);if(void 0!==d){var e=void 0!==this.glissandos[c]?this.glissandos[c]:new a,f=b.line,g=d.line;e.setDrawingContext(this.drawingContext),e.setParent(this.group),e.setPosX1(this.getLeftPosX()),e.setPosY1(this.lineToY(f)),e.setPosX2(this.getRightPosX()),e.setPosY2(this.lineToY(g)),this.glissandos[c]=e}},this),this.glissandos},g.updateHorizontalDisplay=function(){if(null!==this.glissandos){this.displayData.getGlissandoStarts().forEach(function(a,b){var c=this.getRightGlissandoData(a);if(void 0!==c){var d=this.glissandos[b],e=a.line,f=c.line;d.setPosX1(this.getLeftPosX()),d.setPosY1(this.lineToY(e)),d.setPosX2(this.getRightPosX()),d.setPosY2(this.lineToY(f)),d.update()}},this)}},g.getRightGlissandoData=function(a){var b=this.displayData.getGlissandoStops(),c=a.number;return b.find(function(a){var b=a.number;return c===b})},g.getLeftPosX=function(){var a=this.anchor.getNote(),b=this.anchor.getMeasure(),c=b.tickableContent;return b.getXPos()+c.getXPos()+a.getXPos()+a.getMiddleHeadWidth()},g.getRightPosX=function(){var a=this.anchor.getMeasure();return a.getXPos()+a.getWidth()-this.drawingContext.getGlissandoHorizontalMargin()},g.bindToParent=function(){null!==this.parent&&this.parent.append(this.group)},g.drawGlissando=function(a,b){b.draw()},g.lineToY=function(a){var b=this.drawingContext.getSpaceSize(),c=this.displayData.getNbStaffLines();return d.lineToY(a,b,c)},g.remove=function(){this.needRender()||this.group.removeFromParent()}}.call(this),function(){"use strict";var a=Adagio.Drawer.glissando.Glissando,b=Adagio.Drawer.glissando.GlissandoDisplayData,c=Adagio.Brush.Elem,d=Adagio.Utils.geometryUtils,e=Adagio.Utils.mapUtils,f=Adagio.Drawer.glissando.LeftGlissando=function(a){this.init(a)},g=f.prototype;g.cssClass="leftGlissando",g.init=function(a){this.anchor=a,this.anchor.setGlissando(this),this.group=null,this.parent=null,this.drawingContext=null,this.glissandos={},this.displayData=new b,this.initDisplayData()},g.initDisplayData=function(){var a=this.anchor.getLeftNote(),b=this.anchor.getNote().getDisplayData();this.displayData.setLeftNote(a),this.displayData.setRightNote(b)},g.setParent=function(a){this.parent=a},g.setDrawingContext=function(a){this.drawingContext=a},g.needRender=function(){return null===this.group},g.render=function(){this.group=new c("g"),this.group.attr("class",this.cssClass)},g.draw=function(){this.needRender()&&this.render();var a=this.getGlissandos();e.forEach(a,this.drawGlissando),this.bindToParent()},g.getGlissandos=function(){return this.displayData.getGlissandoStarts().forEach(function(b,c){var d=this.getRightGlissandoData(b);if(void 0!==d){var e=void 0!==this.glissandos[c]?this.glissandos[c]:new a,f=b.line,g=d.line;e.setDrawingContext(this.drawingContext),e.setParent(this.group),e.setPosX1(this.getLeftPosX()),e.setPosY1(this.lineToY(f)),e.setPosX2(this.getRightPosX()),e.setPosY2(this.lineToY(g)),this.glissandos[c]=e}},this),this.glissandos},g.getRightGlissandoData=function(a){var b=this.displayData.getGlissandoStops(),c=a.number;return b.find(function(a){var b=a.number;return c===b})},g.getLeftPosX=function(){var a=this.anchor.getMeasure(),b=a.getAttributes();return a.getXPos()+b.getWidth()},g.getRightPosX=function(){var a=this.anchor.getNote(),b=this.anchor.getMeasure(),c=b.tickableContent;return b.getXPos()+c.getXPos()+a.getXPos()-this.drawingContext.getGlissandoHorizontalMargin()},g.bindToParent=function(){null!==this.parent&&this.parent.append(this.group)},g.drawGlissando=function(a,b){b.draw()},g.lineToY=function(a){var b=this.drawingContext.getSpaceSize(),c=this.displayData.getNbStaffLines();return d.lineToY(a,b,c)},g.remove=function(){this.needRender()||this.group.removeFromParent()}}.call(this),function(){"use strict";var a=Adagio.Drawer.glissando.CrossMeasureGlissando,b=Adagio.Drawer.glissando.RightGlissando,c=Adagio.Drawer.glissando.LeftGlissando,d=Adagio.Brush.Elem,e=Adagio.Drawer.glissando.StaffGlissandos=function(a){this.init(a)},f=e.prototype;f.cssClass="staffGlissando",f.init=function(a){this.voiceIdx=a,this.drawingContext=null,this.staffData=null,this.posY=null,this.group=null,this.parent=null,this.glissandos=[],this.pendingCrossMeasure=null},f.setDrawingContext=function(a){this.drawingContext=a,this.glissandos.forEach(this.transferDrawingContext,this)},f.setStaffData=function(a){this.staffData=a},f.removeMeasure=function(a){if(a.hasLeftGlissandoAnchor(this.voiceIdx)){var b=a.getLeftGlissandoAnchor(this.voiceIdx);b.hasGlissando()&&this.removeGlissando(b.getGlissando())}if(a.hasRightGlissandoAnchor(this.voiceIdx)){var c=a.getRightGlissandoAnchor(this.voiceIdx);c.hasGlissando()&&this.removeGlissando(c.getGlissando())}},f.setParent=function(a){this.parent=a},f.setPosition=function(a){this.posY=a},f.needRender=function(){return null===this.group},f.hasPendingCrossMeasure=function(){return null!==this.pendingCrossMeasure},f.removeGlissandos=function(){this.glissandos.forEach(this.removeGlissando,this)},f.removeGlissando=function(a){var b=this.glissandos.indexOf(a);this.glissandos.splice(b,1),a.remove()},f.render=function(){this.group=new d("g"),this.group.attr("class",this.cssClass),this.glissandos.forEach(this.transfertParent,this)},f.draw=function(){this.needRender()&&this.render(),this.glissandos.forEach(this.drawGlissando),this.move(),this.bindToParent()},f.bindToParent=function(){null!==this.parent&&this.parent.append(this.group)},f.move=function(){this.needRender()||this.group.attr("transform","translate(0 "+this.posY+")")},f.updateHorizontalDisplay=function(){this.glissandos.forEach(this.drawGlissando)},f.updateMeasuresGlissandos=function(a){this.hasGlissandos()&&this.removeGlissandos(),this.glissandos=this.extractGlissandos(a),this.glissandos.forEach(this.transferDrawingContext,this),this.needRender()||this.glissandos.forEach(this.transfertParent,this)},f.hasGlissandos=function(){return this.glissandos.length>0},f.transfertParent=function(a){a.setParent(this.group)},f.transferDrawingContext=function(a){a.setDrawingContext(this.drawingContext)},f.extractGlissandos=function(a){for(var d=[],e=0;e<a.length;e++){var f=a[e],g=0===e,h=e===a.length-1;if(f.hasLeftGlissandoAnchor(this.voiceIdx)){var i=f.getLeftGlissandoAnchor(this.voiceIdx);g?d.push(new c(i)):this.closePendingCrossMeasure(i,d)}if(f.hasRightGlissandoAnchor(this.voiceIdx)){var j=f.getRightGlissandoAnchor(this.voiceIdx);h?d.push(new b(j)):this.openPendingCrossMeasure(j)}}return d},f.openPendingCrossMeasure=function(b){this.hasPendingCrossMeasure()||(this.pendingCrossMeasure=new a),this.pendingCrossMeasure.setLeftAnchor(b)},f.closePendingCrossMeasure=function(a,b){this.hasPendingCrossMeasure()&&(this.pendingCrossMeasure.setRightAnchor(a),b.push(this.pendingCrossMeasure),this.pendingCrossMeasure=null)},f.drawGlissando=function(a){a.draw()}}.call(this),function(){"use strict";var a=Adagio.Drawer.Line,b=Adagio.Drawer.tempoChange.TempoChangeLine=function(){this.init()};b.cssClass="tempoChangeLine";var c=b.prototype;c.cssClass=b.cssClass,c.init=function(){this.drawingContext=null,this.parent=null,this.line=null,this.x1=0,this.x2=0,this.y1=0,this.y2=0},c.setDrawingContext=function(a){this.drawingContext=a},c.setParent=function(a){this.parent=a},c.setX1=function(a){this.x1=a,this.isRendered()&&this.line.setX1(a)},c.setX2=function(a){this.x2=a,this.isRendered()&&this.line.setX2(a)},c.setY1=function(a){this.y1=a,this.isRendered()&&this.line.setY1(a)},c.setY2=function(a){this.y2=a,this.isRendered()&&this.line.setY2(a)},c.draw=function(){this.isRendered()||this.render(),this.line.draw()},c.render=function(){if(!this.isRendered()){var b=this.drawingContext.getTempoChangeThickness(),c=this.drawingContext.getTempoChangeDashArrayWidth(),d={stroke_width:b,stroke_dasharray:[c,2*c]};this.line=new a(this.parent,d),this.line.render(this.x1,this.y1,this.x2,this.y2)}},c.isRendered=function(){return null!==this.line},c.getHeight=function(){return Math.abs(this.y1-this.y2)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Values.TempoChangeType,c=Adagio.Utils.mapUtils,d=Adagio.Drawer.Text,e=c.fromPairs([{key:b.ACCELERANDO,value:"accel."},{key:b.RITARDANDO,value:"rit."}]),f=Adagio.Drawer.tempoChange.TempoChangeText=function(a){this.init(a)};f.cssClass="tempoChangeText";var g=f.prototype;g.cssClass=f.cssClass,g.init=function(a){this.leftAnchor=null,this.rightAnchor=null,this.type=a,this.drawingContext=null,this.parent=null,this.text=null},g.setParent=function(a){this.parent=a},g.setCssClass=function(a){this.cssClass=a},g.setDrawingContext=function(a){this.drawingContext=a},g.updateHorizontalDisplay=function(){this.isRendered()||this.render(),this.draw()},g.draw=function(){this.text.draw()},g.render=function(){var a=this.getTextValue(),b=new d({"font-family":"Georgia",text:a,"font-style":"italic"});b.setParent(this.parent),b.setDrawingContext(this.drawingContext),b.setFontSize(this.drawingContext.getTempoChangeFontSize()),this.text=b,this.text.render()},g.getTextValue=function(){if(void 0!==e[this.type])return e[this.type];throw new a("Unexpected")},g.getWidth=function(){return this.isRendered()?this.text.getWidth():0},g.getHeight=function(){return this.isRendered()?this.text.getXHeight():0},g.isRendered=function(){return null!==this.text}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Brush.Elem,c=Adagio.Drawer.tempoChange.TempoChangeLine,d=Adagio.Drawer.tempoChange.TempoChangeText,e=Adagio.Drawer.tempoChange.TempoChange=function(){this.init()};e.cssClass="tempoChange";var f=e.prototype;f.cssClass=e.cssClass,f.init=function(){this.leftAnchor=null,this.rightAnchor=null,this.text=null,this.line=null,this.drawingContext=null,this.staffData=null,this.parent=null,this.group=null,this.posX=null,this.posY=null,this.drawn=!1},f.setParent=function(a){this.parent=a},f.setCssClass=function(a){this.cssClass=a},f.setStaffData=function(a){this.staffData=a},f.setDrawingContext=function(a){this.drawingContext=a},f.setLeftAnchor=function(a){this.hasLeftAnchor()&&this.leftAnchor!==a&&this.removeLeftAnchor(),this.leftAnchor=a,this.leftAnchor.setTempoChange(this)},f.hasLeftAnchor=function(){return null!==this.leftAnchor},f.removeLeftAnchor=function(){this.hide(),this.leftAnchor.tempoChange=null,this.leftAnchor=null},f.setRightAnchor=function(a){this.hasRightAnchor()&&this.rightAnchor!==a&&this.removeRightAnchor(),this.rightAnchor=a,this.rightAnchor.setTempoChange(this)},f.hasRightAnchor=function(){return null!==this.rightAnchor},f.removeRightAnchor=function(){this.hide(),this.rightAnchor.tempoChange=null,this.rightAnchor=null},f.erase=function(){this.hide(),this.hasLeftAnchor()&&this.removeLeftAnchor(),this.hasRightAnchor()&&this.removeRightAnchor()},f.hide=function(){this.drawn&&this.unbindFromParent()},f.isAbove=function(){return this.getLeftAnchor().isAbove()},f.isBelow=function(){return this.getLeftAnchor().isBelow()},f.getY=function(){return this.getLeftAnchor().getY()},f.getLeftAnchor=function(){
return this.leftAnchor},f.getRightAnchor=function(){return this.rightAnchor},f.setNeedDrawUpdate=function(){this.needDrawUpdate=!0},f.updateHorizontalDisplay=function(){this.isRendered()||this.render();var a=this.getWidth();null!==this.text&&this.text.updateHorizontalDisplay(a);var b=null!==this.text?this.text.getWidth()+this.drawingContext.getTempoChangeTextMargin():0;this.line.setX1(b),this.line.setX2(a),this.posX=this.getX(),this.draw()},f.updateVerticalDisplay=function(){if(this.isRendered()||this.render(),this.posY=this.getY(),null!==this.text){var a=this.text.getHeight()/2;this.line.setY1(this.isAbove()?-a:a),this.line.setY2(this.isAbove()?-a:a)}this.draw()},f.draw=function(){null!==this.text&&this.text.draw(),this.line.draw(),this.move(),this.bindToParent()},f.bindToParent=function(){null!==this.parent&&(this.parent.append(this.group),this.drawn=!0)},f.unbindFromParent=function(){this.group.removeFromParent(),this.drawn=!1},f.render=function(){this.group=new b("g"),this.group.attr("class",this.cssClass);var a=this.getLeftAnchor(),e=a.getType();a.isStart()&&(this.text=new d(e),this.text.setParent(this.group),this.text.setDrawingContext(this.drawingContext)),this.line=new c,this.line.setParent(this.group),this.line.setDrawingContext(this.drawingContext);var f=this.getLineY();this.line.setY1(f),this.line.setY2(f)},f.getLineY=function(){var b=this.getHeight();if(this.isAbove())return-b/4*3;if(this.isBelow())return-b/4;throw new a("Unexpected")},f.move=function(){null!==this.posX&&null!==this.posY&&this.group.attr("transform","translate ("+this.posX+", "+this.posY+")")},f.isRendered=function(){return null!==this.group},f.getWidth=function(){var a=this.getX();return this.getRightAnchor().getX()-a},f.getHeight=function(){return null!==this.text?this.text.getHeight():this.line.getHeight()},f.getX=function(){return this.getLeftAnchor().getX()},f.getY=function(){return this.getLeftAnchor().getY()},f.getGroup=function(){return this.group}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Drawer.tempoChange.TempoChange,c=Adagio.Drawer.tempoChange.TempoChangesLinkerLax=function(){},d=c.prototype;d.reset=function(){this.pendingTempoChange=null,this.tempoChanges=[],this.anchors=[],this.currentMeasureIdx=null},d.parseMeasuresTempoChanges=function(a){return this.reset(),a.forEach(this.parseMeasureTempoChangeAnchors,this),this.createTempoChanges(),this.tempoChanges},d.parseMeasureTempoChangeAnchors=function(a,b,c){this.currentMeasureIdx=b;var d=0===b,e=b===c.length-1;a.hasLeftTempoChangeAnchor()&&this.updateLeftAnchor(a.getLeftTempoChangeAnchor(),d);var f=a.getMiddleTempoChangesAnchors();this.addAnchors(f),a.hasRightTempoChangeAnchor()&&this.updateRightAnchor(a.getRightTempoChangeAnchor(),e)},d.updateLeftAnchor=function(a,b){if(b)this.addAnchor(a);else if(a.hasTempoChange()){var c=a.getTempoChange();c.erase()}},d.updateRightAnchor=function(a,b){if(b)this.addAnchor(a);else if(a.hasTempoChange()){var c=a.getTempoChange();c.erase()}},d.addAnchors=function(a){a.forEach(this.addAnchor,this)},d.addAnchor=function(a){this.anchors.push(a)},d.createTempoChanges=function(){this.anchors.forEach(this.useAnchor,this),this.hasPendingTempoChange()&&this.discardPendingTempoChange()},d.useAnchor=function(b){if(b.isLeft())this.openPendingTempoChange(b);else{if(!b.isRight())throw new a("Unexpected");this.closePending(b)}},d.openPendingTempoChange=function(a){this.hasPendingTempoChange()&&this.discardPendingTempoChange();var c;a.hasTempoChange()?c=a.getTempoChange():(c=new b,c.setLeftAnchor(a)),this.pendingTempoChange=c},d.discardPendingTempoChange=function(){this.pendingTempoChange.erase(),this.pendingTempoChange=null},d.closePending=function(a){if(this.hasPendingTempoChange()){this.removeTempoChangeIfDifferentFromPending(a);var b=this.getPendingTempoChange();a.hasTempoChange()||b.setRightAnchor(a),this.tempoChanges.push(b),this.pendingTempoChange=null}else a.hasTempoChange()&&a.removeTempoChange()},d.removeTempoChangeIfDifferentFromPending=function(a){if(a.hasTempoChange()){a.getTempoChange()!==this.getPendingTempoChange()&&a.removeTempoChange()}},d.hasPendingTempoChange=function(){return null!==this.pendingTempoChange},d.getPendingTempoChange=function(){return this.pendingTempoChange}}.call(this),function(){"use strict";var a=Adagio.Drawer.tempoChange.TempoChangesLinkerLax,b=Adagio.Brush.Elem,c=Adagio.Drawer.tempoChange.StaffTempoChanges=function(){this.init()};c.cssClass="staffTempoChanges";var d=c.prototype;d.cssClass=c.cssClass,d.init=function(){this.tempoChangesLinker=new a,this.tempoChanges=[],this.drawingContext=null,this.staffData=null,this.posY=null,this.parent=null,this.group=null},d.setStaffData=function(a){this.staffData=a},d.updateMeasuresTempoChanges=function(a){this.tempoChanges=this.tempoChangesLinker.parseMeasuresTempoChanges(a),this.tempoChanges.forEach(this.transferDrawingContext,this),this.tempoChanges.forEach(this.transferStaffData,this),this.isRendered()&&this.tempoChanges.forEach(this.transfertParent,this)},d.transfertParent=function(a){a.setParent(this.group)},d.transferStaffData=function(a){a.setStaffData(this.staffData)},d.removeMeasure=function(a){a.getAllTempoChangesAnchors().forEach(this.unbindAnchor,this)},d.unbindAnchor=function(a){if(a.hasTempoChange()){var b=a.getTempoChange();this.removeTempoChange(b)}},d.removeTempoChange=function(a){var b=this.tempoChanges.indexOf(a);this.tempoChanges.splice(b,1),a.erase()},d.setPosition=function(a){this.posY=a},d.setDrawingContext=function(a){this.drawingContext=a,this.tempoChanges.forEach(this.transferDrawingContext,this)},d.transferDrawingContext=function(a){a.setDrawingContext(this.drawingContext)},d.setParent=function(a){this.parent=a},d.draw=function(){this.renderIfNeeded(),this.tempoChanges.forEach(this.drawEntity),this.move(),this.bindToParent()},d.renderIfNeeded=function(){this.isRendered()||this.render()},d.isRendered=function(){return null!==this.group},d.render=function(){this.group=new b("g"),this.group.attr("class",this.cssClass),this.tempoChanges.forEach(this.transfertParent,this)},d.move=function(){this.isRendered()&&this.group.attr("transform","translate(0 ,"+this.posY+")")},d.bindToParent=function(){null!==this.parent&&this.parent.append(this.group)},d.drawEntity=function(a){a.draw()},d.updateVerticalDisplay=function(){this.tempoChanges.forEach(this.updateVerticalDisplayEntity)},d.updateVerticalDisplayEntity=function(a){a.updateVerticalDisplay()},d.updateHorizontalDisplay=function(){this.tempoChanges.forEach(this.updateHorizontalDisplayEntity)},d.updateHorizontalDisplayEntity=function(a){a.updateHorizontalDisplay()},d.getTempoChanges=function(){return this.tempoChanges},d.getGroup=function(){return this.group}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.BadLyricLevelError=function(b){var c="The lyric level ["+b+"] is invalid.",d=a.call(this,c);return this.name=d.name="BadLyricLevelError",this.stack=d.stack,this.message=d.message,this.lyricLevel=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}})}.call(this),function(){"use strict";var a=Adagio.Error.client.BadLyricLevelError,b=Adagio.Utils.math,c=Adagio.Values.LyricLevel={};c.MAX=5,c.MIN=0,c.check=function(b){if(!c.isValid(b))throw new a(b)},c.isValid=function(a){return b.isInteger(a)&&a>=c.MIN&&a<=c.MAX}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.formatter.vertical.alignStaff,c=Adagio.Drawer.formatter.alignEntityHoriz,d=Adagio.Drawer.tie.StaffTies,e=Adagio.Drawer.hyphen.StaffHyphens,f=Adagio.Drawer.hammerOnPullOff.StaffHammerOnPullOffs,g=Adagio.Drawer.glissando.StaffGlissandos,h=Adagio.Drawer.wedge.StaffWedges,i=Adagio.Drawer.octaveShift.StaffOctaveShifts,j=Adagio.Drawer.tempoChange.StaffTempoChanges,k=Adagio.Drawer.slur.StaffSlurs,l=Adagio.Drawer.StaffLines,m=Adagio.Brush.Elem,n=Adagio.Utils.math,o=Adagio.Utils.staffDataUtils,p=Adagio.Utils.mapUtils,q=Adagio.Values.LyricLevel,r=1,s=Adagio.Drawer.Staff=function(a){this.init(a)};s.cssClass="staff",s.tabCssClass="tab-staff";var t=s.prototype;t.cssClass=s.cssClass,t.tabCssClass=s.tabCssClass,t.staffData=o.createDefault(),t.init=function(a){this.drawingContext=null,this.posY=null,this.width=null,this.height=null,this.spaceAbove=null,this.spaceBelow=null,this.lyricsUpY=null,this.measureNumberStart=0,this.parent=null,this.group=null,this.measures=[],this.ties={},this.hyphens={},this.hammerOnPullOffs={},this.slurs={},this.glissandos={},this.wedges=new h,this.wedges.setStaffData(this.getStaffData()),this.octaveShifts=new i,this.octaveShifts.setStaffData(this.getStaffData()),this.tempoChanges=new j,this.tempoChanges.setStaffData(this.getStaffData()),this.staffLines=new l,this.staffLines.setStaffData(this.getStaffData()),this.fillVoices(a)},t.fillVoices=function(a){a.forEach(this.fillVoice,this)},t.fillVoice=function(a){var b=new d(a),c=new e(a),h=new k(a),i=new g(a),j=new f(a);h.setStaff(this),this.ties[a]=b,this.hyphens[a]=c,this.slurs[a]=h,this.glissandos[a]=i,this.hammerOnPullOffs[a]=j},t.setParent=function(a){this.parent=a},t.addMeasure=function(a){this.measures.push(a),this.isRendered()&&a.setParent(this.getGroup()),a.setStaffData(this.getStaffData())},t.setDrawingContext=function(a){this.drawingContext=a,this.forEachVoiceTies(this.dispatchDrawingContext,this),this.forEachVoiceHyphens(this.dispatchDrawingContext,this),this.forEachVoiceHammerOnPullOffs(this.dispatchDrawingContext,this),this.forEachVoiceSlurs(this.dispatchDrawingContext,this),this.forEachVoiceGlissandos(this.dispatchDrawingContext,this),this.wedges.setDrawingContext(a),this.octaveShifts.setDrawingContext(a),this.tempoChanges.setDrawingContext(a),this.staffLines.setDrawingContext(a),this.measures.forEach(this.renderEntity,this)},t.dispatchDrawingContext=function(a){a.setDrawingContext(this.drawingContext)},t.renderEntity=function(a){a.render(this.drawingContext)},t.setPosition=function(a){this.posY=a},t.setLyricsUpY=function(a){this.lyricsUpY=a},t.setStaffData=function(a){this.staffData=a,this.forEachVoiceTies(this.setStaffDataEntity,this),this.forEachVoiceSlurs(this.setStaffDataEntity,this),this.forEachVoiceHyphens(this.setStaffDataEntity,this),this.forEachVoiceHammerOnPullOffs(this.setStaffDataEntity,this),this.wedges.setStaffData(this.getStaffData()),this.octaveShifts.setStaffData(this.getStaffData()),this.tempoChanges.setStaffData(this.getStaffData()),this.staffLines.setStaffData(this.getStaffData()),this.measures.forEach(this.setStaffDataEntity,this)},t.setStaffDataEntity=function(a){a.setStaffData(this.getStaffData())},t.insertMeasure=function(a,b){this.measures.splice(b,0,a),a.setStaffData(this.staffData),this.isRendered()&&a.setParent(this.getGroup()),this.hasDrawingContext()&&a.render(this.drawingContext),this.width=null},t.replaceMeasure=function(a,b){var c=this.measures[b];c.unbind(),c.setParent(null),this.signalRemovedToCrossMeasures(c),a.setStaffData(this.getStaffData()),this.isRendered()&&a.setParent(this.getGroup()),this.hasDrawingContext()&&a.render(this.drawingContext),this.measures[b]=a,this.width=null},t.eraseMeasure=function(a){if(void 0!==a){var b=this.measures.splice(a,1)[0];b.unbind(),b.setParent(null),b.setInsertionPoint(null),this.signalRemovedToCrossMeasures(b)}this.width=null},t.signalRemovedToCrossMeasures=function(a){this.forEachVoiceTies(u,a),this.forEachVoiceHyphens(u,a),this.forEachVoiceSlurs(u,a),this.forEachVoiceGlissandos(u,a),this.forEachVoiceHammerOnPullOffs(u,a),this.wedges.removeMeasure(a),this.octaveShifts.removeMeasure(a),this.tempoChanges.removeMeasure(a)};var u=function(a){var b=this;a.removeMeasure(b)};t.dispatchInsertionPoint=function(a){var b=this.measures[a];if(a===this.measures.length-1)b.setInsertionPoint(null);else{var c=this.measures[a+1],d=c.getGroup();b.setInsertionPoint(d)}},t.draw=function(){this.renderIfNeeded(),this.drawContent(),this.move(),this.bindToParent()},t.renderIfNeeded=function(){this.isRendered()||this.render()},t.isRendered=function(){return null!==this.group},t.render=function(){this.createGroup()},t.createGroup=function(){this.group=new m("g"),this.group.attr("class",this.isTabStaff()?this.cssClass+" "+this.tabCssClass:this.cssClass),this.forEachVoiceTies(this.dispatchParent,this),this.forEachVoiceHyphens(this.dispatchParent,this),this.forEachVoiceSlurs(this.dispatchParent,this),this.forEachVoiceGlissandos(this.dispatchParent,this),this.forEachVoiceHammerOnPullOffs(this.dispatchParent,this),this.wedges.setParent(this.group),this.octaveShifts.setParent(this.group),this.tempoChanges.setParent(this.group),this.staffLines.setParent(this.group),this.measures.forEach(this.dispatchParent,this)},t.dispatchParent=function(a){a.setParent(this.group)},t.drawContent=function(){this.staffLines.draw(),this.forEachVoiceTies(v),this.forEachVoiceHyphens(v),this.forEachVoiceSlurs(v),this.forEachVoiceGlissandos(v),this.forEachVoiceHammerOnPullOffs(v),this.wedges.draw(),this.octaveShifts.draw(),this.tempoChanges.draw(),this.measures.forEach(v)};var v=function(a){a.draw()};t.move=function(){this.isRendered()&&this.group.attr("transform","translate(0, "+this.posY+")")},t.bindToParent=function(){this.parent.append(this.group)},t.getMeasuresHorizontalData=function(a){return[this.measures[a].getHorizontalData()]},t.getHorizontalFormatting=function(a){return this.measures[a].getHorizontalFormatting()},t.setMeasureHorizontalFormatting=function(a,b){this.measures[b].setHorizontalFormatting(a),this.width=null},t.alignVertical=function(){b(this)},t.setHeight=function(a){this.height=a},t.setSpaceAbove=function(a){this.spaceAbove=a},t.setSpaceBelow=function(a){this.spaceBelow=a},t.formatMeasureHorizontal=function(a){this.measures[a].formatHorizontal()},t.formatVertical=function(){var a=this.getSpaceAbove();this.staffLines.setPosition(a),this.forEachVoiceTies(this.dispatchYPos,this),this.forEachVoiceHyphens(this.dispatchYPos,this),this.forEachVoiceSlurs(this.dispatchYPos,this),this.forEachVoiceGlissandos(this.dispatchYPos,this),this.forEachVoiceHammerOnPullOffs(this.dispatchYPos,this),this.wedges.setPosition(a),this.octaveShifts.setPosition(a),this.tempoChanges.setPosition(a),this.measures.forEach(this.formatMeasureVertical,this)},t.dispatchYPos=function(a){var b=this.getSpaceAbove();a.setPosition(b)},t.formatMeasureVertical=function(a){var b=this.getSpaceAbove();a.setPosY(b),a.formatVertical()},t.drawCursor=function(a,b){this.measures[a.measureIdx].drawCursor(a,b)},t.drawGraceCursor=function(a,b){this.measures[a.measureIdx].drawGraceCursor(a,b)},t.drawDynamicCursor=function(a,b){this.measures[a.measureIdx].drawDynamicCursor(a,b)},t.drawPizzicatoCursor=function(a,b){this.measures[a.measureIdx].drawPizzicatoCursor(a,b)},t.drawHorizontalMeasureWideCursor=function(a,b){var c=this.measures[a.measureIdx],d=c.getNbNotes(a.voiceIdx),e={startMeasureIdx:a.measureIdx,startNoteIdx:0,stopMeasureIdx:a.measureIdx,stopNoteIdx:d,startVoiceIdx:a.voiceIdx,stopVoiceIdx:a.voiceIdx};this.drawHorizontalCursor(e,b)},t.drawHorizontalCursor=function(a,b){var c;if(null!==a.startNoteIdx){c=this.getMeasure(a.startMeasureIdx).getNote(a.startVoiceIdx,a.startNoteIdx).getTimePos()}else c=null;var d;if(null!==a.stopNoteIdx){var e=this.getMeasure(a.stopMeasureIdx),f=e.getNbNotes(a.stopVoiceIdx);if(a.stopNoteIdx===f){d=e.getTickableContent().getNbDivisions()}else{d=e.getNote(a.stopVoiceIdx,a.stopNoteIdx).getTimePos()}}else d=null;b.addSegment(this,a.startMeasureIdx,c,a.stopMeasureIdx,d)},t.drawHorizontalCursorTimePos=function(a,b){b.addSegment(this,a.startMeasureIdx,a.startTimePos,a.stopMeasureIdx,a.stopTimePos)},t.drawCrossMeasureNoteCursor=function(a,b){b.addSegment(this,a.startMeasureIdx,a.startNoteIdx,a.stopMeasureIdx,a.stopNoteIdx)},t.updateMeasureNumbers=function(a){a=a||0;for(var b=a;b<this.measures.length;b++)this.updateMeasureNumber(b)},t.updateMeasureNumber=function(a){var b=a+this.measureNumberStart,c=this.measures[a];0!==b&&(1+b)%r==0?c.updateMeasureNumber(b):c.removeMeasureNumber(b)},t.setMeasureNumberingStart=function(a){this.measureNumberStart=a},t.autoUpdateHorizontalDisplay=function(){for(var a=this.measures.length,b=0;b<a;b++)this.autoAlignMeasureHorizontal(b),this.formatMeasureHorizontal(b),this.updateHorizontalDisplay(b);this.moveMeasures()},t.autoAlignMeasureHorizontal=function(a){c(this,a)},t.updateHorizontalDisplay=function(a){this.measures[a].updateHorizontalDisplay()},t.moveMeasures=function(a){a=a||0;var b=this.getPositionAfter(a-1);this.measures.slice(a).reduce(w,b)},t.getPositionAfter=function(b){if(-1===b)return 0;if(b>=0){var c=this.measures[b];return c.xPos+c.getWidth()}throw new a("InvaldMeasureIdx","The measureIdx ["+b+"] is invalid.")};var w=function(a,b){return b.setPosX(a),b.move(),a+b.getWidth()};t.updateVerticalDisplay=function(){this.alignVertical(),this.formatVertical(),this.forEachVoiceTies(x),this.forEachVoiceHyphens(x),this.forEachVoiceHyphens(y),this.forEachVoiceSlurs(x),this.forEachVoiceGlissandos(x),this.forEachVoiceHammerOnPullOffs(x),this.wedges.move(),this.wedges.updateVerticalDisplay(),this.octaveShifts.move(),this.octaveShifts.updateVerticalDisplay(),this.tempoChanges.move(),this.tempoChanges.updateVerticalDisplay(),this.staffLines.move(),this.measures.forEach(z)};var x=function(a){a.move()},y=function(a){a.updateVerticalDisplay()},z=function(a){a.move(),a.updateVerticalDisplay()};t.reloadCrossMeasures=function(){this.forEachVoiceTies(this.callUpdateMeasuresTies,this),this.forEachVoiceHyphens(this.callUpdateFromMeasures,this),this.forEachVoiceHammerOnPullOffs(this.callUpdateMeasuresHammerOnPullOffs,this),this.forEachVoiceSlurs(this.callUpdateMeasureSlurs,this),this.forEachVoiceGlissandos(this.callUpdateMeasuresGlissandos,this),this.updateMeasuresWedges(),this.updateMeasuresOctaveShifts(),this.updateMeasuresTempoChanges()},t.callUpdateMeasuresTies=function(a){a.updateMeasuresTies(this.measures)},t.callUpdateFromMeasures=function(a){a.updateFromMeasures(this.measures)},t.callUpdateMeasuresHammerOnPullOffs=function(a){a.updateMeasuresHammerOnPullOffs(this.measures)},t.callUpdateMeasureSlurs=function(a){a.updateMeasuresSlurs(this.measures)},t.callUpdateMeasuresGlissandos=function(a){a.updateMeasuresGlissandos(this.measures)},t.updateMeasuresWedges=function(){this.wedges.updateMeasuresWedges(this.measures)},t.updateMeasuresOctaveShifts=function(){this.octaveShifts.updateMeasuresOctaveShifts(this.measures)},t.updateMeasuresTempoChanges=function(){this.tempoChanges.updateMeasuresTempoChanges(this.measures)},t.updateMeasuresGlissandos=function(){this.glissandos.updateMeasuresGlissandos(this.measures)},t.updateCrossMeasuresHorizontalDisplay=function(){this.forEachVoiceTies(A),this.forEachVoiceHyphens(A),this.forEachVoiceSlurs(A),this.forEachVoiceGlissandos(A),this.forEachVoiceHammerOnPullOffs(A),this.wedges.updateHorizontalDisplay(),this.octaveShifts.updateHorizontalDisplay(),this.tempoChanges.updateHorizontalDisplay()};var A=function(a){a.updateHorizontalDisplay()};t.updateStaffLines=function(){var a=this.getWidth();this.staffLines.setWidth(a)},t.connectWith=function(a){var b=a.posY-this.posY,c=b+a.getSpaceAbove()-(this.getSpaceAbove()+this.getStaffHeight());this.extendBarlines(c)},t.extendBarlines=function(a){this.measures.forEach(function(b){b.extendBarlines(a)})},t.getWidth=function(){return null===this.width&&this.calcWidth(),this.width},t.calcWidth=function(){var a=this.measures.map(B);this.width=a.reduce(n.add)};var B=function(a){return a.getWidth()};t.getNbMeasures=function(){return this.measures.length},t.getGroup=function(){return this.group},t.getLyricsUpY=function(a,b){b=C(b);var c=this.getGlobalLyricsUpY(),d=this.getMeasureLyricsUpY(a),e=Math.max(c,d);return e+=this.drawingContext.getLyricsFontSize()*b};var C=function(a){return q.isValid(a)?a:0};t.getMeasureLyricsUpY=function(a){var b=this.measures[a],c=b.getLyricsUpY();return b.hasLyrics()||(c+=this.drawingContext.getSpaceSize()),c},t.getGlobalLyricsUpY=function(){return null!==this.lyricsUpY?this.lyricsUpY:0},t.getMeasureWordsY=function(a,b){return this.getMeasure(a).getWordsY(b)},t.getChordsY=function(a){return this.getMeasure(a).getChordsY()},t.getMeasureWidth=function(a){return this.getMeasure(a).getWidth()},t.getNoteXInMeasure=function(a,b,c){var d=this.getMeasure(a),e=d.getTickableContent();return c>0?e.getNoteX(b,c):e.getXPos()},t.getMeasureNbNotes=function(a,b){return this.getMeasure(a).getNbNotes(b)},t.resetGeometries=function(){this.measures.forEach(D)};var D=function(a){a.resetGeometry()};t.getMeasureGeometry=function(a){return this.measures[a].getGeometry()},t.getMeasures=function(){return this.measures},t.getNotes=function(){var a=[];return this.measures.forEach(function(b){a.push(b.getNotes())},this),a},t.getDrawingContext=function(){return this.drawingContext},t.getSpaceAbove=function(){return this.spaceAbove},t.getSpaceBelow=function(){return this.spaceBelow},t.getHeight=function(){return this.height},t.getStaffData=function(){return this.staffData},t.getNbStaffLines=function(){var a=this.getStaffData();return o.getNbStaffLines(a)},t.isTabStaff=function(){var a=this.getStaffData();return o.isTabStaff(a)},t.getSpaceSize=function(){return this.isTabStaff()?this.drawingContext.getTabSpaceSize():this.drawingContext.getSpaceSize()},t.getStaffHeight=function(){return this.getSpaceSize()*(this.getNbStaffLines()-1)},t.getWedges=function(){return this.wedges.getWedges()},t.getOctaveShifts=function(){return this.octaveShifts.getOctaveShifts()},t.getTempoChanges=function(){return this.tempoChanges.getTempoChanges()},t.getWedgesContainer=function(){return this.wedges},t.getOctaveShiftsContainer=function(){return this.octaveShifts},t.getTempoChangesContainer=function(){return this.tempoChanges},t.hasDrawingContext=function(){return null!==this.drawingContext},t.getStartMeasureIdx=function(){return this.measureNumberStart},t.getMeasure=function(a){return this.checkMeasureIdx(a),this.measures[a]},t.getAllSlurs=function(){var a=p.getValues(this.slurs),b=a.map(E);return Array.prototype.concat.apply([],b)};var E=function(a){return a.getSlurs()};t.getSlurs=function(b){if(!n.isInteger(b)||void 0===this.slurs[b])throw new a("BadVoiceIdx","the voiceIdx ["+b+"] is invalid.");return this.slurs[b]},t.checkMeasureIdx=function(b){if("number"!=typeof b||b<0||b>=this.measures.length){throw new a("BadMeasureIdx","Invalid measureIdx: ["+b+"].")}},t.bindMeasures=function(){for(var a=this.getNbMeasures(),b=a-1;b>=0;b--){var c=this.getMeasure(b);c.drawn||(this.dispatchInsertionPoint(b),c.bindToParent())}},t.forEachVoiceTies=function(a,b){for(var c in this.ties){var d=this.ties[c];a.call(b,d,c)}},t.forEachVoiceHyphens=function(a,b){for(var c in this.hyphens){var d=this.hyphens[c];a.call(b,d,c)}},t.forEachVoiceHammerOnPullOffs=function(a,b){for(var c in this.hammerOnPullOffs){var d=this.hammerOnPullOffs[c];a.call(b,d,c)}},t.forEachVoiceSlurs=function(a,b){for(var c in this.slurs){var d=this.slurs[c];a.call(b,d,c)}},t.forEachVoiceGlissandos=function(a,b){for(var c in this.glissandos){var d=this.glissandos[c];a.call(b,d,c)}},t.drawVerticalDebug=function(){this.measures.forEach(function(a){a.drawVerticalDebug()})}}.call(this),function(){"use strict";var a=Adagio.Utils.attributesUtils,b=Adagio.Utils.measureUtils,c=Adagio.Utils.staffDataUtils,d=Adagio.Render.MeasureRenderer,e=Adagio.Drawer.Staff,f=Adagio.Render.PartRenderer=function(a){this.init(a)},g=f.prototype;g.init=function(a){this.measureRenderer=new d(a)},g.createPart=function(a,b,c){this.reset(a),this.scoreDataCache=b,this.partIdx=c,this.createStaves(),this.createAllMeasures()},g.reset=function(a){this.nbStaves=0,this.staves=[],this.system=a,this.measuresData=[],this.partIdx=null,this.commonContent=null,this.partHeader=null},g.createStaves=function(){var d=this.getFirstMeasure(),f=b.getAttributes(d);this.nbStaves=a.getNbStaves(f);for(var g=a.getWrappedStaffDetailsOrDefault(f,this.nbStaves),h=0;h<this.nbStaves;h++){var i,j=g.getEntry(h),k=c.createFromStaffDetails(j);i=c.isTabStaff(k)?this.getVoicesIndexes(0):this.getVoicesIndexes(h);var l=new e(i);l.setStaffData(k),this.staves.push(l),this.system.addStaff(l)}},g.getFirstMeasure=function(){return this.scoreDataCache.getMeasure(this.partIdx,0)},g.getVoicesIndexes=function(a){return this.scoreDataCache.getPartStaffVoicesIndexes(this.partIdx,a)},g.createAllMeasures=function(){for(var a=this.scoreDataCache.getNbMeasures(),b=0;b<a;b++)this.createMeasureStaves(b);this.measuresData.forEach(this.createMeasureStaves,this)},g.createMeasureStaves=function(a){var b=this.scoreDataCache.getMeasureDisplayData(this.partIdx,a);this.measureRenderer.renderMeasure(b).forEach(function(a,b){this.staves[b].addMeasure(a)},this)}}.call(this),function(){"use strict";var a=Adagio.Render.SystemsBuilder,b=Adagio.Render.PartRenderer,c=Adagio.Render.prototype;c.systemsBuilder=new a,c.renderAll=function(){this.renderScoreHeaders(),this.renderAllPart(),this.scoreShard.setPosition(0,0)},c.renderScoreHeaders=function(){var a=this.scoreData.getPartsHeaders();this.systemsBuilder.build(a).forEach(this.scoreShard.addSystem,this.scoreShard)},c.renderAllPart=function(){for(var a=new b(this.displayOpts),c=this.scoreData.getNbParts(),d=0;d<c;d++){var e=this.scoreShard.getSystem(d);a.createPart(e,this.scoreDataCache,d)}}}.call(this),function(){"use strict";var a="xyvw",b=Adagio.font.Font=function(a){this.init(a)},c=b.prototype;c.init=function(a){this.font=a,this.xHeight=null},c.getComputedTextLength=function(a,b,c){c=c||{};var d=void 0===c.kerning||c.kerning,e=this.getFontScale(b),f=void 0===c["letter-spacing"]?0:c["letter-spacing"],g=this.font.stringToGlyphs(a),h=0,i=g.length;return g.forEach(function(a,b,c){var e=b===i-1;if(h+=a.advanceWidth,!e&&d){var f=c[b+1],g=this.font.getKerningValue(a,f);h+=g}},this),h*e+(i>0?(i-1)*f:0)},c.getXHeight=function(b){if(null===this.xHeight){this.xHeight=0;for(var c=0;c<a.length;c++){var d=this.font.charToGlyph(a.charAt(c));if(null!==d){this.xheight=d.getMetrics().yMax;break}}}var e=this.getFontScale(b);return this.xheight*e},c.getFontScale=function(a){return 1/this.font.unitsPerEm*a}}.call(this),function(){"use strict";var a=Adagio.font.Font,b=Adagio.font.FontCache=function(a){this.init(a)},c=b.prototype;c.init=function(a){this.fontList=a,this.fonts={}},c.isFromFont=function(){return!0},c.getXHeight=function(a,b,c){return this.getFont(a,c).getXHeight(b)},c.getComputedTextLength=function(a,b,c,d){return this.getFont(b,d).getComputedTextLength(a,c,d)},c.getFont=function(a,b){var c=a.map(function(a){return e(a,b)}),f=this.fontList.getAvailableFontRef(c);if(!this.hasFont(f)){if(!c.find(d,f)){var g="None of these font is loaded: "+a.join(", ")+". Fall back to the font family ["+f.family+"].";console.warn(g)}this.cacheFont(f)}return this.fonts[f.family][f.style]};var d=function(a){var b=this;return a.family===b.family&&a.style===b.style};c.hasFont=function(a){return void 0!==this.fonts[a.family]&&void 0!==this.fonts[a.family][a.style]},c.cacheFont=function(b){var c=this.fontList.getFont(b),d=new a(c);void 0===this.fonts[b.family]&&(this.fonts[b.family]={}),this.fonts[b.family][b.style]=d};var e=function(a,b){b=b||{};var c="Regular";return"bold"===b["font-weight"]&&(c="Bold"),"italic"===b["font-style"]&&(c="Italic"),{family:a,style:c}}}.call(this),function(){"use strict";var a=Adagio.Error.font.FontError=function(a,b){var c=Error.call(this,a);return this.name=c.name="FontError",this.stack=c.stack,this.message=c.message,void 0!==b&&(this.code=b),this};a.prototype=Object.create(Error.prototype,{constructor:{value:a}})}.call(this),function(){"use strict";var a=Adagio.Error.font.FontError,b=Adagio.Error.font.FontNotLoadedError=function(b){var c="The font family ["+b.family+"] with style ["+b.style+"] is not loaded.",d=a.call(this,c);return this.name=d.name="FontNotLoadedError",this.stack=d.stack,this.message=d.message,this.fontRef=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}})}.call(this),function(){"use strict";var a=Adagio.Error.font.FontError,b=Adagio.Error.font.NoFontLoadedError=function(){var b="There must be at least one font loaded",c=a.call(this,b);return this.name=c.name="NoFontLoadedError",this.stack=c.stack,this.message=c.message,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}})}.call(this),function(){"use strict";var a=Adagio.Utils.typeUtils,b=Adagio.Error.font.FontNotLoadedError,c=Adagio.Error.font.NoFontLoadedError,d=Adagio.Error.InternalError,e=Adagio.font.FontList=function(a,b){this.init(a,b)},f=e.prototype;f.init=function(b,d){if(a.isObjectEmpty(b))throw new c;this.fonts=b,void 0===d?this.fallbackFontRef=this.getAnyFontRef():(this.checkHasFont(d),this.fallbackFontRef=d)},f.getAnyFontRef=function(){for(var a in this.fonts){var b=this.fonts[a];for(var c in b){return{family:a,style:c}}}},f.getFont=function(a){return this.checkHasFont(a),this.fonts[a.family][a.style]},f.getAvailableFontRef=function(a){var b=a.find(this.hasFont,this);return void 0!==b?b:(b=a.find(this.hasFontFamily,this),void 0!==b?b=this.getAnyFromFamily(b.family):this.fallbackFontRef)},f.isFontAvailable=function(a){return a.some(this.hasFont,this)},f.checkHasFont=function(a){if(!this.hasFont(a))throw new b(a)},f.hasFont=function(a){return void 0!==this.fonts[a.family]&&void 0!==this.fonts[a.family][a.style]},f.hasFontFamily=function(a){return void 0!==this.fonts[a.family]},f.getAnyFromFamily=function(a){var b=this.fonts[a];if(void 0===b)throw new d("No font family ["+a+"].");for(var c in b){return{family:a,style:c}}throw new d("No style in the font family ["+a+"].")}}.call(this),function(){"use strict";var a=Adagio.Brush.Elem,b=Adagio.Drawer.TextMetric=function(a){this.init(a)},c=b.prototype;c.init=function(a){this.draftSvg=a},c.isFromFont=function(){return!1},c.getComputedTextLength=function(a,b,c,d){var e=b.join(", "),f=this.getText(a,e,c,d);this.draftSvg.appendChild(f.node());var g=f.node().getComputedTextLength();return this.draftSvg.removeChild(f.node()),g},c.getXHeight=function(a,b){var c=a.join(", "),d=this.getText("xvw",c,b);this.draftSvg.appendChild(d.node());var e=d.getBBox();return this.draftSvg.removeChild(d.node()),e.height/2},c.getText=function(b,c,d,e){e=e||{};var f=new a("text");return f.attr("x",0),f.attr("y",0),f.attr("font-family",c),f.attr("font-size",d),void 0!==e["text-transform"]&&f.style("text-transform",e["text-transform"]),void 0!==e["letter-spacing"]&&f.style("letter-spacing",e["letter-spacing"]),void 0!==e["font-weight"]&&f.style("font-weight",e["font-weight"]),void 0!==e["font-style"]&&f.style("font-style",e["font-style"]),f.text(b),f}}.call(this),function(){"use strict";var a=Adagio.Drawer.TextMetric,b=Adagio.Drawer.CachedTextMetric=function(a){this.init(a)},c=b.prototype;c.init=function(b){this.textMetric=new a(b),this.lengthCache={},this.xHeightCache={}},c.isFromFont=function(){return!1},c.getComputedTextLength=function(a,b,c,e){e=e||{};var f=d(a,b,c,e);return void 0===this.lengthCache[f]&&this.computeTextLength(f,a,b,c,e),this.lengthCache[f]},c.computeTextLength=function(a,b,c,d,e){var f=this.textMetric.getComputedTextLength(b,c,d,e);this.lengthCache[a]=f};var d=function(a,b,c,d){return JSON.stringify({string:a,fontFamilies:b,fontSize:c,options:d})};c.getXHeight=function(a,b){var c=d(a,b);return void 0===this.xHeightCache[c]&&this.computeTextXHeight(c,a,b),this.xHeightCache[c]},c.computeTextXHeight=function(a,b,c){var d=this.textMetric.getXHeight(b,c);this.xHeightCache[a]=d}}.call(this),function(){"use strict";var a=Adagio.Utils.math,b=["dynamicRinforzando","dynamicMezzo","dynamicSforzando","dynamicZ"],c=Adagio.Drawer.DynamicsMetrics=function(a){this.init(a)},d=c.prototype;d.init=function(a){this.glyphsCache=a,this.xHeight=null,this.middle=null,this.ascent=null,this.descent=null,this.wedgeHeight=null},d.getMiddle=function(){return this.getXHeight()/2},d.getWedgeHeight=function(){return null===this.wedgeHeight&&this.calcWedgeHeight(),this.wedgeHeight},d.calcWedgeHeight=function(){var a=this.getXHeight(),b=this.getAscent(),c=this.getDescent(),d=Math.max(b,c);this.wedgeHeight=2*d+a},
d.getAscent=function(){return null===this.ascent&&this.calcAscent(),this.ascent},d.calcAscent=function(){var a=this.getXHeight(),b=this.getDescent(),c=this.getGlyphHeight("dynamicForte");this.descent=c-a-b},d.getDescent=function(){return null===this.descent&&this.calcDescent(),this.descent},d.calcDescent=function(){var a=this.getXHeight(),b=this.getGlyphHeight("dynamicPiano");this.descent=b-a},d.getXHeight=function(){return null===this.xHeight&&this.calcXHeight(),this.xHeight},d.calcXHeight=function(){var c=b.map(this.getGlyphHeight,this);this.xHeight=c.reduce(a.max2)},d.getGlyphHeight=function(a){return this.glyphsCache.getGlyph(a).getHeight()}}.call(this),function(){"use strict";Adagio.Drawer.formatter.sequential.extractVoicesDistanceData=function(b,c,d){var e=d.getMarginSize(),f={nbDivisions:c,margin:e},g=b.map(a,f);return Array.prototype.concat.apply([],g)};var a=function(a){if(0===a.length)return[];var d=this,e=a.map(c,d.margin);if(a[a.length-1].timePos!==d.nbDivisions){var f=b(a,d.margin,d.nbDivisions);e.push(f)}return e},b=function(a,b,c){var d=a.length-1,e=a[d],f=e.spaceAfter+b;return{timePos:c,previousTimePos:e.timePos,distanceWithPrevious:f}},c=function(a,b,c){var d,e,f=a.timePos;if(0===b)d=0,e=0;else{var g=this.valueOf(),h=c[b-1];d=h.timePos,e=h.spaceAfter+g+a.spaceBefore}return{timePos:f,distanceWithPrevious:e,previousTimePos:d}}}.call(this),function(){"use strict";Adagio.Drawer.formatter.sequential.sortDistancesByTimePos=function(b){b.sort(a)};var a=function(a,b){return a.timePos-b.timePos}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError;Adagio.Drawer.formatter.sequential.computePosXByTimePos=function(a,c){var d={map:{0:0},maxPosX:0,margin:c};return a.forEach(b,d),d.map};var b=function(a){var b=this,e=c(b.map,a.previousTimePos),f=e+a.distanceWithPrevious;d(b,a.timePos,f)},c=function(b,c){if(void 0===b[c]){throw new a("BadTimePos","There is no x distance for the time position ["+c+"].")}return b[c]},d=function(a,b,d){if(void 0===a.map[b]){var e=a.maxPosX+a.margin;d=Math.max(d,e),a.map[b]=d}else{var f=c(a.map,b);a.map[b]=Math.max(d,f)}a.maxPosX=a.map[b]}}.call(this),function(){"use strict";var a=Adagio.Drawer.formatter.sequential.extractVoicesDistanceData,b=Adagio.Drawer.formatter.sequential.sortDistancesByTimePos,c=Adagio.Drawer.formatter.sequential.computePosXByTimePos;Adagio.Drawer.formatter.sequential.voicesDataToPosXByTimPos=function(d,e,f){var g=a(d,e,f);b(g);var h=f.getMarginSize();return c(g,h)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.math,c=Adagio.Utils.mapUtils,d=Adagio.Drawer.formatter.sequential.voicesDataToPosXByTimPos,e=Adagio.Drawer.formatter.sequential.NotesSequentialFormatter=function(a,b,c){this.init(a,b,c)},f=e.prototype;f.init=function(a,b,c){this.voicesData=a,this.drawingContext=b,this.isMinimal=c,this.minimalPosXBYTimePos=null,this.minimalWidth=null,this.nominalPosXByTimePos=null,this.nominalWidth=null,this.timePosTab=null,this.posXByTimePos=null,this.width=null},f.getMiddlePos=function(){var a=this.getAlignmentSpace();return(this.getWidth()+a)/2-a},f.getAlignmentSpace=function(){var a=this.drawingContext.getSpaceBeforeNotes();return this.voicesData.getAlignmentSpace()+a},f.getPosX=function(a,b){return a=a*this.getDpq()/b,this.getInternalPosX(a)},f.getDpq=function(){return this.voicesData.getDpq()},f.getInternalPosX=function(a){this.checkTimePos(a);var b=this.getPosXByTimePos();return void 0!==b[a]?b[a]:this.getLinearInterpolation(a)},f.checkTimePos=function(b){var c=this.getNbDivisions();if("number"!=typeof b||b<0||b>c){throw new a("BadTimePos","The time pos ["+b+"] is out of range. ")}},f.getLinearInterpolation=function(a){var b=this.getTimePosBeforeIdx(a),c=this.getTimePosAt(b),d=this.getTimePosAt(b+1),e=d-c,f=(a-c)/e,g=this.getPosXByTimePos(),h=g[c];return h+(g[d]-h)*f},f.getTimePosBeforeIdx=function(b){for(var c=this.getTimePosTab(),d=c.length,e=0;e<d;e++){if(c[e]>b){if(e>0)return e-1;throw new a("Unexpected")}}throw new a("Unexpected")},f.getTimePosAt=function(b){var c=this.getTimePosTab();if(b<0||b>=b.length){throw new a("InvalidTimePosIdx","Invalid time position index ["+b+"]. ")}return c[b]},f.getTimePosTab=function(){return null===this.timePosTab&&this.calcTimePosTab(),this.timePosTab},f.calcTimePosTab=function(){var a=this.getPosXByTimePos(),c=Object.keys(a);this.timePosTab=c.map(b.intPart),this.timePosTab.sort(b.cmp)},f.getPosXByTimePos=function(){return null===this.posXByTimePos&&this.calcPosXByTimePos(),this.posXByTimePos},f.calcPosXByTimePos=function(){var a=this.getWidth(),b=this.getNominalWidth(),d=a-b,e=this.getNbDivisions(),f=d/e;this.posXByTimePos=c.map(this.nominalPosXByTimePos,g,f)},f.getWidth=function(){if(null===this.width){var a=this.getNominalWidth();this.width=a}return this.width},f.setWidth=function(a){var c=this.getNominalWidth();a=b.max2(a,c),this.posXByTimePos=null,this.width=a},f.getNominalWidth=function(){return null===this.nominalWidth&&this.calcNominalWidth(),this.nominalWidth},f.calcNominalWidth=function(){var b=this.getNbDivisions(),c=this.getNominalPosXByTimePos(),d=c[b];if("number"!=typeof d)throw new a("Unexpected");this.nominalWidth=d},f.getNbDivisions=function(){return this.voicesData.getNbDivisions()},f.getNominalPosXByTimePos=function(){return null===this.nominalPosXByTimePos&&this.calcNominalPosXByTimePos(),this.nominalPosXByTimePos},f.calcNominalPosXByTimePos=function(){var a=this.getMinimalPosXByTimePos();if(this.isMinimal)this.nominalPosXByTimePos=a;else{var b=this.getMinimalWidth(),d=this.getNbDivisions(),e=this.drawingContext.getNotesSpacingCoeff(),f=b*e,h=f-b,i=h/d;this.nominalPosXByTimePos=c.map(a,g,i)}},f.getMinimalWidth=function(){return null===this.minimalWidth&&this.calcMinimalWidth(),this.minimalWidth},f.calcMinimalWidth=function(){var b=this.getNbDivisions(),c=this.getMinimalPosXByTimePos(),d=c[b];if("number"!=typeof d)throw new a("Unexpected");this.minimalWidth=d},f.getMinimalPosXByTimePos=function(){return null===this.minimalPosXBYTimePos&&this.calcMinimalPosXByTimePos(),this.minimalPosXBYTimePos},f.calcMinimalPosXByTimePos=function(){var a=this.getVoicesData(),b=this.getNbDivisions();this.minimalPosXBYTimePos=d(a,b,this.drawingContext)};var g=function(a,b){return a=parseInt(a,10),b+a*this.valueOf()};f.getVoicesData=function(){return this.voicesData.getVoicesData()},f.isSame=function(a){if(this.constructor!==a.constructor)return!1;var b=this.getPosXByTimePos(),d=a.getPosXByTimePos();return c.isEqual(b,d,h)};var h=function(a,b){return a===b}}.call(this),function(){"use strict";var a=Adagio.settings.PrintRatios={POINTS_BY_INCH:72,MM_PER_INCH:25.4,TENTH_PER_EM:40,SP_PER_EM:4};a.pointsToMms=function(b){return b/a.POINTS_BY_INCH*a.MM_PER_INCH}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.settings.PrintRatios,c={M:1,L:1,T:1,S:2,Q:2,C:3,Z:0},d=Adagio.smufl.Glyph=function(a,b,c,d){this.init(a,b,c,d)},e=d.prototype;e.init=function(c,d,e,f){if(!f.glyphs)throw new a("BadFont","This font has not glyph");var g=f.glyphs[c];if(void 0===g)throw new a("BadGlyphKey","Glyph key ["+c+"] is not in the font.");this.glyph=g,this.key=c,this.pointSize=d,this.dpi=e;var h=d/b.POINTS_BY_INCH,i=h*e;this.spaceSize=i/4;var j=this.scale=f.meta["units-per-em"];this.scale=i/j,this.pathData=this.glyph.path.match(/[a-zA-Z]|[0-9\-]+/g),this.scaledPath=null},e.getBBox=function(){return{width:this.getWidth(),height:this.getHeight()}},e.getWidth=function(){var a=this.getBBoxNE(),b=this.getBBoxSW();return a.x-b.x},e.getHeight=function(){var a=this.getBBoxNE();return this.getBBoxSW().y-a.y},e.getBBoxNE=function(){var a=this.getBBoxNESpace();return a.x*=this.spaceSize,a.y*=this.spaceSize,a},e.getBBoxSW=function(){var a=this.getBBoxSWSpace();return a.x*=this.spaceSize,a.y*=this.spaceSize,a},e.hasStemAnchor=function(){return void 0!==this.glyph.stemDownNW&&void 0!==this.glyph.stemUpSE},e.getStemDownNW=function(){var a=this.getStemDownNWSpace();return a.x*=this.spaceSize,a.y*=this.spaceSize,a},e.getStemDownNWSpace=function(){if(void 0===this.glyph.stemDownNW){var b="There is no entry [stemDownNW] for the glyph ["+this.key+"].";throw new a("Unexpected",b)}var c=this.glyph.stemDownNW;return{x:parseFloat(c[0]),y:-parseFloat(c[1])}},e.getStemUpSE=function(){var a=this.getStemUpSESpace();return a.x*=this.spaceSize,a.y*=this.spaceSize,a},e.getStemUpSESpace=function(){if(void 0===this.glyph.stemUpSE){var b="There is no entry [stemUpSE] for the glyph ["+this.key+"].";throw new a("Unexpected",b)}var c=this.glyph.stemUpSE;return{x:parseFloat(c[0]),y:-parseFloat(c[1])}},e.getOpticalCenter=function(){var a=this.getOpticalCenterSpace();return a.x*=this.spaceSize,a.y*=this.spaceSize,a},e.getOpticalCenterSpace=function(){if(void 0===this.glyph.opticalCenter){var b="There is no entry [opticalCenter] for the glyph ["+this.key+"].";throw new a("Unexpected",b)}var c=this.glyph.opticalCenter;return{x:parseFloat(c[0]),y:-parseFloat(c[1])}},e.getGraceNoteSlashSW=function(){var a=this.getGraceNoteSlashSWSpace();return a.x*=this.spaceSize,a.y*=this.spaceSize,a},e.getGraceNoteSlashSWSpace=function(){if(void 0===this.glyph.graceNoteSlashSW){var b="There is no entry [graceNoteSlashSW] for the glyph ["+this.key+"].";throw new a("Unexpected",b)}var c=this.glyph.graceNoteSlashSW;return{x:parseFloat(c[0]),y:-parseFloat(c[1])}},e.getGraceNoteSlashNW=function(){var a=this.getGraceNoteSlashNWSpace();return a.x*=this.spaceSize,a.y*=this.spaceSize,a},e.getGraceNoteSlashNWSpace=function(){if(void 0===this.glyph.graceNoteSlashNW){var b="There is no entry [graceNoteSlashNW] for the glyph ["+this.key+"].";throw new a("Unexpected",b)}var c=this.glyph.graceNoteSlashNW;return{x:parseFloat(c[0]),y:-parseFloat(c[1])}},e.getRepeatOffset=function(){var a=this.getRepeatOffsetSpace();return a.x*=this.spaceSize,a.y*=this.spaceSize,a},e.getRepeatOffsetSpace=function(){if(void 0===this.glyph.repeatOffset){var b="There is no entry [repeatOffset] for the glyph ["+this.key+"].";throw new a("Unexpected",b)}var c=this.glyph.repeatOffset;return{x:parseFloat(c[0]),y:-parseFloat(c[1])}},e.getBBoxNESpace=function(){var a=this.glyph.bBoxNE;return{x:parseFloat(a[0]),y:-parseFloat(a[1])}},e.getBBoxSWSpace=function(){var a=this.glyph.bBoxSW;return{x:parseFloat(a[0]),y:-parseFloat(a[1])}},e.render=function(){return null===this.scaledPath&&this.calcScaledPath(),this.scaledPath},e.calcScaledPath=function(){for(var a,b,d=[],e=this.pathData,f=e.length,g=0;g<f;){var h=e[g];if(g++,"V"===h||"v"===h)b=-e[g],g++,this.addEntry(d,h,[b]);else if("H"===h||"h"===h)a=e[g],g++,this.addEntry(d,h,[a]);else{var i=c[h.toUpperCase()];if(void 0===i)throw new Adagio.Error.InternalError("BadPathAction","Unknown path action: ["+h+"].");for(var j=[],k=0;k<i;k++)a=e[g],g++,b=-e[g],g++,j.push(a,b);this.addEntry(d,h,j)}}this.scaledPath=d.join("")},e.addEntry=function(a,b,c){for(var d=c.length,e=0;e<d;e++)c[e]*=this.scale;var f=b+c.join(",");a.push(f)},e.getKey=function(){return this.key}}.call(this),function(){"use strict";var a=Adagio.smufl.Glyph,b=Adagio.smufl.GlyphsCache=function(a,b,c){this.init(a,b,c)},c=b.prototype;c.init=function(a,b,c){this.font=a,this.dpi=b,this.pointSize=c,this.glyphs={}},c.getScaledGlyph=function(b,c){var d=this.pointSize*c;return new a(b,d,this.dpi,this.font)},c.getGlyph=function(a){return void 0===this.glyphs[a]&&this.loadGlyph(a),this.glyphs[a]},c.loadGlyph=function(b){var c=new a(b,this.pointSize,this.dpi,this.font);this.glyphs[b]=c}}.call(this),function(){"use strict";Adagio.Drawer.ctx.ctx_partName=function(a){a.getPartNameFontSize=function(){var a;return a=void 0!==this.options.partName&&void 0!==this.options.partName["font-size"]?this.options.partName["font-size"]:3,a*=this.getSpaceSize()},a.getPartNameFontFamily=function(){return void 0!==this.options.partName&&void 0!==this.options.partName["font-family"]?this.options.partName["font-family"]:"Georgia"},a.getPartNameFill=function(){return void 0!==this.options.partName&&void 0!==this.options.partName.fill?this.options.partName.fill:"black"},a.getPartNameLetterSpacing=function(){return void 0!==this.options.partName&&void 0!==this.options.partName["letter-spacing"]?this.options.partName["letter-spacing"]:null},a.getPartNameTextTransform=function(){return void 0!==this.options.partName&&void 0!==this.options.partName["text-transform"]?this.options.partName["text-transform"]:null},a.getPartNameFontWeight=function(){return void 0!==this.options.partName&&void 0!==this.options.partName["font-weight"]?this.options.partName["font-weight"]:"Regular"}}}.call(this),function(){"use strict";Adagio.Drawer.ctx.ctx_harmonyText=function(a){a.getHarmonyFontFamily=function(){return void 0!==this.options.harmonyText&&void 0!==this.options.harmonyText["font-family"]?this.options.harmonyText["font-family"]:"Georgia"}}}.call(this),function(){"use strict";Adagio.Drawer.ctx.ctx_rehearsalText=function(a){a.getRehearsalFontFamily=function(){return void 0!==this.options.rehearsalText&&void 0!==this.options.rehearsalText["font-family"]?this.options.rehearsalText["font-family"]:"Georgia"}}}.call(this),function(){"use strict";Adagio.Drawer.ctx.ctx_measureNumber=function(a){a.getMeasureNumberFontFamily=function(){return void 0!==this.options.measureNumber&&void 0!==this.options.measureNumber["font-family"]?this.options.measureNumber["font-family"]:"Georgia"}}}.call(this),function(){"use strict";Adagio.Drawer.ctx.ctx_pageNumber=function(a){a.getPageNumberFontFamily=function(){return void 0!==this.options.pageNumber&&void 0!==this.options.pageNumber["font-family"]?this.options.pageNumber["font-family"]:"Georgia"}}}.call(this),function(){"use strict";Adagio.Drawer.ctx.ctx_lyric=function(a){a.getLyricFontFamily=function(){return void 0!==this.options.lyric&&void 0!==this.options.lyric["font-family"]?this.options.lyric["font-family"]:"Georgia"}}}.call(this),function(){"use strict";Adagio.Drawer.ctx.ctx_fingering=function(a){a.getFingeringFontFamily=function(){return void 0!==this.options.fingering&&void 0!==this.options.fingering["font-family"]?this.options.fingering["font-family"]:"Noto"}}}.call(this),function(){"use strict";Adagio.Drawer.ctx.ctx_tempo=function(a){a.getTempoFontFamily=function(){return void 0!==this.options.tempo&&void 0!==this.options.tempo["font-family"]?this.options.tempo["font-family"]:"Georgia"}}}.call(this),function(){"use strict";Adagio.Drawer.ctx.ctx_title=function(a){a.getTitleFontFamily=function(){return void 0!==this.options.title&&void 0!==this.options.title["font-family"]?this.options.title["font-family"]:"Georgia"}}}.call(this),function(){"use strict";Adagio.Drawer.ctx.ctx_subtitle=function(a){a.getSubtitleFontFamily=function(){return void 0!==this.options.subtitle&&void 0!==this.options.subtitle["font-family"]?this.options.subtitle["font-family"]:"Georgia"}}}.call(this),function(){"use strict";Adagio.Drawer.ctx.ctx_lyricist=function(a){a.getLyricistFontFamily=function(){return void 0!==this.options.lyricist&&void 0!==this.options.lyricist["font-family"]?this.options.lyricist["font-family"]:"Georgia"}}}.call(this),function(){"use strict";Adagio.Drawer.ctx.ctx_composer=function(a){a.getComposerFontFamily=function(){return void 0!==this.options.composer&&void 0!==this.options.composer["font-family"]?this.options.composer["font-family"]:"Georgia"}}}.call(this),function(){"use strict";Adagio.Drawer.ctx.ctx_copyrights=function(a){a.getCopyrightsFontFamily=function(){return void 0!==this.options.copyrights&&void 0!==this.options.copyrights["font-family"]?this.options.copyrights["font-family"]:"Georgia"}}}.call(this),function(){"use strict";Adagio.Drawer.ctx.ctx_pizzicato=function(a){a.getPizzicatoFontFamily=function(){return void 0!==this.options.pizzicato&&void 0!==this.options.pizzicato["font-family"]?this.options.pizzicato["font-family"]:"Georgia"},a.getPizzicatoFontStyle=function(){return void 0!==this.options.pizzicato&&void 0!==this.options.pizzicato["font-style"]?this.options.pizzicato["font-style"]:"italic"}}}.call(this),function(){"use strict";Adagio.Drawer.ctx.ctx_word=function(a){a.getWordFontFamily=function(){return void 0!==this.options.word&&void 0!==this.options.word["font-family"]?this.options.word["font-family"]:"Georgia"}}}.call(this),function(){"use strict";Adagio.Drawer.ctx.ctx_octaveShift=function(a){a.getOctaveShiftFontFamily=function(){return void 0!==this.options.octaveShift&&void 0!==this.options.octaveShift["font-family"]?this.options.octaveShift["font-family"]:"Georgia"},a.getOctaveShiftFontStyle=function(){return void 0!==this.options.octaveShift&&void 0!==this.options.octaveShift["font-style"]?this.options.octaveShift["font-style"]:"italic"}}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils,c=Adagio.Drawer.DynamicsMetrics,d=Adagio.Drawer.formatter.sequential.NotesSequentialFormatter,e=Adagio.Values.MeasureLocation,f=Adagio.settings.PrintRatios,g=Adagio.smufl.GlyphsCache,h=Adagio.Drawer.ctx.ctx_partName,i=Adagio.Drawer.ctx.ctx_harmonyText,j=Adagio.Drawer.ctx.ctx_rehearsalText,k=Adagio.Drawer.ctx.ctx_measureNumber,l=Adagio.Drawer.ctx.ctx_pageNumber,m=Adagio.Drawer.ctx.ctx_lyric,n=Adagio.Drawer.ctx.ctx_fingering,o=Adagio.Drawer.ctx.ctx_tempo,p=Adagio.Drawer.ctx.ctx_title,q=Adagio.Drawer.ctx.ctx_subtitle,r=Adagio.Drawer.ctx.ctx_lyricist,s=Adagio.Drawer.ctx.ctx_composer,t=Adagio.Drawer.ctx.ctx_copyrights,u=Adagio.Drawer.ctx.ctx_pizzicato,v=Adagio.Drawer.ctx.ctx_word,w=Adagio.Drawer.ctx.ctx_octaveShift,x=Adagio.Drawer.chord.settings,y=Adagio.Drawer.DrawingContext=function(a,b,c,d,e){this.init(a,b,c,d,e)},z=y.prototype;h(z),i(z),j(z),k(z),l(z),m(z),n(z),o(z),p(z),q(z),r(z),s(z),t(z),u(z),v(z),w(z),z.init=function(a,b,c,d,e){B(c,"point size"),B(d,"dots per inch"),null!==b?(A(b),this.glyphsCache=new g(b,d,c)):this.glyphsCache=null,this.textMetric=a,this.oldGlyphScale=c*d/100,this.pixelPointSize=c*d/f.POINTS_BY_INCH,this.spaceSize=this.pixelPointSize/f.SP_PER_EM,this.initOptions(e),this.firstOfScore=!0,this.dynamicsMetrics=null};var A=function(b){if(void 0===b||void 0===b.glyphs){throw new a("BadSmuflFont","Bad SMuFL font json.")}},B=function(b,c){if("number"!=typeof b||isNaN(b)||b<=0){throw new a("BadScaleValue","The value ["+b+"] is invalid for "+c+".")}};z.initOptions=function(a){a=a||{},this.options=b.merge_options(C,a)};var C={notesSpacingCoeff:1.25,graceSizeCoeff:.7,graceFlagSizeCoeff:.5,noteMarginRatio:.5,spaceBetweenShardsRatio:6,spaceBetweenSystemGroupsRatio:12,spaceBetweenSystemsRatio:4,bracketStrokeRatio:1/6,bracketHorizontalMarginRatio:1/12,bracketVerticalMarginRatio:1/15,wedgeGapSizeRatio:.5,wedgeMarginSizeRatio:.25,wordFontSizeRatio:1/1.5,fingeringFontSizeRatio:1.2,wordStartOffsetRatio:2,spaceAboveStaffRatio:4,spaceBelowStaffRatio:4,spaceBetweenStavesRatio:3,minimalSpaceBelowStaffRatio:2,minimalSpaceAboveStaffRatio:2,attributesOffsetRatio:.25,timeDigitMarginRatio:.25,keyGroupMarginRatio:2/3,keyAccidentalMarginRatio:1/3,measureNumberSizeRatio:4/3,measureWidthRatio:0,pageMeasureWidthRatio:15,tieEndpointThicknessRatio:.1,tieMidpointThicknessRatio:.22,tieVerticalMarginRatio:.75,tieHorizontalMarginRatio:.2,minimalTieWidthRatio:3,repeatDotRadiusRatio:.2,thinBarlineThicknessRatio:.16,thickBarlineThicknessRatio:.5,barlineSeparationRatio:.4,repeatBarlineDotSeparationRatio:.16,stemThicknessRatio:.12,legerLineThicknessRatio:.16,staffLineThicknessRatio:.13,tupletBracketThicknessRatio:.16,tupletBracketHeightRatio:.7,hairpinThicknessRatio:.16,hairpinOpenSpreadRatio:1,hairpinOpenContinueSpreadRatio:2/3,hairpinCloseSpreadRatio:0,hairpinCloseContinueSpreadRatio:1/3,directionAboveMarginRatio:2,directionBelowMarginRatio:1.5,spaceBeforeNotesRatio:1.5,spaceAfterNotesRatio:1.5,slurEndpointThicknessRatio:.1,slurMidpointThicknessRatio:.22,minimalSpaceAboveRightStaffRatio:4,repeatEndingLineThickness:.16,tabStaffSpaceRatio:1.4,jumpsFontSizeRatio:1.1,glissandoExcessWidth:.22,glissandoHorizontalMarginRatio:.25,minimalGlissandoWidthRatio:3,mMRExternalThickness:.32,mMRInternalThickness:.7,octaveShiftStrokeWidth:.1,octaveLineThickness:.1,octaveShiftDashArrayWidth:1,octaveShiftTextMargin:.25,tempoChangeTextMargin:.25,tempoChangeThickness:.25,tempoChangeDashArrayWidth:.5,textEnclosureThicknessRatio:.16};z.getSpaceSize=function(){return this.spaceSize},z.getGraceSizeCoeff=function(){return this.options.graceSizeCoeff},z.getGraceFlagSizeCoeff=function(){return this.options.graceFlagSizeCoeff},z.getPixelPointSize=function(){return this.pixelPointSize},z.getMarginSize=function(){return this.spaceSize*this.options.noteMarginRatio},z.getSpaceBetweenShards=function(){return this.spaceSize*this.options.spaceBetweenShardsRatio},z.getSpaceBetweenSystemGroups=function(){return this.spaceSize*this.options.spaceBetweenSystemGroupsRatio},z.getSpaceBetweenSystems=function(){return this.spaceSize*this.options.spaceBetweenSystemsRatio},z.getBracketStrokeWidth=function(){return this.oldGlyphScale*this.options.bracketStrokeRatio},z.getBracketHorizontalMargin=function(){return this.oldGlyphScale*this.options.bracketHorizontalMarginRatio},z.getBracketVerticalMargin=function(){return this.oldGlyphScale*this.options.bracketVerticalMarginRatio},z.getWedgeGapSize=function(){return this.oldGlyphScale*this.options.wedgeGapSizeRatio},z.getWedgeMarginSize=function(){return this.oldGlyphScale*this.options.wedgeMarginSizeRatio},z.getWordFontSize=function(){return this.oldGlyphScale*this.options.wordFontSizeRatio},z.getWordStartOffset=function(){return this.oldGlyphScale*this.options.wordStartOffsetRatio},z.getFingeringFontSize=function(){return this.spaceSize*this.options.fingeringFontSizeRatio},z.getSpaceBelowStaff=function(){return this.spaceSize*this.options.spaceAboveStaffRatio},z.getSpaceAboveStaff=function(){return this.spaceSize*this.options.spaceBelowStaffRatio},z.getSpaceBetweenStaves=function(){return this.spaceSize*this.options.spaceBetweenStavesRatio},z.getMinimalSpaceBelowStaff=function(){return this.spaceSize*this.options.minimalSpaceBelowStaffRatio},z.getMinimalSpaceAboveStaff=function(){return this.spaceSize*this.options.minimalSpaceAboveStaffRatio},z.getAttributesOffset=function(){return this.oldGlyphScale*this.options.attributesOffsetRatio},z.getTimeDigitMargin=function(){return this.spaceSize*this.options.timeDigitMarginRatio},z.getKeyGroupMargin=function(){return this.spaceSize*this.options.keyGroupMarginRatio},z.getKeyAccidentalMargin=function(){return this.spaceSize*this.options.keyAccidentalMarginRatio},z.getMeasureNumberSize=function(){return this.spaceSize*this.options.measureNumberSizeRatio},z.getMeasureWidth=function(){return this.spaceSize*this.options.measureWidthRatio},z.getPageMeasureWidth=function(){return this.spaceSize*this.options.pageMeasureWidthRatio},z.getTieEndpointThickness=function(){return this.spaceSize*this.options.tieEndpointThicknessRatio},z.getTieMidpointThickness=function(){return this.spaceSize*this.options.tieMidpointThicknessRatio},z.getTieVerticalMargin=function(){return this.spaceSize*this.options.tieVerticalMarginRatio},z.getTieHorizontalMargin=function(){return this.spaceSize*this.options.tieHorizontalMarginRatio},z.getMinimalTieWidth=function(){return this.spaceSize*this.options.minimalTieWidthRatio},z.getRepeatDotRadius=function(){return this.spaceSize*this.options.repeatDotRadiusRatio},z.getThinBarlineThickness=function(){return this.spaceSize*this.options.thinBarlineThicknessRatio},z.getThickBarlineThickness=function(){return this.spaceSize*this.options.thickBarlineThicknessRatio},z.getBarlineSeparation=function(){return this.spaceSize*this.options.barlineSeparationRatio},z.getRepeatBarlineDotSeparation=function(){return this.spaceSize*this.options.repeatBarlineDotSeparationRatio},z.getStemThickness=function(){return this.spaceSize*this.options.stemThicknessRatio},z.getLegerLineThickness=function(){return this.spaceSize*this.options.legerLineThicknessRatio},z.getStaffLineThickness=function(){return this.spaceSize*this.options.staffLineThicknessRatio},z.getTupletBracketThickness=function(){return this.spaceSize*this.options.tupletBracketThicknessRatio},z.getTupletBracketHeight=function(){return this.spaceSize*this.options.tupletBracketHeightRatio},z.getHairpinThickness=function(){return this.spaceSize*this.options.hairpinThicknessRatio},z.getHairpinOpenSpread=function(){return this.getDynamicsHeight()*this.options.hairpinOpenSpreadRatio},z.getHairpinOpenContinueSpread=function(){return this.getDynamicsHeight()*this.options.hairpinOpenContinueSpreadRatio},z.getHairpinCloseSpread=function(){return this.getDynamicsHeight()*this.options.hairpinCloseSpreadRatio},z.getHairpinCloseContinueSpread=function(){return this.getDynamicsHeight()*this.options.hairpinCloseContinueSpreadRatio},z.getDirectionAboveMargin=function(){return this.spaceSize*this.options.directionAboveMarginRatio},z.getDirectionBelowMargin=function(){return this.spaceSize*this.options.directionBelowMarginRatio},z.getSpaceBeforeNotes=function(){return this.spaceSize*this.options.spaceBeforeNotesRatio},z.getSpaceAfterNotes=function(){return this.spaceSize*this.options.spaceAfterNotesRatio},z.getSlurEndpointThickness=function(){return this.spaceSize*this.options.slurEndpointThicknessRatio},z.getSlurMidpointThickness=function(){return this.spaceSize*this.options.slurMidpointThicknessRatio},z.getRepeatEndingLineThickness=function(){return this.spaceSize*this.options.repeatEndingLineThickness},z.getGlissandoExcessWidth=function(){return this.spaceSize*this.options.glissandoExcessWidth},z.getGlissandoHorizontalMargin=function(){return this.spaceSize*this.options.glissandoHorizontalMarginRatio},z.getMinimalGlissandoWidth=function(){return this.spaceSize*this.options.minimalGlissandoWidthRatio},z.getMMRInternalThickness=function(){return this.spaceSize*this.options.mMRInternalThickness},z.getMMRExternalThickness=function(){return this.spaceSize*this.options.mMRExternalThickness},z.getOctaveShiftStrokeWidth=function(){return this.spaceSize*this.options.octaveShiftStrokeWidth},z.getOctaveLineThickness=function(){return this.spaceSize*this.options.octaveLineThickness},z.getOctaveShiftDashArrayWidth=function(){return this.spaceSize*this.options.octaveShiftDashArrayWidth},z.getOctaveShiftHeight=function(){return this.getGlyph("ottavaAlta").getHeight()},z.getOctaveShiftTextMargin=function(){return this.spaceSize*this.options.octaveShiftTextMargin},z.getTextEnclosureThickness=function(){return this.spaceSize*this.options.textEnclosureThicknessRatio},z.getOctaveShiftFontSize=function(){return this.getGlyphScale()/2},z.getTempoChangeHeight=function(){return 1.5*this.getTempoChangeFontSize()},z.getTempoChangeFontSize=function(){return this.getGlyphScale()/1.5},z.getTempoChangeTextMargin=function(){return this.spaceSize*this.options.tempoChangeTextMargin},z.getTempoChangeThickness=function(){return this.spaceSize*this.options.tempoChangeThickness},z.getTempoChangeDashArrayWidth=function(){return this.spaceSize*this.options.tempoChangeDashArrayWidth},z.getRehearsalPadding=function(){return this.getRehearsalFontSize()/7},z.getRehearsalFontSize=function(){return 1.25*this.getGlyphScale()},z.getHammerOnPullOffFontSize=function(){return this.getGlyphScale()/2.5},z.getLyricsFontSize=function(){return this.getGlyphScale()/1.3},z.getHarmonyFontSize=function(){return this.getPixelPointSize()*x.GLOBAL_RATIO},z.getPizzicatoHeight=function(){return 1.5*this.getPizzicatoFontSize()},z.getPizzicatoFontSize=function(){return this.getGlyphScale()/1.5},z.getWordHeight=function(){return 1.5*this.getWordFontSize()},z.getJumpsFontSize=function(){return this.getGlyphScale()/this.options.jumpsFontSizeRatio},z.getGlyphScale=function(){return this.oldGlyphScale},z.getGlyph=function(a){return this.glyphsCache.getGlyph(a)},z.getScaledGlyph=function(a,b){return this.glyphsCache.getScaledGlyph(a,b)},z.getGlyphBBox=function(a){return this.getGlyph(a).getBBox()},z.isFirstOfScore=function(){return this.firstOfScore},z.getMeasureLocationForMeasureIdx=function(a){return 0===a?this.isFirstOfScore()?e.FIRST_OF_SCORE:e.FIRST_OF_LINE:e.OTHER},z.getComputedTextLength=function(a,b,c,d){return this.textMetric.getComputedTextLength(a,b,c,d)},z.getTextXHeight=function(a,b){return this.textMetric.getXHeight(a,b)},z.isTextMetricFromFont=function(){return this.textMetric.isFromFont()},z.getNotesFormatter=function(){return d},z.getDynamicsMiddle=function(){return this.getDynamicsMetrics().getMiddle()},z.getDynamicsHeight=function(){return this.getDynamicsMetrics().getWedgeHeight()},z.getDynamicsMetrics=function(){return null===this.dynamicsMetrics&&(this.dynamicsMetrics=new c(this.glyphsCache)),this.dynamicsMetrics},z.getMinimalSpaceAboveRightRatio=function(){return this.spaceSize*this.options.minimalSpaceAboveRightStaffRatio},z.getMeasureRendererOpts=function(){return{isConcertPitch:this.isConcertPitch()}},z.isConcertPitch=function(){return!!this.options.isConcertPitch},z.getNotesSpacingCoeff=function(){return this.options.notesSpacingCoeff},z.getTabSpaceSize=function(){return this.getSpaceSize()*this.options.tabStaffSpaceRatio}}.call(this),function(){"use strict";var a=Adagio.settings.PrintRatios;Adagio.scale.extractPointSize=function(b){var c=a.MM_PER_INCH/(a.TENTH_PER_EM*a.POINTS_BY_INCH);return b.scaleToMillimeters(1)/c}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.math,c=Adagio.Values.DisplayScaling={MIN:.1,MAX:10,DEFAULT:1};c.assert=function(a){c.isValid(a)||c.raiseError(a)},c.raiseError=function(b){throw new a("BadDisplayScaling","The scaling ["+b+"] is invalid.")},c.isValid=function(a){return b.isNumber(a)&&c.MIN<=a&&a<=c.MAX}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.math,c=Adagio.Utils.partContentUtils,d=Adagio.Utils.partHeaderUtils,e=Adagio.Render.StaticScoreData=function(a,b,c){this.init(a,b,c)},f=e.prototype;f.init=function(a,b,c){this.commonContent=a,this.partsHeaders=b,this.partsContents=c},f.getNbMeasures=function(){return this.commonContent.getNbMeasures()},f.getNbParts=function(){return this.partsHeaders.length},f.getCommonContent=function(){return this.commonContent},f.getPartsHeaders=function(){return this.partsHeaders},f.getPartsContents=function(){return this.partsContents},f.getMeasure=function(d,e){this.checkPartIdx(d);var f=this.getNbMeasures();if(!b.isInteger(e)||e<0||e>=f){throw new a("BadMeasureIdx","Bad measure idx ["+e+"<"+typeof e+">] on a static view of the ScoreData.")}var g=this.partsContents[d];return c.getMeasure(g,e)},f.getPartStaffMapping=function(a){var b=this.getPartHeader(a);return d.getStaffMapping(b)},f.getPartStaffVoicesIndexes=function(a,b){var c=this.getPartHeader(a);return d.getStaffVoicesIndexes(c,b)},f.getPartHeader=function(a){return this.checkPartIdx(a),this.partsHeaders[a]},f.checkPartIdx=function(c){var d=this.getNbParts();if(!b.isInteger(c)||c<0||c>=d){throw new a("BadPartIdx","Bad part idx ["+c+"<"+typeof c+">] on a static view of the ScoreData.")}}}.call(this),function(){"use strict";var a=Adagio.Error.display.DisplayError=function(a,b){var c=Error.call(this,a);return this.name=c.name="DisplayError",this.stack=c.stack,this.message=c.message,void 0!==b&&(this.code=b),this};a.prototype=Object.create(Error.prototype,{constructor:{value:a}})}.call(this),function(){"use strict";var a=Adagio.Utils.partContentUtils,b=Adagio.Error.display.DisplayError;Adagio.Render.slicePartsContentsMeasures=function(b,e){var f=b[0],g=a.getNbMeasures(f),h=c(e,g);return b=b.map(d,h)};var c=function(a,c){var d={};if("number"==typeof a.firstMeasureIdx){var e=a.firstMeasureIdx;if(e<0||e>=c)throw new b("first measure idx ["+e+"] is out of bounds");d.firstMeasureIdx=e}else d.firstMeasureIdx=0;if("number"==typeof a.lastMeasureIdx){var f=a.lastMeasureIdx;if(f<d.firstMeasureIdx||f>=c)throw new b("last measure idx ["+f+"] is out of bounds");d.lastMeasureIdx=f}else d.lastMeasureIdx=c-1;return d},d=function(b){var c=this,d=a.getMeasures(b);return d=d.slice(c.firstMeasureIdx,c.lastMeasureIdx+1),b={measure:d}}}.call(this),function(){"use strict"
;var a=Adagio.Data.common.CommonContent,b=Adagio.Error.display.DisplayError,c=Adagio.Utils.timeUtils,d=Adagio.Utils.clone;Adagio.Render.sliceCommonContentMeasures=function(a,b){var c=a.getNbMeasures(),d=e(b,c);return a=f(a,d)};var e=function(a,c){var d={};if("number"==typeof a.firstMeasureIdx){var e=a.firstMeasureIdx;if(e<0||e>=c)throw new b("first measure idx ["+e+"] is out of bounds");d.firstMeasureIdx=e}else d.firstMeasureIdx=0;if("number"==typeof a.lastMeasureIdx){var f=a.lastMeasureIdx;if(f<d.firstMeasureIdx||f>=c)throw new b("last measure idx ["+f+"] is out of bounds");d.lastMeasureIdx=f}else d.lastMeasureIdx=c-1;return d},f=function(b,e){for(var f=new a,g=e.firstMeasureIdx;g<=e.lastMeasureIdx;g++){var h=g-e.firstMeasureIdx,i=b.getTempo(g),j=b.getSwing(g);if(f.addMeasure(h,i,j),(0===h||b.hasOwnTempo(g))&&f.setOwnTempo(h,i),(0===h||b.hasOwnSwing(g))&&f.setOwnSwing(h,j),b.hasRehearsal(g)){var k=b.getRehearsal(g);f.setRehearsal(h,k)}if(b.hasEnding(g)){var l=b.getEnding(g);l=l.slice(),f.setEnding(h,l)}if(b.hasJumpTag(g)){var m=b.getJumpTag(g);f.setJumpTag(h,m)}if(b.hasJumpCall(g)){var n=b.getJumpCall(g);f.setJumpCall(h,n)}if(b.hasTempoChanges(g)){var o=b.getTempoChanges(g);o=o.slice(),f.setTempoChanges(g,o)}if(b.hasLeftTempoChange(g)){var p=b.getLeftTempoChange(g);p=d(p),f.setLeftTempoChange(g,p)}if(b.hasRightTempoChange(g)){var q=b.getRightTempoChange(g);q=d(q),f.setRightTempoChange(g,q)}var r=b.getDisplayedTime(g);r=c.copy(r),f.setDisplayedTime(h,r)}return f}}.call(this),function(){"use strict";Adagio.Render.hideTempo=function(b){a(b)&&b.removeOwnTempo(0)};var a=function(a){for(var b=a.getNbMeasures(),c=1;c<b;c++)if(a.hasOwnTempo(c))return!1;return!0}}.call(this),function(){"use strict";var a=Adagio.Utils.timeUtils,b=Adagio.Utils.tempoUtils;Adagio.Render.emptyMeasure.isCommonMeasureEmpty=function(c,d){if(c.hasEnding(d))return!1;if(c.hasRehearsal(d))return!1;if(c.hasJumpCall(d))return!1;if(c.hasJumpTag(d))return!1;if(0===d)return!0;var e=c.getDisplayedTime(d),f=c.getDisplayedTime(d-1);if(!a.isSame(f,e))return!1;var g=c.getTempo(d),h=c.getTempo(d-1);return!!b.isSame(g,h)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.noteUtils,c=Adagio.Utils.barlineUtils;Adagio.Render.emptyMeasure.isPartMeasureEmpty=function(b){if(a.getNotes(b).some(d))return!1;if(a.hasHarmonies(b))return!1;if(a.getAllDirections(b).length>0)return!1;if(a.hasRightBarline(b)){if(a.getRightBarlineStyle(b)!==c.DEFAULT_STYLE)return!1}if(a.hasLeftBarline(b)){if(a.getLeftBarlineStyle(b)!==c.DEFAULT_STYLE)return!1}return!0};var d=function(a){return!b.isRest(a)}}.call(this),function(){"use strict";var a=Adagio.Utils.partContentUtils,b=Adagio.Render.emptyMeasure.isPartMeasureEmpty;Adagio.Render.emptyMeasure.isPartsMeasureEmpty=function(a,b){return a.every(c,b)};var c=function(c){var d=this.valueOf(),e=a.getMeasure(c,d);return b(e)}}.call(this),function(){"use strict";var a=Adagio.Render.emptyMeasure.isCommonMeasureEmpty,b=Adagio.Render.emptyMeasure.isPartsMeasureEmpty;Adagio.Render.emptyMeasure.isScoreMeasureEmpty=function(c,d,e){return!!a(c,e)&&!!b(d,e)}}.call(this),function(){"use strict";var a=Adagio.Render.emptyMeasure.isScoreMeasureEmpty;Adagio.Render.emptyMeasure.getEmptyMeasuresIndexes=function(b,c){for(var d=[],e=b.getNbMeasures(),f=0;f<e;f++)a(b,c,f)&&d.push(f);return d}}.call(this),function(){"use strict";Adagio.Render.emptyMeasure.groupConsecutiveIndexes=function(a){return c().group(a)};var a=function(){},b=a.prototype;b.group=function(a){this.reset(),a.forEach(this.addMeasureIdx,this),this.hasGroup()&&this.closeGroup();var b=this.groups;return this.groups=null,b},b.reset=function(){this.groups=[],this.currentGroup=null},b.addMeasureIdx=function(a){this.canAddToGroup(a)?this.addToGroup():(this.hasGroup()&&this.closeGroup(),this.createGroup(a))},b.canAddToGroup=function(a){if(this.hasGroup()){var b=this.currentGroup;return b.measureIdx+b.nbMeasures===a}return!1},b.hasGroup=function(){return null!==this.currentGroup},b.closeGroup=function(){this.groups.push(this.currentGroup),this.currentGroup=null},b.createGroup=function(a){this.currentGroup={measureIdx:a,nbMeasures:1}},b.addToGroup=function(){this.currentGroup.nbMeasures++};var c=function(){return null===d&&(d=new a),d},d=null}.call(this),function(){"use strict";var a=Adagio.Utils.partContentUtils;Adagio.Render.emptyMeasure.removeGroupsMeasures=function(a,c,d){var e={commonContent:a,partsContents:c};d.forEach(b,e)};var b=function(a){var b=this.commonContent;b.setNbMultiMeasuresRest(a.measureIdx,a.nbMeasures);for(var d=1;d<a.nbMeasures;d++)b.removeMeasure(a.measureIdx+1);this.partsContents.forEach(c,a)},c=function(b){var c=this;a.getMeasures(b).splice(c.measureIdx+1,c.nbMeasures-1)}}.call(this),function(){"use strict";var a=Adagio.Render.emptyMeasure.getEmptyMeasuresIndexes,b=Adagio.Render.emptyMeasure.groupConsecutiveIndexes,c=Adagio.Render.emptyMeasure.removeGroupsMeasures,d=4;Adagio.Render.emptyMeasure.mergeConsecutiveEmptyMeasures=function(d,f){var g=a(d,f),h=b(g);h=h.filter(e),h.reverse(),c(d,f,h)};var e=function(a){return a.nbMeasures>=d}}.call(this),function(){"use strict";var a=Adagio.Utils.mapUtils,b=Adagio.Utils.noteUtils;Adagio.Render.mergeRests.splitByVoices=function(b){var d={};return b.forEach(c,d),a.getValues(d)};var c=function(a){var c=this,d=b.getVoiceIdx(a);void 0===c[d]&&(c[d]=[]),c[d].push(a)}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.math;Adagio.Render.mergeRests.mergeVoiceRests=function(d){if(d.every(a.isRest)){var e=d.map(a.getDuration),f=e.reduce(b.add),g=d[0];return a.setDuration(g,f),a.setFullMeasureRest(g,!0),a.removeTupletBounds(g),[g]}return d.forEach(c),d};var c=function(b){a.isRest(b)&&a.setFullMeasureRest(b,!1)}}.call(this),function(){"use strict";var a=Adagio.Render.mergeRests.splitByVoices,b=Adagio.Render.mergeRests.mergeVoiceRests;Adagio.Render.mergeRests.mergeNotesRests=function(c){var d=a(c);return d=d.map(b),c=Array.prototype.concat.apply([],d)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Render.mergeRests.mergeNotesRests;Adagio.Render.mergeRests.mergeMeasureRests=function(c){var d=a.getNotes(c);d=b(d),a.setNotes(c,d)}}.call(this),function(){"use strict";var a=Adagio.Render.mergeRests.mergeMeasureRests,b=Adagio.Utils.partContentUtils;Adagio.Render.mergeRests.mergePartRests=function(c){b.getMeasures(c).forEach(a)}}.call(this),function(){"use strict";var a=Adagio.Render.mergeRests.mergePartRests;Adagio.Render.mergeRests.mergePartsRests=function(b){b.forEach(a)}}.call(this),function(){"use strict";var a=Adagio.Render.StaticScoreData,b=Adagio.Render.slicePartsContentsMeasures,c=Adagio.Render.sliceCommonContentMeasures,d=Adagio.Render.hideTempo,e=Adagio.Render.emptyMeasure.mergeConsecutiveEmptyMeasures,f=Adagio.Render.mergeRests.mergePartsRests,g=Adagio.Utils.math;Adagio.Render.getDataSource=function(a,b){var c=new h(a);return c.applyOpts(b),c.getDataSource()};var h=function(a){this.init(a)},i=h.prototype;i.init=function(a){this.modified=!1,this.scoreData=a,this.partsContents=a.getPartsContents(),this.commonContent=a.getCommonContent()},i.applyOpts=function(a){j(a)&&this.slice(a),a.mergeEmptyMeasures&&this.mergeConsecutiveEmptyMeasures(),a.mergeRests&&this.mergePartsRests(),a.hideTempo&&this.hideTempo()};var j=function(a){return g.isInteger(a.firstMeasureIdx)||g.isInteger(a.lastMeasureIdx)};i.slice=function(a){this.partsContents=b(this.partsContents,a),this.commonContent=c(this.commonContent,a),this.modified=!0},i.mergeConsecutiveEmptyMeasures=function(){e(this.commonContent,this.partsContents),this.modified=!0},i.mergePartsRests=function(){f(this.partsContents),this.modified=!0},i.hideTempo=function(){d(this.commonContent)},i.getDataSource=function(){if(this.modified){this.scoreData.makeReadOnly();var b=this.scoreData.getPartsHeaders();return new a(this.commonContent,b,this.partsContents)}return this.scoreData}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.staffUtils,c=Adagio.Utils.voiceUtils,d=Adagio.Utils.mapUtils,e=Adagio.Utils.noteUtils,f=Adagio.Utils.transposeUtils,g=Adagio.Utils.pitchUtils,h=Adagio.Utils.direction.octaveShiftDirectionUtils,i=Adagio.Data.octaveShift.searchOctaveShift,j=Adagio.Values.OctaveShiftType,k=Adagio.Values.OctaveShiftSize,l=Adagio.Utils.octaveShiftMeasureUtils={};l.canShape=function(a){return m(a)};var m=function(b){for(var c=a.getNbStaves(b),d=0;d<c;d++){var e=p(b,d),f=a.getOctaveShifts(b,d);if(null!==e||f.length>0)return!0}return!1};l.shapeMeasure=function(c){var e=a.getNotes(c),f=b.groupStaves(e);d.forEach(f,n,c)};var n=function(b,e){var f=this,g=c.groupVoices(e),h=p(f,b),i=a.getOctaveShifts(f,b);d.forEach(g,o,{leftOctaveShift:h,octaveShifts:i})},o=function(a,b){var c,d=this.leftOctaveShift,f=this.octaveShifts,g=0;b.forEach(function(a){e.isChord(a)||(c=i(d,f,g,!0)),c&&e.hasPitch(a)&&q(a,c),e.isChord(a)||(g+=e.getDuration(a))})},p=function(b,c){return a.hasLeftOctaveShift(b,c)?a.getLeftOctaveShift(b,c):null},q=function(a,b){var c=e.getPitch(a),d=r(b),h=f.createDefault();f.setOctaveChange(h,d),c=g.transpose(c,h),e.setPitch(a,c)},r=function(a){var b=h.getSize(a),c=h.getType(a),d=k.sizeToOctaveShift(b);return c===j.DOWN?-d:d}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.clefUtils,c=Adagio.Utils.timeUtils,d=Adagio.Utils.keyUtils,e=Adagio.Utils.transposeUtils,f=Adagio.Utils.staffUtils,g=Adagio.Utils.staffDetailsUtils,h=Adagio.Utils.noteUtils,i=Adagio.Utils.clone,j=Adagio.Utils.typeUtils,k=Adagio.Utils.tabMeasureUtils={};k.canShape=function(c){if(a.getNbStaves(c)>1)return!1;var d=a.getClef(c)[0];if(b.isTab(d))return!1;var e=a.getStaffDetails(c)[0];return!!g.hasStaffTuning(e)},k.shapeMeasure=function(b,c){var d=a.getNbStaves(b),e=a.getWrappedClef(b),f=a.getWrappedStaffDetailsOrDefault(b);return c.hideNonTab?l(b,e,f):m(b,d,0,e,f),b};var l=function(b,c,d){var e=0,f=d.getEntry(e),h=g.toTabClef(f);c.setEntry(h,e),a.setClef(b,c.dumpAttribute())},m=function(b,h,i,k,l){var m=a.getNotes(b),o=f.groupStaves(m)[i],p=l.getEntry(i),q=a.getWrappedTranspose(b),r=q.getEntry(i);r=e.copy(r),q.insertEntry(r,i+1);var s=q.dumpAttribute();a.setTranspose(b,s),k.insertEntry(g.toTabClef(p),i+1),l.insertEntry(g.createDefault(),i);var t=a.getWrappedTime(b),u=t.getEntry(i);u=c.copy(u),t.insertEntry(u,i+1);var v=t.dumpAttribute();a.setTime(b,v);var w=a.getWrappedKey(b),x=w.getEntry(i);x=d.copy(x),w.insertEntry(x,i+1);var y=w.dumpAttribute();a.setKey(b,y),o=j.isArray(o)?o.map(n,i+1):[],m=m.concat(o),a.setClef(b,k.dumpAttribute()),a.setStaffDetails(b,l.dumpAttribute()),a.setNotes(b,m),a.setNbStaves(b,h+1)},n=function(a){var b=this.valueOf();return a=i(a),h.setStaffIdx(a,b),a}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.clone,c=Adagio.Utils.uuidUtils,d=Adagio.Utils.octaveShiftMeasureUtils,e=Adagio.Utils.tabMeasureUtils,f=Adagio.Utils.rehearsalUtils,g=Adagio.Render.ScoreDataCache=function(a,b){this.init(a,b)},h=g.prototype;h.init=function(a,b){this.scoreData=a,this.dataId=c.generate(),this.pageOpts=b,this.updated=!0,this.dataCache={},this.displayCache={}},h.stateDataChanged=function(){this.dataId=c.generate(),this.updated=!1,this.dataCache={},this.displayCache={}},h.stateUpdated=function(){this.updated=!0},h.assertUpdated=function(){if(!this.updated){throw new a("Unexpected","The displayed is supposed to be updated when querying measure data.")}},h.hasDataChangedSince=function(a){return this.dataId!==a},h.getDataId=function(){return this.dataId},h.getMeasureDisplayData=function(a,b){return void 0===this.displayCache[a]&&(this.displayCache[a]={}),void 0===this.displayCache[a][b]&&this.createMeasureDisplayData(a,b),this.displayCache[a][b]},h.createMeasureDisplayData=function(a,b){var c=this.scoreData.getNbMeasures(),d=this.scoreData.getCommonContent(),e=d.getDisplayedTime(b),g=this.scoreData.getPartStaffMapping(a),h=this.getMeasure(a,b),i={current:h,previous:null,next:null,ownTempo:null,rehearsal:null,ending:null,jumpTag:null,jumpCall:null,tempoChanges:null,leftTempoChange:null,rightTempoChange:null,displayedTime:e,previousDisplayedTime:null,isFirstPart:0===a,staffMapping:g,nbMmr:null};b>0&&(i.previous=this.getMeasure(a,b-1),i.previousDisplayedTime=d.getDisplayedTime(b-1)),b<c-1&&(i.next=this.getMeasure(a,b+1)),d.hasOwnTempo(b)&&(i.ownTempo=d.getOwnTempo(b)),d.hasRehearsal(b)&&(i.rehearsal=f.copy(d.getRehearsal(b))),d.hasEnding(b)&&(i.ending=d.getEnding(b)),d.hasJumpTag(b)&&(i.jumpTag=d.getJumpTag(b)),d.hasJumpCall(b)&&(i.jumpCall=d.getJumpCall(b)),d.hasMultiMeasuresRest(b)&&(i.nbMmr=d.getNbMultiMeasuresRest(b)),d.hasTempoChanges(b)&&(i.tempoChanges=d.getTempoChanges(b)),d.hasLeftTempoChange(b)&&(i.leftTempoChange=d.getLeftTempoChange(b)),d.hasRightTempoChange(b)&&(i.rightTempoChange=d.getRightTempoChange(b)),this.displayCache[a][b]=i},h.getMeasure=function(a,b){return void 0===this.dataCache[a]&&(this.dataCache[a]={}),void 0===this.dataCache[a][b]&&this.createMeasure(a,b),this.dataCache[a][b]},h.createMeasure=function(a,c){var f=this.scoreData.getMeasure(a,c);f=b(f),d.canShape(f)&&d.shapeMeasure(f),e.canShape(f)&&e.shapeMeasure(f,this.pageOpts),this.dataCache[a][c]=f},h.getNbMeasures=function(){return this.scoreData.getNbMeasures()},h.getNbParts=function(){return this.scoreData.getNbParts()},h.getCommonContent=function(){return this.scoreData.getCommonContent()},h.getPartHeader=function(a){return this.scoreData.getPartHeader(a)},h.getPartStaffVoicesIndexes=function(a,b){return this.scoreData.getPartStaffVoicesIndexes(a,b)}}.call(this),function(){"use strict";var a=Adagio.Utils.pageMarginUtils,b=Adagio.Utils.math,c=Adagio.page.PageMetrics=function(a,b,c){this.init(a,b,c)},d=c.prototype;d.init=function(a,b,c){this.scoreData=a,this.drawingContext=b,this.opts=c},d.setScoreData=function(a){this.scoreData=a},d.setDrawingContext=function(a){this.drawingContext=a},d.getMinimalAvailableWidth=function(){var b=this.getSideAvailableWidth(a.TYPE_ODD),c=this.getSideAvailableWidth(a.TYPE_EVEN);return Math.min(b,c)},d.getAvailableWidth=function(a){var b=this.getPageNumber(a),c=e(b);return this.getSideAvailableWidth(c)},d.getPageNumber=function(a){return this.opts.hasCover?a+2:a+1};var e=function(c){return b.isEven(c)?a.TYPE_EVEN:a.TYPE_ODD};d.getSideAvailableWidth=function(a){var b=this.scoreData.getPageUsableSize(a),c=b.width;return this.tenthsToLocal(c)},d.getAvailableHeight=function(){var b=this.scoreData.getPageUsableSize(a.TYPE_EVEN),c=b.height;return this.tenthsToLocal(c)},d.tenthsToLocal=function(a){return a/10*this.drawingContext.getSpaceSize()}}.call(this),function(){"use strict";var a=Adagio.Brush.Elem,b=Adagio.Utils.math,c=Adagio.page.PageHeader=function(){this.init()};c.cssClass="pageHeader";var d=c.prototype;d.cssClass=c.cssClass,d.init=function(){this.parent=null,this.group=null,this.pageNumber=null,this.logo=null,this.firstPage=null},d.setParent=function(a){this.parent=a},d.setPageNumber=function(a){this.isRendered()&&a.setParent(this.group),this.pageNumber=a},d.setLogo=function(a){this.isRendered()&&a.setParent(this.group),this.logo=a},d.setFirstPage=function(a){this.isRendered()&&a.setParent(this.group),this.firstPage=a},d.setPosition=function(a){this.yPos=a},d.format=function(){null!==this.firstPage&&this.firstPage.format()},d.draw=function(){this.isRendered()||this.render(),this.drawContent(),this.bindToParent()},d.isRendered=function(){return null!==this.group},d.render=function(){this.group=new a("g"),this.group.attr("class",this.cssClass),null!==this.firstPage&&this.firstPage.setParent(this.group),null!==this.pageNumber&&this.pageNumber.setParent(this.group),null!==this.logo&&this.logo.setParent(this.group)},d.drawContent=function(){null!==this.pageNumber&&this.pageNumber.draw(),null!==this.logo&&this.logo.draw(),null!==this.firstPage&&this.firstPage.draw()},d.bindToParent=function(){this.parent.append(this.group)},d.unbind=function(){this.group.removeFromParent()},d.getHeight=function(){var a=[];return null!==this.pageNumber&&a.push(this.pageNumber.getHeight()),null!==this.logo&&a.push(this.logo.getHeight()),null!==this.firstPage&&a.push(this.firstPage.getHeight()),a.reduce(b.max2)}}.call(this),function(){"use strict";var a=Adagio.Brush.Elem,b=Adagio.page.FirstPageHeader=function(){this.init()};b.cssClass="firstPageHeader";var c=b.prototype;c.cssClass=b.cssClass,c.init=function(){this.parent=null,this.group=null,this.title=null,this.subtitle=null,this.creators=null},c.setParent=function(a){this.parent=a},c.setCreators=function(a){this.isRendered()&&a.setParent(this.group),this.creators=a},c.setTitle=function(a){this.isRendered()&&a.setParent(this.group),this.title=a},c.setSubtitle=function(a){this.isRendered()&&a.setParent(this.group),this.subtitle=a},c.format=function(){var a=this.title.getFontSize();this.title.setPosition(a),a+=this.title.getHeight(),null!==this.subtitle?(this.subtitle.setPosition(a),a+=this.subtitle.getHeight()+this.subtitle.getFontSize()):a+=this.title.getFontSize(),null!==this.creators&&(this.creators.format(),this.creators.setPosition(a))},c.draw=function(){this.isRendered()||this.render(),this.drawContent(),this.bindToParent()},c.isRendered=function(){return null!==this.group},c.render=function(){this.group=new a("g"),this.group.attr("class",this.cssClass),null!==this.title&&this.title.setParent(this.group),null!==this.subtitle&&this.subtitle.setParent(this.group),null!==this.creators&&this.creators.setParent(this.group)},c.drawContent=function(){null!==this.title&&this.title.draw(),null!==this.subtitle&&this.subtitle.draw(),null!==this.creators&&this.creators.draw()},c.bindToParent=function(){this.parent.append(this.group)},c.getHeight=function(){var a=this.title.getFontSize();return a+=this.title.getHeight(),null!==this.subtitle?a+=this.subtitle.getHeight()+this.subtitle.getFontSize():a+=this.title.getFontSize(),null!==this.creators&&(a+=this.creators.getHeight()),a}}.call(this),function(){"use strict";var a=Adagio.Drawer.Text,b=Adagio.page.CenteredText=function(){this.init()};b.cssClass="centeredText";var c=b.prototype;c.cssClass=b.cssClass,c.init=function(){this.parent=null,this.text=null,this.drawingContext=null,this.posY=null,this.fontSize=null,this.textString=null,this.width=null,this.height=null,this.fontFamily=null},c.setDrawingContext=function(a){this.drawingContext=a},c.setCssClass=function(a){this.cssClass=a},c.setWidth=function(a){this.width=a},c.setFontSize=function(a){this.fontSize=a},c.setFontFamily=function(a){this.fontFamily=a},c.setPosition=function(a){this.posY=a},c.setParent=function(a){this.parent=a,this.isRendered()&&this.text.setParent(a)},c.setTextString=function(a){this.textString=a},c.draw=function(){this.renderIfNeeded(),this.text.draw()},c.renderIfNeeded=function(){this.isRendered()||this.render()},c.isRendered=function(){return null!==this.text},c.render=function(){var b={"text-anchor":"middle",text:this.textString};null!==this.fontFamily&&(b["font-family"]=this.fontFamily);var c=new a(b);c.setFontSize(this.fontSize),c.setDrawingContext(this.drawingContext),c.render(),c.setCssClass(this.cssClass),null!==this.parent&&c.setParent(this.parent);var d=this.width/2,e=this.posY+this.fontSize;c.setPosition(d,e),this.text=c},c.getHeight=function(){return 1.5*this.fontSize},c.getFontSize=function(){return this.fontSize}}.call(this),function(){"use strict";var a=Adagio.Brush.Elem,b=Adagio.Utils.math,c=Adagio.page.HeaderCreators=function(){this.init()};c.cssClass="creators";var d=c.prototype;d.cssClass=c.cssClass,d.init=function(){this.parent=null,this.group=null,this.composer=null,this.lyricist=null,this.posY=null},d.setParent=function(a){this.parent=a},d.setComposer=function(a){this.isRendered()&&a.setParent(this.group),this.composer=a},d.setLyricist=function(a){this.isRendered()&&a.setParent(this.group),this.lyricist=a},d.setPosition=function(a){this.posY=a},d.format=function(){null!==this.composer&&this.composer.setPosition(0),null!==this.lyricist&&this.lyricist.setPosition(0)},d.draw=function(){this.isRendered()||this.render(),this.drawContent(),this.move(),this.bindToParent()},d.isRendered=function(){return null!==this.group},d.render=function(){this.group=new a("g"),this.group.attr("class",this.cssClass),null!==this.lyricist&&this.lyricist.setParent(this.group),null!==this.composer&&this.composer.setParent(this.group)},d.drawContent=function(){null!==this.composer&&this.composer.draw(),null!==this.lyricist&&this.lyricist.draw()},d.move=function(){this.group.attr("transform","translate(0, "+this.posY+")")},d.bindToParent=function(){this.parent.append(this.group)},d.getHeight=function(){var a=[];return null!==this.composer&&a.push(this.composer.getHeight()),null!==this.lyricist&&a.push(this.lyricist.getHeight()),a.reduce(b.max2)}}.call(this),function(){"use strict";var a=Adagio.Drawer.Text,b=Adagio.page.RightText=function(){this.init()};b.cssClass="rightText";var c=b.prototype;c.cssClass=b.cssClass,c.init=function(){this.parent=null,this.text=null,this.drawingContext=null,this.posY=null,this.fontSize=null,this.fontFamily=null,this.textString=null,this.width=null},c.setFontSize=function(a){this.fontSize=a},c.setPosition=function(a){this.posY=a},c.setWidth=function(a){this.width=a},c.setFontFamily=function(a){this.fontFamily=a},c.setDrawingContext=function(a){this.drawingContext=a},c.setParent=function(a){this.parent=a,this.isRendered()&&this.text.setParent(a)},c.setCssClass=function(a){this.cssClass=a},c.setTextString=function(a){this.textString=a},c.draw=function(){this.renderIfNeeded(),this.text.draw()},c.renderIfNeeded=function(){this.isRendered()||this.render()},c.isRendered=function(){return null!==this.text},c.render=function(){var b={"text-anchor":"end",text:this.textString};null!==this.fontFamily&&(b["font-family"]=this.fontFamily);var c=new a(b);c.setDrawingContext(this.drawingContext),c.setFontSize(this.fontSize),c.render(),c.setCssClass(this.cssClass),null!==this.parent&&c.setParent(this.parent);var d=this.posY+this.fontSize;c.setPosition(this.width,d),this.text=c},c.getHeight=function(){return 1.5*this.fontSize}}.call(this),function(){"use strict";var a=Adagio.Drawer.Text,b=Adagio.page.LeftText=function(){this.init()};b.cssClass="leftText";var c=b.prototype;c.cssClass=b.cssClass,c.init=function(){this.parent=null,this.text=null,this.drawingContext=null,this.posY=null,this.fontSize=null,this.fontFamily=null,this.textString=null},c.setDrawingContext=function(a){this.drawingContext=a},c.setCssClass=function(a){this.cssClass=a},c.setFontFamily=function(a){this.fontFamily=a},c.setFontSize=function(a){this.fontSize=a},c.setPosition=function(a){this.posY=a},c.setParent=function(a){this.parent=a,this.isRendered()&&this.text.setParent(a)},c.setTextString=function(a){this.textString=a},c.draw=function(){this.renderIfNeeded(),this.text.draw()},c.renderIfNeeded=function(){this.isRendered()||this.render()},c.isRendered=function(){return null!==this.text},c.render=function(){var b={text:this.textString};null!==this.fontFamily&&(b["font-family"]=this.fontFamily);var c=new a(b);c.setFontSize(this.fontSize),c.setDrawingContext(this.drawingContext),c.render(),c.setCssClass(this.cssClass),null!==this.parent&&c.setParent(this.parent);var d=this.posY+this.fontSize;c.setPosition(0,d),this.text=c},c.getHeight=function(){return 1.5*this.fontSize}}.call(this),function(){"use strict";var a=Adagio.Drawer.Text,b=Adagio.Utils.math,c=Adagio.page.PageNumber=function(){this.init()};c.cssClass="pageNumber";var d=c.prototype;d.cssClass=c.cssClass,d.init=function(){this.parent=null,this.text=null,this.drawingContext=null,this.fontSize=null,this.width=null,this.number=null},d.setDrawingContext=function(a){this.drawingContext=a},d.setWidth=function(a){this.width=a},d.setFontSize=function(a){this.fontSize=a},d.setParent=function(a){this.parent=a,this.isRendered()&&this.text.setParent(a)},d.setNumber=function(a){this.number=a},d.draw=function(){this.renderIfNeeded(),this.text.draw()},d.renderIfNeeded=function(){this.isRendered()||this.render()},d.isRendered=function(){return null!==this.text},d.render=function(){var c,d;b.isEven(this.number)?(c="start",d=0):(c="end",d=this.width);var e=this.number.toString(),f=this.drawingContext.getPageNumberFontFamily(),g={"text-anchor":c,"font-family":f,text:e},h=new a(g);h.setDrawingContext(this.drawingContext),h.setFontSize(this.fontSize),h.render(),null!==this.parent&&h.setParent(this.parent),h.setCssClass(this.cssClass);var i=this.fontSize;h.setPosition(d,i),this.text=h},d.getHeight=function(){return 1.5*this.fontSize}}.call(this),function(){"use strict";var a=Adagio.Brush.Elem,b=Adagio.Utils.math,c=Adagio.page.TopSideLogo=function(a){this.init(a)};c.cssClass="pageNumber";var d=c.prototype;d.cssClass=c.cssClass,d.init=function(a){this.parent=null,this.group=null,this.logoFont=a,this.drawingContext=null,this.width=null,this.pageNumber=null,this.glyph=null},d.setDrawingContext=function(a){this.drawingContext=a},d.setWidth=function(a){this.width=a},d.setParent=function(a){this.parent=a},d.setNumber=function(a){this.pageNumber=a},d.draw=function(){this.renderIfNeeded()},d.renderIfNeeded=function(){this.isRendered()||this.render()},d.isRendered=function(){return null!==this.group},d.render=function(){var c=this.getGlyph();this.group=new a("g"),this.group.attr("class",this.cssClass),this.path=this.group.append("path"),this.path.attr("d",c.render());var d,e=c.getHeight();d=b.isEven(this.pageNumber)?this.width-c.getWidth():0,this.group.attr("transform","translate("+d+", "+e+")"),this.parent.append(this.group)},d.getHeight=function(){return this.getGlyph().getHeight()},d.getGlyph=function(){return null===this.glyph&&(this.glyph=this.logoFont.getScaledGlyph("small-flat-logo",1)),this.glyph}}.call(this),function(){"use strict";Adagio.settings.PrintValues={TITLE_FONTSIZE:24,SUBTITLE_FONTSIZE:14,RIGHTS_FONTSIZE:9,FOOTER_BRANDING_FONTSIZE:7,PAGENUMBER_FONTSIZE:12,CREATOR_FONTSIZE:10}}.call(this),function(){"use strict";var a=Adagio.page.PageHeader,b=Adagio.page.FirstPageHeader,c=Adagio.page.CenteredText,d=Adagio.page.HeaderCreators,e=Adagio.page.RightText,f=Adagio.page.LeftText,g=Adagio.page.PageNumber,h=Adagio.page.TopSideLogo,i=Adagio.settings.PrintRatios,j=Adagio.settings.PrintValues,k=Adagio.page.PageHeaderProvider=function(a,b,c,d){this.init(a,b,c,d)},l=k.prototype;l.init=function(a,b,c,d){this.scoreData=a,this.drawingContext=b,this.opts=c,this.pageMetrics=d,this.pagesHeaders={}},l.hasPageHeader=function(){return!0},l.getPageHeader=function(a){return void 0===this.pagesHeaders[a]&&this.createPageHeader(a),this.pagesHeaders[a]},l.createPageHeader=function(b){var c=new a;if(0===b&&this.hasHeader()){var d=this.getFirstPageHeader(b);c.setFirstPage(d)}if(this.hasLogo()){var e=this.getLogo(b);c.setLogo(e)}var f=this.getPageNumber(b);c.setPageNumber(f),this.pagesHeaders[b]=c},l.hasLogo=function(){return void 0!==this.opts.logoFont},l.hasHeader=function(){return!this.opts.noHeader},l.getFirstPageHeader=function(a){var c=new b,d=this.getTitle(a);if(c.setTitle(d),this.hasSubtitle()){var e=this.getSubtitle(a);c.setSubtitle(e)}if(this.hasCreators()){var f=this.getCreators(a);c.setCreators(f)}return c},l.getLogo=function(a){var b=this.getPageNumberValue(a),c=new h(this.opts.logoFont),d=this.getWidth(a);return c.setWidth(d),c.setDrawingContext(this.drawingContext),c.setNumber(b),c},l.getTitle=function(a){var b=this.getWidth(a),d=new c,e=this.pointsToPixels(j.TITLE_FONTSIZE),f=this.drawingContext.getTitleFontFamily();d.setFontFamily(f),d.setFontSize(e),d.setCssClass("title"),d.setWidth(b),d.setDrawingContext(this.drawingContext);var g;return g=this.scoreData.hasTitle()?this.scoreData.getTitle():"No title provided",d.setTextString(g),d},l.hasSubtitle=function(){return this.scoreData.hasSubtitle()},l.getSubtitle=function(a){var b=this.getWidth(a),d=new c,e=this.pointsToPixels(j.SUBTITLE_FONTSIZE),f=this.drawingContext.getSubtitleFontFamily();d.setFontFamily(f),d.setFontSize(e),d.setCssClass("subtitle"),d.setWidth(b),d.setDrawingContext(this.drawingContext);var g=this.scoreData.getSubtitle();return d.setTextString(g),d},l.hasCreators=function(){return this.scoreData.hasComposer()||this.scoreData.hasLyricist()},l.getCreators=function(a){var b=new d;if(this.scoreData.hasComposer()){var c=this.createComposer(a);b.setComposer(c)}if(this.scoreData.hasLyricist()){var e=this.createLyricist();b.setLyricist(e)}return b},l.createComposer=function(a){var b=new e,c=this.getWidth(a);b.setWidth(c);var d=this.pointsToPixels(j.CREATOR_FONTSIZE),f=this.drawingContext.getComposerFontFamily();b.setFontFamily(f),b.setFontSize(d),b.setCssClass("composer"),b.setDrawingContext(this.drawingContext);var g=this.scoreData.getComposerStr();return b.setTextString(g),b},l.createLyricist=function(){var a=new f,b=this.pointsToPixels(j.CREATOR_FONTSIZE),c=this.drawingContext.getLyricistFontFamily();a.setFontFamily(c),a.setFontSize(b),a.setCssClass("lyricist"),a.setDrawingContext(this.drawingContext);var d=this.scoreData.getLyricistStr();return a.setTextString(d),a},l.getPageNumber=function(a){var b=this.getPageNumberValue(a),c=new g,d=this.getWidth(a);c.setWidth(d);var e=this.pointsToPixels(j.PAGENUMBER_FONTSIZE);return c.setFontSize(e),c.setDrawingContext(this.drawingContext),c.setNumber(b),c},l.getWidth=function(a){return this.pageMetrics.getAvailableWidth(a)},l.getPageNumberValue=function(a){return this.opts.hasCover?a+2:a+1},l.pointsToPixels=function(a){var b=i.pointsToMms(a);return this.scoreData.scaleToTenths(b)/10*this.drawingContext.getSpaceSize()}}.call(this),function(){"use strict";var a=Adagio.Brush.Elem,b=Adagio.Utils.math,c=Adagio.page.PageFooter=function(){this.init()};c.cssClass="pageFooter";var d=c.prototype;d.cssClass=c.cssClass,d.init=function(){this.parent=null,this.group=null,this.rights=null,this.logo=null,this.brandingText=null,this.posY=null},d.setParent=function(a){this.parent=a},d.setRights=function(a){this.isRendered()&&a.setParent(this.group),this.rights=a},d.setLogo=function(a){this.isRendered()&&a.setParent(this.group),this.logo=a},d.setBrandingText=function(a){this.isRendered()&&a.setParent(this.group),this.brandingText=a},d.setPosition=function(a){this.posY=a},d.format=function(){var a=0;null!==this.rights&&(this.rights.setPosition(a),a+=this.rights.getHeight()),null!==this.brandingText&&(this.brandingText.setPosition(a),a+=this.brandingText.getHeight()),null!==this.logo&&this.logo.setPosition(a)},d.draw=function(){this.isRendered()||this.render(),this.drawContent(),this.move(),this.bindToParent()},d.isRendered=function(){return null!==this.group},d.render=function(){this.group=new a("g"),this.group.attr("class",this.cssClass),null!==this.rights&&this.rights.setParent(this.group),null!==this.brandingText&&this.brandingText.setParent(this.group),null!==this.logo&&this.logo.setParent(this.group)},d.drawContent=function(){null!==this.rights&&this.rights.draw(),null!==this.brandingText&&this.brandingText.draw(),null!==this.logo&&this.logo.draw()},d.move=function(){this.group.attr("transform","translate(0, "+this.posY+")")},d.bindToParent=function(){this.parent.append(this.group)},d.getHeight=function(){var a=[];return null!==this.rights&&a.push(this.rights.getHeight()),null!==this.brandingText&&a.push(this.brandingText.getHeight()),null!==this.logo&&a.push(this.logo.getHeight()),a.reduce(b.add,0)}}.call(this),function(){"use strict";var a=Adagio.Brush.Elem,b="coda",c=Adagio.page.PageLogo=function(){this.init()};c.cssClass="logo";var d=c.prototype;d.cssClass=c.cssClass,d.init=function(){this.parent=null,this.path=null,this.drawingContext=null,this.posY=null,this.glyph=null,this.width=null},d.setWidth=function(a){this.width=a},d.setPosition=function(a){this.posY=a},d.setDrawingContext=function(a){this.drawingContext=a},d.setParent=function(a){this.parent=a},d.draw=function(){this.renderIfNeeded(),this.move(),this.bindToParent()},d.renderIfNeeded=function(){this.isRendered()||this.render()},d.isRendered=function(){return null!==this.path},d.render=function(){
var b=this.getGlyph(),c=b.render(),d=new a("path");d.attr("class",this.cssClass),d.attr("d",c),this.path=d},d.move=function(){var a=this.glyph.getWidth(),b=this.glyph.getBBoxNE().y,c=this.width/2-a/2,d=this.posY-b;this.path.attr("transform","translate("+c+", "+d+")")},d.bindToParent=function(){this.parent.append(this.path)},d.getHeight=function(){return this.getGlyph().getHeight()},d.getGlyph=function(){return null===this.glyph&&(this.glyph=this.drawingContext.getGlyph(b)),this.glyph}}.call(this),function(){"use strict";var a=Adagio.page.PageFooter,b=Adagio.page.CenteredText,c=Adagio.page.PageLogo,d=Adagio.settings.PrintRatios,e=Adagio.settings.PrintValues,f=Adagio.page.PageFooterProvider=function(a,b,c,d){this.init(a,b,c,d)},g=f.prototype;g.init=function(a,b,c,d){this.scoreData=a,this.drawingContext=b,this.opts=c,this.pageMetrics=d},g.hasPageFooter=function(){return this.hasRights()||this.hasLogo()||this.hasBranding()},g.getPageFooter=function(b){var c=new a;if(this.hasRights()&&this.hasFooter()){var d=this.createRights(b);c.setRights(d)}if(this.hasLogo()){var e=this.createLogo(b);c.setLogo(e)}if(this.hasBranding()){var f=this.createBrandingText(b);c.setBrandingText(f)}return c},g.hasRights=function(){return this.scoreData.hasRights()},g.hasFooter=function(){return!this.opts.noFooter},g.hasBranding=function(){return void 0!==this.opts.footerBrandingText},g.createRights=function(a){var c=this.getWidth(a),d=new b,f=this.pointsToPixels(e.RIGHTS_FONTSIZE),g=this.drawingContext.getCopyrightsFontFamily();d.setFontFamily(g),d.setFontSize(f),d.setCssClass("rights"),d.setWidth(c),d.setDrawingContext(this.drawingContext);var h=this.scoreData.getRightsStr();return d.setTextString(h),d},g.createBrandingText=function(a){var c=this.getWidth(a),d=new b,f=this.pointsToPixels(e.FOOTER_BRANDING_FONTSIZE),g=this.drawingContext.getCopyrightsFontFamily();d.setFontFamily(g),d.setFontSize(f),d.setCssClass("rights"),d.setWidth(c),d.setDrawingContext(this.drawingContext);var h=this.opts.footerBrandingText;return d.setTextString(h),d},g.hasLogo=function(){return this.opts.hasLogo},g.createLogo=function(a){var b=new c,d=this.getWidth(a);return b.setWidth(d),b.setDrawingContext(this.drawingContext),b},g.pointsToPixels=function(a){var b=d.pointsToMms(a);return this.scoreData.scaleToTenths(b)/10*this.drawingContext.getSpaceSize()},g.getWidth=function(a){return this.pageMetrics.getAvailableWidth(a)}}.call(this),function(){"use strict";var a=Adagio.Drawer.formatter.MeasuresHorizontalFormatter,b=Adagio.page.MeasureColumn=function(){this.init()},c=b.prototype;c.init=function(){this.measuresSlice=null,this.scoreDataCache=null,this.measureRenderer=null,this.systems=null,this.horizontalFormatting=null,this.measurePosition=null,this.drawingContext=null,this.displayIdx=null,this.dataIdx=null,this.measureNumberShift=null,this.measureNumberingPolicy=null},c.setDrawingContext=function(a){this.drawingContext=a},c.setScoreDataCache=function(a){this.scoreDataCache=a},c.setMeasureRenderer=function(a){this.measureRenderer=a},c.setMeasureNumberingPolicy=function(a){this.measureNumberingPolicy=a},c.setSystems=function(a){this.systems=a},c.setDisplayedIdx=function(a){this.displayIdx=a},c.setDataIdx=function(a){this.dataIdx=a},c.setMeasuresSlice=function(a){this.measuresSlice=a},c.setMeasurePosition=function(a){this.measurePosition=a,this.updateMeasureNumber()},c.replaceMeasure=function(a,b){this.horizontalFormatting=null,this.initSystemsIfNeeded(),this.systems[b]=a,this.hasMeasuresSlice()&&this.measuresSlice.replaceMeasure(this,a,b)},c.getWidth=function(){return this.getWidthForPosition(this.measurePosition)},c.getWidthForPosition=function(a){return this.updateWidthComputation(a),this.getFormatting().getWidth()},c.refreshWidthComputation=function(){this.updateWidthComputation(this.measurePosition)},c.updateWidthComputation=function(a){var b=this.getFormatting();if(!b.hasMeasurePos()||b.getMeasurePos()!==a){b.setMeasurePosition(a);var c=this.drawingContext.getMeasureWidth();b.setWidth(c)}},c.getFormatting=function(){return null===this.horizontalFormatting&&this.refreshFormatting(),this.horizontalFormatting},c.refreshFormatting=function(){var b=this.getFlatMeasures(),c=b.map(d),e=this.drawingContext.getNotesFormatter(),f=new a(this.drawingContext,c,e);f.format(),this.horizontalFormatting=f.getFormatting()};var d=function(a){return a.getHorizontalData()};c.purgeCrossMeasures=function(){this.getFlatMeasures().forEach(e)};var e=function(a){a.purgeCrossMeasures()};c.getSystemsMeasure=function(){return this.initSystemsIfNeeded(),this.systems},c.getFlatMeasures=function(){return this.initSystemsIfNeeded(),Array.prototype.concat.apply([],this.systems)},c.getNbSystems=function(){return this.initSystemsIfNeeded(),this.systems.length},c.getSystemMeasure=function(a){return this.initSystemsIfNeeded(),this.systems[a]},c.getDisplayIdx=function(){return this.displayIdx},c.getDataIdx=function(){return this.dataIdx},c.getMeasuresSliceIdx=function(){return this.measuresSlice.getIdx()},c.hasMeasuresSlice=function(){return null!==this.measuresSlice},c.getMeasuresSlice=function(){return this.measuresSlice},c.updateDisplayIdx=function(a){this.displayIdx=a,this.updateMeasureNumber()},c.updateMeasureNumber=function(){this.canUpdateMeasureNumber()&&(this.shouldDisplayMeasureNumber()?this.showMeasureNumber():this.hideMeasureNumber())},c.shouldDisplayMeasureNumber=function(){return this.measureNumberingPolicy.shouldDisplay(this.measurePosition)},c.canUpdateMeasureNumber=function(){return null!==this.systems&&null!==this.displayIdx&&null!==this.measurePosition},c.showMeasureNumber=function(){this.systems.forEach(f,this.displayIdx)};var f=function(a){var b=this.valueOf();a[0].updateMeasureNumber(b)};c.hideMeasureNumber=function(){this.systems.forEach(g,this.displayIdx)};var g=function(a){var b=this.valueOf();a[0].removeMeasureNumber(b)};c.initSystemsIfNeeded=function(){null===this.systems&&(this.systems=this.createSystemsMeasure(),this.getMeasureNumberShift(),this.updateDisplayIdx(this.displayIdx),this.scoreDataCache=null,this.measureRenderer=null)},c.createSystemsMeasure=function(){for(var a=this.scoreDataCache.getNbParts(),b=[],c=0;c<a;c++){var d=this.createSystemMeasure(c);b.push(d)}return b},c.createSystemMeasure=function(a){var b=this.dataIdx,c=this.scoreDataCache.getMeasureDisplayData(a,b),d=this.measureRenderer.renderMeasure(c);return d.forEach(this.dispatchDrawingContext,this),d},c.dispatchDrawingContext=function(a){a.render(this.drawingContext)},c.getMeasureNumberShift=function(){if(null===this.measureNumberShift){var a=this.scoreDataCache.getCommonContent();this.measureNumberShift=a.hasMultiMeasuresRest(this.dataIdx)?a.getNbMultiMeasuresRest(this.dataIdx):1}return this.measureNumberShift},c.hasSystemBreakBefore=function(){return this.getTopMeasure().hasSystemBreakBefore()},c.hasSystemBreakAfter=function(){return this.getTopMeasure().hasSystemBreakAfter()},c.getTopMeasure=function(){return this.getTopSystem()[0]},c.getTopSystem=function(){return this.initSystemsIfNeeded(),this.systems[0]}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.page.MeasureColumn,c=Adagio.page.MeasureColumnProvider=function(a,b,c,d,e){this.init(a,b,c,d,e)},d=c.prototype;d.init=function(a,b,c,d,e){this.scoreDataCache=a,this.measureRenderer=b,this.drawingContext=c,this.startMeasureIdx=d,this.measureColumnsContainer=e,this.measuresCache=[],this.displayIdx=d,this.dataIdx=0,this.createMeasures()},d.hasRemaining=function(){if(this.measuresCache.length>0)return!0},d.getMeasure=function(){if(this.measuresCache.length>0)return this.measuresCache.shift();throw new a("Unexpected","There is no more measures to fetch")},d.createMeasures=function(){for(var a=this.getNbMeasures();this.dataIdx<a;){var b=this.createMeasure();this.measuresCache.push(b)}},d.createMeasure=function(){var a=new b;return a.setScoreDataCache(this.scoreDataCache),a.setDrawingContext(this.drawingContext),a.setMeasureRenderer(this.measureRenderer),a.updateDisplayIdx(this.displayIdx),a.setDataIdx(this.dataIdx),this.dataIdx++,this.displayIdx+=a.getMeasureNumberShift(),this.measureColumnsContainer.push(a),a},d.getNbMeasures=function(){return this.scoreDataCache.getNbMeasures()},d.handBackMeasure=function(a){this.measuresCache.unshift(a)},d.handBackMeasures=function(a){Array.prototype.unshift.apply(this.measuresCache,a)},d.discardCache=function(){this.measuresCache=[]}}.call(this),function(){"use strict";var a=Adagio.Utils.partHeaderUtils,b=Adagio.Utils.measureUtils,c=Adagio.Utils.staffDataUtils,d=Adagio.Utils.clefUtils,e=Adagio.Values.ClampType,f=Adagio.Drawer.System,g=Adagio.Drawer.Staff,h=Adagio.page.SystemProvider=function(a,b,c){this.init(a,b,c)},i=h.prototype;i.init=function(a,b,c){this.scoreDataCache=a,this.drawingContext=b,this.pageOpts=c,this.fillDefaults()},i.fillDefaults=function(){void 0===this.pageOpts.displayFirstLinePartsNames&&(this.pageOpts.displayFirstLinePartsNames=!0),void 0===this.pageOpts.displayOtherLinesPartsNames&&(this.pageOpts.displayOtherLinesPartsNames=!0)},i.setDrawingContext=function(a){this.drawingContext=a},i.getAllSystems=function(a){for(var b=[],c=this.getNbSystems(),d=0;d<c;d++){var e=this.getSystem(d,a);b.push(e)}return b},i.getNbSystems=function(){return this.scoreDataCache.getNbParts()},i.getSystem=function(a,b){var h,i=this.getNbStaves(a),j=this.getWrappedStaffDetails(a),k=this.getWrappedClef(a),l=k.dumpAttribute().some(d.isTab)?e.BRACKET:e.BRACE,m=new f;b?this.pageOpts.displayFirstLinePartsNames&&(h=this.getSystemName(a,b),m.setName(h)):this.pageOpts.displayFirstLinePartsNames&&this.pageOpts.displayOtherLinesPartsNames&&(h=this.getSystemName(a,b),m.setName(h)),m.setDrawingContext(this.drawingContext),m.setClampType(l);for(var n=0;n<i;n++){var o,p=j.getEntry(n),q=c.createFromStaffDetails(p);o=c.isTabStaff(q)?this.getVoicesIndexes(a,0):this.getVoicesIndexes(a,n);var r=new g(o);r.setStaffData(q),m.addStaff(r)}return m.setIdx(a),m},i.getVoicesIndexes=function(a,b){return this.scoreDataCache.getPartStaffVoicesIndexes(a,b)},i.getSystemName=function(b,c){var d=this.scoreDataCache.getPartHeader(b);return c?a.getName(d):a.hasAbbreviation(d)?a.getAbbreviation(d):a.inferAbbreviation(d)},i.getNbStaves=function(a){var c=this.getFirstMeasure(a);return b.getNbStaves(c)},i.getWrappedStaffDetails=function(a){var c=this.getFirstMeasure(a);return b.getWrappedStaffDetailsOrDefault(c)},i.getWrappedClef=function(a){var c=this.getFirstMeasure(a);return b.getWrappedClef(c)},i.getFirstMeasure=function(a){return this.scoreDataCache.getMeasure(a,0)}}.call(this),function(){"use strict";var a=Adagio.Values.MeasureLocation,b=Adagio.Utils.math,c=Adagio.Utils.clone,d=Adagio.Error.InternalError,e=Adagio.page.MeasuresSlice=function(){this.init()},f=e.prototype;f.init=function(){this.id=null,this.isFirst=null,this.metrics=null,this.systemProvider=null,this.systemBreakPolicy=null,this.measuresWidth=0,this.measures=[],this.systems=null,this.shards=[]},f.setId=function(a){this.id=a},f.setMetrics=function(a){this.metrics=a},f.setIsFirst=function(a){this.isFirst=a},f.setSystemProvider=function(a){this.systemProvider=a},f.setSystemsSliceProvider=function(a){this.systemsSliceProvider=a},f.setSystemBreakPolicy=function(a){this.systemBreakPolicy=a},f.addShard=function(a){this.shards.push(a)},f.canPushMeasure=function(a){var b=0===this.measures.length;if(b)return!0;if(this.isAtPolicyLimit())return!1;if(a.hasSystemBreakBefore())return!1;if(this.measures[this.measures.length-1].hasSystemBreakAfter())return!1;var c=this.getMeasurePosition(b);return a.getWidthForPosition(c)<this.getAvailableWidth()},f.isAtPolicyLimit=function(){if(this.systemBreakPolicy.hasMaxLimit()){var a=this.systemBreakPolicy.getMaxNbMeasuresPerLine();return this.measures.length===a}return!1},f.pushMeasure=function(a){var b=0===this.measures.length,c=this.getMeasurePosition(b);if(a.setMeasurePosition(c),null!==this.measuresWidth){var d=a.getWidth();this.measuresWidth+=d}var e=this.getNbMeasures();this.measures.push(a),this.insertMeasureToSystems(a,e),a.setMeasuresSlice(this)},f.getMeasurePosition=function(b){return b?this.isFirst?a.FIRST_OF_SCORE:a.FIRST_OF_LINE:a.OTHER},f.unshiftMeasures=function(a){a=a.slice(),a.reverse(),a.forEach(this.unshiftMeasure,this)},f.unshiftMeasure=function(b){this.measuresWidth=null;var c=!0,d=this.getMeasurePosition(c);if(b.setMeasurePosition(d),this.measures.unshift(b),b.setMeasuresSlice(this),this.insertMeasureToSystems(b,0),this.getNbMeasures()>1){this.measures[1].setMeasurePosition(a.OTHER)}},f.insertMeasure=function(b,c){this.measuresWidth=null;var d=0===c,e=this.getMeasurePosition(d);if(b.setMeasurePosition(e),this.measures.splice(c,0,b),b.setMeasuresSlice(this),this.insertMeasureToSystems(b,c),d&&this.measures.length>1){this.measures[1].setMeasurePosition(a.OTHER)}},f.insertMeasureToSystems=function(a,b){this.getSystems().forEach(function(c,d){var e=a.getSystemMeasure(d);c.insertMeasure(e,b)})},f.popMeasure=function(){var a=this.getNbMeasures();if(0===a){throw new d("PopOnEmpty","Cannon pop on an empty MeasuresSlice.")}var b=a-1;this.removeMeasureFromSystems(b);var c=this.measures.pop();if(c.setMeasuresSlice(null),null!==this.measuresWidth){var e=c.getWidth();this.measuresWidth-=e}return c},f.removeMeasure=function(a){if(this.measuresWidth=null,this.removeMeasureFromSystems(a),this.measures.splice(a,1)[0].setMeasuresSlice(null),0===a&&this.measures.length>0){var b=this.measures[0],c=!0,d=this.getMeasurePosition(c);b.setMeasurePosition(d)}},f.removeMeasureFromSystems=function(a){this.getSystems().forEach(function(b){b.removeMeasure(a)})},f.needRecomputeUsedWidth=function(){return null===this.measuresWidth},f.recomputeUsedWidth=function(){var a=this.measures.map(g);this.measuresWidth=a.reduce(b.add,0)};var g=function(a){return a.getWidth()};f.refreshSystemsHeights=function(){this.formatNominalWidth(),this.getSystems().forEach(function(a){a.moveMeasures(),a.reloadAllCrossMeasures(),a.updateCrossMeasuresHorizontalDisplay(),a.autoUpdateVerticalDisplay()})},f.formatNominalWidth=function(){this.measures.forEach(function(a,b){a.refreshWidthComputation();var c=a.getFormatting();this.getSystems().forEach(function(a){a.setMeasureHorizontalFormatting(c,b),a.formatMeasureHorizontal(b)})},this)},f.hasWidthOverflow=function(){var a=this.getWidth(),b=this.getHeadersWidth();return this.measuresWidth+b>=a},f.popOverflowMeasures=function(){for(var a,b=[];this.isOverPolicyLimit()||this.hasWidthOverflow()&&this.measures.length>1;)a=this.popMeasure(),b.unshift(a);for(var c=this.getNbToPop();c>0;)a=this.popMeasure(),b.unshift(a),c--;return b},f.isOverPolicyLimit=function(){if(this.systemBreakPolicy.hasMaxLimit()){var a=this.systemBreakPolicy.getMaxNbMeasuresPerLine();return this.measures.length>a}return!1},f.getNbToPop=function(){for(var a=this.getNbMeasures(),b=0;b<a;b++){var c=this.measures[b];if(b>0&&c.hasSystemBreakBefore())return a-b;if(c.hasSystemBreakAfter())return a-(b+1)}return 0},f.affectMeasureStartIdx=function(){this.getSystems().forEach(this.affectSystemMeasureStartDisplayIdx,this)},f.affectSystemMeasureStartDisplayIdx=function(a){var b=this.getMeasureStartDisplayIdx();a.setMeasureNumberingStart(b)},f.getMeasureStartDisplayIdx=function(){return this.measures[0].getDisplayIdx()},f.replaceMeasure=function(a,b,c){var e=this.measures.indexOf(a),f=this.getSystems(),g=f[c];if(void 0===g){var h=new d("Unexpected","[bughunt-1] system value is undefined in `_measuresSlice.replaceMeasure`.");throw h.systemIdx=c,h.nbSystems=f.length,h}g.replaceMeasure(b,e),this.measuresWidth=null},f.updateId=function(b){if(this.id=b,0===b&&(this.isFirst=!0,!this.isEmpty())){this.measures[0].setMeasurePosition(a.FIRST_OF_SCORE),this.measuresWidth=null}},f.bindMeasures=function(){this.getSystems().forEach(h)};var h=function(a){a.bindMeasures()};f.getSystems=function(){return null===this.systems&&this.createSystems(),this.systems},f.createSystems=function(){this.systems=[];for(var a=this.getNbSystems(),b=0;b<a;b++){var c=this.systemProvider.getSystem(b,this.isFirst);this.systems.push(c)}},f.getNbSystems=function(){return this.measures[0].getNbSystems()},f.getNbMeasures=function(){return this.measures.length},f.getMeasureStartDataIdx=function(){return this.measures[0].getDataIdx()},f.getIdx=function(){return this.id},f.getIdxInSlice=function(a){var b=this.measures.indexOf(a);if(-1===b){throw new d("NotInSlice","The measure is not in this slice")}return b},f.isEmpty=function(){return 0===this.getNbMeasures()},f.getBindedShards=function(){var a=this.getShards();return a=a.filter(i)};var i=function(a){return a.hasPageContent()};f.getShards=function(){return this.shards},f.getShardsIndexes=function(){return this.shards.map(j)};var j=function(a){return a.getIdx()};f.getAvailableWidth=function(){return this.getWidth()-(this.getHeadersWidth()+this.measuresWidth)},f.getWidth=function(){return this.metrics.availableWidth},f.getHeadersWidth=function(){return this.isFirst?this.metrics.firstSliceHeaderWidth:this.metrics.otherSlicesHeaderWidth},f.drawBasicCursor=function(a,b){a=this.shiftLocation(a),this.getSystem(a.partIdx).drawCursor(a,b)},f.drawGraceCursor=function(a,b){a=this.shiftLocation(a),this.getSystem(a.partIdx).drawGraceCursor(a,b)},f.drawTabCursor=function(a,b){a=this.shiftLocation(a),this.getSystem(a.partIdx).drawTabCursor(a,b)},f.drawDynamicCursor=function(a,b){a=this.shiftLocation(a),this.getSystem(a.partIdx).drawDynamicCursor(a,b)},f.drawPizzicatoCursor=function(a,b){a=this.shiftLocation(a),this.getSystem(a.partIdx).drawPizzicatoCursor(a,b)},f.drawHorizontalCursor=function(a,b){a=this.shiftRangeLocation(a),this.normalizeRangeLocation(a),this.getSystem(a.partIdx).drawHorizontalCursor(a,b)},f.drawHorizontalCursorTimePos=function(a,b){a=this.shiftRangeLocation(a),this.normalizeRangeLocation(a),this.getSystem(a.partIdx).drawHorizontalCursorTimePos(a,b)},f.drawHorizontalMeasureWideCursor=function(a,b){a=this.shiftLocation(a),this.normalizeRangeLocation(a),this.getSystem(a.partIdx).drawHorizontalMeasureWideCursor(a,b)},f.drawCrossMeasureNoteCursor=function(a,b){a=this.shiftRangeLocation(a),this.normalizeRangeLocation(a),this.getSystem(a.partIdx).drawCrossMeasureNoteCursor(a,b)},f.shiftLocation=function(a){return a=c(a),a.measureIdx-=this.getMeasureStartDataIdx(),a},f.shiftRangeLocation=function(a){return a=c(a),a.startMeasureIdx-=this.getMeasureStartDataIdx(),a.stopMeasureIdx-=this.getMeasureStartDataIdx(),a},f.normalizeRangeLocation=function(a){var b=this.getNbMeasures();a.startMeasureIdx=Math.max(0,a.startMeasureIdx),a.stopMeasureIdx=Math.min(b-1,a.stopMeasureIdx)},f.getSystem=function(a){var c=this.getSystems(),e=c.length;if(!b.isInteger(a)||a<0||a>=e){throw new d("BadSystemIdx","The system idx ["+a+"] is invalid.")}return c[a]},f.extractHeaders=function(){return this.getSystems().map(k)};var k=function(a){return a.extractHeader()};f.injectSystemsHeaders=function(a){this.getSystems().forEach(function(b,c){var d=a[c];b.injectHeader(d)})},f.getStaffLyricsUpY=function(a,b,c,d){return c-=this.getMeasureStartDataIdx(),this.getSystem(b).getStaffLyricsUpY(a,c,d)},f.getStaffWordsY=function(a,b,c,d){return c-=this.getMeasureStartDataIdx(),this.getSystem(b).getStaffWordsY(a,c,d)},f.getSystemChordsY=function(a,b){return b-=this.getMeasureStartDataIdx(),this.getSystem(a).getChordsY(b)},f.getMeasureWidth=function(a,b){return b-=this.getMeasureStartDataIdx(),this.getSystem(a).getMeasureWidth(b)},f.getNoteXInMeasure=function(a,b,c,d,e){return c-=this.getMeasureStartDataIdx(),this.getSystem(a).getNoteXInMeasure(b,c,d,e)},f.getStaffHeight=function(a){return this.getSystem(a).getHeight()},f.getSpaceAboveStaff=function(a,b){return this.getSystem(a).getSpaceAboveStaff(b)},f.getMeasureNbNotes=function(a,b,c,d){return c-=this.getMeasureStartDataIdx(),this.getSystem(a).getMeasureNbNotes(b,c,d)}}.call(this),function(){"use strict";var a=Adagio.page.MeasuresSlice,b=Adagio.page.MeasuresSliceProvider=function(a,b,c,d,e){this.init(a,b,c,d,e)},c=b.prototype;c.init=function(a,b,c,d,e){this.measureProvider=a,this.systemProvider=b,this.metrics=c,this.measuresSlicesContainer=d,this.systemBreakPolicy=e,this.sliceIdx=0},c.setSliceProvider=function(a){this.sliceProvider=a},c.setMeasureProvider=function(a){this.measureProvider=a},c.setSliceIdx=function(a){this.sliceIdx=a},c.hasRemaining=function(){return this.measureProvider.hasRemaining()},c.getSlice=function(){for(var a=this.createSlice();this.measureProvider.hasRemaining();){var b=this.measureProvider.getMeasure();if(!a.canPushMeasure(b)){this.measureProvider.handBackMeasure(b);break}a.pushMeasure(b)}for(var c=a.getNbMeasures();this.systemBreakPolicy.isCountForbidden(c);){var d=a.popMeasure();this.measureProvider.handBackMeasure(d),c--}return a.refreshSystemsHeights(),a.affectMeasureStartIdx(),a},c.createSlice=function(){var b=new a;b.setId(this.sliceIdx),b.setMetrics(this.metrics);var c=0===this.sliceIdx;return b.setIsFirst(c),b.setSystemProvider(this.systemProvider),b.setSystemBreakPolicy(this.systemBreakPolicy),this.sliceIdx++,this.measuresSlicesContainer.push(b),b}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Brush.Elem,c=Adagio.Drawer.Line,d=Adagio.Drawer.formatter.alignEntityHoriz,e=Adagio.Utils.math,f=Adagio.Drawer.ScoreShard=function(){this.init()};f.NAME="scoreShard";var g=f.prototype;g.name=f.NAME,g.init=function(){this.drawingContext=null,this.posY=null,this.contentX=null,this.height=null,this.headerWidth=null,this.pageContent=null,this.systems=[],this.line=null,this.parent=null,this.drawn=!1,this.contentGroup=null,this.group=null,this.idx=null,this.isFirst=null,this.metrics=null,this.breakBefore=!1,this.breakAfter=!1},g.setDrawingContext=function(a){this.drawingContext=a,this.systems.forEach(this.dispatchDrawingContext,this)},g.setParent=function(a){this.parent=a},g.setPosition=function(a){this.posY=a},g.setContentX=function(a){this.contentX=a},g.setIdx=function(a){this.idx=a},g.setMetrics=function(a){this.metrics=a},g.setIsFirst=function(a){this.isFirst=a},g.setPageContent=function(a){this.pageContent=a},g.addSystem=function(a){this.systems.push(a),this.isRendered()&&this.dispatchGroup(a),this.hasDrawingContext()&&this.dispatchDrawingContext(a)},g.dispatchDrawingContext=function(a){a.setDrawingContext(this.drawingContext)},g.addSystemsMeasure=function(a){a.forEach(this.addSystemMeasure,this)},g.addSystemMeasure=function(a,b){this.getSystem(b).addMeasure(a)},g.setBreakBefore=function(a){this.breakBefore=a},g.setBreakAfter=function(a){this.breakAfter=a},g.canFit=function(a){if(0===this.systems.length)return!0;var b=this.getTargetHeight()-this.getHeight(),c=this.drawingContext.getSpaceBetweenSystems();return a.getHeight()+c<b},g.getTargetHeight=function(){return this.isFirst?this.metrics.firstShardAvailableHeight:this.metrics.otherShardsAvailableHeight},g.pushSystem=function(a){if(this.isRendered()&&a.setParent(this.group),null!==this.height){if(this.systems.length>0){var b=this.drawingContext.getSpaceBetweenSystems();this.height+=b}var c=a.getHeight();this.height+=c}this.systems.push(a)},g.insertMeasure=function(a,b){a.forEach(function(a,c){this.getSystem(c).insertMeasure(a,b)},this)},g.removeMeasure=function(a){this.systems.forEach(function(b){b.removeMeasure(a)})},g.replaceSystemMeasure=function(a,b,c){this.getSystem(a).replaceMeasure(c,b)},g.dispatchInsertionPoint=function(a){this.systems.forEach(function(b){b.dispatchInsertionPoint(a)})},g.draw=function(){this.renderIfNeeded(),this.drawContent(),this.move(),this.bindToParent()},g.renderIfNeeded=function(){this.isRendered()||this.render()},g.isRendered=function(){return null!==this.group},g.render=function(){this.group=new b("g"),this.group.attr("class",this.name),this.contentGroup=new b("g"),this.contentGroup.attr("class",this.name+"-content"),this.group.append(this.contentGroup),this.systems.forEach(this.dispatchGroup,this),this.createLine()},g.dispatchGroup=function(a){a.setHeaderParent(this.group),a.setContentParent(this.contentGroup)},g.createLine=function(){var a=this.getFirstLineWidth(),b={stroke_width:a};this.line=new c(this.contentGroup,b);var d=this.getSpaceAboveFirstStaff(),e=this.getHeight(),f=this.getSpaceBelowLastStaff(),g=e-f,h=0;this.line.render(h,d,h,g)},g.drawContent=function(){this.systems.forEach(function(a){a.draw()}),this.line.draw()},g.move=function(){this.isRendered()&&null!==this.posY&&this.group.attr("transform","translate(0, "+this.posY+")"),this.moveContent()},g.moveContent=function(){this.isRendered()&&this.contentGroup.attr("transform","translate("+this.contentX+", 0)")},g.bindToParent=function(){this.drawn||(this.parent.append(this.group),this.drawn=!0)},g.unbindFromParent=function(){this.drawn&&(this.getGroup().removeFromParent(),this.drawn=!1)},g.getMeasuresHorizontalData=function(a){var b=this.systems.map(function(b){return b.getMeasuresHorizontalData(a)});return Array.prototype.concat.apply([],b)},g.getHorizontalFormatting=function(a){for(var b=this.systems.length,c=0;c<b;c++){var d=this.getSystem(c),e=d.getHorizontalFormatting(a);if(null!==e)return e}return null},g.setMeasureHorizontalFormatting=function(a,b){this.systems.forEach(function(c){c.setMeasureHorizontalFormatting(a,b)})},g.formatMeasureHorizontal=function(a){this.systems.forEach(function(b){b.formatMeasureHorizontal(a)})},g.drawBasicCursor=function(a,b){this.getSystem(a.partIdx).drawCursor(a,b)},g.drawGraceCursor=function(a,b){this.getSystem(a.partIdx).drawGraceCursor(a,b)},g.drawTabCursor=function(a,b){this.getSystem(a.partIdx).drawTabCursor(a,b)},g.drawDynamicCursor=function(a,b){this.getSystem(a.partIdx).drawDynamicCursor(a,b)},g.drawPizzicatoCursor=function(a,b){this.getSystem(a.partIdx).drawPizzicatoCursor(a,b)},g.drawHorizontalCursor=function(a,b){this.getSystem(a.partIdx).drawHorizontalCursor(a,b)},g.drawHorizontalCursorTimePos=function(a,b){this.getSystem(a.partIdx).drawHorizontalCursorTimePos(a,b)},g.drawHorizontalMeasureWideCursor=function(a,b){this.getSystem(a.partIdx).drawHorizontalMeasureWideCursor(a,b)},g.drawCrossMeasureNoteCursor=function(a,b){this.getSystem(a.partIdx).drawCrossMeasureNoteCursor(a,b)},g.updateMeasureNumbers=function(a){this.systems.forEach(function(b){b.updateMeasureNumbers(a)})},g.updateMeasureNumber=function(a){this.systems.forEach(function(b){b.updateMeasureNumber(a)})},g.setMeasureNumberingStart=function(a){this.systems.forEach(function(b){b.setMeasureNumberingStart(a)})},g.initialDisplayUpdate=function(){this.autoUpdateHorizontalDisplay(),this.updateStaffLines(),this.reloadAllCrossMeasures(),this.updateCrossMeasuresHorizontalDisplay(),this.autoUpdateVerticalDisplay(),this.moveHeaders(),this.updateMeasureNumbers()},g.autoUpdateHorizontalDisplay=function(){for(var a=this.getNbMeasures(),b=0;b<a;b++)this.updateMeasureHorzontalDisplay(b);this.moveMeasures()},g.updateMeasureHorzontalDisplay=function(a){this.autoAlignMeasureHorizontal(a),this.formatMeasureHorizontal(a),this.updateHorizontalDisplay(a)},g.autoAlignMeasureHorizontal=function(a){d(this,a)},g.updateHorizontalDisplay=function(a){this.systems.forEach(function(b){b.updateHorizontalDisplay(a)})},g.moveMeasures=function(a){this.systems.forEach(function(b){b.moveMeasures(a)})},g.autoUpdateVerticalDisplay=function(){this.height=null,this.systems.forEach(function(a){a.autoUpdateVerticalDisplay()}),this.moveSystems()},g.updateSystemVerticalDisplay=function(a){this.height=null,this.getSystem(a).autoUpdateVerticalDisplay()},g.updateStaffVerticalDisplay=function(a,b){this.height=null,this.getSystem(a).updateStaffVerticalDisplay(b)},g.moveSystems=function(a){a=a||0;var b=this.getPositionAfter(a-1);this.systems.slice(a).reduce(h,b)},g.getPositionAfter=function(b){if(-1===b)return 0;if(b>=0){var c=this.getSystem(b);return c.getPosY()+c.getHeight()+this.drawingContext.getSpaceBetweenSystems()}throw new a("InvaldStaffIdx","The systemIdx ["+b+"] is invalid.")};var h=function(a,b){return b.setContentY(a),b.move(),a+b.getHeight()+b.getDrawingContext().getSpaceBetweenSystems()};g.updateSystemHeader=function(a){this.getSystem(a).updateHeader(),this.headerWidth=null},g.moveHeaders=function(){var a=this.getHeaderWidth();this.systems.forEach(function(b){var c=b.getHeaderWidth(),d=a-c;b.moveHeader(d)}),this.setContentX(a),this.moveContent()},g.updateStaffLines=function(){this.systems.forEach(function(a){a.updateStaffLines()})},g.reloadAllCrossMeasures=function(){this.systems.forEach(function(a){a.reloadAllCrossMeasures()})},g.reloadSystemCrossMeasures=function(a){this.getSystem(a).reloadAllCrossMeasures()},g.reloadStaffCrossMeasures=function(a,b){this.getSystem(a).reloadStaffCrossMeasures(b)},g.updateCrossMeasuresHorizontalDisplay=function(){this.systems.forEach(function(a){a.updateCrossMeasuresHorizontalDisplay()})},g.updateVerticalLine=function(){var a=this.getSpaceAboveFirstStaff();this.line.setY1(a);var b=this.getHeight(),c=this.getSpaceBelowLastStaff(),d=b-c;this.line.setY2(d)},g.getFirstLineWidth=function(){return this.drawingContext.getThinBarlineThickness()},g.getDrawingContext=function(){return this.drawingContext},g.getStaffLyricsUpY=function(a,b,c,d){return this.getSystem(b).getStaffLyricsUpY(a,c,d)},g.getStaffWordsY=function(a,b,c,d){return this.getSystem(b).getStaffWordsY(a,c,d)},g.getSystemChordsY=function(a,b){return this.getSystem(a).getChordsY(b)},g.getMeasureWidth=function(a,b){return this.getSystem(a).getMeasureWidth(b)},g.getNoteXInMeasure=function(a,b,c,d,e){return this.getSystem(a).getNoteXInMeasure(b,c,d,e)},g.getMeasureNbNotes=function(a,b,c,d){return this.getSystem(a).getMeasureNbNotes(b,c,d)},g.getSystemHeight=function(a){return this.getSystem(a).getHeight()},g.getSpaceAboveStaff=function(a,b){return this.getSystem(a).getSpaceAboveStaff(b)},g.resetGeometries=function(){this.systems.forEach(i)};var i=function(a){a.resetGeometries()};g.getAllMeasuresGeometries=function(){for(var a=this.getNbMeasures(),b=[],c=0;c<a;c++){var d=this.getMeasureGeometry(c);b.push(d)}return Array.prototype.concat.apply([],b)},g.getMeasureGeometry=function(a){var b=[];return this.systems.forEach(function(c){var d=c.getMeasureGeometry(a);b.push(d)}),Array.prototype.concat.apply([],b)},g.getSystemMeasureGeometry=function(a,b){return this.getSystem(a).getMeasureGeometry(b)},g.getSpaceAboveFirstStaff=function(){return this.systems[0].getSpaceAboveFirstStaff()},g.getSpaceBelowLastStaff=function(){var a=this.systems.length-1;return this.systems[a].getSpaceBelowLastStaff()},g.getBBox=function(){var a=this.getHeight();return{width:this.getWidth(),height:a}},g.getHeight=function(){return null===this.height&&this.calcHeight(),this.height},g.calcHeight=function(){this.height=this.systems.reduce(j,0)};var j=function(a,b,c){(a+=b.getHeight(),c>0)&&(a+=b.getDrawingContext().getSpaceBetweenSystems());return a};g.getWidth=function(){return this.getContentWidth()+this.getHeaderWidth()},g.getContentWidth=function(){return this.getAnySystem().getContentWidth()},g.getHeaderWidth=function(){return null===this.headerWidth&&this.calcHeaderWidth(),this.headerWidth},g.calcHeaderWidth=function(){var a=this.systems.map(k);this.headerWidth=a.reduce(e.max2)};var k=function(a){return a.getHeaderWidth()};g.hasDrawingContext=function(){return null!==this.drawingContext},g.getSystemHeight=function(a){return this.getSystem(a).getHeight()},g.getSystems=function(){return this.systems},g.getNbMeasures=function(){return this.getAnySystem().getNbMeasures()},g.getAnySystem=function(){return this.getSystem(0)},g.getSystem=function(a){return this.checkSystemIdx(a),this.systems[a]},g.checkSystemIdx=function(b){if("number"!=typeof b||b<0||b>=this.systems.length){throw new a("BadSystemIdx","Invalid systemIdx: ["+b+"].")}},g.getNbSystems=function(){return this.systems.length},g.getMeasurePosition=function(a){return this.getHorizontalFormatting(a).getMeasurePos()},g.getStructure=function(){var a=this.getNbMeasures(),b=this.getStartMeasureIdx(),c=this.getSystemsStructures();return{idx:this.idx,startMeasureIdx:b,nbMeasures:a,systems:c}},g.getStartMeasureIdx=function(){
return this.getAnySystem().getStartMeasureIdx()},g.getSystemsStructures=function(){return this.systems.map(l)};var l=function(a){return a.getStructure()};g.getGroup=function(){return this.group},g.getIdx=function(){return this.idx},g.isEmpty=function(){return 0===this.getNbMeasures()},g.hasPageContent=function(){return null!==this.pageContent},g.getPageContent=function(){return this.pageContent},g.getPageIdx=function(){return this.pageContent.getIdx()},g.shouldBreakBefore=function(){return this.breakBefore},g.shouldBreakAfter=function(){return this.breakAfter},g.drawVerticalDebug=function(){this.systems.forEach(function(a){a.drawVerticalDebug()})}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.math,c=Adagio.Drawer.formatter.MeasuresHorizontalFormatter;Adagio.page.formatter.formatHorizBasic=function(a,c,i){var j=a.getHeaderWidth(),k=e(a),l=k.map(f),m=l.reduce(b.add),n=j+m,o=c-n;if(o<0&&(k=d(a),l=k.map(f),m=l.reduce(b.add),n=j+m,o=c-n),o>0){var p=a.getNbMeasures(),q=h(c,p,m,j,i);k.forEach(g,q)}k.forEach(function(b,c){a.setMeasureHorizontalFormatting(b,c),a.formatMeasureHorizontal(c),a.updateHorizontalDisplay(c)}),a.updateStaffLines(),a.moveMeasures(),a.updateCrossMeasuresHorizontalDisplay()};var d=function(a){return e(a,!0)},e=function(a,b){for(var d=a.getNbMeasures(),e=[],f=a.getDrawingContext(),g=0;g<d;g++){var h=a.getMeasurePosition(g),i=a.getMeasuresHorizontalData(g),j=f.getNotesFormatter(),k=new c(f,i,j,b);k.format();var l=f.getMeasureWidth(),m=k.getFormatting();m.setMeasurePosition(h),m.setWidth(l),e.push(m)}return e},f=function(a){return a.getWidth()},g=function(a){var b=this.valueOf(),c=a.getWidth(),d=c+b;a.setWidth(d)},h=function(a,b,c,d,e){return((a=i(a,c,e,b))-(c+d))/b},i=function(b,c,d,e){if(!d)return b;if(e>=3)return b;var f;if(2===e)return f=b/4*3,c<f?f:b;if(1===e)return f=b/4*1.8,c<f?f:(f=b/4*3,c<f?f:b);throw new a("Unexpected")}}.call(this),function(){"use strict";var a=Adagio.Drawer.ScoreShard,b=Adagio.page.formatter.formatHorizBasic,c=Adagio.page.ShardProvider=function(a,b,c,d){this.init(a,b,c,d)},d=c.prototype;d.init=function(a,b,c,d){this.measuresSliceProvider=a,this.drawingContext=b,this.metrics=c,this.shardsContainer=d,this.shardIdx=0,this.cachedShards=[]},d.setShardIdx=function(a){this.shardIdx=a},d.hasRemaining=function(){return this.cachedShards.length>0||this.measuresSliceProvider.hasRemaining()},d.getShard=function(){0===this.cachedShards.length&&this.loadNextSliceShards();var a=this.cachedShards.shift();a.moveHeaders(),a.moveSystems();var c=this.metrics.availableWidth,d=!this.measuresSliceProvider.hasRemaining();return b(a,c,d),a},d.loadNextSliceShards=function(){var a=this.measuresSliceProvider.getSlice(),b=a.getSystems();this.currentShard=null,b.forEach(this.addSystemToShard,this),this.cachedShards.length>1&&this.addBreaks(),this.cachedShards.forEach(f,a)},d.addSystemToShard=function(a){null===this.currentShard&&this.createShard(),this.currentShard.canFit(a)||this.createShard(),this.currentShard.pushSystem(a)},d.createShard=function(){this.currentShard=new a,this.currentShard.setDrawingContext(this.drawingContext),this.currentShard.setMetrics(this.metrics),this.currentShard.height=0;var b=0===this.shardIdx;this.currentShard.setIsFirst(b),this.currentShard.setIdx(this.shardIdx),this.cachedShards.push(this.currentShard),this.shardsContainer.push(this.currentShard),this.shardIdx++},d.addBreaks=function(){this.cachedShards.forEach(e)};var e=function(a){a.setBreakBefore(!0),a.setBreakAfter(!0)},f=function(a){this.addShard(a)};d.handBackShard=function(a){this.cachedShards.unshift(a)},d.clearCache=function(){this.cachedShards=[]}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.math,c=Adagio.Brush.Elem,d=Adagio.page.PageContent=function(){this.init()};d.NAME="pageContent";var e=d.prototype;e.name=d.NAME,e.init=function(){this.drawingContext=null,this.metrics=null,this.idx=null,this.posY=null,this.isLast=null,this.isFirst=null,this.shardsHeight=0,this.shards=[],this.group=null,this.parent=null},e.setDrawingContext=function(a){this.drawingContext=a},e.setMetrics=function(a){this.metrics=a},e.setIsLast=function(a){this.isLast=a},e.setIsFirst=function(a){this.isFirst=a},e.setIdx=function(a){this.idx=a},e.setParent=function(a){this.parent=a},e.setPosition=function(a){this.posY=a},e.canPushShard=function(a){if(0===this.shards.length)return!0;if(a.shouldBreakBefore())return!1;if(this.getLastShard().shouldBreakAfter())return!1;var b=this.getAvailableHeightForPush();return a.getHeight()<b},e.getAvailableHeightForPush=function(){var a=this.drawingContext.getSpaceBetweenShards();return this.getHeight()-(this.shardsHeight+a)},e.pushShard=function(a){var b=0===this.shards.length,c=a.getHeight();if(this.shardsHeight+=c,this.shards.push(a),!b){var d=this.drawingContext.getSpaceBetweenShards();this.shardsHeight+=d}a.setPageContent(this),this.isRendered()&&(a.setParent(this.group),a.isRendered()||a.draw())},e.recomputeShardsHeight=function(){if(this.isEmpty())return void(this.shardsHeight=0);var a=this.drawingContext.getSpaceBetweenShards(),c=(this.shards.length-1)*a,d=this.shards.map(f),e=d.reduce(b.add);this.shardsHeight=e+c};var f=function(a){return a.getHeight()};e.updateVerticalDisplay=function(){if(!this.isEmpty()){var a=0,b=this.getSpaceBetweenShards();this.shards.forEach(function(c){c.setPosition(a),c.move(),a+=b,a+=c.getHeight()})}},e.getSpaceBetweenShards=function(){var a=this.drawingContext.getSpaceBetweenShards(),b=this.getHeight()-this.shardsHeight;if(this.shards.length>1&&b>0&&!this.isLast){a+=b/this.shards.length}return a},e.draw=function(){this.renderIfNeeded(),this.drawContent(),this.move(),this.bindToParent()},e.renderIfNeeded=function(){this.isRendered()||this.render()},e.isRendered=function(){return null!==this.group},e.render=function(){this.group=new c("g"),this.group.attr("class",this.name),this.shards.forEach(this.dispatchGroup,this)},e.dispatchGroup=function(a){a.setParent(this.group)},e.drawContent=function(){this.shards.forEach(g)};var g=function(a){a.draw()};e.move=function(){this.isRendered()&&this.group.attr("transform","translate(0, "+this.posY+")")},e.bindToParent=function(){this.parent.append(this.group)},e.resetGeometries=function(){this.shards.forEach(h)};var h=function(a){a.resetGeometries()};e.getGeometries=function(){var a=this.shards.map(i);return Array.prototype.concat.apply([],a)};var i=function(a){return a.getAllMeasuresGeometries()};e.getStructure=function(){var a=this.getShardsStructures();return{pageIdx:this.idx,shards:a}},e.getShardsStructures=function(){return this.shards.map(j)};var j=function(a){return a.getStructure()};e.getIdx=function(){return this.idx},e.getIdxInPage=function(b){var c=this.shards.indexOf(b);if(-1===c){throw new a("NotInPage","The shard is not in this page")}return c},e.removeShard=function(a){var b=this.shards.splice(a,1)[0];b.unbindFromParent(),b.setParent(null)},e.isEmpty=function(){return 0===this.shards.length},e.getWidth=function(){return this.metrics.availableWidth},e.getHeight=function(){return this.isFirst?this.metrics.firstShardAvailableHeight:this.metrics.otherShardsAvailableHeight},e.getLastShard=function(){var b=this.shards.length;if(0===b.length)throw new a("Unexpected");var c=b-1;return this.shards[c]}}.call(this),function(){"use strict";var a=Adagio.page.PageContent,b=Adagio.page.PageContentProvider=function(a,b,c,d){this.init(a,b,c,d)},c=b.prototype;c.init=function(a,b,c,d){this.shardProvider=a,this.drawingContext=b,this.metrics=c,this.pagesContainer=d,this.pageIdx=0},c.setPageIdx=function(a){this.pageIdx=a},c.hasRemaining=function(){return this.shardProvider.hasRemaining()},c.getPageContent=function(){var a=this.createPageContent();return this.fillPageContent(a),this.pageIdx++,a.updateVerticalDisplay(),a},c.fillPageContent=function(a){for(;this.shardProvider.hasRemaining();){var b=this.shardProvider.getShard();if(!a.canPushShard(b)){this.shardProvider.handBackShard(b);break}a.pushShard(b)}var c=this.isLast();a.setIsLast(c)},c.createPageContent=function(){var b=new a;b.setDrawingContext(this.drawingContext);var c=0===this.pageIdx;return b.setIsFirst(c),b.setMetrics(this.metrics),b.setIdx(this.pageIdx),this.pagesContainer.push(b),b},c.isLast=function(){return!this.shardProvider.hasRemaining()}}.call(this),function(){"use strict";var a=Adagio.Brush.Elem,b=Adagio.page.Page=function(){this.init()};b.NAME="pageIntraMargin";var c=b.prototype;c.name=b.NAME,c.init=function(){this.width=null,this.height=null,this.header=null,this.content=null,this.footer=null,this.posX=null,this.posY=null,this.group=null,this.parent=null,this.svgRoot=null},c.setWidth=function(a){this.width=a},c.setHeight=function(a){this.height=a},c.setHeader=function(a){this.header=a},c.setContent=function(a){this.content=a},c.setFooter=function(a){this.footer=a},c.setPosition=function(a,b){this.posX=a,this.posY=b},c.setParent=function(a){this.parent=a},c.setSvgRoot=function(a){this.svgRoot=a},c.format=function(){var a=0;null!==this.header&&(a+=this.header.getHeight(),this.header.format()),this.content.setPosition(a),this.content.move(),null!==this.footer&&(a=this.height-this.footer.getHeight(),this.footer.setPosition(a),this.footer.format())},c.swapHeader=function(a){null!==this.header&&this.isRendered()&&(this.header.unbind(),this.header.setParent(null),this.header=null),this.header=a,this.isRendered()&&(this.header.setParent(this.group),this.header.isRendered()?a.bindToParent():a.draw())},c.draw=function(){this.renderIfNeeded(),this.drawContent(),this.move(),this.bindToParent()},c.renderIfNeeded=function(){this.isRendered()||this.render()},c.isRendered=function(){return null!==this.group},c.render=function(){this.group=new a("g"),this.group.attr("class",this.name),null!==this.header&&this.header.setParent(this.group),null!==this.footer&&this.footer.setParent(this.group),this.content.setParent(this.group)},c.drawContent=function(){null!==this.header&&this.header.draw(),this.content.draw(),null!==this.footer&&this.footer.draw()},c.move=function(){this.isRendered()&&this.group.attr("transform","translate("+this.posX+", "+this.posY+")")},c.bindToParent=function(){this.parent.append(this.group)},c.unbind=function(){this.group.removeFromParent()},c.resetGeometries=function(){this.content.resetGeometries()},c.getGeometries=function(){return this.content.getGeometries()},c.getStructure=function(){return this.content.getStructure()},c.getAvailableContentHeight=function(){var a=this.height;return null!==this.header&&(a-=this.header.getHeight()),null!==this.footer&&(a-=this.footer.getHeight()),a},c.getSvgRoot=function(){return this.svgRoot},c.getParent=function(){return this.parent}}.call(this),function(){"use strict";var a=Adagio.page.Page,b=Adagio.page.PageProvider=function(a,b,c,d){this.init(a,b,c,d)},c=b.prototype;c.init=function(a,b,c,d){this.pageContentProvider=a,this.headerProvider=b,this.footerProvider=c,this.pageMetrics=d,this.pageIdx=0},c.hasRemaining=function(){return this.pageContentProvider.hasRemaining()},c.getPage=function(){var b=new a,c=this.getWidth();b.setWidth(c);var d=this.pageMetrics.getAvailableHeight();if(b.setHeight(d),this.headerProvider.hasPageHeader()){var e=this.headerProvider.getPageHeader(this.pageIdx);b.setHeader(e)}if(this.footerProvider.hasPageFooter(this.pageIdx)){var f=this.footerProvider.getPageFooter();b.setFooter(f)}var g=this.pageContentProvider.getPageContent();return b.setContent(g),this.pageIdx++,b.format(),b},c.getWidth=function(){return this.pageMetrics.getAvailableWidth(this.pageIdx)}}.call(this),function(){"use strict";var a=Adagio.Utils.math;Adagio.page.computeMetrics=function(a,d,g,h){return{firstShardAvailableHeight:b(a,d,g),otherShardsAvailableHeight:c(a,d,g),availableWidth:g.getMinimalAvailableWidth(),firstSliceHeaderWidth:e(h),otherSlicesHeaderWidth:f(h)}};var b=function(a,b,c){return d(a,b,c,0)},c=function(a,b,c){return d(a,b,c,1)},d=function(a,b,c,d){var e=a.getPageHeader(d),f=e.getHeight(),g=b.getPageFooter(d),h=g.getHeight();return c.getAvailableHeight()-(f+h)},e=function(a){return g(a,!0)},f=function(a){return g(a,!1)},g=function(b,c){var d=b.getAllSystems(c);return d.forEach(h),d.map(i).reduce(a.max2)},h=function(a){var b=a.content.getNominalInnerHeight();a.header.setNominalHeight(b)},i=function(a){return a.getHeaderWidth()}}.call(this),function(){"use strict";var a=Adagio.Utils.systemBreakPolicyUtils,b=Adagio.page.SystemBreakPolicy=function(a){this.init(a)},c=b.prototype;c.init=function(b){a.fillDefault(b),a.check(b),this.config=b},c.isCountForbidden=function(a){return!0===this.config.forbiddenCounts[a]},c.hasMaxLimit=function(){return null!==this.config.maxNbMeasuresPerLine},c.getMaxNbMeasuresPerLine=function(){return this.config.maxNbMeasuresPerLine}}.call(this),function(){"use strict";var a=Adagio.Render.MeasureRenderer,b=Adagio.page.PageMetrics,c=Adagio.page.PageHeaderProvider,d=Adagio.page.PageFooterProvider,e=Adagio.page.MeasureColumnProvider,f=Adagio.page.SystemProvider,g=Adagio.page.MeasuresSliceProvider,h=Adagio.page.ShardProvider,i=Adagio.page.PageContentProvider,j=Adagio.page.PageProvider,k=Adagio.page.computeMetrics,l=Adagio.page.SystemBreakPolicy,m=Adagio.page.PageProviderBuilder=function(){this.init()},n=m.prototype;n.init=function(){},n.build=function(m,n,p,q,r){var s=new b(m,p,q),t=new c(m,p,q,s),u=new d(m,p,q,s),v=new a(q),w=o(q),x=new e(n,v,p,w,r.measureColumns),y=new f(n,p,q),z=k(t,u,s,y),A=new l(q.systemBreakConfig),B=new g(x,y,z,r.measuresSlices,A),C=new h(B,p,z,r.shards),D=new i(C,p,z,r.pages),E=new j(D,t,u,s);return this.headerProvider=t,this.measureProvider=x,this.sliceProvider=B,this.shardProvider=C,this.measureProvider=x,this.contentProvider=D,E};var o=function(a){return"number"==typeof a.firstMeasureIdx?a.firstMeasureIdx:0}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.math,c=Adagio.page.MeasureColumnsContainer=function(a,b){this.init(a,b)},d=c.prototype;d.init=function(a,b){this.measureColumns=[],this.startDisplayIdx=a,this.measureNumberingPolicy=b},d.push=function(a){a.setMeasureNumberingPolicy(this.measureNumberingPolicy),this.measureColumns.push(a)},d.removeMeasureColumn=function(a){this.checkMeasureIdx(a);var b=this.measureColumns.splice(a,1)[0],c=b.getMeasuresSlice(),d=c.getIdxInSlice(b);c.removeMeasure(d)},d.insertMeasure=function(a,b){this.checkInsertionIdx(b),a.setMeasureNumberingPolicy(this.measureNumberingPolicy),0===b?this.insertBegining(a):this.insertAfter(a,b),this.measureColumns.splice(b,0,a)},d.insertBegining=function(a){this.getFirstMeasuresSlice().insertMeasure(a,0)},d.insertAfter=function(a,b){var c=this.getMeasureColumn(b-1);if(c.hasMeasuresSlice()){var d=c.getMeasuresSlice(),e=d.getIdxInSlice(c),f=e+1;d.insertMeasure(a,f)}},d.getFirstMeasuresSlice=function(){return this.getMeasuresSliceForMeasureIdx(0)},d.getMeasuresSliceForMeasureIdx=function(a){return this.getMeasureColumn(a).getMeasuresSlice()},d.getMeasureColumn=function(a){return this.checkMeasureIdx(a),this.measureColumns[a]},d.checkInsertionIdx=function(c){var d=this.getNbMeasures();if(!b.isInteger(c)||c<0||c>d){throw new a("BadMeasureInsertionIdx","Bad measure insertion index ["+c+"]")}},d.checkMeasureIdx=function(c){var d=this.getNbMeasures();if(!b.isInteger(c)||c<0||c>=d){throw new a("BadMeasureIdx","Bad measure index ["+c+"]")}},d.getNbMeasures=function(){return this.measureColumns.length},d.isMeasureInSlice=function(a){return this.getMeasureColumn(a).hasMeasuresSlice()},d.getMeasuresSliceIdxFromMeasureIdx=function(a){return this.getMeasureColumn(a).getMeasuresSliceIdx()},d.getSlicesForMeasuresRange=function(a,b){for(var c=[],d=null,e=a;e<b;e++){var f=this.getMeasuresSliceIdxFromMeasureIdx(e);if(f!==d){var g=this.getMeasuresSliceForMeasureIdx(e);c.push(g),d=f}}return c},d.updateMeasureNumberFrom=function(a){for(var b=this.getNbMeasures(),c=this.getDisplayIdxAt(a),d=a;d<b;d++){var e=this.getMeasureColumn(d);e.setDataIdx(d),e.updateDisplayIdx(c),c+=e.getMeasureNumberShift()}},d.getDisplayIdxAt=function(a){if(0===a)return this.startDisplayIdx;var b=this.getMeasureColumn(a-1),c=b.getDisplayIdx();return c+=b.getMeasureNumberShift()},d.getUnbindedMeasures=function(){for(var a=this.getNbMeasures(),b=[],c=a-1;c>=0;c--){var d=this.getMeasureColumn(c);if(d.hasMeasuresSlice())return b;b.unshift(d)}return b},d.hasUnbindedMeasures=function(){var a=this.getNbMeasures(),b=a-1;return!this.getMeasureColumn(b).hasMeasuresSlice()}}.call(this),function(){"use strict";var a=Adagio.Utils.math,b=Adagio.Error.InternalError,c=Adagio.page.MeasuresSlicesContainer=function(){this.init()},d=c.prototype;d.init=function(){this.measuresSlices=[]},d.push=function(a){this.measuresSlices.push(a)},d.remove=function(a){this.checkSliceIdx(a),this.measuresSlices.splice(a,1)},d.getMeasuresSlice=function(a){return this.checkSliceIdx(a),this.measuresSlices[a]},d.checkSliceIdx=function(c){var d=this.getNbSlices();if(!a.isInteger(c)||c<0||c>=d){throw new b("BadSliceIdx","Bad slice index ["+c+"]")}},d.updateSliceIdxFrom=function(a){for(var b=this.getNbSlices(),c=a;c<b;c++){this.getMeasuresSlice(c).updateId(c)}},d.getNbSlices=function(){return this.measuresSlices.length},d.updateStartMeasureIdxFrom=function(a){for(var b=this.getNbSlices(),c=a;c<b;c++){this.getMeasuresSlice(c).affectMeasureStartIdx()}},d.isShardFromLastSlice=function(a){var b=this.getNbSlices()-1;return this.getMeasuresSlice(b).shards.includes(a)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.math,c=Adagio.page.ShardsContainer=function(){this.init()},d=c.prototype;d.init=function(){this.shards=[]},d.push=function(a){this.shards.push(a)},d.remove=function(a){this.checkShardIdx(a);var b=this.shards.splice(a,1)[0],c=b.getPageContent(),d=c.getIdxInPage(b);c.removeShard(d)},d.updateShardIdxFrom=function(a){for(var b=this.getNbShards(),c=a;c<b;c++){this.getShard(c).setIdx(c)}},d.getShard=function(a){return this.checkShardIdx(a),this.shards[a]},d.checkShardIdx=function(c){var d=this.getNbShards();if(!b.isInteger(c)||c<0||c>=d){throw new a("BadShardIdx","Bad shard index ["+c+"]")}},d.getNbShards=function(){return this.shards.length}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.math,c=Adagio.page.PagesContainer=function(){this.init()},d=c.prototype;d.init=function(){this.pages=[]},d.push=function(a){this.pages.push(a)},d.getPage=function(a){return this.checkPageIdx(a),this.pages[a]},d.getLastPage=function(){if(!this.hasAnyPage()){throw new a("NoLastPages","Cannot retrieve last page when there is no page.")}var b=this.getNbPages();return this.pages[b-1]},d.hasAnyPage=function(){return this.getNbPages()>0},d.remove=function(a){this.checkPageIdx(a),this.pages.splice(a,1)},d.checkPageIdx=function(c){var d=this.getNbPages();if(!b.isInteger(c)||c<0||c>=d){throw new a("BadPageIdx","Bad page index ["+c+"]")}},d.getNbPages=function(){return this.pages.length},d.updatePageIdxFrom=function(a){for(var b=this.getNbPages(),c=a;c<b;c++){this.getPage(c).setIdx(c)}}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Values.MeasureNumberingPolicy,c=Adagio.Values.MeasureLocation,d=Adagio.page.MeasureNumberingPolicy=function(a){this.init(a)},e=d.prototype;e.init=function(a){this.policyType=a},e.shouldDisplay=function(a){return this.policyType===b.EVERY?this.shouldDisplayEvery(a):this.policyType===b.FIRST_OF_SYSTEM?this.shouldDisplayFirstOfSystem(a):void d.raiseError(this.policyType)},e.shouldDisplayEvery=function(a){return a!==c.FIRST_OF_SCORE&&(a===c.FIRST_OF_LINE||a===c.OTHER||void f(a))},e.shouldDisplayFirstOfSystem=function(a){return a===c.FIRST_OF_LINE||a!==c.FIRST_OF_SCORE&&a!==c.OTHER&&void f(a)};var f=function(b){throw new a("Unexpected","Bad measure position ["+b+"].")}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.scale.extractPointSize,c=Adagio.smufl.GlyphsCache,d=Adagio.Drawer.DrawingContext,e=Adagio.Utils.pageMarginUtils,f=Adagio.Utils.math,g=Adagio.Utils.clone,h=Adagio.Values.DisplayScaling,i=Adagio.Render.getDataSource,j=Adagio.Render.ScoreDataCache,k=Adagio.page.PageProviderBuilder,l=Adagio.page.MeasureColumnsContainer,m=Adagio.page.MeasuresSlicesContainer,n=Adagio.page.ShardsContainer,o=Adagio.page.PagesContainer,p=Adagio.page.MeasureNumberingPolicy,q="page",r=Adagio.page.PageLayout=function(a,b,c,d,e){this.init(a,b,c,d,e)},s=r.prototype;s.init=function(a,e,f,g,q){q=q||{},this.scoreData=a;var r=b(a);void 0!==q.logoFontJson&&(q.logoFont=new c(q.logoFontJson,e,r)),void 0===q.notesSpacingCoeff&&(q.notesSpacingCoeff=this.scoreData.getNotesSpacingCoeff()),void 0===q.systemBreakConfig&&(q.systemBreakConfig=this.scoreData.getSystemBreakPolicy()),void 0===q.measureNumberingPolicy&&(q.measureNumberingPolicy=this.scoreData.getMeasureNumberingPolicy()),this.drawingContext=new d(f,g,r,e,q);var s=t(q),u=new p(q.measureNumberingPolicy);this.measuresContainer=new l(s,u),this.slicesContainer=new m,this.shardsContainer=new n,this.pagesContainer=new o;var v=new k,w={measureColumns:this.measuresContainer,measuresSlices:this.slicesContainer,shards:this.shardsContainer,pages:this.pagesContainer},x=i(a,q);this.scoreDataCache=new j(x,q),this.pageProvider=v.build(this.scoreData,this.scoreDataCache,this.drawingContext,q,w),this.headerProvider=v.headerProvider,this.measureProvider=v.measureProvider,this.sliceProvider=v.sliceProvider,this.shardProvider=v.shardProvider,this.measureProvider=v.measureProvider,this.contentProvider=v.contentProvider,this.pages=[],this.scaling=h.DEFAULT};var t=function(a){return"number"==typeof a.firstMeasureIdx?a.firstMeasureIdx:0};s.getPageSize=function(a){var b,c=this.getSpaceSize(),d=this.scoreData.getPageWidth()/10*c,g=this.scoreData.getPageHeight()/10*c,h=a+1;return b=f.isNumber(a)&&h%2==1?this.scoreData.getOddPageMargins():this.scoreData.getEvenPageMargins(),{height:g,width:d,marginTop:e.getTop(b)/10*c,marginLeft:e.getLeft(b)/10*c}},s.getSpaceSize=function(){return this.drawingContext.getSpaceSize()},s.hasRemaining=function(){return this.pageProvider.hasRemaining()},s.fillNextPage=function(a){var b=this.pages.length,c=this.pageProvider.getPage();this.pages.push(c),c.setPosition(0,0);var d=this.getPageSize(b);a.attr("width",d.width*this.scaling),a.attr("height",d.height*this.scaling),a.attr("class",q);var e=a.append("g");e.attr("transform","scale("+this.scaling+")translate("+d.marginLeft+", "+d.marginTop+")"),c.setParent(e),c.setSvgRoot(a),c.draw()},s.setScaling=function(a){h.assert(a),a!==this.scaling&&(this.scaling=a,this.pages.forEach(this.updatePageSvgSize,this))},s.updatePagesSvgSize=function(){this.pages.forEach(this.updatePageSvgSize,this)},s.updatePageSvgSize=function(a,b){var c=a.getSvgRoot(),d=this.getPageSize(b);c.attr("width",d.width*this.scaling),c.attr("height",d.height*this.scaling),a.getParent().attr("transform","scale("+this.scaling+")translate("+d.marginLeft+", "+d.marginTop+")")},s.getScaling=function(){return this.scaling},s.resetPagesGeometries=function(){this.pages.forEach(u)};var u=function(a){a.resetGeometries()};s.getAllPagesGeometries=function(){var a=this.pages.map(v);return Array.prototype.concat.apply([],a)};var v=function(a){return a.getGeometries()};s.getLastPageGeometries=function(){var b=this.pages.length;if(0===b){throw new a("NoPageDrawn","There are no pages drawn.")}return this.pages[b-1].getGeometries()},s.getStaffLyricsUpY=function(a,b,c,d){return this.getSliceForMeasureIdx(c).getStaffLyricsUpY(a,b,c,d)},s.getStaffWordsY=function(a,b,c,d){return this.getSliceForMeasureIdx(c).getStaffWordsY(a,b,c,d)},s.getSystemChordsY=function(a,b){return this.getSliceForMeasureIdx(b).getSystemChordsY(a,b)},s.getPagesStructures=function(){return this.pages.map(w)};var w=function(a){return a.getStructure()};s.getLyricsFontSize=function(){return this.drawingContext.getLyricsFontSize()},s.getHarmonyFontSize=function(){return this.drawingContext.getHarmonyFontSize()},s.getWordFontSize=function(){return this.drawingContext.getWordFontSize()},s.removePage=function(a){this.checkPageIdx(a),this.pagesContainer.remove(a),this.getPage(a).unbind(),this.pages.splice(a,1)},s.getLastContent=function(){return this.pagesContainer.getLastPage()},s.hasAnyPageContent=function(){return this.pagesContainer.hasAnyPage()},s.getContentProvider=function(){return this.contentProvider},s.getMeasureProvider=function(){return this.measureProvider},s.getShardProvider=function(){return this.shardProvider},s.getNbShards=function(){return this.shardsContainer.getNbShards()},s.getSliceProvider=function(){return this.sliceProvider},s.getNbSlices=function(){return this.slicesContainer.getNbSlices()},s.getPage=function(a){return this.checkPageIdx(a),this.pages[a]},s.checkPageIdx=function(b){var c=this.getNbPages();if(!f.isInteger(b)||b<0||b>=c){throw new a("BadPageIdx","Bad page index: ["+b+"]")}},s.getNbPages=function(){return this.pages.length},s.getMeasuresContainer=function(){return this.measuresContainer},s.getDrawingContext=function(){return this.drawingContext},s.getNbMeasures=function(){return this.measuresContainer.getNbMeasures()},s.getSlicesContainer=function(){return this.slicesContainer},s.getShardsContainer=function(){return this.shardsContainer},s.getPagesContainer=function(){return this.pagesContainer},s.getHeaderProvider=function(){return this.headerProvider},s.drawBasicCursor=function(a,b){this.getSliceForMeasureIdx(a.measureIdx).drawBasicCursor(a,b)},s.drawGraceCursor=function(a,b){this.getSliceForMeasureIdx(a.measureIdx).drawGraceCursor(a,b)},s.drawTabCursor=function(a,b){this.getSliceForMeasureIdx(a.measureIdx).drawTabCursor(a,b)},s.drawDynamicCursor=function(a,b){this.getSliceForMeasureIdx(a.measureIdx).drawDynamicCursor(a,b)},s.drawPizzicatoCursor=function(a,b){this.getSliceForMeasureIdx(a.measureIdx).drawPizzicatoCursor(a,b)},s.drawHorizontalCursor=function(a,b){var c=a.startMeasureIdx,d=a.stopMeasureIdx;this.getSlicesForMeasuresRange(c,d+1).forEach(function(c,d,e){var f=e.length,h=g(a);h.startNoteIdx=d>0?null:a.startNoteIdx,h.stopNoteIdx=d<f-1?null:a.stopNoteIdx,c.drawHorizontalCursor(h,b)})},s.drawHorizontalCursorTimePos=function(a,b){var c=a.startMeasureIdx,d=a.stopMeasureIdx;this.getSlicesForMeasuresRange(c,d+1).forEach(function(c,d,e){var f=e.length,h=g(a);h.startTimePos=d>0?null:a.startTimePos,h.stopTimePos=d<f-1?null:a.stopTimePos,c.drawHorizontalCursorTimePos(h,b)})},s.drawHorizontalMeasureWideCursor=function(a,b){this.getSliceForMeasureIdx(a.measureIdx).drawHorizontalMeasureWideCursor(a,b)},s.drawCrossMeasureNoteCursor=function(a,b){var c=a.startMeasureIdx,d=a.stopMeasureIdx;this.getSlicesForMeasuresRange(c,d+1).forEach(function(c,d,e){var f=e.length,h=g(a);h.startNoteIdx=d>0?null:a.startNoteIdx,h.stopNoteIdx=d<f-1?null:a.stopNoteIdx,c.drawCrossMeasureNoteCursor(h,b)})},s.getSliceForMeasureIdx=function(a){return this.measuresContainer.getMeasuresSliceForMeasureIdx(a)},s.getSlicesForMeasuresRange=function(a,b){return this.measuresContainer.getSlicesForMeasuresRange(a,b)},s.getScoreData=function(){return this.scoreData},s.getMeasureWidth=function(a,b){return this.getSliceForMeasureIdx(b).getMeasureWidth(a,b)},s.getNoteXInMeasure=function(a,b,c,d,e){return this.getSliceForMeasureIdx(c).getNoteXInMeasure(a,b,c,d,e)},s.getSystemHeight=function(a,b){return this.getSliceForMeasureIdx(b).getStaffHeight(a)},s.getSpaceAboveStaff=function(a,b,c){return this.getSliceForMeasureIdx(c).getSpaceAboveStaff(a,b)},s.getMeasureNbNotes=function(a,b,c,d){return this.getSliceForMeasureIdx(c).getMeasureNbNotes(a,b,c,d)},s.getScoreDataCache=function(){return this.scoreDataCache}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.scale.extractPointSize,c=Adagio.Render,d=Adagio.Render.getDataSource,e=Adagio.Render.ScoreDataCache,f=Adagio.Drawer.ScoreShard,g=Adagio.Drawer.DrawingContext,h=Adagio.Values.DisplayScaling,i=5,j=Adagio.track.TrackLayout=function(a,b,c,d,e){this.init(a,b,c,d,e)},k=j.prototype;k.init=function(a,c,f,i,j){j=j||{},this.scoreData=a;var k=b(a);void 0===j.notesSpacingCoeff&&(j.notesSpacingCoeff=this.scoreData.getNotesSpacingCoeff()),this.drawingContext=new g(f,i,k,c,j),this.scoreShard=null,this.pageSvg=null,this.intraMarginGroup=null,this.displayOpts=j,this.scaling=h.DEFAULT,this.dataSource=d(this.scoreData,this.displayOpts),this.scoreDataCache=new e(this.dataSource,this.displayOpts)},k.getPageSize=function(){var a=this.getSpaceSize(),b=i*a,c=5*a,d=7*a,e=this.scoreShard.getBBox();return{height:e.height+b+c,width:e.width+d,marginTop:b,marginLeft:0}},k.getSpaceSize=function(){return this.drawingContext.getSpaceSize()},k.hasRemaining=function(){return null===this.scoreShard},k.fillNextPage=function(b){if(null!==this.scoreShard)throw new a("Unexpected","There is no more page to draw");b.attr("class","page");var d=b.append("g"),e=d.append("g");e.attr("class","pageIntraMargin"),e.attr("transform","scale("+this.scaling+")"),this.intraMarginGroup=e;var g=e.append("g");g.attr("class","pageContent");var h=new f;new c(this.dataSource,this.scoreDataCache,h,this.displayOpts).renderAll(),h.setDrawingContext(this.drawingContext),h.initialDisplayUpdate();var j=this.getSpaceSize(),k=i*j;h.setPosition(k),h.setParent(g),h.draw(),h.setIdx(0),h.getSystems().forEach(l),this.pageSvg=b,this.scoreShard=h,this.updateSvgSize()},k.setScaling=function(a){h.assert(a),this.scaling=a,null!==this.intraMarginGroup&&(this.intraMarginGroup.attr("transform","scale("+this.scaling+")"),this.updateSvgSize())},k.getScaling=function(){return this.scaling};var l=function(a,b){a.setIdx(b)};k.resetPagesGeometries=function(){this.scoreShard.resetGeometries()},k.getAllPagesGeometries=function(){return this.getLastPageGeometries()},k.getLastPageGeometries=function(){return this.scoreShard.getAllMeasuresGeometries()},k.getPagesStructures=function(){return[{pageIdx:0,shards:[this.scoreShard.getStructure()]}]},k.getStaffLyricsUpY=function(a,b,c,d){return this.scoreShard.getStaffLyricsUpY(a,b,c,d)},k.getStaffWordsY=function(a,b,c,d){return this.scoreShard.getStaffWordsY(a,b,c,d)},k.getSystemChordsY=function(a,b){return this.scoreShard.getSystemChordsY(a,b)},k.getMeasureWidth=function(a,b){return this.scoreShard.getMeasureWidth(a,b)},k.getNoteXInMeasure=function(a,b,c,d,e){return this.scoreShard.getNoteXInMeasure(a,b,c,d,e)},k.getMeasureNbNotes=function(a,b,c,d){return this.scoreShard.getMeasureNbNotes(a,b,c,d)},k.getSystemHeight=function(a){return this.scoreShard.getSystemHeight(a)},k.getSpaceAboveStaff=function(a,b){return this.scoreShard.getSpaceAboveStaff(a,b)},k.getDrawingContext=function(){return this.drawingContext},k.getLyricsFontSize=function(){return this.drawingContext.getLyricsFontSize()},k.getHarmonyFontSize=function(){return this.drawingContext.getHarmonyFontSize()},k.getWordFontSize=function(){return this.drawingContext.getWordFontSize()},k.updateSvgSize=function(){var a=this.getPageSize();this.pageSvg.attr("width",a.width*this.scaling),this.pageSvg.attr("height",a.height*this.scaling)},k.getScoreShard=function(){return this.scoreShard},k.drawBasicCursor=function(a,b){this.scoreShard.drawBasicCursor(a,b)},k.drawGraceCursor=function(a,b){this.scoreShard.drawGraceCursor(a,b)},k.drawTabCursor=function(a,b){this.scoreShard.drawTabCursor(a,b)},k.drawDynamicCursor=function(a,b){this.scoreShard.drawDynamicCursor(a,b)},k.drawPizzicatoCursor=function(a,b){this.scoreShard.drawPizzicatoCursor(a,b)},k.drawHorizontalCursor=function(a,b){this.scoreShard.drawHorizontalCursor(a,b)},k.drawHorizontalCursorTimePos=function(a,b){this.scoreShard.drawHorizontalCursorTimePos(a,b)},k.drawHorizontalMeasureWideCursor=function(a,b){this.scoreShard.drawHorizontalMeasureWideCursor(a,b)},k.drawCrossMeasureNoteCursor=function(a,b){this.scoreShard.drawCrossMeasureNoteCursor(a,b)},k.getScoreData=function(){return this.scoreData},k.getScoreDataCache=function(){return this.scoreDataCache}}.call(this),function(){"use strict";var a=Adagio.Drawer.ScoreShard,b=Adagio.page.formatter.formatHorizBasic,c=Adagio.embed.DynamicShardProvider=function(a,b,c,d){
this.init(a,b,c,d)},d=c.prototype;d.init=function(a,b,c,d){this.measuresSliceProvider=a,this.drawingContext=b,this.metrics=c,this.shardsContainer=d,this.shardIdx=0},d.setShardIdx=function(a){this.shardIdx=a},d.hasRemaining=function(){return this.measuresSliceProvider.hasRemaining()},d.getShard=function(){var a=this.loadNextSliceShard();a.moveHeaders(),a.moveSystems();var c=this.metrics.availableWidth,d=!this.measuresSliceProvider.hasRemaining();return b(a,c,d),a.autoUpdateVerticalDisplay(),a},d.loadNextSliceShard=function(){var a=this.measuresSliceProvider.getSlice(),b=a.getSystems(),c=this.createShard();return b.forEach(c.pushSystem,c),a.addShard(c),c},d.createShard=function(){var b=new a;b.setDrawingContext(this.drawingContext),b.setMetrics(this.metrics),b.height=0;var c=0===this.shardIdx;return b.setIsFirst(c),b.setIdx(this.shardIdx),this.shardsContainer.push(b),this.shardIdx++,b},d.clearCache=function(){}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Brush.Elem,c=Adagio.embed.DynamicPageContent=function(){this.init()};c.NAME="pageContent";var d=c.prototype;d.name=c.NAME,d.init=function(){this.drawingContext=null,this.metrics=null,this.idx=null,this.posY=null,this.isLast=null,this.isFirst=null,this.shard=null,this.group=null,this.parent=null},d.setDrawingContext=function(a){this.drawingContext=a},d.setMetrics=function(a){this.metrics=a},d.setIsLast=function(a){this.isLast=a},d.setIsFirst=function(a){this.isFirst=a},d.setIdx=function(a){this.idx=a},d.setParent=function(a){this.parent=a},d.setPosition=function(a){this.posY=a},d.pushShard=function(b){if(null!==this.shard)throw new a("Unexpected");this.shard=b,b.setPageContent(this),this.isRendered()&&(b.setParent(this.group),b.isRendered()||b.draw())},d.recomputeShardsHeight=function(){},d.updateVerticalDisplay=function(){if(!this.isEmpty()){this.shard.setPosition(0),this.shard.move()}},d.draw=function(){this.renderIfNeeded(),this.drawContent(),this.move(),this.bindToParent()},d.renderIfNeeded=function(){this.isRendered()||this.render()},d.isRendered=function(){return null!==this.group},d.render=function(){this.group=new b("g"),this.group.attr("class",this.name),this.shard.setParent(this.group)},d.dispatchGroup=function(a){a.setParent(this.group)},d.drawContent=function(){this.shard.draw()},d.move=function(){this.isRendered()&&this.group.attr("transform","translate(0, "+this.posY+")")},d.bindToParent=function(){this.parent.append(this.group)},d.resetGeometries=function(){this.shard.resetGeometries()},d.getGeometries=function(){return this.shard.getAllMeasuresGeometries()},d.getStructure=function(){var a=this.getShardsStructures();return{pageIdx:this.idx,shards:a}},d.getShardsStructures=function(){return[this.shard.getStructure()]},d.getIdx=function(){return this.idx},d.getIdxInPage=function(b){if(b!==this.shard){throw new a("NotInPage","The shard is not in this page")}return 0},d.removeShard=function(b){if(0!==b)throw new a;var c=this.shard;this.shard=null,c.unbindFromParent(),c.setParent(null)},d.isEmpty=function(){return null===this.shard},d.getWidth=function(){return this.metrics.availableWidth},d.getHeight=function(){return this.shard.getHeight()},d.getLastShard=function(){if(null===this.shard)throw new a("Unexpected");return this.shard}}.call(this),function(){"use strict";var a=Adagio.embed.DynamicPageContent,b=Adagio.embed.DynamicPageContentProvider=function(a,b,c,d){this.init(a,b,c,d)},c=b.prototype;c.init=function(a,b,c,d){this.shardProvider=a,this.drawingContext=b,this.metrics=c,this.pagesContainer=d,this.pageIdx=0},c.setPageIdx=function(a){this.pageIdx=a},c.hasRemaining=function(){return this.shardProvider.hasRemaining()},c.getPageContent=function(){var a=this.createPageContent();return this.fillPageContent(a),this.pageIdx++,a.updateVerticalDisplay(),a},c.fillPageContent=function(a){if(a.isEmpty()){var b=this.shardProvider.getShard();a.pushShard(b)}var c=this.isLast();a.setIsLast(c)},c.createPageContent=function(){var b=new a;b.setDrawingContext(this.drawingContext);var c=0===this.pageIdx;return b.setIsFirst(c),b.setMetrics(this.metrics),b.setIdx(this.pageIdx),this.pagesContainer.push(b),b},c.isLast=function(){return!this.shardProvider.hasRemaining()}}.call(this),function(){"use strict";var a=Adagio.Brush.Elem,b=Adagio.embed.DynamicPage=function(){this.init()};b.NAME="pageIntraMargin";var c=b.prototype;c.name=b.NAME,c.init=function(){this.width=null,this.height=null,this.content=null,this.posX=null,this.posY=null,this.group=null,this.parent=null,this.svgRoot=null},c.setWidth=function(a){this.width=a},c.setContent=function(a){this.content=a},c.setPosition=function(a,b){this.posX=a,this.posY=b},c.setParent=function(a){this.parent=a},c.setSvgRoot=function(a){this.svgRoot=a},c.format=function(){this.content.setPosition(0),this.content.move()},c.draw=function(){this.renderIfNeeded(),this.drawContent(),this.move(),this.bindToParent()},c.renderIfNeeded=function(){this.isRendered()||this.render()},c.isRendered=function(){return null!==this.group},c.render=function(){this.group=new a("g"),this.group.attr("class",this.name),this.content.setParent(this.group)},c.drawContent=function(){this.content.draw()},c.move=function(){this.isRendered()&&this.group.attr("transform","translate("+this.posX+", "+this.posY+")")},c.bindToParent=function(){this.parent.append(this.group)},c.unbind=function(){this.group.removeFromParent()},c.resetGeometries=function(){this.content.resetGeometries()},c.getGeometries=function(){return this.content.getGeometries()},c.getStructure=function(){return this.content.getStructure()},c.getHeight=function(){return this.content.getHeight()},c.getSvgRoot=function(){return this.svgRoot},c.getParent=function(){return this.parent}}.call(this),function(){"use strict";var a=Adagio.embed.DynamicPage,b=Adagio.embed.DynamicPageProvider=function(a,b){this.init(a,b)},c=b.prototype;c.init=function(a,b){this.pageContentProvider=a,this.pageMetrics=b,this.pageIdx=0},c.hasRemaining=function(){return this.pageContentProvider.hasRemaining()},c.getPage=function(){var b=new a,c=this.getWidth();b.setWidth(c);var d=this.pageContentProvider.getPageContent();return b.setContent(d),this.pageIdx++,b.format(),b},c.getWidth=function(){return this.pageMetrics.getWidth()}}.call(this),function(){"use strict";var a=Adagio.Utils.math;Adagio.embed.computeMetrics=function(a,d){var e=a.getWidth(),f=b(d),g=c(d),h={availableWidth:e,firstSliceHeaderWidth:f,otherSlicesHeaderWidth:g};return a.setInnerMetrics(h),h};var b=function(a){return d(a,!0)},c=function(a){return d(a,!1)},d=function(b,c){var d=b.getAllSystems(c);return d.forEach(e),d.map(f).reduce(a.max2)},e=function(a){var b=a.content.getNominalInnerHeight();a.header.setNominalHeight(b)},f=function(a){return a.getHeaderWidth()}}.call(this),function(){"use strict";var a=Adagio.Render.MeasureRenderer,b=Adagio.page.MeasureColumnProvider,c=Adagio.page.SystemProvider,d=Adagio.page.MeasuresSliceProvider,e=Adagio.page.SystemBreakPolicy,f=Adagio.embed.DynamicShardProvider,g=Adagio.embed.DynamicPageContentProvider,h=Adagio.embed.DynamicPageProvider,i=Adagio.embed.computeMetrics,j=Adagio.embed.DynamicPageProviderBuilder=function(){this.init()},k=j.prototype;k.init=function(){},k.build=function(j,k,m,n,o,p){var q=new a(n),r=l(n),s=new b(k,q,m,r,o.measureColumns),t=new c(k,m,n),u=i(p,t),v=new e(n.systemBreakConfig),w=new d(s,t,u,o.measuresSlices,v),x=new f(w,m,u,o.shards),y=new g(x,m,u,o.pages),z=new h(y,p);return this.measureProvider=s,this.sliceProvider=w,this.shardProvider=x,this.measureProvider=s,this.contentProvider=y,z};var l=function(a){return"number"==typeof a.firstMeasureIdx?a.firstMeasureIdx:0}}.call(this),function(){"use strict";var a=Adagio.Utils.pageMarginUtils,b=Adagio.embed.DynamicPageMetrics=function(a,b,c){this.init(a,b,c)},c=b.prototype;c.init=function(a,b,c){this.scoreData=a,this.drawingContext=b,this.opts=c,this.nominalWidth=null,this.width=null,this.innerMetric=null},c.setScoreData=function(a){this.scoreData=a},c.setDrawingContext=function(a){this.drawingContext=a},c.setInnerMetrics=function(a){this.innerMetric=a},c.getWidth=function(){return null===this.width&&(this.width=this.getNominalWidth()),this.width},c.getNominalWidth=function(){return null===this.nominalWidth&&(this.nominalWidth=this.getMinimalAvailableWidth()),this.nominalWidth},c.getMinimalAvailableWidth=function(){var b=this.getSideAvailableWidth(a.TYPE_ODD),c=this.getSideAvailableWidth(a.TYPE_EVEN);return Math.min(b,c)},c.getSideAvailableWidth=function(a){var b=this.scoreData.getPageUsableSize(a),c=b.width;return this.tenthsToLocal(c)},c.tenthsToLocal=function(a){return a/10*this.drawingContext.getSpaceSize()},c.resetWidthToNominal=function(){var a=this.getNominalWidth();this.setWidth(a)},c.setWidth=function(a){this.width=a,this.innerMetric.availableWidth=a}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.scale.extractPointSize,c=Adagio.Drawer.DrawingContext,d=Adagio.Utils.math,e=Adagio.Utils.clone,f=Adagio.Utils.systemBreakPolicyUtils,g=Adagio.Values.DisplayScaling,h=Adagio.Render.getDataSource,i=Adagio.Render.ScoreDataCache,j=Adagio.embed.DynamicPageProviderBuilder,k=Adagio.embed.DynamicPageMetrics,l=Adagio.page.MeasureColumnsContainer,m=Adagio.page.MeasuresSlicesContainer,n=Adagio.page.ShardsContainer,o=Adagio.page.PagesContainer,p=Adagio.page.MeasureNumberingPolicy,q="page",r=Adagio.page.EmbedLayout=function(a,b,c,d,e){this.init(a,b,c,d,e)},s=r.prototype;s.init=function(a,d,e,q,r){r=r||{},this.scoreData=a;var s=b(a);void 0===r.notesSpacingCoeff&&(r.notesSpacingCoeff=this.scoreData.getNotesSpacingCoeff()),r.systemBreakConfig=f.createNoLimitConfig(),void 0===r.measureNumberingPolicy&&(r.measureNumberingPolicy=this.scoreData.getMeasureNumberingPolicy()),this.drawingContext=new c(e,q,s,d,r);var u=t(r),v=new p(r.measureNumberingPolicy);this.measuresContainer=new l(u,v),this.slicesContainer=new m,this.shardsContainer=new n,this.pagesContainer=new o,this.pageMetrics=new k(a,this.drawingContext,r);var w=new j,x={measureColumns:this.measuresContainer,measuresSlices:this.slicesContainer,shards:this.shardsContainer,pages:this.pagesContainer},y=h(a,r);this.scoreDataCache=new i(y,r),this.pageProvider=w.build(this.scoreData,this.scoreDataCache,this.drawingContext,r,x,this.pageMetrics),this.measureProvider=w.measureProvider,this.sliceProvider=w.sliceProvider,this.shardProvider=w.shardProvider,this.measureProvider=w.measureProvider,this.contentProvider=w.contentProvider,this.pages=[],this.scaling=g.DEFAULT};var t=function(a){return"number"==typeof a.firstMeasureIdx?a.firstMeasureIdx:0};s.getPageSize=function(a){var b=this.pageMetrics.getWidth();return{height:this.pages[a].getHeight(),width:b,marginTop:0,marginLeft:0}},s.getSpaceSize=function(){return this.drawingContext.getSpaceSize()},s.hasRemaining=function(){return this.pageProvider.hasRemaining()},s.fillNextPage=function(a){var b=this.pages.length,c=this.pageProvider.getPage();this.pages.push(c),c.setPosition(0,0);var d=a.append("g");d.attr("transform","scale("+this.scaling+")"),c.setParent(d),c.setSvgRoot(a),c.draw();var e=this.getPageSize(b);a.attr("width",e.width*this.scaling),a.attr("height",e.height*this.scaling),a.attr("class",q)},s.setScaling=function(a){g.assert(a),a!==this.scaling&&(this.scaling=a,this.pages.forEach(this.updatePageSvgSize,this))},s.getWidth=function(){return this.pageMetrics.getWidth()},s.getNominalWidth=function(){return this.pageMetrics.getNominalWidth()},s.setWidth=function(a){this.pageMetrics.setWidth(a)},s.updatePagesSvgSize=function(){this.pages.forEach(this.updatePageSvgSize,this)},s.updatePageSvgSize=function(a,b){var c=a.getSvgRoot(),d=this.getPageSize(b);c.attr("width",d.width*this.scaling),c.attr("height",d.height*this.scaling),a.getParent().attr("transform","scale("+this.scaling+")")},s.getScaling=function(){return this.scaling},s.resetPagesGeometries=function(){this.pages.forEach(u)};var u=function(a){a.resetGeometries()};s.getAllPagesGeometries=function(){var a=this.pages.map(v);return Array.prototype.concat.apply([],a)};var v=function(a){return a.getGeometries()};s.getLastPageGeometries=function(){var b=this.pages.length;if(0===b){throw new a("NoPageDrawn","There are no pages drawn.")}return this.pages[b-1].getGeometries()},s.getStaffLyricsUpY=function(a,b,c,d){return this.getSliceForMeasureIdx(c).getStaffLyricsUpY(a,b,c,d)},s.getStaffWordsY=function(a,b,c,d){return this.getSliceForMeasureIdx(c).getStaffWordsY(a,b,c,d)},s.getSystemChordsY=function(a,b){return this.getSliceForMeasureIdx(b).getSystemChordsY(a,b)},s.getPagesStructures=function(){return this.pages.map(w)};var w=function(a){return a.getStructure()};s.getLyricsFontSize=function(){return this.drawingContext.getLyricsFontSize()},s.getHarmonyFontSize=function(){return this.drawingContext.getHarmonyFontSize()},s.getWordFontSize=function(){return this.drawingContext.getWordFontSize()},s.removePage=function(a){this.checkPageIdx(a),this.pagesContainer.remove(a),this.getPage(a).unbind(),this.pages.splice(a,1)},s.getLastContent=function(){return this.pagesContainer.getLastPage()},s.hasAnyPageContent=function(){return this.pagesContainer.hasAnyPage()},s.getContentProvider=function(){return this.contentProvider},s.getMeasureProvider=function(){return this.measureProvider},s.getShardProvider=function(){return this.shardProvider},s.getNbShards=function(){return this.shardsContainer.getNbShards()},s.getSliceProvider=function(){return this.sliceProvider},s.getNbSlices=function(){return this.slicesContainer.getNbSlices()},s.getPage=function(a){return this.checkPageIdx(a),this.pages[a]},s.checkPageIdx=function(b){var c=this.getNbPages();if(!d.isInteger(b)||b<0||b>=c){throw new a("BadPageIdx","Bad page index: ["+b+"]")}},s.getNbPages=function(){return this.pages.length},s.getMeasuresContainer=function(){return this.measuresContainer},s.getDrawingContext=function(){return this.drawingContext},s.getNbMeasures=function(){return this.measuresContainer.getNbMeasures()},s.getSlicesContainer=function(){return this.slicesContainer},s.getShardsContainer=function(){return this.shardsContainer},s.getPagesContainer=function(){return this.pagesContainer},s.drawBasicCursor=function(a,b){this.getSliceForMeasureIdx(a.measureIdx).drawBasicCursor(a,b)},s.drawGraceCursor=function(a,b){this.getSliceForMeasureIdx(a.measureIdx).drawGraceCursor(a,b)},s.drawTabCursor=function(a,b){this.getSliceForMeasureIdx(a.measureIdx).drawTabCursor(a,b)},s.drawDynamicCursor=function(a,b){this.getSliceForMeasureIdx(a.measureIdx).drawDynamicCursor(a,b)},s.drawPizzicatoCursor=function(a,b){this.getSliceForMeasureIdx(a.measureIdx).drawPizzicatoCursor(a,b)},s.drawHorizontalCursor=function(a,b){var c=a.startMeasureIdx,d=a.stopMeasureIdx;this.getSlicesForMeasuresRange(c,d+1).forEach(function(c,d,f){var g=f.length,h=e(a);h.startNoteIdx=d>0?null:a.startNoteIdx,h.stopNoteIdx=d<g-1?null:a.stopNoteIdx,c.drawHorizontalCursor(h,b)})},s.drawHorizontalCursorTimePos=function(a,b){var c=a.startMeasureIdx,d=a.stopMeasureIdx;this.getSlicesForMeasuresRange(c,d+1).forEach(function(c,d,f){var g=f.length,h=e(a);h.startTimePos=d>0?null:a.startTimePos,h.stopTimePos=d<g-1?null:a.stopTimePos,c.drawHorizontalCursorTimePos(h,b)})},s.drawHorizontalMeasureWideCursor=function(a,b){this.getSliceForMeasureIdx(a.measureIdx).drawHorizontalMeasureWideCursor(a,b)},s.drawCrossMeasureNoteCursor=function(a,b){var c=a.startMeasureIdx,d=a.stopMeasureIdx;this.getSlicesForMeasuresRange(c,d+1).forEach(function(c,d,f){var g=f.length,h=e(a);h.startNoteIdx=d>0?null:a.startNoteIdx,h.stopNoteIdx=d<g-1?null:a.stopNoteIdx,c.drawCrossMeasureNoteCursor(h,b)})},s.getSliceForMeasureIdx=function(a){return this.measuresContainer.getMeasuresSliceForMeasureIdx(a)},s.getSlicesForMeasuresRange=function(a,b){return this.measuresContainer.getSlicesForMeasuresRange(a,b)},s.getScoreData=function(){return this.scoreData},s.getMeasureWidth=function(a,b){return this.getSliceForMeasureIdx(b).getMeasureWidth(a,b)},s.getNoteXInMeasure=function(a,b,c,d,e){return this.getSliceForMeasureIdx(c).getNoteXInMeasure(a,b,c,d,e)},s.getSystemHeight=function(a,b){return this.getSliceForMeasureIdx(b).getStaffHeight(a)},s.getSpaceAboveStaff=function(a,b,c){return this.getSliceForMeasureIdx(c).getSpaceAboveStaff(a,b)},s.getMeasureNbNotes=function(a,b,c,d){return this.getSliceForMeasureIdx(c).getMeasureNbNotes(a,b,c,d)},s.getScoreDataCache=function(){return this.scoreDataCache}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError;(Adagio.updater.UpdateType={ADD:"ADD",REMOVE:"REMOVE",UPDATE:"UPDATE"}).raiseError=function(b){throw new a("BadUpdateType","Bad display update operation type: ["+b+"].")}}.call(this),function(){"use strict";String.prototype.endsWith||(String.prototype.endsWith=function(a,b){var c=this.toString();(void 0===b||b>c.length)&&(b=c.length),b-=a.length;var d=c.indexOf(a,b);return-1!==d&&d===b})}.call(this),function(){"use strict";var a=Adagio.Utils.cancelStackUtils={};a.extractTrueActions=function(c){return a.extractActions(c).filter(b)},a.extractDrawActions=function(b){return a.extractActions(b).filter(e)};var b=function(a){return!a.type.endsWith("-close")},c=function(a){var b=[];return a.stack.forEach(function(a){if(d(a))b.push(a);else{var e=c(a);b.push.apply(b,e)}}),b},d=function(a){return"string"==typeof a.type},e=function(a){return!a.noDraw};a.extractActions=c}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.edit.common.FakeMeasuresScroller=function(a){this.init(a)},c=b.prototype;c.init=function(a){this.partIdx=a},c.registerMeasureData=function(){},c.getPartIdx=function(){return this.partIdx},c.getMeasureData=function(){throw new a("NotImplemented","The method `getMeasureData` is not implemented in `FakeMeasuresScroller`")}}.call(this),function(){"use strict";var a=Adagio.Utils.clone,b=Adagio.Utils.attributesUtils,c=Adagio.Utils.timeUtils,d=Adagio.edit.common.MeasuresScroller,e=Adagio.Data.VoicesList,f=Adagio.edit.common.PartData=function(a,b,c){this.init(a,b,c)},g=f.prototype;g.init=function(a,b,c){this.data=a,this.partIdx=b,this.scoreData=c,this.measuresScroller=null},g.getMeasure=function(a){return this.data.measure[a]},g.getAroundEnv=function(d){var f,g={};f=0===d?0:d-1;var h=this.data.measure[f],i=new e(h),j=i.getVoicesIndexes();g.voicesIndexes=j;var k=this.scoreData.getCommonContent(),l=k.getDisplayedTime(f);return l=c.copy(l),g.attributes=void 0===h.$adagio.attributes?{}:a(h.$adagio.attributes),b.setTime(g.attributes,[l]),g.sound=void 0===h.$adagio.sound?{}:a(h.$adagio.sound),g},g.getMeasureData=function(a){return this.getMeasuresScroller().getMeasureData(a)},g.getMeasuresScroller=function(){if(null===this.measuresScroller){var a=this.getMeasures();this.measuresScroller=new d(a,this.partIdx,this.scoreData)}return this.measuresScroller},g.getMeasures=function(){return this.data.measure},g.setEnv=function(a,b){var c=this.data.measure[a];c.attributes=b.attributes,void 0!==b.sound&&(c.sound=b.sound)},g.getFirstEnv=function(){var a=this.data.measure[0],b={attributes:a.attributes};return void 0!==a.sound&&(b.sound=a.sound),b},g.resetFirstMeasure=function(){var a=this.data.measure[0];delete a.attributes,delete a.sound},g.insertMeasure=function(a,b){this.data.measure.splice(b,0,a)},g.eraseMeasure=function(a){this.data.measure.splice(a,1)},g.getNbMeasures=function(){return this.getMeasures().length},g.getPartIdx=function(){return this.partIdx},g.getScoreData=function(){return this.scoreData}}.call(this),function(){"use strict";var a=Adagio.edit.common.PartData;Adagio.edit.common.initPartData=function(b,c){if(b instanceof a)this.partData=b;else{var d=b.getPartContent(c.partIdx);this.partData=new a(d,c.partIdx,b)}this.opts=c}}.call(this),function(){"use strict";var a=Adagio.edit.composite.FillVoiceWithRests,b=Adagio.edit.common.MeasureData,c=Adagio.edit.common.FakeMeasuresScroller,d=Adagio.edit.common.initPartData,e=Adagio.Utils.measureUtils,f=Adagio.Utils.clone,g=Adagio.edit.primitive.AddMeasure=function(a,b,c){this.init(a,b,c)};g.NAME="primitive.AddMeasure";var h=g.prototype;h.name=g.NAME,h.initPartData=d,h.init=function(a,b,c){this.initPartData(a,b),this.cancelStack=c,this.opts=b},h.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a=this.opts.measureIdx,d=this.partData.getAroundEnv(a);this.measure=this.buildMeasure(d,a);var e=this.partData.getScoreData(),f=new c(this.opts.partIdx);this.measureData=new b(this.measure,a,f,e),this.partData.insertMeasure(this.measure,a),this.updateStack(),this.insertVoicesRests(d),this.updateCrossMeasure(d)},h.buildMeasure=function(a,b){var c=this.createMeasure(a);if(0===b){var d=this.partData.getFirstEnv();this.partData.resetFirstMeasure(),c.attributes=d.attributes,d.sound&&(c.sound=d.sound)}return c},h.createMeasure=function(a){return{$adagio:a,note:[]}},h.updateStack=function(){var a={type:this.name,opts:{measureIdx:this.opts.measureIdx,partIdx:this.opts.partIdx}};this.cancelStack.push(a)},h.insertVoicesRests=function(a){a.voicesIndexes.forEach(this.insertVoiceRests,this)},h.insertVoiceRests=function(b){this.measureData.getVoicesList().insertVoice(b);var c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:b};new a(this.measureData,c).perform()},h.updateCrossMeasure=function(a){this.updatePedals(),this.updateWedges(),this.updateVoicesSlurs(a)},h.updatePedals=function(){for(var a=e.getNbStaves(this.measure),b=0;b<a;b++){if(this.hasLeftPedal(b)){var c=this.getLeftPedal(b);c=f(c),e.setLeftPedal(this.measure,b,c)}if(this.hasRightPedal(b)){var d=this.getRightPedal(b);d=f(d),e.setRightPedal(this.measure,b,d)}}},h.hasLeftPedal=function(a){if(!this.hasRightMeasure())return!1;var b=this.getRightMeasure();return e.hasLeftPedal(b,a)},h.hasRightPedal=function(a){if(!this.hasLeftMeasure())return!1;var b=this.getLeftMeasure();return e.hasRightPedal(b,a)},h.getLeftPedal=function(a){var b=this.getRightMeasure();return e.getLeftPedal(b,a)},h.getRightPedal=function(a){var b=this.getLeftMeasure();return e.getRightPedal(b,a)},h.updateWedges=function(){for(var a=e.getNbStaves(this.measure),b=0;b<a;b++){if(this.hasLeftWedge(b)){var c=this.getLeftWedge(b);c=f(c),e.setLeftWedge(this.measure,b,c)}if(this.hasRightWedge(b)){var d=this.getRightWedge(b);d=f(d),e.setRightWedge(this.measure,b,d)}}},h.hasLeftWedge=function(a){if(!this.hasRightMeasure())return!1;var b=this.getRightMeasure();return e.hasLeftWedge(b,a)},h.hasRightWedge=function(a){if(!this.hasLeftMeasure())return!1;var b=this.getLeftMeasure();return e.hasRightWedge(b,a)},h.getLeftWedge=function(a){var b=this.getRightMeasure();return e.getLeftWedge(b,a)},h.getRightWedge=function(a){var b=this.getLeftMeasure();return e.getRightWedge(b,a)},h.updateVoicesSlurs=function(a){a.voicesIndexes.forEach(this.updateVoiceSlur,this)},h.updateVoiceSlur=function(a){if(this.hasLeftSlur(a)){var b=this.getLeftSlur(a);b=f(b),e.setLeftSlur(this.measure,a,b)}if(this.hasRightSlur(a)){var c=this.getRightSlur(a);c=f(c),e.setRightSlur(this.measure,a,c)}},h.hasLeftSlur=function(a){if(!this.hasRightMeasure())return!1;var b=this.getRightMeasure();return e.hasLeftSlur(b,a)},h.hasRightSlur=function(a){if(!this.hasLeftMeasure())return!1;var b=this.getLeftMeasure();return e.hasRightSlur(b,a)},h.getLeftSlur=function(a){var b=this.getRightMeasure();return e.getLeftSlur(b,a)},h.getRightSlur=function(a){var b=this.getLeftMeasure();return e.getRightSlur(b,a)},h.hasLeftMeasure=function(){return this.opts.measureIdx>0},h.getLeftMeasure=function(){return this.partData.getMeasure(this.opts.measureIdx-1)},h.hasRightMeasure=function(){var a=this.partData.getNbMeasures();return this.opts.measureIdx+1<a},h.getRightMeasure=function(){return this.partData.getMeasure(this.opts.measureIdx+1)}}.call(this),function(){"use strict";var a=Adagio.edit.common.initPartData,b=Adagio.edit.primitive.RemoveMeasure=function(a,b,c){this.init(a,b,c)};b.NAME="primitive.RemoveMeasure";var c=b.prototype;c.name=b.NAME,c.initPartData=a,c.init=function(a,b,c){this.initPartData(a,b),this.cancelStack=c,this.opts=b},c.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.updateStack(),this.erase(this.opts.measureIdx)},c.updateStack=function(){var a={type:this.name,opts:{measureIdx:this.opts.measureIdx,partIdx:this.opts.partIdx}};this.cancelStack.push(a)},c.erase=function(a){if(0===a){var b=this.partData.getFirstEnv();this.partData.setEnv(1,b)}this.partData.eraseMeasure(a)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.edit.primitive.AddMeasure,c=Adagio.edit.primitive.RemoveMeasure,d=Adagio.updater.UpdateType;Adagio.updater.cancelStack.extractUpdateActionFromNode=function(b){var c,d,f=b.type,g=b.opts.measureIdx;if("number"!=typeof g)throw c="The measureIdx ["+g+"] is invalid for the action ["+f+"]. ",d=new a("MissingMeasureIdx",c),d.actionName=f,d;var h=b.opts.partIdx;if("number"!=typeof h)throw c="The partIdx ["+h+"] is invalid for the action ["+h+"]. ",d=new a("MissingPartIdx",c),d.actionName=f,d;return{type:e(b),displayLocation:{measureIdx:b.opts.measureIdx,partIdx:b.opts.partIdx}}};var e=function(a){return a.type===b.NAME?d.ADD:a.type===c.NAME?d.REMOVE:d.UPDATE}}.call(this),function(){"use strict";var a=Adagio.updater.UpdateType;Adagio.updater.cancelStack.removeObviousRedundantUpdates=function(a){var c=new b(a);return c.filter(),c.getFilteredActions()};var b=function(a){this.init(a)},c=b.prototype;c.init=function(a){this.actions=a,this.filteredActions=[],this.updatesBuffer=[],this.locationMap={}},c.filter=function(){this.actions.forEach(this.addAction,this),this.flushUpdates()},c.addAction=function(b){var c=b.type;c===a.ADD||c===a.REMOVE?(this.flushUpdates(),this.addNonUpdate(b)):c===a.UPDATE?this.addUpdate(b):a.raiseError(b.type)},c.addUpdate=function(a){var b=d(a.displayLocation);this.hasLocation(b)||this.recordUpdate(b,a)};var d=function(a){return a.partIdx+"/"+a.measureIdx};c.hasLocation=function(a){return void 0!==this.locationMap[a]},c.recordUpdate=function(a,b){this.locationMap[a]=!0,this.updatesBuffer.push(b)},c.flushUpdates=function(){Array.prototype.push.apply(this.filteredActions,this.updatesBuffer),this.updatesBuffer=[],this.locationMap={}},c.addNonUpdate=function(a){this.filteredActions.push(a)},c.getFilteredActions=function(){return this.filteredActions}}.call(this),function(){"use strict";var a=Adagio.updater.UpdateType;Adagio.updater.cancelStack.collapseAddRemoveColumns=function(a){var c=new b(a);return c.filter(),c.getFilteredActions()};var b=function(a){this.init(a)},c=b.prototype;c.init=function(a){this.actions=a,this.filteredActions=[],this.buffer=null},c.filter=function(){this.actions.forEach(this.addAction,this),this.flushBuffer()},c.addAction=function(a){this.isTypeChange(a)?(this.flushBuffer(),this.createBuffer(a)):this.buffer.processAction(a)},c.isTypeChange=function(a){return null===this.buffer||this.buffer.isChange(a)},c.flushBuffer=function(){if(null!==this.buffer){var a=this.buffer.dump();Array.prototype.push.apply(this.filteredActions,a),this.buffer=null}},c.createBuffer=function(b){b.type===a.REMOVE?this.buffer=new d(b):b.type===a.ADD?this.buffer=new f(b):b.type===a.UPDATE?this.buffer=new i(b):a.raiseError(b.type)},c.getFilteredActions=function(){return this.filteredActions};var d=function(a){this.init(a)},e=d.prototype;e.init=function(a){var b=h(a);this.actions=[b]},e.isChange=function(b){return b.type!==a.REMOVE||0===b.displayLocation.partIdx},e.processAction=function(){},e.dump=function(){return this.actions};var f=function(a){this.init(a)},g=f.prototype;g.init=function(a){var b=h(a);this.actions=[b]};var h=function(a){return{displayLocation:{measureIdx:a.displayLocation.measureIdx},type:a.type}};g.isChange=function(b){return b.type!==a.ADD||0===b.displayLocation.partIdx},g.processAction=function(){},g.dump=function(){return this.actions};var i=function(a){this.init(a)},j=i.prototype;j.init=function(a){this.actions=[a]},j.isChange=function(b){return b.type!==a.UPDATE},j.processAction=function(a){this.actions.push(a)},j.dump=function(){return this.actions}}.call(this),function(){"use strict";var a=Adagio.updater.UpdateType;Adagio.updater.cancelStack.extractData=function(d,e,f){return f===a.UPDATE?c(d,e.partIdx,e.measureIdx):f===a.ADD?b(d,e.measureIdx):void 0};var b=function(a,b){for(var d=[],e=a.getNbParts(),f=0;f<e;f++){var g=c(a,f,b);d.push(g)}return d},c=function(a,b,c){return a.getMeasureDisplayData(b,c)}}.call(this),function(){"use strict";var a=Adagio.updater.UpdateType,b=Adagio.updater.cancelStack.ColumnMerger=function(a){this.init(a)},c=b.prototype;c.init=function(a){this.srcActions=a,this.mergedActions=[],this.columnsActions={}},c.merge=function(){return this.srcActions.forEach(this.addAction,this),this.pushColumnsActions(),this.mergedActions},c.addAction=function(a){d(a)?this.addToColumn(a):(this.pushColumnsActions(),this.mergedActions.push(a))},c.addToColumn=function(a){var b=a.displayLocation.measureIdx;void 0===this.columnsActions[b]&&(this.columnsActions[b]=[]),this.columnsActions[b].push(a)};var d=function(b){return b.type===a.UPDATE};c.pushColumnsActions=function(){for(var b in this.columnsActions){var c=this.columnsActions[b],d={actions:c,type:a.UPDATE};this.mergedActions.push(d)}this.columnsActions={}}}.call(this),function(){"use strict";var a=Adagio.updater.replayFilter.IdGenerator=function(){this.init()},b=a.prototype;b.init=function(){this.number=0},b.getId=function(){var a=this.number;return this.number++,a}}.call(this),function(){"use strict";Adagio.updater.replayFilter.getIdToIdx=function(b){var c={};return b.forEach(a,c),c};var a=function(a,b){this[a]=b}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.updater.UpdateType,c=Adagio.updater.replayFilter.IdGenerator,d=Adagio.updater.replayFilter.getIdToIdx;Adagio.updater.replayFilter.replayActions=function(a,b){var c=new e(a,b);return c.replay(),c.getResult()};var e=function(a,b){this.init(a,b)},f=e.prototype;f.init=function(a,b){this.actions=a,this.wrappedActions=[],this.idGenerator=new c,this.addedIds={},this.removedIds={},this.initialIds={},this.initialIdToIdx=null,this.finalIdToIdx=null,this.measures=[],this.initialMeasures=[],this.initMeasures(b)},f.initMeasures=function(a){for(var b=0;b<a;b++){var c=this.getId();this.measures.push(c),this.initialIds[c]=!0}this.initialMeasures=this.measures.slice()},f.replay=function(){this.replayActions(),this.initialIdToIdx=d(this.initialMeasures),this.finalIdToIdx=d(this.measures)},f.replayActions=function(){this.actions.forEach(this.replayAction,this)},f.replayAction=function(a){var b=this.applyAction(a),c=g(b,a);this.wrappedActions.push(c)};var g=function(a,b){return{id:a,action:b}};f.applyAction=function(a){var c=a.type;return c===b.UPDATE?this.applyUpdate(a):c===b.ADD?this.applyAdd(a):c===b.REMOVE?this.applyRemove(a):void b.raiseError(c)},f.applyUpdate=function(a){var b=a.displayLocation.measureIdx;return this.checkGetIdx(b),this.measures[b]},f.applyRemove=function(a){var b=a.displayLocation.measureIdx;this.checkGetIdx(b);var c=this.measures[b];return this.measures.splice(b,1),this.removedIds[c]=!0,c},f.checkGetIdx=function(b){if("number"!=typeof b||b<0||b>=this.measures.length){throw new a("BadMeasureIdx","The measure idx ["+b+"] is outside autorized range.")}},f.applyAdd=function(a){var b=a.displayLocation.measureIdx;this.checkInsertionIdx(b);var c=this.getId();return this.measures.splice(b,0,c),this.addedIds[c]=!0,c},f.checkInsertionIdx=function(b){if("number"!=typeof b||b<0||b>this.measures.length){throw new a("BadMeasureIdx","The measure insertion idx ["+b+"] is outside autorized range.")}},f.getId=function(){return this.idGenerator.getId()},f.getResult=function(){return{wrappedActions:this.wrappedActions,addedIds:this.addedIds,removedIds:this.removedIds,initialIds:this.initialIds,initialMeasures:this.initialMeasures,finalMeasures:this.measures,initialIdToIdx:this.initialIdToIdx,finalIdToIdx:this.finalIdToIdx}}}.call(this),function(){"use strict";var a=Adagio.updater.UpdateType
;Adagio.updater.replayFilter.filterRemovedActions=function(a,c,d){var e=new b(a,c,d);return e.filterRemovedActions(),e.getWrappedActions()};var b=function(a,b,c){this.init(a,b,c)},c=b.prototype;c.init=function(a,b,c){this.wrappedActions=a,this.initialIds=b,this.removedIds=c},c.filterRemovedActions=function(){this.wrappedActions=this.wrappedActions.filter(this.isActionNotRemoved,this)},c.isActionNotRemoved=function(b){var c=b.id;return!this.isIdRemoved(c)||!(b.action.type!==a.REMOVE||!this.isIdInitial(c))},c.isIdInitial=function(a){return!0===this.initialIds[a]},c.isIdRemoved=function(a){return!0===this.removedIds[a]},c.getWrappedActions=function(){return this.wrappedActions}}.call(this);(function(){"use strict";var a=Adagio.updater.UpdateType;Adagio.updater.replayFilter.filterAddedActions=function(a,c){var d=new b(a,c);return d.filterAddedActions(),d.getWrappedActions()};var b=function(a,b){this.init(a,b)},c=b.prototype;c.init=function(a,b){this.wrappedActions=a,this.addedIds=b},c.filterAddedActions=function(){this.wrappedActions=this.wrappedActions.filter(this.isActionNotAdded,this)},c.isActionNotAdded=function(b){var c=b.id;return!this.isIdAdded(c)||b.action.type!==a.UPDATE},c.isIdAdded=function(a){return!0===this.addedIds[a]},c.getWrappedActions=function(){return this.wrappedActions}}).call(this),function(){"use strict";var a=Adagio.updater.UpdateType;Adagio.updater.replayFilter.filterRedundantUpdates=function(a){var c={};return a.filter(b,c)};var b=function(b){if(b.action.type!==a.UPDATE)return!0;var d=this,e=c(b);return void 0===d[e]&&(d[e]=!0,!0)},c=function(a){return a.action.displayLocation.partIdx+"/"+a.id}}.call(this),function(){"use strict";var a=Adagio.Utils.typeUtils,b=Adagio.updater.UpdateType;Adagio.updater.replayFilter.splitByOperation=function(d){var e=a.pairsToMap([{key:b.ADD,value:[]},{key:b.REMOVE,value:[]},{key:b.UPDATE,value:[]}]);return d.forEach(c,e),e};var c=function(a){var c=a.action.type,d=this;c===b.ADD?d[b.ADD].push(a):c===b.REMOVE?d[b.REMOVE].push(a):c===b.UPDATE?d[b.UPDATE].push(a):b.raiseError(c)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError;Adagio.updater.replayFilter.compareWrappedActionsDec=function(a,c){var d=this;return-(b(d,a)-b(d,c))};var b=function(b,c){var d=c.id;if(void 0===b[d]){throw new a("BadMeasureId","There is no index for the measure id ["+d+"]")}return b[d]}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError;Adagio.updater.replayFilter.fixAddsDisplayIndexes=function(a,c,d){new b(a,c,d).fixDisplayLocations()};var b=function(a,b,c){this.init(a,b,c)},c=b.prototype;c.init=function(a,b,c){this.srcAdds=a.slice(),this.initialIdToIdx=c,this.finalMeasures=b.slice(),this.finalMeasures.reverse(),this.buffer=[]},c.fixDisplayLocations=function(){if(this.finalMeasures.forEach(this.addMeasure,this),this.setDisplayIdx(0),this.srcAdds.length>0){throw new a("RemainingActions","At this point there should be no add actions not processed.")}},c.addMeasure=function(a){this.isInitialMeasure(a)?(this.setDisplayIdxFromId(a),this.flush()):this.addActionToBuffer(a)},c.isInitialMeasure=function(a){return void 0!==this.initialIdToIdx[a]},c.setDisplayIdxFromId=function(a){var b=this.getInitialIdxFromId(a),c=b+1;this.setDisplayIdx(c)},c.getInitialIdxFromId=function(b){if(this.isInitialMeasure(b))return this.initialIdToIdx[b];throw new a("BadMeasureId","The measure id ["+b+"] is invalid.")},c.setDisplayIdx=function(a){this.buffer.forEach(d,a)};var d=function(a){var b=this.valueOf();a.action.displayLocation.measureIdx=b};c.flush=function(){this.buffer=[]},c.addActionToBuffer=function(b){var c;if(0===this.srcAdds.length)throw c="There should be remaining actions.",new a("NoMoreActions",c);var d=this.srcAdds.shift();if(b!==d.id)throw c="The measure id ["+b+"] do not match the action measure id ["+d.id+"].",new a("MeasureIdMissmatch",c);this.buffer.push(d)},c.getWrappedAdds=function(){return this.destAdds}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError;Adagio.updater.replayFilter.fixUpdatesDisplayIndexes=function(a,c){a.forEach(b,c)};var b=function(a){var b=a.id,d=this,e=c(d,b);a.action.displayLocation.measureIdx=e},c=function(b,c){if(void 0===b[c]){throw new a("BadMeasureId","There is no measure index for the id ["+c+"]")}return b[c]}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError;Adagio.updater.replayFilter.fixRemovesDisplayIndexes=function(a,c,d){new b(a,c,d).fixDisplayLocations()};var b=function(a,b,c){this.init(a,b,c)},c=b.prototype;c.init=function(a,b,c){this.wrappedRemoves=a,this.removedIds=c,this.intermediateMeasures=b,this.actionIdx=0},c.fixDisplayLocations=function(){for(var b=this.intermediateMeasures.length,c=b-1;c>=0;c--){var d=this.intermediateMeasures[c];this.isMeasureRemoved(d)&&this.fillDisplayIdx(d,c)}if(this.actionIdx!==this.wrappedRemoves.length){throw new a("RemainingActions","At this point, all remove actions should have been processed.")}},c.isMeasureRemoved=function(a){return!0===this.removedIds[a]},c.fillDisplayIdx=function(b,c){var d;if(this.actionIdx>=this.wrappedRemoves.length)throw d="There should be remaining actions at this point.",new a("Missing action",d);var e=this.wrappedRemoves[this.actionIdx];if(e.id!==b)throw d="The measure id ["+b+"] do not match the action measure id ["+e.id+"].",new a("MeasureIdMissmatch",d);e.action.displayLocation.measureIdx=c,this.actionIdx++}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.updater.UpdateType;Adagio.updater.replayFilter.replayWrappedActions=function(a,b){var d=a.slice();return b.forEach(c,d),d};var c=function(a){var c=this,f=a.action.type;f===b.UPDATE?d(a,c):f===b.ADD?e(a,c):f===b.REMOVE?g(a,c):b.raiseError(f)},d=function(b,c){var d=b.id,e=b.action.displayLocation.measureIdx;h(c,e);var f=c[e];if(d!==f){throw new a("MeasureIdMissmatch","The action id ["+d+"] do not match the measure id ["+f+"].")}},e=function(a,b){var c=a.id,d=a.action.displayLocation.measureIdx;f(b,d),b.splice(d,0,c)},f=function(b,c){if(c<0||c>b.length){throw new a("BadInsertIdx","The measure insertion idx ["+c+"] is out of range.")}},g=function(b,c){var d=b.id,e=b.action.displayLocation.measureIdx;h(c,e);var f=c[e];if(d!==f){throw new a("MeasureIdMissmatch","The action id ["+d+"] do not match the measure id ["+f+"].")}c.splice(e,1)},h=function(b,c){if(c<0||c>=b.length){throw new a("BadGetIdx","The measure idx ["+c+"] is out of range.")}}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.updater.UpdateType,c=Adagio.updater.replayFilter.splitByOperation,d=Adagio.updater.replayFilter.compareWrappedActionsDec,e=Adagio.updater.replayFilter.fixAddsDisplayIndexes,f=Adagio.updater.replayFilter.fixUpdatesDisplayIndexes,g=Adagio.updater.replayFilter.fixRemovesDisplayIndexes,h=Adagio.updater.replayFilter.getIdToIdx,i=Adagio.updater.replayFilter.replayWrappedActions;Adagio.updater.replayFilter.fixDisplayIndexes=function(a,k){var l=c(a),m=l[b.ADD];m.sort(d.bind(k.finalIdToIdx)),e(m,k.finalMeasures,k.initialIdToIdx);var n=i(k.initialMeasures,m),o=h(n),p=l[b.REMOVE];p.sort(d.bind(o)),g(p,n,k.removedIds);var q=i(n,p),r=l[b.UPDATE];f(r,k.finalIdToIdx);var s=i(q,r);return j(s,k.finalMeasures),a=[].concat(m,p,r)};var j=function(b,c){var d,e=b.length;if(e!==c.length)throw d="The number of measures after the refinement is different than before.",new a("BadNbMeasures",d);for(var f=0;f<e;f++){if(b[f]!==c[f])throw d="One of the measure id after the refinement is different that before.",new a("BadMeasureId",d)}}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.clone,c=Adagio.updater.UpdateType;Adagio.updater.replayFilter.fillRealLocations=function(a,b){new d(a,b).fillRealLocations()};var d=function(a,b){this.init(a,b)},e=d.prototype;e.init=function(a,b){this.wrappedActions=a,this.idToIdx=b},e.fillRealLocations=function(){this.wrappedActions.forEach(this.fillRealLocation,this)},e.fillRealLocation=function(a){if(a.action.type!==c.REMOVE){var b=a.id,d=this.getMeasureIdxForId(b),e=a.action,g=e.displayLocation,h=f(g,d);e.realLocation=h}},e.getMeasureIdxForId=function(b){if(void 0!==this.idToIdx[b])return this.idToIdx[b];throw new a("BadMeasureId","There is no measure index for the id ["+b+"].")};var f=function(a,c){var d=b(a);return d.measureIdx=c,d}}.call(this),function(){"use strict";var a=Adagio.updater.replayFilter.replayActions,b=Adagio.updater.replayFilter.filterRemovedActions,c=Adagio.updater.replayFilter.filterAddedActions,d=Adagio.updater.replayFilter.filterRedundantUpdates,e=Adagio.updater.replayFilter.fixDisplayIndexes,f=Adagio.updater.replayFilter.fillRealLocations;Adagio.updater.replayFilter.replayFilter=function(h,i){var j=a(h,i),k=j.wrappedActions;return k=b(k,j.initialIds,j.removedIds),k=c(k,j.addedIds),k=d(k),k=e(k,j),f(k,j.finalIdToIdx),h=k.map(g)};var g=function(a){return a.action}}.call(this),function(){"use strict";var a=Adagio.Utils.cancelStackUtils,b=Adagio.updater.cancelStack.extractData,c=Adagio.updater.cancelStack.ColumnMerger,d=Adagio.updater.cancelStack.extractUpdateActionFromNode,e=Adagio.updater.cancelStack.removeObviousRedundantUpdates,f=Adagio.updater.cancelStack.collapseAddRemoveColumns,g=Adagio.updater.replayFilter.replayFilter,h=Adagio.updater.cancelStack.UpdateActionsExtractor=function(a){this.init(a)},i=h.prototype;i.init=function(a){this.scoreDataCache=a},i.extract=function(b,c){this.scoreDataCache.stateDataChanged(),this.scoreDataCache.stateUpdated();var h=a.extractDrawActions(b),i=h.map(d);return i=e(i),i=f(i),i=g(i,c),this.fillActionsData(i),i=this.mergeColumn(i)},i.fillActionsData=function(a){a.forEach(this.fillActionData,this)},i.fillActionData=function(a){var c=b(this.scoreDataCache,a.realLocation,a.type);a.data=c},i.mergeColumn=function(a){return a=new c(a).merge()}}.call(this),function(){"use strict";var a=Adagio.Render.MeasureRenderer,b=Adagio.updater.track.MeasureInserter=function(a){this.init(a)},c=b.prototype;c.init=function(b){this.scoreShard=b;var c=b.getDrawingContext(),d=c.getMeasureRendererOpts();this.measureRenderer=new a(d)},c.perform=function(a,b){var c=a.displayLocation.measureIdx,e=a.data,f=this.createScoreMeasure(e),g=this.scoreShard;g.insertMeasure(f,c),g.updateMeasureHorzontalDisplay(c);var h=a.realLocation.measureIdx;b.recordMoveMeasuresFrom(h),b.recordAllSystemIndexes(),d(b,f,h)},c.createScoreMeasure=function(a){return a.map(this.createSystemMeasure,this)},c.createSystemMeasure=function(a){return this.measureRenderer.renderMeasure(a)};var d=function(a,b,c){var d=b;Array.prototype.concat.apply([],d).forEach(function(b){a.recordAddedMeasure(b,c)})}}.call(this),function(){"use strict";var a=Adagio.updater.track.MeasureRemover=function(a){this.init(a)},b=a.prototype;b.init=function(a){this.scoreShard=a},b.perform=function(a,b){var c=a.displayLocation.measureIdx;this.scoreShard.removeMeasure(c),b.recordMoveMeasuresFrom(c),b.recordAllSystemIndexes()}}.call(this),function(){"use strict";var a=Adagio.Render.MeasureRenderer,b=Adagio.updater.track.MeasureUpdater=function(a){this.init(a)},c=b.prototype;c.init=function(b){this.scoreShard=b;var c=b.getDrawingContext(),d=c.getMeasureRendererOpts();this.measureRenderer=new a(d)},c.perform=function(a,b){var c=a.displayLocation.partIdx;b.recordSystemIdx(c);var e=a.displayLocation.measureIdx,f=a.data,g=this.createSystemMeasure(f);this.scoreShard.replaceSystemMeasure(c,e,g);var h=a.realLocation.measureIdx;d(b,g,h)},c.createSystemMeasure=function(a){return this.measureRenderer.renderMeasure(a)};var d=function(a,b,c){b.forEach(function(b){a.recordAddedMeasure(b,c)})}}.call(this),function(){"use strict";var a=Adagio.updater.track.MeasureUpdater,b=Adagio.updater.track.MeasureColumnUpdater=function(a){this.init(a)},c=b.prototype;c.init=function(a){this.scoreShard=a},c.perform=function(b,c){var d=this.scoreShard;b.actions.forEach(function(b){new a(d).perform(b,c)});var e=b.actions[0].displayLocation.measureIdx;d.updateMeasureHorzontalDisplay(e);var f=b.actions[0].realLocation.measureIdx;c.recordMoveMeasuresFrom(f),c.recordMeasureIdx(f)}}.call(this),function(){"use strict";var a=Adagio.Utils.mapUtils;Adagio.updater.track.extractGeometries=function(a,c,d){var e=new b(a);return e.addSystemLocations(c),e.addMeasureLocations(d),e.getGeometries()};var b=function(a){this.init(a)},c=b.prototype;c.init=function(a){this.scoreShard=a,this.locationsMap={}},c.addSystemLocations=function(a){a.forEach(this.addSystemLocation,this)},c.addSystemLocation=function(a){for(var b=this.scoreShard.getNbMeasures(),c=0;c<b;c++)this.addLocation(a,c)},c.addMeasureLocations=function(a){a.forEach(this.addMeasureLocation,this)},c.addMeasureLocation=function(a){for(var b=this.scoreShard.getNbSystems(),c=0;c<b;c++)this.addLocation(c,a)},c.addLocation=function(a,b){var c=d(a,b);if(void 0===this.locationsMap[c]){var f=e(a,b);this.locationsMap[c]=f}};var d=function(a,b){return a+"-"+b},e=function(a,b){return{systemIdx:a,measureIdx:b}};c.getGeometries=function(){var b=a.getValues(this.locationsMap),c=b.map(this.locationToGeometriesArray,this);return Array.prototype.concat.apply([],c)},c.locationToGeometriesArray=function(a){var b=a.systemIdx,c=a.measureIdx;return this.scoreShard.getSystemMeasureGeometry(b,c)}}.call(this),function(){"use strict";var a=Adagio.Utils.math,b=Adagio.updater.track.extractGeometries,c=Adagio.updater.track.Formatter=function(a){this.init(a)},d=c.prototype;d.init=function(a){this.scoreShard=a,this.addedMeasuresByMeasureIdx={},this.updatedSystemsIdx={},this.updatedMeasureIdx={},this.moveMeasuresFromIdx=null,this.moveSystemsFromIdx=null},d.recordMoveMeasuresFrom=function(a){null===this.moveMeasuresFromIdx?this.moveMeasuresFromIdx=a:this.moveMeasuresFromIdx=Math.min(this.moveMeasuresFromIdx,a)},d.recordAllSystemIndexes=function(){for(var a=this.scoreShard.getNbSystems(),b=0;b<a;b++)this.recordSystemIdx(b)},d.recordSystemIdx=function(a){this.updatedSystemsIdx[a]=!0},d.recordMeasureIdx=function(a){this.updatedMeasureIdx[a]=!0},d.recordAddedMeasure=function(a,b){void 0===this.addedMeasuresByMeasureIdx[b]&&(this.addedMeasuresByMeasureIdx[b]=[]),this.addedMeasuresByMeasureIdx[b].push(a)},d.format=function(){this.hasValidMoveMeasuresFromIdx()&&(this.scoreShard.moveMeasures(this.moveMeasuresFromIdx),this.scoreShard.updateMeasureNumbers(this.moveMeasuresFromIdx)),this.scoreShard.updateStaffLines(),this.reloadSystemsCrossMeasures(),this.scoreShard.updateCrossMeasuresHorizontalDisplay(),this.updateSystemsVerticalDisplay(),this.moveSystems(),this.scoreShard.updateVerticalLine(),this.scoreShard.moveHeaders(),this.drawMeasures()},d.hasValidMoveMeasuresFromIdx=function(){if(null===this.moveMeasuresFromIdx)return!1;var a=this.scoreShard.getNbMeasures();return!(this.moveMeasuresFromIdx>=a)},d.reloadSystemsCrossMeasures=function(){this.forEachUpdatedSystem(this.reloadSystemCrossMeasures,this)},d.reloadSystemCrossMeasures=function(a){this.scoreShard.reloadSystemCrossMeasures(a)},d.updateSystemsVerticalDisplay=function(){this.forEachUpdatedSystem(this.updateSystemVerticalDisplay,this)},d.updateSystemVerticalDisplay=function(a){var b=this.scoreShard.getSystemHeight(a);this.scoreShard.updateSystemVerticalDisplay(a),this.scoreShard.getSystemHeight(a)!==b&&this.recordSystemUpdateFrom(a+1)},d.forEachUpdatedSystem=function(a,b){for(var c in this.updatedSystemsIdx)c=parseInt(c,10),a.call(b,c)},d.recordSystemUpdateFrom=function(a){null===this.moveSystemsFromIdx?this.moveSystemsFromIdx=a:this.moveSystemsFromIdx=Math.min(this.moveSystemsFromIdx,a)},d.moveSystems=function(){if(null!==this.moveSystemsFromIdx){var a=this.scoreShard.getNbSystems();this.moveSystemsFromIdx>=a||this.scoreShard.moveSystems(this.moveSystemsFromIdx)}},d.drawMeasures=function(){var b=Object.keys(this.addedMeasuresByMeasureIdx);b=b.map(a.intPart),b.sort(a.cmpReverse),b.forEach(this.drawMeasureColumn,this)},d.drawMeasureColumn=function(a){this.scoreShard.dispatchInsertionPoint(a),this.addedMeasuresByMeasureIdx[a].forEach(e)};var e=function(a){a.draw()};d.getGeometries=function(){var c=Object.keys(this.updatedSystemsIdx);c=c.map(a.intPart);var d=Object.keys(this.updatedMeasureIdx);return d=d.map(a.intPart),b(this.scoreShard,c,d)}}.call(this),function(){"use strict";var a=Adagio.updater.UpdateType,b=Adagio.updater.cancelStack.UpdateActionsExtractor,c=Adagio.updater.track.MeasureInserter,d=Adagio.updater.track.MeasureRemover,e=Adagio.updater.track.MeasureColumnUpdater,f=Adagio.updater.track.Formatter,g={};g[a.ADD]=c,g[a.REMOVE]=d,g[a.UPDATE]=e;var h=Adagio.updater.track.TrackDisplayUpdater=function(a,b){this.init(a,b)},i=h.prototype;i.init=function(a,c){this.trackLayout=c;var d=c.getScoreDataCache();this.updateActionsExtractor=new b(d),this.formatter=null,this.actions=null},i.update=function(a){this.reset(),this.extractActions(a),this.performActions(),this.format(),this.trackLayout.updateSvgSize()},i.reset=function(){this.formatter=null,this.actions=null},i.extractActions=function(a){var b=this.trackLayout.getScoreShard(),c=b.getNbMeasures();this.actions=this.updateActionsExtractor.extract(a,c)},i.performActions=function(){var a=this.trackLayout.getScoreShard();this.formatter=new f(a),this.actions.forEach(this.performAction,this)},i.performAction=function(a){this.getUpdater(a.type).perform(a,this.formatter,this.cancelStack)},i.getUpdater=function(a){var b=this.trackLayout.getScoreShard();return new(j(a))(b)};var j=function(a){return g[a]};i.format=function(){this.formatter.format()},i.getGeometries=function(){return this.formatter.getGeometries()},i.getRemovedPagesIndexes=function(){return[]}}.call(this),function(){"use strict";var a=Adagio.Render.MeasureRenderer,b=Adagio.page.MeasureColumn,c=Adagio.updater.page.measureColumns.MeasureInserter=function(a,b){this.init(a,b)},d=c.prototype;d.init=function(b,c){this.measuresContainer=b,this.drawingContext=c;var d=c.getMeasureRendererOpts();this.measureRenderer=new a(d)},d.perform=function(a,b){var c=a.realLocation.measureIdx;b.logUpdateMeasureIdxFrom(c);var d=a.data,f=this.createMeasureColumn(d);e(b,f);var g=a.displayLocation.measureIdx;if(this.measuresContainer.insertMeasure(f,g),this.measuresContainer.isMeasureInSlice(g)){var h=this.measuresContainer.getMeasuresSliceIdxFromMeasureIdx(g);b.logMeasuresSliceIdx(h)}},d.createMeasureColumn=function(a){var c=this.createScoreMeasure(a),d=new b;return d.setSystems(c),d.setDrawingContext(this.drawingContext),d.measureNumberShift=a[0].nbMmr||1,d},d.createScoreMeasure=function(a){return a.map(this.createSystemMeasure,this)},d.createSystemMeasure=function(a){var b=this.measureRenderer.renderMeasure(a);return b.forEach(this.renderStaffMeasure,this),b},d.renderStaffMeasure=function(a){a.render(this.drawingContext)};var e=function(a,b){var c=b.getSystemsMeasure(),d=c;Array.prototype.concat.apply([],d).forEach(function(b){a.logAddedMeasure(b)})}}.call(this),function(){"use strict";var a=Adagio.updater.page.measureColumns.MeasureRemover=function(a){this.init(a)},b=a.prototype;b.init=function(a){this.measuresContainer=a},b.perform=function(a,b){var c=a.displayLocation.measureIdx;b.logUpdateMeasureIdxFrom(c);var d=this.measuresContainer.getMeasuresSliceIdxFromMeasureIdx(c);b.logMeasuresSliceIdx(d),this.measuresContainer.removeMeasureColumn(c)}}.call(this),function(){"use strict";var a=Adagio.Render.MeasureRenderer,b=Adagio.updater.page.measureColumns.MeasureUpdater=function(a,b){this.init(a,b)},c=b.prototype;c.init=function(a,b){this.measuresContainer=a,this.drawingContext=b},c.perform=function(a,b){var c=a.actions,e=c[0],f=e.displayLocation.measureIdx,g=e.realLocation.measureIdx,h=this.measuresContainer.getMeasureColumn(f);if(h.setDataIdx(g),c.forEach(function(a){var c=a.data,e=this.createSystemMeasure(c);if(d(b,e),h.canUpdateMeasureNumber()){var f=e[0],g=h.getDisplayIdx();h.shouldDisplayMeasureNumber()?f.updateMeasureNumber(g):f.removeMeasureNumber(g)}var i=a.displayLocation.partIdx;h.replaceMeasure(e,i)},this),h.hasMeasuresSlice()){var i=h.getMeasuresSliceIdx();b.logMeasuresSliceIdx(i)}},c.createSystemMeasure=function(b){var c=this.drawingContext.getMeasureRendererOpts(),d=new a(c),e=d.renderMeasure(b);return e.forEach(this.renderStaffMeasure,this),e},c.renderStaffMeasure=function(a){a.render(this.drawingContext)};var d=function(a,b){b.forEach(function(b){a.logAddedMeasure(b)})}}.call(this),function(){"use strict";var a=Adagio.updater.page.measureColumns.Logger=function(){this.init()},b=a.prototype;b.init=function(){this.updateMeasureIdxFrom=null,this.addedStaffMeasures=[],this.slicesIndexesSet={}},b.logAddedMeasure=function(a){this.addedStaffMeasures.push(a)},b.logUpdateMeasureIdxFrom=function(a){null===this.updateMeasureIdxFrom?this.updateMeasureIdxFrom=a:this.updateMeasureIdxFrom=Math.min(this.updateMeasureIdxFrom,a)},b.logMeasuresSliceIdx=function(a){this.slicesIndexesSet[a]=!0},b.getUpdateData=function(){return{updateMeasureIdxFrom:this.updateMeasureIdxFrom,addedStaffMeasures:this.addedStaffMeasures,slicesIndexesSet:this.slicesIndexesSet}}}.call(this),function(){"use strict";var a=Adagio.updater.UpdateType,b=Adagio.updater.page.measureColumns.MeasureInserter,c=Adagio.updater.page.measureColumns.MeasureRemover,d=Adagio.updater.page.measureColumns.MeasureUpdater,e=Adagio.updater.page.measureColumns.Logger,f={};f[a.ADD]=b,f[a.REMOVE]=c,f[a.UPDATE]=d;var g=Adagio.updater.page.measureColumns.MeasureColumnsUpdater=function(a,b){this.init(a,b)},h=g.prototype;h.init=function(a,b){this.measuresContainer=a,this.drawingContext=b,this.logger=null},h.update=function(a){return this.reset(),a.forEach(this.performAction,this),this.logger.getUpdateData()},h.reset=function(){this.logger=new e},h.performAction=function(a){this.getUpdater(a.type).perform(a,this.logger)},h.getUpdater=function(a){return new(i(a))(this.measuresContainer,this.drawingContext)};var i=function(a){return f[a]};h.format=function(){this.logger.format()}}.call(this),function(){"use strict";var a=Adagio.Utils.setUtils,b=Adagio.Utils.math;Adagio.updater.page.setToOrderedIndexes=function(c){var d=a.toList(c);return d=d.map(b.intPart),d.sort(b.cmp),d}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError;Adagio.updater.page.removeFirstEmptySlices=function(a,d){d.updateSliceIdxFrom=null;var h=d.slicesIndexes,i=b(a,h);if(0!==i){var j=c(a,i,d);e(a,j),f(h,i),g(h),d.updateSliceIdxFrom=0}};var b=function(a,b){var c=0,d=0;return b.some(function(b){return b!==d||(!a.getMeasuresSlice(b).isEmpty()||(d++,void c++))}),c},c=function(b,c,e){for(var f=null,g=0;g<c;g++){var h=b.getMeasuresSlice(0);h.isEmpty()&&(f=h.extractHeaders());h.getShardsIndexes().forEach(d,e),b.remove(0),e.slicesIndexes.shift()}if(null===f)throw new a("Unexpected");return f},d=function(a){this.shardIdxSet[a]=!0},e=function(a,b){var c=a.getMeasuresSlice(0);c.setIsFirst(!0),c.injectSystemsHeaders(b)},f=function(a,b){for(var c=a.length,d=0;d<c;d++)a[d]-=b},g=function(a){h(a)&&a.unshif(0)},h=function(a){return 0===a.length||0!==a[0]}}.call(this),function(){"use strict";Adagio.updater.page.reflowMeasures=function(b,c){for(var d=[],e=b.getNbSlices(),f=c.slicesIndexes,g=0;g<f.length;g++){var h=f[g],i=b.getMeasuresSlice(h);i.unshiftMeasures(d),i.needRecomputeUsedWidth()&&i.recomputeUsedWidth(),d=i.popOverflowMeasures(),d.length>0&&a(e,f,g)}};var a=function(a,c,d){if(b(a,c,d)){var e=c[d],f=e+1;c.splice(d+1,0,f)}},b=function(a,b,c){var d=b[c];return d+1!==a&&d+1!==b[c+1]}}.call(this),function(){"use strict";Adagio.updater.page.removeEmptySlices=function(c,d){d.updateSliceIdxFrom=null;for(var e=d.slicesIndexes,f=0,g=0;f<e.length;){e[f]-=g;var h=e[f],i=c.getMeasuresSlice(h);if(i.isEmpty()){i.getShardsIndexes().forEach(a,d),c.remove(h),e.splice(f,1),b(d,h),g++}else f++}};var a=function(a){this.shardIdxSet[a]=!0},b=function(a,b){null===a.updateSliceIdxFrom?a.updateSliceIdxFrom=b:a.updateSliceIdxFrom=Math.min(a.updateSliceIdxFrom,b)}}.call(this),function(){"use strict";Adagio.updater.page.updateSlicesDisplay=function(b,c){c.slicesIndexes.forEach(function(d){var e=b.getMeasuresSlice(d);e.refreshSystemsHeights(),e.bindMeasures(),e.getShardsIndexes().forEach(a,c)})};var a=function(a){this.shardIdxSet[a]=!0}}.call(this),function(){"use strict";Adagio.updater.page.updateSlicesStartMeasureIdx=function(a,b){var c,d=b.slicesIndexes;d.length>0&&(c=d[0]),null!==b.updateSliceIdxFrom&&(c=void 0===c?b.updateSliceIdxFrom:Math.min(c,b.updateSliceIdxFrom)),void 0!==c&&a.updateStartMeasureIdxFrom(c)}}.call(this),function(){"use strict";Adagio.updater.page.removeEmptyShards=function(b,c,d){c.updateShardIdxFrom=null;for(var e=c.shardsIndexes,f=0,g=0;f<e.length;){e[f]-=g;var h=e[f],i=b.getShard(h);if(i.isEmpty()){var j=i.getPageIdx();c.pageIdxSet[j]=!0,i.hasPageContent()||d.clearCache(),b.remove(h),e.splice(f,1),a(c,h),g++}else f++}};var a=function(a,b){null===a.updateShardIdxFrom?a.updateShardIdxFrom=b:a.updateShardIdxFrom=Math.min(a.updateShardIdxFrom,b)}}.call(this),function(){"use strict";var a=Adagio.page.formatter.formatHorizBasic;Adagio.updater.page.updateShardsDisplay=function(c,d,e,f,g){f.shardsIndexes.forEach(function(h){var i=c.getShard(h);if(i.hasPageContent()){var j=i.getPageContent(),k=j.getWidth();i.moveHeaders(),i.moveSystems(),i.height=null;var l=b(i,d,e);a(i,k,l),g&&i.autoUpdateVerticalDisplay(),i.updateVerticalLine();var m=i.getPageIdx();f.pageIdxSet[m]=!0}})};var b=function(a,b,c){return!c.hasUnbindedMeasures()&&b.isShardFromLastSlice(a)}}.call(this),function(){"use strict";Adagio.updater.page.removeEmptyPages=function(c,d){d.updatePageIdxFrom=null;for(var e=d.pagesIndexes,f=c.getPagesContainer(),g=0,h=0;g<e.length;){e[g]-=h;var i=e[g];f.getPage(i).isEmpty()?(c.removePage(i),a(d,i),b(d,i,h),h++,e.splice(g,1)):g++}};var a=function(a,b){null===a.updatePageIdxFrom?a.updatePageIdxFrom=b:a.updatePageIdxFrom=Math.min(a.updatePageIdxFrom,b)},b=function(a,b,c){var d=b+c;a.removedPagesIndexes.push(d)}}.call(this),function(){"use strict";Adagio.updater.page.updatePageIdx=function(a,b){var c=b.updatePageIdxFrom;if(null!==c){var d=a.getNbPages(),e=a.getHeaderProvider(),f=a.getPagesContainer();f.updatePageIdxFrom(c);for(var g=c;g<d;g++){var h=a.getPage(g),i=e.getPageHeader(g);if(h.swapHeader(i),0===g){f.getPage(g).setIsFirst(!0),h.format()}}}}}.call(this),function(){"use strict";Adagio.updater.page.refreshProviders=function(a){var b=a.getNbPages();a.getContentProvider().setPageIdx(b);var c=a.getNbSlices();a.getSliceProvider().setSliceIdx(c);var d=a.getNbShards();a.getShardProvider().setShardIdx(d);var e=a.getMeasureProvider(),f=a.getMeasuresContainer(),g=f.getUnbindedMeasures();e.handBackMeasures(g)}}.call(this),function(){"use strict";Adagio.updater.page.fillLastPage=function(c,d){var e=c.getContentProvider();if(e.hasRemaining()&&c.hasAnyPageContent()){var f=c.getLastContent();f.recomputeShardsHeight();var g=c.getNbSlices();e.fillPageContent(f);var h=c.getNbSlices();a(d.slicesIndexes,g,h);var i=f.getIdx();b(d.pagesIndexes,i)}};var a=function(a,b,c){for(var d=b;d<c;d++)a.push(d)},b=function(a,b){c(a,b)&&a.push(b)},c=function(a,b){var c=a.length;return 0===c||a[c-1]!==b}}.call(this),function(){"use strict";Adagio.updater.page.updatePagesDisplay=function(a,b){b.pagesIndexes.forEach(function(b){var c=a.getPage(b);c.recomputeShardsHeight(),c.updateVerticalDisplay()})}}.call(this),function(){"use strict";Adagio.updater.page.getGeometries=function(c,d){var e=d.slicesIndexes,f=e.map(a,c),g=f.map(b);return Array.prototype.concat.apply([],g)};var a=function(a){return this.getMeasuresSlice(a)},b=function(a){var b=a.getBindedShards(),d=b.map(c);return Array.prototype.concat.apply([],d)},c=function(a){return a.getAllMeasuresGeometries()}}.call(this),function(){"use strict";var a=Adagio.updater.cancelStack.UpdateActionsExtractor,b=Adagio.updater.page.measureColumns.MeasureColumnsUpdater,c=Adagio.updater.page.setToOrderedIndexes,d=Adagio.updater.page.removeFirstEmptySlices,e=Adagio.updater.page.reflowMeasures,f=Adagio.updater.page.removeEmptySlices,g=Adagio.updater.page.updateSlicesDisplay,h=Adagio.updater.page.updateSlicesStartMeasureIdx,i=Adagio.updater.page.removeEmptyShards,j=Adagio.updater.page.updateShardsDisplay,k=Adagio.updater.page.removeEmptyPages,l=Adagio.updater.page.updatePageIdx,m=Adagio.updater.page.refreshProviders,n=Adagio.updater.page.fillLastPage,o=Adagio.updater.page.updatePagesDisplay,p=Adagio.updater.page.getGeometries,q=Adagio.Values.DisplayScaling,r=Adagio.updater.page.PageDisplayUpdater=function(a,b){this.init(a,b)},s=r.prototype;s.init=function(c,d){this.pageLayout=d;var e=d.getScoreDataCache();this.updateActionsExtractor=new a(e);var f=d.getMeasuresContainer(),g=d.getDrawingContext();this.measureColumnsUpdater=new b(f,g),this.updateData=null},s.setScaling=function(a){q.assert(a);var b=this.pageLayout.getScaling();if(a!==b){this.pageLayout.scaling=a;var c=this.pageLayout.getWidth(),d=c*b/a;this.setWidth(d)}},s.setExternalWidth=function(a){a/=this.pageLayout.getScaling(),this.setWidth(a)},s.setWidth=function(a){this.pageLayout.setWidth(a),this.dropPending(),this.updateData=null;var b=this.pageLayout.getSlicesContainer(),c=b.getNbSlices(),d=t(c);d=this.updateSlices(d),d=this.updateShards(d,!0),d=this.updatePages(d),u(d),this.updateData=d,this.pageLayout.updatePagesSvgSize()};var t=function(a){for(var b={addedStaffMeasures:[],slicesIndexesSet:{},updateMeasureIdxFrom:null},c=0;c<a;c++)b.slicesIndexesSet[c]=!0;return b};s.update=function(a){this.dropPending(),this.updateData=null;var b=this.cancelStackToUpdateData(a);b=this.updateMeasures(b),b=this.updateSlices(b),b=this.updateShards(b),b=this.updatePages(b),u(b),this.updateData=b},s.dropPending=function(){this.pageLayout.getMeasureProvider().discardCache()},s.cancelStackToUpdateData=function(a){var b=this.pageLayout.getNbMeasures();return this.updateActionsExtractor.extract(a,b)},s.updateMeasures=function(a){var b=this.measureColumnsUpdater.update(a);return this.updateMeasureIdx(b),b},s.updateMeasureIdx=function(a){var b=a.updateMeasureIdxFrom;if(null!==b){this.pageLayout.getMeasuresContainer().updateMeasureNumberFrom(b)}},s.updateSlices=function(a){a.updateSliceIdxFrom=null,a.slicesIndexes=c(a.slicesIndexesSet),a.shardIdxSet={};var b=this.pageLayout.getSlicesContainer();return d(b,a),this.updateSliceIdx(a),e(b,a),f(b,a),this.updateSliceIdx(a),g(b,a),h(b,a),a},s.updateSliceIdx=function(a){var b=a.updateSliceIdxFrom;if(null!==b){this.pageLayout.getSlicesContainer().updateSliceIdxFrom(b)}},s.updateShards=function(a,b){a.shardsIndexes=c(a.shardIdxSet),a.pageIdxSet={};var d=this.pageLayout.getShardsContainer(),e=this.pageLayout.getShardProvider();i(d,a,e),this.updateShardIdx(a);var f=this.pageLayout.getSlicesContainer(),g=this.pageLayout.getMeasuresContainer();return j(d,f,g,a,b),a},s.updateShardIdx=function(a){var b=a.updateShardIdxFrom;if(null!==b){this.pageLayout.getShardsContainer().updateShardIdxFrom(b)}},s.updatePages=function(a){a.pagesIndexes=c(a.pageIdxSet),a.removedPagesIndexes=[];var b=this.pageLayout.getPagesContainer();return k(this.pageLayout,a),l(this.pageLayout,a),m(this.pageLayout),n(this.pageLayout,a),o(b,a),a};var u=function(a){a.addedStaffMeasures.forEach(v)},v=function(a){null!==a.parent&&a.drawContent()};s.getGeometries=function(){var a=this.pageLayout.getSlicesContainer();return p(a,this.updateData)},s.getRemovedPagesIndexes=function(){return this.updateData.removedPagesIndexes}}.call(this),function(){"use strict";var a=Adagio.Drawer.NoteDisplayData,b=Adagio.Drawer.RenderedNote,c=Adagio.Drawer.HeadDrawer,d=Adagio.Drawer.LegerLinesDrawer,e=Adagio.Drawer.DotDrawer,f=Adagio.Values.DurationType,g=Adagio.Values.Notehead,h=Adagio.cursor.NoteCursor=function(a){this.init(a)};h.cssClass="NoteCursor";var i=h.prototype;i.init=function(a){this.drawingContext=a,this.renderedNote=null,this.parentGroup=null},i.update=function(c,d,e){e=e||0,this.hide(),this.line=c;var i={lines:[c],quarterBaseDuration:f.toQuarterDuration(d),nbDots:e,heads:[{line:c,notehead:g.NORMAL}]};this.displayData=new a(i),this.renderedNote=new b(this.displayData),this.renderedNote.setDrawingContext(this.drawingContext),
this.renderedNote.setCssClass(h.cssClass),this.renderedNote.initLocalVerticalAlignment(),this.drawHead(),this.drawLegeLines(),this.drawDots()},i.drawHead=function(){var a=new c(this.displayData);a.canDraw()&&a.draw(this.renderedNote,this.drawingContext)},i.drawLegeLines=function(){var a=new d(this.displayData);a.canDraw()&&a.draw(this.renderedNote,this.drawingContext)},i.drawDots=function(){var a=new e(this.displayData);a.canDraw()&&a.draw(this.renderedNote,this.drawingContext)},i.getHead=function(){return this.renderedNote.getHead(this.line)},i.setPosition=function(a){this.renderedNote.setPosition(a)},i.move=function(){this.renderedNote.move()},i.setParent=function(a){this.parentGroup=a,this.renderedNote.setParent(a),this.renderedNote.bindToParent()},i.canBeDrawn=function(){return null!==this.renderedNote},i.hide=function(){null!==this.parentGroup&&(this.parentGroup=null,this.renderedNote.unbindFromParent()),this.renderedNote=null},i.getGroup=function(){return this.renderedNote.getGroup()}}.call(this),function(){"use strict";var a=Adagio.Drawer.NoteDisplayData,b=Adagio.Drawer.RenderedNote,c=Adagio.Drawer.HeadDrawer,d=Adagio.Drawer.LegerLinesDrawer,e=Adagio.Drawer.DotDrawer,f=Adagio.Values.DurationType,g=Adagio.cursor.PercuCursor=function(a){this.init(a)};g.cssClass="notePercuCursor";var h=g.prototype;h.init=function(a){this.drawingContext=a,this.renderedNote=null,this.parentGroup=null},h.update=function(c){this.hide(),c.nbDots=c.nbDots||0,this.line=c.line;var d={lines:[c.line],quarterBaseDuration:f.toQuarterDuration(c.durationType),nbDots:c.nbDots,heads:[{line:c.line,notehead:c.notehead}]};this.displayData=new a(d),this.renderedNote=new b(this.displayData),this.renderedNote.setDrawingContext(this.drawingContext),this.renderedNote.setCssClass(g.cssClass),this.renderedNote.initLocalVerticalAlignment(),this.drawHead(),this.drawLegeLines(),this.drawDots()},h.drawHead=function(){var a=new c(this.displayData);a.canDraw()&&a.draw(this.renderedNote,this.drawingContext)},h.drawLegeLines=function(){var a=new d(this.displayData);a.canDraw()&&a.draw(this.renderedNote,this.drawingContext)},h.drawDots=function(){var a=new e(this.displayData);a.canDraw()&&a.draw(this.renderedNote,this.drawingContext)},h.canBeDrawn=function(){return null!==this.renderedNote},h.getHead=function(){return this.canBeDrawn()?this.renderedNote.getHead(this.line):null},h.setPosition=function(a){this.renderedNote.setPosition(a)},h.move=function(){this.renderedNote.move()},h.setParent=function(a){this.parentGroup=a,this.renderedNote.setParent(a),this.renderedNote.bindToParent()},h.hide=function(){null!==this.parentGroup&&(this.parentGroup=null,this.renderedNote.unbindFromParent()),this.renderedNote=null},h.getGroup=function(){return this.renderedNote.getGroup()}}.call(this),function(){"use strict";var a=Adagio.Drawer.NoteDisplayData,b=Adagio.Drawer.RenderedNote,c=Adagio.Drawer.FretDrawer,d=Adagio.Utils.clone,e=Adagio.Utils.fretUtils,f=Adagio.cursor.FretCursor=function(a){this.init(a)};f.cssClass="FretCursor";var g=f.prototype;g.init=function(a){this.drawingContext=a,this.renderedNote=null,this.parentGroup=null},g.update=function(c,g){this.hide();for(var h=[],i=g.fret+"",j=0;j<i.length;j++){var k=e.digitToType(i[j]);h.push(k)}this.string=parseInt(g.string,10),g=d(g),g.fret+="",g.string+="";var l={frets:[{string:this.string,frets:h}],technical:g,lines:[],staffData:c};this.displayData=new a(l),this.renderedNote=new b(this.displayData),this.renderedNote.setDrawingContext(this.drawingContext),this.renderedNote.setCssClass(f.cssClass),this.renderedNote.initLocalVerticalAlignment(),this.drawFret()},g.drawFret=function(){var a=new c(this.displayData);a.canDraw()&&a.draw(this.renderedNote,this.drawingContext)},g.getHead=function(){return this.renderedNote.getFret(this.string)},g.setPosition=function(a){this.renderedNote.setPosition(a)},g.move=function(){this.renderedNote.move()},g.setParent=function(a){this.parentGroup=a,this.renderedNote.setParent(a),this.renderedNote.bindToParent()},g.canBeDrawn=function(){return null!==this.renderedNote},g.hide=function(){null!==this.parentGroup&&(this.parentGroup=null,this.renderedNote.unbindFromParent()),this.renderedNote=null},g.getGroup=function(){return this.renderedNote.getGroup()}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadTechnicalOptsError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadTechnicalOptsError",this.stack=e.stack,this.message=e.message,this.type=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"Technical option "+a+" is invalid."}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Error.value.BadTechnicalOptsError,c=Adagio.Utils.staffDetailsUtils,d=Adagio.Utils.pitchUtils,e=Adagio.Utils.staffTuningUtils,f=Adagio.Utils.transposeUtils,g=Adagio.Utils.math,h=Adagio.Utils.pitchShift;Adagio.edit.common.convertFretToPitch=function(a,b){if(void 0!==b.fretData){var k=i(a,b),n=m(b),o=l(b,k),p=c.getShiftedTuningByString(k,o),q=e.toPitch(p),r=f.create(n%f.NB_CHROMATIC);f.setOctaveChange(r,g.intPart(n/f.NB_CHROMATIC));var s=!0,t=d.transpose(q,r,s),u=j(a,b);b.pitch=h.normalize(t,u)}};var i=function(a,b){var c=k(a,b);return a.getStaffDetails(c)},j=function(a,b){var c=k(a,b);return a.getKey(c)},k=function(b,c){if(void 0!==c.staffIdx)return c.staffIdx;if(void 0!==c.voiceIdx)return b.getVoiceMainStaffIdx(c.voiceIdx);throw new a("NoStaffIdx","Cannot convert fret to pitch since there is no staffIdx informations.")},l=function(d,e){if(void 0!==d.fretData.string){var f=parseInt(d.fretData.string,10),g=c.getNbStaffLines(e);if(f<1||f>g)throw new b("string");return f}throw new a("NoTechnicalString","Cannot convert fret to pitch since there is no string value.")},m=function(c){if(void 0!==c.fretData.fret){var d=parseInt(c.fretData.fret,10);if(d<0)throw new b("fret");return d}throw new a("NoTechnicalFret","Cannot convert fret to pitch since there is no fret value.")}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.cursor.NoteCursor,c=Adagio.cursor.FretCursor,d=Adagio.edit.common.MeasureData,e=Adagio.edit.common.convertFretToPitch,f=Adagio.edit.common.pitchToFret,g=Adagio.Utils.pitchUtils,h=Adagio.Utils.staffDetailsUtils,i=Adagio.Utils.staffDataUtils,j={FRET:"fret",NOTE:"note"},k=Adagio.cursor.TabCursor=function(a){this.init(a)};k.cssClass="TabCursor";var l=k.prototype;l.init=function(a){this.settedType=null,this.noteCursor=new b(a),this.fretCursor=new c(a)},l.updateLine=function(a,b,c,e){var f=new d(a);this.settedType=j.NOTE,this.inferFret(f,b),this.updateNote(b.line,c,e),this.updateFret(f,b.fretData)},l.updateTechnicalFret=function(a,b,c,e){var f=new d(a);this.settedType=j.FRET,this.inferLine(f,b),this.updateNote(b.line,c,e),this.updateFret(f,b.fretData)},l.updateNote=function(a,b,c){this.noteCursor.update(a,b,c)},l.updateFret=function(a,b){var c=0,d=a.getStaffDetails(c),e=i.createFromStaffDetails(d);this.fretCursor.update(e,b)},l.inferFret=function(a,b){var c=0,d=a.getStaffDetails(c),e=h.toClef(d),i=g.lineToPitch(b.line,e);b.fretData=f(i,d)},l.inferLine=function(a,b){b.staffIdx=0,e(a,b);var c=b.pitch,d=a.getClef(b.staffIdx);b.line=g.pitchToLine(c,d)},l.getHeads=function(){return{note:this.getNoteHead(),fret:this.getFretHead()}},l.getNoteHead=function(){return this.noteCursor.getHead()},l.getFretHead=function(){return this.fretCursor.getHead()},l.getNoteCursor=function(){return this.noteCursor},l.getFretCursor=function(){return this.fretCursor},l.canBeDrawn=function(){return this.noteCursor.canBeDrawn()&&this.fretCursor.canBeDrawn()},l.hide=function(){this.settedType=null,this.noteCursor.hide(),this.fretCursor.hide()},l.getGroup=function(){if(this.settedType===j.NOTE)return this.getNoteGroup();if(this.settedType===j.FRET)return this.getTabGroup();throw new a("Unexpected")},l.getNoteGroup=function(){return this.noteCursor.getGroup()},l.getTabGroup=function(){return this.fretCursor.getGroup()}}.call(this),function(){"use strict";var a=Adagio.Values.WedgeLocation,b=Adagio.Drawer.wedge.Wedge,c=Adagio.Drawer.wedge.WedgeAnchor,d=Adagio.cursor.WedgeCursor=function(a){this.init(a)};d.cssClass="WedgeCursor";var e=d.prototype;e.init=function(a){this.drawingContext=a,this.wedges=[],this.type=null,this.placement=null},e.update=function(a){this.hide(),this.type=a.type,this.placement=a.placement},e.addSegment=function(a,e,h,i,j){var k=f(h),l=new c(this.type,this.placement,k,h),m=a.getMeasure(e);l.setMeasure(m),l.setMeasureIdx(e),l.setDrawingContext(this.drawingContext);var n=g(j),o=new c(this.type,this.placement,n,j),p=a.getMeasure(i);o.setMeasure(p),o.setMeasureIdx(i),o.setDrawingContext(this.drawingContext);var q=a.getWedgesContainer(),r=q.getGroup(),s=new b;s.setLeftAnchor(l),s.setRightAnchor(o),s.setParent(r),s.setDrawingContext(this.drawingContext),s.setCssClass(d.cssClass),s.updateHorizontalDisplay(),s.updateVerticalDisplay(),this.wedges.push(s)};var f=function(b){return null===b?a.LEFT_CONTINUE:a.LEFT},g=function(b){return null===b?a.RIGHT_CONTINUE:a.RIGHT};e.hide=function(){this.wedges.forEach(h),this.wedges=[]};var h=function(a){a.unbindFromParent()};e.getGroup=function(){return this.getGroups()},e.getGroups=function(){return this.wedges.map(i)};var i=function(a){return a.getGroup()};e.canBeDrawn=function(){return!0}}.call(this),function(){"use strict";var a=Adagio.Drawer.Dynamics,b=Adagio.cursor.DynamicCursor=function(a){this.init(a)};b.cssClass="dynamicCursor";var c=b.prototype;c.init=function(a){this.drawingContext=a,this.dynamic=null,this.parentGroup=null},c.update=function(c,d){this.hide(),this.dynamic=new a(c,d,0),this.dynamic.setCssClass(b.cssClass),this.dynamic.render(this.drawingContext)},c.setPosition=function(a){this.dynamic.setPosX(a)},c.setParent=function(a){this.parentGroup=a,this.dynamic.setParent(a)},c.draw=function(){this.dynamic.draw()},c.hide=function(){null!==this.parentGroup&&(this.parentGroup=null,this.dynamic.unbindFromParent()),this.dynamic=null},c.getGroup=function(){return this.dynamic.getGroup()}}.call(this),function(){"use strict";var a=Adagio.Drawer.slur.SlurAnchor,b=Adagio.Drawer.slur.SlurCrossMeasure,c=Adagio.Values.SlurType,d=Adagio.Values.StemStrategy,e=Adagio.Utils.noteLocationUtils,f=Adagio.cursor.SlurCursor=function(a){this.init(a)};f.cssClass="slurCursor";var g=f.prototype;g.cssClass=f.cssClass,g.init=function(a){this.drawingContext=a,this.slurs=[],this.location=null},g.setLocation=function(a){this.hide(),this.location=a},g.canBeDrawn=function(){var a=e.create(this.location.startMeasureIdx,this.location.voiceIdx,this.location.startNoteIdx),b=e.create(this.location.stopMeasureIdx,this.location.voiceIdx,this.location.stopNoteIdx);return e.isGreater(b,a)},g.addSegment=function(e,f,g,h,i){var j=e.getSlurs(this.location.voiceIdx),k=j.getGroup(),l=d.AUTO,m=new a(c.START,g,this.location.voiceIdx,l);m.setMeasureIdx(f);var n=e.getMeasure(f);m.setMeasure(n);var o=new a(c.STOP,i,this.location.voiceIdx,l);o.setMeasureIdx(h);var p=e.getMeasure(h);o.setMeasure(p);var q=new b;q.setCssClass(this.cssClass),q.setParent(k),q.setStaff(e),q.setLeftAnchor(m),q.setRightAnchor(o),q.setDrawingContext(this.drawingContext),q.updateHorizontalDisplay(),q.draw(),this.slurs.push(q)},g.hide=function(){this.slurs.forEach(h),this.slurs=[]};var h=function(a){a.unbindFromParent()};g.getGroups=function(){return this.slurs.map(i)};var i=function(a){return a.getGroup()}}.call(this),function(){"use strict";var a=Adagio.Drawer.NoteDisplayData,b=Adagio.Drawer.RenderedNote,c=Adagio.Drawer.HeadDrawer,d=Adagio.Drawer.LegerLinesDrawer,e=Adagio.Drawer.DotDrawer,f=Adagio.Values.DurationType,g=Adagio.Values.Notehead,h=Adagio.cursor.GraceCursor=function(a){this.init(a)};h.cssClass="GraceCursor";var i=h.prototype;i.init=function(a){this.drawingContext=a,this.renderedNote=null,this.parentGroup=null},i.update=function(c,d){this.hide(),this.line=c;var e={lines:[c],quarterBaseDuration:f.toQuarterDuration(d),nbDots:0,heads:[{line:c,notehead:g.NORMAL}],isGrace:!0};this.displayData=new a(e),this.renderedNote=new b(this.displayData),this.renderedNote.setDrawingContext(this.drawingContext),this.renderedNote.setCssClass(h.cssClass),this.renderedNote.initLocalVerticalAlignment(),this.drawHead(),this.drawLegeLines(),this.drawDots()},i.drawHead=function(){var a=new c(this.displayData);a.canDraw()&&a.draw(this.renderedNote,this.drawingContext)},i.drawLegeLines=function(){var a=new d(this.displayData);a.canDraw()&&a.draw(this.renderedNote,this.drawingContext)},i.drawDots=function(){var a=new e(this.displayData);a.canDraw()&&a.draw(this.renderedNote,this.drawingContext)},i.getHead=function(){return this.renderedNote.getHead(this.line)},i.setPosition=function(a){this.renderedNote.setPosition(a)},i.move=function(){this.renderedNote.move()},i.setParent=function(a){this.parentGroup=a,this.renderedNote.setParent(a),this.renderedNote.bindToParent()},i.canBeDrawn=function(){return null!==this.renderedNote},i.hide=function(){null!==this.parentGroup&&(this.parentGroup=null,this.renderedNote.unbindFromParent()),this.renderedNote=null},i.getGroup=function(){return this.renderedNote.getGroup()}}.call(this),function(){"use strict";var a=Adagio.Drawer.NoteDisplayData,b=Adagio.Drawer.RenderedNote,c=Adagio.Drawer.HeadDrawer,d=Adagio.Drawer.LegerLinesDrawer,e=Adagio.Drawer.DotDrawer,f=Adagio.Values.DurationType,g=Adagio.cursor.GracePercuCursor=function(a){this.init(a)};g.cssClass="GracePercuCursor";var h=g.prototype;h.init=function(a){this.drawingContext=a,this.renderedNote=null,this.parentGroup=null},h.update=function(c){this.hide(),this.line=c.line;var d={lines:[c.line],quarterBaseDuration:f.toQuarterDuration(c.durationType),nbDots:0,heads:[{line:c.line,notehead:c.notehead}],isGrace:!0};this.displayData=new a(d),this.renderedNote=new b(this.displayData),this.renderedNote.setDrawingContext(this.drawingContext),this.renderedNote.setCssClass(g.cssClass),this.renderedNote.initLocalVerticalAlignment(),this.drawHead(),this.drawLegeLines(),this.drawDots()},h.drawHead=function(){var a=new c(this.displayData);a.canDraw()&&a.draw(this.renderedNote,this.drawingContext)},h.drawLegeLines=function(){var a=new d(this.displayData);a.canDraw()&&a.draw(this.renderedNote,this.drawingContext)},h.drawDots=function(){var a=new e(this.displayData);a.canDraw()&&a.draw(this.renderedNote,this.drawingContext)},h.getHead=function(){return this.renderedNote.getHead(this.line)},h.setPosition=function(a){this.renderedNote.setPosition(a)},h.move=function(){this.renderedNote.move()},h.setParent=function(a){this.parentGroup=a,this.renderedNote.setParent(a),this.renderedNote.bindToParent()},h.canBeDrawn=function(){return null!==this.renderedNote},h.hide=function(){null!==this.parentGroup&&(this.parentGroup=null,this.renderedNote.unbindFromParent()),this.renderedNote=null},h.getGroup=function(){return this.renderedNote.getGroup()}}.call(this),function(){"use strict";var a=Adagio.Drawer.Pizzicato,b=Adagio.cursor.PizzicatoCursor=function(a){this.init(a)};b.cssClass="pizzicatoCursor";var c=b.prototype;c.init=function(a){this.drawingContext=a,this.pizzicato=null,this.parentGroup=null},c.update=function(c,d){this.hide(),this.pizzicato=new a(c,d,0),this.pizzicato.render(this.drawingContext),this.pizzicato.setCssClass(b.cssClass)},c.setPosition=function(a){this.pizzicato.setPosX(a)},c.setParent=function(a){this.parentGroup=a,this.pizzicato.setParent(a)},c.draw=function(){this.pizzicato.draw()},c.hide=function(){null!==this.parentGroup&&(this.parentGroup=null,this.pizzicato.unbindFromParent()),this.pizzicato=null},c.getGroup=function(){return this.pizzicato.getText()}}.call(this),function(){"use strict";var a=Adagio.Values.PedalType,b=Adagio.Drawer.Pedal,c=Adagio.cursor.PedalCursor=function(a){this.init(a)};c.cssClass="PedalCursor";var d=c.prototype;d.init=function(a){this.drawingContext=a,this.pedals=[],this.placement=null},d.update=function(a){this.hide(),this.placement=a},d.addSegment=function(d,e,f,g,h){var i=new b(a.START,this.placement,f),j=d.getMeasure(e),k=j.tickableContent,l=k.timePosToX(f);i.setCssClass(c.cssClass),i.setPosX(l),k.formatDirectionVertical(i),i.setParent(k.group),i.render(this.drawingContext),i.draw();var m=new b(a.STOP,this.placement,h);k=d.getMeasure(g).tickableContent,l=k.timePosToX(h),m.setCssClass(c.cssClass),m.setPosX(l),k.formatDirectionVertical(m),m.setParent(k.group),m.render(this.drawingContext),m.draw(),this.pedals.push(i),this.pedals.push(m)},d.hide=function(){this.pedals.forEach(e),this.pedals=[]};var e=function(a){a.unbindFromParent()};d.getGroup=function(){return this.getGroups()},d.getGroups=function(){return this.pedals.map(f)};var f=function(a){return a.getGroup()};d.canBeDrawn=function(){return!0}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Drawer.octaveShift.OctaveShiftAnchor,c=Adagio.Drawer.octaveShift.OctaveShift,d=Adagio.Values.DirectionPlacement,e=Adagio.Values.OctaveShiftType,f=Adagio.Values.OctaveShiftLocation,g=Adagio.cursor.OctaveShiftCursor=function(a){this.init(a)};g.cssClass="OctaveShiftCursor";var h=g.prototype;h.init=function(a){this.drawingContext=a,this.octaveShifts=[],this.type=null,this.size=null,this.placement=null},h.update=function(a){this.hide(),this.size=a.size,this.placement=a.placement,this.updateType()},h.updateType=function(){if(this.placement===d.ABOVE)this.type=e.DOWN;else{if(this.placement!==d.BELOW)throw new a("Unexpected");this.type=e.UP}},h.addSegment=function(a,d,e,h,i){var j;null===e&&(j=f.LEFT);var k=new b(this.type,this.size,this.placement,e,j),l=a.getMeasure(d);k.setMeasure(l),k.setDrawingContext(this.drawingContext);var m;null===i&&(m=f.RIGHT);var n=this.getRightType(i),o=new b(n,this.size,this.placement,i,m),p=a.getMeasure(h);o.setMeasure(p),o.setDrawingContext(this.drawingContext);var q=a.getOctaveShiftsContainer(),r=q.getGroup(),s=new c;s.setLeftAnchor(k),s.setRightAnchor(o),s.setParent(r),s.setDrawingContext(this.drawingContext),s.setCssClass(g.cssClass),s.updateHorizontalDisplay(),s.updateVerticalDisplay(),this.octaveShifts.push(s)},h.getRightType=function(a){return null===a?this.type:e.STOP},h.hide=function(){this.octaveShifts.forEach(this.hideOctaveShift),this.octaveShifts=[]},h.hideOctaveShift=function(a){a.unbindFromParent()},h.getGroup=function(){return this.getGroups()},h.getGroups=function(){return this.octaveShifts.map(this.getOctaveShiftGroup)},h.getOctaveShiftGroup=function(a){return a.getGroup()},h.canBeDrawn=function(){return!0}}.call(this),function(){"use strict";var a=Adagio.Values.TempoChangeType,b=Adagio.Values.TempoChangeLocation,c=Adagio.Values.DirectionPlacement,d=Adagio.Drawer.tempoChange.TempoChange,e=Adagio.Drawer.tempoChange.TempoChangeAnchor,f=Adagio.cursor.TempoChangeCursor=function(a){this.init(a)};f.cssClass="TempoChangeCursor";var g=f.prototype;g.init=function(a){this.drawingContext=a,this.tempoChanges=[],this.type=null,this.placement=null},g.update=function(a){this.hide(),this.type=a.type,this.placement=c.ABOVE},g.addSegment=function(c,g,h,i,j){var k,l;null===h&&(k=b.LEFT);var m=new e(this.type,this.placement,h,k),n=c.getMeasure(g);m.setMeasure(n),m.setMeasureIdx(g),m.setDrawingContext(this.drawingContext),null===j&&(l=b.RIGHT);var o=new e(a.STOP,this.placement,j,l),p=c.getMeasure(i);o.setMeasure(p),o.setMeasureIdx(i),o.setDrawingContext(this.drawingContext);var q=c.getTempoChangesContainer(),r=q.getGroup(),s=new d;s.setLeftAnchor(m),s.setRightAnchor(o),s.setParent(r),s.setDrawingContext(this.drawingContext),s.setCssClass(f.cssClass),s.updateHorizontalDisplay(),s.updateVerticalDisplay(),this.tempoChanges.push(s)},g.hide=function(){this.tempoChanges.forEach(h),this.tempoChanges=[]};var h=function(a){a.unbindFromParent()};g.getGroup=function(){return this.getGroups()},g.getGroups=function(){return this.tempoChanges.map(i)};var i=function(a){return a.getGroup()};g.canBeDrawn=function(){return!0}}.call(this),function(){"use strict";var a=Adagio.cursor.NoteCursor,b=Adagio.cursor.PercuCursor,c=Adagio.cursor.TabCursor,d=Adagio.cursor.WedgeCursor,e=Adagio.cursor.DynamicCursor,f=Adagio.cursor.SlurCursor,g=Adagio.cursor.GraceCursor,h=Adagio.cursor.GracePercuCursor,i=Adagio.cursor.PizzicatoCursor,j=Adagio.cursor.PedalCursor,k=Adagio.cursor.OctaveShiftCursor,l=Adagio.cursor.TempoChangeCursor,m=Adagio.Utils.math,n=Adagio.cursor.Cursor=function(){this.init()},o=n.prototype;o.init=function(){this.target=null,this.currentCursor=null,this.reset()},o.setTarget=function(a){this.target=a,this.reset()},o.reset=function(){this.noteCursor=null,this.percuCursor=null,this.tabCursor=null,this.dynamicCursor=null,this.wedgeCursor=null,this.slurCursor=null,this.GraceCursor=null,this.gracePercuCursor=null,this.pizzicatoCursor=null,this.pedalCursor=null,this.octaveShiftCursor=null,this.tempoChangeCursor=null,null!==this.currentCursor&&(this.currentCursor.hide(),this.currentCursor=null)},o.drawNoteCursor=function(a,b,c){var d=this.getNoteCursor();return this.updateCurrentCursor(d),d.update(a.line,b,c),this.drawBasicCursor(a,d),d.getHead()},o.drawGraceCursor=function(a,b){var c=this.getGraceCursor();return this.updateCurrentCursor(c),c.update(a.line,b),c.canBeDrawn()&&this.target.drawGraceCursor(a,c),c.getHead()},o.drawGracePercuCursor=function(a,b){var c=this.getGracePercuCursor();return this.updateCurrentCursor(c),c.update(b),c.canBeDrawn()&&this.target.drawGraceCursor(a,c),c.getHead()},o.drawPercuCursor=function(a,b){var c=this.getPercuCursor();return this.updateCurrentCursor(c),c.update(b),this.drawBasicCursor(a,c),c.getHead()},o.drawTabCursorByLine=function(a,b,c){var d=this.getTabCursor();this.updateCurrentCursor(d);var e=this.getMeasureJson(a);return d.updateLine(e,a,b,c),this.drawTabCursor(a,d),d.getNoteHead()},o.drawTabCursorByFret=function(a,b,c){var d=this.getTabCursor();this.updateCurrentCursor(d);var e=this.getMeasureJson(a);return d.updateTechnicalFret(e,a,b,c),this.drawTabCursor(a,d),d.getFretHead()},o.drawDynamicCursor=function(a,b,c){var d=this.getDynamicCursor();this.updateCurrentCursor(d),d.update(b,c),this.target.drawDynamicCursor(a,d)},o.drawPizzicatoCursor=function(a,b,c){var d=this.getPizzicatoCursor();this.updateCurrentCursor(d),d.update(b,c),this.target.drawPizzicatoCursor(a,d)},o.drawWedgeCursor=function(a,b){var c=this.getWedgeCursor();return this.updateCurrentCursor(c),c.update(b),void 0!==a.startMeasureIdx?this.drawHorizontalCursor(a,c):this.drawHorizontalMeasureWideCursor(a,c),c.getGroups()},o.drawTempoChangeCursor=function(a,b){var c=this.getTempoChangeCursor();return this.updateCurrentCursor(c),c.update(b),void 0!==a.startMeasureIdx?this.drawHorizontalCursor(a,c):this.drawHorizontalMeasureWideCursor(a,c),c.getGroups()},o.drawPedalCursor=function(a,b){var c=this.getPedalCursor();return this.updateCurrentCursor(c),c.update(b),void 0!==a.startMeasureIdx?this.drawHorizontalCursor(a,c):this.drawHorizontalMeasureWideCursor(a,c),c.getGroups()},o.drawSlurCursor=function(a){var b=this.getSlurCursor();return this.updateCurrentCursor(b),b.setLocation(a),b.canBeDrawn()?(this.target.drawCrossMeasureNoteCursor(a,b),b.getGroups()):null},o.drawOctaveShiftCursor=function(a,b){var c=this.getOctaveShiftCursor();return this.updateCurrentCursor(c),c.update(b),void 0!==a.startMeasureIdx?this.drawHorizontalCursor(a,c):this.drawHorizontalMeasureWideCursor(a,c),c.getGroups()},o.drawBasicCursor=function(a,b){b.canBeDrawn()&&this.target.drawBasicCursor(a,b)},o.drawTabCursor=function(a,b){b.canBeDrawn()&&this.target.drawTabCursor(a,b)},o.drawHorizontalMeasureWideCursor=function(a,b){b.canBeDrawn()&&this.target.drawHorizontalMeasureWideCursor(a,b)},o.drawHorizontalCursor=function(a,b){b.canBeDrawn()&&(m.isInteger(a.voiceIdx)&&(a.startVoiceIdx=a.voiceIdx,a.stopVoiceIdx=a.voiceIdx,delete a.voiceIdx),this.target.drawHorizontalCursor(a,b))},o.updateCurrentCursor=function(a){null!==this.currentCursor&&a!==this.currentCursor&&this.currentCursor.hide(),this.currentCursor=a},o.getDynamicCursor=function(){if(!this.dynamicCursor){var a=this.target.getDrawingContext();this.dynamicCursor=new e(a)}return this.dynamicCursor},o.getPizzicatoCursor=function(){if(!this.pizzicatoCursor){var a=this.target.getDrawingContext();this.pizzicatoCursor=new i(a)}return this.pizzicatoCursor},o.getPercuCursor=function(){if(!this.percuCursor){var a=this.target.getDrawingContext();this.percuCursor=new b(a)}return this.percuCursor},o.getWedgeCursor=function(){if(!this.wedgeCursor){var a=this.target.getDrawingContext();this.wedgeCursor=new d(a)}return this.wedgeCursor},o.getTempoChangeCursor=function(){if(!this.tempoChangeCursor){var a=this.target.getDrawingContext();this.tempoChangeCursor=new l(a)}return this.tempoChangeCursor},o.getPedalCursor=function(){if(!this.pedalCursor){var a=this.target.getDrawingContext();this.pedalCursor=new j(a)}return this.pedalCursor},o.getNoteCursor=function(){if(null===this.noteCursor){var b=this.target.getDrawingContext();this.noteCursor=new a(b)}return this.noteCursor},o.getGraceCursor=function(){if(null===this.GraceCursor){var a=this.target.getDrawingContext();this.GraceCursor=new g(a)}return this.GraceCursor},o.getGracePercuCursor=function(){if(null===this.gracePercuCursor){var a=this.target.getDrawingContext();this.gracePercuCursor=new h(a)}return this.gracePercuCursor},o.getTabCursor=function(){if(null===this.tabCursor){var a=this.target.getDrawingContext();this.tabCursor=new c(a)}return this.tabCursor},o.getSlurCursor=function(){if(null===this.slurCursor){var a=this.target.getDrawingContext();this.slurCursor=new f(a)}return this.slurCursor},o.getOctaveShiftCursor=function(){if(!this.octaveShiftCursor){var a=this.target.getDrawingContext();this.octaveShiftCursor=new k(a)}return this.octaveShiftCursor},o.getCursorGroup=function(){return this.currentCursor.getGroup()},o.removeCursor=function(){this.currentCursor&&this.currentCursor.hide()},o.getMeasureJson=function(a){return this.getScoreData().getMeasure(a.partIdx,a.measureIdx)},o.getScoreData=function(){return this.target.getScoreData()}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadMeasureUuidError,b=Adagio.Utils.measuresHeadersUtils,c=Adagio.edit.common.measureUuidToMeasureIdx;Adagio.edit.common.measureUuidsToMeasureIdxs=function(d,e){var f,g;if(e.forEach(function(a){if(b.hasUuid(d,a)){var e=c(d,a);f=void 0!==f?Math.min(f,e):e,g=void 0!==g?Math.max(g,e):e}}),void 0===f)throw new a(e[0]);return{startMeasureIdx:f,stopMeasureIdx:g}}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.edit.common.measureUuidsToMeasureIdxs,c=Adagio.edit.common.getScoreData,d=Adagio.Utils.typeUtils;Adagio.edit.common.convertMeasuresUuidsToMeasuresIdxs=function(a,b){void 0!==b.measureUuids&&e(a,b)};var e=function(e,f){if(!(d.isArray(f.measureUuids)&&f.measureUuids.length>0))throw new a("Unexpected","Cannot convert measureUuids if is not an array of uuids");e=c(e);var g=b(e.getMeasuresHeaders(),f.measureUuids);f.startMeasureIdx=g.startMeasureIdx,f.stopMeasureIdx=g.stopMeasureIdx,delete f.measureUuids}}.call(this),function(){"use strict";var a=Adagio.Brush.Elem,b=Adagio.marker.RectangleMarker=function(a){this.init(a)};b.cssClass="RectangleMarker";var c=b.prototype;c.cssClass="RectangleMarker",c.init=function(a){this.drawingContext=a,this.rectangles=[]},c.update=function(){this.hide()},c.setCssClass=function(a){this.cssClass=a},c.setStartVoiceIdx=function(a){this.startVoiceIdx=a},c.setStopVoiceIdx=function(a){this.stopVoiceidx=a},c.addSegment=function(b,c,d,e,f){var g=this.getLeftX(b,c,d),h=this.getRightX(b,e,f),i=b.getSpaceAbove(),j=b.getStaffHeight(),k=i,l=h-g,m=new a("rect");m.attr("x",g),m.attr("y",k),m.attr("width",l),m.attr("height",j),m.attr("height",j),m.attr("class",this.cssClass),b.getGroup().prepend(m),this.rectangles.push(m)},c.getLeftX=function(a,b,c){var d,e=a.getMeasure(b),f=e.tickableContent,g=e.getXPos()+f.getXPos();if(null===c)d=g-f.getPreviousSpace();else{var h=e.getNote(this.startVoiceIdx,c);d=g+h.getXPos()-h.getPreviousSpace()}return d},c.getRightX=function(a,b,c){var d,e=a.getMeasure(b),f=e.tickableContent,g=e.getXPos()+f.getXPos();if(null===c)d=g+f.getWidth();else{var h=e.getNote(this.stopVoiceidx,c);d=g+h.getXPos()+h.getWidth()}return d},c.hide=function(){this.rectangles.forEach(d),this.rectangles=[]};var d=function(a){a.removeFromParent()};c.getGroups=function(){return this.rectangles}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.BadStaffIdxError,c=Adagio.edit.common.convertPartUuidToGetPartIdx,d=Adagio.edit.common.convertMeasuresUuidsToMeasuresIdxs,e=Adagio.edit.common.hasTimePosExactNoteIdx,f=Adagio.edit.common.timePosToFloorNoteIdx,g=Adagio.edit.common.getMeasuresScroller,h=Adagio.marker.RectangleMarker,i=Adagio.Utils.clone,j=Adagio.Utils.math,k=Adagio.Utils.durationUtils,l=Adagio.Utils.measureUtils,m=Adagio.marker.Marker=function(){this.init()},n=m.prototype;n.init=function(){this.drawer=null,this.scoreData=null,this.displayedMarkers=[]},n.setDrawer=function(a){this.drawer=a},n.setScoreData=function(a){this.scoreData=a},n.clearMarkers=function(){this.displayedMarkers.forEach(o),this.displayedMarkers=[]};var o=function(a){a.hide()};n.addMarker=function(a){var b=this.absoluteToLocalPosition(a);if(null===b)return null;var c=this.createMarker(b);return this.displayedMarkers.push(c),a=this.localeToAbsolutePosition(b),a.markerGroups=c.getGroups(),a},n.absoluteToLocalPosition=function(e){var f=i(e);try{c(this.scoreData,f),d(this.scoreData,f);var g=this.scoreData.getPartNbStaves(f.partIdx),h=f.staffIdx;if(!j.isInteger(h)||h<0||h>=g)throw new b(h);e.measureUuids[0]!==this.scoreData.getMeasureUuid(f.startMeasureIdx)&&(f.startTimePos=0);var k=e.measureUuids.length;if(e.measureUuids[k-1]!==this.scoreData.getMeasureUuid(f.stopMeasureIdx)){var m=this.scoreData.getMeasure(f.partIdx,f.stopMeasureIdx);f.stopTimePos=l.getNbDivisions(m),f.stopDpq=l.getDpq(m)}f.startTimePos=this.adaptTimePos(f.partIdx,f.startMeasureIdx,f.startTimePos,f.startDpq),f.stopTimePos=this.adaptTimePos(f.partIdx,f.stopMeasureIdx,f.stopTimePos,f.stopDpq)}catch(b){if(b instanceof a)return null;throw b}return f},n.adaptTimePos=function(a,b,c,d){var e=k.divisionsToQuarter(c,d),f=this.scoreData.getMeasure(a,b),g=l.getQuarterDuration(f);return e>g&&(c=k.quarterToDivisions(g,d),c=Math.floor(c)),c},n.createMarker=function(a){var b=g(this.scoreData,a),c={partIdx:a.partIdx,staffIdx:a.staffIdx,measureIdx:a.startMeasureIdx,timePos:a.startTimePos,dpq:a.startDpq};c=p(b,c);var d={partIdx:a.partIdx,staffIdx:a.staffIdx,measureIdx:a.stopMeasureIdx,timePos:a.stopTimePos,dpq:a.stopDpq};d=r(b,d);var e=this.getDrawingContext(),f=new h(e);f.setStartVoiceIdx(c.voiceIdx),f.setStopVoiceIdx(d.voiceIdx),void 0!==a.id&&f.setCssClass(a.id);var i={partIdx:a.partIdx,staffIdx:a.staffIdx,startMeasureIdx:a.startMeasureIdx,startNoteIdx:c.noteIdx,stopMeasureIdx:a.stopMeasureIdx,stopNoteIdx:d.noteIdx};return this.drawer.drawCrossMeasureNoteCursor(i,f),f};var p=function(a,b){var c=a.getMeasureData(b.measureIdx),d=c.getMeasure(),g=c.getDpqValue(),h=j.lcm(b.dpq,g),i=b.timePos*h/b.dpq,k=h/g,m=l.getNbDivisions(d);if(m*=k,i===m)return{noteIdx:null};var n=[];return a.getScoreData().getPartStaffVoicesIndexes(b.partIdx,b.staffIdx).forEach(function(a){if(c.hasVoice(a)){var b=c.getVoice(a),d=f(b,k,i);if(e(b,k,i)||d++,d===b.getNbNotes())n.push({noteIdx:null,timePos:m});else{var g=b.getRangeSpace(0,d);n.push({voiceIdx:a,noteIdx:d,timePos:g})}}}),n.reduce(q)},q=function(a,b){return a.timePos<b.timePos?a:b},r=function(a,b){var c=a.getMeasureData(b.measureIdx),d=c.getMeasure(),g=c.getDpqValue(),h=j.lcm(b.dpq,g),i=b.timePos*h/b.dpq,k=h/g,m=l.getNbDivisions(d);if(m*=k,i===m)return{noteIdx:null};var n=[];return a.getScoreData().getPartStaffVoicesIndexes(b.partIdx,b.staffIdx).forEach(function(a){if(c.hasVoice(a)){var b=c.getVoice(a),d=f(b,k,i);if(e(b,k,i)&&0!==d&&d--,d===b.getNbNotes())n.push({noteIdx:null,timePos:m});else{var g=b.getRangeSpace(0,d);n.push({voiceIdx:a,noteIdx:d,timePos:g})}}}),n.reduce(s)},s=function(a,b){
return a.timePos>b.timePos?a:b};n.getDrawingContext=function(){return this.drawer.getDrawingContext()},n.localeToAbsolutePosition=function(a){var b={startTimePos:a.startTimePos,startDpq:a.startDpq,stopTimePos:a.stopTimePos,stopDpq:a.stopDpq,staffIdx:a.staffIdx,id:a.id};return b.measureUuids=this.scoreData.getMeasureUuids(a.startMeasureIdx,a.stopMeasureIdx),b.partUuid=this.scoreData.getPartUuid(a.partIdx),b}}.call(this),function(){"use strict";Adagio.edit.values.GroupRest={LEFT:"left",RIGHT:"right"}}.call(this),function(){"use strict";Adagio.edit.values.BarlineType={REPEAT:"repeat",DOUBLE:"double",SIMPLE:"simple"}}.call(this),function(){"use strict";Adagio.edit.values.PosBarline={LEFT:"left",RIGHT:"right"}}.call(this),function(){"use strict";Adagio.edit.values.ActionOrigin={INVALIDATED:"INVALIDATED",DEFAULT:"unsetted",LOCAL:"local",UNDO:"undo",REDO:"redo",REMOTE:"remote"}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.pitchUtils,c=Adagio.edit.common.getNoteAtPitch,d=Adagio.edit.common.initMeasureData,e=Adagio.edit.primitive.SetAlter=function(a,b,c){this.init(a,b,c)};e.NAME="primitive.SetAlter";var f=e.prototype;f.initMeasureData=d,f.name=e.NAME,f.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},f.perform=function(){var c=this.getNoteAtPitch(),d=a.getAlter(c),e=b.getAlter(this.opts.pitch);a.setAlter(c,e),this.updateStack(d)},f.getNoteAtPitch=function(){var a=this.measureData.getVoice(this.opts.voiceIdx);return c(a,this.opts.noteIdx,this.opts.pitch)},f.updateStack=function(a){var c={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:b.copy(this.opts.pitch),previousAlter:a}};this.cancelStack.push(c)}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.pitchUtils,c=Adagio.edit.action.UntieNoteHead,d=Adagio.edit.composite.UpdateAccidental,e=Adagio.edit.primitive.SetAlter,f=Adagio.edit.common.initMeasureData,g=Adagio.edit.common.getNoteAtPitch,h=Adagio.edit.composite.SetAccidental=function(a,b,c){this.init(a,b,c)};h.NAME="composite.SetAccidental";var i=h.prototype;i.initMeasureData=f,i.name=h.NAME,i.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},i.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.untieNoteHead(),this.setAlter(),this.updateAccidental()},i.untieNoteHead=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,step:b.getStep(this.opts.pitch),octave:b.getOctave(this.opts.pitch)};new c(this.measureData,a,this.cancelStack).performIfPossible()},i.setAlter=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:b.copy(this.opts.pitch)};new e(this.measureData,a,this.cancelStack).perform()},i.updateAccidental=function(){var c=this.getNoteAtPitch(),e=a.getStaffIdx(c),f={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:e,noteIdx:this.opts.noteIdx,pitch:b.copy(this.opts.pitch)};new d(this.measureData,f,this.cancelStack).perform()},i.getNoteAtPitch=function(){var a=this.measureData.getVoice(this.opts.voiceIdx);return g(a,this.opts.noteIdx,this.opts.pitch)}}.call(this),function(){"use strict";var a=Adagio.Utils.pitchUtils,b=Adagio.Utils.noteUtils,c=Adagio.edit.common.getPreviousAlter,d=Adagio.edit.common.getNoteAtPitch;Adagio.edit.common.fillOptsAlter=function(b,d){var f;if(null!==d.accidental)f=a.accidentalToAlter(d.accidental);else{var g=e(b,d);f=c(b,d.noteIdx,d.voiceIdx,g,d.pitch)}a.setAlter(d.pitch,f)};var e=function(a,c){if(void 0!==c.staffIdx)return c.staffIdx;var e=a.getVoice(c.voiceIdx),f=d(e,c.noteIdx,c.pitch);return b.getStaffIdx(f)}}.call(this),function(){"use strict";var a=Adagio.Utils.transposeUtils,b=Adagio.Utils.pitchUtils;Adagio.edit.common.transposePitchAccidental=function(c,d,e){if(c=b.copy(c),a.isIdentity(e))return{pitch:c,accidental:d};e=a.getReverse(e);var f;return null!==d&&(f=b.accidentalToAlter(d),b.setAlter(c,f)),c=b.transpose(c,e,!0),null!==d&&(f=b.getAlter(c),d=b.alterToAccidental(f)),c=b.copyWithoutAlter(c),{pitch:c,accidental:d}}}.call(this),function(){"use strict";var a=Adagio.edit.common.transposePitchAccidental,b=Adagio.edit.common.getStaffIdx;Adagio.edit.common.transposePitchAccidentalOpts=function(c,d){if(d.isConcertPitch){var e=b(d),f=c.getTranspose(e),g=d.pitch,h=d.accidental,i=a(g,h,f);d.pitch=i.pitch,d.accidental=i.accidental,d.isConcertPitch=!1}}}.call(this),function(){"use strict";var a=Adagio.edit.common.getStaffDetails,b=Adagio.Utils.staffDetailsUtils;Adagio.edit.common.isTabStaff=function(c,d){var e=a(c,d);return b.hasStaffTuning(e)}}.call(this),function(){"use strict";var a=Adagio.Error.noChange.NoChangeError,b=Adagio.Error.client.NotPossibleOnUnpitchedError,c=Adagio.Error.client.PitchCollisionError,d=Adagio.Utils.noteUtils,e=Adagio.Utils.pitchUtils,f=Adagio.Utils.clone,g=Adagio.Values.AccidentalStyle,h=Adagio.edit.action.SetFret,i=Adagio.edit.action.RemoveEdgeHammerOnPullOffs,j=Adagio.edit.composite.SetAccidental,k=Adagio.edit.common.getNoteAtPitch,l=Adagio.edit.common.checkOptsPitch,m=Adagio.edit.common.convertLineToPitch,n=Adagio.edit.common.fillOptsAlter,o=Adagio.edit.common.convertTimePosToGetNoteIdx,p=Adagio.edit.common.convertPartUuidToGetPartIdx,q=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,r=Adagio.edit.common.transposePitchAccidentalOpts,s=Adagio.edit.common.isTabStaff,t=Adagio.edit.common.initMeasureData,u=Adagio.edit.action.AddAccidental=function(a,b,c){this.init(a,b,c)};u.NAME="action.AddAccidentals",u.isNoChange=function(b){return b instanceof a};var v=u.prototype;v.name=u.NAME,v.initMeasureData=t,v.init=function(a,b,c){p(a,b),q(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.sanitized=!1,this.noteHead=null,this.voice=null,this.location=null,this.fretAction=null,this.removeEdgeHammerOnPullOffsAction=null},v.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),o(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),this.checkValues(),this.sanitizeIfNeeded(),this.checkPitch(),this.checkNoteAtPitch(),this.checkAlterDifferent()},v.checkValues=function(){l(this.opts),null!==this.opts.accidental&&g.check(this.opts.accidental)},v.checkPitch=function(){e.check(this.opts.pitch)},v.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new b},v.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},v.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},v.checkNoteAtPitch=function(){if(void 0===this.getNoteAtPitch()){var a=e.copy(this.opts.pitch);throw new c(c.action.GET,a)}},v.checkAlterDifferent=function(){var b=this.getNoteAtPitch(),c=d.getPitch(b),f=e.getAlter(c);if(e.getAlter(this.opts.pitch)===f)throw new a},v.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),o(this.measureData,this.opts),this.sanitizeIfNeeded(),this.storeAction();var a;if(this.opts.record&&(a=this.getPreviousData()),this.addAccidental(),this.isTabStaff()){var b=this.getRemoveEdgeHammerOnPullOffs();b.cancelStack=this.cancelStack,b.performIfPossible();var c=this.getFretAction();c.cancelStack=this.cancelStack,c.performIfPossible()}this.opts.record&&this.updateStack(a)},v.sanitizeIfNeeded=function(){if(!this.sanitized){void 0!==this.opts.line&&m(this.measureData,this.opts,!0),this.opts.isConcertPitch&&r(this.measureData,this.opts),this.checkNoteAtPitch(),n(this.measureData,this.opts),void 0===this.opts.record&&(this.opts.record=!0);if(this.measureData.getScoreData().isPartTab(this.opts.partIdx)){var a=this.opts.fretData||{},b=this.getNoteAtPitch();d.hasString(b)&&(a.lastString=d.getString(b)),this.opts.fretData=a}this.sanitized=!0}},v.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos,pitch:e.copyWithoutAlter(this.opts.pitch),accidental:this.opts.accidental};void 0!==this.opts.fretData&&(b.fretData=f(this.opts.fretData));var c={actionName:this.name,opts:b};this.cancelStack.storeAction(c)}},v.getPreviousData=function(){var a=this.getNoteAtPitch(),b=d.getAlter(a),c=e.alterToAccidental(b),g={accidental:c};if(d.hasTabData(a)){var h=d.getTabData(a);g.fretData=f(h)}return g},v.addAccidental=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:e.copy(this.opts.pitch),fretData:this.opts.fretData};new j(this.measureData,a,this.cancelStack).perform()},v.isTabStaff=function(){return s(this.measureData,this.opts)},v.getRemoveEdgeHammerOnPullOffs=function(){if(null===this.removeEdgeHammerOnPullOffsAction){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:e.copy(this.opts.pitch)};this.removeEdgeHammerOnPullOffsAction=new i(this.measureData,a,null)}return this.removeEdgeHammerOnPullOffsAction},v.getFretAction=function(){if(null===this.fretAction){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:e.copy(this.opts.pitch),fretData:f(this.opts.fretData)};this.fretAction=new h(this.measureData,a,null)}return this.fretAction},v.getNoteAtPitch=function(){if(null===this.noteHead){var a=this.getVoice();this.noteHead=k(a,this.opts.noteIdx,this.opts.pitch)}return this.noteHead},v.updateStack=function(a){var b=this.getLocation(),c={partUuid:b.partUuid,measureUuid:b.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:b.dpq,timePos:b.timePos,pitch:e.copyWithoutAlter(this.opts.pitch),previousAccidental:a.accidental};void 0!==a.fretData&&(c.fretData=f(a.fretData));var d={type:this.name,noDraw:!0,opts:c};this.cancelStack.push(d)},v.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location},v.getVoice=function(){return null===this.voice&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice}}.call(this),function(){"use strict";var a=Adagio.Utils.typeUtils,b=Adagio.Utils.noteUtils,c=Adagio.Utils.arpeggiateUtils,d=Adagio.edit.common.initMeasureData,e=Adagio.edit.primitive.AddArpeggio=function(a,b,c){this.init(a,b,c)};e.NAME="primitive.AddArpeggio";var f=e.prototype;f.name=e.NAME,f.initMeasureData=d,f.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},f.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.addArpeggio(),this.updateStack()},f.addArpeggio=function(){var b=this.getVoice(),c=b.getChord(this.opts.noteIdx);c=a.makeArray(c),c.forEach(this.addArpeggioToHead,this)},f.addArpeggioToHead=function(a){var d=c.create();b.setArpeggiate(a,d)},f.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},f.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.edit.primitive.AddArpeggio,b=Adagio.edit.action.RemoveTie,c=Adagio.edit.common.initMeasureData,d=Adagio.edit.composite.AddArpeggio=function(a,b,c){this.init(a,b,c)};d.NAME="composite.AddArpeggio";var e=d.prototype;e.initMeasureData=c,e.name=d.NAME,e.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeLeftTie(),this.addArpeggio()},e.removeLeftTie=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx-1};new b(this.measureData,a,this.cancelStack).performIfPossible()},e.addArpeggio=function(){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new a(this.measureData,b,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.noChange.NoChangeError,b=Adagio.Error.client.NotPossibleOnSingleNoteError,c=Adagio.Error.client.NotPossibleOnUnpitchedError,d=Adagio.Utils.noteUtils,e=Adagio.edit.common.convertTimePosToGetNoteIdx,f=Adagio.edit.common.convertPartUuidToGetPartIdx,g=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,h=Adagio.edit.common.initMeasureData,i=Adagio.edit.composite.AddArpeggio,j=Adagio.edit.action.AddArpeggio=function(a,b,c){this.init(a,b,c)};j.NAME="action.AddArpeggio",j.isNoChange=function(b){return b instanceof a};var k=j.prototype;k.initMeasureData=h,k.name=j.NAME,k.init=function(a,b,c){f(a,b),g(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,e(this.measureData,this.opts),this.location=null},k.checkPreconditions=function(){this.checkPitchedPart(),this.checkLocation(),this.checkUsage()},k.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new c},k.checkLocation=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.measureData.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},k.checkUsage=function(){var c=this.measureData.getVoice(this.opts.voiceIdx);if(!c.isChord(this.opts.noteIdx))throw new b;var e=c.getNote(this.opts.noteIdx);if(d.hasArpeggiate(e)){throw new a("There is already an arpeggio at this location.")}},k.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),void 0===this.opts.record&&(this.opts.record=!0),this.storeAction(),this.addArpeggio(),this.updateStack()},k.addArpeggio=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new i(this.measureData,a,this.cancelStack).perform()},k.updateStack=function(){var a=this.getLocation(),b={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos}};this.cancelStack.push(b)},k.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos}};this.cancelStack.storeAction(b)}},k.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location},k.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.AlreadyHasArticulationError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="AlreadyHasArticulationError",this.stack=e.stack,this.message=e.message,this.articulationType=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"Note already has Articulation "+a}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.edit.common.initMeasureData,c=Adagio.edit.primitive.AddArticulation=function(a,b,c){this.init(a,b,c)};c.NAME="primitive.AddArticulation";var d=c.prototype;d.name=c.NAME,d.initMeasureData=b,d.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},d.perform=function(){var b=this.measureData.getVoice(this.opts.voiceIdx),c=b.getNote(this.opts.noteIdx);a.addArticulation(c,this.opts.articulationType),this.updateStack()},d.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,articulationType:this.opts.articulationType,noteIdx:this.opts.noteIdx}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.edit.primitive.AddArticulation,c=Adagio.edit.action.RemoveArticulation,d=Adagio.edit.action.RemoveNotation,e=Adagio.Values.NotationType,f=Adagio.edit.composite.AddArticulation=function(a,b,c){this.init(a,b,c)};f.NAME="composite.AddArticulation";var g=f.prototype;g.name=f.NAME,g.init=function(a,b,c){this.measureData=a,this.opts=b,this.cancelStack=c},g.perform=function(){var a=this.measureData.getVoice(this.opts.voiceIdx),c=a.getNote(this.opts.noteIdx);this.hasIncompatibleArticulations(c)&&this.removeIncompatibleArticulations(c),this.hasIncompatibleNotations(c)&&this.removeIncompatibleNotations(),new b(this.measureData,this.opts,this.cancelStack).perform()},g.hasIncompatibleNotations=function(b){return a.hasNotation(b,e.FERMATA)&&a.isArticulationCompatibleWithNotation(b,this.opts.articulationType)},g.hasIncompatibleArticulations=function(b){return a.hasIncompatibleArticulations(b,this.opts.articulationType)},g.removeIncompatibleArticulations=function(b){a.getIncompatibleArticulations(b,this.opts.articulationType).forEach(function(a){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,articulationType:a,noteIdx:this.opts.noteIdx},d=new c(this.measureData,b,this.cancelStack);d.checkPreconditions(),d.perform()},this)},g.removeIncompatibleNotations=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,notationType:e.FERMATA,noteIdx:this.opts.noteIdx},b=new d(this.measureData,a,this.cancelStack);b.checkPreconditions(),b.perform()}}.call(this),function(){"use strict";var a=Adagio.Error.value.AlreadyHasArticulationError,b=Adagio.Error.value.BadArticulationTypeError,c=Adagio.Utils.noteUtils,d=Adagio.Values.ArticulationType,e=Adagio.edit.composite.AddArticulation,f=Adagio.edit.common.convertTimePosToGetNoteIdx,g=Adagio.edit.common.initMeasureData,h=Adagio.edit.common.convertPartUuidToGetPartIdx,i=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,j=Adagio.edit.action.AddArticulations=function(a,b,c){this.init(a,b,c)};j.NAME="action.AddArticulations";var k=j.prototype;k.initMeasureData=g,k.name=j.NAME,k.init=function(a,b,c){h(a,b),i(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,f(this.measureData,this.opts),this.location=null},k.checkPreconditions=function(){this.checkLocation(),this.checkParam()},k.checkLocation=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx);var a=this.measureData.getVoice(this.opts.voiceIdx);a.checkNoteIdx(this.opts.noteIdx),a.checkNotRest(this.opts.noteIdx)},k.checkParam=function(){if(!d.isValid(this.opts.articulationType))throw new b(this.opts.articulationType);var e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getNote(this.opts.noteIdx);if(c.hasArticulations(f)&&c.hasArticulation(f,this.opts.articulationType))throw new a(this.opts.articulationType)},k.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,articulationType:this.opts.articulationType,noteIdx:this.opts.noteIdx};new e(this.measureData,a,this.cancelStack).perform(),this.updateStack()},k.updateStack=function(){var a=this.getLocation(),b={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,articulationType:this.opts.articulationType,timePos:a.timePos,divisions:a.dpq}};this.cancelStack.push(b)},k.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,articulationType:this.opts.articulationType,timePos:a.timePos,divisions:a.dpq}};this.cancelStack.storeAction(b)}},k.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.AlreadyHasTechnicalError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="AlreadyHasTechnicalError",this.stack=e.stack,this.message=e.message,this.technicalType=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"Note already has Technical "+a}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.edit.common.initMeasureData,c=Adagio.edit.primitive.AddTechnical=function(a,b,c){this.init(a,b,c)};c.NAME="primitive.AddTechnical";var d=c.prototype;d.name=c.NAME,d.initMeasureData=b,d.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},d.perform=function(){var b=this.measureData.getVoice(this.opts.voiceIdx),c=b.getNote(this.opts.noteIdx);a.addTechnical(c,this.opts.technicalType,this.opts.technicalOpts),this.updateStack()},d.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,technicalType:this.opts.technicalType,noteIdx:this.opts.noteIdx}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.edit.primitive.AddTechnical,c=Adagio.edit.action.RemoveTechnical,d=Adagio.edit.composite.AddTechnical=function(a,b,c){this.init(a,b,c)};d.NAME="composite.AddTechnical";var e=d.prototype;e.name=d.NAME,e.init=function(a,b,c){this.measureData=a,this.cancelStack=c,this.opts=b},e.perform=function(){var a=this.measureData.getVoice(this.opts.voiceIdx),c=a.getNote(this.opts.noteIdx);this.hasIncompatibleTechnical(c)&&this.removeIncompatibleTechnical(c),new b(this.measureData,this.opts,this.cancelStack).perform()},e.hasIncompatibleTechnical=function(b){return a.hasIncompatibleTechnical(b,this.opts.technicalType,this.opts.technicalOpts)},e.removeIncompatibleTechnical=function(b){a.getIncompatibleTechnical(b,this.opts.technicalType,this.opts.technicalOpts).forEach(function(a){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,technicalType:a,noteIdx:this.opts.noteIdx},d=new c(this.measureData,b,this.cancelStack);d.checkPreconditions(),d.perform()},this)}}.call(this),function(){"use strict";var a=Adagio.Error.value.AlreadyHasTechnicalError,b=Adagio.Error.value.BadTechnicalTypeError,c=Adagio.Error.value.BadTechnicalOptsError,d=Adagio.Utils.noteUtils,e=Adagio.Values.TechnicalType,f=Adagio.edit.composite.AddTechnical,g=Adagio.edit.common.initMeasureData,h=Adagio.edit.common.convertTimePosToGetNoteIdx,i=Adagio.edit.common.convertPartUuidToGetPartIdx,j=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,k=Adagio.edit.action.AddTechnical=function(a,b,c){this.init(a,b,c)};k.NAME="action.AddTechnical";var l=k.prototype;l.initMeasureData=g,l.name=k.NAME,l.init=function(a,b,c){i(a,b),j(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.location=null,this.sanitized=!1,h(this.measureData,this.opts)},l.checkPreconditions=function(){this.checkLocation(),this.checkContentOpts(),this.checkParam(),this.sanitizeIfNeeded()},l.checkLocation=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx);var a=this.measureData.getVoice(this.opts.voiceIdx);a.checkNoteIdx(this.opts.noteIdx),a.checkNotRest(this.opts.noteIdx)},l.checkContentOpts=function(){this.opts.technicalType},l.checkTechnicalOpts=function(){if(void 0===this.opts.technicalOpts)throw new c("technicalOpts")},l.checkParam=function(){if(!e.isCommonValid(this.opts.technicalType))throw new b(this.opts.technicalType);var c=this.measureData.getVoice(this.opts.voiceIdx),f=c.getNote(this.opts.noteIdx);if(d.hasTechnicals(f)&&d.hasTechnical(f,this.opts.technicalType,this.opts.technicalOpts))throw new a(this.opts.technicalType)},l.sanitizeIfNeeded=function(){this.sanitized||(void 0===this.opts.record&&(this.opts.record=!0),this.sanitized=!0)},l.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,technicalType:this.opts.technicalType,technicalOpts:this.opts.technicalOpts,noteIdx:this.opts.noteIdx};new f(this.measureData,a,this.cancelStack).perform(),this.opts.record&&this.updateStack()},l.updateStack=function(){var a=this.getLocation(),b={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,timePos:a.timePos,divisions:a.dpq,technicalType:this.opts.technicalType}};this.cancelStack.push(b)},l.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,timePos:a.timePos,divisions:a.dpq,technicalType:this.opts.technicalType,technicalOpts:this.opts.technicalOpts}};this.cancelStack.storeAction(b)}},l.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadDirectionBarlineError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadDirectionBarlineError",this.stack=e.stack,this.message=e.message,this.direction=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"Barline direction value "+a+" is invalid."}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.measureUtils,c=Adagio.edit.values.PosBarline,d=Adagio.edit.primitive.RemoveBarline=function(a,b,c){this.init(a,b,c)};d.NAME="primitive.RemoveBarline";var e=d.prototype;e.name=d.NAME,e.init=function(a,b,c){this.scoreData=a,this.opts=b,this.cancelStack=c},e.perform=function(){this.removeBarline(),this.updateStack()},e.removeBarline=function(){var d=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx);if(this.opts.side===c.LEFT)b.removeLeftBarline(d);else{if(this.opts.side!==c.RIGHT)throw new a("Unexpected");b.removeRightBarline(d)}},e.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.edit.primitive.RemoveBarline,b=Adagio.edit.composite.RemoveBarline=function(a,b,c){this.init(a,b,c)};b.NAME="composite.RemoveBarline";var c=b.prototype;c.name=b.NAME,c.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},c.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removePartsBarlines()},c.removePartsBarlines=function(){for(var a=this.scoreData.getNbParts(),b=0;b<a;b++)this.removePartBarline(b)},c.removePartBarline=function(b){var c={partIdx:b,measureIdx:this.opts.measureIdx,side:this.opts.side};new a(this.scoreData,c,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadSideBarlineError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadSideBarlineError",this.stack=e.stack,this.message=e.message,this.side=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"Barline side value "+a+"is invalid."}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.barlinesUtils,c=Adagio.Utils.barlineUtils,d=Adagio.Utils.measureUtils,e=Adagio.edit.values.PosBarline,f=Adagio.edit.primitive.RemoveBarline,g=Adagio.edit.primitive.AddBarline=function(a,b,c){this.init(a,b,c)};g.NAME="primitive.AddBarline";var h=g.prototype;h.name=g.NAME,h.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},h.perform=function(){this.addBarline(),this.updateStack()},h.addBarline=function(){var a=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx);this.removeFormer(a);var e=d.getBarlines(a),f=c.createBarline(this.opts.side,this.opts.style);b.addBarline(e,f),d.setBarlines(a,e)},h.removeFormer=function(b){var c=d.getBarlines(b);if(this.opts.side===e.LEFT)this.removeFormerLeft(c);else{if(this.opts.side!==e.RIGHT)throw new a("Unexpected");this.removeFormerRight(c)}},h.removeFormerLeft=function(a){if(b.hasLeft(a)){var c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,side:this.opts.side};new f(this.scoreData,c,this.cancelStack).perform()}},h.removeFormerRight=function(a){if(b.hasRight(a)){var c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,side:this.opts.side};new f(this.scoreData,c,this.cancelStack).perform()}},h.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.edit.primitive.AddBarline,b=Adagio.edit.composite.AddBarline=function(a,b,c){this.init(a,b,c)};b.NAME="composite.AddBarline";var c=b.prototype;c.name=b.NAME,c.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},c.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.addPartsBarlines()},c.addPartsBarlines=function(){for(var a=this.scoreData.getNbParts(),b=0;b<a;b++)this.addPartBarline(b)},c.addPartBarline=function(b){var c={partIdx:b,measureIdx:this.opts.measureIdx,side:this.opts.side,style:this.opts.style};new a(this.scoreData,c,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Utils.barlineUtils,b=Adagio.Values.SoundType;Adagio.edit.common.getNormalRightBarlineStyle=function(c,d){if(d===c.getNbMeasures()-1)return a.FINAL;if(c.hasJumpCall(d)){if(c.getJumpCall(d)===b.FINE)return a.FINAL}return a.DEFAULT_STYLE}}.call(this),function(){"use strict";var a=Adagio.edit.composite.AddBarline,b=Adagio.edit.composite.RemoveBarline,c=Adagio.edit.values.PosBarline,d=Adagio.edit.common.getNormalRightBarlineStyle,e=Adagio.Utils.barlineUtils,f=Adagio.edit.composite.ClearRightBarline=function(a,b,c){this.init(a,b,c)};f.NAME="action.ClearRightBarline";var g=f.prototype;g.name=f.NAME,g.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},g.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a=this.getNormalRightBarlineStyle();if(a===e.FINAL)this.addFinalBarline();else{if(a!==e.DEFAULT_STYLE)throw new InternalError("Unexpected");this.removeBarline()}},g.getNormalRightBarlineStyle=function(){var a=this.scoreData.getCommonContent();return d(a,this.opts.measureIdx)},g.addFinalBarline=function(){var b={measureIdx:this.opts.measureIdx,side:c.RIGHT,style:"light-heavy"};new a(this.scoreData,b,this.cancelStack).perform()},g.removeBarline=function(){var a={measureIdx:this.opts.measureIdx,side:c.RIGHT};new b(this.scoreData,a,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Error.noChange.NoChangeError,c=Adagio.Error.client.BadMeasureIdxError,d=Adagio.Error.value.BadDirectionBarlineError,e=Adagio.Utils.barlinesUtils,f=Adagio.Utils.repeatUtils,g=Adagio.Utils.measureUtils,h=Adagio.edit.composite.RemoveBarline,i=Adagio.edit.composite.ClearRightBarline,j=Adagio.edit.values.PosBarline,k=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,l=Adagio.edit.action.RemoveRepeat=function(a,b,c){this.init(a,b,c)};l.NAME="action.RemoveRepeat";var m=l.prototype;m.name=l.NAME,m.init=function(a,b,c){k(a,b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.location=null},m.checkPreconditions=function(){this.checkLocation(),this.checkType(),this.checkExistence()},m.checkLocation=function(){
var a=this.opts.measureIdx,b=this.scoreData.getNbMeasures();if(a<0||a>=b)throw new c(a)},m.checkType=function(){if(!f.isValidDirection(this.opts.direction))throw new d(this.opts.direction)},m.checkExistence=function(){var c=0,d=this.scoreData.getMeasure(c,this.opts.measureIdx),h=g.getBarlines(d);if(this.opts.direction===f.DIRECTION_FORWARD){if(!e.hasRepeatForward(h))throw new b}else{if(this.opts.direction!==f.DIRECTION_BACKWARD)throw new a("Unexpected");if(!e.hasRepeatBackward(h))throw new b}},m.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.removeBarline(),this.opts.direction===f.DIRECTION_BACKWARD&&this.clearRightBarline(),this.updateStack()},m.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{measureUuid:a.measureUuid,direction:this.opts.direction}};this.cancelStack.storeAction(b)}},m.removeBarline=function(){var a={measureIdx:this.opts.measureIdx,side:this.getSide()};new h(this.scoreData,a,this.cancelStack).perform()},m.getSide=function(){if(this.opts.direction===f.DIRECTION_FORWARD)return j.LEFT;if(this.opts.direction===f.DIRECTION_BACKWARD)return j.RIGHT;throw new a("Unexpected")},m.clearRightBarline=function(){var a={measureIdx:this.opts.measureIdx};new i(this.scoreData,a,this.cancelStack).perform()},m.updateStack=function(){var a=this.getLocation(),b={type:this.name,noDraw:!0,opts:{measureUuid:a.measureUuid,direction:this.opts.direction}};this.cancelStack.push(b)},m.getLocation=function(){if(null===this.location){var a=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={measureUuid:a}}return this.location}}.call(this),function(){"use strict";Adagio.edit.values.DirectionBarline={BACKWARD:"backward",FORWARD:"forward"}}.call(this),function(){"use strict";var a=Adagio.Error.noChange.NoChangeError,b=Adagio.Error.client.BadMeasureIdxError,c=Adagio.Utils.measureUtils,d=Adagio.Utils.barlineUtils,e=Adagio.edit.composite.RemoveBarline,f=Adagio.edit.composite.ClearRightBarline,g=Adagio.edit.values.PosBarline,h=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,i=Adagio.edit.action.RemoveDoubleBarline=function(a,b,c){this.init(a,b,c)};i.NAME="action.RemoveDoubleBarline";var j=i.prototype;j.name=i.NAME,j.init=function(a,b,c){h(a,b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.location=null},j.checkPreconditions=function(){this.checkLocation(),this.checkExistence()},j.checkLocation=function(){var a=this.opts.measureIdx,c=this.scoreData.getNbMeasures();if(a<0||a>=c)throw new b(a)},j.checkExistence=function(){if(!this.hasDoubleBarline())throw new a},j.hasDoubleBarline=function(){var a=0,b=this.scoreData.getMeasure(a,this.opts.measureIdx);return!!c.hasRightBarline(b)&&c.getRightBarlineStyle(b)===d.DOUBLE_LIGHT},j.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.removeBarline(),this.clearRightBarline(),this.updateStack()},j.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{measureUuid:a.measureUuid,direction:this.opts.direction}};this.cancelStack.storeAction(b)}},j.removeBarline=function(){var a={measureIdx:this.opts.measureIdx,side:g.RIGHT};new e(this.scoreData,a,this.cancelStack).perform()},j.clearRightBarline=function(){var a={measureIdx:this.opts.measureIdx};new f(this.scoreData,a,this.cancelStack).perform()},j.updateStack=function(){var a=this.getLocation(),b={type:this.name,noDraw:!0,opts:{measureUuid:a.measureUuid,direction:this.opts.direction}};this.cancelStack.push(b)},j.getLocation=function(){if(null===this.location){var a=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={measureUuid:a}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.value.BadSideBarlineError,b=Adagio.Error.client.BadMeasureIdxError,c=Adagio.Error.noChange.NoChangeError,d=Adagio.Error.InternalError,e=Adagio.Utils.barlineUtils,f=Adagio.Utils.repeatUtils,g=Adagio.Utils.math,h=Adagio.edit.action.RemoveRepeat,i=Adagio.edit.action.RemoveDoubleBarline,j=Adagio.edit.values.PosBarline,k=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,l=Adagio.edit.common.assertPerform,m=Adagio.edit.action.RemoveBarline=function(a,b,c){this.init(a,b,c)};m.NAME="action.RemoveBarline";var n=m.prototype;n.name=m.NAME,n.init=function(a,b,c){k(a,b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.location=null},n.checkPreconditions=function(){this.checkLocation(),this.checkAction()},n.checkLocation=function(){var c=this.opts.measureIdx,d=this.scoreData.getNbMeasures();if(!g.isInteger(c)||c<0||c>=d)throw new b(c);if(!e.isValidLocation(this.opts.side))throw new a(this.opts.side)},n.checkAction=function(){if(this.opts.side===j.LEFT)this.initLeftAction();else{if(this.opts.side!==j.RIGHT)throw new d("Unexpected");this.initRightAction()}},n.initRightAction=function(){if(this.action=null,this.action=this.initRemoveDoubleBarline(),null===this.action&&(this.action=this.initRemoveRepeatRight(),null===this.action))throw new c},n.initRemoveDoubleBarline=function(){var a={measureIdx:this.opts.measureIdx},b=null,c=new i(this.scoreData,a,b);return this.tryAction(c)},n.initRemoveRepeatRight=function(){var a={measureIdx:this.opts.measureIdx,direction:f.DIRECTION_BACKWARD},b=null,c=new h(this.scoreData,a,b);return this.tryAction(c)},n.initLeftAction=function(){if(this.action=null,this.action=this.initRemoveRepeatLeft(),null===this.action)throw new c},n.initRemoveRepeatLeft=function(){var a={measureIdx:this.opts.measureIdx,direction:f.DIRECTION_FORWARD},b=null,c=new h(this.scoreData,a,b);return this.tryAction(c)},n.tryAction=function(a){try{a.checkPreconditions()}catch(b){if(b instanceof c)return null;l.requalifyException(a,b)}return a},n.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeBarline()},n.removeBarline=function(){this.action.cancelStack=this.cancelStack,this.action.perform()}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadMeasureIdxError,b=Adagio.Error.value.BadDirectionBarlineError,c=Adagio.Error.noChange.NoChangeError,d=Adagio.Error.InternalError,e=Adagio.Utils.barlineUtils,f=Adagio.Utils.repeatUtils,g=Adagio.Utils.measureUtils,h=Adagio.edit.action.RemoveBarline,i=Adagio.edit.composite.RemoveBarline,j=Adagio.edit.values.DirectionBarline,k=Adagio.edit.values.PosBarline,l=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,m=Adagio.edit.common.assertPerform,n=Adagio.edit.action.AddRepeat=function(a,b,c){this.init(a,b,c)};n.NAME="action.AddRepeat";var o=n.prototype;o.name=n.NAME,o.init=function(a,b,c){l(a,b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.location=null},o.checkPreconditions=function(){this.checkLocation(),this.checkType()},o.checkLocation=function(){var b=this.opts.measureIdx,c=this.scoreData.getNbMeasures();if(b<0||b>=c)throw new a(b)},o.checkType=function(){if(!f.isValidDirection(this.opts.direction))throw new b(this.opts.direction)},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.removeFormerBarline(),this.shouldClearBarline()&&this.clearBarline(),this.addRepeat(),this.updateStack()},o.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{measureUuid:a.measureUuid,direction:this.opts.direction}};this.cancelStack.storeAction(b)}},o.removeFormerBarline=function(){var a=this.getSide(),b={measureIdx:this.opts.measureIdx,side:a},c=new h(this.scoreData,b,this.cancelStack);m(c,p)};var p=function(a){return a instanceof c};o.shouldClearBarline=function(){var a=0,b=this.scoreData.getMeasure(a,this.opts.measureIdx);return this.opts.direction===j.BACKWARD&&g.hasRightBarline(b)||this.opts.direction===j.FORWARD&&g.hasLeftBarline(b)},o.clearBarline=function(){var a=this.getSide(),b={measureIdx:this.opts.measureIdx,side:a};new i(this.scoreData,b,this.cancelStack).perform()},o.getSide=function(){if(this.opts.direction===j.BACKWARD)return k.RIGHT;if(this.opts.direction===j.FORWARD)return k.LEFT;throw new d("Unexpected")},o.addRepeat=function(){for(var a=this.scoreData.getNbParts(),b=0;b<a;b++){var c,d=this.scoreData.getMeasure(b,this.opts.measureIdx);c=this.opts.direction===j.BACKWARD?e.createBackwardRepeat():e.createForwardRepeat(),g.addBarline(d,c),this.updateStackRedraw(b)}},o.updateStackRedraw=function(a){var b={type:this.name+"-subPart",opts:{partIdx:a,measureIdx:this.opts.measureIdx,direction:this.opts.direction}};this.cancelStack.push(b)},o.updateStack=function(){var a=this.getLocation(),b={type:this.name,noDraw:!0,opts:{measureUuid:a.measureUuid,direction:this.opts.direction}};this.cancelStack.push(b)},o.getLocation=function(){if(null===this.location){var a=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={measureUuid:a}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadRehearsalContentError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadRehearsalContentError",this.stack=e.stack,this.message=e.message,this.rehearsal=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"The rebearsal content ["+a+"] is invalid."}}.call(this),function(){"use strict";var a=Adagio.Error.value.BadRehearsalContentError,b=Adagio.Error.InternalError,c=Adagio.Utils.math,d=Adagio.Values.RehearsalType,e=Adagio.Values.RehearsalContent={};e.check=function(a,b){a===d.AUTO?e.checkAuto(b):a===d.MEASURE_NUMBER||d.raiseError(a)};var f=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];e.checkAuto=function(b){if(!e.isValid(b))throw new a(b)},e.isValid=function(a){return"string"==typeof a&&""!==a.trim(a)},e.getMaxIndex=function(){return f.length-1},e.indexToLetter=function(a){if(!c.isInteger(a)||a<0||a>=f.length){throw new b("InvalidRehearsalIndex","The rehearsal index ["+a+"] is invalid.")}return f[a]}}.call(this),function(){"use strict";var a=Adagio.Data.common.CommonContent;Adagio.edit.common.getCommonContent=function(b){return b instanceof a?b:b.getCommonContent()}}.call(this),function(){"use strict";var a=Adagio.edit.common.getCommonContent,b=Adagio.edit.primitive.RemoveRehearsal=function(a,b,c){this.init(a,b,c)};b.NAME="primitive.RemoveRehearsal";var c=b.prototype;c.name=b.NAME,c.init=function(b,c,d){this.commonContent=a(b),this.cancelStack=d,this.opts=c},c.perform=function(){this.removeRehearsal(),this.updateStack()},c.removeRehearsal=function(){this.commonContent.removeRehearsal(this.opts.measureIdx)},c.updateStack=function(){var a={type:this.name,opts:{partIdx:0,measureIdx:this.opts.measureIdx}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadMeasureIdxError,b=Adagio.Error.noChange.NoChangeError,c=Adagio.edit.primitive.RemoveRehearsal,d=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,e=Adagio.Utils.rehearsalUtils,f=Adagio.edit.action.RemoveRehearsal=function(a,b,c){this.init(a,b,c)};f.NAME="action.RemoveRehearsal";var g=f.prototype;g.name=f.NAME,g.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,d(this.scoreData,b),this.location=null},g.checkPreconditions=function(){this.checkLocation(),this.checkHasRehearsal()},g.checkLocation=function(){var b=this.scoreData.getNbMeasures(),c=this.opts.measureIdx;if(c<0||c>=b)throw new a(c,a.GET)},g.checkHasRehearsal=function(){if(!this.scoreData.getCommonContent().hasRehearsal(this.opts.measureIdx))throw new b},g.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a=this.getPreviousData();this.storeAction(),this.removeRehearsal(),this.updateStack(a)},g.getPreviousData=function(){var a=this.scoreData.getCommonContent(),b=a.getRehearsal(this.opts.measureIdx);return{rehearsal:e.getText(b),type:e.getType(b)}},g.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{measureUuid:a.measureUuid}};this.cancelStack.storeAction(b)}},g.removeRehearsal=function(){var a={measureIdx:this.opts.measureIdx};new c(this.scoreData,a,this.cancelStack).perform()},g.updateStack=function(a){var b=this.getLocation(),c={type:this.name,noDraw:!0,opts:{measureUuid:b.measureUuid,rehearsal:a.rehearsal,type:a.type}};this.cancelStack.push(c)},g.getLocation=function(){if(null===this.location){var a=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={measureUuid:a}}return this.location}}.call(this),function(){"use strict";var a=Adagio.edit.common.getCommonContent,b=Adagio.Utils.rehearsalUtils,c=Adagio.edit.primitive.AddRehearsal=function(a,b,c){this.init(a,b,c)};c.NAME="primitive.AddRehearsal";var d=c.prototype;d.name=c.NAME,d.init=function(b,c,d){this.commonContent=a(b),this.cancelStack=d,this.opts=c},d.perform=function(){this.addRehearsal(),this.updateStack()},d.addRehearsal=function(){var a=b.create(this.opts.rehearsal,this.opts.type);this.commonContent.setRehearsal(this.opts.measureIdx,a)},d.updateStack=function(){var a={type:this.name,opts:{partIdx:0,measureIdx:this.opts.measureIdx}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.edit.action.RemoveRehearsal,b=Adagio.edit.primitive.AddRehearsal,c=Adagio.edit.common.assertPerform,d=Adagio.edit.composite.AddRehearsal=function(a,b,c){this.init(a,b,c)};d.NAME="composite.AddRehearsal";var e=d.prototype;e.name=d.NAME,e.init=function(a,b,c){this.scoreData=a,this.opts=b,this.cancelStack=c},e.getCommonContent=function(){return this.scoreData.getCommonContent()},e.perform=function(){this.getCommonContent().hasRehearsal(this.opts.measureIdx)&&this.removeCurrentRehearsal();var a={measureIdx:this.opts.measureIdx,rehearsal:this.opts.rehearsal,type:this.opts.type};new b(this.scoreData,a,this.cancelStack).perform()},e.removeCurrentRehearsal=function(){var b={measureIdx:this.opts.measureIdx},d=new a(this.scoreData,b,this.cancelStack);c(d)}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadMeasureIdxError,b=Adagio.Utils.math,c=Adagio.Values.RehearsalContent,d=Adagio.Values.RehearsalType,e=Adagio.edit.composite.AddRehearsal,f=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,g=Adagio.edit.action.AddRehearsal=function(a,b,c){this.init(a,b,c)};g.NAME="action.AddRehearsal";var h=g.prototype;h.name=g.NAME,h.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,f(a,b),this.location=null},h.checkPreconditions=function(){this.checkLocation(),void 0===this.opts.type&&(this.opts.type=d.DEFAULT),d.check(this.opts.type),c.check(this.opts.type,this.opts.rehearsal)},h.checkLocation=function(){var c=this.scoreData.getNbMeasures(),d=this.opts.measureIdx;if(!b.isInteger(d)||d<0||d>=c)throw new a(d,a.GET)},h.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.addRehearsal(),this.updateStack()},h.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{measureUuid:a.measureUuid,rehearsal:this.opts.rehearsal,type:this.opts.type}};this.cancelStack.storeAction(b)}},h.addRehearsal=function(){var a={measureIdx:this.opts.measureIdx,rehearsal:this.opts.rehearsal,type:this.opts.type};new e(this.scoreData,a,this.cancelStack).perform()},h.updateStack=function(){var a=this.getLocation(),b={type:this.name,noDraw:!0,opts:{measureUuid:a.measureUuid}};this.cancelStack.push(b)},h.getLocation=function(){if(null===this.location){var a=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={measureUuid:a}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.NotAutoRehearsalError=function(){var b="The selected rehearsal value is not `auto`.",c=a.call(this,b);return this.name=c.name="NotAutoRehearsalError",this.stack=c.stack,this.message=c.message,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}})}.call(this),function(){"use strict";var a=Adagio.Utils.rehearsalUtils;Adagio.edit.common.extractRehearsalList=function(b,c){void 0===c&&(c=null);for(var d=b.getNbMeasures(),e=[],f=0;f<d;f++){var g=e.length;if(f===c||b.hasRehearsalAuto(f)){var h={measureIdx:f,index:g,value:null,input:!1};if(f===c&&(h.input=!0),b.hasRehearsalAuto(f)){var i=b.getRehearsal(f);h.value=a.getText(i)}e.push(h)}}return e}}.call(this),function(){"use strict";var a=Adagio.Values.RehearsalContent,b=Adagio.edit.action.AddRehearsal,c=Adagio.edit.action.RemoveRehearsal;Adagio.edit.common.fillRehearsalsActions=function(a){a.forEach(d)};var d=function(d,f,g){var h=a.getMaxIndex();if(d.Action=null,d.index>h){if(!d.input)return void(d.Action=c);e(g,f),d.index=h}var i=a.indexToLetter(d.index);d.value!==i&&(d.value=i,d.Action=b)},e=function(b,d){var e=a.getMaxIndex();for(d--;d>=0;d--){var f=b[d];if(!(f.index>=e))return;f.Action=c}}}.call(this),function(){"use strict";var a=Adagio.Error.client.NotAutoRehearsalError,b=Adagio.Values.RehearsalType,c=Adagio.edit.action.AddRehearsal,d=Adagio.edit.action.RemoveRehearsal,e=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,f=Adagio.edit.common.extractRehearsalList,g=Adagio.edit.common.fillRehearsalsActions,h=Adagio.edit.common.assertPerform,i=Adagio.edit.action.RemoveRehearsalWithUpdate=function(a,b,c){this.init(a,b,c)};i.NAME="action.RemoveRehearsalWithUpdate";var j=i.prototype;j.name=i.NAME,j.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,e(this.scoreData,b),this.location=null,this.removeAction=null},j.checkPreconditions=function(){this.checkRemoveAction(),this.checkAutoRehearsal()},j.checkRemoveAction=function(){this.getRemoveAction().checkPreconditions()},j.checkAutoRehearsal=function(){if(!this.scoreData.getCommonContent().hasRehearsalAuto(this.opts.measureIdx))throw new a},j.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.performRemoveAction(),this.updateRehearsals()},j.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{measureUuid:a.measureUuid}};this.cancelStack.storeAction(b)}},j.getLocation=function(){if(null===this.location){var a=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={measureUuid:a}}return this.location},j.performRemoveAction=function(){var a=this.getRemoveAction();a.cancelStack=this.cancelStack,a.perform()},j.getRemoveAction=function(){if(null===this.removeAction){var a={measureIdx:this.opts.measureIdx};this.removeAction=new d(this.scoreData,a,null)}return this.removeAction},j.updateRehearsals=function(){this.getList().forEach(this.performAction,this)},j.getList=function(){var a=this.scoreData.getCommonContent(),b=f(a);return g(b),b=b.filter(k)};var k=function(a){return null!==a.Action};j.performAction=function(a){var d={measureIdx:a.measureIdx};a.Action===c&&(d.rehearsal=a.value,d.type=b.AUTO);var e=new a.Action(this.scoreData,d,this.cancelStack);h(e)}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadMeasureIdxError,b=Adagio.Error.noChange.NoChangeError,c=Adagio.edit.action.RemoveRehearsal,d=Adagio.edit.action.RemoveRehearsalWithUpdate,e=Adagio.edit.common.assertPerform,f=Adagio.edit.action.RemoveRehearsalMain=function(a,b,c){this.init(a,b,c)};f.NAME="action.RemoveRehearsalMain";var g=f.prototype;g.name=f.NAME,g.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.location=null},g.checkPreconditions=function(){this.checkLocation(),this.checkHasRehearsal()},g.checkLocation=function(){var b=this.scoreData.getNbMeasures(),c=this.opts.measureIdx;if(c<0||c>=b)throw new a(c,a.GET)},g.checkHasRehearsal=function(){if(!this.scoreData.getCommonContent().hasRehearsal(this.opts.measureIdx))throw new b},g.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.performAction()},g.performAction=function(){var a=this.getActionConstructor(),b={measureIdx:this.opts.measureIdx},c=new a(this.scoreData,b,this.cancelStack);e(c)},g.getActionConstructor=function(){return this.isRehearsalAuto()?d:c},g.isRehearsalAuto=function(){return this.scoreData.getCommonContent().hasRehearsalAuto(this.opts.measureIdx)}}.call(this),function(){"use strict";var a=Adagio.Error.noChange.NoChangeError,b=Adagio.Values.RehearsalType,c=Adagio.edit.action.AddRehearsal,d=Adagio.edit.action.RemoveRehearsalMain,e=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,f=Adagio.edit.common.assertPerform,g=Adagio.edit.action.AddRehearsalMeasureNumber=function(a,b,c){this.init(a,b,c)};g.NAME="action.AddRehearsalMeasureNumber";var h=g.prototype;h.name=g.NAME,h.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,e(a,b),this.location=null,this.action=null},h.checkPreconditions=function(){this.getAction().checkPreconditions()},h.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.removeFormerRehearsal(),this.addRehearsal()},h.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{measureUuid:a.measureUuid}};this.cancelStack.storeAction(b)}},h.getLocation=function(){if(null===this.location){var a=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={measureUuid:a}}return this.location},h.removeFormerRehearsal=function(){var a={measureIdx:this.opts.measureIdx},b=new d(this.scoreData,a,this.cancelStack);f(b,i)};var i=function(b){return b instanceof a};h.addRehearsal=function(){var a=this.getAction();a.cancelStack=this.cancelStack,a.perform()},h.getAction=function(){if(null===this.action){var a={measureIdx:this.opts.measureIdx,rehearsal:"",type:b.MEASURE_NUMBER};this.action=new c(this.scoreData,a,null)}return this.action},h.updateStack=function(){var a=this.getLocation(),b={type:this.name,noDraw:!0,opts:{measureUuid:a.measureUuid}};this.cancelStack.push(b)}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadMeasureIdxError,b=Adagio.Error.noChange.NoChangeError,c=Adagio.Utils.math,d=Adagio.Values.RehearsalType,e=Adagio.edit.action.AddRehearsal,f=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,g=Adagio.edit.common.extractRehearsalList,h=Adagio.edit.common.fillRehearsalsActions,i=Adagio.edit.common.assertPerform,j=Adagio.edit.action.AddRehearsalWithUpdate=function(a,b,c){this.init(a,b,c)};j.NAME="action.AddRehearsalWithUpdate";var k=j.prototype;k.name=j.NAME,k.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,f(a,b),this.location=null,this.list=null},k.checkPreconditions=function(){if(this.checkLocation(),0===this.getList().length)throw new b},k.checkLocation=function(){var b=this.scoreData.getNbMeasures(),d=this.opts.measureIdx;if(!c.isInteger(d)||d<0||d>=b)throw new a(d,a.GET)},k.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.performActions()},k.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{measureUuid:a.measureUuid}};this.cancelStack.storeAction(b)}},k.performActions=function(){this.getList().forEach(this.performAction,this)},k.performAction=function(a){var b={measureIdx:a.measureIdx};a.Action===e&&(b.rehearsal=a.value,b.type=d.AUTO);var c=new a.Action(this.scoreData,b,this.cancelStack);i(c)},k.getList=function(){if(null===this.list){var a=this.scoreData.getCommonContent(),b=g(a,this.opts.measureIdx);h(b),b=b.filter(l),this.list=b}return this.list};var l=function(a){return null!==a.Action};k.getLocation=function(){if(null===this.location){var a=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={measureUuid:a}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.NoPitchesError=function(){var b=c(),d=a.call(this,b);return this.name=d.name="NoPitchesError",this.stack=d.stack,this.message=d.message,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(){return"You must provide at least one pitch."}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.TimePosOutOfRangeError=function(b,d){var e=c(b,d),f=a.call(this,e);return this.name=f.name="TimePosOutOfRangeError",this.stack=f.stack,this.message=f.message,this.timePos=b,this.dpq=d,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a,b){return"The quarter time position ["+a+"/"+b+"] is out of the measure range."}}.call(this),function(){"use strict";var a=Adagio.Error.client.TimePosOutOfRangeError,b=Adagio.Utils.math,c=Adagio.Utils.measureUtils;Adagio.edit.common.checkNoteTimePos=function(d,e,f){if(!b.isInteger(e)||e<0)throw new a(e,f);if(!b.isInteger(f)||f<=0)throw new a(e,f);var g=c.getDpq(d),h=c.getNbDivisions(d),i=b.lcm(g,f);if(e*=i/f,h*=i/g,e<0||e>=h)throw new a(e,i)}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.edit.action.ChangeDuration,c=Adagio.edit.action.FormatRests,d=Adagio.edit.common.convertTimePosToGetNoteIdx,e=Adagio.edit.common.initMeasureData,f=Adagio.edit.common.convertPartUuidToGetPartIdx,g=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,h=Adagio.edit.action.ChangeDurationFormat=function(a,b,c){this.init(a,b,c)};h.NAME="action.ChangeDurationFormat",h.isNoChange=b.isNoChange;var i=h.prototype;i.initMeasureData=e,i.name=h.NAME,i.init=function(a,b,c){f(a,b),g(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,d(this.measureData,this.opts),this.action=null,this.location=null},i.checkPreconditions=function(){this.getAction().checkPreconditions()},i.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.changeDuration(),this.opts.formatRests&&this.formatRests()},i.changeDuration=function(){var a=this.getAction();a.cancelStack=this.cancelStack,a.perform()},i.getAction=function(){if(null===this.action){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,durationType:this.opts.durationType,nbDots:this.opts.nbDots,insertMode:this.opts.insertMode,record:this.opts.record};this.action=new b(this.measureData,a,this.cancelStack)}return this.action},i.formatRests=function(){var b=this.getVoiceOrTupletForGet();if(this.opts.noteIdx!==b.getStopNoteIdx()){var d=b.getNote(this.opts.noteIdx+1);if(!a.hasTupletStart(d)){var e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx+1};new c(this.measureData,e,this.cancelStack).performIfPossible()}}},i.getVoiceOrTupletForGet=function(){var a=this.opts.voiceIdx,b=this.opts.noteIdx;return this.measureData.getVoiceOrTupletForGet(a,b)},i.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,timePos:a.timePos,divisions:a.dpq,durationType:this.opts.durationType,nbDots:this.opts.nbDots,insertMode:this.opts.insertMode,formatRests:this.opts.formatRests||!1}};this.cancelStack.storeAction(b)}},i.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Utils.timeModifUtils,c=Adagio.Error.client.TimePosIncompatibleError=function(c){var e=d(c),f=a.call(this,e);return this.name=f.name="TimePosIncompatibleError",this.stack=f.stack,this.message=f.message,this.timeModif=b.copy(c),this},d=function(a){return"The time modification ["+b.stringify(a)+"] is not compatible with the local one."};c.prototype=Object.create(a.prototype,{constructor:{value:c}})}.call(this),function(){"use strict";var a=Adagio.edit.common.calcDuration,b=Adagio.edit.common.timePosToFloorNoteIdx,c=Adagio.edit.values.InsertMode,d=Adagio.Error.client.NotEnoughSpaceError,e=Adagio.Error.client.BadTimePosError,f=Adagio.Error.client.TimePosIncompatibleError,g=Adagio.Error.InternalError,h=Adagio.Utils.math,i=Adagio.Utils.timeModifUtils,j=Adagio.Utils.durationUtils,k=Adagio.Utils.measureUtils;Adagio.edit.common.checkSpaceForAdd=function(a,b){l(a,b)?m(a,b):r(a,b)};var l=function(a,b){return a.hasVoice(b.voiceIdx)},m=function(a,b){b=n(a,b);var e;if(b.insertMode===c.REPLACE)e=b.voice.getAvailableSpaceAtIdx(b.noteIdx);else{if(b.insertMode!==c.INSERT)throw new g("Unexpected");e=b.voice.getAvailableSpaceAtEnd(b.noteIdx);e<b.voice.getSpaceFromIdx(b.noteIdx)&&(b.timeDiff=0)}if(e*=b.internalCoeff,e-=b.timeDiff,(e=Math.max(e,0))<b.requiredSpace)throw new d(b.requiredSpace,e,b.dpq,b.timeModif)},n=function(a,b){var c;if(o(b))c=p(a,b);else{if(!s(b))throw new g("Unexpected");c=q(a,b)}return c.insertMode=b.insertMode,c},o=function(a){return"number"==typeof a.noteIdx},p=function(b,c){var d=b.getVoiceOrTupletForGet(c.voiceIdx,c.noteIdx),e=d.getAbsoluteTimeModif(),f=b.getDpqValue(),g=a(c,f,e);return{voice:d,timeModif:e,dpq:f,noteIdx:c.noteIdx,requiredSpace:g,internalCoeff:1,timeDiff:0}},q=function(c,d){var g=c.getDpqValue(),j=h.lcm(g,d.divisions),k=d.timePos*j/d.divisions,l=j/g,m=c.getVoice(d.voiceIdx),n=b(m,l,k),o=m.getRangeSpace(0,n)*l,p=k-o;if(p>0&&!m.isRest(n))throw new e(k,j,e.INSERT);var q=c.getVoiceOrTupletForGet(d.voiceIdx,n),r=q.getAbsoluteTimeModif();if(p>0&&!i.isSame(d.timeModif,r))throw new f(d.timeModif);return{voice:q,timeModif:r,dpq:j,noteIdx:n,requiredSpace:a(d,j,r),internalCoeff:l,timeDiff:p}},r=function(a,b){if(b.insertMode!==c.REPLACE&&b.insertMode!==c.INSERT)throw new g("Unexpected");if(!s(b))throw new g("Unexpected");var e=j.divisionsToQuarter(b.timePos,b.divisions);if(!j.isValidQuarter(e))throw new g("Unexpected","Invalid position");var f=j.durationOptsToQuarter(b),l=a.getMeasure(),m=k.getQuarterDuration(l),n=m-e;if(f>n){var o=j.quarterDurationToRequiredDpq(n),p=j.quarterDurationToRequiredDpq(f),q=h.lcm(o,p),r=j.quarterToDivisions(n,q),t=j.quarterToDivisions(f,q);throw new d(t,r,q,i.createDefault())}},s=function(a){return"number"==typeof a.timePos&&"number"==typeof a.divisions}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Utils.pitchUtils,c=Adagio.Error.client.LineOutOfRangeError=function(b){var c=d(b),e=a.call(this,c);return this.name=e.name="LineOutOfRangeError",this.stack=e.stack,this.message=e.message,this.line=b,this};c.prototype=Object.create(a.prototype,{constructor:{value:c}});var d=function(a){return"Invalid line "+a+". The line must be between ["+b.MIN_LINE+" and "+b.MAX_LINE+"]."}}.call(this),function(){"use strict";var a=Adagio.Error.client.LineOutOfRangeError,b=Adagio.Error.InternalError,c=Adagio.Utils.pitchUtils,d=Adagio.Utils.direction.octaveShiftDirectionUtils,e=Adagio.edit.common.getOctaveShiftAtNote,f=Adagio.edit.common.getOctaveShiftAtTimePos;Adagio.edit.common.checkLineOverflow=function(b,e){var f=b.getClef(e.staffIdx),h=c.pitchToLine(e.pitch,f),i=g(b,e);if(i&&(h=d.applyShiftToLine(i,h)),h<c.MIN_LINE||h>c.MAX_LINE)throw new a(h)};var g=function(a,b){return h(b)(a,b)},h=function(a){if(i(a))return f;if(j(a))return e;throw new b("Unexpected")},i=function(a){return"number"==typeof a.timePos&&"number"==typeof a.divisions},j=function(a){return"number"==typeof a.noteIdx}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils;Adagio.edit.common.hasTimePosPossibleNoteIdx=function(b,c,d){for(var e=0,f=b.size(),g=0;g<f&&e<d;g++){var h=b.getNote(g);e+=a.getDuration(h)*c}return!(g===f&&e<=d)&&(e===d||b.isRest(g-1))}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.noteUtils,c=Adagio.Utils.timeModifUtils,d=Adagio.Data.tuplet.getTupletLevel,e=Adagio.Data.tuplet.createTupletView;Adagio.edit.common.isTimePosCompatible=function(a,b,g,h){var i=f(a,b,g),j=d(a,i),k=e(a,i,j),l=k.getAbsoluteTimeModif();return c.isCompatible(h,l)};var f=function(c,d,e){
for(var f=0,g=c.size(),h=0;h<g&&f<e;h++){var i=c.getNote(h);f+=b.getDuration(i)*d}if(h===g&&f<=e)throw new a("Unexpected");if(f===e)return h;if(c.isRest(h-1))return h-1;throw new a("Unreachable")}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.noteUtils,c=Adagio.Utils.math,d=Adagio.Utils.durationUtils,e=Adagio.Values.DurationType,f=Adagio.edit.primitive.IncreaseDivisions,g=Adagio.edit.action.ChangeDurationFormat,h=Adagio.edit.common.timePosToFloorNoteIdx,i=Adagio.edit.common.RestDispatcherLeft,j=Adagio.edit.common.assertPerform,k=Adagio.edit.values.InsertMode,l=Adagio.edit.common.initMeasureData,m=Adagio.edit.composite.SplitRest=function(a,b,c){this.init(a,b,c)};m.NAME="composite.SplitRest";var n=m.prototype;n.initMeasureData=l,n.name=m.NAME,n.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.noteIdx=null,this.leftShard=null,this.rightShard=null,this.shards=[],this.floorNoteIdx=null,this.divisionsPerBeat=null,this.staffIdx=null},n.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.increaseDivisionsIfNeeded(),this.fetchInitialShards(),this.dispatchLeftRests(),this.dispatchRightRests(),this.changeDurations()},n.increaseDivisionsIfNeeded=function(){var a=this.measureData.getDivisions().getDivisions(),b=c.lcm(a,this.opts.divisions),d=b/a;d>1&&this.increaseDivisions(d);var e=b/this.opts.divisions;e>1&&(this.opts.divisions*=e,this.opts.timePos*=e)},n.increaseDivisions=function(a){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,coeff:a};new f(this.measureData,b,this.cancelStack).perform()},n.fetchInitialShards=function(){for(var c=this.getVoice(),d=c.size(),e=0,f=0;f<d;f++){var g=c.getNote(f),h=b.getDuration(g),i=e+h;if(e<this.opts.timePos&&this.opts.timePos<i){if(c.isRest(f))return this.staffIdx=b.getStaffIdx(g),this.noteIdx=f,this.leftShard=this.opts.timePos-e,this.previousTimePos=e,void(this.rightShard=i-this.opts.timePos);throw new a("Unexpected","cannot split a non rest.")}e=i}var j="There is no rest to be splitted at the time position ["+this.opts.timePos+"]";throw new a("Unexpected",j)},n.dispatchLeftRests=function(){var a=this.getDivisionsPerBeat(),b=this.getDpq(),c=this.getAbsoluteTimeModif(),d=new i(this.previousTimePos,this.leftShard,a,b,c);d.dispatch();var e=d.getDispatchedRests();this.shards.push.apply(this.shards,e)},n.dispatchRightRests=function(){var a=this.getDivisionsPerBeat(),b=this.getDpq(),c=this.getAbsoluteTimeModif(),d=new i(this.opts.timePos,this.rightShard,a,b,c);d.dispatch();var e=d.getDispatchedRests();this.shards.push.apply(this.shards,e)},n.getDivisionsPerBeat=function(){if(null===this.divisionsPerBeat){var a=this.getVoiceOrTuplet();a.isTuplet()?this.divisionsPerBeat=this.getDivPerBeatFromTimeModif(a):this.divisionsPerBeat=this.getDivPerBeatFromTimeSignature()}return this.divisionsPerBeat},n.getDivPerBeatFromTimeSignature=function(){var a=this.measureData.getAnyTime(),b=d.getBeatQuarterDuration(a),c=this.getDpq();return d.quarterToDuration(b,c)},n.getDivPerBeatFromTimeModif=function(a){var b=a.getAbsoluteTimeModif(),c=a.getDurationType(),f=this.getDpq(),g=e.toQuarterDuration(c),h=d.quarterToDuration(g,f);return d.normalToActual(h,b)},n.changeDurations=function(){this.shards.forEach(this.changeDurationIfNeeded,this)},n.changeDurationIfNeeded=function(a,c){var d=this.getFloorNoteIdx(),e=d+c,f=this.getVoice(),g=f.getNote(e);b.getDuration(g)!==a&&this.changeDuration(e,a)},n.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},n.changeDuration=function(a,b){var c=this.getDurationOpts(b),d={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:a,durationType:c.durationType,nbDots:c.nbDots,insertMode:k.REPLACE},e=new g(this.measureData,d,this.cancelStack);j(e)},n.getDurationOpts=function(a){var b=this.getAbsoluteTimeModif(),c=this.getDpq();return d.actualDivisionsToDurationOpts(a,c,b)},n.getDpq=function(){return this.measureData.getDpqValue()},n.getAbsoluteTimeModif=function(){return this.getVoiceOrTuplet().getAbsoluteTimeModif()},n.getVoiceOrTuplet=function(){var a=this.opts.voiceIdx,b=this.getFloorNoteIdx();return this.measureData.getVoiceOrTupletForGet(a,b)},n.getFloorNoteIdx=function(){if(null===this.floorNoteIdx){var a=this.getVoice();this.floorNoteIdx=h(a,1,this.opts.timePos)}return this.floorNoteIdx}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Error.client.BadTimePosError,c=Adagio.Error.client.TimePosIncompatibleError,d=Adagio.Utils.math,e=Adagio.edit.common.hasTimePosExactNoteIdx,f=Adagio.edit.common.hasTimePosPossibleNoteIdx,g=Adagio.edit.common.isTimePosCompatible,h=Adagio.edit.common.timePosToNoteIdx,i=Adagio.edit.common.CancelStack,j=Adagio.edit.composite.SplitRest;Adagio.edit.common.convertTimePosToInsertNoteIdx=function(b,c,d){if(void 0!==c.timePos){var e;if(void 0===c.timeModif)throw e="There should be a timeModif when there is a timePos value.",new a("Unexpected",e);if(void 0===c.divisions)throw e="There should be a divisions value when there is a timePos value.",new a("Unexpected",e);k(b,c,d)}};var k=function(a,d,h){var i=m(a,d),j=a.getVoice(d.voiceIdx);if(e(j,i,d.timePos))l(j,i,d);else{if(!f(j,i,d.timePos))throw new b(d.timePos,d.divisions,b.INSERT);if(!g(j,i,d.timePos,d.timeModif))throw new c(d.timeModif);n(a,d,h),i=m(a,d),l(j,i,d)}},l=function(a,b,c){c.noteIdx=h(a,b,c.timePos),delete c.timePos,delete c.divisions},m=function(a,b){var c=a.getDivisions().getDivisions(),e=d.lcm(c,b.divisions),f=e/c,g=e/b.divisions;return b.timePos*=g,b.divisions*=g,f},n=function(a,b,c){var d={partIdx:b.partIdx,measureIdx:b.measureIdx,voiceIdx:b.voiceIdx,timePos:b.timePos,divisions:b.divisions};c=c||new i,new j(a,d,c).perform()}}.call(this),function(){"use strict";var a=Adagio.Utils.clone,b=Adagio.Utils.noteUtils,c=Adagio.Utils.pitchUtils,d=Adagio.Utils.timeModifUtils,e=Adagio.history.note.noteHistoryUtils,f=Adagio.edit.common.calcDuration,g=Adagio.edit.common.initMeasureData,h=Adagio.edit.primitive.AddSingleNote=function(a,b,c){this.init(a,b,c)};h.NAME="primitive.AddSingleNote";var i=h.prototype;i.name=h.NAME,i.initMeasureData=g,i.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},i.perform=function(){var a=this.getVoice(),b=this.createNote(a);a.insertNote(b,this.opts.noteIdx),this.updateStack()},i.getVoice=function(){var a=this.opts.voiceIdx,b=this.opts.noteIdx;return this.measureData.getVoiceOrTupletForInsert(a,b)},i.createNote=function(f){var g=d.copy(f.getAbsoluteTimeModif()),h=this.getDuration(),i=c.copy(this.opts.pitch),j={};if(b.setStaffIdx(j,this.opts.staffIdx),b.setVoiceIdx(j,this.opts.voiceIdx),b.setDuration(j,h),b.setPitch(j,i),b.setNbDots(j,this.opts.nbDots),b.setTimeModif(j,g),null!==this.opts.accidental&&b.setAccidental(j,this.opts.accidental),this.cancelStack.hasPayload()){var k=this.cancelStack.getPayload(),l=a(k.headCssClassesSet);e.setHeadCssClassesSet(j,l),l=a(l),e.setGlobalCssClassesSet(j,l)}return j},i.getDuration=function(){var a=this.measureData.getDivisionsPerQuarterValue(),b=this.getVoice(),c=b.getAbsoluteTimeModif();return f(this.opts,a,c)},i.updateStack=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,noteIdx:this.opts.noteIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,durationType:this.opts.durationType,nbDots:this.opts.nbDots,pitch:c.copy(this.opts.pitch),accidental:this.opts.accidental},b={type:this.name,opts:a};this.cancelStack.push(b)}}.call(this),function(){"use strict";var a=Adagio.Utils.pitchUtils,b=Adagio.edit.common.calcDuration,c=Adagio.edit.primitive.AddSingleNote,d=Adagio.edit.action.RemoveBeamEdge,e=Adagio.edit.action.RemoveTie,f=Adagio.edit.action.RemoveEdgeGlissandos,g=Adagio.edit.action.RemoveEdgeHammerOnPullOffs,h=Adagio.edit.action.FormatBeamsRandPos,i=Adagio.edit.action.SetFret,j=Adagio.edit.composite.AdaptDpqToDuration,k=Adagio.edit.composite.AdaptDpqToTimeSignature,l=Adagio.edit.composite.RemoveRests,m=Adagio.edit.composite.UnlockRests,n=Adagio.edit.composite.UpdateAccidental,o=Adagio.edit.values.InsertMode,p=Adagio.edit.common.initMeasureData,q=Adagio.edit.common.isTabStaff,r=Adagio.edit.composite.AddSingleNote=function(a,b,c){this.init(a,b,c)};r.NAME="composite.AddSingleNote";var s=r.prototype;s.name=r.NAME,s.initMeasureData=p,s.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},s.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.opts.insertMode===o.INSERT&&this.opts.noteIdx>0&&this.breakConnection(),this.adaptDpqToNoteDuration(),this.adaptDpqToTimeSignature(),this.unlockRests(),this.addSingleNote(),this.consumeSpace(),this.formatBeams(),this.updateAccidental(),this.isTabStaff()&&this.setFretAction()},s.breakConnection=function(){this.removeTie(),this.removeBeamEdge(),this.removeEdgeGlissandos(),this.removeEdgeHammerOnPullOffs()},s.removeTie=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx-1};new e(this.measureData,a,this.cancelStack).performIfPossible()},s.removeBeamEdge=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx-1};new d(this.measureData,a,this.cancelStack).performIfPossible()},s.removeEdgeGlissandos=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new f(this.measureData,a,this.cancelStack).performIfPossible()},s.removeEdgeHammerOnPullOffs=function(){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:a.copy(this.opts.pitch)};new g(this.measureData,b,this.cancelStack).performIfPossible()},s.adaptDpqToNoteDuration=function(){var a=this.getVoice(),b=a.getAbsoluteTimeModif(),c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,durationType:this.opts.durationType,nbDots:this.opts.nbDots,timeModif:b};new j(this.measureData,c,this.cancelStack).perform()},s.adaptDpqToTimeSignature=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx};new k(this.measureData,a,this.cancelStack).perform()},s.getVoice=function(){var a=this.opts.voiceIdx,b=this.opts.noteIdx;return this.measureData.getVoiceOrTupletForGet(a,b)},s.unlockRests=function(){var a=this.getDuration(),b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,insertMode:this.opts.insertMode,duration:a};new m(this.measureData,b,this.cancelStack).perform()},s.addSingleNote=function(){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,noteIdx:this.opts.noteIdx,durationType:this.opts.durationType,nbDots:this.opts.nbDots,pitch:a.copy(this.opts.pitch),accidental:null};new c(this.measureData,b,this.cancelStack).perform()},s.consumeSpace=function(){var a=this.getDuration(),b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx+1,insertMode:this.opts.insertMode,duration:a};new l(this.measureData,b,this.cancelStack).perform()},s.getDuration=function(){var a=this.measureData.getDivisionsPerQuarterValue(),c=this.opts.voiceIdx,d=this.opts.noteIdx,e=this.measureData.getVoiceOrTupletForGet(c,d),f=e.getAbsoluteTimeModif();return b(this.opts,a,f)},s.formatBeams=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new h(this.measureData,a,this.cancelStack).performIfPossible()},s.updateAccidental=function(){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,noteIdx:this.opts.noteIdx,pitch:a.copy(this.opts.pitch)};new n(this.measureData,b,this.cancelStack).perform()},s.isTabStaff=function(){return q(this.measureData,this.opts)},s.setFretAction=function(){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,noteIdx:this.opts.noteIdx,pitch:a.copy(this.opts.pitch),fretData:this.opts.fretData};new i(this.measureData,b,this.cancelStack).performIfPossible()}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Error.client.NotPossibleOnUnpitchedError,c=Adagio.Error.client.BadVoiceError,d=Adagio.Utils.pitchUtils,e=Adagio.Values.AccidentalStyle,f=Adagio.edit.common.initMeasureData,g=Adagio.edit.common.checkOptsPitch,h=Adagio.edit.common.checkOptsDuration,i=Adagio.edit.common.fillOptsAlter,j=Adagio.edit.common.convertLineToPitch,k=Adagio.edit.common.checkCompatibleVoiceStaffIdx,l=Adagio.edit.common.checkSpaceForAdd,m=Adagio.edit.common.checkLineOverflow,n=Adagio.edit.common.transposePitchAccidentalOpts,o=Adagio.edit.common.checkNoteTimePos,p=Adagio.edit.common.convertTimePosToInsertNoteIdx,q=Adagio.edit.common.assertPerform,r=Adagio.edit.common.CancelStack,s=Adagio.edit.composite.AddSingleNote,t=Adagio.edit.action.ShowMeasureVoice,u=Adagio.edit.values.InsertMode,v=Adagio.edit.action.AddSingleNote=function(a,b,c){this.init(a,b,c)};v.NAME="action.AddSingleNote";var w=v.prototype;w.name=v.NAME,w.initMeasureData=f,w.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.temporaryStack=null,this.opts=b},w.checkPreconditions=function(){this.checkCommonElements(),this.checkTimeLocation(),this.checkSpace(),this.isVoiceDisplayed()||this.displayVoice(),this.hasNoteIdx()||this.inferNoteIdx(),this.postCheckSanitize()},w.checkCommonElements=function(){this.checkValues(),this.checkPitchedPart(),this.checkVoiceIdx(),this.checkCompatibleVoiceStaffIdx(),this.sanitize(),this.checkPitch(),this.opts.checkLine&&m(this.measureData,this.opts)},w.checkValues=function(){h(this.opts),g(this.opts),null!==this.opts.accidental&&e.check(this.opts.accidental)},w.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new b},w.checkVoiceIdx=function(){if(!this.measureData.getScoreData().hasPartVoiceIdx(this.opts.partIdx,this.opts.voiceIdx))throw new c(this.opts.voiceIdx)},w.checkCompatibleVoiceStaffIdx=function(){k(this.measureData,this.opts)},w.sanitize=function(){void 0!==this.opts.line&&j(this.measureData,this.opts,!0),this.opts.isConcertPitch&&n(this.measureData,this.opts),void 0===this.opts.insertMode&&(this.opts.insertMode=u.REPLACE),void 0===this.opts.checkLine&&(this.opts.checkLine=!0)},w.checkPitch=function(){d.check(this.opts.pitch)},w.checkTimeLocation=function(){if(this.hasTimePos())this.checkTimePos();else{if(!this.hasNoteIdx())throw new a("Unexpected");this.checkNoteIdx()}},w.hasTimePos=function(){return"number"==typeof this.opts.timePos&&"number"==typeof this.opts.divisions&&void 0!==this.opts.timeModif},w.checkTimePos=function(){var a=this.measureData.getMeasure();o(a,this.opts.timePos,this.opts.divisions)},w.hasNoteIdx=function(){return"number"==typeof this.opts.noteIdx},w.checkNoteIdx=function(){this.measureData.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},w.checkSpace=function(){l(this.measureData,this.opts)},w.isVoiceDisplayed=function(){return this.measureData.hasVoice(this.opts.voiceIdx)},w.displayVoice=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx},b=this.getTemporaryStack(),c=new t(this.measureData,a,b);q(c)},w.inferNoteIdx=function(){var a=this.getTemporaryStack();p(this.measureData,this.opts,a)},w.getTemporaryStack=function(){return null===this.temporaryStack&&(this.temporaryStack=new r(this.name+".checkPreconditions")),this.temporaryStack},w.postCheckSanitize=function(){i(this.measureData,this.opts)},w.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),null!==this.temporaryStack&&this.cancelStack.push(this.temporaryStack);var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,durationType:this.opts.durationType,nbDots:this.opts.nbDots,pitch:d.copy(this.opts.pitch),fretData:this.opts.fretData,insertMode:this.opts.insertMode,checkLine:this.opts.checkLine};new s(this.measureData,a,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Utils.clone,b=Adagio.Utils.noteUtils,c=Adagio.Utils.pitchUtils,d=Adagio.Utils.timeModifUtils,e=Adagio.Utils.arpeggiateUtils,f=Adagio.history.note.noteHistoryUtils,g=Adagio.edit.common.initMeasureData,h=Adagio.edit.primitive.AddToChord=function(a,b,c){this.init(a,b,c)};h.NAME="primitive.AddToChord";var i=h.prototype;i.name=h.NAME,i.initMeasureData=g,i.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},i.perform=function(){var a=this.getVoice(),b=a.getNote(this.opts.noteIdx),c=this.createNote(b);a.addNoteToChord(c,this.opts.noteIdx),this.updateCommonHistory(),this.updateStack()},i.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},i.createNote=function(g){var h=b.getDuration(g),i=b.getNbDots(g),j=b.getTimeModif(g);j=d.copy(j);var k=c.copy(this.opts.pitch),l={};if(b.setStaffIdx(l,this.opts.staffIdx),b.setVoiceIdx(l,this.opts.voiceIdx),b.setDuration(l,h),b.setPitch(l,k),b.setNbDots(l,i),b.setTimeModif(l,j),null!==this.opts.accidental&&b.setAccidental(l,this.opts.accidental),b.hasArpeggiate(g)){var m=b.getArpeggiate(g);m=e.copy(m),b.setArpeggiate(l,m)}if(this.cancelStack.hasPayload()){var n=this.cancelStack.getPayload(),o=a(n.headCssClassesSet);f.setHeadCssClassesSet(l,o)}return l},i.updateCommonHistory=function(){if(this.cancelStack.hasPayload()){var b=this.getVoice(),c=b.getNote(this.opts.noteIdx),d=this.cancelStack.getPayload(),e=a(d.headCssClassesSet);f.setGlobalCssClassesSet(c,e)}},i.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,noteIdx:this.opts.noteIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,pitch:c.copy(this.opts.pitch),accidental:this.opts.accidental}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.Utils.pitchUtils,b=Adagio.edit.primitive.AddToChord,c=Adagio.edit.composite.UpdateAccidental,d=Adagio.edit.action.SetFret,e=Adagio.edit.common.initMeasureData,f=Adagio.edit.common.isTabStaff,g=Adagio.edit.composite.AddToChord=function(a,b,c){this.init(a,b,c)};g.NAME="composite.AddToChord";var h=g.prototype;h.name=g.NAME,h.initMeasureData=e,h.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},h.perform=function(){this.cancelStack=this.cancelStack.createSubstack(),this.addToChord(),this.updateAccidental(),this.isTabStaff()&&this.setFretAction()},h.addToChord=function(){var c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,noteIdx:this.opts.noteIdx,pitch:a.copy(this.opts.pitch),accidental:null};new b(this.measureData,c,this.cancelStack).perform()},h.updateAccidental=function(){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,noteIdx:this.opts.noteIdx,pitch:a.copy(this.opts.pitch)};new c(this.measureData,b,this.cancelStack).perform()},h.isTabStaff=function(){return f(this.measureData,this.opts)},h.setFretAction=function(){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,noteIdx:this.opts.noteIdx,pitch:a.copy(this.opts.pitch),fretData:this.opts.fretData};new d(this.measureData,b,this.cancelStack).performIfPossible()}}.call(this),function(){"use strict";var a=Adagio.Error.client.PitchCollisionError,b=Adagio.Error.client.NotPossibleOnUnpitchedError,c=Adagio.Values.AccidentalStyle,d=Adagio.Utils.typeUtils,e=Adagio.Utils.noteUtils,f=Adagio.Utils.pitchUtils,g=Adagio.Utils.clone,h=Adagio.edit.composite.AddToChord,i=Adagio.edit.common.checkOptsPitch,j=Adagio.edit.common.fillOptsAlter,k=Adagio.edit.common.convertLineToPitch,l=Adagio.edit.common.checkCompatibleVoiceStaffIdx,m=Adagio.edit.common.checkLineOverflow,n=Adagio.edit.common.transposePitchAccidentalOpts,o=Adagio.edit.common.convertPartUuidToGetPartIdx,p=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,q=Adagio.edit.common.convertTimePosToGetNoteIdx,r=Adagio.edit.common.initMeasureData,s=Adagio.edit.action.AddToChord=function(a,b,c){this.init(a,b,c)};s.NAME="action.AddToChord",s.isNoChange=function(b){return b instanceof a};var t=s.prototype;t.name=s.NAME,t.initMeasureData=r,t.init=function(a,b,c){o(a,b),p(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.sanitized=!1,this.voice=null,this.actions=[],this.location=null,q(this.measureData,this.opts)},t.checkPreconditions=function(){this.checkPitchedPart(),this.checkValues(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkCompatibleVoiceStaffIdx(),this.checkNoteIdx(),this.checkNotRest(),this.sanitizeIfNeeded(),this.checkPitch(),this.checkLineOverflow(),this.checkPitchInsertion()},t.checkValues=function(){i(this.opts),null!==this.opts.accidental&&c.check(this.opts.accidental)},t.checkPitch=function(){f.check(this.opts.pitch)},t.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new b},t.checkCompatibleVoiceStaffIdx=function(){l(this.measureData,this.opts)},t.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},t.getVoice=function(){return null===this.voice&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},t.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},t.checkLineOverflow=function(){this.opts.checkLine&&m(this.measureData,this.opts)},t.checkPitchInsertion=function(){if(-1!==this.getChord().findIndex(u,this.opts.pitch)){var b=f.copy(this.opts.pitch);throw new a(a.action.INSERT,b)}},t.getChord=function(){var a=this.getVoice(),b=a.getChord(this.opts.noteIdx);return d.makeArray(b)};var u=function(a){var b=e.getPitch(a),c=this;return f.isSameLine(b,c)};t.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded(),this.storeAction(),this.addToChord(),this.performActions(),this.opts.record&&this.updateCancelStack()},t.sanitizeIfNeeded=function(){this.sanitized||(void 0===this.opts.checkLine&&(this.opts.checkLine=!0),void 0!==this.opts.line&&k(this.measureData,this.opts,!0),this.opts.isConcertPitch&&n(this.measureData,this.opts),void 0===this.opts.record&&(this.opts.record=!0),j(this.measureData,this.opts),this.sanitized=!0)},t.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,divisions:a.dpq,timePos:a.timePos,pitch:f.copyWithoutAlter(this.opts.pitch),accidental:this.opts.accidental,checkLine:this.opts.checkLine};void 0!==this.opts.fretData&&(b.fretData=g(this.opts.fretData));var c={actionName:this.name,opts:b};this.cancelStack.storeAction(c)}},t.addToChord=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,noteIdx:this.opts.noteIdx,pitch:f.copy(this.opts.pitch),fretData:this.opts.fretData};new h(this.measureData,a,this.cancelStack).perform()},t.performActions=function(){this.actions.forEach(this.performAction,this)},t.performAction=function(a){a.cancelStack=this.cancelStack,a.perform()},t.updateCancelStack=function(){var a=this.getLocation(),b={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos,pitch:f.copyWithoutAlter(this.opts.pitch)}};this.cancelStack.push(b)},t.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.noChange.NoChangeError,b=Adagio.Error.client.NotPossibleOnUnpitchedError,c=Adagio.Error.client.BadVoiceError,d=Adagio.Error.InternalError,e=Adagio.edit.values.InsertMode,f=Adagio.edit.common.convertLineToPitch,g=Adagio.edit.common.checkCompatibleVoiceStaffIdx,h=Adagio.edit.common.convertTimePosToGetNoteIdx,i=Adagio.edit.common.convertPartUuidToGetPartIdx,j=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,k=Adagio.edit.common.transposePitchAccidentalOpts,l=Adagio.edit.common.checkNoteTimePos,m=Adagio.edit.common.timePosToFloorNoteIdx,n=Adagio.edit.common.convertNoteRef,o=Adagio.edit.action.ChangeDurationFormat,p=Adagio.edit.action.AddSingleNote,q=Adagio.edit.action.AddAccidental,r=Adagio.edit.action.AddToChord,s=Adagio.Utils.pitchUtils,t=Adagio.Utils.timeModifUtils,u=Adagio.Utils.noteUtils,v=Adagio.Utils.clone,w=Adagio.Utils.math,x=Adagio.edit.common.initMeasureData,y=!1,z=Adagio.edit.action.AddNote=function(a,b,c){this.init(a,b,c)};z.NAME="action.AddNote";var A=z.prototype;A.name=z.NAME,A.initMeasureData=x,A.init=function(a,b,c){i(a,b),j(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.actions=[],this.location=null},A.checkPreconditions=function(){this.checkCommonElements(),this.hasNoteRef()&&this.convertNoteRef(),this.sanitize(),this.checkTimeLocation(),this.isVoiceDisplayed()&&this.isChord()&&this.opts.insertMode===e.REPLACE?(this.hasNoteIdx()||this.inferNoteIdx(),this.addChordActions()):this.addSingleNoteAction()},A.checkCommonElements=function(){this.checkPitchedPart(),this.checkVoiceIdx(),this.checkCompatibleVoiceStaffIdx()},A.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new b},A.checkVoiceIdx=function(){if(!this.measureData.getScoreData().hasPartVoiceIdx(this.opts.partIdx,this.opts.voiceIdx))throw new c(this.opts.voiceIdx)},A.checkCompatibleVoiceStaffIdx=function(){g(this.measureData,this.opts)},A.hasNoteRef=function(){return"number"==typeof this.opts.noteIdxRef&&"number"==typeof this.opts.voiceIdxRef},A.convertNoteRef=function(){n(this.measureData,this.opts)},A.sanitize=function(){void 0!==this.opts.line&&f(this.measureData,this.opts,!0),this.opts.isConcertPitch&&k(this.measureData,this.opts),void 0===this.opts.insertMode&&(this.opts.insertMode=e.REPLACE),void 0===this.opts.formatRests&&(this.opts.formatRests=y),void 0===this.opts.checkLine&&(this.opts.checkLine=!0)},A.checkTimeLocation=function(){if(this.hasTimePos())this.checkTimePos();else{if(!this.hasNoteIdx())throw new d("Unexpected");this.checkNoteIdx()}},A.hasTimePos=function(){return"number"==typeof this.opts.timePos&&"number"==typeof this.opts.divisions&&void 0!==this.opts.timeModif},A.checkTimePos=function(){var a=this.measureData.getMeasure();l(a,this.opts.timePos,this.opts.divisions)},A.hasNoteIdx=function(){return"number"==typeof this.opts.noteIdx},A.checkNoteIdx=function(){this.measureData.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},A.isVoiceDisplayed=function(){return this.measureData.hasVoice(this.opts.voiceIdx)},A.isChord=function(){var a,b=this.measureData.getVoice(this.opts.voiceIdx);if(this.hasNoteIdx())a=this.opts.noteIdx;else{if(!this.hasTimePos())throw new d("Unexpected");var c=this.measureData.getDpqValue(),e=w.lcm(c,this.opts.divisions),f=this.opts.timePos*e/this.opts.divisions;a=m(b,e/c,f)}return!b.isRest(a)},A.inferNoteIdx=function(){h(this.measureData,this.opts)},A.addChordActions=function(){if(this.addHeadInsertion(),this.noChange()&&this.addAccidentalChange(),this.addDurationChange(),this.noChange())throw new a},A.addAccidentalChange=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:s.copy(this.opts.pitch),accidental:this.opts.accidental,record:!1};this.addAction(q,a)},A.addHeadInsertion=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,noteIdx:this.opts.noteIdx,pitch:s.copy(this.opts.pitch),fretData:this.opts.fretData,accidental:this.opts.accidental,checkLine:this.opts.checkLine,record:!1};this.addAction(r,a)},A.addDurationChange=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,noteIdx:this.opts.noteIdx,durationType:this.opts.durationType,nbDots:this.opts.nbDots,insertMode:this.opts.insertMode,formatRests:this.opts.formatRests,record:!1};this.addAction(o,a)},A.addAction=function(a,b){var c=new a(this.measureData,b,this.cancelStack);try{c.checkPreconditions(),this.actions.push(c)}catch(b){if(!a.isNoChange(b))throw b}},A.noChange=function(){return 0===this.actions.length},A.addSingleNoteAction=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,durationType:this.opts.durationType,nbDots:this.opts.nbDots,pitch:s.copy(this.opts.pitch),fretData:this.opts.fretData,insertMode:this.opts.insertMode,accidental:this.opts.accidental,checkLine:this.opts.checkLine};if(this.hasTimePos())a.divisions=this.opts.divisions,a.timePos=this.opts.timePos,a.timeModif=t.copy(this.opts.timeModif);else{if(!this.hasNoteIdx())throw new d("Unexpected");a.noteIdx=this.opts.noteIdx}var b=new p(this.measureData,a,this.cancelStack);b.checkPreconditions(),this.opts.noteIdx=b.opts.noteIdx,this.actions.push(b)},A.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.performActions(),this.updateCancelStack()},A.performActions=function(){this.actions.forEach(this.performAction,this)},A.performAction=function(a){a.cancelStack=this.cancelStack,a.perform()},A.updateCancelStack=function(){var a=this.getLocation(),b={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos,pitch:s.copy(this.opts.pitch),insertMode:this.opts.insertMode}};this.cancelStack.push(b)},A.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b=t.copy(a.timeModif),c={partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,divisions:a.dpq,timePos:a.timePos,pitch:s.copyWithoutAlter(this.opts.pitch),accidental:this.opts.accidental,nbDots:this.opts.nbDots,durationType:this.opts.durationType,insertMode:this.opts.insertMode,formatRests:!!this.opts.formatRests,timeModif:b,checkLine:this.opts.checkLine};void 0!==this.opts.fretData&&(c.fretData=v(this.opts.fretData));var d={actionName:this.name,opts:c};this.cancelStack.storeAction(d)}},A.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx),g=e.getNote(this.opts.noteIdx),h=u.getTimeModif(g);h=t.copy(h),this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f,timeModif:h}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.client.NoPitchesError,b=Adagio.Error.client.PitchCollisionError,c=Adagio.Error.client.NotPossibleOnUnpitchedError,d=Adagio.Utils.pitchUtils,e=Adagio.Utils.clone,f=Adagio.edit.action.AddNote,g=Adagio.edit.common.initMeasureData,h=Adagio.edit.common.assertPerform,i=Adagio.edit.common.checkLineOverflow,j=Adagio.edit.common.checkCompatibleVoiceStaffIdx,k=Adagio.edit.action.AddChord=function(a,b,c){this.init(a,b,c)};k.NAME="action.AddChord";var l=k.prototype;l.name=k.NAME,l.initMeasureData=g,l.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.actions=null,this.sanitized=!1},l.checkPreconditions=function(){this.checkPitchedPart(),this.sanitizeIfNeeded(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkCompatibleVoiceStaffIdx(),this.checkNoteIdx(),this.checkRest(),this.checkPitches(),this.getActions()[0].checkPreconditions()},l.checkPitchedPart=function(){
if(this.measureData.isUnpitched())throw new c},l.checkCompatibleVoiceStaffIdx=function(){j(this.measureData,this.opts)},l.checkPitches=function(){if(0===this.opts.heads.length)throw new a;this.opts.heads.forEach(m),this.opts.checkLine&&this.opts.heads.forEach(this.checkLineOverflow,this),this.checkPitchCollision()};var m=function(a){d.check(a.pitch)};l.checkLineOverflow=function(a){var b={pitch:d.copy(a.pitch),staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};i(this.measureData,b)},l.checkPitchCollision=function(){var a=this.opts.heads.map(n);a.sort(d.compareLine);for(var c=a.length,e=0;e<c-1;e++){var f=a[e],g=a[e+1];if(d.isSameLine(f,g)){var h=d.copyWithoutAlter(f);throw new b(b.action.INSERT,h)}}};var n=function(a){return d.copy(a.pitch)};l.checkNoteIdx=function(){this.measureData.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},l.checkRest=function(){this.measureData.getVoice(this.opts.voiceIdx).checkRest(this.opts.noteIdx)},l.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded();var a=this.getActions();a[0].cancelStack=this.cancelStack,a[0].perform(),a=a.slice(1),a.forEach(this.performSubAction,this)},l.performSubAction=function(a){a.cancelStack=this.cancelStack,h(a)},l.getActions=function(){return null===this.actions&&(this.actions=this.opts.heads.map(this.createAction,this)),this.actions},l.createAction=function(a){var b=d.getAlter(a.pitch),c=d.alterToAccidental(b),g=d.copyWithoutAlter(a.pitch),h={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,durationType:this.opts.durationType,nbDots:this.opts.nbDots,pitch:g,accidental:c,insertMode:this.opts.insertMode,checkLine:this.opts.checkLine};return void 0!==a.fretData&&(h.fretData=e(a.fretData)),new f(this.measureData,h,null)},l.sanitizeIfNeeded=function(){this.sanitized||(void 0===this.opts.checkLine&&(this.opts.checkLine=!0),this.sanitized=!0)}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.BadQuarterPositionError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadQuarterPositionError",this.stack=e.stack,this.message=e.message,this.quarterPosition=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"The quarter position ["+a+"] is invalid."}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.BadQuarterDurationError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadQuarterDurationError",this.stack=e.stack,this.message=e.message,this.quarterDuration=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"The quarter duration ["+a+"] is invalid."}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadQuarterPositionError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadQuarterPositionError",this.stack=e.stack,this.message=e.message,this.quarterPosition=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"The quarter position ["+a+"] is invalid."}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadQuarterDurationError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadQuarterDurationError",this.stack=e.stack,this.message=e.message,this.quarterDuration=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"The quarter duration ["+a+"] is invalid."}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.NotTupletError=function(){var b="There is no tuplet at this location.",c=a.call(this,b);return this.name=c.name="NotTupletError",this.stack=c.stack,this.message=c.message,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}})}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.timeModifUtils,c=Adagio.Utils.noteUtils,d=Adagio.Utils.typeUtils,e=Adagio.Utils.pitchUtils,f=Adagio.Utils.unpitchedUtils,g=Adagio.edit.values.InsertMode,h=Adagio.edit.action.RemoveNote,i=Adagio.edit.action.RemoveNotePercu,j=Adagio.edit.primitive.RemoveRest,k=Adagio.edit.composite.AdaptDpqToDuration,l=Adagio.edit.composite.UnlockRest,m=Adagio.edit.common.initMeasureData,n=Adagio.edit.composite.RemoveTuplet=function(a,b,c){this.init(a,b,c)};n.NAME="composite.RemoveTuplet";var o=n.prototype;o.name=n.NAME,o.initMeasureData=m,o.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.localTimeModif=null,this.totalDuration=null,this.upperTimeModif=null,this.noteIdx=null},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.gatherData(),this.increaseDivisionsIfNeeded(),this.saveTotalDuration(),this.clearContent(),this.removeRestsButOne(),this.removeTuplet(),this.resizeNote()},o.gatherData=function(){var a=this.getTuplet();this.localTimeModif=b.copy(a.getLocalTimeModif());var c=a.getAbsoluteTimeModif();this.upperTimeModif=b.subtract(c,this.localTimeModif)},o.increaseDivisionsIfNeeded=function(){var a=this.getTuplet(),c=a.getDurationType(),d=a.getLocalTimeModif(),e=b.getShiftToWholeDurationType(d),f=c+e,g=b.getWholeNbDots(d),h=this.upperTimeModif,i={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,durationType:f,nbDots:g,timeModif:b.copy(h)};new k(this.measureData,i,this.cancelStack).perform()},o.saveTotalDuration=function(){for(var a=this.getTuplet(),b=a.getStartNoteIdx(),d=a.getStopNoteIdx(),e=0,f=b;f<=d;f++){var g=a.getNote(f);e+=c.getDuration(g)}this.totalDuration=e},o.clearContent=function(){for(var a=this.getTuplet(),b=a.size(),c=a.getStopNoteIdx(),d=1;d<b;d++)a.isRest(c)?this.unlockRest(c):this.removeChord(c),c--},o.removeChord=function(a){var b=this.getVoice(),c=b.getChord(a);c=d.makeArray(c).slice(),this.noteIdx=a,c.forEach(this.removeChordHead,this)},o.removeChordHead=function(b){if(c.hasPitch(b)){var d=c.getPitch(b);this.removePitched(d)}else{if(!c.hasUnpitched(b)){throw new a("Unexpected","Cannot have a note neither pitched nor unpitched.")}var e=c.getUnpitched(b);this.removeUnpitched(e)}},o.removePitched=function(a){a=e.copy(a);var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.noteIdx,pitch:a,insertMode:g.REPLACE},c=new h(this.measureData,b,this.cancelStack);c.checkPreconditions(),c.perform()},o.removeUnpitched=function(a){a=f.copy(a);var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.noteIdx,unpitched:a,insertMode:g.REPLACE},c=new i(this.measureData,b,this.cancelStack);c.checkPreconditions(),c.perform()},o.unlockRest=function(a){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:a};new l(this.measureData,b,this.cancelStack).perform()},o.removeRestsButOne=function(){for(var a=this.getTuplet(),b=a.size(),c=1;c<b;c++){var d={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx+1};new j(this.measureData,d,this.cancelStack).perform()}},o.removeTuplet=function(){var a=this.getNote(),b=this.getTuplet(),d=b.getTupletLevel();c.removeTupletLevelAndOutside(a,d)},o.getTuplet=function(){var a=this.opts.voiceIdx,b=this.opts.noteIdx;return this.measureData.getVoiceOrTupletForGet(a,b)},o.getNote=function(){return this.getVoice().getNote(this.opts.noteIdx)},o.resizeNote=function(){this.getNoteOrChord().forEach(this.resizeChordHead,this)},o.getNoteOrChord=function(){var a,b=this.getVoice();return a=b.isRest(this.opts.noteIdx)?b.getNote(this.opts.noteIdx):b.getChord(this.opts.noteIdx),a=d.makeArray(a)},o.getVoice=function(){var a=this.opts.voiceIdx;return this.measureData.getVoice(a)},o.resizeChordHead=function(a){var d=this.localTimeModif,e=b.getWholeNbDots(d);c.setNbDots(a,e);var f=this.upperTimeModif;c.setTimeModif(a,f);var g=this.totalDuration;c.setDuration(a,g)}}.call(this),function(){"use strict";var a=Adagio.Error.client.NotTupletError,b=Adagio.Utils.timeModifUtils,c=Adagio.Utils.noteUtils,d=Adagio.edit.composite.RemoveTuplet,e=Adagio.edit.common.initMeasureData,f=Adagio.edit.common.convertPartUuidToGetPartIdx,g=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,h=Adagio.edit.common.convertTimePosToGetNoteIdx,i=Adagio.edit.common.extractNoteDurationType,j=Adagio.Values.TupletType,k=Adagio.edit.action.RemoveTuplet=function(a,b,c){this.init(a,b,c)};k.NAME="action.RemoveTuplet";var l=k.prototype;l.name=k.NAME,l.initMeasureData=e,l.init=function(a,b,c){f(a,b),g(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.location=null,this.startNoteIdx=null,h(this.measureData,this.opts)},l.checkPreconditions=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkNoteIdx(),this.checkTuplet()},l.checkNoteIdx=function(){this.measureData.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},l.checkTuplet=function(){var c=this.getVoiceOrTupletForGet(),d=c.getAbsoluteTimeModif();if(b.isNormal(d))throw new a},l.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.startNoteIdx=this.getStartNoteIdx(),this.tupletType=this.getTupletType(),this.storeAction(),this.removeTuplet(),this.updateStack(),this.measureData.clearTupletCache(this.opts.voiceIdx)},l.getTupletType=function(){var a=this.getVoiceOrTupletForGet();return j.fromTimeModif(a.getAbsoluteTimeModif())},l.getStartNoteIdx=function(){return this.getVoiceOrTupletForGet().getStartNoteIdx()},l.getVoiceOrTupletForGet=function(){var a=this.opts.voiceIdx,b=this.opts.noteIdx;return this.measureData.getVoiceOrTupletForGet(a,b)},l.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.measureData.getVoice(this.opts.voiceIdx),b=a.getRangeSpace(0,this.opts.noteIdx),c=this.getLocation(),d={actionName:this.name,opts:{partUuid:c.partUuid,measureUuid:c.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:c.dpq,timePos:b}};this.cancelStack.storeAction(d)}},l.removeTuplet=function(){var a=this.getStartNoteIdx(),b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:a};new d(this.measureData,b,this.cancelStack).perform()},l.updateStack=function(){var a=this.getLocation(),d=this.startNoteIdx,e=this.tupletType,f=this.measureData.getVoice(this.opts.voiceIdx),g=this.measureData.getDpqValue(),h=f.getNote(d),j=c.getNbDots(h),k=i(h,g),l=c.getTimeModif(h);l=b.copy(l);var m={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,timePos:a.startTimePos,divisions:a.dpq,tupletType:e,timeModif:l,durationType:k,nbDots:j}};this.cancelStack.push(m)},l.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.startNoteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,startTimePos:f}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.durationUtils,c=Adagio.edit.action.RemoveTuplet,d=Adagio.edit.common.timePosToFloorNoteIdx,e=Adagio.edit.common.initMeasureData,f=Adagio.edit.common.assertPerform,g=Adagio.edit.composite.RemoveSpaceTuplets=function(a,b,c){this.init(a,b,c)};g.NAME="composite.RemoveSpaceTuplets";var h=g.prototype;h.name=g.NAME,h.initMeasureData=e,h.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.measure=null,this.noteIdx=null,this.quarterPos=null},h.perform=function(){if(this.cancelStack=this.cancelStack.createSubstack(this.name),this.measureData.hasVoice(this.opts.voiceIdx))for(this.fetchNoteIdx(),this.isTuplet()&&this.fetchTupletStart(),this.fetchQuarterPos();!this.done();)this.isTuplet()&&this.removeTuplet(),this.moveForward()},h.fetchNoteIdx=function(){var a=this.getDpq(),c=b.quarterToDuration(this.opts.quarterPosition,a),e=this.getVoice();this.noteIdx=d(e,1,c)},h.isTuplet=function(){var a=this.getVoiceOrTuplet(),b=a.isTuplet();return b||this.clearTupletCache(),b},h.fetchTupletStart=function(){var a=this.getVoiceOrTuplet();this.noteIdx=a.getStartNoteIdx()},h.getVoiceOrTuplet=function(){return this.measureData.getVoiceOrTupletForGet(this.opts.voiceIdx,this.noteIdx)},h.fetchQuarterPos=function(){var a=this.getTimePos(),c=this.getDpq();this.quarterPos=b.divisionsToQuarter(a,c)},h.getTimePos=function(){for(var b=0,c=this.getVoice(),d=0;d<this.noteIdx;d++){var e=c.getNote(d);b+=a.getDuration(e)}return b},h.done=function(){var a=this.getVoice(),b=a.size();if(this.noteIdx>=b)return!0;var c=this.getEndQuarterPos();return this.quarterPos>=c},h.getEndQuarterPos=function(){return this.opts.quarterPosition+this.opts.quarterDuration},h.getDpq=function(){return this.measureData.getDpqValue()},h.removeTuplet=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.noteIdx},b=new c(this.measureData,a,this.cancelStack);f(b),this.clearTupletCache()},h.clearTupletCache=function(){this.measureData.clearTupletCache(this.opts.voiceIdx)},h.moveForward=function(){var a=this.getCurrentNoteQuarterDuration();this.quarterPos+=a,this.noteIdx++},h.getCurrentNoteQuarterDuration=function(){var b=this.getVoice(),c=b.getNote(this.noteIdx),d=this.getDpq();return a.getQuarterDuration(c,d)},h.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)}}.call(this),function(){"use strict";var a=Adagio.Error.client.NotPossibleOnUnpitchedError,b=Adagio.Utils.pitchUtils,c=Adagio.Utils.noteUtils,d=Adagio.Utils.typeUtils,e=Adagio.edit.values.InsertMode,f=Adagio.edit.action.RemoveNote,g=Adagio.edit.common.initMeasureData,h=!1,i=Adagio.edit.action.RemoveChord=function(a,b,c){this.init(a,b,c)};i.NAME="action.RemoveChord";var j=i.prototype;j.name=i.NAME,j.initMeasureData=g,j.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.sanitized=!1,this.voice=null},j.checkPreconditions=function(){this.sanitizeIfNeeded(),this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkNoteIdx(),this.checkNotRest()},j.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new a},j.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},j.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},j.getVoice=function(){return null===this.voice&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},j.perform=function(){this.sanitizeIfNeeded(),this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeChord()},j.removeChord=function(){var a=this.getChord();a=a.slice(),a.forEach(this.removeChordHead,this)},j.getChord=function(){var a=this.getVoice(),b=a.getChord(this.opts.noteIdx);return b=d.makeArray(b)},j.removeChordHead=function(a,d,g){var h=c.getPitch(a);h=b.copy(h);var i={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,formatRests:this.opts.formatRests,pitch:h};d===g.length-1?i.insertMode=this.opts.insertMode:i.insertMode=e.REPLACE,new f(this.measureData,i,this.cancelStack).perform()},j.sanitizeIfNeeded=function(){this.sanitized||(void 0===this.opts.insertMode&&(this.opts.insertMode=e.REPLACE),void 0===this.opts.formatRests&&(this.opts.formatRests=h),this.sanitized=!0)}}.call(this),function(){"use strict";var a=Adagio.Error.client.NotPossibleOnPitchedError,b=Adagio.Utils.unpitchedUtils,c=Adagio.Utils.noteUtils,d=Adagio.Utils.typeUtils,e=Adagio.edit.values.InsertMode,f=Adagio.edit.action.RemoveNotePercu,g=Adagio.edit.common.initMeasureData,h=!1,i=Adagio.edit.action.RemoveChordPercu=function(a,b,c){this.init(a,b,c)};i.NAME="action.RemoveChordPercu";var j=i.prototype;j.name=i.NAME,j.initMeasureData=g,j.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.sanitized=!1,this.voice=null},j.checkPreconditions=function(){this.sanitizeIfNeeded(),this.checkUnpitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkNoteIdx(),this.checkNotRest()},j.checkUnpitchedPart=function(){if(!this.measureData.isUnpitched())throw new a},j.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},j.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},j.getVoice=function(){return null===this.voice&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},j.perform=function(){this.sanitizeIfNeeded(),this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeChord()},j.removeChord=function(){var a=this.getChord();a=a.slice(),a.forEach(this.removeChordHead,this)},j.getChord=function(){var a=this.getVoice(),b=a.getChord(this.opts.noteIdx);return b=d.makeArray(b)},j.removeChordHead=function(a,d,g){var h=c.getUnpitched(a);h=b.copy(h);var i={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,formatRests:this.opts.formatRests,unpitched:h};d===g.length-1?i.insertMode=this.opts.insertMode:i.insertMode=e.REPLACE,new f(this.measureData,i,this.cancelStack).perform()},j.sanitizeIfNeeded=function(){this.sanitized||(void 0===this.opts.insertMode&&(this.opts.insertMode=e.REPLACE),void 0===this.opts.formatRests&&(this.opts.formatRests=h),this.sanitized=!0)}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.durationUtils,c=Adagio.edit.action.RemoveChord,d=Adagio.edit.action.RemoveChordPercu,e=Adagio.edit.composite.UnlockRest,f=Adagio.edit.common.timePosToFloorNoteIdx,g=Adagio.edit.common.initMeasureData,h=Adagio.edit.common.assertPerform,i=Adagio.edit.composite.RemoveSpaceChordsQuarter=function(a,b,c){this.init(a,b,c)};i.NAME="composite.RemoveSpaceChordsQuarter";var j=i.prototype;j.name=i.NAME,j.initMeasureData=g,j.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.measure=null,this.noteIdx=null,this.quarterPos=null},j.perform=function(){if(this.cancelStack=this.cancelStack.createSubstack(this.name),this.measureData.hasVoice(this.opts.voiceIdx))for(this.fetchNoteIdx(),this.fetchQuarterPos();!this.done();)this.isNote()?this.removeChord():this.unlockRest(),this.moveForward()},j.fetchNoteIdx=function(){var a=this.getDpq(),c=b.quarterToDuration(this.opts.quarterPosition,a),d=this.getVoice();this.noteIdx=f(d,1,c)},j.isNote=function(){return!this.getVoice().isRest(this.noteIdx)},j.fetchQuarterPos=function(){var a=this.getTimePos(),c=this.getDpq();this.quarterPos=b.divisionsToQuarter(a,c)},j.getTimePos=function(){for(var b=0,c=this.getVoice(),d=0;d<this.noteIdx;d++){var e=c.getNote(d);b+=a.getDuration(e)}return b},j.done=function(){var a=this.getVoice(),b=a.size();if(this.noteIdx>=b)return!0;var c=this.getEndQuarterPos();return this.quarterPos>=c},j.getEndQuarterPos=function(){return this.opts.quarterPosition+this.opts.quarterDuration},j.getDpq=function(){return this.measureData.getDpqValue()},j.removeChord=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.noteIdx},b=this.getAction(),c=new b(this.measureData,a,this.cancelStack);h(c)},j.getAction=function(){return this.measureData.isUnpitched()?d:c},j.unlockRest=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.noteIdx};new e(this.measureData,a,this.cancelStack).perform()},j.moveForward=function(){var a=this.getCurrentNoteQuarterDuration();this.quarterPos+=a,this.noteIdx++},j.getCurrentNoteQuarterDuration=function(){var b=this.getVoice(),c=b.getNote(this.noteIdx),d=this.getDpq();return a.getQuarterDuration(c,d)},j.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)}}.call(this),function(){"use strict";var a=Adagio.Utils.math,b=Adagio.edit.composite.SplitRest,c=Adagio.edit.common.timePosToFloorNoteIdx,d=Adagio.edit.common.initMeasureData,e=Adagio.edit.composite.SplitRestIfNeeded=function(a,b,c){this.init(a,b,c)};e.NAME="composite.SplitRestIfNeeded";var f=e.prototype;f.initMeasureData=d,f.name=e.NAME,f.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.optsTimePos=null,this.actualTimePos=null},f.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.needSplitRest()&&this.splitRest()},f.needSplitRest=function(){return this.getActualTimePos()!==this.getOptsTimePos()},f.getActualTimePos=function(){if(null===this.actualTimePos){var a=this.measureData.getVoice(this.opts.voiceIdx),b=this.getInternalCoeff(),d=this.getOptsTimePos(),e=c(a,b,d);this.actualTimePos=a.getRangeSpace(0,e)*b}return this.actualTimePos},f.getOptsTimePos=function(){if(null===this.optsTimePos){var a=this.getExternalCoeff();this.optsTimePos=this.opts.timePos*a}return this.optsTimePos},f.getExternalCoeff=function(){var b=this.measureData.getDpqValue();return a.lcm(this.opts.dpq,b)/this.opts.dpq},f.getInternalCoeff=function(){var b=this.measureData.getDpqValue();return a.lcm(this.opts.dpq,b)/b},f.splitRest=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,timePos:this.opts.timePos,divisions:this.opts.dpq};new b(this.measureData,a,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.client.NotPossibleOnRestsError,b=Adagio.Error.client.PitchCollisionError,c=Adagio.Error.client.NotPossibleOnUnpitchedError,d=Adagio.Error.client.BadPartIdxError,e=Adagio.Error.client.BadMeasureIdxError,f=Adagio.Error.client.BadVoiceError,g=Adagio.Error.client.BadNoteIdxError,h=Adagio.Error.client.TieError,i=Adagio.Utils.noteUtils,j=Adagio.Utils.pitchUtils,k=Adagio.Data.tieAction,l=Adagio.edit.action.RemoveArpeggio,m=Adagio.edit.common.CrossMeasure,n=Adagio.edit.common.convertTimePosToGetNoteIdx,o=Adagio.edit.common.noteIdxToTimePos,p=Adagio.edit.common.convertPartUuidToGetPartIdx,q=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,r=Adagio.edit.common.transposePitchLineOpts,s=Adagio.edit.common.initMeasureData,t=Adagio.edit.common.lineToDestPitch,u=Adagio.edit.action.AddTieArc=function(a,b,c){this.init(a,b,c)};u.NAME="action.AddTieArc",u.isAuthorizedException=function(i){return i instanceof d||i instanceof e||i instanceof f||i instanceof g||i instanceof h||i instanceof a||i instanceof b||i instanceof c};var v=u.prototype;v.name=u.NAME,v.initMeasureData=s,v.lineToDestPitch=t,v.init=function(a,b,c){p(a,b),q(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,n(this.measureData,b),this.lineToDestPitch(),this.opts.isConcertPitch&&(this.opts.pitch=j.copy(this.opts),r(this.measureData,this.opts),this.opts.octave=j.getOctave(this.opts.pitch),this.opts.step=j.getStep(this.opts.pitch)),this.crossMeasure=new m(this.measureData,b.voiceIdx,b.noteIdx),this.location=null},v.checkPreconditions=function(){this.checkPitchedPart(),this.crossMeasure.checkVoiceIdx(),this.crossMeasure.checkNoteIdx(),this.checkNotRest(),this.checkPitch()},v.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new c},v.checkNotRest=function(){if(this.isLeftRest()||this.isRightRest())throw new a},v.isLeftRest=function(){return this.crossMeasure.isLeftRest()},v.isRightRest=function(){return this.crossMeasure.isRightRest()},v.checkPitch=function(){if(this.crossMeasure.hasRightGrace())throw new h(this.name,"right not cannot have graces notes attached.");var a,c=this.getLeftChord(),d=this.getRightChord(),e=c.find(this.pitchPredicate,this);if(void 0===e)throw a={msgPrefix:"there is no left note"},new b(a,this.opts);var f=d.find(this.pitchPredicate,this);if(void 0===f)throw a={msgPrefix:"there is no right note"},new b(a,this.opts);var g=i.getPitch(e),l=i.getPitch(f);if(!j.isSamePitch(g,l))throw new h(this.name,"notes must have the same pitch");if(k.areNotesTied(e,f))throw new h(this.name,"notes are already tied")},v.pitchPredicate=function(a){var b=i.getPitch(a);return j.isSameLine(b,this.opts)},v.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.removeRightArpeggio();var a=this.getLeftChord(),b=this.getRightChord(),c=a.find(this.pitchPredicate,this),d=b.find(this.pitchPredicate,this),e=j.copy(i.getPitch(c));k.tieNotes(c,d),this.updateStack(e)},v.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,divisions:a.dpq,timePos:a.timePos,voiceIdx:this.opts.voiceIdx,octave:this.opts.octave,step:this.opts.step}};this.cancelStack.storeAction(b)}},v.removeRightArpeggio=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.crossMeasure.getRightMeasureIdx(),voiceIdx:this.opts.voiceIdx,noteIdx:this.crossMeasure.getRightNoteIdx()},b=this.crossMeasure.getRightMeasure();new l(b,a,this.cancelStack).performIfPossible()},v.getLeftChord=function(){return this.crossMeasure.getLeftChord()},v.getRightChord=function(){return this.crossMeasure.getRightChord()},v.updateStack=function(a){this.opts.leftNoteIdx=this.crossMeasure.getLeftNoteIdx(),this.opts.leftMeasureIdx=this.crossMeasure.getLeftMeasureIdx(),this.opts.rightNoteIdx=this.crossMeasure.getRightNoteIdx(),this.opts.rightMeasureIdx=this.crossMeasure.getRightMeasureIdx();var b=this.getLocation(),c={type:this.name,opts:{partUuid:b.partUuid,partIdx:this.opts.partIdx,measureUuid:b.measureUuid,measureIdx:this.opts.leftMeasureIdx,noteIdx:this.opts.leftNoteIdx,timePos:b.timePos,divisions:b.dpq,voiceIdx:this.opts.voiceIdx,pitch:j.copy(a)}};this.cancelStack.push(c);var d={type:this.name+"-close",opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.rightMeasureIdx,noteIdx:this.opts.rightNoteIdx,voiceIdx:this.opts.voiceIdx,pitch:j.copy(a)}};this.cancelStack.push(d)},v.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=this.crossMeasure.getLeftMeasureIdx(),d=a.getMeasureUuid(c),e=this.crossMeasure.getLeftMeasure().getDpqValue(),f=this.crossMeasure.getLeftVoice(),g=this.crossMeasure.getLeftNoteIdx(),h=o(f,g);this.location={partUuid:b,measureUuid:d,dpq:e,timePos:h}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.client.NotPossibleOnRestsError,b=Adagio.Error.client.NotPossibleOnUnpitchedError,c=Adagio.Error.client.TieError,d=Adagio.Data.tieAction,e=Adagio.Utils.noteUtils,f=Adagio.Utils.pitchUtils,g=Adagio.edit.action.AddTieArc,h=Adagio.edit.action.RemoveArpeggio,i=Adagio.edit.common.CrossMeasure,j=Adagio.edit.common.noteIdxToTimePos,k=Adagio.edit.common.convertPartUuidToGetPartIdx,l=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,m=Adagio.edit.common.convertTimePosToGetNoteIdx,n=Adagio.edit.common.initMeasureData,o=Adagio.edit.action.AddTie=function(a,b,c){this.init(a,b,c)};o.NAME="action.AddTie";var p=o.prototype;p.name=o.NAME,p.initMeasureData=n,p.init=function(a,b,c){k(a,b),l(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,m(this.measureData,b),this.crossMeasure=new i(this.measureData,b.voiceIdx,b.noteIdx),this.location=null},p.checkPreconditions=function(){this.checkPitchedPart(),this.crossMeasure.checkVoiceIdx(),this.crossMeasure.checkNoteIdx(),this.checkNotRest(),this.checkCanTie()},p.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new b},p.checkNotRest=function(){if(this.isLeftRest()||this.isRightRest())throw new a},p.isLeftRest=function(){return this.crossMeasure.isLeftRest()},p.isRightRest=function(){return this.crossMeasure.isRightRest()},p.checkCanTie=function(){if(this.crossMeasure.hasRightGrace())throw new c(this.name,"right not cannot have graces notes attached.");var a=this.getLeftChord(),b=this.getRightChord();if(!d.canTieChords(a,b))throw new c(this.name,"nothing can be tied")},p.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.removeRightArpeggio();var a=this.getLeftChord(),b=this.getRightChord(),c=q(a,b);d.tieChords(a,b),this.updateStack(c)},p.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,divisions:a.dpq,timePos:a.timePos,voiceIdx:this.opts.voiceIdx}};this.cancelStack.storeAction(b)}},p.removeRightArpeggio=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.crossMeasure.getRightMeasureIdx(),voiceIdx:this.opts.voiceIdx,noteIdx:this.crossMeasure.getRightNoteIdx()},b=this.crossMeasure.getRightMeasure();new h(b,a,this.cancelStack).performIfPossible()},p.getLeftChord=function(){return this.crossMeasure.getLeftChord()},p.getRightChord=function(){return this.crossMeasure.getRightChord()};var q=function(a,b){return d.getUntiedPairs(a,b).map(r)},r=function(a){var b=e.getPitch(a.left);return f.copy(b)};p.updateStack=function(a){this.opts.leftNoteIdx=this.crossMeasure.getLeftNoteIdx(),this.opts.leftMeasureIdx=this.crossMeasure.getLeftMeasureIdx(),this.opts.rightNoteIdx=this.crossMeasure.getRightNoteIdx(),this.opts.rightMeasureIdx=this.crossMeasure.getRightMeasureIdx(),a.forEach(this.addAction,this)},p.addAction=function(a){var b=this.getLocation(),c={type:g.NAME,opts:{partIdx:this.opts.partIdx,partUuid:b.partUuid,measureIdx:this.opts.leftMeasureIdx,measureUuid:b.measureUuid,noteIdx:this.opts.leftNoteIdx,timePos:b.timePos,divisions:b.dpq,voiceIdx:this.opts.voiceIdx,pitch:f.copy(a)}};this.cancelStack.push(c);var d={type:g.NAME+"-close",opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.rightMeasureIdx,noteIdx:this.opts.rightNoteIdx,voiceIdx:this.opts.voiceIdx,pitch:f.copy(a)}};this.cancelStack.push(d)},p.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=this.crossMeasure.getLeftMeasureIdx(),d=a.getMeasureUuid(c),e=this.crossMeasure.getLeftMeasure().getDpqValue(),f=this.crossMeasure.getLeftVoice(),g=this.crossMeasure.getLeftNoteIdx(),h=j(f,g);this.location={partUuid:b,measureUuid:d,dpq:e,timePos:h}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Utils.clone,b=Adagio.Utils.durationUtils,c=Adagio.Utils.noteUtils,d=Adagio.Utils.pitchUtils,e=Adagio.edit.composite.RemoveSpaceTuplets,f=Adagio.edit.composite.RemoveSpaceChordsQuarter,g=Adagio.edit.composite.SplitRestIfNeeded,h=Adagio.edit.action.AddChord,i=Adagio.edit.action.AddTie,j=Adagio.edit.action.ShowMeasureVoice,k=Adagio.edit.common.timePosToNoteIdx,l=Adagio.edit.common.initMeasureData,m=Adagio.edit.common.assertPerform,n=Adagio.edit.composite.AddChordIntraMeasure=function(a,b,c){this.init(a,b,c)};n.NAME="composite.AddChordIntraMeasure";var o=n.prototype;o.name=n.NAME,o.initMeasureData=l,o.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.firstChord=!0,this.quarterPosition=b.quarterPosition,this.quarterDuration=b.quarterDuration,this.noteIdx=null},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.isVoiceDisplayed()?(this.removeSpaceTuplets(),this.removeSpaceChords()):this.displayVoice(),this.splitRest(),this.fetchNoteIdx(),this.addChords()},o.isVoiceDisplayed=function(){return this.measureData.hasVoice(this.opts.voiceIdx)},o.removeSpaceTuplets=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,quarterPosition:this.opts.quarterPosition,quarterDuration:this.opts.quarterDuration};new e(this.measureData,a,this.cancelStack).perform()},o.removeSpaceChords=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,quarterPosition:this.opts.quarterPosition,quarterDuration:this.opts.quarterDuration};new f(this.measureData,a,this.cancelStack).perform()},o.displayVoice=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx},b=new j(this.measureData,a,this.cancelStack);m(b)},o.splitRest=function(){
var a=b.quarterDurationToRequiredDpq(this.quarterPosition),c=b.quarterToDuration(this.quarterPosition,a),d={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,timePos:c,dpq:a};new g(this.measureData,d,this.cancelStack).perform()},o.fetchNoteIdx=function(){var a=this.measureData.getDpqValue(),c=b.quarterToDuration(this.quarterPosition,a),d=this.measureData.getVoice(this.opts.voiceIdx);this.noteIdx=k(d,1,c)},o.addChords=function(){for(;this.quarterDuration>0;){var a=this.getDurationOpts();this.addChord(a),this.isFirstChord()||this.tieWithPrevious(),this.moveForward()}},o.getDurationOpts=function(){var a=b.extractQuarterPossibleDuration(this.quarterDuration);return b.quarterToDurationOpts(a)},o.addChord=function(a){var b=this.opts.heads.map(p),c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,noteIdx:this.noteIdx,heads:b,durationType:a.durationType,nbDots:a.nbDots,checkLine:!1},d=new h(this.measureData,c,this.cancelStack);m(d)};var p=function(b){var c=d.copy(b.pitch),e={pitch:c};return void 0!==b.fretData&&(e.fretData=a(b.fretData)),e};o.isFirstChord=function(){return this.firstChord},o.tieWithPrevious=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.noteIdx-1},b=new i(this.measureData,a,this.cancelStack);m(b)},o.moveForward=function(){this.firstChord=!1;var a=this.getCurrentQuarterDuration();this.quarterDuration-=a,this.noteIdx++},o.getCurrentQuarterDuration=function(){var a=this.measureData.getDpqValue(),b=this.measureData.getVoice(this.opts.voiceIdx),d=b.getNote(this.noteIdx);return c.getQuarterDuration(d,a)}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.AlreadyHasMeasureUuidError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="AlreadyHasMeasureUuidError",this.stack=e.stack,this.message=e.message,this.measureUuid=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"There is already a measure linked the following UUID "+a}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.UuidInconsistencyError=function(b,d){var e=c(d),f=a.call(this,e);return this.name=f.name="UuidInconsistencyError",this.stack=f.stack,this.message=f.message,this.uuid=b,this.entity=d,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"There cannot be the same uuid for "+a+" insertion and location."};b.MEASURE="measure",b.PART="part"}.call(this),function(){"use strict";var a=Adagio.Utils.clone,b=Adagio.edit.action.RemoveTie,c=Adagio.edit.action.RemoveTiePercu,d=Adagio.edit.common.initMeasureData,e=Adagio.edit.composite.RemoveStaffMeasureLeftTies=function(a,b,c){this.init(a,b,c)};e.NAME="composite.RemoveStaffMeasureLeftTies";var f=e.prototype;f.initMeasureData=d,f.name=e.NAME,f.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},f.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var d=a(this.opts);d.noteIdx=-1,new(this.measureData.isUnpitched()?c:b)(this.measureData,d,this.cancelStack).performIfPossible()}}.call(this),function(){"use strict";var a=Adagio.Utils.clone,b=Adagio.edit.composite.RemoveStaffMeasureLeftTies,c=Adagio.edit.common.initMeasureData,d=Adagio.edit.composite.RemoveMeasureLeftTies=function(a,b,c){this.init(a,b,c)};d.NAME="composite.RemoveMeasureLeftTies";var e=d.prototype;e.initMeasureData=c,e.name=d.NAME,e.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.measureData.forEachVoice(this.removeVoiceTies,this)},e.removeVoiceTies=function(c,d){var e=a(this.opts);e.voiceIdx=d,new b(this.measureData,e,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Utils.clone,b=Adagio.edit.composite.RemoveMeasureLeftTies,c=Adagio.edit.composite.RemoveColumnLeftTies=function(a,b,c){this.init(a,b,c)};c.NAME="composite.RemoveColumnLeftTies";var d=c.prototype;d.name=c.NAME,d.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);for(var c=this.scoreData.getNbParts(),d=0;d<c;d++){var e=a(this.opts);e.partIdx=d;new b(this.scoreData,e,this.cancelStack).perform()}}}.call(this),function(){"use strict";var a=Adagio.Utils.clone,b=Adagio.edit.action.RemoveHammerOnPullOffs,c=Adagio.edit.common.initMeasureData,d=Adagio.edit.composite.RemoveStaffMeasureLeftHammerOnPullOffs=function(a,b,c){this.init(a,b,c)};d.NAME="composite.RemoveStaffMeasureLeftHammerOnPullOffs";var e=d.prototype;e.initMeasureData=c,e.name=d.NAME,e.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var c=a(this.opts);c.noteIdx=-1,new b(this.measureData,c,this.cancelStack).performIfPossible()}}.call(this),function(){"use strict";var a=Adagio.Utils.clone,b=Adagio.edit.composite.RemoveStaffMeasureLeftHammerOnPullOffs,c=Adagio.edit.common.initMeasureData,d=Adagio.edit.composite.RemoveMeasureLeftHammerOnPullOffs=function(a,b,c){this.init(a,b,c)};d.NAME="composite.RemoveMeasureLeftHammerOnPullOffs";var e=d.prototype;e.initMeasureData=c,e.name=d.NAME,e.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.measureData.forEachVoice(this.removeVoiceHammerOnPullOffs,this)},e.removeVoiceHammerOnPullOffs=function(c,d){var e=a(this.opts);e.voiceIdx=d,new b(this.measureData,e,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Utils.clone,b=Adagio.edit.composite.RemoveMeasureLeftHammerOnPullOffs,c=Adagio.edit.composite.RemoveColumnLeftHammerOnPullOffs=function(a,b,c){this.init(a,b,c)};c.NAME="composite.RemoveColumnLeftHammerOnPullOffs";var d=c.prototype;d.name=c.NAME,d.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);for(var c=this.scoreData.getNbParts(),d=0;d<c;d++){var e=a(this.opts);e.partIdx=d;new b(this.scoreData,e,this.cancelStack).perform()}}}.call(this),function(){"use strict";var a=Adagio.Utils.clone,b=Adagio.edit.action.RemoveGlissandos,c=Adagio.edit.common.initMeasureData,d=Adagio.edit.composite.RemoveStaffMeasureLeftGlissandos=function(a,b,c){this.init(a,b,c)};d.NAME="composite.RemoveStaffMeasureLeftGlissandos";var e=d.prototype;e.initMeasureData=c,e.name=d.NAME,e.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var c=a(this.opts);c.noteIdx=-1,new b(this.measureData,c,this.cancelStack).performIfPossible()}}.call(this),function(){"use strict";var a=Adagio.Utils.clone,b=Adagio.edit.composite.RemoveStaffMeasureLeftGlissandos,c=Adagio.edit.common.initMeasureData,d=Adagio.edit.composite.RemoveMeasureLeftGlissandos=function(a,b,c){this.init(a,b,c)};d.NAME="composite.RemoveMeasureLeftGlissandos";var e=d.prototype;e.initMeasureData=c,e.name=d.NAME,e.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.measureData.forEachVoice(this.removeVoiceGlissandos,this)},e.removeVoiceGlissandos=function(c,d){var e=a(this.opts);e.voiceIdx=d,new b(this.measureData,e,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Utils.clone,b=Adagio.edit.composite.RemoveMeasureLeftGlissandos,c=Adagio.edit.composite.RemoveColumnLeftGlissandos=function(a,b,c){this.init(a,b,c)};c.NAME="composite.RemoveColumnLeftGlissandos";var d=c.prototype;d.name=c.NAME,d.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);for(var c=this.scoreData.getNbParts(),d=0;d<c;d++){var e=a(this.opts);e.partIdx=d;new b(this.scoreData,e,this.cancelStack).perform()}}}.call(this),function(){"use strict";var a=Adagio.edit.common.getCommonContent,b=Adagio.Utils.tempoUtils,c=Adagio.edit.primitive.AddOwnTempo=function(a,b,c){this.init(a,b,c)};c.NAME="primitive.AddOwnTempo";var d=c.prototype;d.name=c.NAME,d.init=function(b,c,d){this.commonContent=a(b),this.cancelStack=d,this.opts=c},d.perform=function(){this.addTempo(),this.updateStack()},d.addTempo=function(){var a=b.copy(this.opts.tempo);this.commonContent.setOwnTempo(this.opts.measureIdx,a)},d.updateStack=function(){var a={type:this.name,opts:{partIdx:0,measureIdx:this.opts.measureIdx}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.edit.common.getCommonContent,b=Adagio.edit.primitive.AddOwnTempo,c=Adagio.Utils.tempoUtils,d=Adagio.edit.composite.AddOwnTempoIfNeeded=function(a,b,c){this.init(a,b,c)};d.NAME="composite.AddOwnTempoIfNeeded";var e=d.prototype;e.name=d.NAME,e.init=function(b,c,d){this.commonContent=a(b),this.cancelStack=d,this.opts=c},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.needAddOwnTempo()&&this.addOwnTempo()},e.needAddOwnTempo=function(){return!this.hasOwnTempo()||!this.hasSameTempo()},e.hasOwnTempo=function(){return this.commonContent.hasOwnTempo(this.opts.measureIdx)},e.hasSameTempo=function(){var a=this.commonContent.getOwnTempo(this.opts.measureIdx);return c.isSame(a,this.opts.tempo)},e.addOwnTempo=function(){var a=c.copy(this.opts.tempo),d={measureIdx:this.opts.measureIdx,tempo:a};new b(this.commonContent,d,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.edit.common.getCommonContent,b=Adagio.edit.primitive.RemoveOwnTempo=function(a,b,c){this.init(a,b,c)};b.NAME="primitive.RemoveOwnTempo";var c=b.prototype;c.name=b.NAME,c.init=function(b,c,d){this.commonContent=a(b),this.cancelStack=d,this.opts=c},c.perform=function(){this.removeOwnTempo(),this.updateStack()},c.removeOwnTempo=function(){this.commonContent.removeOwnTempo(this.opts.measureIdx)},c.updateStack=function(){var a={type:this.name,opts:{partIdx:0,measureIdx:this.opts.measureIdx}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.edit.common.getCommonContent,b=Adagio.edit.primitive.RemoveOwnTempo,c=Adagio.edit.composite.RemoveOwnTempoIfNeeded=function(a,b,c){this.init(a,b,c)};c.NAME="composite.RemoveOwnTempoIfNeeded";var d=c.prototype;d.name=c.NAME,d.init=function(b,c,d){this.commonContent=a(b),this.cancelStack=d,this.opts=c},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.hasOwnTempo()&&this.removeOwnTempo()},d.hasOwnTempo=function(){return this.commonContent.hasOwnTempo(this.opts.measureIdx)},d.removeOwnTempo=function(){var a={measureIdx:this.opts.measureIdx};new b(this.commonContent,a,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.edit.composite.AddOwnTempoIfNeeded,b=Adagio.edit.composite.RemoveOwnTempoIfNeeded,c=Adagio.edit.common.getCommonContent,d=Adagio.Utils.tempoUtils,e=Adagio.edit.composite.UpdateOwnTempo=function(a,b,c){this.init(a,b,c)};e.NAME="composite.UpdateOwnTempo";var f=e.prototype;f.name=e.NAME,f.init=function(a,b,d){this.commonContent=c(a),this.cancelStack=d,this.opts=b},f.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.shouldHaveOwnTempo()?this.addOwnTempo():this.removeOwnTempo()},f.shouldHaveOwnTempo=function(){return!this.hasPreviousMeasure()||this.isPreviousTempoDifferent()},f.hasPreviousMeasure=function(){return this.opts.measureIdx>0},f.isPreviousTempoDifferent=function(){var a=this.getCurrentMeasureTempo(),b=this.getPreviousMeasureTempo();return!d.isSame(a,b)},f.getCurrentMeasureTempo=function(){return this.commonContent.getTempo(this.opts.measureIdx)},f.getPreviousMeasureTempo=function(){return this.commonContent.getTempo(this.opts.measureIdx-1)},f.addOwnTempo=function(){var b=this.getCurrentMeasureTempo();b=d.copy(b);var c={measureIdx:this.opts.measureIdx,tempo:b};new a(this.commonContent,c,this.cancelStack).perform()},f.removeOwnTempo=function(){var a={measureIdx:this.opts.measureIdx};new b(this.commonContent,a,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.edit.common.getCommonContent,b=Adagio.Utils.swingUtils,c=Adagio.edit.primitive.AddOwnSwing=function(a,b,c){this.init(a,b,c)};c.NAME="primitive.AddOwnSwing";var d=c.prototype;d.name=c.NAME,d.init=function(b,c,d){this.commonContent=a(b),this.cancelStack=d,this.opts=c},d.perform=function(){this.addSwing(),this.updateStack()},d.addSwing=function(){this.commonContent.setOwnSwing(this.opts.measureIdx,b.copy(this.opts.swing))},d.updateStack=function(){var a={type:this.name,opts:{partIdx:0,measureIdx:this.opts.measureIdx}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.edit.common.getCommonContent,b=Adagio.edit.primitive.AddOwnSwing,c=Adagio.Utils.swingUtils,d=Adagio.edit.composite.AddOwnSwingIfNeeded=function(a,b,c){this.init(a,b,c)};d.NAME="composite.AddOwnSwingIfNeeded";var e=d.prototype;e.name=d.NAME,e.init=function(b,c,d){this.commonContent=a(b),this.cancelStack=d,this.opts=c},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.needAddOwnSwing()&&this.addOwnSwing()},e.needAddOwnSwing=function(){return!this.hasOwnSwing()||!this.hasSameSwing()},e.hasOwnSwing=function(){return this.commonContent.hasOwnSwing(this.opts.measureIdx)},e.hasSameSwing=function(){var a=this.commonContent.getOwnSwing(this.opts.measureIdx);return c.isSame(a,this.opts.swing)},e.addOwnSwing=function(){var a={measureIdx:this.opts.measureIdx,swing:c.copy(this.opts.swing)};new b(this.commonContent,a,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.edit.common.getCommonContent,b=Adagio.edit.primitive.RemoveOwnSwing=function(a,b,c){this.init(a,b,c)};b.NAME="primitive.RemoveOwnSwing";var c=b.prototype;c.name=b.NAME,c.init=function(b,c,d){this.commonContent=a(b),this.cancelStack=d,this.opts=c},c.perform=function(){this.removeOwnSwing(),this.updateStack()},c.removeOwnSwing=function(){this.commonContent.removeOwnSwing(this.opts.measureIdx)},c.updateStack=function(){var a={type:this.name,opts:{partIdx:0,measureIdx:this.opts.measureIdx}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.edit.common.getCommonContent,b=Adagio.edit.primitive.RemoveOwnSwing,c=Adagio.edit.composite.RemoveOwnSwingIfNeeded=function(a,b,c){this.init(a,b,c)};c.NAME="composite.RemoveOwnSwingIfNeeded";var d=c.prototype;d.name=c.NAME,d.init=function(b,c,d){this.commonContent=a(b),this.cancelStack=d,this.opts=c},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.hasOwnSwing()&&this.removeOwnSwing()},d.hasOwnSwing=function(){return this.commonContent.hasOwnSwing(this.opts.measureIdx)},d.removeOwnSwing=function(){var a={measureIdx:this.opts.measureIdx};new b(this.commonContent,a,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.edit.composite.AddOwnSwingIfNeeded,b=Adagio.edit.composite.RemoveOwnSwingIfNeeded,c=Adagio.edit.common.getCommonContent,d=Adagio.Utils.swingUtils,e=Adagio.edit.composite.UpdateOwnSwing=function(a,b,c){this.init(a,b,c)};e.NAME="composite.UpdateOwnSwing";var f=e.prototype;f.name=e.NAME,f.init=function(a,b,d){this.commonContent=c(a),this.cancelStack=d,this.opts=b},f.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.shouldHaveOwnSwing()?this.addOwnSwing():this.removeOwnSwing()},f.shouldHaveOwnSwing=function(){return!this.hasPreviousMeasure()||this.isPreviousSwingDifferent()},f.hasPreviousMeasure=function(){return this.opts.measureIdx>0},f.isPreviousSwingDifferent=function(){var a=this.getCurrentMeasureSwing(),b=this.getPreviousMeasureSwing();return!d.isSame(a,b)},f.getCurrentMeasureSwing=function(){return this.commonContent.getSwing(this.opts.measureIdx)},f.getPreviousMeasureSwing=function(){return this.commonContent.getSwing(this.opts.measureIdx-1)},f.addOwnSwing=function(){var b=this.getCurrentMeasureSwing(),c={measureIdx:this.opts.measureIdx,swing:d.copy(b)};new a(this.commonContent,c,this.cancelStack).perform()},f.removeOwnSwing=function(){var a={measureIdx:this.opts.measureIdx};new b(this.commonContent,a,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.edit.composite.UpdateOwnTempo,b=Adagio.edit.composite.UpdateOwnSwing,c=Adagio.Utils.timeUtils,d=Adagio.Utils.swingUtils,e=Adagio.Utils.tempoUtils,f=Adagio.edit.composite.AddCommonContentMeasure=function(a,b,c){this.init(a,b,c)};f.NAME="composite.AddCommonContentMeasure";var g=f.prototype;g.name=f.NAME,g.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},g.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.addMeasure(),this.updateOwnTempo(),this.updateOwnSwing(),this.hasInsertedAtEnd()||this.updateNextOwnTempo()},g.addMeasure=function(){var a=this.getTempo(),b=this.getSwing(),f=this.getDisplayedTime();f=c.copy(f);var g=this.scoreData.getCommonContent();g.addMeasure(this.opts.measureIdx,e.copy(a),d.copy(b)),g.setDisplayedTime(this.opts.measureIdx,f)},g.getTempo=function(){var a=this.getSourceMeasureIdx();return this.scoreData.getRealTempo(a)},g.getSwing=function(){var a=this.getSourceMeasureIdx();return this.scoreData.getSwing(a)},g.getDisplayedTime=function(){var a=this.getSourceMeasureIdx();return this.scoreData.getCommonContent().getDisplayedTime(a)},g.getSourceMeasureIdx=function(){return 0===this.opts.measureIdx?0:this.opts.measureIdx-1},g.updateOwnTempo=function(){var b={measureIdx:this.opts.measureIdx};new a(this.scoreData,b,this.cancelStack).perform()},g.updateOwnSwing=function(){var a={measureIdx:this.opts.measureIdx};new b(this.scoreData,a,this.cancelStack).perform()},g.hasInsertedAtEnd=function(){var a=this.scoreData.getCommonContent(),b=a.getNbMeasures();return this.opts.measureIdx===b-1},g.updateNextOwnTempo=function(){var b={measureIdx:this.opts.measureIdx+1};new a(this.scoreData,b,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.timeUtils,c=Adagio.edit.primitive.AddOwnTimeSignature=function(a,b,c){this.init(a,b,c)};c.NAME="primitive.AddOwnTimeSignature";var d=c.prototype;d.name=c.NAME,d.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.previousTime=null},d.perform=function(){this.hasPreviousTime()&&this.savePreviousTime(),this.addTime(),this.updateStack()},d.hasPreviousTime=function(){var b=this.getMeasure();return a.hasOwnTime(b)},d.savePreviousTime=function(){var c=this.getMeasure(),d=a.getWrappedOwnTime(c),e=d.getAnyEntry();this.previousTime=b.copy(e)},d.addTime=function(){for(var c=this.getMeasure(),d=a.getWrappedOwnTime(c),e=d.getNbStaves(),f=0;f<e;f++){var g=b.copy(this.opts.timeSignature);d.setEntry(g,f)}var h=d.dumpAttribute();a.setOwnTime(c,h)},d.getMeasure=function(){return this.scoreData.getPartContent(this.opts.partIdx).measure[this.opts.measureIdx]},d.updateStack=function(){var a=b.copy(this.opts.timeSignature),c={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,previousTimeSignature:this.previousTime,newTimeSignature:a}};this.cancelStack.push(c)}}.call(this),function(){"use strict";var a=Adagio.edit.primitive.AddOwnTimeSignature,b=Adagio.Utils.measureUtils,c=Adagio.Utils.timeUtils,d=Adagio.edit.composite.AddOwnTimeSignatureIfNeeded=function(a,b,c){this.init(a,b,c)};d.NAME="composite.AddOwnTimeSignatureIfNeeded";var e=d.prototype;e.name=d.NAME,e.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.measure=null},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.needAddOwnTime()&&this.addOwnTime()},e.needAddOwnTime=function(){return!this.hasOwnTime()||!this.hasSameTime()},e.hasOwnTime=function(){var a=this.getMeasure();return b.hasOwnTime(a)},e.hasSameTime=function(){var a=this.getMeasure(),d=b.getWrappedOwnTime(a),e=d.getAnyEntry();return c.isSame(e,this.opts.timeSignature)},e.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},e.addOwnTime=function(){var b=c.copy(this.opts.timeSignature),d={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timeSignature:b};new a(this.scoreData,d,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.timeUtils,c=Adagio.edit.primitive.RemoveOwnTimeSignature=function(a,b,c){this.init(a,b,c)};c.NAME="primitive.RemoveOwnTimeSignature";var d=c.prototype;d.name=c.NAME,d.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.removedTime=null},d.perform=function(){this.saveRemovedTime(),this.removeTimeSignature(),this.updateStack()},d.saveRemovedTime=function(){var c=this.getMeasure(),d=a.getWrappedOwnTime(c),e=d.getAnyEntry();this.removedTime=b.copy(e)},d.removeTimeSignature=function(){var b=this.getMeasure(),c=[];a.setOwnTime(b,c)},d.getMeasure=function(){return this.scoreData.getPartContent(this.opts.partIdx).measure[this.opts.measureIdx]},d.updateStack=function(){var a=b.copy(this.removedTime),c={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,removedTimeSignature:a}};this.cancelStack.push(c)}}.call(this),function(){"use strict";var a=Adagio.edit.primitive.RemoveOwnTimeSignature,b=Adagio.Utils.measureUtils,c=Adagio.edit.composite.RemoveOwnTimeSignatureIfNeeded=function(a,b,c){this.init(a,b,c)};c.NAME="composite.RemoveOwnTimeSignatureIfNeeded";var d=c.prototype;d.name=c.NAME,d.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.measure=null},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.hasOwnTime()&&this.removeOwnTime()},d.hasOwnTime=function(){var a=this.getMeasure();return b.hasOwnTime(a)},d.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},d.removeOwnTime=function(){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx};new a(this.scoreData,b,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.edit.composite.AddOwnTimeSignatureIfNeeded,b=Adagio.edit.composite.RemoveOwnTimeSignatureIfNeeded,c=Adagio.Utils.timeUtils,d=Adagio.edit.composite.UpdateOwnTimeSignature=function(a,b,c){this.init(a,b,c)};d.NAME="composite.UpdateOwnTimeSignature";var e=d.prototype;e.name=d.NAME,e.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.measures=null},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.shouldHaveOwnTime()?this.addOwnTime():this.removeOwnTime()},e.shouldHaveOwnTime=function(){return!this.hasPreviousMeasure()||this.isPreviousMeasureTimeDifferent()},e.hasPreviousMeasure=function(){return this.opts.measureIdx>0},e.isPreviousMeasureTimeDifferent=function(){var a=this.getCurrentMeasureTime(),b=this.getPreviousMeasureTime();return!c.isSame(b,a)},e.getCurrentMeasureTime=function(){return this.getMeasureTime(this.opts.measureIdx)},e.getPreviousMeasureTime=function(){return this.getMeasureTime(this.opts.measureIdx-1)},e.getMeasureTime=function(a){return this.scoreData.getCommonContent().getDisplayedTime(a)},e.getMeasure=function(a){return this.getMeasures(a)[a]},e.getMeasures=function(){return null===this.measures&&(this.measures=this.scoreData.getPartMeasures(this.opts.partIdx)),this.measures},e.addOwnTime=function(){var b=this.getCurrentMeasureTime();b=c.copy(b);var d={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timeSignature:b};new a(this.scoreData,d,this.cancelStack).perform()},e.removeOwnTime=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx};new b(this.scoreData,a,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.edit.composite.UpdateOwnTimeSignature,b=Adagio.edit.composite.UpdateMeasuresRangeOwnTimeSignature=function(a,b,c){this.init(a,b,c)};b.NAME="composite.UpdateMeasuresRangeOwnTimeSignature";var c=b.prototype;c.name=b.NAME,c.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},c.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);for(var a=this.opts.startMeasureIdx;a<=this.opts.stopMeasureIdx;a++)this.updateMeasuresColumnTimeSignature(a);this.hasMeasureAfter()&&this.updateMeasuresColumnTimeSignature(this.opts.stopMeasureIdx+1)},c.hasMeasureAfter=function(){var a=this.getNbMeasures();return this.opts.stopMeasureIdx+1<a},c.getNbMeasures=function(){return this.scoreData.getPartMeasures(0).length},c.updateMeasuresColumnTimeSignature=function(a){for(var b=this.scoreData.getNbParts(),c=0;c<b;c++)this.updateMeasureTimeSignature(c,a)},c.updateMeasureTimeSignature=function(b,c){var d={partIdx:b,measureIdx:c};new a(this.scoreData,d,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.BadPreviousNextUuidError=function(b,c){var d="Cannot use neither previousUuid or nextUuid with the following values ";d+=b+" & "+c;var e=a.call(this,d);return this.name=e.name="BadPreviousNextUuidError",this.stack=e.stack,this.message=e.message,this.previousUuid=b,this.nextUuid=c,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}})}.call(this),function(){"use strict";var a=Adagio.Error.client.BadPreviousNextUuidError,b=Adagio.Utils.uuidUtils;Adagio.edit.common.checkLocationUuids=function(b,d){if(!c(b,d))throw new a(d.previousUuid,d.nextUuid)};var c=function(a,b){return!!d(a,b.previousUuid)||(!!d(a,b.nextUuid)||(!(!e(b.previousUuid)||null!==b.nextUuid)||!(!e(b.nextUuid)||null!==b.previousUuid)))},d=function(a,b){return e(b)&&a.hasMeasureIdxByUuid(b)},e=function(a){return"string"==typeof a&&b.isValid(a)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Error.client.BadMeasureIdxError,c=Adagio.Error.client.BadMeasureUuidError,d=Adagio.Error.client.AlreadyHasMeasureUuidError,e=Adagio.Error.client.UuidInconsistencyError,f=Adagio.edit.primitive.AddMeasure,g=Adagio.edit.composite.ClearRightBarline,h=Adagio.edit.composite.RemoveColumnLeftTies,i=Adagio.edit.composite.RemoveColumnLeftHammerOnPullOffs,j=Adagio.edit.composite.RemoveColumnLeftGlissandos,k=Adagio.edit.composite.AddCommonContentMeasure,l=Adagio.edit.composite.UpdateMeasuresRangeOwnTimeSignature,m=Adagio.Utils.math,n=Adagio.Utils.clone,o=Adagio.Utils.uuidUtils,p=Adagio.Utils.measureHeaderUtils,q=Adagio.Utils.measureUtils,r=Adagio.edit.common.measureUuidToMeasureIdx,s=Adagio.edit.common.checkLocationUuids,t=Adagio.edit.action.AddMeasure=function(a,b,c){this.init(a,b,c)};t.NAME="action.AddMeasure";var u=t.prototype;u.name=t.NAME,u.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},u.checkPreconditions=function(){if(this.hasGivenMeasureUuid()){if(!this.isValidUuid(this.opts.measureUuid))throw new c(this.opts.measureUuid,c.INSERT);if(this.scoreData.hasMeasureIdxByUuid(this.opts.measureUuid))throw new d(this.opts.measureUuid);if(this.hasGivenPreviousUuid()&&this.opts.measureUuid===this.opts.previousUuid)throw new e(this.opts.measureUuid,e.MEASURE);if(this.hasGivenNextUuid()&&this.opts.measureUuid===this.opts.nextUuid)throw new e(this.opts.measureUuid,e.MEASURE)}if(this.hasGivenPreviousUuid()||this.hasGivenNextUuid())this.checkLocationUuids();else{var a=this.scoreData.getNbMeasures(),f=this.opts.measureIdx;if(!m.isInteger(f)||f<0||f>a)throw new b(f,b.INSERT)}},u.checkLocationUuids=function(){s(this.scoreData,this.opts)},u.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),(this.hasGivenPreviousUuid()||this.hasGivenNextUuid())&&(this.opts.measureIdx=this.getIdxFromUuids());var a=this.getLocation();this.addMeasureHeader(),this.storeAction(a),this.isInsertingAtEnd()||(this.removeTies(),this.removeHammerOnPullOffs(),this.removeGlissandos()),this.addMeasures(),this.addCommonContentMeasure(),this.updateOwnTime(),this.hasInsertedAtEnd()&&this.updateFinalBarlines(),this.hasInsertedAtStart()&&this.updateNextOwnTime(),this.signalAttributesUpdated(),this.updateStack()},u.isInsertingAtEnd=function(){var a=this.scoreData.getPartContent(0),b=a.measure;return this.opts.measureIdx===b.length},u.removeTies=function(){var a=n(this.opts);new h(this.scoreData,a,this.cancelStack).perform()},u.removeHammerOnPullOffs=function(){var a=n(this.opts);new i(this.scoreData,a,this.cancelStack).perform()},u.removeGlissandos=function(){var a=n(this.opts);new j(this.scoreData,a,this.cancelStack).perform()},u.addMeasures=function(){this.scoreData.getPartsContents().forEach(function(a,b){var c=this.adaptOption(this.opts,b);new f(this.scoreData,c,this.cancelStack).perform()},this)},u.addCommonContentMeasure=function(){var a={measureIdx:this.opts.measureIdx};new k(this.scoreData,a,this.cancelStack).perform()},u.addMeasureHeader=function(){var a=this.createMeasureHeader();this.scoreData.insertMeasureHeader(a,this.opts.measureIdx)},u.createMeasureHeader=function(){return this.hasGivenMeasureUuid()?p.create(this.opts.measureUuid):{}},u.updateOwnTime=function(){var a={startMeasureIdx:this.opts.measureIdx,stopMeasureIdx:this.opts.measureIdx};new l(this.scoreData,a,this.cancelStack).perform()},u.hasInsertedAtEnd=function(){var a=this.scoreData.getPartContent(0),b=a.measure;return this.opts.measureIdx===b.length-1},u.updateFinalBarlines=function(){var a={measureIdx:this.opts.measureIdx};new g(this.scoreData,a,this.cancelStack).perform(),this.removePreviousEndingBarlineIfAny()},u.removePreviousEndingBarlineIfAny=function(){var a=0,b=this.scoreData.getMeasure(a,this.opts.measureIdx-1);if(q.hasFinalBarline(b)){var c={measureIdx:this.opts.measureIdx-1};new g(this.scoreData,c,this.cancelStack).perform()}},u.hasInsertedAtStart=function(){return 0===this.opts.measureIdx},u.signalAttributesUpdated=function(){this.opts.measureIdx>0&&this.signalMeasureAttributesUpdated(this.opts.measureIdx-1);var a=this.scoreData.getNbMeasures();this.opts.measureIdx+1<a&&this.signalMeasureAttributesUpdated(this.opts.measureIdx+1)},u.signalMeasureAttributesUpdated=function(a){this.scoreData.getPartsContents().forEach(function(b,c){var d={type:"primitive.updateAttributes",opts:{measureIdx:a,partIdx:c}};this.cancelStack.push(d)},this)},u.updateNextOwnTime=function(){var a=this.opts.measureIdx+1,b={startMeasureIdx:a,stopMeasureIdx:a};new l(this.scoreData,b,this.cancelStack).perform()},u.adaptOption=function(a,b){var c=n(a);return c.partIdx=b,c},u.hasGivenMeasureUuid=function(){return void 0!==this.opts.measureUuid},u.hasGivenPreviousUuid=function(){return void 0!==this.opts.previousUuid},u.hasGivenNextUuid=function(){return void 0!==this.opts.nextUuid},u.isValidUuid=function(a){return!("string"!=typeof a||!o.isValid(a))},u.hasUuid=function(a){return this.isValidUuid(a)&&this.scoreData.hasMeasureIdxByUuid(a)},u.getIdxFromUuids=function(){if(this.hasUuid(this.opts.previousUuid))return this.getIdxFromUuid(this.opts.previousUuid)+1;if(this.hasUuid(this.opts.nextUuid))return this.getIdxFromUuid(this.opts.nextUuid);if(null===this.opts.previousUuid)return 0;if(null===this.opts.nextUuid)return this.scoreData.getNbMeasures();throw new a("Unexpected")},u.getIdxFromUuid=function(a){return r(this.scoreData.getMeasuresHeaders(),a)},u.updateStack=function(){var a={type:this.name,noDraw:!0,opts:{measureUuid:this.scoreData.getMeasureUuid(this.opts.measureIdx)}};this.cancelStack.push(a)},u.storeAction=function(a){var b=this.scoreData.getMeasureUuid(this.opts.measureIdx),c={actionName:this.name,opts:{previousUuid:a.previousUuid,nextUuid:a.nextUuid,measureUuid:b}};this.cancelStack.hasAction()||this.opts.isSubAction?this.cancelStack.storeAddAction(c):this.cancelStack.storeAction(c)},u.getLocation=function(){
var b=this.opts.measureIdx-1<0?null:this.scoreData.getMeasureUuid(this.opts.measureIdx-1),c=this.scoreData.getNbMeasures(),d=this.opts.measureIdx>=c?null:this.scoreData.getMeasureUuid(this.opts.measureIdx);if(this.hasGivenMeasureUuid()&&(this.opts.measureUuid===b||this.opts.measureUuid===d)){var e="The added measure uuid ["+this.opts.measureUuid+"] also apprears on the location. ",f=new a("Inconsistency",e);throw f.measureUuid=this.opte.measureUuid,f}return{previousUuid:b,nextUuid:d}}}.call(this),function(){"use strict";var a=Adagio.Utils.clone,b=Adagio.Utils.durationUtils,c=Adagio.Utils.measureUtils,d=Adagio.Utils.pitchUtils,e=Adagio.edit.composite.AddChordIntraMeasure,f=Adagio.edit.action.AddTie,g=Adagio.edit.action.AddMeasure,h=Adagio.edit.common.MeasureData,i=Adagio.edit.common.timePosToNoteIdx,j=Adagio.edit.common.assertPerform,k=Adagio.edit.composite.AddChordCrossMeasure=function(a,b,c){this.init(a,b,c)};k.NAME="composite.AddChordCrossMeasure";var l=k.prototype;l.name=k.NAME,l.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.measureIdx=this.opts.measureIdx,this.quarterPosition=this.opts.quarterPosition,this.quarterDuration=this.opts.quarterDuration},l.perform=function(){for(this.cancelStack=this.cancelStack.createSubstack(this.name);this.quarterDuration>0;){var a=this.getSliceDuration();this.addChordIntraMeasure(a),this.isFirstMeasure()||this.tieWithPrevious(),this.moveForward(a),this.measureEndReached()&&this.nextMeasure()}this.storePosition()},l.isFirstMeasure=function(){return this.measureIdx===this.opts.measureIdx},l.tieWithPrevious=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:-1},b=new f(this.scoreData,a,this.cancelStack);j(b)},l.getSliceDuration=function(){var a=this.getMeasureQuarterDuration(),b=a-this.quarterPosition;return Math.min(b,this.quarterDuration)},l.addChordIntraMeasure=function(a){var b=this.opts.heads.map(m),c={partIdx:this.opts.partIdx,measureIdx:this.measureIdx,staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,quarterPosition:this.quarterPosition,quarterDuration:a,heads:b};new e(this.scoreData,c,this.cancelStack).perform()};var m=function(b){var c=d.copy(b.pitch),e={pitch:c};return void 0!==b.fretData&&(e.fretData=a(b.fretData)),e};l.moveForward=function(a){this.quarterPosition+=a,this.quarterDuration-=a},l.measureEndReached=function(){return this.getMeasureQuarterDuration()===this.quarterPosition},l.getMeasureQuarterDuration=function(){var a=this.scoreData.getMeasure(this.opts.partIdx,this.measureIdx),d=c.getAnyTime(a);return b.timeToQuarter(d)},l.nextMeasure=function(){this.measureIdx++,this.quarterPosition=0;var a=this.scoreData.getNbMeasures();this.measureIdx===a&&this.addMeasure()},l.addMeasure=function(){var a={measureIdx:this.measureIdx},b=new g(this.scoreData,a,this.cancelStack);j(b)},l.storePosition=function(){var a=this.fetchNoteIdx(),b={measureIdx:this.measureIdx,noteIdx:a};this.cancelStack.storePosition(b)},l.fetchNoteIdx=function(){if(0===this.quarterPosition)return 0;var a=this.scoreData.getMeasure(this.opts.partIdx,this.measureIdx),c=new h(a),d=c.getVoice(this.opts.voiceIdx),e=c.getDpqValue(),f=b.quarterToDuration(this.quarterPosition,e);return i(d,1,f)}}.call(this),function(){"use strict";var a=Adagio.Utils.transposeUtils,b=Adagio.Utils.pitchUtils;Adagio.edit.common.transposePitches=function(b,d){return a.isIdentity(d)?b:(d=a.getReverse(d),d=a.getReverse(d),b=b.map(c,d))};var c=function(a){var c=this;return b.transpose(a,c,!0)}}.call(this),function(){"use strict";var a=Adagio.Error.client.NotPossibleOnUnpitchedError,b=Adagio.Error.client.NoPitchesError,c=Adagio.Error.client.BadQuarterPositionError,d=Adagio.Error.client.BadQuarterDurationError,e=Adagio.Error.client.PitchCollisionError,f=Adagio.Error.client.BadVoiceError,g=Adagio.Error.value.BadQuarterPositionError,h=Adagio.Error.value.BadQuarterDurationError,i=Adagio.Utils.clone,j=Adagio.Utils.math,k=Adagio.Utils.measureUtils,l=Adagio.Utils.transposeUtils,m=Adagio.Utils.pitchUtils,n=Adagio.Utils.durationUtils,o=Adagio.edit.composite.AddChordCrossMeasure,p=Adagio.edit.common.MeasureData,q=Adagio.edit.common.checkCompatibleVoiceStaffIdx,r=Adagio.edit.common.convertPartUuidToGetPartIdx,s=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,t=Adagio.edit.common.transposePitches,u=Adagio.edit.action.AddChordCrossMeasure=function(a,b,c){this.init(a,b,c)};u.NAME="action.AddChordCrossMeasure",u.convertPitchesToHeads=function(a){var b=a.pitches;delete a.pitches,a.heads=b.map(z)};var v=u.prototype;v.name=u.NAME,v.init=function(a,b,c){r(a,b),s(a,b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.location=null,this.sanitized=!1,this.measureData=null},v.checkPreconditions=function(){this.checkPitchedPart(),this.checkLocation(),this.sanitizeIfNeeded(),this.checkPitches(),this.checkPosition(),this.checkDuration()},v.checkPitchedPart=function(){if(this.scoreData.isPartUnpitched(this.opts.partIdx))throw new a},v.checkLocation=function(){this.getMeasureData(),this.checkVoiceIdx(),q(this.scoreData,this.opts);var a=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx),b=k.getQuarterDuration(a),d=this.opts.quarterPosition;if(!j.isNumber(d)||d<0||d>=b)throw new c(d)},v.checkVoiceIdx=function(){if(!this.scoreData.hasPartVoiceIdx(this.opts.partIdx,this.opts.voiceIdx))throw new f(this.opts.voiceIdx)},v.getMeasureData=function(){if(null===this.measureData){var a=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx);this.measureData=new p(a)}return this.measureData},v.checkPitches=function(){if(0===this.opts.heads.length)throw new b;this.opts.heads.forEach(w),this.checkPitchCollision()};var w=function(a){m.check(a.pitch)};v.checkPitchCollision=function(){var a=this.opts.heads.map(x);a.sort(m.compareLine);for(var b=a.length,c=0;c<b-1;c++){var d=a[c],f=a[c+1];if(m.isSameLine(d,f)){var g=m.copyWithoutAlter(d);throw new e(e.action.INSERT,g)}}};var x=function(a){return m.copy(a.pitch)};v.checkPosition=function(){var a=this.opts.quarterPosition;if(!n.isValidQuarter(a))throw new g(a)},v.checkDuration=function(){var a=this.opts.quarterDuration;if(!n.isValidQuarter(a))throw new h(a);if(0===a)throw new d(a)},v.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded(),this.storeAction(),this.addChordCrossMeasure()},v.sanitizeIfNeeded=function(){this.sanitized||(void 0!==this.opts.pitches&&this.convertPitchesToHeads(),this.opts.isConcertPitch&&this.transposePitches(),this.sanitized=!0)},v.convertPitchesToHeads=function(){u.convertPitchesToHeads(this.opts)},v.transposePitches=function(){var a=this.getMeasureData(),b=a.getTranspose(this.opts.staffIdx);if(!l.isUnison(b)){var c=this.opts.heads.map(y);c=t(c,b),this.opts.heads=c.map(z)}};var y=function(a){return a.pitch},z=function(a){return a=m.copy(a),{pitch:a}};v.addChordCrossMeasure=function(){var a=this.opts.heads.map(A),b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,quarterPosition:this.opts.quarterPosition,quarterDuration:this.opts.quarterDuration,heads:a};new o(this.scoreData,b,this.cancelStack).perform()};var A=function(a){var b=m.copy(a.pitch),c={pitch:b};return void 0!==a.fretData&&(c.fretData=i(a.fretData)),c};v.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,quarterPosition:this.opts.quarterPosition,quarterDuration:this.opts.quarterDuration,heads:this.opts.heads.map(A)}};this.cancelStack.storeAction(b)}},v.getLocation=function(){if(null===this.location){var a=this.scoreData.getPartUuid(this.opts.partIdx),b=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={partUuid:a,measureUuid:b}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Utils.durationUtils,b=Adagio.Error.noChange.NoChangeError,c=Adagio.Utils.math,d=Adagio.Utils.timeModifUtils,e=Adagio.edit.composite.RemoveSpaceTuplets,f=Adagio.edit.composite.RemoveSpaceChordsQuarter,g=Adagio.edit.composite.SplitRestIfNeeded,h=Adagio.edit.action.ChangeDurationFormat,i=Adagio.edit.common.timePosToNoteIdx,j=Adagio.edit.common.initMeasureData,k=Adagio.edit.common.assertPerform,l=Adagio.edit.common.RestDispatcherLeft,m=Adagio.edit.values.InsertMode,n=Adagio.edit.composite.AddRestIntraMeasure=function(a,b,c){this.init(a,b,c)};n.NAME="composite.AddRestIntraMeasure";var o=n.prototype;o.name=n.NAME,o.initMeasureData=j,o.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.quarterPosition=b.quarterPosition,this.quarterDuration=b.quarterDuration,this.noteIdx=null},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.isVoiceDisplayed()&&(this.removeSpaceTuplets(),this.removeSpaceChords(),this.splitRest(),this.fetchNoteIdx(),this.changeDurations())},o.isVoiceDisplayed=function(){return this.measureData.hasVoice(this.opts.voiceIdx)},o.removeSpaceTuplets=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,quarterPosition:this.opts.quarterPosition,quarterDuration:this.opts.quarterDuration};new e(this.measureData,a,this.cancelStack).perform()},o.removeSpaceChords=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,quarterPosition:this.opts.quarterPosition,quarterDuration:this.opts.quarterDuration};new f(this.measureData,a,this.cancelStack).perform()},o.splitRest=function(){var b=a.quarterDurationToRequiredDpq(this.quarterPosition),c=a.quarterToDuration(this.quarterPosition,b),d={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,timePos:c,dpq:b};new g(this.measureData,d,this.cancelStack).perform()},o.fetchNoteIdx=function(){var b=this.measureData.getDpqValue(),c=a.quarterToDuration(this.quarterPosition,b),d=this.measureData.getVoice(this.opts.voiceIdx);this.noteIdx=i(d,1,c)},o.changeDurations=function(){this.getQuarterDurations().forEach(this.changeDuration,this)},o.getQuarterDurations=function(){var b=a.quarterDurationToRequiredDpq(this.quarterPosition),e=a.quarterDurationToRequiredDpq(this.quarterDuration),f=c.lcm(b,e),g=a.quarterToDuration(this.quarterPosition,f),h=a.quarterToDuration(this.quarterDuration,f),i=this.getQuarterPerBeat(),j=a.quarterToDuration(i,f),k=d.createDefault(),m=new l(g,h,j,f,k);return m.dispatch(),m.getDispatchedRests().map(p,f)};var p=function(b){var c=this.valueOf();return a.divisionsToQuarter(b,c)};o.getQuarterPerBeat=function(){var b=this.measureData.getAnyTime();return a.getBeatQuarterDuration(b)},o.getDurationOpts=function(b){return a.quarterToDurationOpts(b)},o.changeDuration=function(b){var c=a.quarterToDurationOpts(b),d={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.noteIdx,durationType:c.durationType,nbDots:c.nbDots,insertMode:m.REPLACE},e=new h(this.measureData,d,this.cancelStack);k(e,q),this.noteIdx++};var q=function(a){return a instanceof b}}.call(this),function(){"use strict";var a=Adagio.Utils.durationUtils,b=Adagio.Utils.measureUtils,c=Adagio.edit.composite.AddRestIntraMeasure,d=Adagio.edit.action.AddMeasure,e=Adagio.edit.common.assertPerform,f=Adagio.edit.composite.AddRestCrossMeasure=function(a,b,c){this.init(a,b,c)};f.NAME="composite.AddRestCrossMeasure";var g=f.prototype;g.name=f.NAME,g.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.measureIdx=this.opts.measureIdx,this.quarterPosition=this.opts.quarterPosition,this.quarterDuration=this.opts.quarterDuration},g.perform=function(){for(this.cancelStack=this.cancelStack.createSubstack(this.name);this.quarterDuration>0;){var a=this.getSliceDuration();this.addRestIntraMeasure(a),this.moveForward(a),this.measureEndReached()&&this.nextMeasure()}},g.getSliceDuration=function(){var a=this.getMeasureQuarterDuration(),b=a-this.quarterPosition;return Math.min(b,this.quarterDuration)},g.addRestIntraMeasure=function(a){var b={partIdx:this.opts.partIdx,measureIdx:this.measureIdx,voiceIdx:this.opts.voiceIdx,quarterPosition:this.quarterPosition,quarterDuration:a};new c(this.scoreData,b,this.cancelStack).perform()},g.moveForward=function(a){this.quarterPosition+=a,this.quarterDuration-=a},g.measureEndReached=function(){return this.getMeasureQuarterDuration()===this.quarterPosition},g.getMeasureQuarterDuration=function(){var c=this.scoreData.getMeasure(this.opts.partIdx,this.measureIdx),d=b.getAnyTime(c);return a.timeToQuarter(d)},g.nextMeasure=function(){this.measureIdx++,this.quarterPosition=0;var a=this.scoreData.getNbMeasures();this.measureIdx===a&&this.addMeasure()},g.addMeasure=function(){var a={measureIdx:this.measureIdx},b=new d(this.scoreData,a,this.cancelStack);e(b)}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadQuarterPositionError,b=Adagio.Error.client.BadQuarterDurationError,c=Adagio.Error.client.BadVoiceError,d=Adagio.Error.value.BadQuarterPositionError,e=Adagio.Error.value.BadQuarterDurationError,f=Adagio.Utils.measureUtils,g=Adagio.Utils.durationUtils,h=Adagio.Utils.math,i=Adagio.edit.composite.AddRestCrossMeasure,j=Adagio.edit.common.MeasureData,k=Adagio.edit.common.convertPartUuidToGetPartIdx,l=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,m=Adagio.edit.action.AddRestCrossMeasure=function(a,b,c){this.init(a,b,c)};m.NAME="action.AddRestCrossMeasure";var n=m.prototype;n.name=m.NAME,n.init=function(a,b,c){k(a,b),l(a,b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.location=null,this.measureData=null},n.checkPreconditions=function(){this.checkLocation(),this.checkPosition(),this.checkDuration()},n.checkLocation=function(){this.getMeasureData(),this.checkVoiceIdx();var b=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx),c=f.getQuarterDuration(b),d=this.opts.quarterPosition;if(!h.isNumber(d)||d<0||d>=c)throw new a(d)},n.getMeasureData=function(){if(null===this.measureData){var a=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx);this.measureData=new j(a)}return this.measureData},n.checkVoiceIdx=function(){if(!this.scoreData.hasPartVoiceIdx(this.opts.partIdx,this.opts.voiceIdx))throw new c(this.opts.voiceIdx)},n.checkPosition=function(){var a=this.opts.quarterPosition;if(!g.isValidQuarter(a))throw new d(a)},n.checkDuration=function(){var a=this.opts.quarterDuration;if(!g.isValidQuarter(a))throw new e(a);if(0===a)throw new b(a)},n.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.addRestCrossMeasure()},n.addRestCrossMeasure=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,quarterPosition:this.opts.quarterPosition,quarterDuration:this.opts.quarterDuration};new i(this.scoreData,a,this.cancelStack).perform()},n.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,quarterPosition:this.opts.quarterPosition,quarterDuration:this.opts.quarterDuration}};this.cancelStack.storeAction(b)}},n.getLocation=function(){if(null===this.location){var a=this.scoreData.getPartUuid(this.opts.partIdx),b=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={partUuid:a,measureUuid:b}}return this.location}}.call(this),function(){"use strict";var a=Adagio.edit.common.getScoreData,b=Adagio.Utils.partHeaderUtils,c=Adagio.Utils.drumsetUtils;Adagio.edit.common.getDefaultMIDIHead=function(d,e,f){var g=a(d),h=g.getPartHeader(e),i=b.getPitchMapping(h);return c.getDefaultMIDIHead(i,f)}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.NoUnpitchedInstrumentError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="NoUnpitchedInstrumentError",this.stack=e.stack,this.message=e.message,this.MIDIUnpitched=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"There is no instrument for the MIDI-unpitched value ["+a+"]. "}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Utils.unpitchedUtils,c=Adagio.Error.client.NoUnpitchedError=function(b,c){var e=d(b,c),f=a.call(this,e);return this.name=f.name="NoUnpitchedError",this.stack=f.stack,this.message=f.message,this.unpitched=b,this.notehead=c,this};c.prototype=Object.create(a.prototype,{constructor:{value:c}});var d=function(a,c){return"There is no MIDI-unpitched value for the pitch ["+b.stringify(a)+"] and the note head ["+c+"]."}}.call(this),function(){"use strict";var a=Adagio.Error.client.NoUnpitchedInstrumentError,b=Adagio.Error.client.NoUnpitchedError,c=Adagio.Utils.drumsetUtils,d=Adagio.Utils.partHeaderUtils,e=Adagio.Utils.unpitchedUtils,f=Adagio.edit.common.getScoreData;Adagio.edit.common.checkUnpitchedInstrument=function(g,h){g=f(g);var i=g.getPartHeader(h.partIdx),j=d.getPitchMapping(i);if(!c.hasMIDIUnpitched(j,h.unpitched,h.notehead))throw new b(e.copy(h.unpitched),h.notehead);var k=h.notehead;void 0===k&&(k=c.getDefaultMIDIHead(j,h.unpitched));var l=c.getMIDIUnpitched(j,h.unpitched,k);if(!g.hasUnpitchedInstrument(h.partIdx,l))throw new a(l)}}.call(this),function(){"use strict";var a=Adagio.edit.common.getScoreData,b=Adagio.Utils.partHeaderUtils,c=Adagio.Utils.drumsetUtils;Adagio.edit.common.getMIDIUnpitched=function(d,e,f,g){var h=a(d),i=h.getPartHeader(e),j=b.getPitchMapping(i);return c.getMIDIUnpitched(j,f,g)}}.call(this),function(){"use strict";var a=Adagio.Utils.clone,b=Adagio.Utils.noteUtils,c=Adagio.Utils.unpitchedUtils,d=Adagio.Utils.timeModifUtils,e=Adagio.history.note.noteHistoryUtils,f=Adagio.edit.common.calcDuration,g=Adagio.edit.common.getMIDIUnpitched,h=Adagio.edit.common.initMeasureData,i=Adagio.edit.primitive.AddSingleNotePercu=function(a,b,c){this.init(a,b,c)};i.NAME="primitive.AddSingleNotePercu";var j=i.prototype;j.name=i.NAME,j.initMeasureData=h,j.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},j.perform=function(){var a=this.getVoice(),b=this.createNote(a);a.insertNote(b,this.opts.noteIdx),this.updateStack()},j.getVoice=function(){var a=this.opts.voiceIdx,b=this.opts.noteIdx;return this.measureData.getVoiceOrTupletForInsert(a,b)},j.createNote=function(f){var g=this.getDuration(),h=d.copy(f.getAbsoluteTimeModif()),i=c.copy(this.opts.unpitched),j={};b.setStaffIdx(j,this.opts.staffIdx),b.setVoiceIdx(j,this.opts.voiceIdx),b.setDuration(j,g),b.setUnpitched(j,i),b.setHead(j,this.opts.notehead),b.setNbDots(j,this.opts.nbDots),b.setTimeModif(j,h);var k=this.getInstrumentId();if(b.setInstrumentId(j,k),this.cancelStack.hasPayload()){var l=this.cancelStack.getPayload(),m=a(l.headCssClassesSet);e.setHeadCssClassesSet(j,m),m=a(m),e.setGlobalCssClassesSet(j,m)}return j},j.getInstrumentId=function(){var a=g(this.measureData,this.opts.partIdx,this.opts.unpitched,this.opts.notehead);return this.measureData.searchUnpitchedInstrumentId(a)},j.getDuration=function(){var a=this.measureData.getDivisionsPerQuarterValue(),b=this.getVoice(),c=b.getAbsoluteTimeModif();return f(this.opts,a,c)},j.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,noteIdx:this.opts.noteIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,durationType:this.opts.durationType,nbDots:this.opts.nbDots,unpitched:c.copy(this.opts.unpitched),notehead:this.opts.notehead}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.Utils.clone,b=Adagio.edit.primitive.AddSingleNotePercu,c=Adagio.edit.composite.RemoveRests,d=Adagio.edit.composite.UnlockRests,e=Adagio.edit.composite.AdaptDpqToDuration,f=Adagio.edit.composite.AdaptDpqToTimeSignature,g=Adagio.edit.action.FormatBeamsRandPos,h=Adagio.edit.action.RemoveTiePercu,i=Adagio.edit.common.calcDuration,j=Adagio.edit.values.InsertMode,k=Adagio.edit.common.initMeasureData,l=Adagio.edit.composite.AddSingleNotePercu=function(a,b,c){this.init(a,b,c)};l.NAME="composite.AddSingleNotePercu";var m=l.prototype;m.name=l.NAME,m.initMeasureData=k,m.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},m.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.opts.insertMode===j.INSERT&&this.opts.noteIdx>0&&this.breakConnection(),this.adaptDpqToNoteDuration(),this.adaptDpqToTimeSignature(),this.unlockRests(),this.consumeRests(),this.addNote(),this.formatBeams()},m.breakConnection=function(){this.removeTie()},m.removeTie=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx-1};new h(this.measureData,a,this.cancelStack).performIfPossible()},m.adaptDpqToNoteDuration=function(){var a=this.getVoice(),b=a.getAbsoluteTimeModif(),c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,durationType:this.opts.durationType,nbDots:this.opts.nbDots,timeModif:b};new e(this.measureData,c,this.cancelStack).perform()},m.adaptDpqToTimeSignature=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx};new f(this.measureData,a,this.cancelStack).perform()},m.getVoice=function(){var a=this.opts.voiceIdx,b=this.opts.noteIdx;return this.measureData.getVoiceOrTupletForGet(a,b)},m.unlockRests=function(){var a=this.getDuration(),b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,insertMode:this.opts.insertMode,duration:a};new d(this.measureData,b,this.cancelStack).perform()},m.consumeRests=function(){var b=this.getDuration(),d=a(this.opts);d.duration=b,new c(this.measureData,d,this.cancelStack).perform()},m.getDuration=function(){var a=this.measureData.getDivisionsPerQuarterValue(),b=this.opts.voiceIdx,c=this.opts.noteIdx,d=this.measureData.getVoiceOrTupletForGet(b,c),e=d.getAbsoluteTimeModif();return i(this.opts,a,e)},m.addNote=function(){var c=a(this.opts);new b(this.measureData,c,this.cancelStack).perform()},m.formatBeams=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new g(this.measureData,a,this.cancelStack).performIfPossible()}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Error.client.BadVoiceError,c=Adagio.edit.values.InsertMode,d=Adagio.Utils.clone,e=Adagio.Utils.unpitchedUtils,f=Adagio.Utils.timeModifUtils,g=Adagio.Utils.noteUtils,h=Adagio.edit.common.checkSpaceForAdd,i=Adagio.edit.common.checkUnpitchedInstrument,j=Adagio.edit.common.checkUnpitchedMeasure,k=Adagio.edit.common.convertLineToUnpitched,l=Adagio.edit.common.convertPartUuidToGetPartIdx,m=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,n=Adagio.edit.common.convertTimePosToInsertNoteIdx,o=Adagio.edit.common.getDefaultMIDIHead,p=Adagio.edit.common.CancelStack,q=Adagio.edit.action.ShowMeasureVoice,r=Adagio.edit.composite.AddSingleNotePercu,s=Adagio.edit.common.initMeasureData,t=Adagio.edit.common.checkCompatibleVoiceStaffIdx,u=Adagio.edit.common.checkOptsDuration,v=Adagio.edit.common.checkNoteTimePos,w=Adagio.edit.common.assertPerform,x=Adagio.edit.action.AddSingleNotePercu=function(a,b,c){this.init(a,b,c)};x.NAME="action.AddSingleNotePercu";var y=x.prototype;y.name=x.NAME,y.initMeasureData=s,y.init=function(a,b,c){l(a,b),m(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.temporaryStack=null,this.opts=b,this.location=null},y.checkPreconditions=function(){this.checkCommonElements(),this.checkTimeLocation(),this.checkSpace(),this.isVoiceDisplayed()||this.displayVoice(),this.hasNoteIdx()||this.inferNoteIdx()},y.checkCommonElements=function(){this.checkUnpitched(),this.checkVoiceIdx(),this.checkCompatibleVoiceStaffIdx(),u(this.opts),this.sanitize(),this.checkInstrument(),this.fillHeadIfMissing()},y.checkUnpitched=function(){j(this.measureData)},y.checkVoiceIdx=function(){if(!this.measureData.getScoreData().hasPartVoiceIdx(this.opts.partIdx,this.opts.voiceIdx))throw new b(this.opts.voiceIdx)},y.checkCompatibleVoiceStaffIdx=function(){t(this.measureData,this.opts)},y.sanitize=function(){void 0!==this.opts.line&&k(this.measureData,this.opts),void 0===this.opts.insertMode&&(this.opts.insertMode=c.REPLACE)},y.checkInstrument=function(){i(this.measureData,this.opts)},y.fillHeadIfMissing=function(){void 0===this.opts.notehead&&(this.opts.notehead=o(this.measureData,this.opts.partIdx,this.opts.unpitched))},y.checkTimeLocation=function(){if(this.hasTimePos())this.checkTimePos();else{if(!this.hasNoteIdx())throw new a("Unexpected");this.checkNoteIdx()}},y.hasTimePos=function(){return"number"==typeof this.opts.timePos&&"number"==typeof this.opts.divisions&&void 0!==this.opts.timeModif},y.checkTimePos=function(){var a=this.measureData.getMeasure();v(a,this.opts.timePos,this.opts.divisions)},y.hasNoteIdx=function(){return"number"==typeof this.opts.noteIdx},y.checkNoteIdx=function(){var b=this.measureData.getVoice(this.opts.voiceIdx);if(this.opts.insertMode===c.REPLACE)b.checkNoteIdx(this.opts.noteIdx);else{if(this.opts.insertMode!==c.INSERT)throw new a("unreachable");b.checkInsertionIdx(this.opts.noteIdx)}},y.checkSpace=function(){h(this.measureData,this.opts)},y.isVoiceDisplayed=function(){return this.measureData.hasVoice(this.opts.voiceIdx)},y.displayVoice=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx},b=this.getTemporaryStack(),c=new q(this.measureData,a,b);w(c)},y.inferNoteIdx=function(){var a=this.getTemporaryStack();n(this.measureData,this.opts,a)},y.getTemporaryStack=function(){return null===this.temporaryStack&&(this.temporaryStack=new p(this.name+".checkPreconditions")),this.temporaryStack},y.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),null!==this.temporaryStack&&this.cancelStack.push(this.temporaryStack),this.storeAction();var a=d(this.opts);new r(this.measureData,a,this.cancelStack).perform(),this.updateStack()},y.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b=e.copy(this.opts.unpitched),c=f.copy(a.timeModif),d={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,divisions:a.dpq,timePos:a.timePos,durationType:this.opts.durationType,nbDots:this.opts.nbDots,unpitched:b,notehead:this.opts.notehead,insertMode:this.opts.insertMode,timeModif:c}};this.cancelStack.storeAction(d)}},y.updateStack=function(){var a=this.getLocation(),b={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,timePos:a.timePos,divisions:a.dpq,unpitched:e.copy(this.opts.unpitched),insertMode:this.opts.insertMode}};this.cancelStack.push(b)},y.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),h=e.getNote(this.opts.noteIdx),i=g.getTimeModif(h);i=f.copy(i);var j=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:j,timeModif:i}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.unpitchedUtils,c=Adagio.Utils.typeUtils,d=Adagio.edit.common.initMeasureData,e=Adagio.edit.common.getMIDIUnpitched,f=Adagio.edit.primitive.ChangeHeadPercu=function(a,b,c){this.init(a,b,c)};f.NAME="primitive.ChangeHeadPercu";var g=f.prototype;g.name=f.NAME,g.initMeasureData=d,g.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},g.perform=function(){var b=this.getVoice(),d=b.getChord(this.opts.noteIdx);d=c.makeArray(d);var e=d.map(a.getUnpitched),f=e.findIndex(h,this.opts.unpitched),g=d[f],i=this.getInstrumentId(),j=a.getHead(g);a.setHead(g,this.opts.notehead),a.setInstrumentId(g,i),this.updateStack(j)},g.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},g.getInstrumentId=function(){var a=e(this.measureData,this.opts.partIdx,this.opts.unpitched,this.opts.notehead);return this.measureData.searchUnpitchedInstrumentId(a)};var h=function(a){var c=this;return b.isSameLine(a,c)};g.updateStack=function(a){var c={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,noteIdx:this.opts.noteIdx,voiceIdx:this.opts.voiceIdx,unpitched:b.copy(this.opts.unpitched),previousNotehead:a,newNotehead:this.opts.notehead}};this.cancelStack.push(c)}}.call(this),function(){"use strict";var a=Adagio.Error.client.NotPossibleOnRestsError,b=Adagio.Error.client.UnpitchedCollisionError,c=Adagio.Error.noChange.NoChangeError,d=Adagio.edit.common.checkUnpitchedInstrument,e=Adagio.edit.common.checkUnpitchedMeasure,f=Adagio.edit.common.convertLineToUnpitched,g=Adagio.edit.common.convertTimePosToGetNoteIdx,h=Adagio.edit.common.convertPartUuidToGetPartIdx,i=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,j=Adagio.edit.common.getDefaultMIDIHead,k=Adagio.edit.primitive.ChangeHeadPercu,l=Adagio.Utils.clone,m=Adagio.Utils.typeUtils,n=Adagio.Utils.noteUtils,o=Adagio.Utils.unpitchedUtils,p=Adagio.Utils.staffDetailsUtils,q=Adagio.edit.common.initMeasureData,r=Adagio.edit.action.ChangeHeadPercu=function(a,b,c){this.init(a,b,c)};r.NAME="action.ChangeHeadPercu",r.isNoChange=function(a){return a instanceof c};var s=r.prototype;s.name=r.NAME,s.initMeasureData=q,s.init=function(a,b,c){h(a,b),i(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.sanitized=!1,this.voice=null,this.location=null,g(this.measureData,this.opts)},s.checkPreconditions=function(){this.checkUnpitched(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkNoteIdx(),this.checkNotRest(),this.sanitizeIfNeeded(),this.checkPitch(),this.checkInstrument(),this.checkUpdate()},s.checkUnpitched=function(){e(this.measureData)},s.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},s.getVoice=function(){return null===this.voice&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},s.checkNotRest=function(){if(this.getVoice().isRest(this.opts.noteIdx))throw new a},s.checkPitch=function(){if(-1===this.getChord().findIndex(t,this.opts.unpitched)){var a=o.copy(this.opts.unpitched),c=this.opts.staffIdx||0,d=this.measureData.getStaffDetails(c),e=p.getNbStaffLines(d);throw new b(b.GET,a,e)}};var t=function(a){var b=n.getUnpitched(a),c=this;return o.isSameLine(b,c)};s.getChord=function(){var a=this.getVoice(),b=a.getChord(this.opts.noteIdx);return m.makeArray(b)},s.checkInstrument=function(){d(this.measureData,this.opts)},s.checkUpdate=function(){var a=this.getChord(),b=a.find(t,this.opts.unpitched),d=n.getHead(b);if(this.opts.notehead===d)throw new c},s.perform=function(){this.sanitizeIfNeeded(),void 0===this.opts.notehead&&(this.opts.notehead=j(this.measureData,this.opts.partIdx,this.opts.unpitched)),this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a=this.getChord(),b=a.find(t,this.opts.unpitched),c=n.getHead(b),d=l(this.opts);new k(this.measureData,d,this.cancelStack).perform(),this.updateStack(c)},s.sanitizeIfNeeded=function(){this.sanitized||(void 0!==this.opts.line&&f(this.measureData,this.opts),this.sanitized=!0)},s.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b=o.copy(this.opts.unpitched),c={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos,unpitched:b,notehead:this.opts.notehead}};this.cancelStack.storeAction(c)}},s.updateStack=function(a){var b=this.getLocation(),c={type:this.name,noDraw:!0,opts:{partUuid:b.partUuid,measureUuid:b.measureUuid,voiceIdx:this.opts.voiceIdx,timePos:b.timePos,divisions:b.dpq,unpitched:o.copy(this.opts.unpitched),previousNotehead:a}};this.cancelStack.push(c)},s.getLocation=function(){if(null===this.location){
var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Utils.clone,b=Adagio.Utils.noteUtils,c=Adagio.Utils.unpitchedUtils,d=Adagio.Utils.timeModifUtils,e=Adagio.history.note.noteHistoryUtils,f=Adagio.edit.common.initMeasureData,g=Adagio.edit.common.getMIDIUnpitched,h=Adagio.edit.primitive.AddToChordPercu=function(a,b,c){this.init(a,b,c)};h.NAME="primitive.AddToChordPercu";var i=h.prototype;i.name=h.NAME,i.initMeasureData=f,i.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},i.perform=function(){var a=this.getVoice(),b=a.getNote(this.opts.noteIdx),c=this.createNote(b);a.addNoteToChord(c,this.opts.noteIdx),this.updateCommonHistory(),this.updateStack()},i.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},i.createNote=function(f){var g=b.getDuration(f),h=b.getNbDots(f),i=b.getTimeModif(f);i=d.copy(i);var j=c.copy(this.opts.unpitched),k={};b.setStaffIdx(k,this.opts.staffIdx),b.setVoiceIdx(k,this.opts.voiceIdx),b.setDuration(k,g),b.setUnpitched(k,j),b.setNbDots(k,h),b.setHead(k,this.opts.notehead);var l=this.getInstrumentId();if(b.setInstrumentId(k,l),b.setTimeModif(k,i),this.cancelStack.hasPayload()){var m=this.cancelStack.getPayload(),n=a(m.headCssClassesSet);e.setHeadCssClassesSet(k,n)}return k},i.getInstrumentId=function(){var a=g(this.measureData,this.opts.partIdx,this.opts.unpitched,this.opts.notehead);return this.measureData.searchUnpitchedInstrumentId(a)},i.updateCommonHistory=function(){if(this.cancelStack.hasPayload()){var b=this.getVoice(),c=b.getNote(this.opts.noteIdx),d=this.cancelStack.getPayload(),f=a(d.headCssClassesSet);e.setGlobalCssClassesSet(c,f)}},i.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,noteIdx:this.opts.noteIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,unpitched:c.copy(this.opts.unpitched),notehead:this.opts.notehead}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.Error.client.UnpitchedCollisionError,b=Adagio.edit.common.checkUnpitchedInstrument,c=Adagio.edit.common.checkUnpitchedMeasure,d=Adagio.edit.common.convertLineToUnpitched,e=Adagio.edit.common.convertPartUuidToGetPartIdx,f=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,g=Adagio.edit.common.convertTimePosToGetNoteIdx,h=Adagio.edit.common.getDefaultMIDIHead,i=Adagio.edit.primitive.AddToChordPercu,j=Adagio.Utils.clone,k=Adagio.Utils.typeUtils,l=Adagio.Utils.noteUtils,m=Adagio.Utils.unpitchedUtils,n=Adagio.Utils.staffDetailsUtils,o=Adagio.edit.common.initMeasureData,p=Adagio.edit.common.checkCompatibleVoiceStaffIdx,q=Adagio.edit.action.AddToChordPercu=function(a,b,c){this.init(a,b,c)};q.NAME="action.AddToChordPercu",q.isNoChange=function(b){return b instanceof a&&b.action===a.INSERT};var r=q.prototype;r.name=q.NAME,r.initMeasureData=o,r.init=function(a,b,c){e(a,b),f(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.sanitized=!1,this.voice=null,this.location=null,g(this.measureData,this.opts)},r.checkPreconditions=function(){this.checkUnpitched(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkCompatibleVoiceStaffIdx(),this.checkNoteIdx(),this.checkNotRest(),this.sanitizeIfNeeded(),this.checkPitch(),this.checkInstrument()},r.checkUnpitched=function(){c(this.measureData)},r.checkCompatibleVoiceStaffIdx=function(){p(this.measureData,this.opts)},r.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},r.getVoice=function(){return null===this.voice&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},r.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},r.checkPitch=function(){if(-1!==this.getChord().findIndex(s,this.opts.unpitched)){var b=m.copy(this.opts.unpitched),c=this.measureData.getStaffDetails(this.opts.staffIdx),d=n.getNbStaffLines(c);throw new a(a.INSERT,b,d)}};var s=function(a){var b=l.getUnpitched(a),c=this;return m.isSameLine(b,c)};r.getChord=function(){var a=this.getVoice(),b=a.getChord(this.opts.noteIdx);return k.makeArray(b)},r.checkInstrument=function(){b(this.measureData,this.opts)},r.perform=function(){this.sanitizeIfNeeded(),void 0===this.opts.notehead&&(this.opts.notehead=h(this.measureData,this.opts.partIdx,this.opts.unpitched)),this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a=j(this.opts);new i(this.measureData,a,this.cancelStack).perform(),this.updateStack()},r.sanitizeIfNeeded=function(){this.sanitized||(void 0!==this.opts.line&&d(this.measureData,this.opts),this.sanitized=!0)},r.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b=m.copy(this.opts.unpitched),c={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,divisions:a.dpq,timePos:a.timePos,unpitched:b,notehead:this.opts.notehead}};this.cancelStack.storeAction(c)}},r.updateStack=function(){var a=this.getLocation(),b={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,timePos:a.timePos,divisions:a.dpq,unpitched:m.copy(this.opts.unpitched)}};this.cancelStack.push(b)},r.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Error.noChange.NoChangeError,c=Adagio.Error.client.BadVoiceError,d=Adagio.Utils.clone,e=Adagio.Utils.math,f=Adagio.Utils.noteUtils,g=Adagio.Utils.unpitchedUtils,h=Adagio.Utils.timeModifUtils,i=Adagio.edit.values.InsertMode,j=Adagio.edit.common.checkUnpitchedMeasure,k=Adagio.edit.common.convertLineToUnpitched,l=Adagio.edit.common.convertPartUuidToGetPartIdx,m=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,n=Adagio.edit.common.convertTimePosToGetNoteIdx,o=Adagio.edit.common.getDefaultMIDIHead,p=Adagio.edit.common.checkNoteTimePos,q=Adagio.edit.common.timePosToFloorNoteIdx,r=Adagio.edit.action.ChangeDurationFormat,s=Adagio.edit.action.AddSingleNotePercu,t=Adagio.edit.action.ChangeHeadPercu,u=Adagio.edit.action.AddToChordPercu,v=Adagio.edit.common.initMeasureData,w=Adagio.edit.common.checkCompatibleVoiceStaffIdx,x=Adagio.edit.common.convertNoteRef,y=Adagio.edit.action.AddNotePercu=function(a,b,c){this.init(a,b,c)};y.NAME="action.AddNotePercu";var z=y.prototype;z.name=y.NAME,z.initMeasureData=v,z.init=function(a,b,c){l(a,b),m(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.actions=[],this.location=null},z.checkPreconditions=function(){this.checkCommonElements(),this.hasNoteRef()&&this.convertNoteRef(),this.checkTimeLocation(),this.isVoiceDisplayed()&&this.isChord()&&this.opts.insertMode===i.REPLACE?(this.hasNoteIdx()||this.inferNoteIdx(),this.addChordActions()):this.addSingleNoteAction()},z.checkCommonElements=function(){this.checkUnpitched(),this.checkVoiceIdx(),this.checkCompatibleVoiceStaffIdx(),this.sanitize()},z.checkUnpitched=function(){j(this.measureData)},z.checkVoiceIdx=function(){if(!this.measureData.getScoreData().hasPartVoiceIdx(this.opts.partIdx,this.opts.voiceIdx))throw new c(this.opts.voiceIdx)},z.checkCompatibleVoiceStaffIdx=function(){w(this.measureData,this.opts)},z.sanitize=function(){void 0!==this.opts.line&&k(this.measureData,this.opts),void 0===this.opts.insertMode&&(this.opts.insertMode=i.REPLACE)},z.hasNoteRef=function(){return"number"==typeof this.opts.noteIdxRef&&"number"==typeof this.opts.voiceIdxRef},z.convertNoteRef=function(){x(this.measureData,this.opts)},z.checkTimeLocation=function(){if(this.hasTimePos())this.checkTimePos();else{if(!this.hasNoteIdx())throw new a("Unexpected");this.checkNoteIdx()}},z.hasTimePos=function(){return"number"==typeof this.opts.timePos&&"number"==typeof this.opts.divisions&&void 0!==this.opts.timeModif},z.checkTimePos=function(){var a=this.measureData.getMeasure();p(a,this.opts.timePos,this.opts.divisions)},z.hasNoteIdx=function(){return"number"==typeof this.opts.noteIdx},z.checkNoteIdx=function(){var b=this.measureData.getVoice(this.opts.voiceIdx);if(this.opts.insertMode===i.REPLACE)b.checkNoteIdx(this.opts.noteIdx);else{if(this.opts.insertMode!==i.INSERT)throw new a("unreachable");b.checkInsertionIdx(this.opts.noteIdx)}},z.inferNoteIdx=function(){n(this.measureData,this.opts)},z.isVoiceDisplayed=function(){return this.measureData.hasVoice(this.opts.voiceIdx)},z.isChord=function(){var b,c=this.measureData.getVoice(this.opts.voiceIdx);if(this.hasNoteIdx())b=this.opts.noteIdx;else{if(!this.hasTimePos())throw new a("Unexpected");var d=this.measureData.getDpqValue(),f=e.lcm(d,this.opts.divisions),g=this.opts.timePos*f/this.opts.divisions;b=q(c,f/d,g)}return!c.isRest(b)},z.addChordActions=function(){if(this.addHeadInsertion(),this.noChange()&&this.addHeadChange(),this.addDurationChange(),this.noChange())throw new b},z.addHeadChange=function(){var a=d(this.opts);this.addAction(t,a)},z.addHeadInsertion=function(){var a=d(this.opts);this.addAction(u,a)},z.addDurationChange=function(){var a=d(this.opts);this.addAction(r,a)},z.addAction=function(a,b){var c=new a(this.measureData,b,this.cancelStack);try{c.checkPreconditions(),this.actions.push(c)}catch(b){if(!a.isNoChange(b))throw b}},z.noChange=function(){return 0===this.actions.length},z.addSingleNoteAction=function(){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,durationType:this.opts.durationType,nbDots:this.opts.nbDots,unpitched:g.copy(this.opts.unpitched),notehead:this.opts.notehead,fretData:this.opts.fretData,insertMode:this.opts.insertMode};if(this.hasTimePos())b.divisions=this.opts.divisions,b.timePos=this.opts.timePos,b.timeModif=h.copy(this.opts.timeModif);else{if(!this.hasNoteIdx())throw new a("Unexpected");b.noteIdx=this.opts.noteIdx}var c=new s(this.measureData,b,this.cancelStack);c.checkPreconditions(),this.opts.noteIdx=c.opts.noteIdx,this.actions.push(c)},z.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.performActions()},z.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b=g.copy(this.opts.unpitched),c=h.copy(a.timeModif),d=this.opts.notehead;void 0===this.opts.notehead&&(d=o(this.measureData,this.opts.partIdx,b));var e={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,divisions:a.dpq,timePos:a.timePos,durationType:this.opts.durationType,nbDots:this.opts.nbDots,unpitched:b,notehead:d,insertMode:this.opts.insertMode,timeModif:c,formatRests:!!this.opts.formatRests}};this.cancelStack.storeAction(e)}},z.performActions=function(){this.actions.forEach(this.performAction,this)},z.performAction=function(a){a.cancelStack=this.cancelStack,a.perform()},z.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),g=e.getRangeSpace(0,this.opts.noteIdx),i=e.getNote(this.opts.noteIdx),j=f.getTimeModif(i);j=h.copy(j),this.location={partUuid:b,measureUuid:c,dpq:d,timePos:g,timeModif:j}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.client.NoPitchesError,b=Adagio.Error.client.UnpitchedCollisionError,c=Adagio.Utils.unpitchedUtils,d=Adagio.Utils.staffDetailsUtils,e=Adagio.edit.action.AddNotePercu,f=Adagio.edit.common.initMeasureData,g=Adagio.edit.common.assertPerform,h=Adagio.edit.common.checkUnpitchedMeasure,i=Adagio.edit.common.checkUnpitchedInstrument,j=Adagio.edit.action.AddChordPercu=function(a,b,c){this.init(a,b,c)};j.NAME="action.AddChordPercu";var k=j.prototype;k.name=j.NAME,k.initMeasureData=f,k.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.actions=null},k.checkPreconditions=function(){this.checkUnpitched(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkInstruments(),this.checkNoteIdx(),this.checkRest(),this.getActions()[0].checkPreconditions()},k.checkUnpitched=function(){h(this.measureData)},k.checkInstruments=function(){if(0===this.opts.instruments.length)throw new a;this.opts.instruments.forEach(this.checkInstrument,this),this.checkPitchCollision()},k.checkInstrument=function(a){var b=c.copy(a.unpitched),d={partIdx:this.opts.partIdx,notehead:a.notehead,unpitched:b};i(this.measureData,d)},k.checkPitchCollision=function(){var a=this.opts.instruments.map(l).slice();a.sort(c.compare);for(var e=a.length,f=0;f<e-1;f++){var g=a[f],h=a[f+1];if(c.isSameLine(g,h)){var i=c.copy(g),j=this.measureData.getStaffDetails(this.opts.staffIdx),k=d.getNbStaffLines(j);throw new b(b.INSERT,i,k)}}};var l=function(a){return a.unpitched};k.checkNoteIdx=function(){this.measureData.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},k.checkRest=function(){this.measureData.getVoice(this.opts.voiceIdx).checkRest(this.opts.noteIdx)},k.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a=this.getActions();a[0].cancelStack=this.cancelStack,a[0].perform(),a=a.slice(1),a.forEach(this.performSubAction,this)},k.performSubAction=function(a){a.cancelStack=this.cancelStack,g(a)},k.getActions=function(){return null===this.actions&&(this.actions=this.opts.instruments.map(this.createAction,this)),this.actions},k.createAction=function(a){var b=c.copy(a.unpitched),d={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,durationType:this.opts.durationType,nbDots:this.opts.nbDots,unpitched:b,notehead:a.notehead,insertMode:this.opts.insertMode};return new e(this.measureData,d,null)}}.call(this),function(){"use strict";var a=Adagio.Error.client.NotPossibleOnRestsError,b=Adagio.Error.client.UnpitchedCollisionError,c=Adagio.Error.client.NotPossibleOnPitchedError,d=Adagio.Error.client.TieError,e=Adagio.Utils.noteUtils,f=Adagio.Utils.unpitchedUtils,g=Adagio.Data.tieAction,h=Adagio.edit.common.CrossMeasure,i=Adagio.edit.common.convertTimePosToGetNoteIdx,j=Adagio.edit.common.noteIdxToTimePos,k=Adagio.edit.common.convertPartUuidToGetPartIdx,l=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,m=Adagio.edit.common.initMeasureData,n=Adagio.edit.common.lineToDestUnpitched,o=Adagio.edit.common.getNbStaffLines,p=Adagio.edit.action.AddTieArcPercu=function(a,b,c){this.init(a,b,c)};p.NAME="action.AddTieArcPercu";var q=p.prototype;q.name=p.NAME,q.initMeasureData=m,q.lineToDestUnpitched=n,q.init=function(a,b,c){k(a,b),l(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,i(this.measureData,b),this.crossMeasure=new h(this.measureData,b.voiceIdx,b.noteIdx),this.location=null},q.checkPreconditions=function(){this.checkUnpitchedPart(),this.crossMeasure.checkVoiceIdx(),this.crossMeasure.checkNoteIdx(),this.checkNotRest(),this.lineToDestUnpitched(),this.checkUnpitched()},q.checkUnpitchedPart=function(){if(!this.measureData.isUnpitched())throw new c},q.checkNotRest=function(){if(this.isLeftRest()||this.isRightRest())throw new a},q.isLeftRest=function(){return this.crossMeasure.isLeftRest()},q.isRightRest=function(){return this.crossMeasure.isRightRest()},q.checkUnpitched=function(){if(this.crossMeasure.hasRightGrace())throw new d(this.name,"right not cannot have graces notes attached.");var a=this.getLeftChord(),c=this.getRightChord(),h=o(this.measureData,this.opts),i=a.find(this.unpitchedPredicate,this);if(void 0===i)throw new b(b.GET,this.opts,h);var j=c.find(this.unpitchedPredicate,this);if(void 0===j)throw new b(b.GET,this.opts,h);var k=e.getUnpitched(i),l=e.getUnpitched(j);if(!f.isSame(k,l))throw new d(this.name,"notes must have the same pitch");if(e.getHead(i)!==e.getHead(j))throw new d(this.name,"notes must have the same head");if(g.areNotesTied(i,j))throw new d(this.name,"notes are already tied")},q.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a=this.getLeftChord(),b=this.getRightChord(),c=a.find(this.unpitchedPredicate,this),d=b.find(this.unpitchedPredicate,this),h=f.copy(e.getUnpitched(c));g.tieNotes(c,d),this.updateStack(h)},q.unpitchedPredicate=function(a){var b=e.getUnpitched(a);return f.isSameLine(b,this.opts)},q.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,divisions:a.dpq,timePos:a.timePos,voiceIdx:this.opts.voiceIdx,"display-octave":this.opts["display-octave"],"display-step":this.opts["display-step"]}};this.cancelStack.storeAction(b)}},q.getLeftChord=function(){return this.crossMeasure.getLeftChord()},q.getRightChord=function(){return this.crossMeasure.getRightChord()},q.updateStack=function(a){this.opts.leftNoteIdx=this.crossMeasure.getLeftNoteIdx(),this.opts.leftMeasureIdx=this.crossMeasure.getLeftMeasureIdx(),this.opts.rightNoteIdx=this.crossMeasure.getRightNoteIdx(),this.opts.rightMeasureIdx=this.crossMeasure.getRightMeasureIdx();var b=this.getLocation(),c={type:this.name,opts:{partUuid:b.partUuid,partIdx:this.opts.partIdx,measureUuid:b.measureUuid,measureIdx:this.opts.leftMeasureIdx,noteIdx:this.opts.leftNoteIdx,timePos:b.timePos,divisions:b.dpq,voiceIdx:this.opts.voiceIdx,unpitched:f.copy(a)}};this.cancelStack.push(c);var d={type:this.name+"-close",opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.rightMeasureIdx,noteIdx:this.opts.rightNoteIdx,voiceIdx:this.opts.voiceIdx,unpitched:f.copy(a)}};this.cancelStack.push(d)},q.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=this.crossMeasure.getLeftMeasureIdx(),d=a.getMeasureUuid(c),e=this.crossMeasure.getLeftMeasure().getDpqValue(),f=this.crossMeasure.getLeftVoice(),g=this.crossMeasure.getLeftNoteIdx(),h=j(f,g);this.location={partUuid:b,measureUuid:d,dpq:e,timePos:h}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.client.NotPossibleOnRestsError,b=Adagio.Error.client.NotPossibleOnPitchedError,c=Adagio.Error.client.TieError,d=Adagio.Data.tieAction,e=Adagio.Utils.noteUtils,f=Adagio.Utils.unpitchedUtils,g=Adagio.edit.action.AddTieArcPercu,h=Adagio.edit.common.CrossMeasure,i=Adagio.edit.common.noteIdxToTimePos,j=Adagio.edit.common.convertPartUuidToGetPartIdx,k=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,l=Adagio.edit.common.convertTimePosToGetNoteIdx,m=Adagio.edit.common.initMeasureData,n=Adagio.edit.action.AddTiePercu=function(a,b,c){this.init(a,b,c)};n.NAME="action.AddTiePercu";var o=n.prototype;o.name=n.NAME,o.initMeasureData=m,o.init=function(a,b,c){j(a,b),k(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,l(this.measureData,b),this.crossMeasure=new h(this.measureData,b.voiceIdx,b.noteIdx),this.location=null},o.checkPreconditions=function(){this.checkUnpitchedPart(),this.crossMeasure.checkVoiceIdx(),this.crossMeasure.checkNoteIdx(),this.checkNotRest(),this.checkCanTie()},o.checkUnpitchedPart=function(){if(!this.measureData.isUnpitched())throw new b},o.checkNotRest=function(){if(this.isLeftRest()||this.isRightRest())throw new a},o.isLeftRest=function(){return this.crossMeasure.isLeftRest()},o.isRightRest=function(){return this.crossMeasure.isRightRest()},o.checkCanTie=function(){if(this.crossMeasure.hasRightGrace())throw new c(this.name,"right not cannot have graces notes attached.");var a=this.getLeftChord(),b=this.getRightChord();if(!d.canTieChords(a,b,!0))throw new c(this.name,"nothing can be tied")},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a=this.getLeftChord(),b=this.getRightChord(),c=p(a,b);d.tieChords(a,b,!0),this.updateStack(c)},o.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,divisions:a.dpq,timePos:a.timePos,voiceIdx:this.opts.voiceIdx}};this.cancelStack.storeAction(b)}},o.getLeftChord=function(){return this.crossMeasure.getLeftChord()},o.getRightChord=function(){return this.crossMeasure.getRightChord()};var p=function(a,b){return d.getUntiedPairs(a,b,!0).map(q)},q=function(a){var b=e.getUnpitched(a.left);return f.copy(b)};o.updateStack=function(a){this.opts.leftNoteIdx=this.crossMeasure.getLeftNoteIdx(),this.opts.leftMeasureIdx=this.crossMeasure.getLeftMeasureIdx(),this.opts.rightNoteIdx=this.crossMeasure.getRightNoteIdx(),this.opts.rightMeasureIdx=this.crossMeasure.getRightMeasureIdx(),a.forEach(this.addAction,this)},o.addAction=function(a){var b=this.getLocation(),c={type:g.NAME,opts:{partIdx:this.opts.partIdx,partUuid:b.partUuid,measureIdx:this.opts.leftMeasureIdx,measureUuid:b.measureUuid,noteIdx:this.opts.leftNoteIdx,timePos:b.timePos,divisions:b.dpq,voiceIdx:this.opts.voiceIdx,unpitched:f.copy(a)}};this.cancelStack.push(c);var d={type:g.NAME+"-close",opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.rightMeasureIdx,noteIdx:this.opts.rightNoteIdx,voiceIdx:this.opts.voiceIdx,unpitched:f.copy(a)}};this.cancelStack.push(d)},o.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=this.crossMeasure.getLeftMeasureIdx(),d=a.getMeasureUuid(c),e=this.crossMeasure.getLeftMeasure().getDpqValue(),f=this.crossMeasure.getLeftVoice(),g=this.crossMeasure.getLeftNoteIdx(),h=i(f,g);this.location={partUuid:b,measureUuid:d,dpq:e,timePos:h}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Utils.durationUtils,b=Adagio.Utils.noteUtils,c=Adagio.Utils.unpitchedUtils,d=Adagio.edit.composite.RemoveSpaceTuplets,e=Adagio.edit.composite.RemoveSpaceChordsQuarter,f=Adagio.edit.composite.SplitRestIfNeeded,g=Adagio.edit.action.AddChordPercu,h=Adagio.edit.action.AddTiePercu,i=Adagio.edit.action.ShowMeasureVoice,j=Adagio.edit.common.timePosToNoteIdx,k=Adagio.edit.common.initMeasureData,l=Adagio.edit.common.assertPerform,m=Adagio.edit.composite.AddChordPercuIntraMeasure=function(a,b,c){this.init(a,b,c)};m.NAME="composite.AddChordPercuIntraMeasure";var n=m.prototype;n.name=m.NAME,n.initMeasureData=k,n.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.firstChord=!0,this.quarterPosition=b.quarterPosition,this.quarterDuration=b.quarterDuration,this.noteIdx=null},n.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.isVoiceDisplayed()?(this.removeSpaceTuplets(),this.removeSpaceChords()):this.displayVoice(),this.splitRest(),this.fetchNoteIdx(),this.addChords()},n.isVoiceDisplayed=function(){return this.measureData.hasVoice(this.opts.voiceIdx)},n.removeSpaceTuplets=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,quarterPosition:this.opts.quarterPosition,quarterDuration:this.opts.quarterDuration};new d(this.measureData,a,this.cancelStack).perform()},n.removeSpaceChords=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,quarterPosition:this.opts.quarterPosition,quarterDuration:this.opts.quarterDuration};new e(this.measureData,a,this.cancelStack).perform()},n.displayVoice=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx},b=new i(this.measureData,a,this.cancelStack);l(b)},n.splitRest=function(){var b=a.quarterDurationToRequiredDpq(this.quarterPosition),c=a.quarterToDuration(this.quarterPosition,b),d={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,timePos:c,dpq:b};new f(this.measureData,d,this.cancelStack).perform()},n.fetchNoteIdx=function(){var b=this.measureData.getDpqValue(),c=a.quarterToDuration(this.quarterPosition,b),d=this.measureData.getVoice(this.opts.voiceIdx);this.noteIdx=j(d,1,c)},n.addChords=function(){for(;this.quarterDuration>0;){var a=this.getDurationOpts();this.addChord(a),this.isFirstChord()||this.tieWithPrevious(),this.moveForward()}},n.getDurationOpts=function(){var b=a.extractQuarterPossibleDuration(this.quarterDuration);return a.quarterToDurationOpts(b)},n.addChord=function(a){var b=this.opts.instruments.map(o),c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,noteIdx:this.noteIdx,instruments:b,durationType:a.durationType,nbDots:a.nbDots},d=new g(this.measureData,c,this.cancelStack);l(d)};var o=function(a){return{unpitched:c.copy(a.unpitched),notehead:a.notehead}};n.isFirstChord=function(){return this.firstChord},n.tieWithPrevious=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.noteIdx-1},b=new h(this.measureData,a,this.cancelStack);l(b)},n.moveForward=function(){this.firstChord=!1;var a=this.getCurrentQuarterDuration();this.quarterDuration-=a,this.noteIdx++},n.getCurrentQuarterDuration=function(){var a=this.measureData.getDpqValue(),c=this.measureData.getVoice(this.opts.voiceIdx),d=c.getNote(this.noteIdx);return b.getQuarterDuration(d,a)}}.call(this),function(){"use strict";var a=Adagio.Utils.durationUtils,b=Adagio.Utils.measureUtils,c=Adagio.Utils.unpitchedUtils,d=Adagio.edit.composite.AddChordPercuIntraMeasure,e=Adagio.edit.action.AddMeasure,f=Adagio.edit.action.AddTiePercu,g=Adagio.edit.common.MeasureData,h=Adagio.edit.common.timePosToNoteIdx,i=Adagio.edit.common.assertPerform,j=Adagio.edit.composite.AddChordPercuCrossMeasure=function(a,b,c){this.init(a,b,c)};j.NAME="composite.AddChordPercuCrossMeasure";var k=j.prototype;k.name=j.NAME,k.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.measureIdx=this.opts.measureIdx,this.quarterPosition=this.opts.quarterPosition,this.quarterDuration=this.opts.quarterDuration},k.perform=function(){for(this.cancelStack=this.cancelStack.createSubstack(this.name);this.quarterDuration>0;){var a=this.getSliceDuration();this.addChordIntraMeasure(a),this.isFirstMeasure()||this.tieWithPrevious(),this.moveForward(a),this.measureEndReached()&&this.nextMeasure()}this.storePosition()},k.isFirstMeasure=function(){return this.measureIdx===this.opts.measureIdx},k.tieWithPrevious=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:-1},b=new f(this.scoreData,a,this.cancelStack);i(b)},k.getSliceDuration=function(){var a=this.getMeasureQuarterDuration(),b=a-this.quarterPosition;return Math.min(b,this.quarterDuration)},k.addChordIntraMeasure=function(a){var b=this.opts.instruments.map(l),c={partIdx:this.opts.partIdx,measureIdx:this.measureIdx,staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,quarterPosition:this.quarterPosition,quarterDuration:a,instruments:b};new d(this.scoreData,c,this.cancelStack).perform()};var l=function(a){return{unpitched:c.copy(a.unpitched),notehead:a.notehead}};k.moveForward=function(a){this.quarterPosition+=a,this.quarterDuration-=a},k.measureEndReached=function(){return this.getMeasureQuarterDuration()===this.quarterPosition},k.getMeasureQuarterDuration=function(){var c=this.scoreData.getMeasure(this.opts.partIdx,this.measureIdx),d=b.getAnyTime(c);return a.timeToQuarter(d)},k.nextMeasure=function(){this.measureIdx++,this.quarterPosition=0;var a=this.scoreData.getNbMeasures();this.measureIdx===a&&this.addMeasure()},k.addMeasure=function(){var a={measureIdx:this.measureIdx},b=new e(this.scoreData,a,this.cancelStack);i(b)},k.storePosition=function(){var a=this.fetchNoteIdx(),b={measureIdx:this.measureIdx,noteIdx:a};this.cancelStack.storePosition(b)},k.fetchNoteIdx=function(){if(0===this.quarterPosition)return 0;var b=this.scoreData.getMeasure(this.opts.partIdx,this.measureIdx),c=new g(b),d=c.getVoice(this.opts.voiceIdx),e=c.getDpqValue(),f=a.quarterToDuration(this.quarterPosition,e);return h(d,1,f)}}.call(this),function(){"use strict";var a=Adagio.Error.client.NoPitchesError,b=Adagio.Error.client.BadQuarterPositionError,c=Adagio.Error.client.BadQuarterDurationError,d=Adagio.Error.client.UnpitchedCollisionError,e=Adagio.Error.client.NotPossibleOnPitchedError,f=Adagio.Error.client.BadVoiceError,g=Adagio.Error.value.BadQuarterPositionError,h=Adagio.Error.value.BadQuarterDurationError,i=Adagio.Utils.unpitchedUtils,j=Adagio.Utils.measureUtils,k=Adagio.Utils.durationUtils,l=Adagio.Utils.math,m=Adagio.Utils.staffDetailsUtils,n=Adagio.edit.composite.AddChordPercuCrossMeasure,o=Adagio.edit.common.MeasureData,p=Adagio.edit.common.checkCompatibleVoiceStaffIdx,q=Adagio.edit.common.convertPartUuidToGetPartIdx,r=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,s=Adagio.edit.common.checkUnpitchedInstrument,t=Adagio.edit.action.AddChordPercuCrossMeasure=function(a,b,c){this.init(a,b,c)};t.NAME="action.AddChordPercuCrossMeasure";var u=t.prototype;u.name=t.NAME,u.init=function(a,b,c){q(a,b),r(a,b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.location=null,this.measureData=null},u.checkPreconditions=function(){this.checkUnpitched(),this.checkLocation(),this.checkInstruments(),this.checkPosition(),this.checkDuration()},u.checkUnpitched=function(){if(!this.scoreData.isPartUnpitched(this.opts.partIdx))throw new e},u.checkLocation=function(){this.getMeasureData(),this.checkVoiceIdx(),p(this.scoreData,this.opts);var a=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx),c=j.getQuarterDuration(a),d=this.opts.quarterPosition;if(!l.isNumber(d)||d<0||d>=c)throw new b(d)},u.checkVoiceIdx=function(){if(!this.scoreData.hasPartVoiceIdx(this.opts.partIdx,this.opts.voiceIdx))throw new f(this.opts.voiceIdx)},u.getMeasureData=function(){if(null===this.measureData){var a=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx);this.measureData=new o(a,this.opts.measureIdx,null,this.scoreData)}return this.measureData},u.checkInstruments=function(){if(0===this.opts.instruments.length)throw new a;this.opts.instruments.forEach(this.checkInstrument,this),this.checkPitchCollision()},u.checkInstrument=function(a){var b=i.copy(a.unpitched),c={partIdx:this.opts.partIdx,notehead:a.notehead,unpitched:b},d=this.getMeasureData();s(d,c)},u.checkPitchCollision=function(){var a=this.opts.instruments.map(v).slice();a.sort(i.compare);for(var b=a.length,c=0;c<b-1;c++){var e=a[c],f=a[c+1];if(i.isSameLine(e,f)){var g=i.copy(e),h=this.getMeasureData(),j=h.getStaffDetails(this.opts.staffIdx),k=m.getNbStaffLines(j);throw new d(d.INSERT,g,k)}}};var v=function(a){return a.unpitched};u.checkPosition=function(){var a=this.opts.quarterPosition;if(!k.isValidQuarter(a))throw new g(a)},u.checkDuration=function(){var a=this.opts.quarterDuration;if(!k.isValidQuarter(a))throw new h(a);if(0===a)throw new c(a)},u.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.addChordPercuCrossMeasure()},u.addChordPercuCrossMeasure=function(){var a=this.opts.instruments.map(w),b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,quarterPosition:this.opts.quarterPosition,quarterDuration:this.opts.quarterDuration,instruments:a};new n(this.scoreData,b,this.cancelStack).perform()},u.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b=this.opts.instruments.map(w),c={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,quarterPosition:this.opts.quarterPosition,quarterDuration:this.opts.quarterDuration,instruments:b}};this.cancelStack.storeAction(c)}};var w=function(a){return{
unpitched:i.copy(a.unpitched),notehead:a.notehead}};u.getLocation=function(){if(null===this.location){var a=this.scoreData.getPartUuid(this.opts.partIdx),b=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={partUuid:a,measureUuid:b}}return this.location}}.call(this);(function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.noteUtils,c=Adagio.edit.action.RemoveChord,d=Adagio.edit.action.RemoveChordPercu,e=Adagio.edit.composite.UnlockRest,f=Adagio.edit.common.initMeasureData,g=Adagio.edit.common.assertPerform,h=Adagio.edit.composite.RemoveSpaceTupletChords=function(a,b,c){this.init(a,b,c)};h.NAME="composite.RemoveSpaceTupletChords";var i=h.prototype;i.name=h.NAME,i.initMeasureData=f,i.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.noteIdx=b.noteIdx,this.quarterDuration=b.quarterDuration},i.perform=function(){for(this.cancelStack=this.cancelStack.createSubstack(this.name),this.checkTuplet();!this.done();)this.isNote()?this.removeChord():this.unlockRest(),this.moveForward();if(this.quarterDuration>0){throw new a("NotEnoughSpace","Was not able to remove the required duration. ")}},i.checkTuplet=function(){if(!this.getVoice().isTuplet())throw new a("TupletExpected","Tuplet expected.")},i.isNote=function(){return!this.getVoice().isRest(this.noteIdx)},i.done=function(){if(this.quarterDuration<=0)return!0;var a=this.getVoice(),b=a.getStopNoteIdx();return this.noteIdx>b},i.removeChord=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.noteIdx},b=this.getRemoveChordAction(this.noteIdx),c=new b(this.measureData,a,this.cancelStack);g(c)},i.getRemoveChordAction=function(e){var f=this.getVoice(),g=f.getNote(e);if(b.hasUnpitched(g))return d;if(b.hasPitch(g))return c;throw new a("Unexpected")},i.unlockRest=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.noteIdx};new e(this.measureData,a,this.cancelStack).perform()},i.moveForward=function(){var a=this.getCurrentNoteQuarterDuration();this.quarterDuration-=a,this.noteIdx++},i.getCurrentNoteQuarterDuration=function(){var a=this.getVoice(),c=a.getNote(this.noteIdx),d=this.getDpq();return b.getNormalQuarterDuration(c,d)},i.getVoice=function(){return this.measureData.getVoiceOrTupletForGet(this.opts.voiceIdx,this.opts.noteIdx)},i.getDpq=function(){return this.measureData.getDpqValue()}}).call(this),function(){"use strict";var a=Adagio.Utils.durationUtils,b=Adagio.Utils.noteUtils,c=Adagio.edit.values.InsertMode,d=Adagio.edit.composite.RemoveSpaceTuplets,e=Adagio.edit.composite.RemoveSpaceChordsQuarter,f=Adagio.edit.composite.RemoveSpaceTupletChords,g=Adagio.edit.action.ChangeDurationFormat,h=Adagio.edit.common.initMeasureData,i=Adagio.edit.common.assertPerform,j=Adagio.edit.composite.ChangeDurationErase=function(a,b,c){this.init(a,b,c)};j.NAME="composite.ChangeDurationErase";var k=j.prototype;k.initMeasureData=h,k.name=j.NAME,k.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},k.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a=this.getActualQuarterDuration(),b=this.opts.quarterDuration-a;b>0&&this.erase(b),this.changeDuration()},k.getActualQuarterDuration=function(){var a=this.getVoice(),c=a.getNote(this.opts.noteIdx),d=this.measureData.getDpqValue();return b.getNormalQuarterDuration(c,d)},k.erase=function(a){this.isTuplet()?this.eraseInTuplet(a):this.eraseInVoice(a)},k.isTuplet=function(){return this.measureData.getVoiceOrTupletForGet(this.opts.voiceIdx,this.opts.noteIdx).isTuplet()},k.eraseInTuplet=function(a){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx+1,quarterDuration:a};new f(this.measureData,b,this.cancelStack).perform()},k.eraseInVoice=function(a){var b=this.getNextQuarterPosition();this.eraseTuplets(b,a),this.eraseChords(b,a)},k.getNextQuarterPosition=function(){var b=this.getVoice(),c=b.getRangeSpace(0,this.opts.noteIdx+1),d=this.measureData.getDpqValue();return a.divisionsToQuarter(c,d)},k.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},k.eraseTuplets=function(a,b){var c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,quarterPosition:a,quarterDuration:b};new d(this.measureData,c,this.cancelStack).perform()},k.eraseChords=function(a,b){var c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,quarterPosition:a,quarterDuration:b};new e(this.measureData,c,this.cancelStack).perform()},k.changeDuration=function(){var b=a.quarterToDurationOpts(this.opts.quarterDuration),d={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,durationType:b.durationType,nbDots:b.nbDots,insertMode:c.REPLACE},e=new g(this.measureData,d,this.cancelStack);i(e)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.pitchUtils,c=Adagio.Utils.clone,d=Adagio.Utils.noteUtils,e=Adagio.Utils.durationUtils,f=Adagio.Utils.typeUtils,g=Adagio.Utils.unpitchedUtils,h=Adagio.edit.action.AddTie,i=Adagio.edit.action.AddTiePercu,j=Adagio.edit.action.AddMeasure,k=Adagio.edit.action.AddChordCrossMeasure,l=Adagio.edit.action.AddRestCrossMeasure,m=Adagio.edit.action.AddChordPercuCrossMeasure,n=Adagio.edit.composite.ChangeDurationErase,o=Adagio.edit.common.initMeasureData,p=Adagio.edit.common.assertPerform,q=Adagio.edit.composite.ChangeDurationCrossMeasure=function(a,b,c){this.init(a,b,c)};q.NAME="composite.ChangeDurationCrossMeasure";var r=q.prototype;r.initMeasureData=o,r.name=q.NAME,r.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.heads=null,this.instruments=null},r.perform=function(){if(this.cancelStack=this.cancelStack.createSubstack(this.name),this.changeDurationIfNeeded(),this.hasRemainingSpace())if(this.isTuplet())this.raiseUnexpectedRemainingSpace();else if(this.fetchNextLocation(),this.isRest()||this.fetchChordData(),this.addMeasureIfNeeded(),this.isRest())this.addRest();else if(null!==this.heads)this.addChord(),this.addTie();else{if(null===this.instruments)throw new a("Unexpected");this.addChordPercu()}},r.changeDurationIfNeeded=function(){this.quarterDuration=e.durationOptsToQuarter(this.opts);var a=this.quarterDuration,b=this.getAvailableQuarterDuration();a=Math.min(a,b),a=e.extractQuarterPossibleDuration(a),a!==this.getActualQuarterDuration()&&this.changeDurationErase(a),this.quarterDuration-=a},r.changeDurationErase=function(a){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,quarterDuration:a};new n(this.measureData,b,this.cancelStack).perform()},r.getAvailableQuarterDuration=function(){var a=this.getVoiceOrTupletForGet(),b=a.getAbsoluteTimeModif(),c=this.opts.noteIdx,d=a.getSpaceFromIdx(c),f=e.actualToNormal(d,b),g=this.measureData.getDpqValue();return e.divisionsToQuarter(f,g)},r.getActualQuarterDuration=function(){var a=this.getVoice(),b=a.getNote(this.opts.noteIdx),c=this.measureData.getDpqValue();return d.getNormalQuarterDuration(b,c)},r.removedUsedSpace=function(){var a=this.getVoice(),b=a.getNote(this.opts.noteIdx),c=this.measureData.getDpqValue(),e=d.getNormalQuarterDuration(b,c);this.quarterDuration-=e},r.hasRemainingSpace=function(){return this.quarterDuration>0},r.isTuplet=function(){return this.getVoiceOrTupletForGet().isTuplet()},r.isRest=function(){return this.getVoice().isRest(this.opts.noteIdx)},r.getVoiceOrTupletForGet=function(){return this.measureData.getVoiceOrTupletForGet(this.opts.voiceIdx,this.opts.noteIdx)},r.raiseUnexpectedRemainingSpace=function(){throw new a("UnexpectedRemainingSpace","There should not be remaining space for a change duration of a rest or inside a tuplet. The score should still be consistent.")},r.fetchNextLocation=function(){this.measureIdx=this.opts.measureIdx;var a=this.opts.noteIdx+1,b=this.getVoice();if(a===b.size())this.quarterPosition=0,this.measureIdx++;else{var c=b.getRangeSpace(0,a),d=this.measureData.getDpqValue();this.quarterPosition=e.divisionsToQuarter(c,d)}},r.fetchChordData=function(){var b=this.getVoice(),c=b.getNote(this.opts.noteIdx);this.staffIdx=d.getStaffIdx(c);var e=b.getChord(this.opts.noteIdx);if(e=f.makeArray(e),d.hasPitch(c))this.heads=e.map(s);else{if(!d.hasUnpitched(c))throw new a("Unexpected");this.instruments=e.map(this.extractUnpitchedInstrument,this)}};var s=function(a){var e=d.getPitch(a);e=b.copy(e);var f={pitch:e};if(d.hasFretData(a)){var g=d.getFretData(a);g=c(g),f.fretData=g}return f};r.extractUnpitchedInstrument=function(a){var b=d.getUnpitched(a),c=d.getHead(a),e=d.getInstrumentId(a),f=this.measureData.getScoreData(),h=f.searchInstrumentMIDIUnpitched(this.opts.partIdx,e);return{unpitched:g.copy(b),notehead:c,MIDIUnpitched:h}},r.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},r.addMeasureIfNeeded=function(){var a=this.measureData.getScoreData(),b=a.getNbMeasures();if(this.measureIdx===b){var c={measureIdx:b},d=new j(a,c,this.cancelStack);p(d)}},r.addRest=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.measureIdx,voiceIdx:this.opts.voiceIdx,quarterDuration:this.quarterDuration,quarterPosition:this.quarterPosition},b=this.measureData.getScoreData(),c=new l(b,a,this.cancelStack);p(c)},r.addChord=function(){var a=this.heads.map(t),b={partIdx:this.opts.partIdx,measureIdx:this.measureIdx,staffIdx:this.staffIdx,voiceIdx:this.opts.voiceIdx,quarterDuration:this.quarterDuration,quarterPosition:this.quarterPosition,heads:a},c=this.measureData.getScoreData(),d=new k(c,b,this.cancelStack);p(d),this.refreshMeasureData()};var t=function(a){var d=b.copy(a.pitch),e={pitch:d};return void 0!==a.fretData&&(e.fretData=c(a.fretData)),e};r.refreshMeasureData=function(){var a=this.measureData.getScoreData();this.initMeasureData(a,this.opts)},r.addTie=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx},b=this.measureData.isUnpitched()?i:h,c=new b(this.measureData,a,this.cancelStack);p(c)},r.addChordPercu=function(){var a=c(this.instruments),b={partIdx:this.opts.partIdx,measureIdx:this.measureIdx,staffIdx:this.staffIdx,voiceIdx:this.opts.voiceIdx,quarterDuration:this.quarterDuration,quarterPosition:this.quarterPosition,instruments:a},d=this.measureData.getScoreData(),e=new m(d,b,this.cancelStack);p(e),this.refreshMeasureData()}}.call(this),function(){"use strict";var a=Adagio.Error.client.NotEnoughSpaceError,b=Adagio.Error.noChange.NoChangeError,c=Adagio.Utils.noteUtils,d=Adagio.edit.common.calcDuration,e=Adagio.edit.common.checkOptsDuration,f=Adagio.edit.common.convertPartUuidToGetPartIdx,g=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,h=Adagio.edit.common.convertTimePosToGetNoteIdx,i=Adagio.edit.composite.ChangeDurationCrossMeasure,j=Adagio.edit.common.initMeasureData,k=Adagio.edit.action.ChangeDurationCrossMeasure=function(a,b,c){this.init(a,b,c)};k.NAME="action.ChangeDurationCrossMeasure",k.isNoChange=function(a){return a instanceof b};var l=k.prototype;l.initMeasureData=j,l.name=k.NAME,l.init=function(a,b,c){f(a,b),g(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,h(this.measureData,this.opts),this.location=null},l.checkPreconditions=function(){e(this.opts),this.checkLocation(),this.checkAvailableSpace()},l.checkLocation=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.measureData.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},l.checkAvailableSpace=function(){var a=this.getRequiredDuration(),c=this.getActualDuration();if(!(c>a)){if(c===a)throw new b;if(a-=c,this.isTuplet()){var d=this.getAvailableSpace();d<a&&this.raiseNotEnoughSpace(a,d)}}},l.getRequiredDuration=function(){var a=this.measureData.getDpqValue(),b=this.getTimeModif();return d(this.opts,a,b)},l.getTimeModif=function(){return this.getVoiceOrTupletForGet().getAbsoluteTimeModif()},l.getActualDuration=function(){var a=this.getVoice(),b=a.getNote(this.opts.noteIdx);return c.getDuration(b)},l.isTuplet=function(){return this.getVoiceOrTupletForGet().isTuplet()},l.isRest=function(){return this.getVoice().isRest(this.opts.noteIdx)},l.getAvailableSpace=function(){var a=this.getVoiceOrTupletForGet(),b=this.opts.noteIdx+1;return a.getSpaceFromIdx(b)},l.raiseNotEnoughSpace=function(b,c){var d=this.getVoiceOrTupletForGet(),e=this.measureData.getDpqValue(),f=d.getAbsoluteTimeModif();throw new a(b,c,e,f)},l.getVoiceOrTupletForGet=function(){var a=this.opts.voiceIdx,b=this.opts.noteIdx;return this.measureData.getVoiceOrTupletForGet(a,b)},l.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.changeDuration()},l.changeDuration=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,insertMode:this.opts.insertMode,durationType:this.opts.durationType,nbDots:this.opts.nbDots};new i(this.measureData,a,this.cancelStack).perform()},l.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},l.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,timePos:a.timePos,divisions:a.dpq,voiceIdx:this.opts.voiceIdx,insertMode:this.opts.insertMode,durationType:this.opts.durationType,nbDots:this.opts.nbDots}};this.cancelStack.storeAction(b)}},l.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.client.NotEnoughSpaceError,b=Adagio.Error.client.NotPossibleOnPitchedError,c=Adagio.Utils.noteUtils,d=Adagio.Utils.clone,e=Adagio.Utils.durationUtils,f=Adagio.edit.values.InsertMode,g=Adagio.edit.common.calcDuration,h=Adagio.edit.common.checkOptsDuration,i=Adagio.edit.action.ChangeDurationCrossMeasure,j=Adagio.edit.action.AddChordPercu,k=Adagio.edit.common.initMeasureData,l=Adagio.edit.action.AddChordPercuCrossMeasure2=function(a,b,c){this.init(a,b,c)};l.NAME="action.AddChordPercuCrossMeasure2";var m=l.prototype;m.initMeasureData=k,m.name=l.NAME,m.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.addChordPercuAction=null},m.checkPreconditions=function(){h(this.opts),this.checkUnpitchedPart(),this.checkLocation(),this.checkAvailableSpace(),this.checkNoteData()},m.checkUnpitchedPart=function(){if(!this.measureData.isUnpitched())throw new b},m.checkLocation=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.measureData.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},m.checkAvailableSpace=function(){var a=this.getRequiredDuration(),b=this.getActualDuration();if(!(b>a)&&b!==a&&(a-=b,this.isTuplet())){var c=this.getAvailableSpace();c<a&&this.raiseNotEnoughSpace(a,c)}},m.getRequiredDuration=function(){var a=this.measureData.getDpqValue(),b=this.getTimeModif();return g(this.opts,a,b)},m.getTimeModif=function(){return this.getVoiceOrTupletForGet().getAbsoluteTimeModif()},m.getActualDuration=function(){var a=this.getVoice(),b=a.getNote(this.opts.noteIdx);return c.getDuration(b)},m.isTuplet=function(){return this.getVoiceOrTupletForGet().isTuplet()},m.getAvailableSpace=function(){var a=this.getVoiceOrTupletForGet(),b=this.opts.noteIdx+1;return a.getSpaceFromIdx(b)},m.raiseNotEnoughSpace=function(b,c){var d=this.getVoiceOrTupletForGet(),e=this.measureData.getDpqValue(),f=d.getAbsoluteTimeModif();throw new a(b,c,e,f)},m.getVoiceOrTupletForGet=function(){var a=this.opts.voiceIdx,b=this.opts.noteIdx;return this.measureData.getVoiceOrTupletForGet(a,b)},m.checkNoteData=function(){this.getAddChordPercuAction().checkPreconditions()},m.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.addNote();var a=this.getRequiredDuration();this.getActualDuration()!==a&&this.changeDuration()},m.addNote=function(){var a=this.getAddChordPercuAction();a.cancelStack=this.cancelStack,a.perform()},m.getAddChordPercuAction=function(){if(null===this.addChordPercuAction){var a=this.getActualDurationOpts(),b=d(this.opts.instruments),c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,noteIdx:this.opts.noteIdx,insertMode:f.REPLACE,durationType:a.durationType,nbDots:a.nbDots,instruments:b};this.addChordPercuAction=new j(this.measureData,c,this.cancelStack)}return this.addChordPercuAction},m.getActualDurationOpts=function(){var a=this.getVoice(),b=a.getNote(this.opts.noteIdx),d=this.measureData.getDpqValue(),f=c.getNormalQuarterDuration(b,d);return e.quarterToDurationOpts(f)},m.changeDuration=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,durationType:this.opts.durationType,nbDots:this.opts.nbDots},b=new i(this.measureData,a,this.cancelStack);b.checkPreconditions(),b.perform()},m.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.edit.common.initMeasureData,c=Adagio.edit.common.getNoteAtPitch,d=Adagio.edit.primitive.AddCourtesyAccidental=function(a,b,c){this.init(a,b,c)};d.NAME="primitive.AddCourtesyAccidental";var e=d.prototype;e.name=d.NAME,e.initMeasureData=b,e.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},e.perform=function(){this.addCourtesyAccidental(),this.updateStack()},e.addCourtesyAccidental=function(){var b=this.measureData.getVoice(this.opts.voiceIdx),d=c(b,this.opts.noteIdx,this.opts.pitch);a.addCourtesyAccidental(d)},e.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.Error.noChange.NoChangeError,b=Adagio.Error.client.NotPossibleOnUnpitchedError,c=Adagio.Error.client.PitchCollisionError,d=Adagio.Utils.noteUtils,e=Adagio.Utils.pitchUtils,f=Adagio.edit.primitive.AddCourtesyAccidental,g=Adagio.edit.common.getNoteAtPitch,h=Adagio.edit.common.checkOptsPitch,i=Adagio.edit.common.convertLineToPitch,j=Adagio.edit.common.convertTimePosToGetNoteIdx,k=Adagio.edit.common.convertPartUuidToGetPartIdx,l=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,m=Adagio.edit.common.transposePitchLineOpts,n=Adagio.edit.common.initMeasureData,o=Adagio.edit.action.AddCourtesyAccidental=function(a,b,c){this.init(a,b,c)};o.NAME="action.AddCourtesyAccidentals",o.isNoChange=function(b){return b instanceof a};var p=o.prototype;p.name=o.NAME,p.initMeasureData=n,p.init=function(a,b,c){k(a,b),l(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.noteHead=null,this.voice=null,this.location=null},p.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),j(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),this.checkValues(),this.sanitizeIfNeeded(),this.checkNoteAtPitch(),this.checkNoCourtesy()},p.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new b},p.checkValues=function(){h(this.opts)},p.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},p.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},p.sanitizeIfNeeded=function(){void 0!==this.opts.line&&i(this.measureData,this.opts,!0),this.opts.isConcertPitch&&m(this.measureData,this.opts)},p.checkNoteAtPitch=function(){if(void 0===this.getNoteAtPitch()){var a=e.copy(this.opts.pitch);throw new c(c.action.GET,a)}},p.checkNoCourtesy=function(){var b=this.getNoteAtPitch();if(d.hasCourtesyAccidental(b))throw new a},p.getNoteAtPitch=function(){if(null===this.noteHead){var a=this.getVoice();this.noteHead=g(a,this.opts.noteIdx,this.opts.pitch)}return this.noteHead},p.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.addCourtesyAccidental(),this.updateStack()},p.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos,pitch:e.copyWithoutAlter(this.opts.pitch),isConcertPitch:!1},c={actionName:this.name,opts:b};this.cancelStack.storeAction(c)}},p.addCourtesyAccidental=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:e.copy(this.opts.pitch)};new f(this.measureData,a,this.cancelStack).perform()},p.updateStack=function(){var a=this.getLocation(),b={partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos,pitch:e.copyWithoutAlter(this.opts.pitch)},c={type:this.name,noDraw:!0,opts:b};this.cancelStack.push(c)},p.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.getVoice(),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f,isConcertPitch:!1}}return this.location},p.getVoice=function(){return null===this.voice&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadMeasureIdxError,b=Adagio.Error.noChange.NoChangeError,c=Adagio.Utils.barlineUtils,d=Adagio.Utils.measureUtils,e=Adagio.edit.values.PosBarline,f=Adagio.edit.composite.AddBarline,g=Adagio.edit.action.RemoveBarline,h=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,i=Adagio.edit.common.assertPerform,j=Adagio.edit.action.AddDoubleBarline=function(a,b,c){this.init(a,b,c)};j.NAME="action.AddDoubleBarline";var k=j.prototype;k.name=j.NAME,k.init=function(a,b,c){h(a,b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.location=null},k.checkPreconditions=function(){this.checkLocation(),this.checkAlready()},k.checkLocation=function(){var b=this.opts.measureIdx,c=this.scoreData.getNbMeasures();if(b<0||b>=c)throw new a(b)},k.checkAlready=function(){var a=this.getAnyMeasure();if(d.hasRightBarline(a)){var e=d.getRightBarline(a);if(c.getStyle(e)===c.DOUBLE_LIGHT){throw new b("There is already a double barline in this measure.")}}},k.getAnyMeasure=function(){return this.scoreData.getMeasure(0,this.opts.measureIdx)},k.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.removeFormerBarline(),this.addBarline(),this.updateStack()},k.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{measureUuid:a.measureUuid}};this.cancelStack.storeAction(b)}},k.removeFormerBarline=function(){var a={measureIdx:this.opts.measureIdx,side:e.RIGHT},b=new g(this.scoreData,a,this.cancelStack);i(b,l)};var l=function(a){return a instanceof b};k.addBarline=function(){var a={measureIdx:this.opts.measureIdx,side:e.RIGHT,style:c.DOUBLE_LIGHT};new f(this.scoreData,a,this.cancelStack).perform()},k.updateStack=function(){var a=this.getLocation(),b={type:this.name,noDraw:!0,opts:{measureUuid:a.measureUuid}};this.cancelStack.push(b)},k.getLocation=function(){if(null===this.location){var a=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={measureUuid:a}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Utils.soundUtils,c=Adagio.Error.value.BadSoundDynamicError=function(b){var c=d(b),e=a.call(this,c);return this.name=e.name="BadSoundDynamicError",this.stack=e.stack,this.message=e.message,this.dynamic=b,this},d=function(a){return"The value ["+a+"] is invalid. It must be a positive float between [0 and "+b.MAX_DYNAMIC+"]."};c.prototype=Object.create(a.prototype,{constructor:{value:c}})}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.math,c=Adagio.Utils.measureUtils,d=Adagio.Utils.direction.dynamicDirectionUtils,e=Adagio.edit.common.optsToLocalGetTimePos,f=Adagio.edit.primitive.AddDynamic=function(a,b,c){this.init(a,b,c)};f.NAME="primitive.AddDynamic";var g=f.prototype;g.name=f.NAME,g.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.measure=null,this.dynamicIdx=null,this.localTimePos=null},g.perform=function(){this.addDynamic(),this.updateStack()},g.addDynamic=function(){var a=this.getMeasure(),b=this.getDynamicIdx(),d=this.createDynamic(),e=c.getDynamics(a,this.opts.staffIdx);e.splice(b,0,d),c.setDynamics(a,this.opts.staffIdx,e)},g.getDynamicIdx=function(){return null===this.dynamicIdx&&this.fetchDynamicIdx(),this.dynamicIdx},g.fetchDynamicIdx=function(){var a=this.getMeasure(),b=c.getDynamics(a,this.opts.staffIdx);if(b.some(this.tryDynamicIdx,this),null===this.dynamicIdx){var d=b.length;this.dynamicIdx=d}},g.tryDynamicIdx=function(b,c){var e=this.getLocalTimePos(),f=d.getTimePos(b);if(f<e)return!1;if(f>e)return this.dynamicIdx=c,!0;throw new a("TimePosCollision","There is already an dynamic at this time position.")},g.createDynamic=function(){var a=this.getLocalTimePos();return d.create(this.opts.staffIdx,this.opts.placement,a,this.opts.style,this.opts.sound)},g.getLocalTimePos=function(){if(null===this.localTimePos){var c=this.getMeasure();if(this.localTimePos=e(this.opts,c),!b.isInteger(this.localTimePos)){var d="At the point, the time position ["+this.localTimePos+"] should be an integer.";throw new a("IntegerExpected",d)}}return this.localTimePos},g.getMeasure=function(){return null===this.measure&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure},g.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.edit.primitive.AddDynamic,b=Adagio.edit.composite.AdaptDpqToPosition,c=Adagio.edit.composite.AddDynamic=function(a,b,c){this.init(a,b,c)};c.NAME="composite.AddDynamic";var d=c.prototype;d.name=c.NAME,d.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},d.perform=function(){this.updateDpq(),this.addDynamic()},d.updateDpq=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:this.opts.timePos,dpq:this.opts.dpq};new b(this.scoreData,a,this.cancelStack).perform()},d.addDynamic=function(){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,placement:this.opts.placement,timePos:this.opts.timePos,dpq:this.opts.dpq,style:this.opts.style,sound:this.opts.sound};new a(this.scoreData,b,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.math,c=Adagio.Utils.measureUtils,d=Adagio.edit.primitive.RemoveDynamic=function(a,b,c){this.init(a,b,c)};d.NAME="primitive.RemoveDynamic";var e=d.prototype;e.name=d.NAME,e.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},e.perform=function(){this.removeDynamic(),this.updateStack()},e.removeDynamic=function(){var a=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx),b=c.getDynamics(a,this.opts.staffIdx),d=b.length;f(this.opts.dynamicIdx,d),b.splice(this.opts.dynamicIdx,1),c.setDynamics(a,this.opts.staffIdx,b)};var f=function(c,d){if(!b.isInteger(c)||c<0||c>=d){throw new a("BadDynamicIdx","Invalid dynamicIdx: ["+c+"].")}};e.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadPartIdxError,b=Adagio.Error.client.BadMeasureIdxError,c=Adagio.Error.client.BadStaffIdxError,d=Adagio.Error.client.TimePosOutOfRangeError,e=Adagio.Error.noChange.NoChangeError,f=Adagio.Utils.measureUtils,g=Adagio.Utils.math,h=Adagio.Utils.direction.dynamicDirectionUtils,i=Adagio.edit.primitive.RemoveDynamic,j=Adagio.edit.common.optsToLocalGetTimePos,k=Adagio.edit.common.convertPartUuidToGetPartIdx,l=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,m=Adagio.edit.action.RemoveDynamicAtTimePos=function(a,b,c){this.init(a,b,c)};m.NAME="action.RemoveDynamicAtTimePos",m.isAuthorizedException=function(f){return f instanceof a||f instanceof b||f instanceof c||f instanceof d||f instanceof e};var n=m.prototype;n.name=m.NAME,n.init=function(a,b,c){k(a,b),l(a,b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.measure=null,this.dynamics=null,this.location=null,this.dynamicIdx=null,this.localTimePos=null},n.performIfPossible=function(){this.isPossible()&&this.perform()},n.isPossible=function(){var a=!0;try{this.checkPreconditions()}catch(b){if(!m.isAuthorizedException(b))throw b;a=!1}return a},n.checkPreconditions=function(){this.checkLocation(),this.checkTimePos(),this.checkExistence()},n.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx);var a=this.getMeasure(),b=f.getNbStaves(a),d=this.opts.staffIdx;if(!g.isNumber(d)||d<0||d>=b)throw new c(d)},n.checkTimePos=function(){var a=this.getLocalTimePos(),b=this.getMeasure(),c=f.getNbDivisions(b);if(!g.isNumber(a)||a<0||a>c){var e=f.getDpq(b);throw new d(a,e)}},n.checkExistence=function(){this.fetchDynamicIdx()},n.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a=this.getPreviousData();this.removeDynamic(),this.updateStack(a)},n.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,staffIdx:this.opts.staffIdx,timePos:this.opts.timePos,dpq:this.opts.dpq}};this.cancelStack.storeAction(b)}},n.getPreviousData=function(){var a=this.getDynamic(),b=h.getStaffIdx(a),c=h.getPlacement(a),d=h.getTimePos(a),e=h.getStyle(a),g=null;h.hasSound(a)&&(g=h.getSound(a));var i=this.getMeasure();return{staffIdx:b,placement:c,timePos:d,dpq:f.getDpq(i),style:e,sound:g}},n.getDynamic=function(){return this.getDynamics()[this.getDynamicIdx()]},n.removeDynamic=function(){var a=this.getDynamicIdx(),b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,dynamicIdx:a};new i(this.scoreData,b,this.cancelStack).perform()},n.getDynamicIdx=function(){return null===this.dynamicIdx&&this.fetchDynamicIdx(),this.dynamicIdx},n.fetchDynamicIdx=function(){if(this.dynamicIdx=null,this.getDynamics().some(this.checkDynamicTimePos,this),null===this.dynamicIdx)throw new e},n.getDynamics=function(){if(null===this.dynamics){var a=this.getMeasure();this.dynamics=f.getDynamics(a,this.opts.staffIdx)}return this.dynamics},n.checkDynamicTimePos=function(a,b){var c=this.getLocalTimePos(),d=h.getTimePos(a);return!(d<c)&&(d===c&&(this.dynamicIdx=b),!0)},n.getLocalTimePos=function(){if(null===this.localTimePos){var a=this.getMeasure();this.localTimePos=j(this.opts,a)}return this.localTimePos},n.getMeasure=function(){return null===this.measure&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure},n.updateStack=function(a){var b=this.getLocation(),c={type:this.name,noDraw:!0,opts:{partUuid:b.partUuid,measureUuid:b.measureUuid,staffIdx:a.staffIdx,placement:a.placement,timePos:a.timePos,dpq:a.dpq,sound:a.sound,style:a.style}};this.cancelStack.push(c)},n.getLocation=function(){if(null===this.location){var a=this.scoreData.getPartUuid(this.opts.partIdx),b=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={partUuid:a,measureUuid:b}}return this.location}}.call(this),function(){"use strict";var a=Adagio.edit.composite.AddDynamic,b=Adagio.edit.action.RemoveDynamicAtTimePos,c=Adagio.edit.composite.AddDynamicErase=function(a,b,c){this.init(a,b,c)}
;c.NAME="composite.AddDynamicErase";var d=c.prototype;d.name=c.NAME,d.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},d.perform=function(){this.removeFormerDynamic(),this.addDynamic()},d.removeFormerDynamic=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,timePos:this.opts.timePos,dpq:this.opts.dpq};new b(this.scoreData,a,this.cancelStack).performIfPossible()},d.addDynamic=function(){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,placement:this.opts.placement,timePos:this.opts.timePos,dpq:this.opts.dpq,style:this.opts.style,sound:this.opts.sound};new a(this.scoreData,b,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadStaffIdxError,b=Adagio.Error.value.BadPlacementDirectionError,c=Adagio.Error.value.BadSoundDynamicError,d=Adagio.Error.client.TimePosOutOfRangeError,e=Adagio.Values.DirectionPlacement,f=Adagio.Utils.dynamicDisplayUtils,g=Adagio.Utils.soundUtils,h=Adagio.Utils.measureUtils,i=Adagio.Utils.math,j=Adagio.Values.DynamicStyle,k=Adagio.edit.common.convertPartUuidToGetPartIdx,l=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,m=Adagio.edit.common.optsToLocalGetTimePos,n=Adagio.edit.composite.AddDynamicErase,o=Adagio.edit.action.AddDynamicAtTimePos=function(a,b,c){this.init(a,b,c)};o.NAME="action.AddDynamicAtTimePos";var p=o.prototype;p.name=o.NAME,p.init=function(a,b,c){k(a,b),l(a,b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.localTimePos=null,this.location=null},p.checkPreconditions=function(){this.checkLocation(),this.checkTimePos(),this.checkParam()},p.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx);var b=this.getMeasure(),c=h.getNbStaves(b);if(this.opts.staffIdx<0||this.opts.staffIdx>=c)throw new a(this.opts.staffIdx)},p.checkTimePos=function(){var a=this.getLocalTimePos(),b=this.getMeasure(),c=h.getNbDivisions(b);if(!i.isNumber(a)||a<0||a>=c){var e=h.getDpq(b);throw new d(a,e)}},p.getLocalTimePos=function(){if(null===this.localTimePos){var a=this.getMeasure();this.localTimePos=m(this.opts,a)}return this.localTimePos},p.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},p.checkParam=function(){if(!e.isValid(this.opts.placement))throw new b(this.opts.placement);j.check(this.opts.style);var a=this.getSoundDynamic();if(!g.isValidDynamic(a))throw new c(a)},p.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.addDynamic(),this.updateStack()},p.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b=this.getSoundDynamic(),c={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,staffIdx:this.opts.staffIdx,placement:this.opts.placement,timePos:this.opts.timePos,dpq:this.opts.dpq,style:this.opts.style,sound:b}};this.cancelStack.storeAction(c)}},p.addDynamic=function(){var a=this.getSoundDynamic(),b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,placement:this.opts.placement,timePos:this.opts.timePos,dpq:this.opts.dpq,style:this.opts.style,sound:a};new n(this.scoreData,b,this.cancelStack).perform()},p.getSoundDynamic=function(){return void 0!==this.opts.sound?this.opts.sound:f.getDefaultIntensityForStyle(this.opts.style)},p.updateStack=function(){var a=this.getLocation(),b={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,staffIdx:this.opts.staffIdx,placement:this.opts.placement,timePos:this.opts.timePos,dpq:this.opts.dpq}};this.cancelStack.push(b)},p.getLocation=function(){if(null===this.location){var a=this.scoreData.getPartUuid(this.opts.partIdx),b=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={partUuid:a,measureUuid:b}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.edit.common.MeasureData,c=Adagio.edit.action.AddDynamicAtTimePos,d=Adagio.edit.action.AddDynamics=function(a,b,c){this.init(a,b,c)};d.NAME="action.AddDynamics";var e=d.prototype;e.name=d.NAME,e.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.measureData=null,this.action=null},e.checkPreconditions=function(){this.checkLocation(),this.getAction().checkPreconditions()},e.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx);var a=this.getMeasureData();a.checkVoiceIdx(this.opts.voiceIdx),a.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a=this.getAction();a.cancelStack=this.cancelStack,a.perform()},e.getAction=function(){if(null===this.action){var a=this.getTimePos(),b=this.getDpq(),d={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,placement:this.opts.placement,timePos:a,dpq:b,style:this.opts.style,sound:this.opts.sound};this.action=new c(this.scoreData,d,null)}return this.action},e.getTimePos=function(){for(var b=0,c=this.getMeasureData(),d=c.getVoice(this.opts.voiceIdx),e=0;e<this.opts.noteIdx;e++){var f=d.getNote(e);b+=a.getDuration(f)}return b},e.getDpq=function(){return this.getMeasureData().getDpqValue()},e.getMeasureData=function(){if(null===this.measureData){var a=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx);this.measureData=new b(a)}return this.measureData}}.call(this),function(){"use strict";var a=Adagio.edit.common.getCommonContent,b=Adagio.edit.primitive.AddEnding=function(a,b,c){this.init(a,b,c)};b.NAME="primitive.AddEnding";var c=b.prototype;c.name=b.NAME,c.init=function(b,c,d){this.commonContent=a(b),this.cancelStack=d,this.opts=c},c.perform=function(){this.addEnding(),this.updateStack()},c.addEnding=function(){var a=this.opts.numbers.slice();this.commonContent.setEnding(this.opts.measureIdx,a)},c.updateStack=function(){var a=this.opts.numbers.slice(),b={type:this.name,opts:{measureIdx:this.opts.measureIdx,partIdx:0,numbers:a}};this.cancelStack.push(b)}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.NoEndingError=function(){var b=c(),d=a.call(this,b);return this.name=d.name="NoEndingError",this.stack=d.stack,this.message=d.message,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(){return"There is no repeat ending at this location."}}.call(this),function(){"use strict";var a=Adagio.edit.common.getCommonContent,b=Adagio.edit.primitive.RemoveEnding=function(a,b,c){this.init(a,b,c)};b.NAME="primitive.RemoveEnding";var c=b.prototype;c.name=b.NAME,c.init=function(b,c,d){this.commonContent=a(b),this.cancelStack=d,this.opts=c},c.perform=function(){var a=this.getNumbers();this.removeEnding(),this.updateStack(a)},c.getNumbers=function(){return this.commonContent.getEnding(this.opts.measureIdx)},c.removeEnding=function(){this.commonContent.removeEnding(this.opts.measureIdx)},c.updateStack=function(a){a=a.slice();var b={type:this.name,opts:{partIdx:0,measureIdx:this.opts.measureIdx,removedNumbers:a}};this.cancelStack.push(b)}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadMeasureIdxError,b=Adagio.Error.client.NoEndingError,c=Adagio.edit.primitive.RemoveEnding,d=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,e=Adagio.edit.action.RemoveEnding=function(a,b,c){this.init(a,b,c)};e.NAME="action.RemoveEnding";var f=e.prototype;f.name=e.NAME,f.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,d(this.scoreData,b),this.location=null},f.checkPreconditions=function(){this.checkLocation(),this.checkHasEnding()},f.checkLocation=function(){var b=this.scoreData.getNbMeasures(),c=this.opts.measureIdx;if(c<0||c>=b)throw new a(c,a.GET)},f.checkHasEnding=function(){if(!this.scoreData.getCommonContent().hasEnding(this.opts.measureIdx))throw new b},f.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a=this.getPreviousData();this.storeAction(),this.removeEnding(),this.updateStack(a)},f.getPreviousData=function(){var a=this.scoreData.getCommonContent(),b=a.getEnding(this.opts.measureIdx);return b=b.slice(),{numbers:b}},f.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{measureUuid:a.measureUuid}};this.cancelStack.storeAction(b)}},f.removeEnding=function(){var a={measureIdx:this.opts.measureIdx};new c(this.scoreData,a,this.cancelStack).perform()},f.updateStack=function(a){var b=this.getLocation(),c=a.numbers.slice(),d={type:this.name,noDraw:!0,opts:{measureUuid:b.measureUuid,numbers:c}};this.cancelStack.push(d)},f.getLocation=function(){if(null===this.location){var a=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={measureUuid:a}}return this.location}}.call(this),function(){"use strict";var a=Adagio.edit.primitive.AddEnding,b=Adagio.edit.action.RemoveEnding,c=Adagio.edit.composite.AddEnding=function(a,b,c){this.init(a,b,c)};c.NAME="composite.AddEnding";var d=c.prototype;d.name=c.NAME,d.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.hasFormerEnding()&&this.removeFormerEnding(),this.addEnding()},d.hasFormerEnding=function(){return this.scoreData.getCommonContent().hasEnding(this.opts.measureIdx)},d.removeFormerEnding=function(){var a={measureIdx:this.opts.measureIdx};new b(this.scoreData,a,this.cancelStack).perform()},d.addEnding=function(){var b=this.opts.numbers.slice(),c={measureIdx:this.opts.measureIdx,numbers:b};new a(this.scoreData,c,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadMeasureIdxError,b=Adagio.Utils.endingUtils,c=Adagio.edit.composite.AddEnding,d=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,e=Adagio.edit.action.AddEnding=function(a,b,c){this.init(a,b,c)};e.NAME="action.AddEnding";var f=e.prototype;f.name=e.NAME,f.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,d(a,b),this.location=null},f.checkPreconditions=function(){this.checkLocation(),b.checkNumbers(this.opts.numbers)},f.checkLocation=function(){var b=this.scoreData.getNbMeasures(),c=this.opts.measureIdx;if(c<0||c>=b)throw new a(c,a.GET)},f.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.addEnding(),this.updateStack()},f.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b=this.opts.numbers.slice(),c={actionName:this.name,opts:{measureUuid:a.measureUuid,numbers:b}};this.cancelStack.storeAction(c)}},f.addEnding=function(){var a=this.opts.numbers.slice(),b={measureIdx:this.opts.measureIdx,numbers:a};new c(this.scoreData,b,this.cancelStack).perform()},f.updateStack=function(){var a=this.getLocation(),b=this.opts.numbers.slice(),c={type:this.name,noDraw:!0,opts:{measureUuid:a.measureUuid,numbers:b}};this.cancelStack.push(c)},f.getLocation=function(){if(null===this.location){var a=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={measureUuid:a}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.edit.common.getNoteAtPitch,c=Adagio.edit.common.initMeasureData,d=Adagio.edit.primitive.AddFingering=function(a,b,c){this.init(a,b,c)};d.NAME="primitive.AddFingering";var e=d.prototype;e.initMeasureData=c,e.name=d.NAME,e.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},e.perform=function(){this.addFingering(),this.updateStack()},e.addFingering=function(){var c=this.measureData.getVoice(this.opts.voiceIdx),d=b(c,this.opts.noteIdx,this.opts.pitch);a.setFingering(d,this.opts.fingering)},e.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.pitchUtils,c=Adagio.edit.primitive.AddFingering,d=Adagio.edit.action.RemoveFingering,e=Adagio.edit.common.assertPerform,f=Adagio.edit.common.getNoteAtPitch,g=Adagio.edit.common.initMeasureData,h=Adagio.edit.composite.AddFingering=function(a,b,c){this.init(a,b,c)};h.NAME="primitive.AddFingering";var i=h.prototype;i.initMeasureData=g,i.name=h.NAME,i.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},i.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.hasFormerFingering()&&this.removeFormerFingering(),this.addFingering()},i.hasFormerFingering=function(){var b=this.measureData.getVoice(this.opts.voiceIdx),c=f(b,this.opts.noteIdx,this.opts.pitch);return a.hasFingering(c)},i.removeFormerFingering=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:b.copy(this.opts.pitch)},c=new d(this.measureData,a,this.cancelStack);e(c)},i.addFingering=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:b.copy(this.opts.pitch),fingering:this.opts.fingering};new c(this.measureData,a,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.noChange.NoChangeError,b=Adagio.Error.client.NotPossibleOnUnpitchedError,c=Adagio.Error.client.PitchCollisionError,d=Adagio.Utils.noteUtils,e=Adagio.Utils.pitchUtils,f=Adagio.Values.Fingering,g=Adagio.edit.composite.AddFingering,h=Adagio.edit.common.getNoteAtPitch,i=Adagio.edit.common.checkOptsPitch,j=Adagio.edit.common.convertLineToPitch,k=Adagio.edit.common.convertTimePosToGetNoteIdx,l=Adagio.edit.common.convertPartUuidToGetPartIdx,m=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,n=Adagio.edit.common.transposePitchLineOpts,o=Adagio.edit.common.initMeasureData,p=Adagio.edit.action.AddFingering=function(a,b,c){this.init(a,b,c)};p.NAME="action.AddFingerings",p.isNoChange=function(b){return b instanceof a};var q=p.prototype;q.name=p.NAME,q.initMeasureData=o,q.init=function(a,b,c){l(a,b),m(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.noteHead=null,this.voice=null,this.location=null},q.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),k(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),this.checkValues(),this.sanitizeIfNeeded(),this.checkNoteAtPitch(),this.checkDifferentFingering()},q.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new b},q.checkValues=function(){i(this.opts),f.check(this.opts.fingering)},q.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},q.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},q.sanitizeIfNeeded=function(){void 0!==this.opts.line&&j(this.measureData,this.opts,!0),this.opts.isConcertPitch&&n(this.measureData,this.opts)},q.checkNoteAtPitch=function(){if(void 0===this.getNoteAtPitch()){var a=e.copy(this.opts.pitch);throw new c(c.action.GET,a)}},q.checkDifferentFingering=function(){var b=this.getNoteAtPitch();if(d.hasFingering(b)){if(d.getFingering(b)===this.opts.fingering)throw new a}},q.getNoteAtPitch=function(){if(null===this.noteHead){var a=this.getVoice();this.noteHead=h(a,this.opts.noteIdx,this.opts.pitch)}return this.noteHead},q.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.addFingering(),this.updateStack()},q.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos,pitch:e.copyWithoutAlter(this.opts.pitch),isConcertPitch:!1,fingering:this.opts.fingering},c={actionName:this.name,opts:b};this.cancelStack.storeAction(c)}},q.addFingering=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:e.copy(this.opts.pitch),fingering:this.opts.fingering};new g(this.measureData,a,this.cancelStack).perform()},q.updateStack=function(){var a=this.getLocation(),b={partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos,pitch:e.copyWithoutAlter(this.opts.pitch)},c={type:this.name,noDraw:!0,opts:b};this.cancelStack.push(c)},q.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.getVoice(),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f,isConcertPitch:!1}}return this.location},q.getVoice=function(){return null===this.voice&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.noteUtils,c=Adagio.Utils.pitchUtils,d=Adagio.edit.common.getGraceAtPitch,e=Adagio.edit.common.initMeasureData,f=Adagio.edit.primitive.SetGraceAlter=function(a,b,c){this.init(a,b,c)};f.NAME="primitive.SetGraceAlter";var g=f.prototype;g.initMeasureData=e,g.name=f.NAME,g.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},g.perform=function(){var a=this.getGraceAtPitch(),d=c.getAlter(this.opts.pitch);b.setAlter(a,d),this.updateStack()},g.getGraceAtPitch=function(){var b=this.measureData.getVoice(this.opts.voiceIdx),c=d(b,this.opts.noteIdx,this.opts.graceIdx,this.opts.pitch);if(void 0===c)throw new a("NoGraceAtPitch");return c},g.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.pitchUtils,c=Adagio.edit.composite.UpdateGraceAccidental,d=Adagio.edit.primitive.SetGraceAlter,e=Adagio.edit.common.getGraceAtPitch,f=Adagio.edit.common.initMeasureData,g=Adagio.edit.composite.SetGraceAccidental=function(a,b,c){this.init(a,b,c)};g.NAME="composite.SetGraceAccidental";var h=g.prototype;h.initMeasureData=f,h.name=g.NAME,h.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},h.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.setAlter(),this.updateAccidental()},h.setAlter=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,pitch:b.copy(this.opts.pitch)};new d(this.measureData,a,this.cancelStack).perform()},h.updateAccidental=function(){var d=this.getGraceAtPitch(),e=a.getStaffIdx(d),f={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:e,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,pitch:b.copy(this.opts.pitch)};new c(this.measureData,f,this.cancelStack).perform()},h.getGraceAtPitch=function(){var a=this.measureData.getVoice(this.opts.voiceIdx);return e(a,this.opts.noteIdx,this.opts.graceIdx,this.opts.pitch)}}.call(this),function(){"use strict";var a=Adagio.Utils.pitchUtils,b=Adagio.Utils.noteUtils,c=Adagio.edit.common.getPreviousAlter,d=Adagio.edit.common.getGraceAtPitch;Adagio.edit.common.fillGraceOptsAlter=function(b,d){var f;if(null!==d.accidental)f=a.accidentalToAlter(d.accidental);else{var g=e(b,d);f=c(b,d.noteIdx,d.voiceIdx,g,d.pitch,d.graceIdx)}a.setAlter(d.pitch,f)};var e=function(a,c){if(void 0!==c.staffIdx)return c.staffIdx;var e=a.getVoice(c.voiceIdx),f=d(e,c.noteIdx,c.graceIdx,c.pitch);return b.getStaffIdx(f)}}.call(this),function(){"use strict";var a=Adagio.Error.noChange.NoChangeError,b=Adagio.Error.client.NotPossibleOnUnpitchedError,c=Adagio.Error.client.PitchCollisionError,d=Adagio.Utils.noteUtils,e=Adagio.Utils.pitchUtils,f=Adagio.Values.AccidentalStyle,g=Adagio.edit.composite.SetGraceAccidental,h=Adagio.edit.common.getGraceAtPitch,i=Adagio.edit.common.checkOptsPitch,j=Adagio.edit.common.convertLineToPitch,k=Adagio.edit.common.fillGraceOptsAlter,l=Adagio.edit.common.convertTimePosToGetNoteIdx,m=Adagio.edit.common.convertPartUuidToGetPartIdx,n=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,o=Adagio.edit.common.transposePitchAccidentalOpts,p=Adagio.edit.common.initMeasureData,q=Adagio.edit.action.AddGraceAccidental=function(a,b,c){this.init(a,b,c)};q.NAME="action.AddGraceAccidental",q.isNoChange=function(b){return b instanceof a};var r=q.prototype;r.name=q.NAME,r.initMeasureData=p,r.init=function(a,b,c){m(a,b),n(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.sanitized=!1,this.voice=null,this.graceAtPitch=null,this.location=null},r.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),l(this.measureData,this.opts),this.checkGraceIdx(),this.checkValues(),this.sanitizeIfNeeded(),this.checkPitch(),this.checkNoteAtPitch(),this.checkAlterDifferent()},r.checkValues=function(){i(this.opts),null!==this.opts.accidental&&f.check(this.opts.accidental)},r.checkPitch=function(){e.check(this.opts.pitch)},r.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new b},r.checkGraceIdx=function(){this.getVoice().checkGraceIdx(this.opts.noteIdx,this.opts.graceIdx)},r.getVoice=function(){return null===this.voice&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},r.checkNoteAtPitch=function(){if(void 0===this.getGraceAtPitch()){var a=e.copy(this.opts.pitch);throw new c(c.action.GET,a)}},r.checkAlterDifferent=function(){var b=this.getCurrentAlter();if(e.getAlter(this.opts.pitch)===b)throw new a},r.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),l(this.measureData,this.opts),this.sanitizeIfNeeded(),this.storeAction();var a=this.getNoteData();this.addGraceAccidental(),this.updateStack(a)},r.sanitizeIfNeeded=function(){this.sanitized||(void 0!==this.opts.line&&j(this.measureData,this.opts,!0),this.opts.isConcertPitch&&o(this.measureData,this.opts),this.checkNoteAtPitch(),k(this.measureData,this.opts),this.sanitized=!0)},r.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos,graceIdx:this.opts.graceIdx,pitch:e.copyWithoutAlter(this.opts.pitch),accidental:this.opts.accidental}};this.cancelStack.storeAction(b)}},r.getNoteData=function(){var a=this.getCurrentAlter();return{accidental:e.alterToAccidental(a)}},r.getCurrentAlter=function(){var a=this.getGraceAtPitch(),b=d.getPitch(a);return e.getAlter(b)},r.getGraceAtPitch=function(){if(null===this.graceAtPitch){var a=this.getVoice();this.graceAtPitch=h(a,this.opts.noteIdx,this.opts.graceIdx,this.opts.pitch)}return this.graceAtPitch},r.addGraceAccidental=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,pitch:e.copy(this.opts.pitch)};new g(this.measureData,a,this.cancelStack).perform()},r.updateStack=function(a){var b=this.getLocation(),c={type:this.name,noDraw:!0,opts:{partUuid:b.partUuid,measureUuid:b.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:b.dpq,timePos:b.timePos,graceIdx:this.opts.graceIdx,pitch:e.copyWithoutAlter(this.opts.pitch),previousAccidental:a.accidental}};this.cancelStack.push(c)},r.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.pitchUtils,c=Adagio.edit.common.initMeasureData,d=Adagio.edit.primitive.AddGraceToChord=function(a,b,c){this.init(a,b,c)};d.NAME="primitive.AddGraceToChord";var e=d.prototype;e.name=d.NAME,e.initMeasureData=c,e.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},e.perform=function(){var a=this.getVoice(),b=a.getGrace(this.opts.noteIdx,this.opts.graceIdx),c=this.createNote(b);a.addGraceToChord(c,this.opts.noteIdx,this.opts.graceIdx),this.updateStack()},e.getVoice=function(){var a=this.opts.voiceIdx;return this.measureData.getVoice(a)},e.createNote=function(c){var d=a.getDurationType(c),e={};a.makeGrace(e),a.setDuration(e,0),a.setStaffIdx(e,this.opts.staffIdx),a.setVoiceIdx(e,this.opts.voiceIdx),a.setDurationType(e,d);var f=b.copy(this.opts.pitch);return a.setPitch(e,f),e},e.updateStack=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx},b={type:this.name,opts:a};this.cancelStack.push(b)}}.call(this),function(){"use strict";var a=Adagio.Utils.pitchUtils,b=Adagio.edit.primitive.AddGraceToChord,c=Adagio.edit.composite.UpdateGraceAccidental,d=Adagio.edit.common.initMeasureData,e=Adagio.edit.composite.AddGraceToChord=function(a,b,c){this.init(a,b,c)};e.NAME="composite.AddGraceToChord";var f=e.prototype;f.name=e.NAME,f.initMeasureData=d,f.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},f.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.addGraceToChord(),this.updateAccidental()},f.getVoice=function(){var a=this.opts.voiceIdx;return this.measureData.getVoice(a)},f.addGraceToChord=function(){var c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,pitch:a.copy(this.opts.pitch)};new b(this.measureData,c,this.cancelStack).perform()},f.updateAccidental=function(){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,pitch:a.copy(this.opts.pitch)};new c(this.measureData,b,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.client.NotPossibleOnUnpitchedError,b=Adagio.Error.client.PitchCollisionError,c=Adagio.Utils.pitchUtils,d=Adagio.Values.AccidentalStyle,e=Adagio.edit.common.checkOptsPitch,f=Adagio.edit.common.fillGraceOptsAlter,g=Adagio.edit.common.convertLineToPitch,h=Adagio.edit.common.checkCompatibleVoiceStaffIdx,i=Adagio.edit.common.checkLineOverflow,j=Adagio.edit.common.convertPartUuidToGetPartIdx,k=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,l=Adagio.edit.common.convertTimePosToGetNoteIdx,m=Adagio.edit.common.transposePitchAccidentalOpts,n=Adagio.edit.common.getGraceAtPitch,o=Adagio.edit.composite.AddGraceToChord,p=Adagio.edit.common.initMeasureData,q=Adagio.edit.action.AddGraceToChord=function(a,b,c){this.init(a,b,c)};q.NAME="action.AddGraceToChord";var r=q.prototype;r.name=q.NAME,r.initMeasureData=p,r.init=function(a,b,c){j(a,b),k(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,l(this.measureData,this.opts),this.sanitized=!1,this.location=null},r.checkPreconditions=function(){this.checkValues(),this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkCompatibleVoiceStaffIdx(),this.measureData.getVoice(this.opts.voiceIdx).checkGraceIdx(this.opts.noteIdx,this.opts.graceIdx),this.sanitizeIfNeeded(),this.checkPitch(),this.opts.checkLine&&i(this.measureData,this.opts),this.checkPitchCollision()},r.checkValues=function(){e(this.opts),null!==this.opts.accidental&&d.check(this.opts.accidental)},r.checkPitch=function(){c.check(this.opts.pitch)},r.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new a},r.checkCompatibleVoiceStaffIdx=function(){h(this.measureData,this.opts)},r.checkPitchCollision=function(){var a=this.measureData.getVoice(this.opts.voiceIdx);if(void 0!==n(a,this.opts.noteIdx,this.opts.graceIdx,this.opts.pitch)){var d=c.copy(this.opts.pitch);throw new b(b.action.INSERT,d)}},r.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded(),this.storeAction(),this.addGraceToChord(),this.updateStack()},r.sanitizeIfNeeded=function(){this.sanitized||(void 0!==this.opts.line&&g(this.measureData,this.opts,!0),this.opts.isConcertPitch&&m(this.measureData,this.opts),f(this.measureData,this.opts),void 0===this.opts.checkLine&&(this.opts.checkLine=!0),this.sanitized=!0)},r.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,graceIdx:this.opts.graceIdx,timePos:a.timePos,divisions:a.dpq,pitch:c.copyWithoutAlter(this.opts.pitch),accidental:this.opts.accidental,checkLine:this.opts.checkLine}};this.cancelStack.storeAction(b)}},r.addGraceToChord=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,pitch:c.copy(this.opts.pitch)};new o(this.measureData,a,this.cancelStack).perform()},r.updateStack=function(){var a=this.getLocation(),b={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,timePos:a.timePos,divisions:a.dpq,graceIdx:this.opts.graceIdx,pitch:c.copyWithoutAlter(this.opts.pitch)}};this.cancelStack.push(b)},r.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.unpitchedUtils,c=Adagio.edit.common.initMeasureData,d=Adagio.edit.common.getMIDIUnpitched,e=Adagio.edit.primitive.AddGraceToChordPercu=function(a,b,c){this.init(a,b,c)};e.NAME="primitive.AddGraceToChordPercu";var f=e.prototype;f.name=e.NAME,f.initMeasureData=c,f.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},f.perform=function(){var a=this.getVoice(),b=a.getGrace(this.opts.noteIdx,this.opts.graceIdx),c=this.createNote(b);a.addGraceToChord(c,this.opts.noteIdx,this.opts.graceIdx),this.updateStack()},f.getVoice=function(){var a=this.opts.voiceIdx;return this.measureData.getVoice(a)},f.createNote=function(c){var d=a.getDurationType(c),e={};a.makeGrace(e),a.setDuration(e,0),a.setStaffIdx(e,this.opts.staffIdx),a.setVoiceIdx(e,this.opts.voiceIdx),a.setDurationType(e,d);var f=b.copy(this.opts.unpitched);a.setUnpitched(e,f),a.setHead(e,this.opts.notehead);var g=this.getInstrumentId();return a.setInstrumentId(e,g),e},f.getInstrumentId=function(){var a=d(this.measureData,this.opts.partIdx,this.opts.unpitched,this.opts.notehead);return this.measureData.searchUnpitchedInstrumentId(a)},f.updateStack=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx},b={type:this.name,opts:a};this.cancelStack.push(b)}}.call(this),function(){"use strict";var a=Adagio.Error.client.UnpitchedCollisionError,b=Adagio.Utils.unpitchedUtils,c=Adagio.Utils.staffDetailsUtils,d=Adagio.edit.common.convertLineToUnpitched,e=Adagio.edit.common.checkCompatibleVoiceStaffIdx,f=Adagio.edit.common.checkUnpitchedMeasure,g=Adagio.edit.common.convertPartUuidToGetPartIdx,h=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,i=Adagio.edit.common.convertTimePosToGetNoteIdx,j=Adagio.edit.common.getGraceAtUnpitched,k=Adagio.edit.common.checkUnpitchedInstrument,l=Adagio.edit.common.getDefaultMIDIHead,m=Adagio.edit.primitive.AddGraceToChordPercu,n=Adagio.edit.common.initMeasureData,o=Adagio.edit.action.AddGraceToChordPercu=function(a,b,c){this.init(a,b,c)};o.NAME="action.AddGraceToChordPercu";var p=o.prototype;p.name=o.NAME,p.initMeasureData=n,p.init=function(a,b,c){g(a,b),h(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,i(this.measureData,this.opts),
this.sanitized=!1,this.location=null},p.checkPreconditions=function(){this.checkUnpitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkCompatibleVoiceStaffIdx(),this.measureData.getVoice(this.opts.voiceIdx).checkGraceIdx(this.opts.noteIdx,this.opts.graceIdx),this.sanitizeIfNeed(),this.checkInstrument(),this.checkPitchCollision()},p.checkUnpitchedPart=function(){f(this.measureData)},p.checkCompatibleVoiceStaffIdx=function(){e(this.measureData,this.opts)},p.checkPitchCollision=function(){var d=this.measureData.getVoice(this.opts.voiceIdx);if(void 0!==j(d,this.opts.noteIdx,this.opts.graceIdx,this.opts.unpitched)){var e=b.copy(this.opts.unpitched),f=this.measureData.getStaffDetails(this.opts.staffIdx),g=c.getNbStaffLines(f);throw new a(a.INSERT,e,g)}},p.checkInstrument=function(){k(this.measureData,this.opts)},p.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeed(),this.fillHeadIfMissing(),this.storeAction(),this.addGraceToChord(),this.updateStack()},p.sanitizeIfNeed=function(){this.sanitized||(void 0!==this.opts.line&&d(this.measureData,this.opts),this.sanitized=!0)},p.fillHeadIfMissing=function(){void 0===this.opts.notehead&&(this.opts.notehead=l(this.measureData,this.opts.partIdx,this.opts.unpitched))},p.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),c={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,graceIdx:this.opts.graceIdx,timePos:a.timePos,divisions:a.dpq,unpitched:b.copy(this.opts.unpitched),notehead:this.opts.notehead}};this.cancelStack.storeAction(c)}},p.addGraceToChord=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,unpitched:b.copy(this.opts.unpitched),notehead:this.opts.notehead};new m(this.measureData,a,this.cancelStack).perform()},p.updateStack=function(){var a=this.getLocation(),c={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,timePos:a.timePos,divisions:a.dpq,graceIdx:this.opts.graceIdx,unpitched:b.copy(this.opts.unpitched)}};this.cancelStack.push(c)},p.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Utils.typeUtils,b=Adagio.Utils.noteUtils,c=Adagio.edit.common.initMeasureData,d=Adagio.edit.primitive.ChangeGraceDuration=function(a,b,c){this.init(a,b,c)};d.NAME="primitive.ChangeGraceDuration";var e=d.prototype;e.name=d.NAME,e.initMeasureData=c,e.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.changeGraceDuration(),this.updateStack()},e.changeGraceDuration=function(){var b=this.measureData.getVoice(this.opts.voiceIdx),c=b.getGraceChord(this.opts.noteIdx,this.opts.graceIdx);c=a.makeArray(c),c.forEach(this.setHeadDuration,this)},e.setHeadDuration=function(a){b.setDurationType(a,this.opts.durationType)},e.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Values.DurationType,c=Adagio.edit.primitive.ChangeGraceDuration,d=Adagio.edit.action.RemoveGraceSlash,e=Adagio.edit.common.assertPerform,f=Adagio.edit.common.initMeasureData,g=Adagio.edit.composite.ChangeGraceDuration=function(a,b,c){this.init(a,b,c)};g.NAME="primitive.ChangeGraceDuration";var h=g.prototype;h.name=g.NAME,h.initMeasureData=f,h.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},h.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeSlashIfNeeded(),this.changeGraceDuration()},h.removeSlashIfNeeded=function(){this.needRemoveSlash()&&this.removeSlash()},h.needRemoveSlash=function(){if(this.opts.durationType===b.EIGHT)return!1;var c=this.measureData.getVoice(this.opts.voiceIdx),d=c.getGrace(this.opts.noteIdx,this.opts.graceIdx);return a.isSlashedGrace(d)},h.removeSlash=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx},b=new d(this.measureData,a,this.cancelStack);e(b)},h.changeGraceDuration=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,durationType:this.opts.durationType};new c(this.measureData,a,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.noChange.NoChangeError,b=Adagio.Utils.noteUtils,c=Adagio.Values.DurationType,d=Adagio.edit.common.convertPartUuidToGetPartIdx,e=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,f=Adagio.edit.common.convertTimePosToGetNoteIdx,g=Adagio.edit.composite.ChangeGraceDuration,h=Adagio.edit.common.initMeasureData,i=Adagio.edit.action.ChangeGraceDuration=function(a,b,c){this.init(a,b,c)};i.NAME="action.ChangeGraceDuration";var j=i.prototype;j.name=i.NAME,j.initMeasureData=h,j.init=function(a,b,c){d(a,b),e(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,f(this.measureData,this.opts),this.location=null},j.checkPreconditions=function(){this.checkValues(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.measureData.getVoice(this.opts.voiceIdx).checkGraceIdx(this.opts.noteIdx,this.opts.graceIdx),this.checkDifferentDuration()},j.checkValues=function(){c.check(this.opts.durationType)},j.checkDifferentDuration=function(){if(this.getCurrentDurationType()===this.opts.durationType)throw new a},j.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a=this.getNoteData();this.changeGraceDuration(),this.updateStack(a)},j.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,timePos:a.timePos,divisions:a.dpq,graceIdx:this.opts.graceIdx,durationType:this.opts.durationType}};this.cancelStack.storeAction(b)}},j.getNoteData=function(){return{durationType:this.getCurrentDurationType()}},j.getCurrentDurationType=function(){var a=this.getVoice(),c=a.getGrace(this.opts.noteIdx,this.opts.graceIdx);return b.getDurationType(c)},j.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},j.changeGraceDuration=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,durationType:this.opts.durationType};new g(this.measureData,a,this.cancelStack).perform()},j.updateStack=function(a){var b=this.getLocation(),c={type:this.name,noDraw:!0,opts:{partUuid:b.partUuid,measureUuid:b.measureUuid,voiceIdx:this.opts.voiceIdx,timePos:b.timePos,divisions:b.dpq,graceIdx:this.opts.graceIdx,oldDurationType:a.durationType,newDurationType:this.opts.durationType}};this.cancelStack.push(c)},j.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.noteUtils,c=Adagio.Values.DurationType,d=Adagio.edit.common.initMeasureData,e=Adagio.edit.primitive.AddGraceSlash=function(a,b,c){this.init(a,b,c)};e.NAME="primitive.AddGraceSlash";var f=e.prototype;f.initMeasureData=d,f.name=e.NAME,f.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},f.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.addGraceSlash(),this.updateStack()},f.addGraceSlash=function(){var d=this.measureData.getVoice(this.opts.voiceIdx),e=d.getGrace(this.opts.noteIdx,this.opts.graceIdx);if(b.getDurationType(e)!==c.EIGHT)throw new a("EighthExpected","Only eighth grace notes can be slashed.");b.makeSlashedGrace(e)},f.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Values.DurationType,c=Adagio.edit.action.ChangeGraceDuration,d=Adagio.edit.primitive.AddGraceSlash,e=Adagio.edit.common.assertPerform,f=Adagio.edit.common.initMeasureData,g=Adagio.edit.composite.AddGraceSlash=function(a,b,c){this.init(a,b,c)};g.NAME="primitive.AddGraceSlash";var h=g.prototype;h.initMeasureData=f,h.name=g.NAME,h.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},h.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.changeDurationIfNeeded(),this.addGraceSlash()},h.changeDurationIfNeeded=function(){this.needChangeDuration()&&this.changeDuration()},h.needChangeDuration=function(){var c=this.measureData.getVoice(this.opts.voiceIdx),d=c.getGrace(this.opts.noteIdx,this.opts.graceIdx);return a.getDurationType(d)!==b.EIGHT},h.changeDuration=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,durationType:b.EIGHT},d=new c(this.measureData,a,this.cancelStack);e(d)},h.addGraceSlash=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx};new d(this.measureData,a,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.noChange.NoChangeError,b=Adagio.Utils.noteUtils,c=Adagio.edit.composite.AddGraceSlash,d=Adagio.edit.common.convertTimePosToGetNoteIdx,e=Adagio.edit.common.convertPartUuidToGetPartIdx,f=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,g=Adagio.edit.common.initMeasureData,h=Adagio.edit.action.AddGraceSlash=function(a,b,c){this.init(a,b,c)};h.NAME="action.AddGraceSlash",h.isNoChange=function(b){return b instanceof a};var i=h.prototype;i.name=h.NAME,i.initMeasureData=g,i.init=function(a,b,c){e(a,b),f(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.sanitized=!1,this.voice=null,this.graceAtPitch=null,this.location=null},i.checkPreconditions=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx),d(this.measureData,this.opts),this.checkGraceIdx(),this.checkNoSlash()},i.checkGraceIdx=function(){this.getVoice().checkGraceIdx(this.opts.noteIdx,this.opts.graceIdx)},i.checkNoSlash=function(){var c=this.getVoice(),d=c.getGrace(this.opts.noteIdx,this.opts.graceIdx);if(b.isSlashedGrace(d))throw new a},i.getVoice=function(){return null===this.voice&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},i.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.addGraceSlash(),this.updateStack()},i.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos,graceIdx:this.opts.graceIdx}};this.cancelStack.storeAction(b)}},i.addGraceSlash=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx};new c(this.measureData,a,this.cancelStack).perform()},i.updateStack=function(){var a=this.getLocation(),b={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos,graceIdx:this.opts.graceIdx}};this.cancelStack.push(b)},i.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.edit.common.initMeasureData,c=Adagio.edit.common.getNoteAtPitch,d=Adagio.edit.primitive.AddGhostNote=function(a,b,c){this.init(a,b,c)};d.NAME="primitive.AddGhostNote";var e=d.prototype;e.name=d.NAME,e.initMeasureData=b,e.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},e.perform=function(){this.addGhostNote(),this.updateStack()},e.addGhostNote=function(){var b=this.measureData.getVoice(this.opts.voiceIdx),d=c(b,this.opts.noteIdx,this.opts.pitch);a.addHeadParentheses(d)},e.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.Error.noChange.NoChangeError,b=Adagio.Error.client.NotPossibleOnUnpitchedError,c=Adagio.Error.client.PitchCollisionError,d=Adagio.Utils.noteUtils,e=Adagio.Utils.pitchUtils,f=Adagio.edit.primitive.AddGhostNote,g=Adagio.edit.common.getNoteAtPitch,h=Adagio.edit.common.checkOptsPitch,i=Adagio.edit.common.convertLineToPitch,j=Adagio.edit.common.convertTimePosToGetNoteIdx,k=Adagio.edit.common.convertPartUuidToGetPartIdx,l=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,m=Adagio.edit.common.transposePitchLineOpts,n=Adagio.edit.common.initMeasureData,o=Adagio.edit.action.AddGhostNote=function(a,b,c){this.init(a,b,c)};o.NAME="action.AddGhostNotes",o.isNoChange=function(b){return b instanceof a};var p=o.prototype;p.name=o.NAME,p.initMeasureData=n,p.init=function(a,b,c){k(a,b),l(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.sanitized=!1,this.noteHead=null,this.voice=null,this.location=null},p.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),j(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),this.checkValues(),this.sanitizeIfNeeded(),this.checkPitch(),this.checkNoteAtPitch(),this.checkNoGhost()},p.checkValues=function(){h(this.opts)},p.checkPitch=function(){e.check(this.opts.pitch)},p.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new b},p.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},p.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},p.checkNoteAtPitch=function(){if(void 0===this.getNoteAtPitch()){var a=e.copy(this.opts.pitch);throw new c(c.action.GET,a)}},p.checkNoGhost=function(){var b=this.getNoteAtPitch();if(d.hasHeadParentheses(b))throw new a},p.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),j(this.measureData,this.opts),this.sanitizeIfNeeded(),this.storeAction(),this.removeGhostNote(),this.updateStack()},p.sanitizeIfNeeded=function(){this.sanitized||(void 0!==this.opts.line&&i(this.measureData,this.opts,!0),this.opts.isConcertPitch&&m(this.measureData,this.opts),this.checkNoteAtPitch(),this.sanitized=!0)},p.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos,pitch:e.copyWithoutAlter(this.opts.pitch)},c={actionName:this.name,opts:b};this.cancelStack.storeAction(c)}},p.removeGhostNote=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:e.copy(this.opts.pitch)};new f(this.measureData,a,this.cancelStack).perform()},p.getNoteAtPitch=function(){if(null===this.noteHead){var a=this.getVoice();this.noteHead=g(a,this.opts.noteIdx,this.opts.pitch)}return this.noteHead},p.updateStack=function(){var a=this.getLocation(),b={partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos,pitch:e.copyWithoutAlter(this.opts.pitch)},c={type:this.name,noDraw:!0,opts:b};this.cancelStack.push(c)},p.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location},p.getVoice=function(){return null===this.voice&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.edit.common.initMeasureData,c=Adagio.edit.common.getNoteAtUnpitched,d=Adagio.edit.primitive.AddGhostNotePercu=function(a,b,c){this.init(a,b,c)};d.NAME="primitive.AddGhostNotePercu";var e=d.prototype;e.name=d.NAME,e.initMeasureData=b,e.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},e.perform=function(){this.addGhostNotePercu(),this.updateStack()},e.addGhostNotePercu=function(){var b=this.measureData.getVoice(this.opts.voiceIdx),d=c(b,this.opts.noteIdx,this.opts.unpitched);a.addHeadParentheses(d)},e.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.Error.noChange.NoChangeError,b=Adagio.Error.client.UnpitchedCollisionError,c=Adagio.Utils.noteUtils,d=Adagio.Utils.unpitchedUtils,e=Adagio.Utils.staffDetailsUtils,f=Adagio.edit.primitive.AddGhostNotePercu,g=Adagio.edit.common.getNoteAtUnpitched,h=Adagio.edit.common.convertLineToUnpitched,i=Adagio.edit.common.convertTimePosToGetNoteIdx,j=Adagio.edit.common.convertPartUuidToGetPartIdx,k=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,l=Adagio.edit.common.checkUnpitchedMeasure,m=Adagio.edit.common.initMeasureData,n=Adagio.edit.action.AddGhostNotePercu=function(a,b,c){this.init(a,b,c)};n.NAME="action.AddGhostNotePercus",n.isNoChange=function(b){return b instanceof a};var o=n.prototype;o.name=n.NAME,o.initMeasureData=m,o.init=function(a,b,c){j(a,b),k(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.noteHead=null,this.voice=null,this.location=null},o.checkPreconditions=function(){this.checkUnpitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),i(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),this.sanitizeIfNeeded(),this.checkNoteAtUnpitched(),this.checkNoGhost()},o.checkUnpitchedPart=function(){l(this.measureData)},o.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},o.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},o.sanitizeIfNeeded=function(){void 0!==this.opts.line&&h(this.measureData,this.opts)},o.checkNoteAtUnpitched=function(){if(void 0===this.getNoteAtUnpitched()){var a=d.copy(this.opts.unpitched),c=this.opts.staffIdx||0,f=this.measureData.getStaffDetails(c),g=e.getNbStaffLines(f);throw new b(b.GET,a,g)}},o.checkNoGhost=function(){var b=this.getNoteAtUnpitched();if(c.hasHeadParentheses(b))throw new a},o.getNoteAtUnpitched=function(){if(null===this.noteHead){var a=this.getVoice();this.noteHead=g(a,this.opts.noteIdx,this.opts.unpitched)}return this.noteHead},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.addGhostNotePercu(),this.updateStack()},o.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos,unpitched:d.copy(this.opts.unpitched)},c={actionName:this.name,opts:b};this.cancelStack.storeAction(c)}},o.addGhostNotePercu=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,unpitched:d.copy(this.opts.unpitched)};new f(this.measureData,a,this.cancelStack).perform()},o.updateStack=function(){var a=this.getLocation(),b={partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos,unpitched:d.copy(this.opts.unpitched)},c={type:this.name,noDraw:!0,opts:b};this.cancelStack.push(c)},o.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.getVoice(),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f,isConcertPitch:!1}}return this.location},o.getVoice=function(){return null===this.voice&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.measureUtils,c=Adagio.Utils.harmonyUtils,d=Adagio.Utils.rootUtils,e=Adagio.Utils.bassUtils,f=Adagio.Utils.degreeUtils,g=Adagio.Utils.math,h=Adagio.edit.common.optsToLocalGetTimePos,i=Adagio.edit.primitive.AddHarmony=function(a,b,c){this.init(a,b,c)};i.NAME="primitive.AddHarmony";var j=i.prototype;j.name=i.NAME,j.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.measure=null,this.harmonyIdx=null,this.localTimePos=null},j.perform=function(){var a=this.getHarmonyIdx(),b=this.createHarmony();this.addHarmony(b,a),this.updateStack()},j.getHarmonyIdx=function(){return null===this.harmonyIdx&&this.fetchHarmonyIdx(),this.harmonyIdx},j.fetchHarmonyIdx=function(){var a=this.getMeasure(),c=b.getHarmonies(a);if(c.some(this.tryHarmonyIdx,this),null===this.harmonyIdx){var d=c.length;this.harmonyIdx=d}},j.tryHarmonyIdx=function(b,d){var e=this.getLocalTimePos(),f=c.getTimePos(b);if(f<e)return!1;if(f>e)return this.harmonyIdx=d,!0;throw new a("TimePosCollision","There is already an harmony at this time position.")},j.createHarmony=function(){var a=d.copy(this.opts.root),b=c.create(a,this.opts.kind),g=this.getLocalTimePos();if(c.setTimePos(b,g),null!==this.opts.bass){var h=e.copy(this.opts.bass);c.setBass(b,h)}var i=this.opts.degrees.map(f.copy);return c.setDegrees(b,i),b},j.addHarmony=function(a,c){var d=this.getMeasure(),e=b.getHarmonies(d);e.splice(c,0,a),b.setHarmonies(d,e)},j.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(a)},j.getDpq=function(){var a=this.getMeasure();return b.getDpq(a)},j.getLocalTimePos=function(){if(null===this.localTimePos){var b=this.getMeasure();if(this.localTimePos=h(this.opts,b),!g.isInteger(this.localTimePos)){var c="At the point, the time position ["+this.localTimePos+"] should be an integer.";throw new a("IntegerExpected",c)}}return this.localTimePos},j.getMeasure=function(){return null===this.measure&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure}}.call(this),function(){"use strict";var a=Adagio.Utils.rootUtils,b=Adagio.Utils.bassUtils,c=Adagio.Utils.degreeUtils,d=Adagio.edit.primitive.AddHarmony,e=Adagio.edit.composite.AdaptDpqToPosition,f=Adagio.edit.composite.AddHarmony=function(a,b,c){this.init(a,b,c)};f.NAME="composite.AddHarmony";var g=f.prototype;g.name=f.NAME,g.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},g.perform=function(){this.updateDpq(),this.addHarmony()},g.updateDpq=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:this.opts.timePos,dpq:this.opts.dpq};new e(this.scoreData,a,this.cancelStack).perform()},g.addHarmony=function(){var b=a.copy(this.opts.root),e=h(this.opts.bass),f=this.opts.degrees.map(c.copy),g={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:this.opts.timePos,dpq:this.opts.dpq,root:b,kind:this.opts.kind,bass:e,degrees:f};new d(this.scoreData,g,this.cancelStack).perform()};var h=function(a){return null===a?a:b.copy(a)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.harmonyUtils,c=Adagio.Utils.rootUtils,d=Adagio.edit.primitive.RemoveHarmony=function(a,b,c){this.init(a,b,c)};d.NAME="primitive.RemoveHarmony";var e=d.prototype;e.name=d.NAME,e.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.measure=null},e.perform=function(){var a=this.removeHarmony();this.updateStack(a)},e.removeHarmony=function(){var b=this.getMeasure(),c=a.getHarmonies(b),d=c.splice(this.opts.harmonyIdx,1)[0];return a.setHarmonies(b,c),d},e.updateStack=function(a){var d=b.getRoot(a);d=c.copy(d);var e=b.getKindValue(a),f=b.getTimePos(a),g=this.getDpq(),h={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,harmonyIdx:this.opts.harmonyIdx,timePos:f,dpq:g,kind:e,root:d}};this.cancelStack.push(h)},e.getDpq=function(){var b=this.getMeasure();return a.getDpq(b)},e.getMeasure=function(){return null===this.measure&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure}}.call(this),function(){"use strict";var a=Adagio.Error.client.TimePosOutOfRangeError,b=Adagio.Error.client.BadTimePosError,c=Adagio.Utils.math,d=Adagio.Utils.measureUtils,e=Adagio.Utils.harmonyUtils,f=Adagio.Utils.rootUtils,g=Adagio.Utils.bassUtils,h=Adagio.Utils.degreeUtils,i=Adagio.edit.primitive.RemoveHarmony,j=Adagio.edit.common.optsToLocalGetTimePos,k=Adagio.edit.common.convertPartUuidToGetPartIdx,l=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,m=Adagio.edit.action.RemoveHarmonyAtTimePos=function(a,b,c){this.init(a,b,c)};m.NAME="action.RemoveHarmonyAtTimePos",m.isAuthorizedException=function(a){return a instanceof b};var n=m.prototype;n.name=m.NAME,n.init=function(a,b,c){k(a,b),l(a,b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.localTimePos=null,this.measure=null,this.harmonyIdx=null,this.location=null},n.performIfPossible=function(){this.isPossible()&&this.perform()},n.isPossible=function(){var a=!0;try{this.checkPreconditions()}catch(b){if(!m.isAuthorizedException(b))throw b;a=!1}return a},n.checkPreconditions=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx),this.checkTimePos(),this.checkHarmony()},n.checkTimePos=function(){var b=this.getLocalTimePos(),e=this.getMeasure(),f=d.getNbDivisions(e);if(!c.isNumber(b)||b<0||b>=f){var g=d.getDpq(e);throw new a(b,g)}},n.checkHarmony=function(){this.fetchHarmonyIdx()},n.perform=function(){this.storeAction();var a=d.getHarmonies(this.getMeasure()),b=a[this.getHarmonyIdx()],c=e.getRoot(b),f=e.getKindValue(b),g=o(b),i=e.getDegrees(b);i=i.map(h.copy),this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeHarmony(),this.updateStack(c,f,g,i)};var o=function(a){if(e.hasBass(a)){var b=e.getBass(a);return b=g.copy(b)}return null};n.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,dpq:this.opts.dpq,timePos:this.opts.timePos}};this.cancelStack.storeAction(b)}},n.removeHarmony=function(){var a=this.getHarmonyIdx(),b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,harmonyIdx:a};new i(this.scoreData,b,this.cancelStack).perform()},n.getHarmonyIdx=function(){return null!==this.harmonyIdx&&this.fetchHarmonyIdx(),this.harmonyIdx},n.fetchHarmonyIdx=function(){this.harmonyIdx=null;var a=this.getMeasure();if(d.getHarmonies(a).some(this.checkHarmonyTimePos,this),null===this.harmonyIdx){var c=this.getLocalTimePos(),e=d.getDpq(a);throw new b(c,e)}},n.checkHarmonyTimePos=function(a,b){var c=this.getLocalTimePos(),d=e.getTimePos(a);return!(d<c)&&(d===c&&(this.harmonyIdx=b),!0)},n.getLocalTimePos=function(){if(null===this.localTimePos){var a=this.getMeasure();this.localTimePos=j(this.opts,a)}return this.localTimePos},n.getMeasure=function(){return null===this.measure&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure},n.updateStack=function(a,b,c,d){var e=this.getLocation(),g={type:this.name,noDraw:!0,opts:{partUuid:e.partUuid,measureUuid:e.measureUuid,timePos:this.opts.timePos,dpq:this.opts.dpq,root:f.copy(a),kind:b,bass:c,degrees:d}};this.cancelStack.push(g)},n.getLocation=function(){if(null===this.location){var a=this.scoreData.getPartUuid(this.opts.partIdx),b=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={partUuid:a,measureUuid:b}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Utils.rootUtils,b=Adagio.Utils.bassUtils,c=Adagio.Utils.degreeUtils,d=Adagio.edit.composite.AddHarmony,e=Adagio.edit.action.RemoveHarmonyAtTimePos,f=Adagio.edit.composite.AddHarmonyErase=function(a,b,c){this.init(a,b,c)};f.NAME="composite.AddHarmonyErase";var g=f.prototype;g.name=f.NAME,g.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},g.perform=function(){this.removeFormerHarmony(),this.addHarmony()},g.removeFormerHarmony=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:this.opts.timePos,dpq:this.opts.dpq};new e(this.scoreData,a,this.cancelStack).performIfPossible()},g.addHarmony=function(){var b=a.copy(this.opts.root),e=h(this.opts.bass),f=this.opts.degrees.map(c.copy),g={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:this.opts.timePos,dpq:this.opts.dpq,root:b,kind:this.opts.kind,bass:e,degrees:f};new d(this.scoreData,g,this.cancelStack).perform()};var h=function(a){return null===a?a:b.copy(a)}}.call(this),function(){"use strict";var a=Adagio.Error.client.TimePosOutOfRangeError,b=Adagio.Values.ChordKind,c=Adagio.Utils.math,d=Adagio.Utils.measureUtils,e=Adagio.Utils.rootUtils,f=Adagio.Utils.bassUtils,g=Adagio.Utils.degreesUtils,h=Adagio.edit.composite.AddHarmonyErase,i=Adagio.edit.common.optsToLocalGetTimePos,j=Adagio.edit.common.convertPartUuidToGetPartIdx,k=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,l=Adagio.edit.action.AddHarmonyAtTimePos=function(a,b,c){this.init(a,b,c)};l.NAME="action.AddHarmonyAtTimePos";var m=l.prototype;m.name=l.NAME,m.init=function(a,b,c){j(a,b),k(a,b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.sanitized=!1,this.localTimePos=null,this.measure=null,this.location=null},m.checkPreconditions=function(){this.sanitizeIfNeeded(),this.checkValue(),this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx),this.checkTimePos()},m.checkValue=function(){b.check(this.opts.kind),e.check(this.opts.root),null!==this.opts.bass&&f.check(this.opts.bass),g.check(this.opts.degrees)},m.checkTimePos=function(){var b=this.getLocalTimePos(),e=this.getMeasure(),f=d.getNbDivisions(e);if(!c.isNumber(b)||b<0||b>=f){var g=d.getDpq(e);throw new a(b,g)}},m.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded(),this.storeAction(),this.addHarmony(),this.updateStack()},m.sanitizeIfNeeded=function(){this.sanitized||(void 0===this.opts.bass&&(this.opts.bass=null),void 0===this.opts.degrees&&(this.opts.degrees=[]),this.sanitized=!0)},m.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b=e.copy(this.opts.root),c=n(this.opts.bass),d=g.copy(this.opts.degrees),f={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,dpq:this.opts.dpq,timePos:this.opts.timePos,root:b,kind:this.opts.kind,bass:c,degrees:d}};this.cancelStack.storeAction(f)}},m.addHarmony=function(){var a=e.copy(this.opts.root),b=n(this.opts.bass),c=g.copy(this.opts.degrees),d={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:this.opts.timePos,dpq:this.opts.dpq,root:a,kind:this.opts.kind,bass:b,degrees:c};new h(this.scoreData,d,this.cancelStack).perform()};var n=function(a){return null===a?a:f.copy(a)};m.getLocalTimePos=function(){if(null===this.localTimePos){var a=this.getMeasure();this.localTimePos=i(this.opts,a)}
return this.localTimePos},m.getMeasure=function(){return null===this.measure&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure},m.updateStack=function(){var a=this.getLocation(),b={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,timePos:this.opts.timePos,dpq:this.opts.dpq}};this.cancelStack.push(b)},m.getLocation=function(){if(null===this.location){var a=this.scoreData.getPartUuid(this.opts.partIdx),b=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={partUuid:a,measureUuid:b}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Utils.transposeUtils,b=Adagio.Utils.rootUtils,c=Adagio.Utils.bassUtils;Adagio.edit.common.transposeHarmonyOpts=function(d,e){if(e.isConcertPitch){var f=0,g=d.getTranspose(f);a.isUnison(g)||(g=a.getReverse(g),e.root=b.transpose(e.root,g),null!==e.bass&&(e.bass=c.transpose(e.bass,g))),e.isConcertPitch=!1}}}.call(this),function(){"use strict";var a=Adagio.Values.ChordKind,b=Adagio.Utils.measureUtils,c=Adagio.Utils.rootUtils,d=Adagio.Utils.bassUtils,e=Adagio.Utils.degreesUtils,f=Adagio.Utils.noteUtils,g=Adagio.edit.action.AddHarmonyAtTimePos,h=Adagio.edit.common.convertPartUuidToGetPartIdx,i=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,j=Adagio.edit.common.initMeasureData,k=Adagio.edit.common.transposeHarmonyOpts,l=Adagio.edit.action.AddHarmonyAtNote=function(a,b,c){this.init(a,b,c)};l.NAME="action.AddHarmonyAtNote";var m=l.prototype;m.name=l.NAME,m.initMeasureData=j,m.init=function(a,b,c){h(a,b),i(a,b),this.initMeasureData(a,b),this.sanitized=!1,this.scoreData=a,this.cancelStack=c,this.opts=b},m.checkPreconditions=function(){this.sanitizeIfNeeded(),this.checkValue(),this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx),this.checkNote()},m.checkValue=function(){a.check(this.opts.kind),c.check(this.opts.root),null!==this.opts.bass&&d.check(this.opts.bass),e.check(this.opts.degrees)},m.checkNote=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.measureData.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},m.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded();var a=this.getTimePos(),b=this.getDpq();this.addHarmony(a,b)},m.sanitizeIfNeeded=function(){this.sanitized||(void 0===this.opts.bass&&(this.opts.bass=null),this.opts.isConcertPitch&&k(this.measureData,this.opts),void 0===this.opts.degrees&&(this.opts.degrees=[]),this.sanitized=!0)},m.getTimePos=function(){for(var a=this.measureData.getVoice(this.opts.voiceIdx),b=0,c=0;c<this.opts.noteIdx;c++){var d=a.getNote(c);b+=f.getDuration(d)}return b},m.getDpq=function(){var a=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx);return b.getDpq(a)},m.addHarmony=function(a,b){var d=c.copy(this.opts.root),f=n(this.opts.bass),h=e.copy(this.opts.degrees),i={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:a,dpq:b,root:d,kind:this.opts.kind,bass:f,degrees:h};new g(this.scoreData,i,this.cancelStack).perform()};var n=function(a){return null===a?a:d.copy(a)}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadHarmonyIdxError,b=Adagio.Values.ChordKind,c=Adagio.Utils.measureUtils,d=Adagio.Utils.rootUtils,e=Adagio.Utils.bassUtils,f=Adagio.Utils.degreesUtils,g=Adagio.Utils.harmonyUtils,h=Adagio.Utils.math,i=Adagio.edit.action.AddHarmonyAtTimePos,j=Adagio.edit.common.convertPartUuidToGetPartIdx,k=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,l=Adagio.edit.common.initMeasureData,m=Adagio.edit.common.transposeHarmonyOpts,n=Adagio.edit.action.AddHarmonyAtIdx=function(a,b,c){this.init(a,b,c)};n.NAME="action.AddHarmonyAtIdx";var o=n.prototype;o.name=n.NAME,o.initMeasureData=l,o.init=function(a,b,c){j(a,b),k(a,b),this.initMeasureData(a,b),this.sanitized=!1,this.scoreData=a,this.cancelStack=c,this.opts=b},o.checkPreconditions=function(){this.sanitizeIfNeeded(),this.checkValue(),this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx),this.checkHarmonyIdx()},o.checkValue=function(){b.check(this.opts.kind),d.check(this.opts.root),null!==this.opts.bass&&e.check(this.opts.bass),f.check(this.opts.degrees)},o.checkHarmonyIdx=function(){var b=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx),d=c.getNbHarmonies(b),e=this.opts.harmonyIdx;if(!h.isInteger(e)||e<0||e>=d)throw new a(e)},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded(),this.addHarmony()},o.sanitizeIfNeeded=function(){this.sanitized||(void 0===this.opts.bass&&(this.opts.bass=null),this.opts.isConcertPitch&&m(this.measureData,this.opts),void 0===this.opts.degrees&&(this.opts.degrees=[]),this.sanitized=!0)},o.addHarmony=function(){var a=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx),b=c.getHarmonies(a),e=b[this.opts.harmonyIdx],h=g.getTimePos(e),j=c.getDpq(a),k=d.copy(this.opts.root),l=p(this.opts.bass),m=f.copy(this.opts.degrees),n={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:h,dpq:j,root:k,kind:this.opts.kind,bass:l,degrees:m};new i(this.scoreData,n,this.cancelStack).perform()};var p=function(a){return null===a?a:e.copy(a)}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.BadLyricTextError=function(b){var c="The lyric text ["+b+"] is invalid.",d=a.call(this,c);return this.name=d.name="BadLyricTextError",this.stack=d.stack,this.message=d.message,this.lyricText=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}})}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.lyricUtils,c=Adagio.edit.common.initMeasureData,d=Adagio.edit.primitive.AddLyric=function(a,b,c){this.init(a,b,c)};d.NAME="primitive.AddLyric";var e=d.prototype;e.name=d.NAME,e.initMeasureData=c,e.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},e.perform=function(){var b=this.measureData.getVoice(this.opts.voiceIdx),c=b.getNote(this.opts.noteIdx),d=this.createLyric();a.addLyric(c,d),this.updateStack()},e.createLyric=function(){var a=b.create(this.opts.lyric,this.opts.syllabicType);return b.setLevel(a,this.opts.level),a},e.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.Values.SyllabicType,b=Adagio.Utils.noteUtils,c=Adagio.edit.action.RemoveLyric,d=Adagio.edit.composite.UpdateSyllabic,e=Adagio.edit.primitive.AddLyric,f=Adagio.edit.common.initMeasureData,g=Adagio.edit.common.CrossMeasure,h=Adagio.edit.composite.AddLyric=function(a,b,c){this.init(a,b,c)};h.NAME="primitive.AddLyric";var i=h.prototype;i.name=h.NAME,i.initMeasureData=f,i.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.crossMeasure=new g(this.measureData,this.opts.voiceIdx,this.opts.noteIdx)},i.perform=function(){this.removeLyric();var a=this.getSyllabicType();this.addLyric(a),this.updateSyllabicType(),this.opts.hasRightConnection&&this.hasLyricAfter()&&this.updateNextSyllabicType()},i.removeLyric=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,level:this.opts.level};new c(this.measureData,a,this.cancelStack).performIfPossible()},i.getSyllabicType=function(){return this.opts.hasRightConnection?a.BEGIN:a.SINGLE},i.addLyric=function(a){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,level:this.opts.level,lyric:this.opts.lyric,syllabicType:a};new e(this.measureData,b,this.cancelStack).perform()},i.updateSyllabicType=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,level:this.opts.level};new d(this.measureData,a,this.cancelStack).perform()},i.hasLyricAfter=function(){if(this.hasNoteAfter()){var a=this.getNoteAfter();return b.hasLyricAtLevel(a,this.opts.level)}return!1},i.hasNoteAfter=function(){return!this.crossMeasure.hasRightOverflow()||!!this.measureData.hasNextMeasure()&&!!this.crossMeasure.hasRightVoice()},i.getNoteAfter=function(){var a=this.crossMeasure.getRightVoice(),b=this.crossMeasure.getRightNoteIdx();return a.getNote(b)},i.updateNextSyllabicType=function(){var a=this.crossMeasure.getRightMeasureIdx(),b=this.crossMeasure.getRightMeasure(),c=this.crossMeasure.getRightNoteIdx(),e={partIdx:this.opts.partIdx,measureIdx:a,voiceIdx:this.opts.voiceIdx,noteIdx:c,level:this.opts.level};new d(b,e,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Utils.timeModifUtils;Adagio.edit.common.addTimeModifIfNeeded=function(b){void 0!==b.timePos&&void 0===b.timeModif&&(b.timeModif=a.createDefault())}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadLyricTextError,b=Adagio.Error.noChange.NoChangeError,c=Adagio.Values.LyricLevel,d=Adagio.edit.composite.AddLyric,e=Adagio.edit.common.initMeasureData,f=Adagio.edit.common.convertPartUuidToGetPartIdx,g=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,h=Adagio.edit.common.convertTimePosToInsertNoteIdx,i=Adagio.edit.common.addTimeModifIfNeeded,j=Adagio.Utils.timeModifUtils,k=Adagio.Utils.noteUtils,l=Adagio.edit.action.AddLyric=function(a,b,c){this.init(a,b,c)};l.NAME="action.AddLyric";var m=l.prototype;m.initMeasureData=e,m.name=l.NAME,m.init=function(a,b,c){f(a,b),g(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,i(b),h(this.measureData,b),this.location=null,this.sanitized=!1},m.checkPreconditions=function(){this.sanitizeIfNeeded(),this.checkLocation(),this.checkParam()},m.checkLocation=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.measureData.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},m.checkParam=function(){if(c.check(this.opts.level),"string"!=typeof this.opts.lyric)throw new a(this.opts.lyric);if(this.opts.lyric=this.opts.lyric.trim(),""===this.opts.lyric){throw new b("Cannot add lyric with empty text")}},m.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded(),this.storeAction(),this.addLyric(),this.updateStack()},m.sanitizeIfNeeded=function(){this.sanitized||(void 0===this.opts.level&&(this.opts.level=0),void 0===this.opts.hasRightConnection&&(this.opts.hasRightConnection=!1),this.sanitized=!0)},m.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b=j.copy(a.timeModif),c={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos,lyric:this.opts.lyric,level:this.opts.level,hasRightConnection:this.opts.hasRightConnection,timeModif:b}};this.cancelStack.storeAction(c)}},m.addLyric=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,lyric:this.opts.lyric,level:this.opts.level,hasRightConnection:this.opts.hasRightConnection};new d(this.measureData,a,this.cancelStack).perform()},m.updateStack=function(){var a=this.getLocation(),b={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos,level:this.opts.level}};this.cancelStack.push(b)},m.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx),g=e.getNote(this.opts.noteIdx),h=k.getTimeModif(g);h=j.copy(h),this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f,timeModif:h}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.AlreadyHasNotationError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="AlreadyHasNotationError",this.stack=e.stack,this.message=e.message,this.notationType=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"Note already has Notation "+a}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.edit.common.initMeasureData,c=Adagio.edit.primitive.AddNotation=function(a,b,c){this.init(a,b,c)};c.NAME="primitive.AddNotation";var d=c.prototype;d.name=c.NAME,d.initMeasureData=b,d.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},d.perform=function(){var b=this.measureData.getVoice(this.opts.voiceIdx),c=b.getNote(this.opts.noteIdx);a.addNotation(c,this.opts.notationType),this.updateStack()},d.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,notationType:this.opts.notationType,noteIdx:this.opts.noteIdx}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.edit.primitive.AddNotation,b=Adagio.edit.action.RemoveArticulation,c=Adagio.Utils.noteUtils,d=Adagio.edit.composite.AddNotation=function(a,b,c){this.init(a,b,c)};d.NAME="composite.AddNotation";var e=d.prototype;e.name=d.NAME,e.init=function(a,b,c){this.measureData=a,this.cancelStack=c,this.opts=b},e.perform=function(){var b=this.measureData.getVoice(this.opts.voiceIdx),d=b.getNote(this.opts.noteIdx),e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,notationType:this.opts.notationType,noteIdx:this.opts.noteIdx};c.hasNotationIncompatibleArticulations(d)&&this.removeIncompatibleArticulations(d),new a(this.measureData,e,this.cancelStack).perform()},e.removeIncompatibleArticulations=function(a){c.getNotationIncompatibleArticulations(a).forEach(function(a){var c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,articulationType:a,noteIdx:this.opts.noteIdx},d=new b(this.measureData,c,this.cancelStack);d.checkPreconditions(),d.perform()},this)}}.call(this),function(){"use strict";var a=Adagio.Error.value.AlreadyHasNotationError,b=Adagio.Error.value.BadNotationTypeError,c=Adagio.Utils.noteUtils,d=Adagio.Utils.timeModifUtils,e=Adagio.Values.NotationType,f=Adagio.edit.composite.AddNotation,g=Adagio.edit.common.initMeasureData,h=Adagio.edit.common.convertTimePosToInsertNoteIdx,i=Adagio.edit.common.convertPartUuidToGetPartIdx,j=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,k=Adagio.edit.common.addTimeModifIfNeeded,l=Adagio.edit.action.AddNotations=function(a,b,c){this.init(a,b,c)};l.NAME="action.AddNotations";var m=l.prototype;m.initMeasureData=g,m.name=l.NAME,m.init=function(a,b,c){i(a,b),j(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.location=null,k(b),h(this.measureData,this.opts)},m.checkPreconditions=function(){this.checkLocation(),this.checkParam()},m.checkLocation=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.measureData.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},m.checkParam=function(){if(!e.isValid(this.opts.notationType))throw new b(this.opts.notationType);var d=this.measureData.getVoice(this.opts.voiceIdx),f=d.getNote(this.opts.noteIdx);if(c.hasNotations(f)&&c.hasNotation(f,this.opts.notationType))throw new a(this.opts.notationType)},m.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,notationType:this.opts.notationType,noteIdx:this.opts.noteIdx};new f(this.measureData,a,this.cancelStack).perform(),this.updateStack()},m.updateStack=function(){var a=this.getLocation(),b={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,notationType:this.opts.notationType,timePos:a.timePos,divisions:a.dpq}};this.cancelStack.push(b)},m.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b=d.copy(a.timeModif),c={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,notationType:this.opts.notationType,timePos:a.timePos,divisions:a.dpq,timeModif:b}};this.cancelStack.storeAction(c)}},m.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),e=a.getMeasureUuid(this.opts.measureIdx),f=this.measureData.getDpqValue(),g=this.measureData.getVoice(this.opts.voiceIdx),h=g.getRangeSpace(0,this.opts.noteIdx),i=g.getNote(this.opts.noteIdx),j=c.getTimeModif(i);j=d.copy(j),this.location={partUuid:b,measureUuid:e,dpq:f,timePos:h,timeModif:j}}return this.location}}.call(this),function(){"use strict";var a=Adagio.edit.common.calcDuration,b=Adagio.edit.common.timePosToFloorNoteIdx,c=Adagio.Error.client.NotEnoughSpaceError,d=Adagio.Error.client.BadTimePosError,e=Adagio.Error.client.TimePosIncompatibleError,f=Adagio.Error.InternalError,g=Adagio.Utils.math,h=Adagio.Utils.timeModifUtils,i=Adagio.Utils.durationUtils;Adagio.edit.common.checkSpaceForAddCrossMeasure=function(a,b){j(a,b)?k(a,b):q(a,b)};var j=function(a,b){return a.hasVoice(b.voiceIdx)},k=function(a,b){b=m(a,b),b.isTuplet&&b.requiredSpace>b.availableSpace&&l(b)},l=function(a){throw new c(a.requiredSpace,a.availableSpace,a.dpq,a.timeModif)},m=function(a,b){var c;if(n(b))c=o(a,b);else{if(!r(b))throw new f("Unexpected");c=p(a,b)}return c},n=function(a){return"number"==typeof a.noteIdx},o=function(b,c){var d=b.getVoiceOrTupletForGet(c.voiceIdx,c.noteIdx),e={isTuplet:d.isTuplet()};return e.isTuplet&&(e.timeModif=d.getAbsoluteTimeModif(),e.dpq=b.getDpqValue(),e.requiredSpace=a(c,e.dpq,e.timeModif),e.availableSpace=d.getSpaceFromIdx(c.noteIdx)),e},p=function(c,f){var i=c.getDpqValue(),j=g.lcm(i,f.divisions),k=f.timePos*j/f.divisions,l=j/i,m=c.getVoice(f.voiceIdx),n=b(m,l,k),o=m.getRangeSpace(0,n)*l,p=k-o;if(p>0&&!m.isRest(n))throw new d(k,j,d.INSERT);var q=c.getVoiceOrTupletForGet(f.voiceIdx,n),r=q.getAbsoluteTimeModif();if(p>0&&!h.isSame(f.timeModif,r))throw new e(f.timeModif);var s={isTuplet:q.isTuplet()};return s.isTuplet&&(s.timeModif=r,s.dpq=j,s.requiredSpace=a(f,j,s.timeModif),s.availableSpace=q.getSpaceFromIdx(n)*l-p),s},q=function(a,b){if(!r(b))throw new f("Unexpected");var c=i.divisionsToQuarter(b.timePos,b.divisions);if(!i.isValidQuarter(c))throw new f("Unexpected","Invalid position")},r=function(a){return"number"==typeof a.timePos&&"number"==typeof a.divisions}}.call(this),function(){"use strict";var a=Adagio.edit.common.timePosToFloorNoteIdx,b=Adagio.Utils.math,c=Adagio.Utils.durationUtils,d=Adagio.Utils.measureUtils,e=Adagio.Utils.noteUtils;Adagio.edit.common.getPossibleDurationOptsAtTimePos=function(a,b){var d=c.durationOptsToQuarter(b),e=f(a,b),g=Math.min(d,e);return c.quarterToDurationOpts(g)};var f=function(a,b){return g(a,b)?h(a,b):i(a,b)},g=function(a,b){return a.hasVoice(b.voiceIdx)},h=function(d,f){var g=d.getDpqValue(),h=b.lcm(g,f.divisions),i=f.timePos*h/f.divisions,j=h/g,k=d.getVoice(f.voiceIdx),l=a(k,j,i),m=k.getRangeSpace(0,l)*j,n=i-m,o=d.getVoiceOrTupletForGet(f.voiceIdx,l),p=o.getAbsoluteTimeModif(),q=o.getNote(l),r=e.getDuration(q)*j,s=r-n,t=c.actualToNormal(s,p);return c.divisionsToQuarter(t,h)},i=function(a,b){var e=a.getMeasure();return d.getQuarterDuration(e)-c.divisionsToQuarter(b.timePos,b.divisions)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Error.noChange.NoChangeError,c=Adagio.Error.client.NotPossibleOnUnpitchedError,d=Adagio.Error.client.BadVoiceError,e=Adagio.Utils.noteUtils,f=Adagio.Utils.timeModifUtils,g=Adagio.Utils.pitchUtils,h=Adagio.Utils.durationUtils,i=Adagio.edit.values.InsertMode,j=Adagio.edit.common.calcDuration,k=Adagio.edit.common.checkOptsDuration,l=Adagio.edit.action.ChangeDurationCrossMeasure,m=Adagio.edit.action.AddNote,n=Adagio.edit.common.initMeasureData,o=Adagio.edit.common.convertPartUuidToGetPartIdx,p=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,q=Adagio.edit.common.convertLineToPitch,r=Adagio.edit.common.transposePitchAccidentalOpts,s=Adagio.edit.common.checkCompatibleVoiceStaffIdx,t=Adagio.edit.common.checkSpaceForAddCrossMeasure,u=Adagio.edit.common.checkNoteTimePos,v=Adagio.edit.common.getPossibleDurationOptsAtTimePos,w=Adagio.edit.common.convertNoteRef,x=Adagio.edit.action.AddNoteCrossMeasure=function(a,b,c){this.init(a,b,c)};x.NAME="action.AddNoteCrossMeasure",x.isNoChange=function(a){return a instanceof b};var y=x.prototype;y.initMeasureData=n,y.name=x.NAME,y.init=function(a,b,c){o(a,b),p(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.addNoteAction=null,this.location=null},y.checkPreconditions=function(){this.checkCommonElements(),this.hasNoteRef()&&this.convertNoteRef(),this.sanitize(),this.checkTimeLocation(),this.checkSpace(),this.checkNoteData()},y.checkCommonElements=function(){this.checkPitchedPart(),this.checkVoiceIdx(),this.checkCompatibleVoiceStaffIdx(),k(this.opts)},y.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new c},y.checkVoiceIdx=function(){if(!this.measureData.getScoreData().hasPartVoiceIdx(this.opts.partIdx,this.opts.voiceIdx))throw new d(this.opts.voiceIdx)},y.checkCompatibleVoiceStaffIdx=function(){s(this.measureData,this.opts)},y.checkTimeLocation=function(){if(this.hasTimePos())this.checkTimePos();else{if(!this.hasNoteIdx())throw new a("Unexpected");this.checkNoteIdx()}},y.checkTimePos=function(){var a=this.measureData.getMeasure();u(a,this.opts.timePos,this.opts.divisions)},y.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},y.checkSpace=function(){t(this.measureData,this.opts)},y.hasNoteRef=function(){return"number"==typeof this.opts.noteIdxRef&&"number"==typeof this.opts.voiceIdxRef},y.convertNoteRef=function(){w(this.measureData,this.opts)},y.sanitize=function(){q(this.measureData,this.opts,!0),this.opts.isConcertPitch&&r(this.measureData,this.opts)},y.checkNoteData=function(){var a=this.getAddNoteAction();a.checkPreconditions(),this.opts.noteIdx=a.opts.noteIdx},y.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.addNote();var a=this.getRequiredDuration();this.getActualDuration()!==a&&this.changeDuration()},y.addNote=function(){var a=this.getAddNoteAction();a.cancelStack=this.cancelStack,a.perform()},y.getAddNoteAction=function(){if(null===this.addNoteAction){var b=this.getInitialDurationOpts(),c=g.copy(this.opts.pitch),d={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,noteIdx:this.opts.noteIdx,insertMode:i.REPLACE,durationType:b.durationType,nbDots:b.nbDots,accidental:this.opts.accidental,pitch:c};if(this.hasTimePos())d.divisions=this.opts.divisions,d.timePos=this.opts.timePos,d.timeModif=f.copy(this.opts.timeModif);else{if(!this.hasNoteIdx())throw new a("Unexpected");d.noteIdx=this.opts.noteIdx}this.addNoteAction=new m(this.measureData,d,this.cancelStack)}return this.addNoteAction},y.getInitialDurationOpts=function(){if(this.hasTimePos())return this.getPossibleDurationOpts();if(this.hasNoteIdx())return this.getActualDurationOpts();throw new a("Unexpected")},y.getPossibleDurationOpts=function(){return v(this.measureData,this.opts)},y.getActualDurationOpts=function(){var a=this.getVoice(),b=a.getNote(this.opts.noteIdx),c=this.measureData.getDpqValue(),d=e.getNormalQuarterDuration(b,c);return h.quarterToDurationOpts(d)},y.hasTimePos=function(){return"number"==typeof this.opts.timePos&&"number"==typeof this.opts.divisions&&void 0!==this.opts.timeModif},y.hasNoteIdx=function(){return"number"==typeof this.opts.noteIdx},y.getRequiredDuration=function(){var a=this.measureData.getDpqValue(),b=this.getTimeModif();return j(this.opts,a,b)},y.getTimeModif=function(){return this.getVoiceOrTupletForGet().getAbsoluteTimeModif()},y.getVoiceOrTupletForGet=function(){var a=this.opts.voiceIdx,b=this.opts.noteIdx;return this.measureData.getVoiceOrTupletForGet(a,b)},y.getActualDuration=function(){var a=this.getVoice(),b=a.getNote(this.opts.noteIdx);return e.getDuration(b)},y.changeDuration=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,durationType:this.opts.durationType,nbDots:this.opts.nbDots},b=new l(this.measureData,a,this.cancelStack);b.checkPreconditions(),b.perform()},y.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b=f.copy(a.timeModif),c=g.copy(this.opts.pitch),d={partUuid:a.partUuid,measureUuid:a.measureUuid,staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,timePos:a.timePos,divisions:a.dpq,durationType:this.opts.durationType,nbDots:this.opts.nbDots,accidental:this.opts.accidental,timeModif:b,pitch:c},e={actionName:this.name,opts:d};this.cancelStack.storeAction(e)}},y.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),g=this.getVoice(),h=g.getRangeSpace(0,this.opts.noteIdx),i=g.getNote(this.opts.noteIdx),j=e.getTimeModif(i);j=f.copy(j),this.location={partUuid:b,measureUuid:c,dpq:d,timePos:h,timeModif:j}}return this.location},y.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)}}.call(this),function(){"use strict";var a=Adagio.Utils.pitchUtils;Adagio.edit.common.convertAlterToAccidental=function(b){if(void 0!==b.pitch){var c=a.getAlter(b.pitch);b.accidental=a.alterToAccidental(c)}}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Error.client.MissingOptionError,c=Adagio.Error.client.BadVoiceError,d=Adagio.edit.common.convertPartUuidToGetPartIdx,e=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,f=Adagio.edit.common.initMeasureData,g=Adagio.edit.common.checkCompatibleVoiceStaffIdx,h=Adagio.edit.common.convertFretToPitch,i=Adagio.edit.common.convertAlterToAccidental,j=Adagio.edit.common.checkTabPart,k=Adagio.Utils.clone,l=Adagio.Utils.pitchUtils,m=Adagio.Utils.timeModifUtils,n=Adagio.edit.action.AddNote,o=Adagio.edit.action.AddNoteTab=function(a,b,c){this.init(a,b,c)};o.NAME="action.AddNoteTab";var p=o.prototype;p.name=o.NAME,p.initMeasureData=f,p.init=function(a,b,c){d(a,b),e(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.addNoteAction=null},p.checkPreconditions=function(){this.checkCommonElements(),this.getAddNoteAction().checkPreconditions()},p.checkCommonElements=function(){this.checkTabPart(),this.checkVoiceIdx(),this.checkCompatibleVoiceStaffIdx(),this.checkTabData(),this.sanitize()},p.checkTabPart=function(){j(this.measureData,this.opts)},p.checkVoiceIdx=function(){if(!this.measureData.getScoreData().hasPartVoiceIdx(this.opts.partIdx,this.opts.voiceIdx))throw new c(this.opts.voiceIdx)},p.checkCompatibleVoiceStaffIdx=function(){g(this.measureData,this.opts)},p.checkTabData=function(){if(void 0===this.opts.fretData)throw new b("fretData")},p.sanitize=function(){h(this.measureData,this.opts),i(this.opts)},p.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a=this.getAddNoteAction();a.cancelStack=this.cancelStack,a.perform()},p.getAddNoteAction=function(){if(null===this.addNoteAction){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,pitch:l.copyWithoutAlter(this.opts.pitch),fretData:k(this.opts.fretData),nbDots:this.opts.nbDots,durationType:this.opts.durationType,insertMode:this.opts.insertMode,formatRests:this.opts.formatRests,accidental:this.opts.accidental};if(this.hasNoteRef())b.voiceIdxRef=this.opts.voiceIdxRef,b.noteIdxRef=this.opts.noteIdxRef;else if(this.hasTimePos())b.timePos=this.opts.timePos,b.divisions=this.opts.divisions,b.timeModif=m.copy(this.opts.timeModif);else{if(!this.hasNoteIdx())throw new a("Unexpected");b.noteIdx=this.opts.noteIdx}this.addNoteAction=new n(this.measureData,b,null)}return this.addNoteAction},p.hasTimePos=function(){return"number"==typeof this.opts.timePos&&"number"==typeof this.opts.divisions&&void 0!==this.opts.timeModif},p.hasNoteIdx=function(){return"number"==typeof this.opts.noteIdx},p.hasNoteRef=function(){return"number"==typeof this.opts.noteIdxRef&&"number"==typeof this.opts.voiceIdxRef}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.MissingSettingError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="MissingSettingError",this.stack=e.stack,this.message=e.message,this.settingName=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"The setting ["+a+"] is missing."}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadPreviousNextUuidError,b=Adagio.edit.common.partUuidToPartIdx;Adagio.edit.common.partUuidsToPartIdx=function(c,d,e){if(null!==d&&c.hasPartByUuid(d))return b(c.getPartsHeaders(),d)+1;if(null!==e&&c.hasPartByUuid(e))return b(c.getPartsHeaders(),e);if(null===d)return 0;if(null===e){return c.getNbParts()}throw new a(d,e)}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.AlreadyHasPartUuidError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="AlreadyHasPartUuidError",this.stack=e.stack,this.message=e.message,this.partUuid=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"There is already a part linked the following UUID "+a}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadPartUuidError,b=Adagio.Error.client.AlreadyHasPartUuidError,c=Adagio.Error.client.UuidInconsistencyError,d=Adagio.Utils.uuidUtils;Adagio.edit.common.checkInsertedPartUuid=function(d,f){if(!e(f.partUuid))throw new a(f.partUuid,a.INSERT);if(d.hasPartByUuid(f.partUuid))throw new b(f.partUuid);if(void 0!==f.previousUuid&&f.partUuid===f.previousUuid)throw new c(f.partUuid,c.PART);if("undeifned"!==f.nextUuid&&f.partUuid===f.nextUuid)throw new c(f.partUuid,c.PART)};var e=function(a){return"string"==typeof a&&d.isValid(a)}}.call(this),function(){"use strict";Adagio.edit.common.generateVoiceIdx=function(a,b,c){for(var d=c;;){if(void 0===a[d]&&void 0===b[d])return b[d]=!0,d;d++}}}.call(this),function(){"use strict";var a=Adagio.edit.common.generateVoiceIdx,b={};Adagio.edit.common.generateMultipleInitialVoicesData=function(a){var b=c(a),d={seedVoiceIdx:0,optsVoicesSet:b};return a=a.map(f,d)};var c=function(a){var b={};return a.forEach(d,b),b},d=function(a){if(null!==a){var b=this;a.voices.forEach(e,b)}},e=function(a){this[a]=!0},f=function(c){if(null!==c)return c;var d=this,e=a(b,d.optsVoicesSet,d.seedVoiceIdx);return d.seedVoiceIdx=e+1,c={mainVoiceIdx:e,voices:[e]}}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadStaffMainVoiceError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadStaffMainVoiceError",this.stack=e.stack,this.message=e.message,this.voiceIdx=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"The main voice idx ["+a+"] for the added staff is not in the inserted voices."}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.DuplicateVoiceIdxError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="DuplicateVoiceIdxError",this.stack=e.stack,this.message=e.message,this.voiceIdx=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"The voice idx ["+a+"] appears twice in the options."}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.VoiceIdxCollisionError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="VoiceIdxCollisionError",this.stack=e.stack,this.message=e.message,this.voiceIdx=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"There is already a voice with the index ["+a+"]."}}.call(this),function(){"use strict"
;var a=Adagio.Error.value.BadStaffMainVoiceError,b=Adagio.Error.value.DuplicateVoiceIdxError,c=Adagio.Error.client.VoiceIdxCollisionError,d=Adagio.Values.VoiceIdx;Adagio.edit.common.checkVoicesData=function(b,c,d){var f=c.voices,g=c.mainVoiceIdx,h={optsVoicesSet:d,currentVoicesSet:b};if(f.forEach(e,h),!f.includes(g))throw new a(g)};var e=function(a){d.check(a);var e=this;if(void 0!==e.currentVoicesSet[a])throw new c(a);if(void 0!==e.optsVoicesSet[a])throw new b(a);e.optsVoicesSet[a]=!0}}.call(this),function(){"use strict";var a=Adagio.edit.common.checkVoicesData,b={};Adagio.edit.common.checkMultipleInitialVoicesData=function(a){var b={};a.forEach(c,b)};var c=function(c){a(b,c,this)}}.call(this),function(){"use strict";var a=Adagio.Utils.setUtils,b=Adagio.edit.common.generateVoiceIdx;Adagio.edit.common.generateSingleVoicesData=function(a,d){var e=c(a,d),f={},g=0,h=b(e,f,g);return{mainVoiceIdx:h,voices:[h]}};var c=function(b,c){var d=b.getPartVoicesIndexes(c);return a.fromList(d)}}.call(this),function(){"use strict";var a=Adagio.edit.common.checkVoicesData,b=Adagio.Utils.setUtils;Adagio.edit.common.checkSingleVoicesData=function(b,d,e){var f=c(b,d);a(f,e,{})};var c=function(a,c){var d=a.getPartVoicesIndexes(c);return b.fromList(d)}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadStaffIdxError,b=Adagio.Error.client.NotPossibleOnUnpitchedError,c=Adagio.edit.composite.FillVoiceWithRests,d=Adagio.edit.common.MeasureData,e=Adagio.edit.common.generateSingleVoicesData,f=Adagio.edit.common.checkSingleVoicesData,g=Adagio.Utils.partHeaderUtils,h=Adagio.Utils.partContentUtils,i=Adagio.Utils.measureUtils,j=Adagio.Utils.clefUtils,k=Adagio.Utils.keyUtils,l=Adagio.Utils.timeUtils,m=Adagio.Utils.transposeUtils,n=Adagio.Utils.staffDetailsUtils,o=Adagio.Utils.attributesUtils,p=Adagio.Utils.noteUtils,q=Adagio.Utils.clone,r=Adagio.Utils.mapUtils,s=Adagio.edit.action.AddStaffCreation=function(a,b,c){this.init(a,b,c)};s.NAME="action.AddStaffCreation";var t=s.prototype;t.name=s.NAME,t.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.needUpdateNotesStaffIdx=!1,this.sanitized=!1},t.checkPreconditions=function(){var b=this.scoreData.getPartContent(this.opts.partIdx),c=h.getNbStaves(b),d=this.opts.staffIdx;if(d<0||d>c)throw new a(d,a.action.INSERT);j.check(this.opts.clef),void 0!==this.opts.key?k.check(this.opts.key):k.check(this.opts.concertKey),this.opts.transpose&&m.check(this.opts.transpose),this.opts.staffDetails&&n.check(this.opts.staffDetails);var e=this.opts.partIdx;this.scoreData.isPartUnpitched(e)&&this.checkUnpitchedOpts(),this.sanitizeIfNeeded(),this.checkVoicesData()},t.checkUnpitchedOpts=function(){if(!k.isC(this.opts.key)||!j.isPercussion(this.opts.clef)||void 0!==this.opts.transpose&&!m.isIdentity(this.opts.transpose))throw new b},t.checkVoicesData=function(){f(this.scoreData,this.opts.partIdx,this.opts.voicesData)},t.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded(),this.opts.concertKey&&this.convertConcertKey(),this.updatePartHeader();var a=this.scoreData.getPartContent(this.opts.partIdx),b=h.getMeasures(a),c=b[0],d=b.slice(1);this.updateFirstMeasure(c),this.updateOtherMeasures(d),this.updateOwnTimeSignatures(b),this.updateStack()},t.sanitizeIfNeeded=function(){this.sanitized||(void 0===this.opts.voicesData&&this.generateVoicesData(),this.sanitized=!0)},t.generateVoicesData=function(){this.opts.voicesData=e(this.scoreData,this.opts.partIdx)},t.convertConcertKey=function(){var a;a=void 0!==this.opts.transpose?this.opts.transpose:m.createDefault(),this.opts.key=k.reverseTranspose(this.opts.concertKey,a)},t.updatePartHeader=function(){var a=this.scoreData.getPartHeader(this.opts.partIdx),b=g.getStaffMapping(a),c=q(this.opts.voicesData);b.splice(this.opts.staffIdx,0,c),g.setStaffMapping(a,b);var d=g.getVoiceMapping(a);this.updateVoiceMapping(d),g.setVoiceMapping(a,d)},t.updateVoiceMapping=function(a){r.forEach(a,this.updateVoiceMappingEntry,this);var b={voiceMapping:a,staffIdx:this.opts.staffIdx};this.opts.voicesData.voices.forEach(u,b)},t.updateVoiceMappingEntry=function(a,b,c){b=b.map(this.updateVoiceStaff,this),c[a]=b},t.updateVoiceStaff=function(a){return a<this.opts.staffIdx?a:(this.needUpdateNotesStaffIdx=!0,a+1)};var u=function(a){var b=this;b.voiceMapping[a]=[b.staffIdx]};t.updateFirstMeasure=function(a){this.fillAttributes(a),this.fillOwnAttributes(a);var b=i.getNbStaves(a);i.setOwnNbStaves(a,b+1),this.shiftMeasureNotesStaffIdxIfNeeded(a),this.addVoice(a,0)},t.updateOtherMeasures=function(a){a.forEach(this.updateOtherMeasure,this)},t.updateOtherMeasure=function(a,b){this.fillAttributes(a),this.fillEmptyOwnAttributes(a);var c=i.getNbStaves(a);i.setNbStaves(a,c+1),this.shiftMeasureNotesStaffIdxIfNeeded(a);var d=b+1;this.addVoice(a,d)},t.fillAttributes=function(a){var b={getAttributes:i.getAttributes,getWrappedTime:i.getWrappedTime,getWrappedClef:i.getWrappedClef,getWrappedKey:i.getWrappedKey,getWrappedTranspose:i.getWrappedTranspose,getWrappedStaffDetails:i.getWrappedStaffDetails,setAttributes:i.setAttributes},c=q(this.opts);void 0===c.transpose&&(c.transpose=m.createDefault()),void 0===c.staffDetails&&(c.staffDetails=n.createDefault()),this.fillAttributesContent(a,b,c)},t.fillOwnAttributes=function(a){var b={getAttributes:i.getOwnAttributes,getWrappedTime:i.getWrappedOwnTime,getWrappedClef:i.getWrappedOwnClef,getWrappedKey:i.getWrappedOwnKey,getWrappedTranspose:i.getWrappedOwnTranspose,getWrappedStaffDetails:i.getWrappedOwnStaffDetails,setAttributes:i.setOwnAttributes};this.fillAttributesContent(a,b,this.opts)},t.fillAttributesContent=function(a,b,c){var d=b.getAttributes(a),e=b.getWrappedTime(a),f=q(e.getAnyEntry());e.insertEntry(f,this.opts.staffIdx);var g=e.dumpAttribute();o.setTime(d,g);var h=b.getWrappedClef(a),i=q(c.clef);h.insertEntry(i,this.opts.staffIdx);var j=h.dumpAttribute();o.setClef(d,j);var k=b.getWrappedKey(a),l=q(c.key);k.insertEntry(l,this.opts.staffIdx);var m=k.dumpAttribute();o.setKey(d,m);var n=b.getWrappedTranspose(a),p=c.transpose?q(c.transpose):null;n.insertEntry(p,this.opts.staffIdx);var r=n.dumpAttribute();o.setTranspose(d,r);var s=b.getWrappedStaffDetails(a),t=c.staffDetails?q(c.staffDetails):null;s.insertEntry(t,this.opts.staffIdx);var u=s.dumpAttribute();o.setStaffDetails(d,u),b.setAttributes(a,d)},t.fillEmptyOwnAttributes=function(a){var b=i.getOwnAttributes(a),c=i.getWrappedOwnTime(a);c.insertEntry(null,this.opts.staffIdx);var d=c.dumpAttribute();o.setTime(b,d);var e=i.getWrappedOwnClef(a);e.insertEntry(null,this.opts.staffIdx);var f=e.dumpAttribute();o.setClef(b,f);var g=i.getWrappedOwnKey(a);g.insertEntry(null,this.opts.staffIdx);var h=g.dumpAttribute();o.setKey(b,h);var j=i.getWrappedOwnTranspose(a);j.insertEntry(null,this.opts.staffIdx);var k=j.dumpAttribute();o.setTranspose(b,k);var l=i.getWrappedOwnStaffDetails(a);l.insertEntry(null,this.opts.staffIdx);var m=l.dumpAttribute();o.setStaffDetails(b,m),i.setOwnAttributes(a,b)},t.shiftMeasureNotesStaffIdxIfNeeded=function(a){if(this.needUpdateNotesStaffIdx){i.getNotes(a).forEach(this.shiftNoteStaffIdx,this)}},t.shiftNoteStaffIdx=function(a){var b=p.getStaffIdx(a);b>=this.opts.staffIdx&&(b++,p.setStaffIdx(a,b))},t.addVoice=function(a,b){var e=new d(a),f=e.getVoicesList();this.opts.voicesData.voices.forEach(function(a){f.insertVoice(a);var d={partIdx:this.opts.partIdx,measureIdx:b,voiceIdx:a,staffIdx:this.opts.staffIdx};new c(e,d).perform()},this)},t.updateOwnTimeSignatures=function(a){for(var b=a.length,c=1;c<b;c++){var d=a[c-1],e=a[c],f=i.getWrappedTime(d),g=f.getEntry(this.opts.staffIdx),h=i.getWrappedTime(e),j=h.getEntry(this.opts.staffIdx);if(!l.isSame(g,j)){var k=i.getWrappedOwnTime(e),m=l.copy(j);k.setEntry(m,this.opts.staffIdx);var n=k.dumpAttribute();i.setOwnTime(e,n)}}},t.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,voiceIdx:this.opts.staffIdx,clef:q(this.opts.clef),key:q(this.opts.key),staffDetails:this.opts.staffDetails}};this.cancelStack.push(a),this.cancelStack.stateNeedCompleteRedraw()}}.call(this),function(){"use strict";var a=Adagio.Error.client.InternalError,b=Adagio.Error.client.ClientError,c=Adagio.Error.client.BadPartIdxError,d=Adagio.Error.client.MissingOptionError,e=Adagio.Error.client.MissingSettingError,f=Adagio.Values.Volume,g=Adagio.Utils.attributeWrapper.GlobalAttribute,h=Adagio.Utils.measureUtils,i=Adagio.Utils.attributesUtils,j=Adagio.Utils.timeUtils,k=Adagio.Utils.keyUtils,l=Adagio.Utils.clefUtils,m=Adagio.Utils.transposeUtils,n=Adagio.Utils.scoreInstrumentUtils,o=Adagio.Utils.MIDIInstrumentUtils,p=Adagio.Utils.partHeaderUtils,q=Adagio.Utils.clone,r=Adagio.Utils.uuidUtils,s=Adagio.Utils.staffDetailsUtils,t=Adagio.Utils.swingUtils,u=Adagio.Utils.tempoUtils,v=Adagio.edit.common.partUuidsToPartIdx,w=Adagio.edit.common.checkInsertedPartUuid,x=Adagio.edit.common.generateMultipleInitialVoicesData,y=Adagio.edit.common.checkMultipleInitialVoicesData,z=Adagio.import.setMeasureIds,A=Adagio.edit.action.AddStaffCreation,B=Adagio.edit.action.AddPart=function(a,b,c){this.init(a,b,c)};B.NAME="action.AddPart";var C=B.prototype;C.name=B.NAME,C.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.sanitized=!1},C.checkPreconditions=function(){this.hasGivenPartUuid()&&w(this.scoreData,this.opts),this.sanitizeIfNeeded();var a=this.scoreData.getNbParts(),f=this.opts.partIdx;if("number"!=typeof f||f<0||f>a)throw new c(f,c.INSERT);if("string"!=typeof this.opts.instrumentName)throw new d("instrumentName");o.checkMIDIProgram(this.opts.MIDIProgram);var g=this.opts.staves;if(0===g.length)throw new b("there must be at least one staff definition","NO_STAFF_DEF");if(!this.scoreData.hasTime())throw new e("time");if(!this.scoreData.hasNbMeasures())throw new e("nbMeasures");g.forEach(this.checkStaff,this),this.checkVoicesData()},C.checkStaff=function(a,c){if(a.key)k.check(a.key);else if(a.concertKey)k.check(a.concertKey);else{if(!this.scoreData.hasContent())throw new b("key definition is missing for staff "+c+". ","NO_KEY_DEF");a.concertKey=this.scoreData.getConcertKey()}l.check(a.clef),a.transpose&&m.check(a.transpose),a.staffDetails&&s.check(a.staffDetails)},C.checkVoicesData=function(){var a=this.opts.staves.map(D);y(a)};var D=function(a){return void 0!==a.voicesData?a.voicesData:null};C.perform=function(){this.sanitizeIfNeeded(),this.cancelStack=this.cancelStack.createSubstack(this.name);for(var a=this.getPreviousNextUuid(),b=this.scoreData.getNbMeasures(),c=[],d=0;d<b;d++)c.push(this.scoreData.getTime(d));var e=F(b,c);this.fillBarlines(e),this.hasParts()||(this.fillMeasureUuids(),this.fillCommonContent());var f=this.createPartHeader();this.hasGivenPartUuid()&&this.scoreData.setPartUuid(f,e,this.opts.partUuid),this.scoreData.insertPart(f,e,this.opts.partIdx),this.storeAction(a),this.fillStaves(),this.updateStack()},C.sanitizeIfNeeded=function(){this.sanitized||(void 0===this.opts.previousUuid&&void 0===this.opts.nextUuid||(this.opts.partIdx=v(this.scoreData,this.opts.previousUuid,this.opts.nextUuid),delete this.opts.previousUuid,delete this.opts.nextUuid),void 0===this.opts.volume&&(this.opts.volume=f.DEFAULT),this.generateVoicesData(),this.sanitized=!0)},C.generateVoicesData=function(){var a=this.opts.staves.map(D);a=x(a),this.opts.staves.forEach(E,a)};var E=function(a,b){var c=this;a.voicesData=c[b]},F=function(a,b){var c=[],d=b[0],e=G(d);c.push(e);for(var f=0;f<a-1;f++){var g=b[f+1],h=H(g);c.push(h)}return{measure:c}},G=function(a){var b=H(a),c=h.getAttributes(b),d=q(c);return h.setOwnAttributes(b,d),b},H=function(a){var b={note:[]},c={divisions:"1"};i.setNbStaves(c,0);var d=new g(0,j);return d.addGlobalEntry(a),a=q(d.dumpAttribute()),i.setTime(c,a),h.setAttributes(b,c),h.setSound(b,{}),b};C.fillBarlines=function(a){a.measure.forEach(this.fillMeasureBarlines,this)},C.fillMeasureBarlines=function(a,b,c){var d=b===c.length-1;if(this.scoreData.hasContent()){var e=this.scoreData.getMeasure(0,b);if(h.hasBarlines(e)){var f=h.getBarlines(e);h.setBarlines(a,q(f))}}else d&&h.addFinalBarlines(a)},C.hasParts=function(){return this.scoreData.getNbParts()>0},C.fillMeasureUuids=function(){var a=this.scoreData.getMeasuresHeaders(),b=this.scoreData.getNbMeasures();z(a,b)},C.fillCommonContent=function(){for(var a=this.scoreData.getNbMeasures(),b=this.scoreData.getTempo(0),c=u.createWithDefaultDisplay(b),d=this.scoreData.getSwing(0),e=this.scoreData.getCommonContent(),f=0;f<a;f++){e.addMeasure(f,u.copy(c),t.copy(d)),0===f&&(e.setOwnTempo(f,u.copy(c)),e.setOwnSwing(f,t.copy(d)));var g=this.scoreData.getTime(f);g=j.copy(g),e.setDisplayedTime(f,g)}},C.createPartHeader=function(){var a;a=void 0!==this.opts.partName?this.opts.partName:this.opts.instrumentName;var b=p.create(a);void 0!==this.opts.abbreviation&&p.setAbbreviation(b,this.opts.abbreviation);var c=n.create(this.opts.instrumentName),d={};return o.setMIDIProgram(d,this.opts.MIDIProgram),p.setInstrument(b,c,d),p.setGlobalVolume(b,this.opts.volume),b},C.fillStaves=function(){this.opts.staves.forEach(this.fillStaff,this)},C.fillStaff=function(a,b){var c=q(a);c.staffIdx=b,c.partIdx=this.opts.partIdx,new A(this.scoreData,c,this.cancelStack).perform()},C.hasGivenPartUuid=function(){return void 0!==this.opts.partUuid},C.isValidUuid=function(a){return"string"==typeof a&&r.isValid(a)},C.updateStack=function(){var a={type:this.name,opts:{partUuid:this.scoreData.getPartUuid(this.opts.partIdx)}};this.cancelStack.push(a),this.cancelStack.stateNeedCompleteRedraw()},C.storeAction=function(a){var b=this.opts.staves.map(q);if(!this.cancelStack.hasAction()){var c={actionName:this.name,opts:{partUuid:this.scoreData.getPartUuid(this.opts.partIdx),previousUuid:a.previousUuid,nextUuid:a.nextUuid,instrumentName:this.opts.instrumentName,MIDIProgram:this.opts.MIDIProgram,partName:this.opts.partName,abbreviation:this.opts.abbreviation,staves:b,volume:this.opts.volume}};this.cancelStack.storeAction(c)}},C.getPreviousNextUuid=function(){var b=0===this.opts.partIdx?null:this.scoreData.getPartUuid(this.opts.partIdx-1),c=this.scoreData.getNbParts(),d=this.opts.partIdx===c?null:this.scoreData.getPartUuid(this.opts.partIdx);if(this.hasGivenPartUuid()&&(this.opts.partUuid===b||this.opts.partUuid===d)){var e="The added measure uuid ["+this.opts.partUuid+"] also apprears on the previousNextUuid. ",f=new a("Inconsistency",e);throw f.partUuid=this.opte.partUuid,f}return{previousUuid:b,nextUuid:d}}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.NoPercuInstrumentsError=function(){var b=c(),d=a.call(this,b);return this.name=d.name="NoPercuInstrumentsError",this.stack=d.stack,this.message=d.message,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(){return"There must be at least one instrument."}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.DuplicateMIDIInstrumentError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="DuplicateMIDIInstrumentError",this.stack=e.stack,this.message=e.message,this.MIDIUnpitched=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"The MIDIUnpitched ["+a+"] appears twice in the instruments list."}}.call(this),function(){"use strict";var a=Adagio.Utils.unpitchedUtils,b=Adagio.Error.value.ValueError,c=Adagio.Error.value.UnpitchedUsedTwiceError=function(a){var c=d(a),e=b.call(this,c);return this.name=e.name="UnpitchedUsedTwiceError",this.stack=e.stack,this.message=e.message,this.unpitched=a,this};c.prototype=Object.create(b.prototype,{constructor:{value:c}});var d=function(b){return"The unpitched "+a.stringify(b)+" is used twice in pitch mapping. "}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.NoMIDIUnpitchedError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="NoMIDIUnpitchedError",this.stack=e.stack,this.message=e.message,this.MIDIUnpitched=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"The MIDIUnpitched ["+a+"] in pitch mapping  is not is the part instruments."}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.MIDIUnpitchedUsedTwiceError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="MIDIUnpitchedUsedTwiceError",this.stack=e.stack,this.message=e.message,this.MIDIUnpitched=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"The MIDIUnpitched ["+a+"] in used twice in pitch mapping "}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadPercuDefaultHeadError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadPercuDefaultHeadError",this.stack=e.stack,this.message=e.message,this.defaultHead=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"The note head ["+a+"] do not match any head for for the given pitch in the pitch mapping."}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.NoPitchMappingError=function(){var b=c(),d=a.call(this,b);return this.name=d.name="NoPitchMappingError",this.stack=d.stack,this.message=d.message,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(){return"There must be at least one valid pitch mapping."}}.call(this),function(){"use strict";var a=Adagio.Error.client.NotPossibleOnPitchedError,b=Adagio.edit.action.AddStaffCreation,c=Adagio.Utils.clefUtils,d=Adagio.Utils.keyUtils,e=Adagio.Utils.clone,f=Adagio.Utils.staffDetailsUtils,g=Adagio.edit.action.AddStaffPercu=function(a,b,c){this.init(a,b,c)};g.NAME="action.AddStaffPercu";var h=g.prototype;h.name=g.NAME,h.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.action=null},h.checkPreconditions=function(){if(!this.scoreData.isPartUnpitched(this.opts.partIdx))throw new a;this.getAction().checkPreconditions()},h.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a=this.getAction();a.cancelStack=this.cancelStack,a.perform()},h.getAction=function(){if(null===this.action){var a=e(this.opts);a.clef=c.createPercussion(),a.key=d.createC(),a.staffDetails={},f.setNbStaffLines(a.staffDetails,this.opts.nbStaffLines),this.action=new b(this.scoreData,a,this.cancelStack)}return this.action}}.call(this),function(){"use strict";var a=Adagio.Error.value.BadNbStaffLinesError,b=Adagio.Values.NbStaffLines={};b.checkPercu=function(c){if(!b.isValidPercu(c))throw new a(c)},b.isValidPercu=function(a){return 1===a||3===a||5===a}}.call(this),function(){"use strict";var a=Adagio.Utils.scoreInstrumentUtils,b=Adagio.Utils.MIDIInstrumentUtils;Adagio.edit.common.createPercuInstruments=function(a){return{score:a.map(c),MIDI:a.map(d)}};var c=function(b){return a.create(b.name)},d=function(a){var c={};return b.setUnpitched(c,a.unpitched),b.setMIDIProgram(c,a.MIDIProgram),c}}.call(this),function(){"use strict";var a=Adagio.Utils.clone,b=Adagio.Utils.unpitchedUtils;Adagio.edit.common.copyPitchMapping=function(c){var d={};for(var e in c){var f=c[e],g=b.parse(e),h=b.stringify(g),i=a(f);d[h]=i}return d}}.call(this),function(){"use strict";var a=Adagio.edit.common.checkVoicesData;Adagio.edit.common.checkSingleInitialVoicesData=function(b){a({},b,{})}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Error.client.BadPartIdxError,c=Adagio.Error.client.MissingSettingError,d=Adagio.Error.value.NoPercuInstrumentsError,e=Adagio.Error.value.DuplicateMIDIInstrumentError,f=Adagio.Error.value.UnpitchedUsedTwiceError,g=Adagio.Error.value.NoMIDIUnpitchedError,h=Adagio.Error.value.MIDIUnpitchedUsedTwiceError,i=Adagio.Error.value.BadPercuDefaultHeadError,j=Adagio.Error.value.NoPitchMappingError,k=Adagio.edit.action.AddStaffPercu,l=Adagio.Utils.attributeWrapper.GlobalAttribute,m=Adagio.Utils.mapUtils,n=Adagio.Utils.unpitchedUtils,o=Adagio.Utils.measureUtils,p=Adagio.Utils.attributesUtils,q=Adagio.Utils.timeUtils,r=Adagio.Utils.partHeaderUtils,s=Adagio.Utils.clone,t=Adagio.Utils.uuidUtils,u=Adagio.Utils.MIDIInstrumentUtils,v=Adagio.Utils.swingUtils,w=Adagio.Utils.tempoUtils,x=Adagio.Values.Notehead,y=Adagio.Values.NbStaffLines,z=Adagio.Values.MIDIValues,A=Adagio.Values.Volume,B=Adagio.edit.common.partUuidsToPartIdx,C=Adagio.edit.common.createPercuInstruments,D=Adagio.edit.common.copyPitchMapping,E=Adagio.edit.common.checkInsertedPartUuid,F=Adagio.edit.common.checkSingleInitialVoicesData,G=Adagio.import.setMeasureIds,H="Drumset",I="Drs.",J=5,K=Adagio.edit.action.AddPartPercu=function(a,b,c){this.init(a,b,c)};K.NAME="action.AddPartPercu";var L=K.prototype;L.name=K.NAME,L.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.sanitized=!1,void 0===b.previousUuid&&void 0===b.nextUuid||(b.partIdx=B(a,b.previousUuid,b.nextUuid),delete b.previousUuid,delete b.nextUuid)},L.checkPreconditions=function(){this.hasGivenPartUuid()&&E(this.scoreData,this.opts),this.sanitizeIfNeeded();var a=this.scoreData.getNbParts(),d=this.opts.partIdx;if("number"!=typeof d||d<0||d>a)throw new b(d,b.INSERT);if(!this.scoreData.hasTime())throw new c("time");if(!this.scoreData.hasNbMeasures())throw new c("nbMeasures");var e=this.checkInstruments();this.checkPitchMapping(e),y.checkPercu(this.opts.nbStaffLines),this.checkVoicesData()},L.isValidUuid=function(a){return!("string"!=typeof a||!t.isValid(a))},L.checkInstruments=function(){if(0===this.opts.instrumentsList.length)throw new d;var a={};return this.opts.instrumentsList.forEach(M,a),a};var M=function(a){var b=this,c=a.unpitched;if(void 0!==b[c])throw new e(c);b[c]=!0,u.checkMIDIProgram(a.MIDIProgram)};L.checkPitchMapping=function(a){if(m.isEmpty(this.opts.pitchMapping))throw new j;var b={},c=s(a);m.forEach(this.opts.pitchMapping,function(d,e){var j=n.parse(d),k=n.stringify(j);if(void 0!==b[k])throw new f(j);b[k]=!0,m.forEach(e,function(b,d){if("default"!==b){if(x.checkPercu(b),void 0===a[d])throw new g(d);if(void 0===c[d])throw new h(d);delete c[d]}});var l=e.default;if(void 0===e[l])throw new i(l)}),m.isEmpty(c)},L.checkVoicesData=function(){F(this.opts.voicesData)},L.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded();for(var a=this.getLocation(),b=this.scoreData.getNbMeasures(),c=[],d=0;d<b;d++)c.push(this.scoreData.getTime(d));var e=O(b,c);this.fillBarlines(e),this.hasParts()||(this.fillCommonContent(),this.fillMeasureUuids());var f=this.createPartHeader();this.hasGivenPartUuid()&&this.scoreData.setPartUuid(f,e,this.opts.partUuid),this.scoreData.insertPart(f,e,this.opts.partIdx),this.storeAction(a),this.fillStaff(),this.updateStack()},L.sanitizeIfNeeded=function(){this.sanitized||(void 0===this.opts.previousUuid&&void 0===this.opts.nextUuid||(this.opts.partIdx=B(this.scoreData,this.opts.previousUuid,this.opts.nextUuid),delete this.opts.previousUuid,delete this.opts.nextUuid),void 0===this.opts.nbStaffLines&&(this.opts.nbStaffLines=J),this.opts.instrumentsList.forEach(N),void 0===this.opts.volume&&(this.opts.volume=A.DEFAULT),void 0===this.opts.voicesData&&this.generateVoicesData(),this.sanitized=!0)};var N=function(a){void 0===a.MIDIProgram&&(a.MIDIProgram=z.UNPITCHED_PROGRAM)};L.generateVoicesData=function(){this.opts.voicesData={mainVoiceIdx:0,voices:[0]}};var O=function(a,b){var c=[],d=b[0],e=P(d);c.push(e);for(var f=0;f<a-1;f++){var g=b[f+1],h=Q(g);c.push(h)}return{measure:c}},P=function(a){var b=Q(a),c=o.getAttributes(b),d=s(c);return o.setOwnAttributes(b,d),b},Q=function(a){var b={note:[]},c={divisions:"1"};p.setNbStaves(c,0);var d=new l(0,q);return d.addGlobalEntry(a),a=s(d.dumpAttribute()),p.setTime(c,a),o.setAttributes(b,c),o.setSound(b,{}),b};L.fillBarlines=function(a){a.measure.forEach(this.fillMeasureBarlines,this)},L.fillMeasureBarlines=function(a,b,c){var d=b===c.length-1;if(this.scoreData.hasContent()){var e=this.scoreData.getMeasure(0,b);if(o.hasBarlines(e)){var f=o.getBarlines(e);o.setBarlines(a,s(f))}}else d&&o.addFinalBarlines(a)},L.hasParts=function(){return this.scoreData.getNbParts()>0},L.fillMeasureUuids=function(){var a=this.scoreData.getMeasuresHeaders(),b=this.scoreData.getNbMeasures();G(a,b)},L.fillCommonContent=function(){for(var a=this.scoreData.getNbMeasures(),b=this.scoreData.getTempo(0),c=w.createWithDefaultDisplay(b),d=this.scoreData.getSwing(0),e=this.scoreData.getCommonContent(),f=0;f<a;f++){e.addMeasure(f,w.copy(c),v.copy(d)),0===f&&(e.setOwnTempo(f,w.copy(c)),e.setOwnSwing(f,v.copy(d)));var g=this.scoreData.getTime(f);g=q.copy(g),e.setDisplayedTime(f,g)}},L.createPartHeader=function(){var a=this.getName(),b=r.create(a);if(this.hasAbbreviation()){var c=this.getAbbreviation();r.setAbbreviation(b,c)}var d=C(this.opts.instrumentsList);r.setInstruments(b,d.score,d.MIDI);var e=D(this.opts.pitchMapping);return r.setPitchMapping(b,e),r.setGlobalVolume(b,this.opts.volume),b},L.getName=function(){return"string"==typeof this.opts.name?this.opts.name:H},L.hasAbbreviation=function(){return void 0===this.opts.name||void 0!==this.opts.abbreviation},L.getAbbreviation=function(){if(void 0===this.opts.name)return I;if("string"==typeof this.opts.abbreviation)return this.opts.abbreviation;throw new a("unreachable")},L.fillStaff=function(){var a={staffIdx:0,partIdx:this.opts.partIdx,nbStaffLines:this.opts.nbStaffLines,voicesData:s(this.opts.voicesData)};new k(this.scoreData,a,this.cancelStack).perform()},L.hasGivenPartUuid=function(){return void 0!==this.opts.partUuid},L.updateStack=function(){var a={partUuid:this.scoreData.getPartUuid(this.opts.partIdx)},b={type:this.name,opts:a};this.cancelStack.push(b),this.cancelStack.stateNeedCompleteRedraw()},L.storeAction=function(a){if(!this.cancelStack.hasAction()){var b=D(this.opts.pitchMapping),c=s(this.opts.instrumentsList),d=s(this.opts.voicesData),e={partUuid:this.scoreData.getPartUuid(this.opts.partIdx),name:this.getName(),previousUuid:a.previousUuid,nextUuid:a.nextUuid,pitchMapping:b,instrumentsList:c,nbStaffLines:this.opts.nbStaffLines,voicesData:d,volume:this.opts.volume};this.hasAbbreviation()&&(e.abbreviation=this.getAbbreviation());var f={actionName:this.name,opts:e};this.cancelStack.storeAction(f)}},L.getLocation=function(){var b=0===this.opts.partIdx?null:this.scoreData.getPartUuid(this.opts.partIdx-1),c=this.scoreData.getNbParts(),d=this.opts.partIdx===c?null:this.scoreData.getPartUuid(this.opts.partIdx);if(this.hasGivenPartUuid()&&(this.opts.partUuid===b||this.opts.partUuid===d)){var e="The added measure uuid ["+this.opts.partUuid+"] also apprears on the location. ",f=new a("Inconsistency",e);throw f.partUuid=this.opte.partUuid,f}return{previousUuid:b,nextUuid:d}}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.math,c=Adagio.Utils.measureUtils,d=Adagio.Utils.direction.pizzicatoDirectionUtils,e=Adagio.edit.common.optsToLocalGetTimePos,f=Adagio.edit.primitive.AddPizzicato=function(a,b,c){this.init(a,b,c)};f.NAME="primitive.AddPizzicato";var g=f.prototype;g.name=f.NAME,g.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.measure=null,this.pizzicatoIdx=null,this.localTimePos=null},g.perform=function(){this.addPizzicato(),this.updateStack()},g.addPizzicato=function(){var a=this.getMeasure(),b=this.getPizzicatoIdx(),d=this.createPizzicato(),e=c.getPizzicatos(a,this.opts.staffIdx);e.splice(b,0,d),c.setPizzicatos(a,this.opts.staffIdx,e)},g.getPizzicatoIdx=function(){return null===this.pizzicatoIdx&&this.fetchPizzicatoIdx(),this.pizzicatoIdx},g.fetchPizzicatoIdx=function(){var a=this.getMeasure(),b=c.getPizzicatos(a,this.opts.staffIdx);if(b.some(this.tryPizzicatoIdx,this),null===this.pizzicatoIdx){var d=b.length;this.pizzicatoIdx=d}},g.tryPizzicatoIdx=function(b,c){var e=this.getLocalTimePos(),f=d.getTimePos(b);if(f<e)return!1;if(f>e)return this.pizzicatoIdx=c,!0;throw new a("TimePosCollision","There is already an pizzicato at this time position.")},g.createPizzicato=function(){var a=this.getLocalTimePos();return d.create(this.opts.staffIdx,this.opts.placement,a,this.opts.type)},g.getLocalTimePos=function(){if(null===this.localTimePos){var c=this.getMeasure();if(this.localTimePos=e(this.opts,c),!b.isInteger(this.localTimePos)){var d="At the point, the time position ["+this.localTimePos+"] should be an integer.";throw new a("IntegerExpected",d)}}return this.localTimePos},g.getMeasure=function(){return null===this.measure&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure},g.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.edit.primitive.AddPizzicato,b=Adagio.edit.composite.AdaptDpqToPosition,c=Adagio.edit.composite.AddPizzicato=function(a,b,c){this.init(a,b,c)};c.NAME="composite.AddPizzicato";var d=c.prototype;d.name=c.NAME,d.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},d.perform=function(){this.updateDpq(),this.addPizzicato()},d.updateDpq=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:this.opts.timePos,dpq:this.opts.dpq};new b(this.scoreData,a,this.cancelStack).perform()},d.addPizzicato=function(){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,placement:this.opts.placement,timePos:this.opts.timePos,dpq:this.opts.dpq,type:this.opts.type};new a(this.scoreData,b,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.math,c=Adagio.Utils.measureUtils,d=Adagio.edit.primitive.RemovePizzicato=function(a,b,c){this.init(a,b,c)};d.NAME="primitive.RemovePizzicato";var e=d.prototype;e.name=d.NAME,e.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},e.perform=function(){this.removePizzicato(),this.updateStack()},e.removePizzicato=function(){var a=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx),b=c.getPizzicatos(a,this.opts.staffIdx),d=b.length;f(this.opts.pizzicatoIdx,d),b.splice(this.opts.pizzicatoIdx,1),c.setPizzicatos(a,this.opts.staffIdx,b)};var f=function(c,d){if(!b.isInteger(c)||c<0||c>=d){throw new a("BadPizzicatoIdx","Invalid pizzicatoIdx: ["+c+"].")}};e.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadPartIdxError,b=Adagio.Error.client.BadMeasureIdxError,c=Adagio.Error.client.BadStaffIdxError,d=Adagio.Error.client.TimePosOutOfRangeError,e=Adagio.Error.noChange.NoChangeError,f=Adagio.Utils.measureUtils,g=Adagio.Utils.math,h=Adagio.Utils.direction.pizzicatoDirectionUtils,i=Adagio.edit.primitive.RemovePizzicato,j=Adagio.edit.common.optsToLocalGetTimePos,k=Adagio.edit.common.convertPartUuidToGetPartIdx,l=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,m=Adagio.edit.action.RemovePizzicatoAtTimePos=function(a,b,c){this.init(a,b,c)};m.NAME="action.RemovePizzicatoAtTimePos",m.isAuthorizedException=function(f){return f instanceof a||f instanceof b||f instanceof c||f instanceof d||f instanceof e};var n=m.prototype;n.name=m.NAME,n.init=function(a,b,c){k(a,b),l(a,b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.measure=null,this.pizzicatos=null,this.location=null,this.pizzicatoIdx=null,this.localTimePos=null},n.performIfPossible=function(){this.isPossible()&&this.perform()},n.isPossible=function(){var a=!0;try{this.checkPreconditions()}catch(b){if(!m.isAuthorizedException(b))throw b;a=!1}return a},n.checkPreconditions=function(){this.checkLocation(),this.checkTimePos(),this.checkExistence()},n.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx);var a=this.getMeasure(),b=f.getNbStaves(a),d=this.opts.staffIdx;if(!g.isNumber(d)||d<0||d>=b)throw new c(d)},n.checkTimePos=function(){var a=this.getLocalTimePos(),b=this.getMeasure(),c=f.getNbDivisions(b)
;if(!g.isNumber(a)||a<0||a>c){var e=f.getDpq(b);throw new d(a,e)}},n.checkExistence=function(){this.fetchPizzicatoIdx()},n.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a=this.getPreviousData();this.removePizzicato(),this.updateStack(a)},n.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,staffIdx:this.opts.staffIdx,timePos:this.opts.timePos,dpq:this.opts.dpq}};this.cancelStack.storeAction(b)}},n.getPreviousData=function(){var a=this.getPizzicato(),b=h.getStaffIdx(a),c=h.getPlacement(a),d=h.getTimePos(a),e=h.getType(a),g=this.getMeasure();return{staffIdx:b,placement:c,timePos:d,dpq:f.getDpq(g),type:e}},n.getPizzicato=function(){return this.getPizzicatos()[this.getPizzicatoIdx()]},n.removePizzicato=function(){var a=this.getPizzicatoIdx(),b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,pizzicatoIdx:a};new i(this.scoreData,b,this.cancelStack).perform()},n.getPizzicatoIdx=function(){return null===this.pizzicatoIdx&&this.fetchPizzicatoIdx(),this.pizzicatoIdx},n.fetchPizzicatoIdx=function(){if(this.pizzicatoIdx=null,this.getPizzicatos().some(this.checkPizzicatoTimePos,this),null===this.pizzicatoIdx)throw new e},n.getPizzicatos=function(){if(null===this.pizzicatos){var a=this.getMeasure();this.pizzicatos=f.getPizzicatos(a,this.opts.staffIdx)}return this.pizzicatos},n.checkPizzicatoTimePos=function(a,b){var c=this.getLocalTimePos(),d=h.getTimePos(a);return!(d<c)&&(d===c&&(this.pizzicatoIdx=b),!0)},n.getLocalTimePos=function(){if(null===this.localTimePos){var a=this.getMeasure();this.localTimePos=j(this.opts,a)}return this.localTimePos},n.getMeasure=function(){return null===this.measure&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure},n.updateStack=function(a){var b=this.getLocation(),c={type:this.name,noDraw:!0,opts:{partUuid:b.partUuid,measureUuid:b.measureUuid,staffIdx:a.staffIdx,placement:a.placement,timePos:a.timePos,dpq:a.dpq,type:a.type}};this.cancelStack.push(c)},n.getLocation=function(){if(null===this.location){var a=this.scoreData.getPartUuid(this.opts.partIdx),b=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={partUuid:a,measureUuid:b}}return this.location}}.call(this),function(){"use strict";var a=Adagio.edit.composite.AddPizzicato,b=Adagio.edit.action.RemovePizzicatoAtTimePos,c=Adagio.edit.composite.AddPizzicatoErase=function(a,b,c){this.init(a,b,c)};c.NAME="composite.AddPizzicatoErase";var d=c.prototype;d.name=c.NAME,d.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},d.perform=function(){this.removeFormerPizzicato(),this.addPizzicato()},d.removeFormerPizzicato=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,timePos:this.opts.timePos,dpq:this.opts.dpq};new b(this.scoreData,a,this.cancelStack).performIfPossible()},d.addPizzicato=function(){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,placement:this.opts.placement,timePos:this.opts.timePos,dpq:this.opts.dpq,type:this.opts.type};new a(this.scoreData,b,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadStaffIdxError,b=Adagio.Error.value.BadPlacementDirectionError,c=Adagio.Error.client.TimePosOutOfRangeError,d=Adagio.Values.DirectionPlacement,e=Adagio.Utils.measureUtils,f=Adagio.Utils.math,g=Adagio.Values.PizzicatoType,h=Adagio.edit.common.convertPartUuidToGetPartIdx,i=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,j=Adagio.edit.common.optsToLocalGetTimePos,k=Adagio.edit.composite.AddPizzicatoErase,l=Adagio.edit.action.AddPizzicatoAtTimePos=function(a,b,c){this.init(a,b,c)};l.NAME="action.AddPizzicatoAtTimePos";var m=l.prototype;m.name=l.NAME,m.init=function(a,b,c){h(a,b),i(a,b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.localTimePos=null,this.location=null},m.checkPreconditions=function(){this.checkLocation(),this.checkTimePos(),this.checkParam()},m.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx);var b=this.getMeasure(),c=e.getNbStaves(b);if(this.opts.staffIdx<0||this.opts.staffIdx>=c)throw new a(this.opts.staffIdx)},m.checkTimePos=function(){var a=this.getLocalTimePos(),b=this.getMeasure(),d=e.getNbDivisions(b);if(!f.isNumber(a)||a<0||a>=d){var g=e.getDpq(b);throw new c(a,g)}},m.getLocalTimePos=function(){if(null===this.localTimePos){var a=this.getMeasure();this.localTimePos=j(this.opts,a)}return this.localTimePos},m.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},m.checkParam=function(){if(!d.isValid(this.opts.placement))throw new b(this.opts.placement);g.check(this.opts.type)},m.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.addPizzicato(),this.updateStack()},m.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,staffIdx:this.opts.staffIdx,placement:this.opts.placement,timePos:this.opts.timePos,dpq:this.opts.dpq,type:this.opts.type}};this.cancelStack.storeAction(b)}},m.addPizzicato=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,placement:this.opts.placement,timePos:this.opts.timePos,dpq:this.opts.dpq,type:this.opts.type};new k(this.scoreData,a,this.cancelStack).perform()},m.updateStack=function(){var a=this.getLocation(),b={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,staffIdx:this.opts.staffIdx,placement:this.opts.placement,timePos:this.opts.timePos,dpq:this.opts.dpq}};this.cancelStack.push(b)},m.getLocation=function(){if(null===this.location){var a=this.scoreData.getPartUuid(this.opts.partIdx),b=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={partUuid:a,measureUuid:b}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.edit.common.MeasureData,c=Adagio.edit.action.AddPizzicatoAtTimePos,d=Adagio.edit.action.AddPizzicatoAtNote=function(a,b,c){this.init(a,b,c)};d.NAME="action.AddPizzicatoAtNote";var e=d.prototype;e.name=d.NAME,e.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.measureData=null,this.action=null},e.checkPreconditions=function(){this.checkLocation(),this.getAction().checkPreconditions()},e.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx);var a=this.getMeasureData();a.checkVoiceIdx(this.opts.voiceIdx),a.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a=this.getAction();a.cancelStack=this.cancelStack,a.perform()},e.getAction=function(){if(null===this.action){var a=this.getTimePos(),b=this.getDpq(),d={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,placement:this.opts.placement,timePos:a,dpq:b,type:this.opts.type};this.action=new c(this.scoreData,d,null)}return this.action},e.getTimePos=function(){for(var b=0,c=this.getMeasureData(),d=c.getVoice(this.opts.voiceIdx),e=0;e<this.opts.noteIdx;e++){var f=d.getNote(e);b+=a.getDuration(f)}return b},e.getDpq=function(){return this.getMeasureData().getDpqValue()},e.getMeasureData=function(){if(null===this.measureData){var a=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx);this.measureData=new b(a)}return this.measureData}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.AlreadyHasSlurError=function(){var b=c(),d=a.call(this,b);return this.name=d.name="AlreadyHasSlurError",this.stack=d.stack,this.message=d.message,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(){return"There are already slurs in this interval."}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.EmptyRangeError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="EmptyRangeError",this.stack=e.stack,this.message=e.message,this.type=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"The "+a+" range selected is empty."};b.MEASURE="measure",b.NOTE="note",b.TIME_POS="time position"}.call(this),function(){"use strict";var a=Adagio.Error.client.BadMeasureUuidError,b=Adagio.edit.common.measureUuidToMeasureIdx,c=Adagio.edit.common.getScoreData;Adagio.edit.common.convertMeasureUuidToStartStop=function(a,b){void 0!==b.startMeasureUuid&&d(a,b),void 0!==b.stopMeasureUuid&&e(a,b)};var d=function(d,e){if(d=c(d),!d.hasMeasureIdxByUuid(e.startMeasureUuid))throw new a(e.startMeasureUuid,a.GET);e.startMeasureIdx=b(d.getMeasuresHeaders(),e.startMeasureUuid),delete e.startMeasureUuid},e=function(d,e){if(d=c(d),!d.hasMeasureIdxByUuid(e.stopMeasureUuid))throw new a(e.stopMeasureUuid,a.GET);e.stopMeasureIdx=b(d.getMeasuresHeaders(),e.stopMeasureUuid),delete e.stopMeasureUuid}}.call(this),function(){"use strict";var a=Adagio.edit.common.convertTimePosToGetNoteIdx;Adagio.edit.common.convertStartStopTimePosToGetStartStopNoteIdx=function(a,d){void 0!==d.startTimePos&&void 0!==d.stopTimePos&&(b(a,d),c(a,d))};var b=function(b,c){var d=b.getMeasureData(c.startMeasureIdx),e={voiceIdx:c.voiceIdx,divisions:c.startDivisions,timePos:c.startTimePos};a(d,e),delete c.startTimePos,c.startNoteIdx=e.noteIdx},c=function(b,c){var d=b.getMeasureData(c.stopMeasureIdx),e={voiceIdx:c.voiceIdx,divisions:c.stopDivisions,timePos:c.stopTimePos};a(d,e),delete c.stopTimePos,c.stopNoteIdx=e.noteIdx}}.call(this),function(){"use strict";var a=Adagio.Values.SlurType,b=Adagio.Utils.noteUtils,c=Adagio.edit.primitive.AddSlurSide,d=Adagio.edit.primitive.AddSlurContinue,e=Adagio.edit.common.getMeasuresScroller,f=Adagio.edit.composite.AddSlur=function(a,b,c){this.init(a,b,c)};f.NAME="composite.AddSlur";var g=f.prototype;g.name=f.NAME,g.init=function(a,b,c){this.measuresScroller=e(a,b),this.cancelStack=c,this.opts=b,this.staffIdx=null},g.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.addSlurLeftSide(),this.addSlurRightSide(),this.addContinues()},g.addSlurLeftSide=function(){var b=this.isCrossMeasure(),d={partIdx:this.opts.partIdx,measureIdx:this.opts.startMeasureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.startNoteIdx,type:a.START,isCrossMeasure:b},e=this.measuresScroller.getMeasureData(this.opts.startMeasureIdx);new c(e,d,this.cancelStack).perform()},g.addSlurRightSide=function(){var b=this.isCrossMeasure(),d={partIdx:this.opts.partIdx,measureIdx:this.opts.stopMeasureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.stopNoteIdx,type:a.STOP,isCrossMeasure:b},e=this.measuresScroller.getMeasureData(this.opts.stopMeasureIdx);new c(e,d,this.cancelStack).perform()},g.isCrossMeasure=function(){return this.opts.startMeasureIdx!==this.opts.stopMeasureIdx},g.addContinues=function(){for(var a=this.opts.startMeasureIdx,b=this.opts.stopMeasureIdx,c=a;c<b;c++)this.addContinue(c)},g.addContinue=function(a){var b=this.getStaffIdx(),c={partIdx:this.opts.partIdx,measureIdx:a,voiceIdx:this.opts.voiceIdx,staffIdx:b},e=this.measuresScroller.getScoreData();new d(e,c,this.cancelStack).perform()},g.getStaffIdx=function(){if(null===this.staffIdx){var a=this.measuresScroller.getMeasureData(this.opts.startMeasureIdx),c=a.getVoice(this.opts.voiceIdx),d=c.getNote(this.opts.startNoteIdx);this.staffIdx=b.getStaffIdx(d)}return this.staffIdx}}.call(this),function(){"use strict";var a=Adagio.Error.client.AlreadyHasSlurError,b=Adagio.Error.client.RevertRangeError,c=Adagio.Error.client.EmptyRangeError,d=Adagio.Utils.noteUtils,e=Adagio.edit.common.convertPartUuidToGetPartIdx,f=Adagio.edit.common.convertMeasureUuidToStartStop,g=Adagio.edit.common.convertStartStopTimePosToGetStartStopNoteIdx,h=Adagio.edit.common.getMeasuresScroller,i=Adagio.edit.common.fetchSlurStart,j=Adagio.edit.common.fetchSlurStop,k=Adagio.edit.composite.AddSlur,l=Adagio.edit.action.AddSlur=function(a,b,c){this.init(a,b,c)};l.NAME="action.AddSlur";var m=l.prototype;m.name=l.NAME,m.init=function(a,b,c){e(a,b),f(a,b),this.measuresScroller=h(a,b),this.cancelStack=c,this.opts=b,g(this.measuresScroller,this.opts),this.location=null},m.checkPreconditions=function(){this.checkLocation(),this.checkNotRest(),this.checkOverlap()},m.checkLocation=function(){this.measuresScroller.checkMeasureIdx(this.opts.startMeasureIdx);var a=this.measuresScroller.getMeasureData(this.opts.startMeasureIdx);a.checkVoiceIdx(this.opts.voiceIdx),a.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.startNoteIdx),this.measuresScroller.checkMeasureIdx(this.opts.stopMeasureIdx);var b=this.measuresScroller.getMeasureData(this.opts.stopMeasureIdx);b.checkVoiceIdx(this.opts.voiceIdx),b.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.stopNoteIdx),this.checkRevertRange()},m.checkRevertRange=function(){var a=this.opts.startMeasureIdx,d=this.opts.stopMeasureIdx,e=d-a;if(e<0)throw new b(b.MEASURE,a,d);if(0===e){var f=this.opts.startNoteIdx,g=this.opts.stopNoteIdx;if(f>g)throw new b(b.NOTE,f,g);if(f===g)throw new c(c.NOTE)}},m.checkNotRest=function(){this.measuresScroller.getMeasureData(this.opts.startMeasureIdx).getVoice(this.opts.voiceIdx).checkNotRest(this.opts.startNoteIdx),this.measuresScroller.getMeasureData(this.opts.stopMeasureIdx).getVoice(this.opts.voiceIdx).checkNotRest(this.opts.stopNoteIdx)},m.checkOverlap=function(){this.checkInternalSlur(),this.checkLeftSlur(),this.checkRightSlur()},m.checkInternalSlur=function(){for(var b=this.opts.startMeasureIdx,c=this.opts.stopMeasureIdx,e=null,f=this.opts.startNoteIdx,g=this.opts.stopNoteIdx,h=b;h<=c;h++){var i=this.measuresScroller.getMeasureData(h);if(i.hasVoice(this.opts.voiceIdx)){var j,k=i.getVoice(this.opts.voiceIdx);for(j=h!==c?k.getNbNotes()-1:g,e=null===e?f:0;e<=j;e++){var l=k.getNote(e);if(d.hasSlur(l))throw new a}}}},m.checkLeftSlur=function(){var b={measureIdx:this.opts.startMeasureIdx,noteIdx:this.opts.startNoteIdx,voiceIdx:this.opts.voiceIdx};if(null!==i(this.measuresScroller,b))throw new a},m.checkRightSlur=function(){var b={measureIdx:this.opts.stopMeasureIdx,noteIdx:this.opts.stopNoteIdx,voiceIdx:this.opts.voiceIdx};if(null!==j(this.measuresScroller,b))throw new a},m.getVoice=function(){return this.measuresScroller.getVoice(this.opts.voiceIdx)},m.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a={partIdx:this.opts.partIdx,startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,voiceIdx:this.opts.voiceIdx,startNoteIdx:this.opts.startNoteIdx,stopNoteIdx:this.opts.stopNoteIdx};new k(this.measuresScroller,a,this.cancelStack).perform(),this.updateStack()},m.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,startMeasureUuid:a.startMeasureUuid,startDivisions:a.startDpq,startTimePos:a.startTimePos,stopMeasureUuid:a.stopMeasureUuid,stopDivisions:a.stopDpq,stopTimePos:a.stopTimePos,voiceIdx:this.opts.voiceIdx}};this.cancelStack.storeAction(b)}},m.updateStack=function(){var a=this.getLocation(),b={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuid:a.startMeasureUuid,divisions:a.startDpq,timePos:a.startTimePos,voiceIdx:this.opts.voiceIdx}};this.cancelStack.push(b)},m.getLocation=function(){if(null===this.location){var a=this.measuresScroller.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.startMeasureIdx),d=this.measuresScroller.getMeasureData(this.opts.startMeasureIdx),e=d.getDpqValue(),f=d.getVoice(this.opts.voiceIdx),g=f.getRangeSpace(0,this.opts.startNoteIdx),h=a.getMeasureUuid(this.opts.stopMeasureIdx),i=this.measuresScroller.getMeasureData(this.opts.stopMeasureIdx),j=i.getDpqValue(),k=i.getVoice(this.opts.voiceIdx),l=k.getRangeSpace(0,this.opts.stopNoteIdx);this.location={partUuid:b,startMeasureUuid:c,startDpq:e,startTimePos:g,stopMeasureUuid:h,stopDpq:j,stopTimePos:l}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.NotPossibleOnTabError=function(){var b="This operation is not allowed on a tablature part.",c=a.call(this,b);return this.name=c.name="NotPossibleOnTabError",this.stack=c.stack,this.message=c.message,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}})}.call(this),function(){"use strict";var a=Adagio.Error.noChange.NoChangeError,b=Adagio.Error.noChange.SameAttrError=function(b,d,e){var f=c(b),g=a.call(this,f);return this.name=g.name="SameAttrError",this.stack=g.stack,this.message=g.message,this.type=b,this.currentAttr=d,this.newAttr=e,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"The "+a+" provided is the same than the current one."};b.KEY="key signature",b.TIME="time signature",b.CLEF="clef",b.TRANSPOSE="transposition"}.call(this),function(){"use strict";var a=Adagio.Utils.partHeaderUtils,b=Adagio.Utils.mapUtils;Adagio.edit.common.addStaffInPartHeader=function(d,f,g){var h=a.getVoiceMapping(d);h=b.map(h,c,f);var i={mapping:h,staffIdx:f};g.voices.forEach(e,i),a.setVoiceMapping(d,h),a.getStaffMapping(d).splice(f,0,g)};var c=function(a,b){var c=this.valueOf();return b=b.map(d,c)},d=function(a){return a>=this.valueOf()?a+1:a},e=function(a){var b=this;b.mapping[a]=[b.staffIdx]}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.noteUtils;Adagio.edit.common.addStaffInNotes=function(b,d){a.getNotes(b).forEach(c,d)};var c=function(a){var c=this.valueOf(),d=b.getStaffIdx(a);d>=c&&b.setStaffIdx(a,d+1)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.directionUtils,c=Adagio.Utils.intraMeasureUtils,d=Adagio.Utils.crossMeasureUtils;Adagio.edit.common.addStaffInFloatings=function(b,c){var d=a.getNbStaves(b),h=a.getStaffContentMap(b);e(h,d,c),f(h,d,c),a.setStaffContentMap(b,h);var i=a.getLeftStaffMap(b);e(i,d,c),g(i,d,c),a.setLeftStaffMap(b,i);var j=a.getRightStaffMap(b);e(j,d,c),g(j,d,c),a.setRightStaffMap(b,j)};var e=function(a,b,c){for(var d=b-1;d>=c;d--)if(void 0!==a[d]){var e=a[d];delete a[d],a[d+1]=e}},f=function(a,b,d){for(var e=d+1;e<b+1;e++)if(void 0!==a[e]){var f=a[e],g=c.getDynamics(f);g.forEach(h,e);var i=c.getPizzicatos(f);i.forEach(h,e);var j=c.getWords(f);j.forEach(h,e);var k=c.getPedals(f);k.forEach(h,e);var l=c.getOctaveShifts(f);l.forEach(h,e)}},g=function(a,b,c){for(var e=c+1;e<b+1;e++)if(void 0!==a[e]){var f=a[e];if(d.hasWedge(f)){var g=d.getWedge(f);i(g,e)}if(d.hasPedal(f)){var h=d.getPedal(f);i(h,e)}if(d.hasOctaveShift(f)){var j=d.getOctaveShift(f);i(j,e)}}},h=function(a){var b=this.valueOf();i(a,b)},i=function(a,c){b.setStaffIdx(a,c)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.directionUtils;Adagio.edit.common.addStaffInDirections=function(b,d){a.getRawDirections(b).forEach(c,d)};var c=function(a){var c=this.valueOf(),d=b.getStaffIdx(a);d>=c&&b.setStaffIdx(a,d+1)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.attributesUtils,c=Adagio.Utils.staffDetailsUtils,d=Adagio.Utils.clefUtils,e=Adagio.Utils.keyUtils,f=Adagio.Utils.timeUtils,g=Adagio.Utils.transposeUtils;Adagio.edit.common.addStaffInAttributes=function(b,c){var d=a.getNbStaves(b),e=a.getAttributes(b);h(e,d,c),a.setAttributes(b,e);var f=a.getOwnAttributes(b);h(f,d,c),a.setOwnAttributes(b,f)};var h=function(a,h,k){var l=j(k),m=b.getWrappedStaffDetails(a,h),n=m.getEntry(l);n=i(n,c),m.insertEntry(n,k);var o=m.dumpAttribute();b.setStaffDetails(a,o);var p=b.getWrappedClef(a,h),q=p.getEntry(l);q=i(q,d),p.insertEntry(q,k);var r=p.dumpAttribute();b.setClef(a,r);var s=b.getWrappedKey(a,h),t=s.getEntry(l);t=i(t,e),s.insertEntry(t,k);var u=s.dumpAttribute();b.setKey(a,u);var v=b.getWrappedTime(a,h),w=v.getEntry(l);w=i(w,f),v.insertEntry(w,k);var x=v.dumpAttribute();b.setTime(a,x);var y=b.getWrappedTranspose(a,h),z=y.getEntry(l);z=i(z,g),y.insertEntry(z,k);var A=y.dumpAttribute();b.setTranspose(a,A),b.hasNbStaves(a)&&b.setNbStaves(a,h+1)},i=function(a,b){return null===a?a:a=b.copy(a)},j=function(a){return 0===a?0:a-1}}.call(this),function(){"use strict";var a=Adagio.edit.common.addStaffInNotes,b=Adagio.edit.common.addStaffInFloatings,c=Adagio.edit.common.addStaffInDirections,d=Adagio.edit.common.addStaffInAttributes;Adagio.edit.common.addStaffInMeasure=function(e,f){a(e,f),b(e,f),c(e,f),d(e,f)}}.call(this),function(){"use strict";var a=Adagio.edit.common.addStaffInPartHeader,b=Adagio.edit.common.addStaffInMeasure,c=Adagio.edit.common.MeasureData,d=Adagio.edit.composite.FillVoiceWithRests,e=Adagio.Utils.clone,f=Adagio.Utils.partContentUtils,g=Adagio.edit.primitive.AddStaff=function(a,b,c){this.init(a,b,c)};g.NAME="primitive.AddStaff";var h=g.prototype;h.name=g.NAME,h.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},h.perform=function(){this.addStaffInPartHeader(),this.addStaffInMeasures(),this.addMeasuresVoices()},h.addStaffInPartHeader=function(){var b=this.scoreData.getPartHeader(this.opts.partIdx),c=e(this.opts.voicesData);a(b,this.opts.staffIdx,c)},h.addStaffInMeasures=function(){var a=this.scoreData.getPartContent(this.opts.partIdx);f.getMeasures(a).forEach(this.addStaffInMeasure,this)},h.addStaffInMeasure=function(a){b(a,this.opts.staffIdx)},h.addMeasuresVoices=function(){var a=this.scoreData.getPartContent(this.opts.partIdx);f.getMeasures(a).forEach(this.addMeasureVoices,this)},h.addMeasureVoices=function(a,b){this.measureIdx=b,this.measureData=new c(a),this.opts.voicesData.voices.forEach(this.addMeasureVoice,this)},h.addMeasureVoice=function(a){this.measureData.getVoicesList().insertVoice(a);var b={partIdx:this.opts.partIdx,measureIdx:this.measureIdx,voiceIdx:a,staffIdx:this.opts.staffIdx};new d(this.measureData,b).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.InconsistentAttributesError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="InconsistentAttributesError",this.stack=e.stack,this.message=e.message,this.type=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"The "+a+" in the measure range are not all the same."};b.KEY="keys signatures",b.TIME="times signatures",b.CLEF="clefs",b.TEMPO="tempo",b.SWING="swing"}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.clefUtils,c=Adagio.edit.primitive.AddOwnClef=function(a,b,c){this.init(a,b,c)};c.NAME="primitive.AddOwnClef";var d=c.prototype;d.name=c.NAME,d.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},d.perform=function(){var c=this.getMeasure(),d=a.getWrappedOwnClef(c),f=this.opts.staffIdx,g=e(d.getEntry(f)),h=b.copy(this.opts.clef);d.setEntry(h,f);var i=d.dumpAttribute();a.setOwnClef(c,i),this.updateStack(g),this.opts.measureIdx>0&&this.updateStackDraw()};var e=function(a){return null===a?null:b.copy(a)};d.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},d.updateStack=function(a){var c={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,previousClef:a,newClef:b.copy(this.opts.clef)}};this.cancelStack.push(c)},d.updateStackDraw=function(){var a={type:this.name+"-draw",opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx-1}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.edit.primitive.AddOwnClef,b=Adagio.Utils.measureUtils,c=Adagio.Utils.clefUtils,d=Adagio.edit.composite.AddOwnClefIfNeeded=function(a,b,c){this.init(a,b,c)};d.NAME="composite.AddOwnClefIfNeeded";var e=d.prototype;e.name=d.NAME,e.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.measure=null},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.needAddOwnClef()&&this.addOwnClef()},e.needAddOwnClef=function(){return!this.hasOwnClef()||!this.hasSameClef()},e.hasOwnClef=function(){var a=this.getMeasure();return b.getWrappedOwnClef(a).hasEntry(this.opts.staffIdx)},e.hasSameClef=function(){var a=this.getMeasure(),d=b.getWrappedOwnClef(a),e=d.getEntry(this.opts.staffIdx);return c.isSame(e,this.opts.clef)},e.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},e.addOwnClef=function(){var b=c.copy(this.opts.clef),d={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,clef:b};new a(this.scoreData,d,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.clefUtils,c=Adagio.edit.primitive.RemoveOwnClef=function(a,b,c){this.init(a,b,c)};c.NAME="primitive.RemoveOwnClef";var d=c.prototype;d.name=c.NAME,d.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a=this.removeOwnClef();this.updateStack(a),this.opts.measureIdx>0&&this.updateStackDraw()},d.removeOwnClef=function(){var c=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx),d=a.getWrappedOwnClef(c),e=this.opts.staffIdx,f=d.getEntry(e);f=b.copy(f),d.setEntry(null,e);var g=d.dumpAttribute();return a.setOwnClef(c,g),f},d.updateStack=function(a){var b={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,removedClef:a}};this.cancelStack.push(b)},d.updateStackDraw=function(){var a={type:this.name+"-draw",opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx-1}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.edit.primitive.RemoveOwnClef,b=Adagio.Utils.measureUtils,c=Adagio.edit.composite.RemoveOwnClefIfNeeded=function(a,b,c){this.init(a,b,c)};c.NAME="composite.RemoveOwnClefIfNeeded";var d=c.prototype;d.name=c.NAME,d.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.measure=null},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.hasOwnClef()&&this.removeOwnClef()},d.hasOwnClef=function(){var a=this.getMeasure();return b.getWrappedOwnClef(a).hasEntry(this.opts.staffIdx)},d.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},d.removeOwnClef=function(){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx};new a(this.scoreData,b,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.edit.composite.AddOwnClefIfNeeded,b=Adagio.edit.composite.RemoveOwnClefIfNeeded,c=Adagio.Utils.measureUtils,d=Adagio.Utils.clefUtils,e=Adagio.edit.composite.UpdateOwnClef=function(a,b,c){this.init(a,b,c)};e.NAME="composite.UpdateOwnClef";var f=e.prototype;f.name=e.NAME,f.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.measures=null},f.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.shouldHaveOwnClef()?this.addOwnClef():this.removeOwnClef()},f.shouldHaveOwnClef=function(){return!this.hasPreviousMeasure()||this.isPreviousMeasureClefDifferent()},f.hasPreviousMeasure=function(){return this.opts.measureIdx>0},f.isPreviousMeasureClefDifferent=function(){var a=this.getCurrentMeasureClef(),b=this.getPreviousMeasureClef();return!d.isSame(b,a)},f.getCurrentMeasureClef=function(){return this.getMeasureClef(this.opts.measureIdx)},f.getPreviousMeasureClef=function(){return this.getMeasureClef(this.opts.measureIdx-1)},f.getMeasureClef=function(a){var b=this.getMeasure(a);return c.getWrappedClef(b).getEntry(this.opts.staffIdx)},f.getMeasure=function(a){return this.getMeasures(a)[a]},f.getMeasures=function(){return null===this.measures&&(this.measures=this.scoreData.getPartMeasures(this.opts.partIdx)),this.measures},f.addOwnClef=function(){var b=this.getCurrentMeasureClef();b=d.copy(b);var c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,clef:b};new a(this.scoreData,c,this.cancelStack).perform()},f.removeOwnClef=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx};new b(this.scoreData,a,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.edit.composite.UpdateOwnClef,b=Adagio.edit.composite.UpdateMeasuresRangeOwnClef=function(a,b,c){this.init(a,b,c)};b.NAME="composite.UpdateMeasuresRangeOwnClef";var c=b.prototype;c.name=b.NAME,c.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},c.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);for(var a=this.opts.startMeasureIdx;a<=this.opts.stopMeasureIdx;a++)this.updateMeasureClef(a);this.hasMeasureAfter()&&this.updateMeasureClef(this.opts.stopMeasureIdx+1)},c.hasMeasureAfter=function(){var a=this.scoreData.getNbMeasures();return this.opts.stopMeasureIdx+1<a},c.updateMeasureClef=function(b){var c={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,measureIdx:b};new a(this.scoreData,c,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.clefUtils,c=Adagio.edit.primitive.SetClef=function(a,b,c){this.init(a,b,c)};c.NAME="primitive.SetClef";var d=c.prototype;d.name=c.NAME,d.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},d.perform=function(){var a=this.setClef();this.updateStack(a)},d.setClef=function(){var c=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx),d=a.getWrappedClef(c),e=this.opts.staffIdx,f=d.getEntry(e);f=b.copy(f);var g=b.copy(this.opts.clef);d.setEntry(g,e);var h=d.dumpAttribute();return a.setClef(c,h),f},d.updateStack=function(a){var c=b.copy(this.opts.clef),d={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,previousClef:a,newClef:c}};this.cancelStack.push(d)}}.call(this),function(){"use strict";var a=Adagio.Utils.clefUtils,b=Adagio.edit.primitive.SetClef,c=Adagio.edit.composite.SetMeasuresRangeClef=function(a,b,c){this.init(a,b,c)};c.NAME="composite.SetMeasuresRangeClef";var d=c.prototype;d.name=c.NAME,d.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);for(var a=this.opts.startMeasureIdx;a<=this.opts.stopMeasureIdx;a++)this.setMeasureClef(a)},d.setMeasureClef=function(c){var d=a.copy(this.opts.clef),e={partIdx:this.opts.partIdx,measureIdx:c,staffIdx:this.opts.staffIdx,clef:d};new b(this.scoreData,e,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Utils.clefUtils,b=Adagio.edit.composite.UpdateMeasuresRangeOwnClef,c=Adagio.edit.composite.SetMeasuresRangeClef,d=Adagio.edit.composite.SetClefSegment=function(a,b,c){this.init(a,b,c)};d.NAME="composite.SetClefSegment";var e=d.prototype;e.name=d.NAME,e.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.setClef(),this.updateOwnClef()},e.setClef=function(){var b=a.copy(this.opts.clef),d={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,clef:b};new c(this.scoreData,d,this.cancelStack).perform()},e.updateOwnClef=function(){var a={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx};new b(this.scoreData,a,this.cancelStack).perform()}}.call(this),function(){"use strict"
;var a=Adagio.Error.client.BadMeasureIdxError,b=Adagio.Error.noChange.SameAttrError,c=Adagio.Error.client.RevertRangeError,d=Adagio.Error.client.InconsistentAttributesError,e=Adagio.Error.client.NotPossibleOnUnpitchedError,f=Adagio.Error.client.BadVoiceError,g=Adagio.Error.value.BadClefSignError,h=Adagio.Utils.measureUtils,i=Adagio.Utils.clefUtils,j=Adagio.Utils.math,k=Adagio.edit.composite.SetClefSegment,l=Adagio.edit.common.convertPartUuidToGetPartIdx,m=Adagio.edit.common.convertMeasuresUuidsToMeasuresIdxs,n=Adagio.edit.action.SetClefSegment=function(a,b,c){this.init(a,b,c)};n.NAME="action.SetClefSegment";var o=n.prototype;o.name=n.NAME,o.init=function(a,b,c){m(a,b),l(a,b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.location=null,this.firstClef=null},o.checkPreconditions=function(){this.checkClef(),this.checkPitchedPart(),this.checkLocation(),this.checkDifferentClef(),this.checkCurrentConsistent()},o.checkClef=function(){if(i.check(this.opts.clef),i.isTab(this.opts.clef))throw new g("TAB")},o.checkPitchedPart=function(){if(this.scoreData.isPartUnpitched(this.opts.partIdx))throw new e},o.checkLocation=function(){this.checkMeasureIdx(this.opts.startMeasureIdx),this.checkMeasureIdx(this.opts.stopMeasureIdx);var a=this.opts.startMeasureIdx,b=this.opts.stopMeasureIdx;if(b-a<0)throw new c(c.MEASURE,a,b);var d=this.getFirstMeasure(),e=h.getNbStaves(d),g=this.opts.staffIdx;if(!j.isInteger(g)||g<0||g>=e)throw new f(g,f.GET)},o.checkMeasureIdx=function(b){var c=this.scoreData.getNbMeasures();if(!j.isInteger(b)||b<0||b>=c)throw new a(b,a.GET)},o.checkDifferentClef=function(){var a=this.getFirstClef(),c=this.opts.clef;if(i.isSame(c,a))throw new b(b.CLEF,i.copy(a),i.copy(c))},o.checkCurrentConsistent=function(){for(var a=this.getFirstClef(),b=this.opts.startMeasureIdx+1;b<=this.opts.stopMeasureIdx;b++){var c=this.getClef(b);if(!i.isSame(c,a))throw new d(d.CLEF)}},o.getFirstClef=function(){return null===this.firstClef&&(this.firstClef=this.getClef(this.opts.startMeasureIdx)),this.firstClef},o.getClef=function(a){var b=this.scoreData.getMeasure(this.opts.partIdx,a);return h.getWrappedClef(b).getEntry(this.opts.staffIdx)},o.getFirstMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.startMeasureIdx)},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a=this.getFirstClef();a=i.copy(a),this.setClefSegment(),this.updateStack(a)},o.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b=a.measureUuids.slice(),c=i.copy(this.opts.clef),d={actionName:this.name,opts:{partUuid:a.partUuid,measureUuids:b,staffIdx:this.opts.staffIdx,clef:c}};this.cancelStack.storeAction(d)}},o.setClefSegment=function(){var a=i.copy(this.opts.clef),b={partIdx:this.opts.partIdx,startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,staffIdx:this.opts.staffIdx,clef:a};new k(this.scoreData,b,this.cancelStack).perform()},o.updateStack=function(a){var b=this.getLocation(),c=b.measureUuids.slice(),d=i.copy(this.opts.clef),e={type:this.name,noDraw:!0,opts:{partUuid:b.partUuid,measureUuids:c,staffIdx:this.opts.staffIdx,previousClef:a,newClef:d}};this.cancelStack.push(e)},o.getLocation=function(){if(null===this.location){var a=this.scoreData.getMeasureUuids(this.opts.startMeasureIdx,this.opts.stopMeasureIdx),b=this.scoreData.getPartUuid(this.opts.partIdx);this.location={partUuid:b,measureUuids:a}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.clefUtils,c=Adagio.edit.action.SetClefSegment,d=Adagio.edit.composite.SetClef=function(a,b,c){this.init(a,b,c)};d.NAME="composite.SetClef";var e=d.prototype;e.name=d.NAME,e.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.clef=null,this.startMeasureIdx=null,this.stopMeasureIdx=null},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);for(var a=this.opts.startMeasureIdx,b=this.opts.stopMeasureIdx,c=a;c<=b;c++){var d=this.getClef(c);this.addClef(d,c)}this.finishSegment()},e.getClef=function(b){var c=this.scoreData.getMeasure(this.opts.partIdx,b);return a.getWrappedClef(c).getEntry(this.opts.staffIdx)},e.addClef=function(a,b){this.hasOngoing()?this.isSameClef(a)?this.continueSegment(b):(this.finishSegment(),this.startSegment(a,b)):this.startSegment(a,b)},e.hasOngoing=function(){return null!==this.clef},e.startSegment=function(a,c){this.clef=b.copy(a),this.startMeasureIdx=c,this.stopMeasureIdx=c},e.isSameClef=function(a){return b.isSame(a,this.clef)},e.continueSegment=function(a){this.stopMeasureIdx=a},e.finishSegment=function(){b.isSame(this.clef,this.opts.clef)||this.setClefSegment(this.startMeasureIdx,this.stopMeasureIdx),this.clef=null,this.startMeasureIdx=null,this.stopMeasureIdx=null},e.setClefSegment=function(a,d){var e=b.copy(this.opts.clef),f={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,startMeasureIdx:a,stopMeasureIdx:d,clef:e},g=new c(this.scoreData,f,this.cancelStack);g.checkPreconditions(),g.perform()}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadMeasureIdxError,b=Adagio.Error.noChange.SameAttrError,c=Adagio.Error.client.RevertRangeError,d=Adagio.Error.client.NotPossibleOnUnpitchedError,e=Adagio.Error.client.BadVoiceError,f=Adagio.Error.value.BadClefSignError,g=Adagio.Utils.measureUtils,h=Adagio.Utils.clefUtils,i=Adagio.Utils.math,j=Adagio.edit.composite.SetClef,k=Adagio.edit.common.convertPartUuidToGetPartIdx,l=Adagio.edit.common.convertMeasuresUuidsToMeasuresIdxs,m=Adagio.edit.action.SetClef=function(a,b,c){this.init(a,b,c)};m.NAME="action.SetClef";var n=m.prototype;n.name=m.NAME,n.init=function(a,b,c){l(a,b),k(a,b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.location=null},n.checkPreconditions=function(){this.checkClef(),this.checkPitchedPart(),this.checkLocation(),this.checkDifferentClef()},n.checkClef=function(){if(h.check(this.opts.clef),h.isTab(this.opts.clef))throw new f("TAB")},n.checkPitchedPart=function(){if(this.scoreData.isPartUnpitched(this.opts.partIdx))throw new d},n.checkLocation=function(){this.checkMeasureIdx(this.opts.startMeasureIdx),this.checkMeasureIdx(this.opts.stopMeasureIdx);var a=this.opts.startMeasureIdx,b=this.opts.stopMeasureIdx;if(b-a<0)throw new c(c.MEASURE,a,b);var d=this.getFirstMeasure(),f=g.getNbStaves(d),h=this.opts.staffIdx;if(!i.isInteger(h)||h<0||h>=f)throw new e(h,e.GET)},n.checkMeasureIdx=function(b){var c=this.scoreData.getNbMeasures();if(!i.isInteger(b)||b<0||b>=c)throw new a(b,a.GET)},n.checkDifferentClef=function(){if(!this.hasSomeDifferent())throw new b(b.CLEF)},n.hasSomeDifferent=function(){for(var a=this.opts.startMeasureIdx;a<=this.opts.stopMeasureIdx;a++){var b=this.getClef(a);if(!h.isSame(b,this.opts.clef))return!0}return!1},n.getClef=function(a){var b=this.scoreData.getMeasure(this.opts.partIdx,a);return g.getWrappedClef(b).getEntry(this.opts.staffIdx)},n.getFirstMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.startMeasureIdx)},n.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.setClef()},n.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b=a.measureUuids.slice(),c=h.copy(this.opts.clef),d={actionName:this.name,opts:{partUuid:a.partUuid,measureUuids:b,staffIdx:this.opts.staffIdx,clef:c}};this.cancelStack.storeAction(d)}},n.getLocation=function(){if(null===this.location){var a=this.scoreData.getMeasureUuids(this.opts.startMeasureIdx,this.opts.stopMeasureIdx),b=this.scoreData.getPartUuid(this.opts.partIdx);this.location={partUuid:b,measureUuids:a}}return this.location},n.setClef=function(){var a=h.copy(this.opts.clef),b={partIdx:this.opts.partIdx,startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,staffIdx:this.opts.staffIdx,clef:a};new j(this.scoreData,b,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.noChange.SameAttrError,b=Adagio.edit.primitive.AddStaff,c=Adagio.edit.action.SetClef,d=Adagio.edit.common.assertPerform,e=Adagio.edit.common.CancelStack,f=Adagio.Utils.clefUtils,g=Adagio.edit.composite.AddStaff=function(a,b,c){this.init(a,b,c)};g.NAME="action.AddStaff";var h=g.prototype;h.name=g.NAME,h.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},h.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.addStaff(),this.setClef()},h.addStaff=function(){var a={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,voicesData:this.opts.voicesData};new b(this.scoreData,a,this.cancelStack).perform()},h.setClef=function(){var a=this.scoreData.getNbMeasures(),b=new e,g={partIdx:this.opts.partIdx,startMeasureIdx:0,stopMeasureIdx:a-1,staffIdx:this.opts.staffIdx,clef:f.copy(this.opts.clef)},h=new c(this.scoreData,g,b);d(h,i)};var i=function(b){return b instanceof a&&b.type===a.CLEF}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadStaffIdxError,b=Adagio.Error.client.BadPartIdxError,c=Adagio.Error.client.NotPossibleOnUnpitchedError,d=Adagio.Error.client.NotPossibleOnTabError,e=Adagio.edit.composite.AddStaff,f=Adagio.edit.common.convertPartUuidToGetPartIdx,g=Adagio.edit.common.checkSingleVoicesData,h=Adagio.edit.common.generateSingleVoicesData,i=Adagio.Utils.clone,j=Adagio.Utils.partContentUtils,k=Adagio.Utils.clefUtils,l=Adagio.edit.action.AddStaff=function(a,b,c){this.init(a,b,c)};l.NAME="action.AddStaff";var m=l.prototype;m.name=l.NAME,m.init=function(a,b,c){f(a,b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.sanitized=!1,this.location=null},m.checkPreconditions=function(){this.checkLocation(),k.check(this.opts.clef),this.sanitizeIfNeeded(),this.checkVoicesData()},m.checkLocation=function(){var c=this.scoreData.getNbParts(),d=this.opts.partIdx;if(d<0||d>=c)throw new b(d);this.checkNotTab(),this.checkNotUnpitched();var e=this.scoreData.getPartContent(d),f=j.getNbStaves(e),g=this.opts.staffIdx;if(g<0||g>f)throw new a(g,a.action.INSERT)},m.checkNotUnpitched=function(){if(this.scoreData.isPartUnpitched(this.opts.partIdx))throw new c},m.checkNotTab=function(){if(this.scoreData.isPartTab(this.opts.partIdx))throw new d},m.checkVoicesData=function(){g(this.scoreData,this.opts.partIdx,this.opts.voicesData)},m.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded(),this.storeAction(),this.addStaff(),this.updateStack()},m.sanitizeIfNeeded=function(){this.sanitized||(void 0===this.opts.voicesData&&this.generateVoicesData(),this.sanitized=!0)},m.generateVoicesData=function(){this.opts.voicesData=h(this.scoreData,this.opts.partIdx)},m.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={partUuid:a.partUuid,staffIdx:this.opts.staffIdx,voicesData:i(this.opts.voicesData),clef:k.copy(this.opts.clef)},c={actionName:this.name,opts:b};this.cancelStack.storeAction(c)}},m.addStaff=function(){var a={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,voicesData:i(this.opts.voicesData),clef:k.copy(this.opts.clef)};new e(this.scoreData,a,this.cancelStack).perform()},m.updateStack=function(){var a=this.getLocation(),b={type:this.name,opts:{partUuid:a.partUuid,staffIdx:this.opts.staffIdx}};this.cancelStack.push(b),this.cancelStack.stateNeedCompleteRedraw()},m.getLocation=function(){if(null===this.location){var a=this.scoreData.getPartUuid(this.opts.partIdx);this.location={partUuid:a}}return this.location}}.call(this),function(){"use strict";Adagio.edit.common.voiceIdxToStartStop=function(a){void 0!==a.voiceIdx&&(a.startVoiceIdx=a.voiceIdx,a.stopVoiceIdx=a.voiceIdx,delete a.voiceIdx)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Values.WedgeLocation,c=Adagio.Utils.directionUtils,d=Adagio.Utils.measureUtils,e=Adagio.Utils.wedgeUtils,f=Adagio.Utils.directionTypeUtils,g=Adagio.Data.direction.indexDirectionsByTime,h=Adagio.Data.direction.flattenIndexedDirections,i=Adagio.Data.direction.insertWedge,j=Adagio.edit.primitive.AddWedgeSide=function(a,b,c){this.init(a,b,c)};j.NAME="primitive.AddWedgeSide";var k=j.prototype;k.name=j.NAME,k.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},k.perform=function(){var a=this.getMeasure(),b=d.getWedgeDirections(a),c=g(b),e=this.opts.timePos;void 0===c[e]&&(c[e]=[]);var f=c[e],j=this.createDirection();i(j,f),b=h(c),d.setDirections(a,b),this.updateStack(a)},k.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},k.createDirection=function(){var a={};c.setStaffIdx(a,this.opts.staffIdx),c.setPlacement(a,this.opts.placement),c.setTimePos(a,this.opts.timePos);var b=this.createWedge(),d=f.createWedge(b);return c.setEntry(a,d),a},k.createWedge=function(){if(this.opts.location===b.LEFT)return e.createStartTag(this.opts.type,this.opts.nbNotes);if(this.opts.location===b.RIGHT&&null===this.opts.nbNotes)return e.createStopTag(this.opts.type);throw new a("Unexpected")},k.updateStack=function(a){var b=d.getDivisions(a),c={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:this.opts.timePos,divisions:b,staffIdx:this.opts.staffIdx,placement:this.opts.placement,location:this.opts.location,type:this.opts.type,nbNotes:this.opts.nbNotes}};this.cancelStack.push(c)}}.call(this),function(){"use strict";var a=Adagio.Values.WedgeLocation,b=Adagio.Utils.directionUtils,c=Adagio.Utils.measureUtils,d=Adagio.Utils.wedgeUtils,e=Adagio.Utils.directionTypeUtils,f=Adagio.edit.primitive.AddWedgeContinue=function(a,b,c){this.init(a,b,c)};f.NAME="primitive.AddWedgeContinue";var g=f.prototype;g.name=f.NAME,g.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},g.perform=function(){this.addLeftWedge(),this.addRightWedge(),this.updateStack()},g.addLeftWedge=function(){var a=this.getLeftMeasure(),b=this.createLeftDirection();c.setRightWedge(a,this.opts.staffIdx,b)},g.getLeftMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},g.createLeftDirection=function(){return this.createDirection(a.RIGHT_CONTINUE)},g.addRightWedge=function(){var a=this.getRightMeasure(),b=this.createRightDirection();c.setLeftWedge(a,this.opts.staffIdx,b)},g.getRightMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx+1)},g.createRightDirection=function(){return this.createDirection(a.LEFT_CONTINUE)},g.createDirection=function(a){var c={};b.setStaffIdx(c,this.opts.staffIdx),b.setPlacement(c,this.opts.placement);var f=d.create(a,this.opts.type),g=e.createWedge(f);return b.setEntry(c,g),c},g.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,placement:this.opts.placement,type:this.opts.type}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Values.DirectionType,c=Adagio.Utils.directionUtils,d=Adagio.Utils.measureUtils,e=Adagio.Utils.wedgeUtils,f=Adagio.Data.direction.splitByType,g=Adagio.Data.direction.mergeTypeDirections,h=Adagio.edit.primitive.RemoveWedgeSide=function(a,b,c){this.init(a,b,c)};h.NAME="primitive.RemoveWedgeSide";var i=h.prototype;i.name=h.NAME,i.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.removedWedgeDirection=null},i.perform=function(){var a=this.getMeasure(),c=d.getWedgeDirections(a).slice(),e=j(c,this.opts.timePos),h=f(e),i=h[b.WEDGE];this.removeWedge(i);var k=g(h);Array.prototype.push.apply(c,k),d.setDirections(a,c),this.updateStack()};var j=function(a,b){for(var d=[],e=0;e<a.length;){var f=a[e];c.getTimePos(f)===b?(a.splice(e,1),d.push(f)):e++}return d};i.removeWedge=function(b){b=b||[];for(var d=[],f=0;f<b.length;){var g=b[f],h=c.getWedge(g),i=e.getLocation(h),j=c.getStaffIdx(g);i===this.opts.location&&j===this.opts.staffIdx?(b.splice(f,1),d.push(g)):f++}if(1!==d.length){throw new a("BadNbWedges","At this location of the code, there should be exactly one wedge side to remove, for this position in time.")}this.removedWedgeDirection=d[0]},i.updateStack=function(){var a=this.getMeasure(),b=d.getDivisions(a),f=this.removedWedgeDirection,g=c.getWedge(f),h=c.getStaffIdx(f),i=c.getPlacement(f),j=e.getType(g),k={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:this.opts.timePos,divisions:b,staffIdx:h,placement:i,location:this.opts.location,type:j}};this.cancelStack.push(k)},i.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.directionUtils,c=Adagio.Utils.measureUtils,d=Adagio.Utils.wedgeUtils,e=Adagio.edit.primitive.RemoveWedgeContinue=function(a,b,c){this.init(a,b,c)};e.NAME="primitive.RemoveWedgeContinue";var f=e.prototype;f.name=e.NAME,f.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.removedWedgeDirection=null},f.perform=function(){this.removeLeftWedge(),this.removeRightWedge(),this.updateStack()},f.removeLeftWedge=function(){var b=this.getLeftMeasure();if(!c.hasRightWedge(b,this.opts.staffIdx)){throw new a("MissingRightContinueWedge","There is no right-continue wedge to remove on the left measure.")}this.removedWedgeDirection=c.getRightWedge(b,this.opts.staffIdx),c.removeRightWedge(b,this.opts.staffIdx)},f.getLeftMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},f.removeRightWedge=function(){var b=this.getRightMeasure();if(!c.hasLeftWedge(b,this.opts.staffIdx)){throw new a("MissingLeftContinueWedge","There is no left-continue wedge to remove on the left measure.")}c.removeLeftWedge(b,this.opts.staffIdx)},f.getRightMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx+1)},f.updateStack=function(){var a=this.removedWedgeDirection,c=b.getStaffIdx(a),e=b.getPlacement(a),f=b.getWedge(a),g=d.getType(f),h={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:c,placement:e,type:g}};this.cancelStack.push(h)}}.call(this),function(){"use strict";var a=Adagio.Values.WedgeLocation,b=Adagio.Utils.partContentUtils,c=Adagio.edit.common.searchWedgeSides,d=Adagio.edit.primitive.RemoveWedgeSide,e=Adagio.edit.primitive.RemoveWedgeContinue,f=Adagio.edit.composite.RemoveWedge=function(a,b,c){this.init(a,b,c)};f.NAME="composite.RemoveWedge";var g=f.prototype;g.name=f.NAME,g.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.startMeasureIdx=null,this.startTimePos=null,this.stopMeasureIdx=null,this.stopTimePos=null},g.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.searchSides(),this.removeStart(),this.removeStop(),this.removeContinues()},g.searchSides=function(){var a=this.getMeasures(),b=c(a,this.opts.measureIdx,this.opts.staffIdx,this.opts.timePos);this.startMeasureIdx=b.startMeasureIdx,this.startTimePos=b.startTimePos,this.stopMeasureIdx=b.stopMeasureIdx,this.stopTimePos=b.stopTimePos},g.getMeasures=function(){var a=this.scoreData.getPartContent(this.opts.partIdx);return b.getMeasures(a)},g.removeStart=function(){var b={partIdx:this.opts.partIdx,measureIdx:this.startMeasureIdx,staffIdx:this.opts.staffIdx,timePos:this.startTimePos,location:a.LEFT};new d(this.scoreData,b,this.cancelStack).perform()},g.removeStop=function(){var b={partIdx:this.opts.partIdx,measureIdx:this.stopMeasureIdx,staffIdx:this.opts.staffIdx,timePos:this.stopTimePos,location:a.RIGHT};new d(this.scoreData,b,this.cancelStack).perform()},g.removeContinues=function(){for(var a=this.startMeasureIdx;a<this.stopMeasureIdx;a++)this.removeContinue(a)},g.removeContinue=function(a){var b={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,measureIdx:a};new e(this.scoreData,b,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.client.NoWedgeError,b=Adagio.Error.client.BadStaffIdxError,c=Adagio.Error.client.TimePosOutOfRangeError,d=Adagio.Utils.measureUtils,e=Adagio.Utils.directionUtils,f=Adagio.Utils.math,g=Adagio.Utils.partContentUtils,h=Adagio.Data.wedge.searchWedgeType,i=Adagio.edit.common.convertPartUuidToGetPartIdx,j=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,k=Adagio.edit.common.optsToLocalGetTimePos,l=Adagio.edit.common.searchWedgeSides,m=Adagio.edit.composite.RemoveWedge,n=Adagio.edit.action.RemoveWedgeAtTimePos=function(a,b,c){this.init(a,b,c)};n.NAME="action.RemoveWedgeAtTimePos";var o=n.prototype;o.name=n.NAME,o.init=function(a,b,c){i(a,b),j(a,b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.localTimePos=null,this.measureData=null,this.location=null},o.checkPreconditions=function(){this.checkLocation(),this.checkTimePos(),this.checkExistence()},o.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx);var a=this.getMeasure(),c=d.getNbStaves(a);if(this.opts.staffIdx<0||this.opts.staffIdx>=c)throw new b(this.opts.staffIdx)},o.checkTimePos=function(){var a=this.getLocalTimePos(),b=this.getMeasure(),e=d.getNbDivisions(b);if(!f.isNumber(a)||a<0||a>=e){var g=d.getDpq(b);throw new c(a,g)}},o.checkExistence=function(){if(!this.hasWedge())throw new a},o.hasWedge=function(){var a=this.getLocalTimePos(),b=this.getMeasure(),c=d.getWedgeDirections(b);c=c.filter(p,this.opts.staffIdx);var e=q(b,this.opts.staffIdx);return null!==h(e,c,a)},o.getLocalTimePos=function(){if(null===this.localTimePos){var a=this.getMeasure();this.localTimePos=k(this.opts,a)}return this.localTimePos};var p=function(a){var b=this.valueOf();return e.getStaffIdx(a)===b};o.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)};var q=function(a,b){if(!d.hasLeftWedge(a,b))return null;var c=d.getLeftWedge(a,b);return e.getWedge(c)};o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a=this.getPreviousData();this.removeWedge(),this.updateStack(a)},o.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,staffIdx:this.opts.staffIdx,timePos:this.opts.timePos,dpq:this.opts.dpq}};this.cancelStack.storeAction(b)}},o.getPreviousData=function(){var a=this.getLocalTimePos(),b=this.scoreData.getPartContent(this.opts.partIdx),c=g.getMeasures(b),e=l(c,this.opts.measureIdx,this.opts.staffIdx,a),f=this.scoreData.getMeasureUuid(e.startMeasureIdx),h=this.scoreData.getMeasureUuid(e.stopMeasureIdx),i=this.scoreData.getMeasure(this.opts.partIdx,e.startMeasureIdx),j=d.getDpq(i),k=this.scoreData.getMeasure(this.opts.partIdx,e.stopMeasureIdx),m=d.getDpq(k);return{startMeasureUuid:f,startTimePos:e.startTimePos,stopTimePos:e.stopTimePos,startDpq:j,stopMeasureUuid:h,stopDpq:m,placement:e.placement,type:e.type}},o.removeWedge=function(){var a=this.getLocalTimePos(),b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,timePos:a};new m(this.scoreData,b,this.cancelStack).perform()},o.updateStack=function(a){var b=this.getLocation(),c={type:this.name,noDraw:!0,opts:{partUuid:b.partUuid,startMeasureUuid:a.startMeasureUuid,startTimePos:a.startTimePos,startDpq:a.startDpq,stopMeasureUuid:a.stopMeasureUuid,stopTimePos:a.stopTimePos,stopDpq:a.stopDpq,staffIdx:this.opts.staffIdx,placement:a.placement,type:a.type}};this.cancelStack.push(c)},o.getLocation=function(){if(null===this.location){var a=this.scoreData.getPartUuid(this.opts.partIdx),b=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={partUuid:a,measureUuid:b}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.directionUtils,c=Adagio.Utils.wedgeUtils,d=Adagio.Utils.math,e=Adagio.Values.WedgeLocation,f=Adagio.edit.action.RemoveWedgeAtTimePos,g=Adagio.edit.common.assertPerform,h=Adagio.edit.composite.RemoveWedgesRange=function(a,b,c){this.init(a,b,c)};h.NAME="composite.RemoveWedgesRange";var i=h.prototype;i.name=h.NAME,i.init=function(a,b,c){this.scoreData=a,this.opts=b,this.cancelStack=c,this.currentMeasureIdx=null},i.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeLeftWedges(),this.removeLeftMeasureWedges(),this.removeMiddleMeasureWedges(),this.removeRightMeasureWedges()},i.removeLeftWedges=function(){this.currentMeasureIdx=this.opts.startMeasureIdx;var a=this.getMeasure(this.currentMeasureIdx),b=this.getWedges(a);if(b=b.filter(function(a){return this.isBeforeLimit(a,this.opts.startMeasureIdx,this.opts.startTimePos,this.opts.startDpq)},this),0!==b.length){var c=b.pop();j(c)&&this.removeFromEntry(c)}else this.hasLeftWedge()&&this.removeCrossMeasureWedge()},i.removeCrossMeasureWedge=function(){this.removeWedge(0,1,this.opts.staffIdx)},i.removeLeftMeasureWedges=function(){var a=this.getWedgesStarts();a=a.filter(this.isWithinLimits,this),a.forEach(this.removeFromEntry,this);var b=this.getWedgesStops();b=b.filter(this.isWithinLimits,this),b.forEach(this.removeFromEntry,this)},i.removeMiddleMeasureWedges=function(){for(var a=this.opts.startMeasureIdx+1;a<this.opts.stopMeasureIdx;a++){this.currentMeasureIdx=a;this.getWedgesStarts().forEach(this.removeFromEntry,this);this.getWedgesStops().forEach(this.removeFromEntry,this)}},i.removeRightMeasureWedges=function(){this.currentMeasureIdx=this.opts.stopMeasureIdx;var a=this.getWedgesStarts();a=a.filter(this.isWithinLimits,this),a.forEach(this.removeFromEntry,this);var b=this.getWedgesStops();b=b.filter(this.isWithinLimits,this),b.forEach(this.removeFromEntry,this)},i.removeFromEntry=function(c){var d=b.getTimePos(c),e=b.getStaffIdx(c),f=this.getMeasure(this.currentMeasureIdx),g=a.getDpq(f);this.removeWedge(d,g,e)},i.removeWedge=function(a,b,c){var d={partIdx:this.opts.partIdx,measureIdx:this.currentMeasureIdx,timePos:a,dpq:b,staffIdx:c},e=new f(this.scoreData,d,this.cancelStack);g(e)},i.isWithinLimits=function(a){return!(this.currentMeasureIdx<this.opts.startMeasureIdx)&&(!(this.currentMeasureIdx>this.opts.stopMeasureIdx)&&(this.currentMeasureIdx>this.opts.startMeasureIdx&&this.currentMeasureIdx<this.opts.stopMeasureIdx||!(this.currentMeasureIdx===this.opts.startMeasureIdx&&!this.isAfterLimit(a,this.opts.startMeasureIdx,this.opts.startTimePos,this.opts.startDpq))&&!(this.currentMeasureIdx===this.opts.stopMeasureIdx&&!this.isBeforeLimit(a,this.opts.stopMeasureIdx,this.opts.stopTimePos,this.opts.stopDpq))))},i.isAfterLimit=function(c,e,f,g){var h=this.getMeasure(e),i=a.getDpq(h),j=d.lcm(i,g);return!(b.getTimePos(c)*j/i<f*j/g)},i.isBeforeLimit=function(c,e,f,g){var h=this.getMeasure(e),i=a.getDpq(h),j=d.lcm(i,g);return!(b.getTimePos(c)*j/i>f*j/g)},i.getWedgesStarts=function(){var a=this.getMeasure(this.currentMeasureIdx),b=this.getWedges(a);return b=b.filter(j)};var j=function(a){return b.getWedges(a).some(k)},k=function(a){return c.getLocation(a)===e.LEFT};i.getWedgesStops=function(){var a=this.getMeasure(this.currentMeasureIdx),b=this.getWedges(a);return b=b.filter(l)};var l=function(a){return b.getWedges(a).some(m)},m=function(a){return c.getLocation(a)===e.RIGHT};i.getWedges=function(c){var d=a.getWedgeDirections(c);return d=d.filter(this.isGoodStaff,this),d=d.filter(b.hasWedge)},i.isGoodStaff=function(a){return b.getStaffIdx(a)===this.opts.staffIdx},i.getMeasure=function(a){return this.scoreData.getMeasure(this.opts.partIdx,a)},i.hasLeftWedge=function(){var b=this.getMeasure(this.currentMeasureIdx);return a.hasLeftWedge(b,this.opts.staffIdx)}}.call(this),function(){"use strict";var a=Adagio.Values.WedgeLocation,b=Adagio.Utils.measureUtils,c=Adagio.edit.composite.AdaptDpqToPosition,d=Adagio.edit.primitive.AddWedgeSide,e=Adagio.edit.primitive.AddWedgeContinue,f=Adagio.edit.common.countWedgeNbNotes,g=Adagio.edit.common.MeasuresScroller,h=Adagio.edit.common.optsToLocalGetTimePos,i=Adagio.edit.composite.RemoveWedgesRange,j=Adagio.edit.composite.AddWedge=function(a,b,c){this.init(a,b,c)};j.NAME="composite.AddWedge";var k=j.prototype;k.name=j.NAME,k.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},k.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.updateStartDpq(),this.updateStopDpq(),this.removeExistingWedges(),this.addWedgeLeftSide(),this.addWedgeRightSide(),this.addWedgeContinues()},k.updateStartDpq=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.startMeasureIdx,timePos:this.opts.startTimePos,dpq:this.opts.startDpq};new c(this.scoreData,a,this.cancelStack).perform();var d=this.scoreData.getMeasure(this.opts.partIdx,this.opts.startMeasureIdx),e={timePos:this.opts.startTimePos,dpq:this.opts.startDpq};this.opts.startTimePos=h(e,d),this.opts.startDpq=b.getDpq(d)},k.updateStopDpq=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.stopMeasureIdx,timePos:this.opts.stopTimePos,dpq:this.opts.stopDpq};new c(this.scoreData,a,this.cancelStack).perform();var d=this.scoreData.getMeasure(this.opts.partIdx,this.opts.stopMeasureIdx),e={timePos:this.opts.stopTimePos,dpq:this.opts.stopDpq};this.opts.stopTimePos=h(e,d),this.opts.stopDpq=b.getDpq(d)},k.removeExistingWedges=function(){var a={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,startTimePos:this.opts.startTimePos,stopTimePos:this.opts.stopTimePos,startDpq:this.opts.startDpq,stopDpq:this.opts.stopDpq};new i(this.scoreData,a,this.cancelStack).perform()},k.addWedgeLeftSide=function(){var b=this.getNbNotesInWedge(),c={partIdx:this.opts.partIdx,measureIdx:this.opts.startMeasureIdx,timePos:this.opts.startTimePos,placement:this.opts.placement,type:this.opts.type,location:a.LEFT,staffIdx:this.opts.staffIdx,nbNotes:b};new d(this.scoreData,c,this.cancelStack).perform()},k.getNbNotesInWedge=function(){var a=this.scoreData.getPartMeasures(this.opts.partIdx),b=new g(a,this.opts.partIdx,this.scoreData);return f(b,this.opts)},k.addWedgeRightSide=function(){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.stopMeasureIdx,timePos:this.opts.stopTimePos,placement:this.opts.placement,type:this.opts.type,location:a.RIGHT,staffIdx:this.opts.staffIdx,nbNotes:null};new d(this.scoreData,b,this.cancelStack).perform()},k.addWedgeContinues=function(){for(var a=this.opts.startMeasureIdx;a<this.opts.stopMeasureIdx;a++)this.addWedgeContinue(a)},k.addWedgeContinue=function(a){var b={partIdx:this.opts.partIdx,measureIdx:a,placement:this.opts.placement,type:this.opts.type,staffIdx:this.opts.staffIdx};new e(this.scoreData,b,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadStaffIdxError,b=Adagio.Error.client.RevertRangeError,c=Adagio.Error.client.EmptyRangeError,d=Adagio.Error.client.TimePosOutOfRangeError,e=Adagio.Error.value.BadPlacementDirectionError,f=Adagio.Error.value.BadWedgeTypeError,g=Adagio.Values.DirectionPlacement,h=Adagio.Values.WedgeType,i=Adagio.Utils.measureUtils,j=Adagio.Utils.math,k=Adagio.edit.composite.AddWedge,l=Adagio.edit.common.convertPartUuidToGetPartIdx,m=Adagio.edit.common.convertMeasureUuidToStartStop,n=Adagio.edit.common.optsToLocalGetTimePos,o=Adagio.edit.action.AddWedgeAtTimePos=function(a,b,c){this.init(a,b,c)};o.NAME="action.AddWedgeAtTimePos";var p=o.prototype;p.name=o.NAME,p.init=function(a,b,c){l(a,b),m(a,b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.location=null},p.checkPreconditions=function(){this.checkLocation(),this.checkValues()},p.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.startMeasureIdx),this.scoreData.checkMeasureIdx(this.opts.stopMeasureIdx),this.checkStartTimePos(),this.checkStopTimePos(),this.checkRevertRange()},p.checkStartTimePos=function(){var a=this.getStartMeasure(),b={dpq:this.opts.startDpq,timePos:this.opts.startTimePos},c=n(b,a),e=i.getNbDivisions(a);if(!j.isNumber(c)||c<0||c>=e){var f=i.getDpq(a);throw new d(c,f)}},p.checkStopTimePos=function(){var a=this.getStopMeasure(),b={dpq:this.opts.stopDpq,timePos:this.opts.stopTimePos
},c=n(b,a),e=i.getNbDivisions(a);if(!j.isNumber(c)||c<0||c>e){var f=i.getDpq(a);throw new d(c,f)}},p.checkRevertRange=function(){var a=this.opts.startMeasureIdx,d=this.opts.stopMeasureIdx,e=d-a;if(e<0)throw new b(b.MEASURE,a,d);if(0===e){var f=this.opts.startTimePos,g=this.opts.stopTimePos;if(f>g)throw new b(b.TIME_POS,f,g);if(f===g)throw new c(c.TIME_POS)}},p.checkValues=function(){this.checkStaffIdx(),g.check(this.opts.placement),h.check(this.opts.type)},p.checkStaffIdx=function(){var b=this.getStartMeasure(),c=i.getNbStaves(b);if(this.opts.staffIdx<0||this.opts.staffIdx>=c)throw new a(this.opts.staffIdx)},p.checkParam=function(){if(!g.isValid(this.opts.placement))throw new e(this.opts.placement);if(!h.isValid(this.opts.wedge))throw new f(this.opts.wedge)},p.getStartMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.startMeasureIdx)},p.getStopMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.stopMeasureIdx)},p.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.addWedge(),this.updateStack()},p.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,startMeasureUuid:a.startMeasureUuid,startTimePos:this.opts.startTimePos,startDpq:this.opts.startDpq,stopMeasureUuid:a.stopMeasureUuid,stopTimePos:this.opts.stopTimePos,stopDpq:this.opts.stopDpq,staffIdx:this.opts.staffIdx,placement:this.opts.placement,type:this.opts.type}};this.cancelStack.storeAction(b)}},p.addWedge=function(){var a={partIdx:this.opts.partIdx,startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,staffIdx:this.opts.staffIdx,startTimePos:this.opts.startTimePos,startDpq:this.opts.startDpq,stopTimePos:this.opts.stopTimePos,stopDpq:this.opts.stopDpq,placement:this.opts.placement,type:this.opts.type};new k(this.scoreData,a,this.cancelStack).perform()},p.updateStack=function(){var a=this.getLocation(),b={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuid:a.startMeasureUuid,timePos:this.opts.startTimePos,dpq:this.opts.startDpq,staffIdx:this.opts.staffIdx}};this.cancelStack.push(b)},p.getLocation=function(){if(null===this.location){var a=this.scoreData.getPartUuid(this.opts.partIdx),b=this.scoreData.getMeasureUuid(this.opts.startMeasureIdx),c=this.scoreData.getMeasureUuid(this.opts.stopMeasureIdx);this.location={partUuid:a,startMeasureUuid:b,stopMeasureUuid:c}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Utils.partContentUtils,b=Adagio.Utils.noteUtils,c=Adagio.edit.common.MeasuresScroller,d=Adagio.edit.common.voiceIdxToStartStop,e=Adagio.edit.action.AddWedgeAtTimePos,f=Adagio.edit.action.AddWedge=function(a,b,c){this.init(a,b,c)};f.NAME="action.AddWedge";var g=f.prototype;g.name=f.NAME,g.init=function(a,b,c){d(b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.measuresScroller=null,this.action=null,this.startTimePos=null,this.stopTimePos=null},g.checkPreconditions=function(){this.checkLocation(),this.getAction().checkPreconditions()},g.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.startMeasureIdx),this.scoreData.checkMeasureIdx(this.opts.stopMeasureIdx),this.getStartMeasureData().checkVoiceIdx(this.opts.startVoiceIdx),this.getStartVoice().checkNoteIdx(this.opts.startNoteIdx),this.getStopMeasureData().checkVoiceIdx(this.opts.stopVoiceIdx),this.getStopVoice().checkInsertionIdx(this.opts.stopNoteIdx)},g.getAction=function(){if(null===this.action){var a=this.getStartMeasureData(),b=a.getDpqValue(),c=this.getStartTimePos(),d=this.getStopMeasureData(),f=d.getDpqValue(),g=this.getStopTimePos(),h={partIdx:this.opts.partIdx,startMeasureIdx:this.opts.startMeasureIdx,startTimePos:c,startDpq:b,stopMeasureIdx:this.opts.stopMeasureIdx,stopTimePos:g,stopDpq:f,staffIdx:this.opts.staffIdx,placement:this.opts.placement,type:this.opts.type};this.action=new e(this.scoreData,h,this.cancelStack)}return this.action},g.getStartTimePos=function(){if(null===this.startTimePos){var a=this.getStartVoice();this.startTimePos=h(a,this.opts.startNoteIdx)}return this.startTimePos},g.getStopTimePos=function(){if(null===this.stopTimePos){var a=this.getStopVoice();this.stopTimePos=h(a,this.opts.stopNoteIdx)}return this.stopTimePos};var h=function(a,c){for(var d=0,e=0;e<c;e++){var f=a.getNote(e);d+=b.getDuration(f)}return d};g.getStartVoice=function(){return this.getStartMeasureData().getVoice(this.opts.startVoiceIdx)},g.getStopVoice=function(){return this.getStopMeasureData().getVoice(this.opts.stopVoiceIdx)},g.getStartMeasureData=function(){return this.getMeasuresScroller().getMeasureData(this.opts.startMeasureIdx)},g.getStopMeasureData=function(){return this.getMeasuresScroller().getMeasureData(this.opts.stopMeasureIdx)},g.getMeasuresScroller=function(){if(null===this.measuresScroller){var b=this.opts.partIdx,d=this.scoreData.getPartContent(b),e=a.getMeasures(d);this.measuresScroller=new c(e,b,this.scoreData)}return this.measuresScroller},g.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a=this.getAction();a.cancelStack=this.cancelStack,a.perform()}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.AlreadyTupletError=function(){var b="There is already a tuplet at this location.",c=a.call(this,b);return this.name=c.name="AlreadyTupletError",this.stack=c.stack,this.message=c.message,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}})}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.IncompatibleTupletError=function(){var b="Cannot insert this tuplet type on this note.",c=a.call(this,b);return this.name=c.name="IncompatibleTupletError",this.stack=c.stack,this.message=c.message,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}})}.call(this),function(){"use strict";var a=Adagio.Utils.timeModifUtils,b=Adagio.Utils.tupletBoundUtils,c=Adagio.Utils.durationUtils,d=Adagio.Utils.noteUtils,e=Adagio.Utils.typeUtils,f=Adagio.Values.TupletType,g=Adagio.Values.DurationType,h=Adagio.edit.common.extractNoteDurationType,i=Adagio.edit.composite.AdaptDpqToDuration,j=Adagio.edit.action.ChangeDuration,k=Adagio.edit.action.UnbeamNote,l=Adagio.edit.values.InsertMode,m=Adagio.edit.common.initMeasureData,n=Adagio.edit.composite.AddTuplet=function(a,b,c){this.init(a,b,c)};n.NAME="composite.AddTuplet";var o=n.prototype;o.name=n.NAME,o.initMeasureData=m,o.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.unbeam(),this.gatherData(),this.increaseDivisionsIfNeeded(),this.createTuplet(),this.clearTupletCache(),this.resizeNotes()},o.unbeam=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new k(this.measureData,a,this.cancelStack).performIfPossible()},o.gatherData=function(){var b=this.getUpperTimeModif();this.localTimeModif=f.getTimeModif(this.opts.tupletType),this.subTimeModif=a.combine(b,this.localTimeModif);var c=this.getUpperDurationType(),d=a.getShiftToShardDurationType(this.localTimeModif);this.subDurationType=c+d;var e=this.getUpperTupletLevel();this.subTupletLevel=e+1},o.getUpperDurationType=function(){var a=this.getVoice(),b=a.getNote(this.opts.noteIdx),c=this.measureData.getDivisionsPerQuarterValue();return h(b,c)},o.getUpperTimeModif=function(){return this.getVoice().getAbsoluteTimeModif()},o.getUpperTupletLevel=function(){return this.getVoice().getTupletLevel()},o.increaseDivisionsIfNeeded=function(){var b=this.subTimeModif,c=this.subDurationType,d={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,durationType:c,nbDots:0,timeModif:a.copy(b)};new i(this.measureData,d,this.cancelStack).perform()},o.createTuplet=function(){var a=this.getVoice(),c=this.subTupletLevel,e=this.localTimeModif,f=this.subDurationType,g=b.createStart(c,e,f),h=b.createStop(c),i=a.getNote(this.opts.noteIdx),j=[g,h];d.addTupletBounds(i,j),q(a,this.opts.noteIdx).forEach(p,this.subTimeModif)};var p=function(b){var c=this;c=a.copy(c),d.setTimeModif(b,c)},q=function(a,b){return a.isRest(b)?[a.getNote(b)]:e.makeArray(a.getChord(b))};o.getVoice=function(){var a=this.opts.voiceIdx,b=this.opts.noteIdx;return this.measureData.getVoiceOrTupletForGet(a,b)},o.clearTupletCache=function(){this.measureData.clearTupletCache(this.opts.voiceIdx)},o.resizeNotes=function(){for(var a=this.getVoice(),b=this.getShardDuration(),c=a.getStartNoteIdx(),e=c;e<=a.getStopNoteIdx();e++){var f=a.getNote(e);d.getDuration(f)>b&&this.resizeNote(e)}},o.resizeNote=function(a){var b=this.getVoice(),c=b.getDurationType(),d={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:a,insertMode:l.REPLACE,durationType:c,nbDots:0,record:!1};new j(this.measureData,d,this.cancelStack).perform()},o.getShardDuration=function(){var a=this.getVoice(),b=this.measureData.getDivisionsPerQuarterValue(),d=a.getAbsoluteTimeModif(),e=a.getDurationType(),f=g.toQuarterDuration(e),h=c.quarterToDuration(f,b);return c.normalToActual(h,d)}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Utils.noteUtils,c=Adagio.edit.values.InsertMode,d=Adagio.edit.common.calcDuration,e=Adagio.edit.common.convertTimePosToInsertNoteIdx,f=Adagio.edit.common.CancelStack,g=Adagio.edit.action.ChangeDurationFormat;Adagio.edit.common.convertTimePosToDurationNoteIdx=function(h,i){if(void 0!==i.timePos){e(h,i);var j=h.getVoice(i.voiceIdx),k=j.getNote(i.noteIdx),l=h.getDpqValue(),m=b.getTimeModif(k);if(d(i,l,m)===b.getDuration(k))return;if(!b.isRest(k)){throw new a("Cannot adjust duration of a non rest.","NonRestDurationAdjust")}var n={partIdx:i.partIdx,measureIdx:i.measureIdx,voiceIdx:i.voiceIdx,noteIdx:i.noteIdx,insertMode:c.REPLACE,formatRests:!1,durationType:i.durationType,nbDots:i.nbDots,record:!1},o=new f,p=new g(h,n,o);p.checkPreconditions(),p.perform()}}}.call(this),function(){"use strict";var a=Adagio.Error.client.AlreadyTupletError,b=Adagio.Error.client.DurationTooSmallError,c=Adagio.Error.client.IncompatibleTupletError,d=Adagio.Utils.noteUtils,e=Adagio.Utils.timeModifUtils,f=Adagio.Values.TupletType,g=Adagio.Values.DurationType,h=Adagio.edit.composite.AddTuplet,i=Adagio.edit.common.extractNoteDurationType,j=Adagio.edit.common.initMeasureData,k=Adagio.edit.common.convertPartUuidToGetPartIdx,l=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,m=Adagio.edit.common.convertTimePosToDurationNoteIdx,n=Adagio.edit.action.AddTuplet=function(a,b,c){this.init(a,b,c)};n.NAME="action.AddTuplet";var o=n.prototype;o.name=n.NAME,o.initMeasureData=j,o.init=function(a,b,c){k(a,b),l(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.location=null,m(this.measureData,this.opts)},o.checkPreconditions=function(){this.checkValues(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkNoteIdx(),this.checkNotTuplet(),this.checkTupletCompatibility(),this.checkShardDuration()},o.checkValues=function(){f.check(this.opts.tupletType)},o.checkNoteIdx=function(){this.measureData.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},o.checkNotTuplet=function(){var b=this.getVoiceOrTupletForGet(),c=b.getAbsoluteTimeModif();if(!e.isNormal(c))throw new a},o.checkTupletCompatibility=function(){var a=this.getNote(),b=d.getNbDots(a),g=f.getTimeModif(this.opts.tupletType);if(e.getWholeNbDots(g)!==b)throw new c},o.checkShardDuration=function(){var a=this.getNote(),c=this.getDurationType(a),d=f.getTimeModif(this.opts.tupletType),h=e.getShiftToShardDurationType(d),i=c+h;if(!g.isValid(i))throw new b},o.getDurationType=function(a){var b=this.measureData.getDivisionsPerQuarterValue();return i(a,b)},o.getNote=function(){return this.getVoiceOrTupletForGet().getNote(this.opts.noteIdx)},o.getVoiceOrTupletForGet=function(){var a=this.opts.voiceIdx,b=this.opts.noteIdx;return this.measureData.getVoiceOrTupletForGet(a,b)},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.addTuplet(),this.updateStack()},o.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b=this.getNote(),c=d.getNbDots(b),f=i(b,a.dpq),g=d.getTimeModif(b);g=e.copy(g);var h={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos,durationType:f,nbDots:c,timeModif:g,tupletType:this.opts.tupletType}};this.cancelStack.storeAction(h)}},o.addTuplet=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,tupletType:this.opts.tupletType};new h(this.measureData,a,this.cancelStack).perform()},o.updateStack=function(){var a=this.getLocation(),b={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,timePos:a.timePos,divisions:a.dpq,tupletType:this.opts.tupletType}};this.cancelStack.push(b)},o.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.client.AlreadyTupletError,b=Adagio.Error.client.NotEnoughSpaceError,c=Adagio.Error.noChange.NoChangeError,d=Adagio.Utils.noteUtils,e=Adagio.Utils.durationUtils,f=Adagio.Utils.timeModifUtils,g=Adagio.Values.TupletType,h=Adagio.edit.action.AddTuplet,i=Adagio.edit.action.ChangeDurationCrossMeasure,j=Adagio.edit.values.InsertMode,k=Adagio.edit.common.initMeasureData,l=Adagio.edit.common.convertPartUuidToGetPartIdx,m=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,n=Adagio.edit.common.convertTimePosToDurationNoteIdx,o=Adagio.edit.common.extractNoteDurationType,p=Adagio.edit.common.assertPerform,q=Adagio.edit.action.AddTupletChangeDuration=function(a,b,c){this.init(a,b,c)};q.NAME="action.AddTupletChangeDuration";var r=q.prototype;r.name=q.NAME,r.initMeasureData=k,r.init=function(a,b,c){l(a,b),m(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.location=null,n(this.measureData,this.opts)},r.checkPreconditions=function(){this.checkValues(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkNoteIdx(),this.checkNotTuplet(),this.checkSpaceAvailable()},r.checkValues=function(){g.check(this.opts.tupletType)},r.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},r.checkNotTuplet=function(){var b=this.getVoiceOrTupletForGet(),c=b.getAbsoluteTimeModif();if(!f.isNormal(c))throw new a},r.getVoiceOrTupletForGet=function(){var a=this.opts.voiceIdx,b=this.opts.noteIdx;return this.measureData.getVoiceOrTupletForGet(a,b)},r.checkSpaceAvailable=function(){var a=this.getRequiredDuration(),c=this.getAvailableDuration();if(a>c){var d=this.measureData.getDpqValue(),e=f.createDefault();throw new b(a,c,d,e)}},r.getAvailableDuration=function(){for(var a=this.getVoice(),b=a.getNbNotes(),c=0,e=this.opts.noteIdx;e<b;e++){var f=a.getNote(e);c+=d.getDuration(f)}return c},r.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.changeDuration(),this.addTuplet()},r.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b=this.getNote(),c=d.getNbDots(b),e=o(b,a.dpq),g=d.getTimeModif(b);g=f.copy(g);var h={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos,durationType:e,nbDots:c,timeModif:g,tupletType:this.opts.tupletType}};this.cancelStack.storeAction(h)}},r.changeDuration=function(){var a=this.getRequiredDuration(),b=this.measureData.getDpqValue(),c=f.createDefault(),d=e.actualDivisionsToDurationOpts(a,b,c),g={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,durationType:d.durationType,nbDots:d.nbDots,insertMode:j.REPLACE,record:!1,formatRests:!1},h=new i(this.measureData,g,this.cancelStack);p(h,s)};var s=function(a){return a instanceof c};r.getRequiredDuration=function(){var a=this.getActualDuration(),b=g.getTimeModif(this.opts.tupletType);return a*f.getNormal(b)},r.getActualDuration=function(){var a=this.getNote(),b=this.measureData.getDpqValue(),c=d.getQuarterDuration(a,b);return c=e.extractBaseDuration(c),e.quarterToDivisions(c,b)},r.getNote=function(){return this.getVoice().getNote(this.opts.noteIdx)},r.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},r.addTuplet=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,tupletType:this.opts.tupletType},b=new h(this.measureData,a,this.cancelStack);p(b)},r.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadOrnamentsOptsError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadOrnamentsOptsError",this.stack=e.stack,this.message=e.message,this.type=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"Ornament option "+a+" is invalid."}}.call(this),function(){"use strict";var a=Adagio.edit.common.initMeasureData,b=Adagio.Utils.noteUtils,c=Adagio.edit.primitive.AddOrnament=function(a,b,c){this.init(a,b,c)};c.NAME="primitive.AddOrnament";var d=c.prototype;d.name=c.NAME,d.initMeasureData=a,d.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},d.perform=function(){var a=this.measureData.getVoice(this.opts.voiceIdx),c=a.getNote(this.opts.noteIdx);b.addOrnament(c,this.opts.ornamentType,this.opts.ornamentsOpts),this.updateStack()},d.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,ornamentType:this.opts.ornamentType}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.edit.primitive.AddOrnament,c=Adagio.edit.action.RemoveOrnament,d=Adagio.edit.common.assertPerform,e=Adagio.edit.common.initMeasureData,f=Adagio.edit.composite.AddOrnament=function(a,b,c){this.init(a,b,c)};f.NAME="composite.AddOrnament";var g=f.prototype;g.name=f.NAME,g.initMeasureData=e,g.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},g.perform=function(){var a=this.measureData.getVoice(this.opts.voiceIdx),c=a.getNote(this.opts.noteIdx);this.removeIncompatibleOrnaments(c),new b(this.measureData,this.opts,this.cancelStack).perform()},g.removeIncompatibleOrnaments=function(b){a.getIncompatibleOrnaments(b,this.opts.ornamentType).forEach(this.removeIncompatibleOrnament,this)},g.removeIncompatibleOrnament=function(a){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,ornamentType:a,noteIdx:this.opts.noteIdx},e=new c(this.measureData,b,this.cancelStack);d(e)}}.call(this),function(){"use strict";var a=Adagio.Error.value.BadOrnamentTypeError,b=Adagio.Error.value.BadOrnamentsOptsError,c=Adagio.Error.noChange.NoChangeError,d=Adagio.edit.common.initMeasureData,e=Adagio.edit.common.convertTimePosToGetNoteIdx,f=Adagio.edit.common.convertPartUuidToGetPartIdx,g=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,h=Adagio.Utils.clone,i=Adagio.Utils.noteUtils,j=Adagio.Utils.math,k=Adagio.Values.OrnamentType,l=Adagio.Values.DirectionPlacement,m=Adagio.Values.BooleanType,n=Adagio.edit.composite.AddOrnament,o=Adagio.edit.action.AddOrnament=function(a,b,c){this.init(a,b,c)};o.NAME="action.AddOrnament";var p=o.prototype;p.initMeasureData=d,p.name=o.NAME,p.init=function(a,b,c){f(a,b),g(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=h(b),this.location=null,e(this.measureData,this.opts)},p.checkPreconditions=function(){this.checkLocation(),this.checkOrnamentsOptsContent(),this.checkParam()},p.checkLocation=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx);var a=this.measureData.getVoice(this.opts.voiceIdx);a.checkNoteIdx(this.opts.noteIdx),a.checkNotRest(this.opts.noteIdx)},p.checkParam=function(){if(!k.isValid(this.opts.ornamentType))throw new a(this.opts.ornamentType);var b=this.measureData.getVoice(this.opts.voiceIdx),d=b.getNote(this.opts.noteIdx);if(i.hasOrnaments(d)&&i.hasOrnament(d,this.opts.ornamentType,this.opts.ornamentsOpts))throw new c},p.checkOrnamentsOptsContent=function(){switch(void 0===this.opts.ornamentsOpts&&(this.opts.ornamentsOpts={}),this.opts.ornamentType){case k.TREMOLO:var a=parseInt(this.opts.ornamentsOpts.nbBeam,10);if(!j.isInteger(a)||a<1||a>5)throw new b("nbBeam");break;case k.MORDENT:case k.INVERTED_MORDENT:var c=this.opts.ornamentsOpts;if(void 0!==c.departure){if(!l.isValid(c.departure))throw new b("departure");delete c.approach}if(void 0!==c.approach&&!l.isValid(c.approach))throw new b("approach");if(void 0===c.long)c.long=m.NO;else if(!m.isValid(c.long))throw new b("long")}},p.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,ornamentType:this.opts.ornamentType,ornamentsOpts:this.opts.ornamentsOpts};new n(this.measureData,a,this.cancelStack).perform(),this.updateStack()},p.updateStack=function(){var a=this.getLocation(),b={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,timePos:a.timePos,divisions:a.dpq,ornamentType:this.opts.ornamentType}};this.cancelStack.push(b)},p.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,timePos:a.timePos,divisions:a.dpq,ornamentType:this.opts.ornamentType,ornamentsOpts:this.opts.ornamentsOpts}};this.cancelStack.storeAction(b)}},p.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.NoJumpTagToRemove=function(){var b="There is no Jump Tag to delete",c=a.call(this,b);return this.name=c.name="NoJumpTagToRemove",this.stack=c.stack,this.message=c.message,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}})}.call(this),function(){"use strict";var a=Adagio.edit.primitive.RemoveJumpTag=function(a,b,c){this.init(a,b,c)};a.NAME="primitive.RemoveJumpTag";var b=a.prototype;b.name=a.NAME,b.init=function(a,b,c){this.scoreData=a,this.opts=b,this.cancelStack=c},b.perform=function(){this.removeTagInCommonContent(),this.updateStack()},b.removeTagInCommonContent=function(){this.getCommonContent().removeJumpTag(this.opts.measureIdx)},b.getCommonContent=function(){return this.scoreData.getCommonContent()},b.updateStack=function(){var a={type:this.name,opts:{partIdx:0,measureIdx:this.opts.measureIdx}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,b=Adagio.Error.client.NoJumpTagToRemove,c=Adagio.Error.client.BadMeasureIdxError,d=Adagio.edit.primitive.RemoveJumpTag,e=Adagio.edit.action.RemoveJumpTag=function(a,b,c){this.init(a,b,c)};e.NAME="action.RemoveJumpTag";var f=e.prototype;f.name=e.NAME,f.init=function(b,c,d){a(b,c),this.scoreData=b,this.opts=c,this.cancelStack=d,this.location=null},f.checkPreconditions=function(){this.checkLocation(),this.checkExistence()},f.checkLocation=function(){var a=this.scoreData.getNbMeasures(),b=this.opts.measureIdx;if(b<0||b>=a)throw new c(b,c.GET)},f.checkExistence=function(){if(!this.getCommonContent().hasJumpTag(this.opts.measureIdx))throw new b},f.getCommonContent=function(){return this.scoreData.getCommonContent()},f.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a=this.getCommonContent(),b=a.getJumpTag(this.opts.measureIdx);this.storeAction(b);var c={measureIdx:this.opts.measureIdx};new d(this.scoreData,c,this.cancelStack).perform(),this.updateStack(b)},f.updateStack=function(a){var b=this.getLocation(),c={type:this.name,noDraw:!0,opts:{measureUuid:b.measureUuid,type:a}};this.cancelStack.push(c)},f.storeAction=function(a){if(!this.cancelStack.hasAction()){var b=this.getLocation(),c={actionName:this.name,opts:{measureUuid:b.measureUuid,type:a}};this.cancelStack.storeAction(c)}},f.getLocation=function(){if(null===this.location){var a=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={measureUuid:a}}return this.location}}.call(this),function(){"use strict";var a=Adagio.edit.primitive.AddJumpTag=function(a,b,c){this.init(a,b,c)};a.NAME="primitive.AddJumpTag";var b=a.prototype;b.name=a.NAME,b.init=function(a,b,c){this.scoreData=a,this.opts=b,this.cancelStack=c},b.perform=function(){this.setTagInCommonContent(),this.updateStack()},b.setTagInCommonContent=function(){this.getCommonContent().setJumpTag(this.opts.measureIdx,this.opts.type)},b.getCommonContent=function(){return this.scoreData.getCommonContent()},b.updateStack=function(){var a={type:this.name,opts:{partIdx:0,measureIdx:this.opts.measureIdx,type:this.opts.type}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.edit.action.RemoveJumpTag,b=Adagio.edit.primitive.AddJumpTag,c=Adagio.edit.composite.AddJumpTag=function(a,b,c){this.init(a,b,c)};c.NAME="composite.AddJumpTag";var d=c.prototype;d.name=c.NAME,d.init=function(a,b,c){this.scoreData=a,this.opts=b,this.cancelStack=c},d.getCommonContent=function(){return this.scoreData.getCommonContent()},d.perform=function(){this.getCommonContent().hasJumpTag(this.opts.measureIdx)&&this.removeCurrentJumpTag();var a={measureIdx:this.opts.measureIdx,type:this.opts.type};new b(this.scoreData,a,this.cancelStack).perform()},d.removeCurrentJumpTag=function(){var b={measureIdx:this.opts.measureIdx},c=new a(this.scoreData,b,this.cancelStack);c.checkPreconditions(),c.perform()}}.call(this),function(){"use strict";var a=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,b=Adagio.Error.client.BadMeasureIdxError,c=Adagio.Values.SoundType,d=Adagio.edit.composite.AddJumpTag,e=Adagio.edit.action.AddJumpTag=function(a,b,c){this.init(a,b,c)};e.NAME="action.AddJumpTag";var f=e.prototype;f.name=e.NAME,f.init=function(b,c,d){a(b,c),this.scoreData=b,this.opts=c,this.cancelStack=d,this.location=null},f.checkPreconditions=function(){this.checkLocation(),this.checkType()},f.checkLocation=function(){var a=this.scoreData.getNbMeasures(),c=this.opts.measureIdx;if(c<0||c>=a)throw new b(c,b.GET)},f.checkType=function(){c.tagCheck(this.opts.type)},f.getCommonContent=function(){return this.scoreData.getCommonContent()},f.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a={measureIdx:this.opts.measureIdx,type:this.opts.type};new d(this.scoreData,a,this.cancelStack).perform(),this.updateStack()},f.updateStack=function(){var a=this.getLocation(),b={type:this.name,noDraw:!0,opts:{measureUuid:a.measureUuid,type:this.opts.type}};this.cancelStack.push(b)},f.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{measureUuid:a.measureUuid,type:this.opts.type}};this.cancelStack.storeAction(b)}},f.getLocation=function(){if(null===this.location){var a=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={measureUuid:a}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.NoJumpCallToRemove=function(){var b="There is no Jump Call to delete",c=a.call(this,b);return this.name=c.name="NoJumpCallToRemove",this.stack=c.stack,this.message=c.message,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}})}.call(this),function(){"use strict";var a=Adagio.edit.primitive.RemoveJumpCall=function(a,b,c){this.init(a,b,c)};a.NAME="primitive.RemoveJumpCall";var b=a.prototype;b.name=a.NAME,b.init=function(a,b,c){this.scoreData=a,this.opts=b,this.cancelStack=c},b.perform=function(){this.removeTagInCommonContent(),this.updateStack()},b.removeTagInCommonContent=function(){this.getCommonContent().removeJumpCall(this.opts.measureIdx)},b.getCommonContent=function(){return this.scoreData.getCommonContent()},b.updateStack=function(){var a={type:this.name,opts:{partIdx:0,measureIdx:this.opts.measureIdx}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,b=Adagio.Error.client.NoJumpCallToRemove,c=Adagio.Error.client.BadMeasureIdxError,d=Adagio.edit.primitive.RemoveJumpCall,e=Adagio.edit.composite.ClearRightBarline,f=Adagio.Values.SoundType,g=Adagio.Utils.measureUtils,h=Adagio.Utils.barlineUtils,i=Adagio.edit.action.RemoveJumpCall=function(a,b,c){this.init(a,b,c)};i.NAME="action.RemoveJumpCall";var j=i.prototype;j.name=i.NAME,j.init=function(b,c,d){a(b,c),this.scoreData=b,this.opts=c,this.cancelStack=d,this.location=null},j.checkPreconditions=function(){this.checkLocation(),this.checkExistence()},j.checkLocation=function(){var a=this.scoreData.getNbMeasures(),b=this.opts.measureIdx;if(b<0||b>=a)throw new c(b,c.GET)},j.checkExistence=function(){if(!this.getCommonContent().hasJumpCall(this.opts.measureIdx))throw new b},j.getCommonContent=function(){return this.scoreData.getCommonContent()},j.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a=this.getCommonContent(),b=a.getJumpCall(this.opts.measureIdx);this.storeAction(b),this.removeJumpCall(),this.canClearBarline(b)&&this.clearBarline(),this.updateStack(b)},j.updateStack=function(a){var b=this.getLocation(),c={type:this.name,noDraw:!0,opts:{measureUuid:b.measureUuid,type:a}};this.cancelStack.push(c)},j.removeJumpCall=function(){var a={measureIdx:this.opts.measureIdx};new d(this.scoreData,a,this.cancelStack).perform()},j.canClearBarline=function(a){if(a!==f.FINE)return!1;var b=0,c=this.scoreData.getMeasure(b,this.opts.measureIdx);return!!g.hasRightBarline(c)&&(!g.hasRepeatBackward(c)&&g.getRightBarlineStyle(c)===h.FINAL)},j.clearBarline=function(){var a={measureIdx:this.opts.measureIdx};new e(this.scoreData,a,this.cancelStack).perform()},j.storeAction=function(a){if(!this.cancelStack.hasAction()){var b=this.getLocation(),c={actionName:this.name,opts:{measureUuid:b.measureUuid,type:a}};this.cancelStack.storeAction(c)}},j.getLocation=function(){if(null===this.location){var a=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={measureUuid:a}}return this.location}}.call(this),function(){"use strict";var a=Adagio.edit.primitive.AddJumpCall=function(a,b,c){this.init(a,b,c)};a.NAME="primitive.AddJumpCall";var b=a.prototype;b.name=a.NAME,b.init=function(a,b,c){this.scoreData=a,this.opts=b,this.cancelStack=c},b.perform=function(){this.setTagInCommonContent(),this.updateStack()},b.setTagInCommonContent=function(){this.getCommonContent().setJumpCall(this.opts.measureIdx,this.opts.type)},b.getCommonContent=function(){return this.scoreData.getCommonContent()},b.updateStack=function(){var a={type:this.name,opts:{partIdx:0,measureIdx:this.opts.measureIdx,type:this.opts.type}};this.cancelStack.push(a)}
}.call(this),function(){"use strict";var a=Adagio.edit.action.RemoveJumpCall,b=Adagio.edit.primitive.AddJumpCall,c=Adagio.edit.composite.ClearRightBarline,d=Adagio.Values.SoundType,e=Adagio.Utils.measureUtils,f=Adagio.Utils.barlineUtils,g=Adagio.edit.composite.AddJumpCall=function(a,b,c){this.init(a,b,c)};g.NAME="composite.AddJumpCall";var h=g.prototype;h.name=g.NAME,h.init=function(a,b,c){this.scoreData=a,this.opts=b,this.cancelStack=c},h.getCommonContent=function(){return this.scoreData.getCommonContent()},h.perform=function(){this.getCommonContent().hasJumpCall(this.opts.measureIdx)&&this.removeCurrentJumpCall(),this.addJumpCall(),this.canClearBarline()&&this.clearBarline()},h.removeCurrentJumpCall=function(){var b={measureIdx:this.opts.measureIdx},c=new a(this.scoreData,b,this.cancelStack);c.checkPreconditions(),c.perform()},h.addJumpCall=function(){var a={measureIdx:this.opts.measureIdx,type:this.opts.type};new b(this.scoreData,a,this.cancelStack).perform()},h.canClearBarline=function(){if(this.opts.type!==d.FINE)return!1;var a=0,b=this.scoreData.getMeasure(a,this.opts.measureIdx);return!e.hasRightBarline(b)||e.getRightBarlineStyle(b)===f.DEFAULT_STYLE},h.clearBarline=function(){var a={measureIdx:this.opts.measureIdx};new c(this.scoreData,a,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,b=Adagio.Error.client.BadMeasureIdxError,c=Adagio.Values.SoundType,d=Adagio.edit.composite.AddJumpCall,e=Adagio.edit.action.AddJumpCall=function(a,b,c){this.init(a,b,c)};e.NAME="action.AddJumpCall";var f=e.prototype;f.name=e.NAME,f.init=function(b,c,d){a(b,c),this.scoreData=b,this.opts=c,this.cancelStack=d,this.location=null},f.checkPreconditions=function(){this.checkLocation(),this.checkType()},f.checkLocation=function(){var a=this.scoreData.getNbMeasures(),c=this.opts.measureIdx;if(c<0||c>=a)throw new b(c,b.GET)},f.checkType=function(){c.callCheck(this.opts.type)},f.getCommonContent=function(){return this.scoreData.getCommonContent()},f.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a={measureIdx:this.opts.measureIdx,type:this.opts.type};new d(this.scoreData,a,this.cancelStack).perform(),this.updateStack()},f.updateStack=function(){var a=this.getLocation(),b={type:this.name,noDraw:!0,opts:{measureUuid:a.measureUuid,type:this.opts.type}};this.cancelStack.push(b)},f.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{measureUuid:a.measureUuid,type:this.opts.type}};this.cancelStack.storeAction(b)}},f.getLocation=function(){if(null===this.location){var a=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={measureUuid:a}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Values.values,c=Adagio.Error.client.MaxNbVoicesPerStaffError=function(){var b=d(),c=a.call(this,b);return this.name=c.name="MaxNbVoicesPerStaffError",this.stack=c.stack,this.message=c.message,this};c.prototype=Object.create(a.prototype,{constructor:{value:c}});var d=function(){return"There cannot be more than ["+b.MAX_NB_VOICES_PER_STAFF+"] voices per staff."}}.call(this),function(){"use strict";var a=Adagio.Utils.partHeaderUtils,b=Adagio.edit.primitive.AddVoice=function(a,b,c){this.init(a,b,c)};b.NAME="primitive.AddVoice";var c=b.prototype;c.name=b.NAME,c.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},c.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.addVoice()},c.addVoice=function(){var b=this.scoreData.getPartHeader(this.opts.partIdx),c=this.opts.voiceIdx,d=this.opts.staffIdx,e=a.getVoiceMapping(b);e[c]=[d],a.setVoiceMapping(b,e);var f=a.getStaffMapping(b),g=f[d];g.voices.splice(this.opts.idxInStaff,0,c),this.opts.isMainVoice&&(g.mainVoiceIdx=c),a.setStaffMapping(b,f)}}.call(this),function(){"use strict";var a=Adagio.edit.primitive.AddVoice,b=Adagio.edit.action.ShowMeasureVoice,c=Adagio.edit.composite.AddVoice=function(a,b,c){this.init(a,b,c)};c.NAME="composite.AddVoice";var d=c.prototype;d.name=c.NAME,d.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.addVoice(),this.opts.show&&this.showMeasuresVoice()},d.addVoice=function(){var b={partIdx:this.opts.partIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,idxInStaff:this.opts.idxInStaff,isMainVoice:this.opts.isMainVoice};new a(this.scoreData,b,this.cancelStack).perform()},d.showMeasuresVoice=function(){for(var a=this.scoreData.getNbMeasures(),b=0;b<a;b++)this.showMeasureVoice(b)},d.showMeasureVoice=function(a){var c={partIdx:this.opts.partIdx,measureIdx:a,voiceIdx:this.opts.voiceIdx};new b(this.scoreData,c,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadVoiceError,b=Adagio.Error.client.BadStaffIdxError,c=Adagio.Error.client.MaxNbVoicesPerStaffError,d=Adagio.Error.client.BadIdxInStaffError,e=Adagio.Values.VoiceIdx,f=Adagio.Values.values,g=Adagio.Utils.setUtils,h=Adagio.Utils.math,i=Adagio.Utils.partContentUtils,j=Adagio.edit.composite.AddVoice,k=Adagio.edit.common.convertPartUuidToGetPartIdx,l=Adagio.edit.common.generateVoiceIdx,m=!1,n=Adagio.edit.action.AddVoice=function(a,b,c){this.init(a,b,c)};n.NAME="action.AddVoices";var o=n.prototype;o.name=n.NAME,o.init=function(a,b,c){k(a,b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.location=null,this.sanitized=!1},o.checkPreconditions=function(){if(this.sanitizeIfNeeded(),e.check(this.opts.voiceIdx),this.scoreData.hasPartVoiceIdx(this.opts.partIdx,this.opts.voiceIdx))throw new a(this.opts.voiceIdx,a.INSERT);var g=this.scoreData.getPartContent(this.opts.partIdx),j=i.getNbStaves(g),k=this.opts.staffIdx;if(!h.isInteger(k)||k<0||k>=j)throw new b(k);var l=this.scoreData.getPartStaffNbVoices(this.opts.partIdx,k);if(l===f.MAX_NB_VOICES_PER_STAFF)throw new c;var m=this.opts.idxInStaff;if(!h.isInteger(m)||m<0||m>l)throw new d(m)},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded(),this.storeAction();var a=this.getPreviousData();this.updateStack(a),this.addVoice()},o.sanitizeIfNeeded=function(){this.sanitized||(void 0===this.opts.isMainVoice&&(this.opts.isMainVoice=m),void 0===this.opts.voiceIdx&&(this.opts.voiceIdx=this.generateVoiceIdx()),void 0===this.opts.show&&(this.opts.show=!0),this.sanitized=!0)},o.generateVoiceIdx=function(){var a=this.scoreData.getPartVoicesIndexes(this.opts.partIdx),b=g.fromList(a);return l(b,{},0)},o.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={partUuid:a.partUuid,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,idxInStaff:this.opts.idxInStaff,isMainVoice:this.opts.isMainVoice},c={actionName:this.name,opts:b};this.cancelStack.storeAction(c)}},o.getPreviousData=function(){return{mainVoiceIdx:this.scoreData.getPartStaffMainVoiceIdx(this.opts.partIdx,this.opts.staffIdx)}},o.addVoice=function(){var a={partIdx:this.opts.partIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,idxInStaff:this.opts.idxInStaff,isMainVoice:this.opts.isMainVoice};new j(this.scoreData,a,this.cancelStack).perform()},o.updateStack=function(a){var b=this.getLocation(),c={partUuid:b.partUuid,voiceIdx:this.opts.voiceIdx,formerMainVoiceIdx:a.mainVoiceIdx},d={type:this.name,noDraw:!0,opts:c};this.cancelStack.push(d)},o.getLocation=function(){if(null===this.location){var a=this.scoreData.getPartUuid(this.opts.partIdx);this.location={partUuid:a}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.AlreadyHasGlissandoError=function(){var b=c(),d=a.call(this,b);return this.name=d.name="AlreadyHasGlissandoError",this.stack=d.stack,this.message=d.message,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(){return"There are already glissando notations at this location."}}.call(this),function(){"use strict";var a=Adagio.Utils.pitchUtils,b=Adagio.Utils.noteUtils,c=Adagio.Utils.glissandoUtils,d=Adagio.Values.GlissandoType,e=Adagio.Data.glissandoAction={};e.tieChords=function(a,b){e.getUntiedPairs(a,b).forEach(e.tiePair)},e.getUntiedPairs=function(a,b){var c=[];a=a.slice().sort(f),b=b.slice().sort(f);for(var d=0;d<a.length&&d<b.length;d++){var e={leftNote:a[d],rightNote:b[d]};c.push(e)}return c},e.tiePair=function(a,b){var f=c.create(d.START,b+1),g=c.create(d.STOP,b+1);e.addGlissando(a.leftNote,f),e.addGlissando(a.rightNote,g)},e.addGlissando=function(a,c){b.addGlissando(a,c)};var f=function(c,d){var e=b.getPitch(c),f=b.getPitch(d);return a.naiveComparePitch(e,f)<0}}.call(this),function(){"use strict";var a=Adagio.edit.common.initMeasureData,b=Adagio.edit.common.getNoteAtPitch,c=Adagio.Utils.glissandoUtils,d=Adagio.Utils.noteUtils,e=Adagio.Utils.pitchUtils,f=Adagio.edit.primitive.AddGlissandoSide=function(a,b,c){this.init(a,b,c)};f.NAME="primitive.AddGlissandoSide";var g=f.prototype;g.name=f.NAME,g.initMeasureData=a,g.init=function(a,b,c){this.initMeasureData(a,b),this.opts=b,this.cancelStack=c},g.perform=function(){var a=c.create(this.opts.glissandoType,this.opts.number),b=this.getNoteAtPitch();d.addGlissando(b,a),this.updateStack()},g.getNoteAtPitch=function(){var a=this.measureData.getVoice(this.opts.voiceIdx);return b(a,this.opts.noteIdx,this.opts.pitch)},g.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:e.copy(this.opts.pitch),glissandoType:this.opts.glissandoType,number:this.opts.number}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.edit.common.initMeasureData,b=Adagio.Utils.pitchUtils,c=Adagio.edit.common.CrossMeasure,d=Adagio.Values.GlissandoType,e=Adagio.edit.primitive.AddGlissandoSide,f=Adagio.edit.composite.AddGlissando=function(a,b,c){this.init(a,b,c)};f.NAME="composite.AddGlissando";var g=f.prototype;g.name=f.NAME,g.initMeasureData=a,g.init=function(a,b,d){this.initMeasureData(a,b),this.opts=b,this.cancelStack=d,this.crossMeasure=new c(this.measureData,this.opts.voiceIdx,this.opts.noteIdx)},g.perform=function(){this.addLeftGlissandoSide(),this.addRightGlissandoSide()},g.addLeftGlissandoSide=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.crossMeasure.getLeftMeasureIdx(),voiceIdx:this.opts.voiceIdx,noteIdx:this.crossMeasure.getLeftNoteIdx(),pitch:b.copy(this.opts.leftPitch),glissandoType:d.START,number:this.opts.number};new e(this.crossMeasure.getLeftMeasure(),a,this.cancelStack).perform()},g.addRightGlissandoSide=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.crossMeasure.getRightMeasureIdx(),voiceIdx:this.opts.voiceIdx,noteIdx:this.crossMeasure.getRightNoteIdx(),pitch:b.copy(this.opts.rightPitch),glissandoType:d.STOP,number:this.opts.number};new e(this.crossMeasure.getRightMeasure(),a,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.edit.common.convertPartUuidToGetPartIdx,b=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,c=Adagio.edit.common.convertTimePosToGetNoteIdx,d=Adagio.edit.common.initMeasureData,e=Adagio.edit.common.getNoteAtPitch,f=Adagio.edit.common.noteIdxToTimePos,g=Adagio.Error.client.NotPossibleOnUnpitchedError,h=Adagio.Error.client.PitchCollisionError,i=Adagio.Error.client.AlreadyHasGlissandoError,j=Adagio.Error.client.NotPossibleOnRestsError,k=Adagio.Error.value.BadGlissandoNumberError,l=Adagio.Utils.pitchUtils,m=Adagio.Utils.noteUtils,n=Adagio.edit.common.CrossMeasure,o=Adagio.Values.GlissandoType,p=Adagio.edit.composite.AddGlissando,q=Adagio.edit.action.AddGlissando=function(a,b,c){this.init(a,b,c)};q.NAME="action.AddGlissando";var r=q.prototype;r.name=q.NAME,r.initMeasureData=d,r.init=function(d,e,f){a(d,e),b(d,e),this.initMeasureData(d,e),this.opts=e,this.cancelStack=f,this.location=null,this.sanitized=!1,c(this.measureData,e),this.crossMeasure=new n(this.measureData,this.opts.voiceIdx,this.opts.noteIdx)},r.checkPreconditions=function(){this.checkPitchedPart(),this.crossMeasure.checkVoiceIdx(),this.checkNoteIdx(),this.checkNotRest(),this.checkPitchs(),this.checkNotesAtPitch(),this.sanitizeIfNeeded(),this.checkNumber(),this.checkExistence()},r.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new g},r.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},r.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},r.isLeftRest=function(){return this.crossMeasure.isLeftRest()},r.isRightRest=function(){return this.crossMeasure.isRightRest()},r.checkNotRest=function(){if(this.isLeftRest()||this.isRightRest())throw new j},r.checkPitchs=function(){l.check(this.opts.leftPitch),l.check(this.opts.rightPitch)},r.checkPitch=function(a){l.check(a)},r.checkNotesAtPitch=function(){var a=this.getLeftNoteAtPitch(),b=this.getRightNoteAtPitch();if(void 0===a){var c=l.copy(this.opts.leftPitch);throw new h(h.action.GET,c)}if(void 0===b){var d=l.copy(this.opts.rightPitch);throw new h(h.action.GET,d)}},r.getNoteAtPitch=function(a,b,c){return e(a,b,c)},r.getLeftNoteAtPitch=function(){var a=this.crossMeasure.getLeftVoice(),b=this.crossMeasure.getLeftNoteIdx();return this.getNoteAtPitch(a,b,this.opts.leftPitch)},r.getRightNoteAtPitch=function(){var a=this.crossMeasure.getRightVoice(),b=this.crossMeasure.getRightNoteIdx();return this.getNoteAtPitch(a,b,this.opts.rightPitch)},r.sanitizeIfNeeded=function(){this.sanitized||(void 0===this.opts.number&&(this.opts.number=1),this.sanitized=!0)},r.checkNumber=function(){if("number"!=typeof this.opts.number||this.opts.number<0)throw new k(this.opts.number)},r.checkExistence=function(){var a=this.getLeftNoteAtPitch(),b=this.getRightNoteAtPitch();if(m.hasGlissando(a,o.START,this.opts.number)||m.hasGlissando(b,o.STOP,this.opts.number))throw new i},r.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,leftPitch:l.copy(this.opts.leftPitch),rightPitch:l.copy(this.opts.rightPitch),number:this.opts.number};new p(this.measureData,a,this.cancelStack).perform(),this.updateStack()},r.updateStack=function(){var a=this.getLocation(),b={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,timePos:a.timePos,divisions:a.dpq,leftPitch:l.copy(this.opts.leftPitch),rightPitch:l.copy(this.opts.rightPitch),number:this.opts.number}};this.cancelStack.push(b)},r.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,timePos:a.timePos,divisions:a.dpq,leftPitch:l.copy(this.opts.leftPitch),rightPitch:l.copy(this.opts.rightPitch),number:this.opts.number}};this.cancelStack.storeAction(b)}},r.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=this.crossMeasure.getLeftMeasureIdx(),d=a.getMeasureUuid(c),e=this.crossMeasure.getLeftMeasure().getDpqValue(),g=this.crossMeasure.getLeftVoice(),h=this.crossMeasure.getLeftNoteIdx(),i=f(g,h);this.location={partUuid:b,measureUuid:d,dpq:e,timePos:i}}return this.location}}.call(this),function(){"use strict";var a=Adagio.edit.common.initMeasureData,b=Adagio.edit.common.CrossMeasure,c=Adagio.Utils.pitchUtils,d=Adagio.Utils.noteUtils,e=Adagio.Data.glissandoAction,f=Adagio.edit.action.AddGlissando,g=Adagio.edit.composite.AddGlissandos=function(a,b,c){this.init(a,b,c)};g.NAME="composite.AddGlissandos";var h=g.prototype;h.name=g.NAME,h.initMeasureData=a,h.init=function(a,c,d){this.initMeasureData(a,c),this.opts=c,this.cancelStack=d,this.crossMeasure=new b(this.measureData,c.voiceIdx,c.noteIdx)},h.getLeftChord=function(){return this.crossMeasure.getLeftChord()},h.getRightChord=function(){return this.crossMeasure.getRightChord()},h.getActions=function(){var a=this.getLeftChord(),b=this.getRightChord(),g=e.getUntiedPairs(a,b),h=[];return g.forEach(function(a,b){var e=d.getPitch(a.leftNote),g=d.getPitch(a.rightNote),i={partIdx:this.opts.partIdx,measureIdx:this.crossMeasure.getLeftMeasureIdx(),voiceIdx:this.opts.voiceIdx,noteIdx:this.crossMeasure.getLeftNoteIdx(),leftPitch:c.copy(e),rightPitch:c.copy(g),number:b+1};h.push(new f(this.measureData,i,this.cancelStack))},this),h},h.perform=function(){this.getActions().forEach(this.performAction)},h.performAction=function(a){a.checkPreconditions(),a.perform()}}.call(this),function(){"use strict";var a=Adagio.edit.common.convertPartUuidToGetPartIdx,b=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,c=Adagio.edit.common.convertTimePosToGetNoteIdx,d=Adagio.edit.common.initMeasureData,e=Adagio.edit.common.noteIdxToTimePos,f=Adagio.edit.common.CrossMeasure,g=Adagio.Error.client.NotPossibleOnUnpitchedError,h=Adagio.Error.client.NotPossibleOnRestsError,i=Adagio.Error.client.AlreadyHasGlissandoError,j=Adagio.Utils.noteUtils,k=Adagio.Values.GlissandoType,l=Adagio.edit.composite.AddGlissandos,m=Adagio.edit.action.AddGlissandos=function(a,b,c){this.init(a,b,c)};m.NAME="action.AddGlissandos";var n=m.prototype;n.name=m.NAME,n.initMeasureData=d,n.init=function(d,e,g){a(d,e),b(d,e),this.initMeasureData(d,e),this.opts=e,this.cancelStack=g,this.location=null,c(this.measureData,e),this.crossMeasure=new f(this.measureData,e.voiceIdx,e.noteIdx)},n.checkPreconditions=function(){this.checkPitchedPart(),this.crossMeasure.checkVoiceIdx(),this.checkNoteIdx(),this.checkNotRest(),this.checkExistence()},n.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new g},n.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},n.checkNotRest=function(){if(this.isLeftRest()||this.isRightRest())throw new h},n.isLeftRest=function(){return this.crossMeasure.isLeftRest()},n.isRightRest=function(){return this.crossMeasure.isRightRest()},n.checkExistence=function(){this.getLeftChord().forEach(function(a){if(j.hasGlissandoType(a,k.START))throw new i})},n.getLeftChord=function(){return this.crossMeasure.getLeftChord()},n.getRightChord=function(){return this.crossMeasure.getRightChord()},n.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},n.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new l(this.measureData,a,this.cancelStack).perform(),this.updateStack()},n.updateStack=function(){var a=this.getLocation(),b={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,timePos:a.timePos,divisions:a.dpq}};this.cancelStack.push(b)},n.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,timePos:a.timePos,divisions:a.dpq}};this.cancelStack.storeAction(b)}},n.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=this.crossMeasure.getLeftMeasureIdx(),d=a.getMeasureUuid(c),f=this.crossMeasure.getLeftMeasure().getDpqValue(),g=this.crossMeasure.getLeftVoice(),h=this.crossMeasure.getLeftNoteIdx(),i=e(g,h);this.location={partUuid:b,measureUuid:d,dpq:f,timePos:i}}return this.location}}.call(this),function(){"use strict";var a=Adagio.edit.common.convertPartUuidToGetPartIdx,b=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,c=Adagio.edit.common.convertTimePosToGetNoteIdx,d=Adagio.edit.common.initMeasureData,e=Adagio.edit.common.getNoteAtPitch,f=Adagio.Error.client.NotPossibleOnUnpitchedError,g=Adagio.Error.client.PitchCollisionError,h=Adagio.Error.client.AlreadyHasGlissandoError,i=Adagio.Error.value.BadGlissandoNumberError,j=Adagio.Utils.pitchUtils,k=Adagio.Utils.noteUtils,l=Adagio.Values.GlissandoType,m=Adagio.edit.primitive.AddGlissandoSide,n=Adagio.edit.action.AddGlissandoSide=function(a,b,c){this.init(a,b,c)};n.NAME="action.AddGlissandoSide";var o=n.prototype;o.name=n.NAME,o.initMeasureData=d,o.init=function(d,e,f){a(d,e),b(d,e),this.initMeasureData(d,e),this.opts=e,this.cancelStack=f,this.noteAtPitch=null,this.location=null,this.sanitized=!1,c(this.measureData,e)},o.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkNoteIdx(),this.checkNotRest(),this.checkPitch(),this.checkNoteAtPitch(),this.sanitizeIfNeeded(),this.checkGlissandoType(),this.checkNumber(),this.checkExistence()},o.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new f},o.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},o.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},o.checkPitch=function(){j.check(this.opts.pitch)},o.checkNoteAtPitch=function(){if(void 0===this.getNoteAtPitch()){var a=j.copy(this.opts.pitch);throw new g(g.action.GET,a)}},o.sanitizeIfNeeded=function(){this.sanitized||(void 0===this.opts.number&&(this.opts.number=1),this.sanitized=!0)},o.checkGlissandoType=function(){l.check(this.opts.glissandoType)},o.checkNumber=function(){if("number"!=typeof this.opts.number||this.opts.number<0)throw new i(this.opts.number)},o.checkExistence=function(){var a=this.getNoteAtPitch();if(k.hasGlissando(a,this.opts.glissandoType,this.opts.number))throw new h},o.getNoteAtPitch=function(){if(null===this.noteAtPitch){var a=this.getVoice();this.noteAtPitch=e(a,this.opts.noteIdx,this.opts.pitch)}return this.noteAtPitch},o.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:j.copy(this.opts.pitch),glissandoType:this.opts.glissandoType,number:this.opts.number};new m(this.measureData,a,this.cancelStack).perform(),this.updateStack()},o.updateStack=function(){var a=this.getLocation(),b={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,timePos:a.timePos,divisions:a.dpq,pitch:j.copy(this.opts.pitch),glissandoType:this.opts.glissandoType,number:this.opts.number}};this.cancelStack.push(b)},o.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,timePos:a.timePos,divisions:a.dpq,pitch:j.copy(this.opts.pitch),glissandoType:this.opts.glissandoType,number:this.opts.number}};this.cancelStack.storeAction(b)}},o.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadDirectionWordError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadDirectionWordError",this.stack=e.stack,this.message=e.message,this.text=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"The word text ["+a+"] is invalid."}}.call(this),function(){"use strict";var a=Adagio.Error.value.BadDirectionWordError,b=Adagio.Values.WordDirection={};b.check=function(c){if(!b.isValid(c))throw new a(c)},b.isValid=function(a){return""!==(a=b.trim(a))},b.trim=function(a){return a.trim()}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.math,c=Adagio.Utils.measureUtils,d=Adagio.Utils.direction.wordDirectionUtils,e=Adagio.edit.common.optsToLocalGetTimePos,f=Adagio.edit.primitive.AddWord=function(a,b,c){this.init(a,b,c)};f.NAME="primitive.AddWord";var g=f.prototype;g.name=f.NAME,g.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.measure=null,this.wordIdx=null,this.localTimePos=null},g.perform=function(){this.addWord(),this.updateStack()},g.addWord=function(){var a=this.getMeasure(),b=this.getWordIdx(),d=this.createWord(),e=c.getWords(a,this.opts.staffIdx);e.splice(b,0,d),c.setWords(a,this.opts.staffIdx,e)},g.getWordIdx=function(){return null===this.wordIdx&&this.fetchWordIdx(),this.wordIdx},g.fetchWordIdx=function(){var a=this.getMeasure(),b=c.getWords(a,this.opts.staffIdx);if(b.some(this.tryWordIdx,this),null===this.wordIdx){var d=b.length;this.wordIdx=d}},g.tryWordIdx=function(b,c){var e=this.getLocalTimePos(),f=d.getTimePos(b);if(f<e)return!1;if(f>e)return this.wordIdx=c,!0;throw new a("TimePosCollision","There is already an word at this time position.")},g.createWord=function(){var a=this.getLocalTimePos();return d.create(this.opts.staffIdx,this.opts.placement,a,this.opts.text)},g.getLocalTimePos=function(){if(null===this.localTimePos){var c=this.getMeasure();if(this.localTimePos=e(this.opts,c),!b.isInteger(this.localTimePos)){var d="At the point, the time position ["+this.localTimePos+"] should be an integer.";throw new a("IntegerExpected",d)}}return this.localTimePos},g.getMeasure=function(){return null===this.measure&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure},g.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.edit.primitive.AddWord,b=Adagio.edit.composite.AdaptDpqToPosition,c=Adagio.edit.composite.AddWord=function(a,b,c){this.init(a,b,c)};c.NAME="composite.AddWord";var d=c.prototype;d.name=c.NAME,d.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},d.perform=function(){this.updateDpq(),this.addWord()},d.updateDpq=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:this.opts.timePos,dpq:this.opts.dpq};new b(this.scoreData,a,this.cancelStack).perform()},d.addWord=function(){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,placement:this.opts.placement,timePos:this.opts.timePos,dpq:this.opts.dpq,text:this.opts.text};new a(this.scoreData,b,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.math,c=Adagio.Utils.measureUtils,d=Adagio.edit.primitive.RemoveWord=function(a,b,c){this.init(a,b,c)};d.NAME="primitive.RemoveWord";var e=d.prototype;e.name=d.NAME,e.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},e.perform=function(){this.removeWord(),this.updateStack()},e.removeWord=function(){var a=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx),b=c.getWords(a,this.opts.staffIdx),d=b.length;f(this.opts.wordIdx,d),b.splice(this.opts.wordIdx,1),c.setWords(a,this.opts.staffIdx,b)};var f=function(c,d){if(!b.isInteger(c)||c<0||c>=d){throw new a("BadWordIdx","Invalid wordIdx: ["+c+"].")}};e.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadPartIdxError,b=Adagio.Error.client.BadMeasureIdxError,c=Adagio.Error.client.BadStaffIdxError,d=Adagio.Error.client.TimePosOutOfRangeError,e=Adagio.Error.noChange.NoChangeError,f=Adagio.Utils.measureUtils,g=Adagio.Utils.math,h=Adagio.Utils.direction.wordDirectionUtils,i=Adagio.edit.primitive.RemoveWord,j=Adagio.edit.common.optsToLocalGetTimePos,k=Adagio.edit.common.convertPartUuidToGetPartIdx,l=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,m=Adagio.edit.action.RemoveWordAtTimePos=function(a,b,c){this.init(a,b,c)};m.NAME="action.RemoveWordAtTimePos",m.isAuthorizedException=function(f){return f instanceof a||f instanceof b||f instanceof c||f instanceof d||f instanceof e};var n=m.prototype;n.name=m.NAME,n.init=function(a,b,c){k(a,b),l(a,b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.measure=null,this.words=null,this.location=null,this.wordIdx=null,this.localTimePos=null},n.performIfPossible=function(){this.isPossible()&&this.perform()},n.isPossible=function(){var a=!0;try{this.checkPreconditions()}catch(b){if(!m.isAuthorizedException(b))throw b;a=!1}return a},n.checkPreconditions=function(){this.checkLocation(),this.checkTimePos(),this.checkExistence()},n.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx);var a=this.getMeasure(),b=f.getNbStaves(a),d=this.opts.staffIdx;if(!g.isNumber(d)||d<0||d>=b)throw new c(d)},n.checkTimePos=function(){var a=this.getLocalTimePos(),b=this.getMeasure(),c=f.getNbDivisions(b);if(!g.isNumber(a)||a<0||a>c){var e=f.getDpq(b);throw new d(a,e)}},n.checkExistence=function(){this.fetchWordIdx()},n.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a=this.getPreviousData();this.removeWord(),this.updateStack(a)},n.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,staffIdx:this.opts.staffIdx,timePos:this.opts.timePos,dpq:this.opts.dpq}};this.cancelStack.storeAction(b)}},n.getPreviousData=function(){var a=this.getWord(),b=h.getStaffIdx(a),c=h.getPlacement(a),d=h.getTimePos(a),e=h.getText(a),g=this.getMeasure();return{staffIdx:b,placement:c,timePos:d,dpq:f.getDpq(g),text:e}},n.getWord=function(){return this.getWords()[this.getWordIdx()]},n.removeWord=function(){var a=this.getWordIdx(),b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,wordIdx:a};new i(this.scoreData,b,this.cancelStack).perform()},n.getWordIdx=function(){return null===this.wordIdx&&this.fetchWordIdx(),this.wordIdx},n.fetchWordIdx=function(){if(this.wordIdx=null,this.getWords().some(this.checkWordTimePos,this),null===this.wordIdx)throw new e},n.getWords=function(){if(null===this.words){var a=this.getMeasure();this.words=f.getWords(a,this.opts.staffIdx)}return this.words},n.checkWordTimePos=function(a,b){var c=this.getLocalTimePos(),d=h.getTimePos(a);return!(d<c)&&(d===c&&(this.wordIdx=b),!0)},n.getLocalTimePos=function(){if(null===this.localTimePos){var a=this.getMeasure();this.localTimePos=j(this.opts,a)}return this.localTimePos},n.getMeasure=function(){return null===this.measure&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure},n.updateStack=function(a){var b=this.getLocation(),c={type:this.name,noDraw:!0,opts:{partUuid:b.partUuid,measureUuid:b.measureUuid,staffIdx:a.staffIdx,placement:a.placement,timePos:a.timePos,dpq:a.dpq,text:a.text}};this.cancelStack.push(c)},n.getLocation=function(){if(null===this.location){var a=this.scoreData.getPartUuid(this.opts.partIdx),b=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={partUuid:a,measureUuid:b}}return this.location}}.call(this),function(){"use strict";var a=Adagio.edit.composite.AddWord,b=Adagio.edit.action.RemoveWordAtTimePos,c=Adagio.edit.composite.AddWordErase=function(a,b,c){this.init(a,b,c)};c.NAME="composite.AddWordErase";var d=c.prototype;d.name=c.NAME,d.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},d.perform=function(){this.removeFormerWord(),this.addWord()},d.removeFormerWord=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,timePos:this.opts.timePos,dpq:this.opts.dpq};new b(this.scoreData,a,this.cancelStack).performIfPossible()},d.addWord=function(){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,placement:this.opts.placement,timePos:this.opts.timePos,dpq:this.opts.dpq,text:this.opts.text
};new a(this.scoreData,b,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadStaffIdxError,b=Adagio.Error.value.BadPlacementDirectionError,c=Adagio.Error.client.TimePosOutOfRangeError,d=Adagio.Values.DirectionPlacement,e=Adagio.Utils.measureUtils,f=Adagio.Utils.math,g=Adagio.Values.WordDirection,h=Adagio.edit.common.convertPartUuidToGetPartIdx,i=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,j=Adagio.edit.common.optsToLocalGetTimePos,k=Adagio.edit.composite.AddWordErase,l=Adagio.edit.action.AddWordAtTimePos=function(a,b,c){this.init(a,b,c)};l.NAME="action.AddWordAtTimePos";var m=l.prototype;m.name=l.NAME,m.init=function(a,b,c){h(a,b),i(a,b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.localTimePos=null,this.location=null},m.checkPreconditions=function(){this.checkLocation(),this.checkTimePos(),this.checkParam()},m.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx);var b=this.getMeasure(),c=e.getNbStaves(b);if(this.opts.staffIdx<0||this.opts.staffIdx>=c)throw new a(this.opts.staffIdx)},m.checkTimePos=function(){var a=this.getLocalTimePos(),b=this.getMeasure(),d=e.getNbDivisions(b);if(!f.isNumber(a)||a<0||a>=d){var g=e.getDpq(b);throw new c(a,g)}},m.getLocalTimePos=function(){if(null===this.localTimePos){var a=this.getMeasure();this.localTimePos=j(this.opts,a)}return this.localTimePos},m.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},m.checkParam=function(){if(!d.isValid(this.opts.placement))throw new b(this.opts.placement);g.check(this.opts.text)},m.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.opts.text=g.trim(this.opts.text),this.storeAction(),this.addWord(),this.updateStack()},m.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,staffIdx:this.opts.staffIdx,placement:this.opts.placement,timePos:this.opts.timePos,dpq:this.opts.dpq,text:this.opts.text}};this.cancelStack.storeAction(b)}},m.addWord=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,placement:this.opts.placement,timePos:this.opts.timePos,dpq:this.opts.dpq,text:this.opts.text};new k(this.scoreData,a,this.cancelStack).perform()},m.updateStack=function(){var a=this.getLocation(),b={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,staffIdx:this.opts.staffIdx,placement:this.opts.placement,timePos:this.opts.timePos,dpq:this.opts.dpq}};this.cancelStack.push(b)},m.getLocation=function(){if(null===this.location){var a=this.scoreData.getPartUuid(this.opts.partIdx),b=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={partUuid:a,measureUuid:b}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.edit.common.MeasureData,c=Adagio.edit.action.AddWordAtTimePos,d=Adagio.edit.action.AddWordAtNote=function(a,b,c){this.init(a,b,c)};d.NAME="action.AddWordAtNote";var e=d.prototype;e.name=d.NAME,e.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.measureData=null,this.action=null},e.checkPreconditions=function(){this.checkLocation(),this.getAction().checkPreconditions()},e.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx);var a=this.getMeasureData();a.checkVoiceIdx(this.opts.voiceIdx),a.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a=this.getAction();a.cancelStack=this.cancelStack,a.perform()},e.getAction=function(){if(null===this.action){var a=this.getTimePos(),b=this.getDpq(),d={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,placement:this.opts.placement,timePos:a,dpq:b,text:this.opts.text};this.action=new c(this.scoreData,d,null)}return this.action},e.getTimePos=function(){for(var b=0,c=this.getMeasureData(),d=c.getVoice(this.opts.voiceIdx),e=0;e<this.opts.noteIdx;e++){var f=d.getNote(e);b+=a.getDuration(f)}return b},e.getDpq=function(){return this.getMeasureData().getDpqValue()},e.getMeasureData=function(){if(null===this.measureData){var a=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx);this.measureData=new b(a)}return this.measureData}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadStaffIdxError,b=Adagio.Error.client.BadWordIdxError,c=Adagio.Utils.measureUtils,d=Adagio.Utils.math,e=Adagio.Utils.direction.wordDirectionUtils,f=Adagio.edit.action.AddWordAtTimePos,g=Adagio.edit.action.AddWordAtIdx=function(a,b,c){this.init(a,b,c)};g.NAME="action.AddWordAtIdx";var h=g.prototype;h.name=g.NAME,h.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.measureData=null,this.action=null,this.words=null},h.checkPreconditions=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx);var e=this.getMeasure(),f=c.getNbStaves(e),g=this.opts.staffIdx;if(!d.isInteger(g)||g<0||g>=f)throw new a(g);var h=this.getWords(),i=h.length,j=this.opts.wordIdx;if(!d.isInteger(j)||j<0||j>=i)throw new b(j);this.getAction().checkPreconditions()},h.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a=this.getAction();a.cancelStack=this.cancelStack,a.perform()},h.getAction=function(){if(null===this.action){var a=this.getTimePos(),b=this.getDpq(),c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,placement:this.opts.placement,timePos:a,dpq:b,text:this.opts.text};this.action=new f(this.scoreData,c,null)}return this.action},h.getTimePos=function(){var a=this.getWords(),b=a[this.opts.wordIdx];return e.getTimePos(b)},h.getWords=function(){if(null===this.words){var a=this.getMeasure();this.words=c.getWords(a,this.opts.staffIdx)}return this.words},h.getDpq=function(){var a=this.getMeasure();return c.getDpq(a)},h.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.measureUtils,c=Adagio.Utils.direction.pedalDirectionUtils,d=Adagio.edit.primitive.AddPedal=function(a,b,c){this.init(a,b,c)};d.NAME="primitive.AddPedal";var e=d.prototype;e.name=d.NAME,e.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.pedalIdx=null,this.localTimePos=null},e.perform=function(){this.addPedal(),this.updateStack()},e.addPedal=function(){var a=this.getMeasure(),c=this.getPedalIdx(),d=this.createPedal(),e=b.getPedals(a,this.opts.staffIdx);e.splice(c,0,d),b.setPedals(a,this.opts.staffIdx,e)},e.getPedalIdx=function(){return null===this.pedalIdx&&this.fetchPedalIdx(),this.pedalIdx},e.fetchPedalIdx=function(){var a=this.getMeasure(),c=b.getPedals(a,this.opts.staffIdx);if(c.some(this.tryPedalIdx,this),null===this.pedalIdx){var d=c.length;this.pedalIdx=d}},e.tryPedalIdx=function(b,d){var e=this.opts.timePos,f=c.getTimePos(b);if(f<e)return!1;if(f>e)return this.pedalIdx=d,!0;throw new a("TimePosCollision","There is already a pedal at this time position.")},e.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},e.createPedal=function(){return c.create(this.opts.staffIdx,this.opts.placement,this.opts.timePos,this.opts.type)},e.updateStack=function(){var a=this.getMeasure(),c=b.getDivisions(a),d={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:this.opts.timePos,divisions:c,staffIdx:this.opts.staffIdx,placement:this.opts.placement,type:this.opts.type}};this.cancelStack.push(d)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.direction.pedalDirectionUtils,c=Adagio.Values.PedalType,d=Adagio.edit.primitive.AddPedalContinue=function(a,b,c){this.init(a,b,c)};d.NAME="primitive.AddPedalContinue";var e=d.prototype;e.name=d.NAME,e.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},e.perform=function(){this.addLeftPedal(),this.addRightPedal(),this.updateStack()},e.addLeftPedal=function(){var b=this.getLeftMeasure(),c=this.createDirection();a.setRightPedal(b,this.opts.staffIdx,c)},e.getLeftMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},e.addRightPedal=function(){var b=this.getRightMeasure(),c=this.createDirection();a.setLeftPedal(b,this.opts.staffIdx,c)},e.createDirection=function(){return b.create(this.opts.staffIdx,this.opts.placement,0,c.CONTINUE)},e.getRightMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx+1)},e.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,placement:this.opts.placement}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.Error.noChange.NoChangeError,b=Adagio.Utils.direction.pedalDirectionUtils,c=Adagio.Utils.measureUtils,d=Adagio.edit.primitive.RemovePedal=function(a,b,c){this.init(a,b,c)};d.NAME="primitive.RemovePedal";var e=d.prototype;e.name=d.NAME,e.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.removedPedal=null,this.pedals=null,this.pedalIdx=null},e.perform=function(){this.removePedal(),this.updateStack()},e.removePedal=function(){var a=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx),b=c.getPedals(a,this.opts.staffIdx),d=this.getPedalIdx(),e=b.splice(d,1);this.removedPedal=e[0],c.setPedals(a,this.opts.staffIdx,b)},e.updateStack=function(){var a=this.getMeasure(),d=c.getDivisions(a),e=this.removedPedal,f=b.getStaffIdx(e),g=b.getPlacement(e),h=b.getType(e),i={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:this.opts.timePos,divisions:d,staffIdx:f,placement:g,type:h}};this.cancelStack.push(i)},e.getPedalIdx=function(){return null===this.pedalIdx&&this.fetchPedalIdx(),this.pedalIdx},e.fetchPedalIdx=function(){if(this.pedalIdx=null,this.getPedals().some(this.checkPedal,this),null===this.pedalIdx)throw new a},e.checkPedal=function(a,c){var d=b.getTimePos(a),e=b.getType(a);return!(d<this.opts.timePos)&&(d===this.opts.timePos&&e===this.opts.type&&(this.pedalIdx=c),!0)},e.getPedals=function(){if(null===this.pedals){var a=this.getMeasure();this.pedals=c.getPedals(a,this.opts.staffIdx)}return this.pedals},e.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.measureUtils,c=Adagio.Utils.direction.pedalDirectionUtils,d=Adagio.edit.primitive.RemovePedalContinue=function(a,b,c){this.init(a,b,c)};d.NAME="primitive.RemovePedalContinue";var e=d.prototype;e.name=d.NAME,e.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.removedPedalDirection=null},e.perform=function(){this.removeLeftPedal(),this.removeRightPedal(),this.updateStack()},e.removeLeftPedal=function(){var c=this.getLeftMeasure();if(!b.hasRightPedal(c,this.opts.staffIdx)){throw new a("MissingRightContinuePedal","There is no right pedal to remove on the left measure.")}this.removedPedalDirection=b.getRightPedal(c,this.opts.staffIdx),b.removeRightPedal(c,this.opts.staffIdx)},e.getLeftMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},e.removeRightPedal=function(){var c=this.getRightMeasure();if(!b.hasLeftPedal(c,this.opts.staffIdx)){throw new a("MissingLeftContinuePedal","There is no left pedal to remove on the left measure.")}b.removeLeftPedal(c,this.opts.staffIdx)},e.getRightMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx+1)},e.updateStack=function(){var a=this.removedPedalDirection,b=c.getStaffIdx(a),d=c.getPlacement(a),e={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:b,placement:d}};this.cancelStack.push(e)}}.call(this),function(){"use strict";var a=Adagio.Values.PedalType,b=Adagio.Utils.partContentUtils,c=Adagio.edit.common.searchPedalSides,d=Adagio.edit.primitive.RemovePedal,e=Adagio.edit.primitive.RemovePedalContinue,f=Adagio.edit.composite.RemovePedal=function(a,b,c){this.init(a,b,c)};f.NAME="composite.RemovePedal";var g=f.prototype;g.name=f.NAME,g.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.startMeasureIdx=null,this.startTimePos=null,this.stopMeasureIdx=null,this.stopTimePos=null},g.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.searchSides(),this.removeStart(),this.removeStop(),this.removeContinues()},g.searchSides=function(){var a=this.getMeasures(),b=c(a,this.opts.measureIdx,this.opts.staffIdx,this.opts.timePos);this.startMeasureIdx=b.startMeasureIdx,this.startTimePos=b.startTimePos,this.stopMeasureIdx=b.stopMeasureIdx,this.stopTimePos=b.stopTimePos},g.getMeasures=function(){var a=this.scoreData.getPartContent(this.opts.partIdx);return b.getMeasures(a)},g.removeStart=function(){var b={partIdx:this.opts.partIdx,measureIdx:this.startMeasureIdx,staffIdx:this.opts.staffIdx,timePos:this.startTimePos,type:a.START};new d(this.scoreData,b,this.cancelStack).perform()},g.removeStop=function(){var b={partIdx:this.opts.partIdx,measureIdx:this.stopMeasureIdx,staffIdx:this.opts.staffIdx,timePos:this.stopTimePos,type:a.STOP};new d(this.scoreData,b,this.cancelStack).perform()},g.removeContinues=function(){for(var a=this.startMeasureIdx;a<this.stopMeasureIdx;a++)this.removeContinue(a)},g.removeContinue=function(a){var b={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,measureIdx:a};new e(this.scoreData,b,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.client.NoPedalError,b=Adagio.Error.client.BadStaffIdxError,c=Adagio.Error.client.TimePosOutOfRangeError,d=Adagio.Utils.measureUtils,e=Adagio.Utils.directionUtils,f=Adagio.Utils.math,g=Adagio.Utils.partContentUtils,h=Adagio.edit.common.convertPartUuidToGetPartIdx,i=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,j=Adagio.edit.common.optsToLocalGetTimePos,k=Adagio.edit.common.searchPedalSides,l=Adagio.Data.pedal.searchPedal,m=Adagio.edit.composite.RemovePedal,n=Adagio.edit.action.RemovePedalAtTimePos=function(a,b,c){this.init(a,b,c)};n.NAME="action.RemovePedalAtTimePos";var o=n.prototype;o.name=n.NAME,o.init=function(a,b,c){h(a,b),i(a,b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.localTimePos=null,this.measureData=null,this.location=null},o.checkPreconditions=function(){this.checkLocation(),this.checkTimePos(),this.checkExistence()},o.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx);var a=this.getMeasure(),c=d.getNbStaves(a);if(this.opts.staffIdx<0||this.opts.staffIdx>=c)throw new b(this.opts.staffIdx)},o.checkTimePos=function(){var a=this.getLocalTimePos(),b=this.getMeasure(),e=d.getNbDivisions(b);if(!f.isNumber(a)||a<0||a>=e){var g=d.getDpq(b);throw new c(a,g)}},o.checkExistence=function(){if(!this.hasPedal())throw new a},o.hasPedal=function(){var a=this.getLocalTimePos(),b=this.getMeasure(),c=d.getPedals(b,this.opts.staffIdx),e=this.extractLeftPedal(b);return null!==l(e,c,a)},o.extractLeftPedal=function(a){return d.hasLeftPedal(a,this.opts.staffIdx)?d.getLeftPedal(a,this.opts.staffIdx):null},o.searchPedal=function(a){var b=this;return e.getPosTime(a)===b},o.getLocalTimePos=function(){if(null===this.localTimePos){var a=this.getMeasure();this.localTimePos=j(this.opts,a)}return this.localTimePos},o.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a=this.getPreviousData();this.removePedal(),this.updateStack(a)},o.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,timePos:this.opts.timePos,dpq:this.opts.dpq,staffIdx:this.opts.staffIdx}};this.cancelStack.storeAction(b)}},o.getPreviousData=function(){var a=this.getLocalTimePos(),b=this.scoreData.getPartContent(this.opts.partIdx),c=g.getMeasures(b),e=k(c,this.opts.measureIdx,this.opts.staffIdx,a),f=this.scoreData.getMeasureUuid(e.startMeasureIdx),h=this.scoreData.getMeasureUuid(e.stopMeasureIdx),i=this.scoreData.getMeasure(this.opts.partIdx,e.startMeasureIdx),j=d.getDpq(i),l=this.scoreData.getMeasure(this.opts.partIdx,e.stopMeasureIdx),m=d.getDpq(l);return{startMeasureUuid:f,startTimePos:e.startTimePos,stopTimePos:e.stopTimePos,startDpq:j,stopMeasureUuid:h,stopDpq:m,placement:e.placement}},o.removePedal=function(){var a=this.getLocalTimePos(),b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,timePos:a};new m(this.scoreData,b,this.cancelStack).perform()},o.updateStack=function(a){var b=this.getLocation(),c={type:this.name,noDraw:!0,opts:{partUuid:b.partUuid,startMeasureUuid:a.startMeasureUuid,startTimePos:a.startTimePos,startDpq:a.startDpq,stopMeasureUuid:a.stopMeasureUuid,stopTimePos:a.stopTimePos,stopDpq:a.stopDpq,staffIdx:this.opts.staffIdx,placement:a.placement}};this.cancelStack.push(c)},o.getLocation=function(){if(null===this.location){var a=this.scoreData.getPartUuid(this.opts.partIdx),b=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={partUuid:a,measureUuid:b}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Utils.math,b=Adagio.Utils.measureUtils,c=Adagio.Utils.direction.pedalDirectionUtils,d=Adagio.Values.PedalType,e=Adagio.edit.action.RemovePedalAtTimePos,f=Adagio.edit.common.assertPerform,g=Adagio.edit.composite.RemovePedalsRange=function(a,b,c){this.init(a,b,c)};g.NAME="composite.RemovePedalsRange";var h=g.prototype;h.name=g.NAME,h.init=function(a,b,c){this.scoreData=a,this.opts=b,this.cancelStack=c,this.currentMeasureIdx=null},h.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeLeftPedals(),this.removeLeftMeasurePedals(),this.removeMiddleMeasurePedals(),this.removeRightMeasurePedals()},h.removeLeftPedals=function(){this.currentMeasureIdx=this.opts.startMeasureIdx;var a=this.getMeasure(this.currentMeasureIdx),c=b.getPedals(a,this.opts.staffIdx);if(c=c.filter(function(a){return this.isBeforeLimit(a,this.opts.startMeasureIdx,this.opts.startTimePos,this.opts.startDpq)},this),0!==c.length){var d=c.pop();i(d)&&this.removeFromEntry(d)}else this.hasLeftPedal()&&this.removeCrossMeasurePedal()},h.removeCrossMeasurePedal=function(){this.removePedal(0,1,this.opts.staffIdx)},h.removeLeftMeasurePedals=function(){var a=this.getPedalStarts();a=a.filter(this.isWithinLimits,this),a.forEach(this.removeFromEntry,this);var b=this.getPedalsStops();b=b.filter(this.isWithinLimits,this),b.forEach(this.removeFromEntry,this)},h.removeMiddleMeasurePedals=function(){for(var a=this.opts.startMeasureIdx+1;a<this.opts.stopMeasureIdx;a++){this.currentMeasureIdx=a;this.getPedalStarts().forEach(this.removeFromEntry,this);this.getPedalsStops().forEach(this.removeFromEntry,this)}},h.removeRightMeasurePedals=function(){this.currentMeasureIdx=this.opts.stopMeasureIdx;var a=this.getPedalStarts();a=a.filter(this.isWithinLimits,this),a.forEach(this.removeFromEntry,this);var b=this.getPedalsStops();b=b.filter(this.isWithinLimits,this),b.forEach(this.removeFromEntry,this)},h.removeFromEntry=function(a){var d=c.getTimePos(a),e=c.getStaffIdx(a),f=this.getMeasure(this.currentMeasureIdx),g=b.getDpq(f);this.removePedal(d,g,e)},h.removePedal=function(a,b,c){var d={partIdx:this.opts.partIdx,measureIdx:this.currentMeasureIdx,timePos:a,dpq:b,staffIdx:c},g=new e(this.scoreData,d,this.cancelStack);f(g)},h.isWithinLimits=function(a){return!(this.currentMeasureIdx<this.opts.startMeasureIdx)&&(!(this.currentMeasureIdx>this.opts.stopMeasureIdx)&&(this.currentMeasureIdx>this.opts.startMeasureIdx&&this.currentMeasureIdx<this.opts.stopMeasureIdx||!(this.currentMeasureIdx===this.opts.startMeasureIdx&&!this.isAfterLimit(a,this.opts.startMeasureIdx,this.opts.startTimePos,this.opts.startDpq))&&!(this.currentMeasureIdx===this.opts.stopMeasureIdx&&!this.isBeforeLimit(a,this.opts.stopMeasureIdx,this.opts.stopTimePos,this.opts.stopDpq))))},h.isAfterLimit=function(d,e,f,g){var h=this.getMeasure(e),i=b.getDpq(h),j=a.lcm(i,g);return!(c.getTimePos(d)*j/i<f*j/g)},h.isBeforeLimit=function(d,e,f,g){var h=this.getMeasure(e),i=b.getDpq(h),j=a.lcm(i,g);return!(c.getTimePos(d)*j/i>f*j/g)},h.getPedalStarts=function(){var a=this.getMeasure(this.currentMeasureIdx),c=b.getPedals(a,this.opts.staffIdx);return c=c.filter(i)};var i=function(a){return c.getType(a)===d.START};h.getPedalsStops=function(){var a=this.getMeasure(this.currentMeasureIdx),c=b.getPedals(a,this.opts.staffIdx);return c=c.filter(j)};var j=function(a){return c.getType(a)===d.STOP};h.getMeasure=function(a){return this.scoreData.getMeasure(this.opts.partIdx,a)},h.hasLeftPedal=function(){var a=this.getMeasure(this.currentMeasureIdx);return b.hasLeftPedal(a,this.opts.staffIdx)}}.call(this),function(){"use strict";var a=Adagio.edit.composite.AdaptDpqToPosition,b=Adagio.edit.common.optsToLocalGetTimePos,c=Adagio.Values.PedalType,d=Adagio.Utils.measureUtils,e=Adagio.edit.primitive.AddPedal,f=Adagio.edit.primitive.AddPedalContinue,g=Adagio.edit.composite.RemovePedalsRange,h=Adagio.edit.composite.AddPedal=function(a,b,c){this.init(a,b,c)};h.NAME="composite.AddPedal";var i=h.prototype;i.name=h.NAME,i.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},i.perform=function(){this.updateStartDpq(),this.updateStopDpq(),this.removeExistingPedals(),this.addPedalLeftSide(),this.addPedalRightSide(),this.addPedalContinues()},i.updateStartDpq=function(){var c={partIdx:this.opts.partIdx,measureIdx:this.opts.startMeasureIdx,timePos:this.opts.startTimePos,dpq:this.opts.startDpq};new a(this.scoreData,c,this.cancelStack).perform();var e=this.scoreData.getMeasure(this.opts.partIdx,this.opts.startMeasureIdx),f={timePos:this.opts.startTimePos,dpq:this.opts.startDpq};this.opts.startTimePos=b(f,e),this.opts.startDpq=d.getDpq(e)},i.updateStopDpq=function(){var c={partIdx:this.opts.partIdx,measureIdx:this.opts.stopMeasureIdx,timePos:this.opts.stopTimePos,dpq:this.opts.stopDpq};new a(this.scoreData,c,this.cancelStack).perform();var e=this.scoreData.getMeasure(this.opts.partIdx,this.opts.stopMeasureIdx),f={timePos:this.opts.stopTimePos,dpq:this.opts.stopDpq};this.opts.stopTimePos=b(f,e),this.opts.stopDpq=d.getDpq(e)},i.removeExistingPedals=function(){var a={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,startTimePos:this.opts.startTimePos,startDpq:this.opts.startDpq,stopTimePos:this.opts.stopTimePos,stopDpq:this.opts.stopDpq};new g(this.scoreData,a,this.cancelStack).perform()},i.addPedalLeftSide=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.startMeasureIdx,timePos:this.opts.startTimePos,placement:this.opts.placement,type:c.START,staffIdx:this.opts.staffIdx};new e(this.scoreData,a,this.cancelStack).perform()},i.addPedalRightSide=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.stopMeasureIdx,timePos:this.opts.stopTimePos,placement:this.opts.placement,type:c.STOP,staffIdx:this.opts.staffIdx};new e(this.scoreData,a,this.cancelStack).perform()},i.addPedalContinues=function(){for(var a=this.opts.startMeasureIdx;a<this.opts.stopMeasureIdx;a++)this.addPedalContinue(a)},i.addPedalContinue=function(a){var b={partIdx:this.opts.partIdx,measureIdx:a,placement:this.opts.placement,staffIdx:this.opts.staffIdx};new f(this.scoreData,b,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.edit.common.convertPartUuidToGetPartIdx,b=Adagio.edit.common.convertMeasureUuidToStartStop,c=Adagio.edit.common.optsToLocalGetTimePos,d=Adagio.Utils.measureUtils,e=Adagio.Utils.math,f=Adagio.Error.client.TimePosOutOfRangeError,g=Adagio.Error.client.RevertRangeError,h=Adagio.Error.client.EmptyRangeError,i=Adagio.Error.client.BadStaffIdxError,j=Adagio.Values.DirectionPlacement,k=Adagio.edit.composite.AddPedal,l=Adagio.edit.action.AddPedalAtTimePos=function(a,b,c){this.init(a,b,c)};l.NAME="action.AddPedalAtTimePos";var m=l.prototype;m.name=l.NAME,m.init=function(c,d,e){a(c,d),b(c,d),this.scoreData=c,this.opts=d,this.cancelStack=e,this.location=null,this.measuresSlice=null,this.wrappedPedalDirections=null},m.checkPreconditions=function(){this.checkLocation(),this.checkValues()},m.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.startMeasureIdx),this.scoreData.checkMeasureIdx(this.opts.stopMeasureIdx),this.checkStartTimePos(),this.checkStopTimePos(),this.checkRevertRange()},m.checkStartTimePos=function(){var a=this.getStartMeasure(),b={dpq:this.opts.startDpq,timePos:this.opts.startTimePos},g=c(b,a),h=d.getNbDivisions(a);if(!e.isNumber(g)||g<0||g>=h){var i=d.getDpq(a);throw new f(g,i)}},m.checkStopTimePos=function(){var a=this.getStopMeasure(),b={dpq:this.opts.stopDpq,timePos:this.opts.stopTimePos},g=c(b,a),h=d.getNbDivisions(a);if(!e.isNumber(g)||g<0||g>h){var i=d.getDpq(a);throw new f(g,i)}},m.getStopMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.stopMeasureIdx)},m.checkRevertRange=function(){var a=this.opts.startMeasureIdx,b=this.opts.stopMeasureIdx,c=b-a;if(c<0)throw new g(g.MEASURE,a,b);if(0===c){var d=this.opts.startTimePos,e=this.opts.stopTimePos;if(d>e)throw new g(g.TIME_POS,d,e);if(d===e)throw new h(h.TIME_POS)}},m.checkValues=function(){this.checkStaffIdx(),j.check(this.opts.placement)},m.checkStaffIdx=function(){var a=this.getStartMeasure(),b=d.getNbStaves(a);if(this.opts.staffIdx<0||this.opts.staffIdx>=b)throw new i(this.opts.staffIdx)},m.getStartMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.startMeasureIdx)},m.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.addPedal(),this.updateStack()},m.addPedal=function(){var a={partIdx:this.opts.partIdx,startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,staffIdx:this.opts.staffIdx,startTimePos:this.opts.startTimePos,startDpq:this.opts.startDpq,stopTimePos:this.opts.stopTimePos,stopDpq:this.opts.stopDpq,placement:this.opts.placement};new k(this.scoreData,a,this.cancelStack).perform()},m.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,startMeasureUuid:a.startMeasureUuid,startTimePos:this.opts.startTimePos,startDpq:this.opts.startDpq,stopMeasureUuid:a.stopMeasureUuid,stopTimePos:this.opts.stopTimePos,stopDpq:this.opts.stopDpq,staffIdx:this.opts.staffIdx,placement:this.opts.placement}};this.cancelStack.storeAction(b)}},m.updateStack=function(){var a=this.getLocation(),b={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuid:a.startMeasureUuid,timePos:this.opts.startTimePos,dpq:this.opts.startDpq,staffIdx:this.opts.staffIdx}};this.cancelStack.push(b)},m.getLocation=function(){if(null===this.location){var a=this.scoreData.getPartUuid(this.opts.partIdx),b=this.scoreData.getMeasureUuid(this.opts.startMeasureIdx),c=this.scoreData.getMeasureUuid(this.opts.stopMeasureIdx);this.location={partUuid:a,startMeasureUuid:b,stopMeasureUuid:c}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Utils.partContentUtils,b=Adagio.Utils.noteUtils,c=Adagio.edit.common.MeasuresScroller,d=Adagio.edit.common.voiceIdxToStartStop,e=Adagio.edit.action.AddPedalAtTimePos,f=Adagio.edit.action.AddPedal=function(a,b,c){this.init(a,b,c)};f.NAME="action.AddPedal";var g=f.prototype;g.name=f.NAME,g.init=function(a,b,c){d(b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.measuresScroller=null,this.action=null,this.startTimePos=null,this.stopTimePos=null},g.checkPreconditions=function(){this.checkLocation(),this.getAction().checkPreconditions()},g.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.startMeasureIdx),this.scoreData.checkMeasureIdx(this.opts.stopMeasureIdx),this.getStartMeasureData().checkVoiceIdx(this.opts.startVoiceIdx),this.getStartVoice().checkNoteIdx(this.opts.startNoteIdx),this.getStopMeasureData().checkVoiceIdx(this.opts.stopVoiceIdx),this.getStopVoice().checkInsertionIdx(this.opts.stopNoteIdx)},g.getAction=function(){if(null===this.action){var a=this.getStartMeasureData(),b=a.getDpqValue(),c=this.getStartTimePos(),d=this.getStopMeasureData(),f=d.getDpqValue(),g=this.getStopTimePos(),h={partIdx:this.opts.partIdx,startMeasureIdx:this.opts.startMeasureIdx,startTimePos:c,startDpq:b,stopMeasureIdx:this.opts.stopMeasureIdx,stopTimePos:g,stopDpq:f,staffIdx:this.opts.staffIdx,placement:this.opts.placement};this.action=new e(this.scoreData,h,this.cancelStack)}return this.action},g.getStartTimePos=function(){if(null===this.startTimePos){var a=this.getStartVoice();this.startTimePos=h(a,this.opts.startNoteIdx)}return this.startTimePos},g.getStopTimePos=function(){if(null===this.stopTimePos){var a=this.getStopVoice();this.stopTimePos=h(a,this.opts.stopNoteIdx)}return this.stopTimePos};var h=function(a,c){for(var d=0,e=0;e<c;e++){var f=a.getNote(e);d+=b.getDuration(f)}return d};g.getStartVoice=function(){return this.getStartMeasureData().getVoice(this.opts.startVoiceIdx)},g.getStopVoice=function(){return this.getStopMeasureData().getVoice(this.opts.stopVoiceIdx)},g.getStartMeasureData=function(){return this.getMeasuresScroller().getMeasureData(this.opts.startMeasureIdx)},g.getStopMeasureData=function(){return this.getMeasuresScroller().getMeasureData(this.opts.stopMeasureIdx)},g.getMeasuresScroller=function(){if(null===this.measuresScroller){var b=this.opts.partIdx,d=this.scoreData.getPartContent(b),e=a.getMeasures(d);this.measuresScroller=new c(e,b,this.scoreData)}return this.measuresScroller},g.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a=this.getAction();a.cancelStack=this.cancelStack,a.perform()}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.durationUtils,c=Adagio.Utils.direction.tempoChangeDirectionUtils,d=Adagio.edit.primitive.AddTempoChange=function(a,b,c){this.init(a,b,c)};d.NAME="primitive.AddTempoChange";var e=d.prototype;e.name=d.NAME,e.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.tempoChangeIdx=null,this.localTimePos=null},e.perform=function(){this.addTempoChange(),this.updateStack()},e.addTempoChange=function(){var a=this.getCommonContent(),b=this.getTempoChangeIdx(),c=this.createTempoChange(),d=a.getTempoChanges(this.opts.measureIdx);d.splice(b,0,c),a.setTempoChanges(this.opts.measureIdx,d)},e.getTempoChangeIdx=function(){return null===this.tempoChangeIdx&&this.fetchTempoChangeIdx(),this.tempoChangeIdx},e.fetchTempoChangeIdx=function(){var a=this.getCommonContent(),b=a.getTempoChanges(this.opts.measureIdx);if(b.some(this.tryTempoChangeIdx,this),null===this.tempoChangeIdx){var c=b.length;this.tempoChangeIdx=c}},e.tryTempoChangeIdx=function(d,e){var f=b.divisionsToQuarter(this.opts.timePos,this.opts.dpq),g=c.getQuarterPos(d);if(g<f)return!1;if(g>f)return this.tempoChangeIdx=e,!0;throw new a("TimePosCollision","There is already a tempo change at this time position.")},e.getCommonContent=function(){return this.scoreData.getCommonContent()},e.createTempoChange=function(){return c.create(this.opts.timePos,this.opts.dpq,this.opts.type)},e.updateStack=function(){var a={type:this.name,opts:{partIdx:0,measureIdx:this.opts.measureIdx}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.Utils.direction.tempoChangeDirectionUtils,b=Adagio.Values.TempoChangeType,c=Adagio.Values.TempoChangeLocation,d=Adagio.edit.primitive.AddTempoChangeContinue=function(a,b,c){this.init(a,b,c)}
;d.NAME="primitive.AddTempoChangeContinue";var e=d.prototype;e.name=d.NAME,e.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},e.perform=function(){this.addLeftTempoChange(),this.addRightPedal(),this.updateStack()},e.addLeftTempoChange=function(){var a=this.getCommonContent(),b=c.RIGHT,d=this.createTempoChange(b);a.setRightTempoChange(this.opts.measureIdx,d)},e.addRightPedal=function(){var a=this.getCommonContent(),b=c.LEFT,d=this.createTempoChange(b);a.setLeftTempoChange(this.opts.measureIdx+1,d)},e.createTempoChange=function(c){return a.create(null,null,b.CONTINUE,c)},e.getCommonContent=function(){return this.scoreData.getCommonContent()},e.updateStack=function(){var a={type:this.name,opts:{partIdx:0,measureIdx:this.opts.measureIdx}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.direction.tempoChangeDirectionUtils,c=Adagio.Utils.durationUtils,d=Adagio.edit.primitive.RemoveTempoChange=function(a,b,c){this.init(a,b,c)};d.NAME="primitive.RemoveTempoChange";var e=d.prototype;e.name=d.NAME,e.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.removedTempoChange=null,this.tempoChanges=null,this.tempoChangeIdx=null},e.perform=function(){this.removeTempoChange(),this.updateStack()},e.removeTempoChange=function(){var a=this.scoreData.getCommonContent(),b=a.getTempoChanges(this.opts.measureIdx),c=this.getTempoChangeIdx(),d=b.splice(c,1);this.removedTempoChange=d[0],a.setTempoChanges(this.opts.measureIdx,b)},e.updateStack=function(){var a={type:this.name,opts:{partIdx:0,measureIdx:this.opts.measureIdx}};this.cancelStack.push(a)},e.getTempoChangeIdx=function(){return null===this.tempoChangeIdx&&this.fetchTempoChangeIdx(),this.tempoChangeIdx},e.fetchTempoChangeIdx=function(){if(this.tempoChangeIdx=null,this.getTempoChanges().some(this.checkTempoChange,this),null===this.tempoChangeIdx)throw new a("MissingTempoChange")},e.checkTempoChange=function(a,d){var e=b.getQuarterPos(a),f=c.divisionsToQuarter(this.opts.timePos,this.opts.dpq),g=b.getType(a);return!(e<f)&&(e===f&&g===this.opts.type&&(this.tempoChangeIdx=d),!0)},e.getTempoChanges=function(){if(null===this.tempoChanges){var a=this.scoreData.getCommonContent();this.tempoChanges=a.getTempoChanges(this.opts.measureIdx)}return this.tempoChanges},e.getMeasure=function(){return this.scoreData.getMeasure(0,this.opts.measureIdx)}}.call(this);(function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.edit.primitive.RemoveTempoChangeContinue=function(a,b,c){this.init(a,b,c)};b.NAME="primitive.RemoveTempoChangeContinue";var c=b.prototype;c.name=b.NAME,c.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},c.perform=function(){this.removeLeftTempoChange(),this.removeRightTempoChange(),this.updateStack()},c.removeLeftTempoChange=function(){var b=this.scoreData.getCommonContent();if(!b.hasRightTempoChange(this.opts.measureIdx)){throw new a("MissingRightContinueTempoChange","There is no right tempo change to remove on the left measure.")}b.removeRightTempoChange(this.opts.measureIdx)},c.removeRightTempoChange=function(){var b=this.scoreData.getCommonContent();if(!b.hasLeftTempoChange(this.opts.measureIdx+1)){throw new a("MissingLeftContinueTempoChange","There is no left tempo change to remove on the left measure.")}b.removeLeftTempoChange(this.opts.measureIdx+1)},c.updateStack=function(){var a={type:this.name,opts:{partIdx:0,measureIdx:this.opts.measureIdx}};this.cancelStack.push(a)}}).call(this),function(){"use strict";var a=Adagio.Values.TempoChangeType,b=Adagio.edit.common.searchTempoChangeSides,c=Adagio.edit.primitive.RemoveTempoChange,d=Adagio.edit.primitive.RemoveTempoChangeContinue,e=Adagio.edit.composite.RemoveTempoChange=function(a,b,c){this.init(a,b,c)};e.NAME="composite.RemoveTempoChange";var f=e.prototype;f.name=e.NAME,f.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.startMeasureIdx=null,this.startTimePos=null,this.startDpq=null,this.stopMeasureIdx=null,this.stopTimePos=null,this.stopDpq=null},f.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.searchSides(),this.removeStart(),this.removeStop(),this.removeContinues()},f.searchSides=function(){var a=this.getCommonContent(),c=b(a,this.opts.measureIdx,this.opts.timePos,this.opts.dpq);this.startMeasureIdx=c.startMeasureIdx,this.startTimePos=c.startTimePos,this.startDpq=c.startDpq,this.stopMeasureIdx=c.stopMeasureIdx,this.stopTimePos=c.stopTimePos,this.stopDpq=c.stopDpq,this.type=c.type},f.getCommonContent=function(){return this.scoreData.getCommonContent()},f.removeStart=function(){var a={measureIdx:this.startMeasureIdx,timePos:this.startTimePos,dpq:this.startDpq,type:this.type};new c(this.scoreData,a,this.cancelStack).perform()},f.removeStop=function(){var b={measureIdx:this.stopMeasureIdx,timePos:this.stopTimePos,dpq:this.stopDpq,type:a.STOP};new c(this.scoreData,b,this.cancelStack).perform()},f.removeContinues=function(){for(var a=this.startMeasureIdx;a<this.stopMeasureIdx;a++)this.removeContinue(a)},f.removeContinue=function(a){var b={measureIdx:a};new d(this.scoreData,b,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.client.NoTempoChangeError,b=Adagio.Error.client.TimePosOutOfRangeError,c=Adagio.Utils.measureUtils,d=Adagio.Utils.math,e=Adagio.Utils.durationUtils,f=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,g=Adagio.edit.common.searchTempoChangeSides,h=Adagio.Data.tempoChange.searchTempoChange,i=Adagio.edit.composite.RemoveTempoChange,j=Adagio.edit.action.RemoveTempoChangeAtTimePos=function(a,b,c){this.init(a,b,c)};j.NAME="action.RemoveTempoChangeAtTimePos";var k=j.prototype;k.name=j.NAME,k.init=function(a,b,c){f(a,b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.measureData=null,this.location=null},k.checkPreconditions=function(){this.checkLocation(),this.checkTimePos(),this.checkExistence()},k.checkLocation=function(){this.scoreData.checkMeasureIdx(this.opts.measureIdx)},k.checkTimePos=function(){var a=this.opts.timePos,f=this.opts.dpq;if(!d.isInteger(a)||a<0)throw new b(a,f);if(!d.isInteger(f)||f<1)throw new b(a,f);var g=this.getMeasure(),h=c.getQuarterDuration(g);if(e.divisionsToQuarter(a,f)>=h)throw new b(a,f)},k.getMeasure=function(){return this.scoreData.getMeasure(0,this.opts.measureIdx)},k.checkExistence=function(){if(!this.hasTempoChange())throw new a},k.hasTempoChange=function(){var a=this.getCommonContent(),b=a.getTempoChanges(this.opts.measureIdx),c=a.getLeftTempoChange(this.opts.measureIdx);return null!==h(c,b,this.opts.timePos,this.opts.dpq)},k.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a=this.getPreviousData();this.removeTempoChange(),this.updateStack(a)},k.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{measureUuid:a.measureUuid,timePos:this.opts.timePos,dpq:this.opts.dpq}};this.cancelStack.storeAction(b)}},k.getPreviousData=function(){var a=this.getCommonContent(),b=g(a,this.opts.measureIdx,this.opts.timePos,this.opts.dpq),c=this.scoreData.getMeasureUuid(b.startMeasureIdx),d=this.scoreData.getMeasureUuid(b.stopMeasureIdx);return{startMeasureUuid:c,startTimePos:b.startTimePos,startDpq:b.startDpq,stopMeasureUuid:d,stopTimePos:b.stopTimePos,stopDpq:b.stopDpq,type:b.type}},k.getCommonContent=function(){return this.scoreData.getCommonContent()},k.removeTempoChange=function(){var a={measureIdx:this.opts.measureIdx,timePos:this.opts.timePos,dpq:this.opts.dpq};new i(this.scoreData,a,this.cancelStack).perform()},k.updateStack=function(a){var b={type:this.name,noDraw:!0,opts:{startMeasureUuid:a.startMeasureUuid,startTimePos:a.startTimePos,startDpq:a.startDpq,stopMeasureUuid:a.stopMeasureUuid,stopTimePos:a.stopTimePos,stopDpq:a.stopDpq,type:a.type}};this.cancelStack.push(b)},k.getLocation=function(){if(null===this.location){var a=this.scoreData.getPartUuid(0),b=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={partUuid:a,measureUuid:b}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Utils.durationUtils,b=Adagio.Utils.direction.tempoChangeDirectionUtils,c=Adagio.Values.TempoChangeType,d=Adagio.edit.action.RemoveTempoChangeAtTimePos,e=Adagio.edit.common.assertPerform,f=Adagio.edit.composite.RemoveTempoChangesRange=function(a,b,c){this.init(a,b,c)};f.NAME="composite.RemoveTempoChangesRange";var g=f.prototype;g.name=f.NAME,g.init=function(a,b,c){this.scoreData=a,this.opts=b,this.cancelStack=c,this.currentMeasureIdx=null},g.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeLeftTempoChanges(),this.removeLeftMeasureTempoChanges(),this.removeMiddleMeasureTempoChanges(),this.removeRightMeasureTempoChanges()},g.removeLeftTempoChanges=function(){this.currentMeasureIdx=this.opts.startMeasureIdx;var a=this.getCommonContent(),b=a.getTempoChanges(this.currentMeasureIdx);if(b=b.filter(function(a){return this.isBeforeLimit(a,this.opts.startMeasureIdx,this.opts.startTimePos,this.opts.startDpq)},this),0!==b.length){var c=b.pop();h(c)&&this.removeFromEntry(c)}else this.hasLeftTempoChange()&&this.removeCrossMeasureTempoChange()},g.removeCrossMeasureTempoChange=function(){this.removeTempoChange(0,1,this.opts.staffIdx)},g.removeLeftMeasureTempoChanges=function(){var a=this.getTempoChangeStarts();a=a.filter(this.isWithinLimits,this),a.forEach(this.removeFromEntry,this);var b=this.getTempoChangeStops();b=b.filter(this.isWithinLimits,this),b.forEach(this.removeFromEntry,this)},g.removeMiddleMeasureTempoChanges=function(){for(var a=this.opts.startMeasureIdx+1;a<this.opts.stopMeasureIdx;a++){this.currentMeasureIdx=a;this.getTempoChangeStarts().forEach(this.removeFromEntry,this);this.getTempoChangeStops().forEach(this.removeFromEntry,this)}},g.removeRightMeasureTempoChanges=function(){this.currentMeasureIdx=this.opts.stopMeasureIdx;var a=this.getTempoChangeStarts();a=a.filter(this.isWithinLimits,this),a.forEach(this.removeFromEntry,this);var b=this.getTempoChangeStops();b=b.filter(this.isWithinLimits,this),b.forEach(this.removeFromEntry,this)},g.removeFromEntry=function(a){var c=b.getTimePos(a),d=b.getDpq(a);this.removeTempoChange(c,d)},g.removeTempoChange=function(a,b){var c={partIdx:0,measureIdx:this.currentMeasureIdx,timePos:a,dpq:b},f=new d(this.scoreData,c,this.cancelStack);e(f)},g.isWithinLimits=function(a){return!(this.currentMeasureIdx<this.opts.startMeasureIdx)&&(!(this.currentMeasureIdx>this.opts.stopMeasureIdx)&&(this.currentMeasureIdx>this.opts.startMeasureIdx&&this.currentMeasureIdx<this.opts.stopMeasureIdx||!(this.currentMeasureIdx===this.opts.startMeasureIdx&&!this.isAfterLimit(a,this.opts.startMeasureIdx,this.opts.startTimePos,this.opts.startDpq))&&!(this.currentMeasureIdx===this.opts.stopMeasureIdx&&!this.isBeforeLimit(a,this.opts.stopMeasureIdx,this.opts.stopTimePos,this.opts.stopDpq))))},g.isAfterLimit=function(c,d,e,f){return!(b.getQuarterPos(c)<a.divisionsToQuarter(e,f))},g.isBeforeLimit=function(c,d,e,f){return!(b.getQuarterPos(c)>a.divisionsToQuarter(e,f))},g.getTempoChangeStarts=function(){var a=this.scoreData.getCommonContent(),b=a.getTempoChanges(this.currentMeasureIdx);return b=b.filter(h)};var h=function(a){var d=b.getType(a);return d===c.ACCELERANDO||d===c.RITARDANDO};g.getTempoChangeStops=function(){var a=this.scoreData.getCommonContent(),b=a.getTempoChanges(this.currentMeasureIdx);return b=b.filter(i)};var i=function(a){return b.getType(a)===c.STOP};g.hasLeftTempoChange=function(){return this.getCommonContent().hasLeftTempoChange(this.currentMeasureIdx)},g.getCommonContent=function(){return this.scoreData.getCommonContent()}}.call(this),function(){"use strict";var a=Adagio.Values.TempoChangeType,b=Adagio.edit.primitive.AddTempoChange,c=Adagio.edit.primitive.AddTempoChangeContinue,d=Adagio.edit.composite.RemoveTempoChangesRange,e=Adagio.edit.composite.AddTempoChange=function(a,b,c){this.init(a,b,c)};e.NAME="composite.AddTempoChange";var f=e.prototype;f.name=e.NAME,f.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},f.perform=function(){this.removeExistingTempoChanges(),this.addTempoChangeLeftSide(),this.addTempoChangeRightSide(),this.addTempoChangeContinues()},f.removeExistingTempoChanges=function(){var a={startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,startTimePos:this.opts.startTimePos,startDpq:this.opts.startDpq,stopTimePos:this.opts.stopTimePos,stopDpq:this.opts.stopDpq};new d(this.scoreData,a,this.cancelStack).perform()},f.addTempoChangeLeftSide=function(){var a={measureIdx:this.opts.startMeasureIdx,timePos:this.opts.startTimePos,dpq:this.opts.startDpq,type:this.opts.type};new b(this.scoreData,a,this.cancelStack).perform()},f.addTempoChangeRightSide=function(){var c={measureIdx:this.opts.stopMeasureIdx,timePos:this.opts.stopTimePos,dpq:this.opts.stopDpq,type:a.STOP};new b(this.scoreData,c,this.cancelStack).perform()},f.addTempoChangeContinues=function(){for(var a=this.opts.startMeasureIdx;a<this.opts.stopMeasureIdx;a++)this.addTempoChangeContinue(a)},f.addTempoChangeContinue=function(a){var b={measureIdx:a};new c(this.scoreData,b,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.edit.common.convertMeasureUuidToStartStop,b=Adagio.edit.common.optsToLocalGetTimePos,c=Adagio.Utils.measureUtils,d=Adagio.Utils.math,e=Adagio.Error.client.TimePosOutOfRangeError,f=Adagio.Error.client.RevertRangeError,g=Adagio.Error.client.EmptyRangeError,h=Adagio.Values.TempoChangeType,i=Adagio.edit.composite.AddTempoChange,j=Adagio.edit.action.AddTempoChangeAtTimePos=function(a,b,c){this.init(a,b,c)};j.NAME="action.AddTempoChangeAtTimePos";var k=j.prototype;k.name=j.NAME,k.init=function(b,c,d){a(b,c),this.scoreData=b,this.opts=c,this.cancelStack=d,this.location=null,this.measuresSlice=null,this.wrappedPedalDirections=null},k.checkPreconditions=function(){this.checkLocation(),this.checkValues()},k.checkLocation=function(){this.scoreData.checkMeasureIdx(this.opts.startMeasureIdx),this.scoreData.checkMeasureIdx(this.opts.stopMeasureIdx),this.checkStartTimePos(),this.checkStopTimePos(),this.checkRevertRange()},k.checkStartTimePos=function(){var a=this.getStartMeasure(),f={dpq:this.opts.startDpq,timePos:this.opts.startTimePos},g=b(f,a),h=c.getNbDivisions(a);if(!d.isNumber(g)||g<0||g>=h){var i=c.getDpq(a);throw new e(g,i)}},k.checkStopTimePos=function(){var a=this.getStopMeasure(),f={dpq:this.opts.stopDpq,timePos:this.opts.stopTimePos},g=b(f,a),h=c.getNbDivisions(a);if(!d.isNumber(g)||g<0||g>h){var i=c.getDpq(a);throw new e(g,i)}},k.getStopMeasure=function(){return this.scoreData.getMeasure(0,this.opts.stopMeasureIdx)},k.checkRevertRange=function(){var a=this.opts.startMeasureIdx,b=this.opts.stopMeasureIdx,c=b-a;if(c<0)throw new f(f.MEASURE,a,b);if(0===c){var d=this.opts.startTimePos,e=this.opts.stopTimePos;if(d>e)throw new f(f.TIME_POS,d,e);if(d===e)throw new g(g.TIME_POS)}},k.checkValues=function(){h.check(this.opts.type)},k.getStartMeasure=function(){return this.scoreData.getMeasure(0,this.opts.startMeasureIdx)},k.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.addTempoChange(),this.updateStack()},k.addTempoChange=function(){var a={startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,startTimePos:this.opts.startTimePos,startDpq:this.opts.startDpq,stopTimePos:this.opts.stopTimePos,stopDpq:this.opts.stopDpq,type:this.opts.type};new i(this.scoreData,a,this.cancelStack).perform()},k.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{startMeasureUuid:a.startMeasureUuid,startTimePos:this.opts.startTimePos,startDpq:this.opts.startDpq,stopMeasureUuid:a.stopMeasureUuid,stopTimePos:this.opts.stopTimePos,stopDpq:this.opts.stopDpq,type:this.opts.type}};this.cancelStack.storeAction(b)}},k.updateStack=function(){var a=this.getLocation(),b={type:this.name,noDraw:!0,opts:{measureUuid:a.startMeasureUuid,timePos:this.opts.startTimePos,dpq:this.opts.startDpq,type:this.opts.type}};this.cancelStack.push(b)},k.getLocation=function(){if(null===this.location){var a=this.scoreData.getMeasureUuid(this.opts.startMeasureIdx),b=this.scoreData.getMeasureUuid(this.opts.stopMeasureIdx);this.location={startMeasureUuid:a,stopMeasureUuid:b}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Utils.partContentUtils,b=Adagio.Utils.noteUtils,c=Adagio.edit.common.MeasuresScroller,d=Adagio.edit.common.voiceIdxToStartStop,e=Adagio.edit.action.AddTempoChangeAtTimePos,f=Adagio.edit.action.AddTempoChange=function(a,b,c){this.init(a,b,c)};f.NAME="action.AddTempoChange";var g=f.prototype;g.name=f.NAME,g.init=function(a,b,c){d(b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.measuresScroller=null,this.action=null,this.startTimePos=null,this.stopTimePos=null},g.checkPreconditions=function(){this.checkLocation(),this.getAction().checkPreconditions()},g.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.startMeasureIdx),this.scoreData.checkMeasureIdx(this.opts.stopMeasureIdx),this.getStartMeasureData().checkVoiceIdx(this.opts.startVoiceIdx),this.getStartVoice().checkNoteIdx(this.opts.startNoteIdx),this.getStopMeasureData().checkVoiceIdx(this.opts.stopVoiceIdx),this.getStopVoice().checkInsertionIdx(this.opts.stopNoteIdx)},g.getAction=function(){if(null===this.action){var a=this.getStartMeasureData(),b=a.getDpqValue(),c=this.getStartTimePos(),d=this.getStopMeasureData(),f=d.getDpqValue(),g=this.getStopTimePos(),h={startMeasureIdx:this.opts.startMeasureIdx,startTimePos:c,startDpq:b,stopMeasureIdx:this.opts.stopMeasureIdx,stopTimePos:g,stopDpq:f,type:this.opts.type};this.action=new e(this.scoreData,h,this.cancelStack)}return this.action},g.getStartTimePos=function(){if(null===this.startTimePos){var a=this.getStartVoice();this.startTimePos=h(a,this.opts.startNoteIdx)}return this.startTimePos},g.getStopTimePos=function(){if(null===this.stopTimePos){var a=this.getStopVoice();this.stopTimePos=h(a,this.opts.stopNoteIdx)}return this.stopTimePos};var h=function(a,c){for(var d=0,e=0;e<c;e++){var f=a.getNote(e);d+=b.getDuration(f)}return d};g.getStartVoice=function(){return this.getStartMeasureData().getVoice(this.opts.startVoiceIdx)},g.getStopVoice=function(){return this.getStopMeasureData().getVoice(this.opts.stopVoiceIdx)},g.getStartMeasureData=function(){return this.getMeasuresScroller().getMeasureData(this.opts.startMeasureIdx)},g.getStopMeasureData=function(){return this.getMeasuresScroller().getMeasureData(this.opts.stopMeasureIdx)},g.getMeasuresScroller=function(){if(null===this.measuresScroller){var b=this.scoreData.getPartContent(this.opts.partIdx),d=a.getMeasures(b);this.measuresScroller=new c(d,this.opts.partIdx,this.scoreData)}return this.measuresScroller},g.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a=this.getAction();a.cancelStack=this.cancelStack,a.perform()}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.measureUtils,c=Adagio.Utils.direction.octaveShiftDirectionUtils,d=Adagio.edit.primitive.AddOctaveShift=function(a,b,c){this.init(a,b,c)};d.NAME="primitive.AddOctaveShift";var e=d.prototype;e.name=d.NAME,e.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.octaveShiftIdx=null,this.localTimePos=null},e.perform=function(){this.addOctaveShift(),this.updateStack()},e.addOctaveShift=function(){var a=this.getMeasure(),c=this.getOctaveShiftIdx(),d=this.createOctaveShift(),e=b.getOctaveShifts(a,this.opts.staffIdx);e.splice(c,0,d),b.setOctaveShifts(a,this.opts.staffIdx,e)},e.getOctaveShiftIdx=function(){return null===this.octaveShiftIdx&&this.fetchOctaveShiftIdx(),this.octaveShiftIdx},e.fetchOctaveShiftIdx=function(){var a=this.getMeasure(),c=b.getOctaveShifts(a,this.opts.staffIdx);if(c.some(this.tryOctaveShiftIdx,this),null===this.octaveShiftIdx){var d=c.length;this.octaveShiftIdx=d}},e.tryOctaveShiftIdx=function(b,d){var e=this.opts.timePos,f=c.getTimePos(b);if(f<e)return!1;if(f>e)return this.octaveShiftIdx=d,!0;throw new a("TimePosCollision","There is already a octave shift at this time position.")},e.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},e.createOctaveShift=function(){return c.create(this.opts.staffIdx,this.opts.placement,this.opts.timePos,this.opts.type,this.opts.size)},e.updateStack=function(){var a=this.getMeasure(),c=b.getDivisions(a),d={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:this.opts.timePos,divisions:c,staffIdx:this.opts.staffIdx,placement:this.opts.placement,type:this.opts.type,size:this.opts.size}};this.cancelStack.push(d)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.direction.octaveShiftDirectionUtils,c=Adagio.Values.OctaveShiftLocation,d=Adagio.edit.primitive.AddOctaveShiftContinue=function(a,b,c){this.init(a,b,c)};d.NAME="primitive.AddOctaveShiftContinue";var e=d.prototype;e.name=d.NAME,e.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},e.perform=function(){this.addLeftOctaveShift(),this.addRightOctaveShift(),this.updateStack()},e.addLeftOctaveShift=function(){var b=this.getLeftMeasure(),d=c.RIGHT,e=this.createDirection(d);a.setRightOctaveShift(b,this.opts.staffIdx,e)},e.getLeftMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},e.addRightOctaveShift=function(){var b=this.getRightMeasure(),d=c.LEFT,e=this.createDirection(d);a.setLeftOctaveShift(b,this.opts.staffIdx,e)},e.createDirection=function(a){return b.create(this.opts.staffIdx,this.opts.placement,0,this.opts.type,this.opts.size,a)},e.getRightMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx+1)},e.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,placement:this.opts.placement,type:this.opts.type,size:this.opts.size}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.Error.noChange.NoChangeError,b=Adagio.Utils.direction.octaveShiftDirectionUtils,c=Adagio.Utils.measureUtils,d=Adagio.edit.primitive.RemoveOctaveShift=function(a,b,c){this.init(a,b,c)};d.NAME="primitive.RemoveOctaveShift";var e=d.prototype;e.name=d.NAME,e.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.removedOctaveShift=null,this.octaveShifts=null,this.octaveShiftIdx=null},e.perform=function(){this.removeOctaveShift(),this.updateStack()},e.removeOctaveShift=function(){var a=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx),b=c.getOctaveShifts(a,this.opts.staffIdx),d=this.getOctaveShiftIdx(),e=b.splice(d,1);this.removedOctaveShift=e[0],c.setOctaveShifts(a,this.opts.staffIdx,b)},e.updateStack=function(){var a=this.getMeasure(),d=c.getDivisions(a),e=this.removedOctaveShift,f=b.getStaffIdx(e),g=b.getPlacement(e),h=b.getType(e),i=b.getSize(e),j={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:this.opts.timePos,divisions:d,staffIdx:f,placement:g,type:h,size:i}};this.cancelStack.push(j)},e.getOctaveShiftIdx=function(){return null===this.octaveShiftIdx&&this.fetchOctaveShiftIdx(),this.octaveShiftIdx},e.fetchOctaveShiftIdx=function(){if(this.octaveShiftIdx=null,this.getOctaveShifts().some(this.checkOctaveShift,this),null===this.octaveShiftIdx)throw new a},e.checkOctaveShift=function(a,c){var d=b.getTimePos(a),e=b.getType(a),f=b.getSize(a);return!(d<this.opts.timePos)&&(d===this.opts.timePos&&e===this.opts.type&&f===this.opts.size&&(this.octaveShiftIdx=c),!0)},e.getOctaveShifts=function(){if(null===this.octaveShifts){var a=this.getMeasure();this.octaveShifts=c.getOctaveShifts(a,this.opts.staffIdx)}return this.octaveShifts},e.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.measureUtils,c=Adagio.Utils.direction.octaveShiftDirectionUtils,d=Adagio.edit.primitive.RemoveOctaveShiftContinue=function(a,b,c){this.init(a,b,c)};d.NAME="primitive.RemoveOctaveShiftContinue";var e=d.prototype;e.name=d.NAME,e.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.removedOctaveShiftDirection=null},e.perform=function(){this.removeLeftOctaveShift(),this.removeRightOctaveShift(),this.updateStack()},e.removeLeftOctaveShift=function(){var c=this.getLeftMeasure();if(!b.hasRightOctaveShift(c,this.opts.staffIdx)){throw new a("MissingRightContinueOctaveShift","There is no right octave shift to remove on the left measure.")}this.removedOctaveShiftDirection=b.getRightOctaveShift(c,this.opts.staffIdx),b.removeRightOctaveShift(c,this.opts.staffIdx)},e.getLeftMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},e.removeRightOctaveShift=function(){var c=this.getRightMeasure();if(!b.hasLeftOctaveShift(c,this.opts.staffIdx)){throw new a("MissingLeftContinueOctaveShift","There is no left octave shift to remove on the left measure.")}b.removeLeftOctaveShift(c,this.opts.staffIdx)},e.getRightMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx+1)},e.updateStack=function(){var a=this.removedOctaveShiftDirection,b=c.getStaffIdx(a),d=c.getPlacement(a),e={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:b,placement:d}};this.cancelStack.push(e)}}.call(this),function(){"use strict";var a=Adagio.Values.OctaveShiftType,b=Adagio.Utils.partContentUtils,c=Adagio.edit.common.searchOctaveShiftSides,d=Adagio.edit.primitive.RemoveOctaveShift,e=Adagio.edit.primitive.RemoveOctaveShiftContinue,f=Adagio.edit.composite.RemoveOctaveShift=function(a,b,c){this.init(a,b,c)};f.NAME="composite.RemoveOctaveShift";var g=f.prototype;g.name=f.NAME,g.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.startMeasureIdx=null,this.startTimePos=null,this.stopMeasureIdx=null,this.stopTimePos=null,this.type=null,this.size=null},g.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.searchSides(),this.removeStart(),this.removeStop(),this.removeContinues()},g.searchSides=function(){var a=this.getMeasures(),b=c(a,this.opts.measureIdx,this.opts.staffIdx,this.opts.timePos);this.startMeasureIdx=b.startMeasureIdx,this.startTimePos=b.startTimePos,this.stopMeasureIdx=b.stopMeasureIdx,this.stopTimePos=b.stopTimePos,this.type=b.type,this.size=b.size},g.getMeasures=function(){var a=this.scoreData.getPartContent(this.opts.partIdx);return b.getMeasures(a)},g.removeStart=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.startMeasureIdx,staffIdx:this.opts.staffIdx,timePos:this.startTimePos,type:this.type,size:this.size};new d(this.scoreData,a,this.cancelStack).perform()},g.removeStop=function(){var b={partIdx:this.opts.partIdx,measureIdx:this.stopMeasureIdx,staffIdx:this.opts.staffIdx,timePos:this.stopTimePos,type:a.STOP,size:this.size};new d(this.scoreData,b,this.cancelStack).perform()},g.removeContinues=function(){for(var a=this.startMeasureIdx;a<this.stopMeasureIdx;a++)this.removeContinue(a)},g.removeContinue=function(a){var b={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,measureIdx:a};new e(this.scoreData,b,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Utils.pitchUtils,c=Adagio.Utils.transposeUtils,d=Adagio.Error.client.PitchOverflowError=function(d,e){var f="This transpose would cause a pitch overflow.",g=a.call(this,f);return this.name=g.name="PitchOverflowError",this.stack=g.stack,this.message=g.message,this.pitch=b.copy(d),this.transpose=c.copy(e),this};d.prototype=Object.create(a.prototype,{constructor:{value:d}})}.call(this),function(){"use strict";var a=Adagio.edit.action.AddToChord,b=Adagio.edit.action.RemoveFromChord,c=Adagio.edit.action.AddGlissando,d=Adagio.Utils.pitchUtils,e=Adagio.Utils.noteUtils,f=Adagio.Utils.glissandoUtils,g=Adagio.Utils.clone,h=Adagio.Values.TechnicalType,i=Adagio.Values.GlissandoType,j=Adagio.edit.common.initMeasureData,k=Adagio.edit.common.convertPartUuidToGetPartIdx,l=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,m=Adagio.edit.common.convertTimePosToGetNoteIdx,n=Adagio.edit.common.convertLineToPitch,o=Adagio.edit.common.getNoteAtPitch,p=Adagio.edit.common.isTabStaff,q=Adagio.edit.common.CrossMeasure,r=Adagio.edit.common.transposePitchLineOpts,s=Adagio.edit.common.transposePitchAccidentalOpts,t=Adagio.Error.client.NotPossibleOnUnpitchedError,u=Adagio.edit.action.ChangePitch=function(a,b,c){this.init(a,b,c)};u.NAME="action.ChangePitch",u.copyAddOpts=function(a){var b={partIdx:a.partIdx,measureIdx:a.measureIdx,voiceIdx:a.voiceIdx,staffIdx:a.staffIdx,noteIdx:a.noteIdx,accidental:a.accidental,fretData:a.fretData,isConcertPitch:a.isConcertPitch,checkLine:a.checkLine};return void 0!==a.toLine?b.line=a.toLine:void 0!==a.toPitch&&(b.pitch=d.copy(a.toPitch)),b},u.copyRemoveOpts=function(a){var b={partIdx:a.partIdx,measureIdx:a.measureIdx,voiceIdx:a.voiceIdx,staffIdx:a.staffIdx,noteIdx:a.noteIdx,isConcertPitch:a.isConcertPitch};return void 0!==a.fromLine?(b.line=a.fromLine,b.staffIdx=a.staffIdx):void 0!==a.fromPitch&&(b.pitch=d.copy(a.fromPitch)),b};var v=u.prototype;v.name=u.NAME,v.initMeasureData=j,v.init=function(a,b,c){k(a,b),l(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,m(this.measureData,this.opts),this.addAction=null,this.removeAction=null,this.leftCrossMeasure=null,this.rightCrossMeasure=null,this.noteAtPitch=null,this.location=null,this.sanitized=!1},v.checkPreconditions=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkPitchedPart();var a=this.measureData.getVoice(this.opts.voiceIdx);a.checkNoteIdx(this.opts.noteIdx),a.checkNotRest(this.opts.noteIdx),this.sanitizeIfNeeded(),this.getAddAction().checkPreconditions(),this.getRemoveAction().checkPitch()},v.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new t},v.sanitizeIfNeeded=function(){if(!this.sanitized){if(void 0!==this.opts.fromLine){var a={staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,isConcertPitch:this.opts.isConcertPitch,line:this.opts.fromLine};n(this.measureData,a,!0),this.opts.fromPitch=d.copy(a.pitch),delete this.opts.fromLine}if(void 0!==this.opts.toLine){var b={staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,isConcertPitch:this.opts.isConcertPitch,line:this.opts.toLine};n(this.measureData,b,!0),this.opts.toPitch=d.copy(b.pitch),delete this.opts.toLine}if(this.opts.isConcertPitch){var c={staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,isConcertPitch:this.opts.isConcertPitch,pitch:this.opts.fromPitch};r(this.measureData,c),this.opts.fromPitch=d.copy(c.pitch);var f={staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,isConcertPitch:this.opts.isConcertPitch,pitch:this.opts.toPitch,accidental:this.opts.accidental};s(this.measureData,f),this.opts.toPitch=d.copy(f.pitch),this.opts.accidental=f.accidental,this.opts.isConcertPitch=!1}if(this.isTabStaff()){var i=void 0===this.opts.fretData?{}:g(this.opts.fretData),j=this.getNoteAtPitch();if(void 0!==j&&e.hasTechnical(j,h.STRING)){var k=e.getTechnicalContent(j,h.STRING);i.lastString=void 0===i.lastString?k:i.lastString}this.opts.fretData=i}this.sanitized=!0}},v.isTabStaff=function(){return p(this.measureData,this.opts)},v.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.getActions().forEach(this.callPerform,this)},v.callPerform=function(a){a.cancelStack=this.cancelStack,a.perform()},v.getActions=function(){var a=[this.getAddAction(),this.getRemoveAction()];if(this.hasLeftGlissandos()){var b=this.getLeftGlissandoActions();a=a.concat(b)}if(this.hasRightGlissandos()){var c=this.getRightGlissandoActions()
;a=a.concat(c)}return a},v.getAddAction=function(){if(null===this.addAction){var b=u.copyAddOpts(this.opts);this.addAction=new a(this.measureData,b,this.cancelStack)}return this.addAction},v.getRemoveAction=function(){if(null===this.removeAction){var a=u.copyRemoveOpts(this.opts);this.removeAction=new b(this.measureData,a,this.cancelStack)}return this.removeAction},v.hasLeftGlissandos=function(){var a=this.getNoteAtPitch();return e.hasGlissandoType(a,i.STOP)},v.getLeftGlissandoActions=function(){var a=this.getNoteAtPitch(),b=e.getGlissandosType(a,i.STOP),g=this.getLeftCrossMeasure(),h=g.getLeftChord(),j=[];return b.forEach(function(a){var b=f.getNumber(a);h.forEach(function(a){if(e.hasGlissando(a,i.START,b)){var f=e.getPitch(a),g={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx-1,leftPitch:d.copy(f),rightPitch:d.copy(this.opts.toPitch),number:b},h=new c(this.measureData,g,this,this.cancelStack);j.push(h)}},this)},this),j},v.hasRightGlissandos=function(){var a=this.getNoteAtPitch();return e.hasGlissandoType(a,i.START)},v.getRightGlissandoActions=function(){var a=this.getNoteAtPitch(),b=e.getGlissandosType(a,i.START),g=this.getRightCrossMeasure(),h=g.getRightChord(),j=[];return b.forEach(function(a){var b=f.getNumber(a);h.forEach(function(a){if(e.hasGlissando(a,i.STOP,b)){var f=e.getPitch(a),g={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,leftPitch:d.copy(this.opts.toPitch),rightPitch:d.copy(f),number:b},h=new c(this.measureData,g,this,this.cancelStack);j.push(h)}},this)},this),j},v.getRightCrossMeasure=function(){return null===this.rightCrossMeasure&&(this.rightCrossMeasure=new q(this.measureData,this.opts.voiceIdx,this.opts.noteIdx)),this.rightCrossMeasure},v.getLeftCrossMeasure=function(){return null===this.leftCrossMeasure&&(this.leftCrossMeasure=new q(this.measureData,this.opts.voiceIdx,this.opts.noteIdx-1)),this.leftCrossMeasure},v.getNoteAtPitch=function(){if(null===this.noteAtPitch){var a=this.measureData.getVoice(this.opts.voiceIdx);this.noteAtPitch=o(a,this.opts.noteIdx,this.opts.fromPitch)}return this.noteAtPitch},v.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b=this.getRemoveAction(),c=d.copyWithoutAlter(b.opts.pitch),e=this.getAddAction(),f=d.copyWithoutAlter(e.opts.pitch),h={partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,timePos:a.timePos,divisions:a.dpq,accidental:this.opts.accidental,fromPitch:c,toPitch:f,checkLine:this.opts.checkLine};void 0!==this.opts.fretData&&(h.fretData=g(this.opts.fretData));var i={actionName:this.name,opts:h};this.cancelStack.storeAction(i)}},v.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.PitchRangeError,b=Adagio.Error.client.NotPossibleOnUnpitchedError,c=Adagio.Error.client.PitchCollisionError,d=Adagio.Error.client.PitchOverflowError,e=Adagio.Utils.noteUtils,f=Adagio.Utils.pitchUtils,g=Adagio.Utils.transposeUtils,h=Adagio.edit.action.AddAccidental,i=Adagio.edit.action.ChangePitch,j=Adagio.edit.common.getNoteAtPitch,k=Adagio.edit.common.initMeasureData,l=Adagio.edit.action.TransposeNoteHead=function(a,b,c){this.init(a,b,c)};l.NAME="action.TransposeNoteHead";var m=l.prototype;m.name=l.NAME,m.initMeasureData=k,m.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.sanitized=!1,this.noteHead=null,this.voice=null,this.action=null},m.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkNoteIdx(),this.checkNotRest(),f.check(this.opts.pitch),g.check(this.opts.transpose),this.sanitizeIfNeeded(),this.checkNoteAtPitch(),this.getAction().checkPreconditions()},m.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new b},m.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},m.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},m.checkNoteAtPitch=function(){if(void 0===this.getNoteAtPitch()){var a=f.copy(this.opts.pitch);throw new c(c.action.GET,a)}},m.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded();var a=this.getAction();a.cancelStack=this.cancelStack,a.perform()},m.sanitizeIfNeeded=function(){this.sanitized||(void 0===this.opts.checkLine&&(this.opts.checkLine=!0),this.sanitized=!0)},m.getNoteAtPitch=function(){if(null===this.noteHead){var a=this.getVoice();this.noteHead=j(a,this.opts.noteIdx,this.opts.pitch)}return this.noteHead},m.getAction=function(){if(null===this.action){var b,c=this.getNoteAtPitch(),j=e.getPitch(c),k=e.getStaffIdx(c);try{b=f.transpose(j,this.opts.transpose,!0)}catch(b){if(b instanceof a){var l=f.copy(j),m=g.copy(this.opts.transpose);throw new d(l,m)}throw b}var n=f.getAlter(b),o=f.alterToAccidental(n),p={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx},q=null;f.isSameLine(j,b)?(p.pitch=f.copyWithoutAlter(j),p.accidental=o,this.action=new h(this.measureData,p,q)):(p.fromPitch=f.copyWithoutAlter(j),p.toPitch=f.copyWithoutAlter(b),p.accidental=o,p.checkLine=this.opts.checkLine,p.staffIdx=k,this.action=new i(this.measureData,p,q))}return this.action},m.getVoice=function(){return null===this.voice&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice}}.call(this),function(){"use strict";var a=Adagio.Error.PitchRangeError,b=Adagio.Utils.pitchUtils;Adagio.edit.common.preparePitchesTransposeOrder=function(a,b){var e={};a.forEach(c,e);var f={error:[],valid:[]},h=d(a,b,f);return h=g(h,f),h=i(h,f,e),l(h,f),f.valid.concat(f.error)};var c=function(a){this[f(a)]=!0},d=function(a,b,c){var d=[],f={transpose:b,entries:c,wrappedPitches:d};return a.forEach(e,f),d},e=function(c){var d,e=this;try{d=b.transpose(c,e.transpose,!0)}catch(b){if(b instanceof a)return void e.entries.error.push(c);throw b}var g=f(c),h=f(d),i={fromPitch:c,fromKey:g,toPitch:d,toKey:h};e.wrappedPitches.push(i)},f=function(a){return a=b.copyWithoutAlter(a),b.stringify(a)},g=function(a,b){var c=[],d={entries:b,remaining:c};return a.forEach(h,d),c},h=function(a){var b=this;a.fromKey===a.toKey?b.entries.valid.push(a.fromPitch):b.remaining.push(a)},i=function(a,b,c){for(;;){var d=[];if(d=j(a,b,c),d.length===a.length)return d;a=d}},j=function(a,b,c){var d=[],e={entries:b,remaining:d,usedMap:c};return a.forEach(k,e),d},k=function(a){var b=this,c=b.usedMap;c[a.toKey]?b.remaining.push(a):(delete c[a.fromKey],c[a.toKey]=!0,b.entries.valid.push(a.fromPitch))},l=function(a,b){a.forEach(m,b)},m=function(a){this.error.push(a.fromPitch)}}.call(this),function(){"use strict";var a=Adagio.Error.client.NotPossibleOnUnpitchedError,b=Adagio.Error.client.PitchCollisionError,c=Adagio.Error.client.PitchOverflowError,d=Adagio.Error.client.LineOutOfRangeError,e=Adagio.Error.noChange.NoChangeError,f=Adagio.Utils.noteUtils,g=Adagio.Utils.pitchUtils,h=Adagio.Utils.typeUtils,i=Adagio.Utils.transposeUtils,j=Adagio.edit.action.TransposeNoteHead,k=Adagio.edit.common.convertTimePosToGetNoteIdx,l=Adagio.edit.common.convertPartUuidToGetPartIdx,m=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,n=Adagio.edit.common.assertPerform,o=Adagio.edit.common.preparePitchesTransposeOrder,p=Adagio.edit.common.initMeasureData,q=Adagio.edit.action.TransposeChord=function(a,b,c){this.init(a,b,c)};q.NAME="action.TransposeChord";var r=q.prototype;r.name=q.NAME,r.initMeasureData=p,r.init=function(a,b,c){l(a,b),m(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.sanitized=!1,this.voice=null,this.wrappedActions=null,this.location=null},r.checkPreconditions=function(){if(this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),k(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),i.check(this.opts.transpose),this.sanitizeIfNeeded(),i.isIdentity(this.opts.transpose))throw new e;var a=this.getWrappedActions();if(!a.some(s))throw a[0].error};var s=function(a){try{a.action.checkPreconditions()}catch(b){if(t(b))return a.checked=!0,a.error=b,!1;throw b}return a.checked=!0,!0};r.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new a},r.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},r.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},r.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),k(this.measureData,this.opts),this.sanitizeIfNeeded(),this.storeAction(),this.getWrappedActions().forEach(this.callPerform,this)},r.sanitizeIfNeeded=function(){this.sanitized||(void 0===this.opts.checkLine&&(this.opts.checkLine=!0),this.sanitized=!0)},r.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b=i.copy(this.opts.transpose),c={partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos,transpose:b,checkLine:this.opts.checkLine},d={actionName:this.name,opts:c};this.cancelStack.storeAction(d)}},r.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location},r.getWrappedActions=function(){return null===this.wrappedActions&&this.createWrappedActions(),this.wrappedActions},r.createWrappedActions=function(){var a=this.getVoice(),b=a.getChord(this.opts.noteIdx);b=h.makeArray(b);var c=b.map(f.getPitch);c=o(c,this.opts.transpose),this.wrappedActions=c.map(this.createWrappedAction,this)},r.createWrappedAction=function(a){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:g.copyWithoutAlter(a),transpose:i.copy(this.opts.transpose),checkLine:this.opts.checkLine};return{action:new j(this.measureData,b,null),error:null,checked:!1}},r.getVoice=function(){return null===this.voice&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},r.callPerform=function(a){null===a.error&&(a.action.cancelStack=this.cancelStack,a.checked?a.action.perform():n(a.action,t))};var t=function(a){return a instanceof b||a instanceof c||a instanceof d||a instanceof e}}.call(this),function(){"use strict";var a=Adagio.edit.action.AddGraceToChord,b=Adagio.edit.action.RemoveGraceFromChord,c=Adagio.Utils.pitchUtils,d=Adagio.edit.common.initMeasureData,e=Adagio.edit.common.convertPartUuidToGetPartIdx,f=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,g=Adagio.edit.common.convertTimePosToGetNoteIdx,h=Adagio.edit.action.ChangeGracePitch=function(a,b,c){this.init(a,b,c)};h.NAME="action.ChangeGracePitch",h.copyAddOpts=function(a){var b={partIdx:a.partIdx,measureIdx:a.measureIdx,voiceIdx:a.voiceIdx,staffIdx:a.staffIdx,noteIdx:a.noteIdx,graceIdx:a.graceIdx,accidental:a.accidental,isConcertPitch:a.isConcertPitch,checkLine:a.checkLine};return void 0!==a.toLine?b.line=a.toLine:void 0!==a.toPitch&&(b.pitch=c.copy(a.toPitch)),b},h.copyRemoveOpts=function(a){var b={partIdx:a.partIdx,measureIdx:a.measureIdx,voiceIdx:a.voiceIdx,noteIdx:a.noteIdx,graceIdx:a.graceIdx,isConcertPitch:a.isConcertPitch};return void 0!==a.fromLine?(b.line=a.fromLine,b.staffIdx=a.staffIdx):void 0!==a.fromPitch&&(b.pitch=c.copy(a.fromPitch)),b};var i=h.prototype;i.name=h.NAME,i.initMeasureData=d,i.init=function(a,b,c){e(a,b),f(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,g(this.measureData,this.opts),this.addAction=null,this.removeAction=null,this.location=null},i.checkPreconditions=function(){this.getAddAction().checkPreconditions(),this.getRemoveAction().checkPitchExist()},i.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.getActions().forEach(this.callPerform,this)},i.callPerform=function(a){a.cancelStack=this.cancelStack,a.perform()},i.getActions=function(){return[this.getAddAction(),this.getRemoveAction()]},i.getAddAction=function(){if(null===this.addAction){var b=h.copyAddOpts(this.opts);this.addAction=new a(this.measureData,b,this.cancelStack)}return this.addAction},i.getRemoveAction=function(){if(null===this.removeAction){var a=h.copyRemoveOpts(this.opts);this.removeAction=new b(this.measureData,a,this.cancelStack)}return this.removeAction},i.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b=this.getRemoveAction(),d=c.copyWithoutAlter(b.opts.pitch),e=this.getAddAction(),f=c.copyWithoutAlter(e.opts.pitch),g={partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,timePos:a.timePos,divisions:a.dpq,graceIdx:this.opts.graceIdx,accidental:this.opts.accidental,fromPitch:d,toPitch:f,checkLine:this.opts.checkLine},h={actionName:this.name,opts:g};this.cancelStack.storeAction(h)}},i.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.PitchRangeError,b=Adagio.Error.client.NotPossibleOnUnpitchedError,c=Adagio.Error.client.PitchCollisionError,d=Adagio.Error.client.PitchOverflowError,e=Adagio.Utils.noteUtils,f=Adagio.Utils.pitchUtils,g=Adagio.Utils.transposeUtils,h=Adagio.edit.action.AddGraceAccidental,i=Adagio.edit.action.ChangeGracePitch,j=Adagio.edit.common.getGraceAtPitch,k=Adagio.edit.common.initMeasureData,l=Adagio.edit.action.TransposeGraceHead=function(a,b,c){this.init(a,b,c)};l.NAME="action.TransposeGraceHead";var m=l.prototype;m.name=l.NAME,m.initMeasureData=k,m.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.sanitized=!1,this.noteHead=null,this.voice=null,this.action=null},m.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkNoteIdx(),this.checkNotRest(),this.checkGraceIdx(),f.check(this.opts.pitch),g.check(this.opts.transpose),this.sanitizeIfNeeded(),this.checkNoteAtPitch(),this.getAction().checkPreconditions()},m.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new b},m.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},m.checkGraceIdx=function(){this.getVoice().checkGraceIdx(this.opts.noteIdx,this.opts.graceIdx)},m.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},m.checkNoteAtPitch=function(){if(void 0===this.getGraceAtPitch()){var a=f.copy(this.opts.pitch);throw new c(c.action.GET,a)}},m.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded();var a=this.getAction();a.cancelStack=this.cancelStack,a.perform()},m.sanitizeIfNeeded=function(){this.sanitized||(void 0===this.opts.checkLine&&(this.opts.checkLine=!0),this.sanitized=!0)},m.getGraceAtPitch=function(){if(null===this.noteHead){var a=this.getVoice();this.noteHead=j(a,this.opts.noteIdx,this.opts.graceIdx,this.opts.pitch)}return this.noteHead},m.getAction=function(){if(null===this.action){var b,c=this.getGraceAtPitch(),j=e.getPitch(c),k=e.getStaffIdx(c);try{b=f.transpose(j,this.opts.transpose,!0)}catch(b){if(b instanceof a){var l=f.copy(j),m=g.copy(this.opts.transpose);throw new d(l,m)}throw b}var n=f.getAlter(b),o=f.alterToAccidental(n),p={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx},q=null;f.isSameLine(j,b)?(p.pitch=f.copyWithoutAlter(j),p.accidental=o,this.action=new h(this.measureData,p,q)):(p.fromPitch=f.copyWithoutAlter(j),p.toPitch=f.copyWithoutAlter(b),p.accidental=o,p.checkLine=this.opts.checkLine,p.staffIdx=k,this.action=new i(this.measureData,p,q))}return this.action},m.getVoice=function(){return null===this.voice&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice}}.call(this),function(){"use strict";var a=Adagio.Error.client.NotPossibleOnUnpitchedError,b=Adagio.Error.client.PitchCollisionError,c=Adagio.Error.client.PitchOverflowError,d=Adagio.Error.client.LineOutOfRangeError,e=Adagio.Error.noChange.NoChangeError,f=Adagio.Utils.noteUtils,g=Adagio.Utils.pitchUtils,h=Adagio.Utils.typeUtils,i=Adagio.Utils.transposeUtils,j=Adagio.edit.action.TransposeGraceHead,k=Adagio.edit.common.convertTimePosToGetNoteIdx,l=Adagio.edit.common.convertPartUuidToGetPartIdx,m=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,n=Adagio.edit.common.assertPerform,o=Adagio.edit.common.preparePitchesTransposeOrder,p=Adagio.edit.common.initMeasureData,q=Adagio.edit.action.TransposeGraceChord=function(a,b,c){this.init(a,b,c)};q.NAME="action.TransposeGraceChord";var r=q.prototype;r.name=q.NAME,r.initMeasureData=p,r.init=function(a,b,c){l(a,b),m(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.sanitized=!1,this.voice=null,this.wrappedActions=null,this.location=null},r.checkPreconditions=function(){if(this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),k(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),this.checkGraceIdx(),i.check(this.opts.transpose),this.sanitizeIfNeeded(),i.isIdentity(this.opts.transpose))throw new e;var a=this.getWrappedActions();if(!a.some(s))throw a[0].error};var s=function(a){try{a.action.checkPreconditions()}catch(b){if(t(b))return a.checked=!0,a.error=b,!1;throw b}return a.checked=!0,!0};r.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new a},r.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},r.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},r.checkGraceIdx=function(){this.getVoice().checkGraceIdx(this.opts.noteIdx,this.opts.graceIdx)},r.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),k(this.measureData,this.opts),this.sanitizeIfNeeded(),this.storeAction(),this.getWrappedActions().forEach(this.callPerform,this)},r.sanitizeIfNeeded=function(){this.sanitized||(void 0===this.opts.checkLine&&(this.opts.checkLine=!0),this.sanitized=!0)},r.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b=i.copy(this.opts.transpose),c={partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos,transpose:b,checkLine:this.opts.checkLine},d={actionName:this.name,opts:c};this.cancelStack.storeAction(d)}},r.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location},r.getWrappedActions=function(){return null===this.wrappedActions&&this.createWrappedActions(),this.wrappedActions},r.createWrappedActions=function(){var a=this.getVoice(),b=a.getGraceChord(this.opts.noteIdx,this.opts.graceIdx);b=h.makeArray(b);var c=b.map(f.getPitch);c=o(c,this.opts.transpose),this.wrappedActions=c.map(this.createWrappedAction,this)},r.createWrappedAction=function(a){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,pitch:g.copyWithoutAlter(a),transpose:i.copy(this.opts.transpose),checkLine:this.opts.checkLine};return{action:new j(this.measureData,b,null),error:null,checked:!1}},r.getVoice=function(){return null===this.voice&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},r.callPerform=function(a){null===a.error&&(a.action.cancelStack=this.cancelStack,a.checked?a.action.perform():n(a.action,t))};var t=function(a){return a instanceof b||a instanceof c||a instanceof d||a instanceof e}}.call(this),function(){"use strict";var a=Adagio.Error.client.NotPossibleOnUnpitchedError,b=Adagio.Error.client.PitchCollisionError,c=Adagio.Error.client.PitchOverflowError,d=Adagio.Error.client.LineOutOfRangeError,e=Adagio.Error.noChange.NoChangeError,f=Adagio.Utils.transposeUtils,g=Adagio.edit.action.TransposeGraceChord,h=Adagio.edit.common.convertTimePosToGetNoteIdx,i=Adagio.edit.common.convertPartUuidToGetPartIdx,j=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,k=Adagio.edit.common.assertPerform,l=Adagio.edit.common.initMeasureData,m=Adagio.edit.action.TransposeGraces=function(a,b,c){this.init(a,b,c)};m.NAME="action.TransposeGraces";var n=m.prototype;n.name=m.NAME,n.initMeasureData=l,n.init=function(a,b,c){i(a,b),j(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.sanitized=!1,this.voice=null,this.wrappedActions=null,this.location=null},n.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),h(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),f.check(this.opts.transpose),this.sanitizeIfNeeded();var a=this.getWrappedActions();if(0===a.length)throw new e;if(!a.some(o))throw a[0].error};var o=function(a){try{a.action.checkPreconditions()}catch(b){if(p(b))return a.checked=!0,a.error=b,!1;throw b}return a.checked=!0,!0};n.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new a},n.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},n.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},n.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),h(this.measureData,this.opts),this.sanitizeIfNeeded(),this.storeAction(),this.getWrappedActions().forEach(this.callPerform,this)},n.sanitizeIfNeeded=function(){this.sanitized||(void 0===this.opts.checkLine&&(this.opts.checkLine=!0),this.sanitized=!0)},n.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b=f.copy(this.opts.transpose),c={partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos,transpose:b,checkLine:this.opts.checkLine},d={actionName:this.name,opts:c};this.cancelStack.storeAction(d)}},n.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location},n.getWrappedActions=function(){if(null===this.wrappedActions){this.wrappedActions=[];for(var a=this.getVoice(),b=a.getNbGraces(this.opts.noteIdx),c=0;c<b;c++){var d=this.createWrappedAction(c);this.wrappedActions.push(d)}}return this.wrappedActions},n.createWrappedAction=function(a){var b=f.copy(this.opts.transpose),c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:a,checkLine:this.opts.checkLine,transpose:b,isConcertPitch:!1};return{action:new g(this.measureData,c,null),error:null,checked:!1}},n.getVoice=function(){return null===this.voice&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},n.callPerform=function(a){null===a.error&&(a.action.cancelStack=this.cancelStack,a.checked?a.action.perform():k(a.action,p))};var p=function(a){return a instanceof b||a instanceof c||a instanceof d||a instanceof e}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.edit.action.AddTieArc,c=Adagio.edit.common.getMeasuresScroller,d=Adagio.edit.common.assertPerform,e=Adagio.Utils.typeUtils,f=Adagio.Utils.noteUtils,g=Adagio.Utils.pitchUtils,h=Adagio.edit.composite.AddChordsTies=function(a,b,c){this.init(a,b,c)};h.NAME="composite.AddChordsTies";var i=h.prototype;i.name=h.NAME,i.init=function(a,b,d){this.measuresScroller=c(a,b),this.cancelStack=d,this.opts=b},i.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.addChordsTies()},i.addChordsTies=function(){this.opts.chordsTies.forEach(this.addChordTies,this)},i.addChordTies=function(b){var c=this.measuresScroller.getMeasureData(b.measureIdx),d=c.getVoice(b.voiceIdx),h=d.getChord(b.noteIdx);h=e.makeArray(h);var i=h.map(f.getPitch);if(i.sort(g.naiveComparePitch),i.length!==b.tiesList.length)throw new a("Unexpected","The number of notes between the dump and the actual data should be the same.");i=i.filter(j,b.tiesList),this.chordTiesData=b,i.forEach(this.addTieArc,this)};var j=function(a,b){return this[b]};i.addTieArc=function(a){var c={partIdx:this.opts.partIdx,measureIdx:this.chordTiesData.measureIdx,voiceIdx:this.chordTiesData.voiceIdx,noteIdx:this.chordTiesData.noteIdx,step:g.getStep(a),octave:g.getOctave(a)},e=this.measuresScroller.getMeasureData(c.measureIdx),f=new b(e,c,this.cancelStack);d(f,b.isAuthorizedException)}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils;Adagio.edit.common.noteIdxIntervalToTimePosInterval=function(b,c){var d={},e=b.getMeasureData(c.startMeasureIdx);d.startDpq=e.getDpqValue();var f=e.getVoice(c.startVoiceIdx);d.startTimePos=f.getRangeSpace(0,c.startNoteIdx);var g=b.getMeasureData(c.stopMeasureIdx);d.stopDpq=g.getDpqValue();var h=g.getVoice(c.stopVoiceIdx),i=h.getNote(c.stopNoteIdx),j=a.getDuration(i);return d.stopTimePos=h.getRangeSpace(0,c.stopNoteIdx)+j,d}}.call(this),function(){"use strict";var a=Adagio.Utils.typeUtils,b=Adagio.Utils.noteUtils,c=Adagio.Utils.pitchUtils;Adagio.edit.common.extractVoiceRangeTies=function(a,b){for(var c=[],f={ties:c,noteIdx:b.startNoteIdx,measureIdx:b.startMeasureIdx,voiceIdx:b.voiceIdx},g=b.stopNoteIdx,h=b.stopMeasureIdx;d(f,h,g);){var i=a.getMeasureData(f.measureIdx);if(i.hasVoice(b.voiceIdx)){var j=i.getVoice(b.voiceIdx);j.isRest(f.noteIdx)||e(i,f),f.noteIdx++,f.noteIdx===j.getNbNotes()&&(f.noteIdx=0,f.measureIdx++)}else f.noteIdx=0,f.measureIdx++}return c};var d=function(a,b,c){return a.measureIdx<b||a.measureIdx===b&&a.noteIdx<c},e=function(c,d){var e=c.getVoice(d.voiceIdx),i=e.getChord(d.noteIdx);if(i=a.makeArray(i),i.some(b.hasTieStart)){var j=i.map(f);j.sort(g);var k=j.map(h),l={measureIdx:d.measureIdx,noteIdx:d.noteIdx,voiceIdx:d.voiceIdx,tiesList:k};d.ties.push(l)}},f=function(a){return{pitch:b.getPitch(a),hasTie:b.hasTieStart(a)}},g=function(a,b){return c.naiveComparePitch(a.pitch,b.pitch)},h=function(a){return a.hasTie}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadMeasureIdxError,b=Adagio.Error.client.RevertRangeError,c=Adagio.Error.client.BadTimePosError,d=Adagio.Error.client.NotPossibleOnUnpitchedError,e=Adagio.Error.client.PitchCollisionError,f=Adagio.Error.client.LineOutOfRangeError,g=Adagio.Error.client.PitchOverflowError,h=Adagio.Error.client.BadVoiceError,i=Adagio.Error.noChange.NoChangeError,j=Adagio.edit.action.TransposeChord,k=Adagio.edit.action.TransposeGraces,l=Adagio.edit.composite.AddChordsTies,m=Adagio.edit.common.convertPartUuidToGetPartIdx,n=Adagio.edit.common.convertMeasuresUuidsToMeasuresIdxs,o=Adagio.edit.common.getMeasuresScroller,p=Adagio.edit.common.timePosIntervalToNoteIdxInterval,q=Adagio.edit.common.noteIdxIntervalToTimePosInterval,r=Adagio.edit.common.assertPerform,s=Adagio.edit.common.extractVoiceRangeTies,t=Adagio.Utils.math,u=Adagio.Utils.measureUtils,v=Adagio.Utils.transposeUtils,w=Adagio.edit.action.TransposeVoiceRange=function(a,b,c){this.init(a,b,c)};w.NAME="action.TransposeVoiceRange";var x=w.prototype;x.name=w.NAME,x.init=function(a,b,c){n(a,b),m(a,b),this.measuresScroller=o(a,b),this.cancelStack=c,this.opts=b,this.location=null,this.wrappedActions=null},x.checkPreconditions=function(){if(this.checkLocation(),v.check(this.opts.transpose),v.isIdentity(this.opts.transpose))throw new i;this.sanitize(),this.checkActions()},x.checkLocation=function(){this.checkPitchedPart(),this.checkMeasureIdx(this.opts.startMeasureIdx),this.checkMeasureIdx(this.opts.stopMeasureIdx);var a=this.opts.startMeasureIdx,c=this.opts.stopMeasureIdx,d=c-a;if(d<0)throw new b(b.MEASURE,a,c);this.checkVoiceIdx(),this.hasNoteIndexes()?(this.startMeasureIdx=a,this.stopMeasureIdx=c):(this.checkTimePos(d),this.convertTimePosToNoteIndexes()),this.checkNoteIndexes(d)},x.checkPitchedPart=function(){if(this.measuresScroller.getScoreData().isPartUnpitched(this.opts.partIdx))throw new d},x.checkMeasureIdx=function(b){var c=this.measuresScroller.getNbMeasures();if(!t.isInteger(b)||b<0||b>=c)throw new a(b,a.GET)},x.checkVoiceIdx=function(){if(!this.measuresScroller.getScoreData().hasPartVoiceIdx(this.opts.partIdx,this.opts.voiceIdx))throw new h(this.opts.voiceIdx)},x.checkNoteIndexes=function(a){if(0===a&&this.opts.startNoteIdx>this.opts.stopNoteIdx)throw new b(b.NOTE,this.opts.startNoteIdx,this.opts.stopNoteIdx);var c=this.measuresScroller.getMeasureData(this.startMeasureIdx);c.checkVoiceIdx(this.opts.voiceIdx),c.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.startNoteIdx);var d=this.measuresScroller.getMeasureData(this.stopMeasureIdx);d.checkVoiceIdx(this.opts.voiceIdx),d.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.stopNoteIdx)},x.hasNoteIndexes=function(){return void 0!==this.opts.startNoteIdx||void 0!==this.opts.stopNoteIdx},x.checkTimePos=function(a){var c=this.measuresScroller.getMeasureData(this.opts.startMeasureIdx);this.checkStartTimePos(c,this.opts.startDpq,this.opts.startTimePos);var d=this.measuresScroller.getMeasureData(this.opts.stopMeasureIdx);if(this.checkStopTimePos(d,this.opts.stopDpq,this.opts.stopTimePos),0===a&&this.opts.startTimePos>this.opts.stopTimePos)throw new b(b.NOTE,this.opts.startTimePos,this.opts.stopTimePos)},x.checkStartTimePos=function(a,b,d){var e=a.getDpqValue(),f=a.getMeasure(),g=u.getNbDivisions(f),h=t.lcm(e,b);if(g*=h/e,d*=h/b,!t.isInteger(d)||d<0||d>=g)throw new c(d,h)},x.checkStopTimePos=function(a,b,d){var e=a.getDpqValue(),f=a.getMeasure(),g=u.getNbDivisions(f),h=t.lcm(e,b);if(g*=h/e,d*=h/b,!t.isInteger(d)||d<0||d>g)throw new c(d,h)},x.convertTimePosToNoteIndexes=function(){var a={startMeasureIdx:this.opts.startMeasureIdx,startTimePos:this.opts.startTimePos,startDpq:this.opts.startDpq,stopMeasureIdx:this.opts.stopMeasureIdx,stopTimePos:this.opts.stopTimePos,stopDpq:this.opts.stopDpq};if(null===(a=p(this.measuresScroller,a,this.opts.voiceIdx)))throw new i;this.startMeasureIdx=a.startMeasureIdx,this.opts.startNoteIdx=a.startNoteIdx,this.stopMeasureIdx=a.stopMeasureIdx,this.opts.stopNoteIdx=a.stopNoteIdx},x.sanitize=function(){void 0===this.opts.checkLine&&(this.opts.checkLine=!0)},x.checkActions=function(){var a=this.getWrappedActions();if(0===a.length)throw new i;if(!a.some(y))throw a[0].error};var y=function(a){try{a.action.checkPreconditions()}catch(b){if(A(b))return a.checked=!0,a.error=b,!1;throw b}return a.checked=!0,!0};x.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.opts.preserveTies&&this.recordTies(),this.getWrappedActions().forEach(this.callPerform,this),this.opts.preserveTies&&this.restoreTies()},x.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b=a.measureUuids.slice();this.hasTimePos()||this.convertNoteIndexesToTimePos();var c=v.copy(this.opts.transpose),d={actionName:this.name,opts:{partUuid:a.partUuid,measureUuids:b,voiceIdx:this.opts.voiceIdx,startDpq:this.opts.startDpq,startTimePos:this.opts.startTimePos,stopDpq:this.opts.stopDpq,stopTimePos:this.opts.stopTimePos,checkLine:this.opts.checkLine,preserveTies:!!this.opts.preserveTies,updateGraces:!!this.opts.updateGraces,transpose:c}}
;this.cancelStack.storeAction(d)}},x.getLocation=function(){if(null===this.location){var a=this.measuresScroller.getScoreData(),b=a.getMeasureUuids(this.opts.startMeasureIdx,this.opts.stopMeasureIdx),c=a.getPartUuid(this.opts.partIdx);this.location={partUuid:c,measureUuids:b}}return this.location},x.hasTimePos=function(){return void 0!==this.opts.startTimePos||void 0!==this.opts.startDpq||void 0!==this.opts.stopTimePos||void 0!==this.opts.stopDpq},x.convertNoteIndexesToTimePos=function(){var a={startMeasureIdx:this.opts.startMeasureIdx,startNoteIdx:this.opts.startNoteIdx,startVoiceIdx:this.opts.voiceIdx,stopMeasureIdx:this.opts.stopMeasureIdx,stopNoteIdx:this.opts.stopNoteIdx,stopVoiceIdx:this.opts.voiceIdx};a=q(this.measuresScroller,a),this.opts.startTimePos=a.startTimePos,this.opts.startDpq=a.startDpq,this.opts.stopTimePos=a.stopTimePos,this.opts.stopDpq=a.stopDpq},x.recordTies=function(){var a={voiceIdx:this.opts.voiceIdx,startMeasureIdx:this.opts.startMeasureIdx,startNoteIdx:this.opts.startNoteIdx,stopMeasureIdx:this.opts.stopMeasureIdx,stopNoteIdx:this.opts.stopNoteIdx};this.chordsTies=s(this.measuresScroller,a)},x.getWrappedActions=function(){return null===this.wrappedActions&&this.createWrappedActions(),this.wrappedActions},x.createWrappedActions=function(){this.wrappedActions=[];for(var a=this.opts.startNoteIdx,b=this.startMeasureIdx,c=this.opts.stopNoteIdx,d=this.stopMeasureIdx;z(b,d,a,c);){var e=this.measuresScroller.getMeasureData(b);if(e.hasVoice(this.opts.voiceIdx)){var f=e.getVoice(this.opts.voiceIdx);f.isRest(a)||this.createWrappedAction(e,b,a),a++,a===f.getNbNotes()&&(a=0,b++)}else a=0,b++}};var z=function(a,b,c,d){return a<b||a===b&&c<=d};x.createWrappedAction=function(a,b,c){var d=v.copy(this.opts.transpose),e={partIdx:this.opts.partIdx,measureIdx:b,voiceIdx:this.opts.voiceIdx,noteIdx:c,transpose:d,checkLine:this.opts.checkLine},f=null,g=new j(a,e,f),h={action:g,error:null,checked:!1};this.wrappedActions.push(h),this.opts.updateGraces&&this.createGracesAction(a,b,c)},x.createGracesAction=function(a,b,c){var d=v.copy(this.opts.transpose),e={partIdx:this.opts.partIdx,measureIdx:b,voiceIdx:this.opts.voiceIdx,noteIdx:c,transpose:d,checkLine:this.opts.checkLine},f=null,g=new k(a,e,f),h={action:g,error:null,checked:!1};this.wrappedActions.push(h)},x.callPerform=function(a){null===a.error&&(a.action.cancelStack=this.cancelStack,a.checked?a.action.perform():r(a.action,A))};var A=function(a){return a instanceof e||a instanceof g||a instanceof f||a instanceof i};x.restoreTies=function(){var a={partIdx:this.opts.partIdx,chordsTies:this.chordsTies};new l(this.measuresScroller,a,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.noChange.NoChangeError,b=Adagio.Error.client.TimePosOutOfRangeError,c=Adagio.Error.client.BadTimePosError,d=Adagio.Utils.math,e=Adagio.Utils.measureUtils,f=Adagio.Utils.harmonyUtils,g=Adagio.Utils.transposeUtils,h=Adagio.edit.action.AddHarmonyAtTimePos,i=Adagio.edit.common.convertPartUuidToGetPartIdx,j=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,k=Adagio.edit.common.initMeasureData,l=Adagio.edit.action.TransposeHarmony=function(a,b,c){this.init(a,b,c)};l.NAME="action.TransposeHarmony";var m=l.prototype;m.name=l.NAME,m.initMeasureData=k,m.init=function(a,b,c){i(a,b),j(a,b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.localTimePos=null,this.harmonyIdx=null,this.action=null,this.location=null},m.checkPreconditions=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx),this.checkTimePos(),this.checkHarmony(),this.checkTranspose(),this.getAction().checkPreconditions()},m.checkTimePos=function(){var a=this.getLocalTimePos(),c=this.getMeasure(),f=e.getNbDivisions(c);if(!d.isNumber(a)||a<0||a>=f){var g=e.getDpq(c);throw new b(a,g)}},m.checkHarmony=function(){this.fetchHarmonyIdx()},m.checkTranspose=function(){if(g.check(this.opts.transpose),g.isUnison(this.opts.transpose))throw new a},m.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a=this.getAction();a.cancelStack=this.cancelStack,a.perform()},m.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b=g.copy(this.opts.transpose),c={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,dpq:this.opts.dpq,timePos:this.opts.timePos,transpose:b}};this.cancelStack.storeAction(c)}},m.getLocation=function(){if(null===this.location){var a=this.scoreData.getPartUuid(this.opts.partIdx),b=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={partUuid:a,measureUuid:b}}return this.location},m.getAction=function(){if(null===this.action){var a=this.getCurrentHarmony();a=f.transpose(a,this.opts.transpose);var b=null;f.hasBass(a)&&(b=f.getBass(a));var c=f.getRoot(a),d=f.getKindValue(a),e=f.getDegrees(a),g={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:this.opts.timePos,dpq:this.opts.dpq,root:c,kind:d,bass:b,degrees:e};this.action=new h(this.scoreData,g,null)}return this.action},m.getCurrentHarmony=function(){var a=this.getMeasure();return e.getHarmonies(a)[this.getHarmonyIdx()]},m.getHarmonyIdx=function(){return null!==this.harmonyIdx&&this.fetchHarmonyIdx(),this.harmonyIdx},m.fetchHarmonyIdx=function(){var a=this.getMeasure();if(e.getHarmonies(a).some(this.checkHarmonyTimePos,this),null===this.harmonyIdx){var b=this.getLocalTimePos(),d=e.getDpq(a);throw new c(b,d)}},m.checkHarmonyTimePos=function(a,b){var c=this.getLocalTimePos(),d=f.getTimePos(a);return!(d<c)&&(d===c&&(this.harmonyIdx=b),!0)},m.getLocalTimePos=function(){if(null===this.localTimePos){var a=this.getMeasure(),b=e.getDpq(a),c=this.opts.dpq;this.localTimePos=this.opts.timePos*b/c}return this.localTimePos},m.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)}}.call(this),function(){"use strict";var a=Adagio.Error.client.RevertRangeError,b=Adagio.Error.client.BadTimePosError,c=Adagio.Error.noChange.NoChangeError,d=Adagio.edit.action.TransposeHarmony,e=Adagio.edit.common.convertPartUuidToGetPartIdx,f=Adagio.edit.common.convertMeasuresUuidsToMeasuresIdxs,g=Adagio.edit.common.getMeasuresScroller,h=Adagio.edit.common.assertPerform,i=Adagio.Utils.math,j=Adagio.Utils.noteUtils,k=Adagio.Utils.measureUtils,l=Adagio.Utils.transposeUtils,m=Adagio.Utils.harmonyUtils,n=Adagio.edit.action.TransposeHarmoniesRange=function(a,b,c){this.init(a,b,c)};n.NAME="action.TransposeHarmoniesRange";var o=n.prototype;o.name=n.NAME,o.init=function(a,b,c){f(a,b),e(a,b),this.scoreData=a,this.measuresScroller=null,this.cancelStack=c,this.opts=b,this.location=null,this.wrappedActions=null},o.checkPreconditions=function(){if(l.check(this.opts.transpose),l.isIdentity(this.opts.transpose))throw new c;this.checkLocation(),this.checkActions()},o.checkLocation=function(){this.scoreData.checkMeasureIdx(this.opts.startMeasureIdx),this.scoreData.checkMeasureIdx(this.opts.stopMeasureIdx);var b=this.opts.startMeasureIdx,c=this.opts.stopMeasureIdx,d=c-b;if(d<0)throw new a(a.MEASURE,b,c);this.hasNoteIndexes()&&(this.checkNoteIndexes(d),this.convertNoteIndexes()),this.checkTimePos(d)},o.hasNoteIndexes=function(){return void 0!==this.opts.startNoteIdx||void 0!==this.opts.startVoiceIdx||void 0!==this.opts.stopNoteIdx||void 0!==this.opts.stopVoiceIdx},o.checkNoteIndexes=function(){var a=this.getMeasuresScroller(),b=a.getMeasureData(this.opts.startMeasureIdx);b.checkVoiceIdx(this.opts.startVoiceIdx),b.getVoice(this.opts.startVoiceIdx).checkNoteIdx(this.opts.startNoteIdx);var c=a.getMeasureData(this.opts.stopMeasureIdx);c.checkVoiceIdx(this.opts.stopVoiceIdx),c.getVoice(this.opts.stopVoiceIdx).checkNoteIdx(this.opts.stopNoteIdx)},o.convertNoteIndexes=function(){var a=this.getMeasuresScroller(),b=a.getMeasureData(this.opts.startMeasureIdx);this.opts.startDpq=b.getDpqValue();var c=b.getVoice(this.opts.startVoiceIdx);this.opts.startTimePos=c.getRangeSpace(0,this.opts.startNoteIdx);var d=a.getMeasureData(this.opts.stopMeasureIdx);this.opts.stopDpq=d.getDpqValue();var e=d.getVoice(this.opts.stopVoiceIdx),f=e.getNote(this.opts.stopNoteIdx),g=j.getDuration(f);this.opts.stopTimePos=e.getRangeSpace(0,this.opts.stopNoteIdx)+g,delete this.opts.startVoiceIdx,delete this.opts.startNoteIdx,delete this.opts.stopVoiceIdx,delete this.opts.stopNoteIdx},o.getMeasuresScroller=function(){return null===this.measuresScroller&&(this.measuresScroller=g(this.scoreData,this.opts)),this.measuresScroller},o.checkTimePos=function(b){var c=this.scoreData.getMeasure(this.opts.partIdx,this.opts.startMeasureIdx);this.checkStartTimePos(c,this.opts.startDpq,this.opts.startTimePos);var d=this.scoreData.getMeasure(this.opts.partIdx,this.opts.stopMeasureIdx);if(this.checkStopTimePos(d,this.opts.stopDpq,this.opts.stopTimePos),0===b&&this.opts.startTimePos>this.opts.stopTimePos)throw new a(a.TIME_POS,this.opts.startTimePos,this.opts.stopTimePos)},o.checkStartTimePos=function(a,c,d){var e=k.getDpq(a),f=k.getNbDivisions(a),g=i.lcm(e,c);if(f*=g/e,d*=g/c,!i.isInteger(d)||d<0||d>=f)throw new b(d,g)},o.checkStopTimePos=function(a,c,d){var e=k.getDpq(a),f=k.getNbDivisions(a),g=i.lcm(e,c);if(f*=g/e,d*=g/c,!i.isInteger(d)||d<0||d>f)throw new b(d,g)},o.checkActions=function(){var a=this.getWrappedActions();if(0===a.length)throw new c;if(!a.some(p))throw a[0].error};var p=function(a){try{a.action.checkPreconditions()}catch(b){if(q(b))return a.checked=!0,a.error=b,!1;throw b}return a.checked=!0,!0};o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.getWrappedActions().forEach(this.callPerform,this)},o.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b=a.measureUuids.slice(),c=l.copy(this.opts.transpose),d={actionName:this.name,opts:{partUuid:a.partUuid,measureUuids:b,startDpq:this.opts.startDpq,startTimePos:this.opts.startTimePos,stopDpq:this.opts.stopDpq,stopTimePos:this.opts.stopTimePos,transpose:c}};this.cancelStack.storeAction(d)}},o.getLocation=function(){if(null===this.location){var a=this.scoreData.getMeasureUuids(this.opts.startMeasureIdx,this.opts.stopMeasureIdx),b=this.scoreData.getPartUuid(this.opts.partIdx);this.location={partUuid:b,measureUuids:a}}return this.location},o.getWrappedActions=function(){return null===this.wrappedActions&&this.createWrappedActions(),this.wrappedActions},o.createWrappedActions=function(){this.wrappedActions=[];for(var a=this.opts.startMeasureIdx,b=this.opts.stopMeasureIdx;a<=b;a++){var c=this.scoreData.getMeasure(this.opts.partIdx,a),d=k.getHarmonies(c);this.measureIdx=a,d=d.filter(this.isHarmonyWithinBounds,this),d.forEach(this.createWrappedAction,this)}},o.isHarmonyWithinBounds=function(a){var b=m.getTimePos(a);if(this.measureIdx===this.opts.startMeasureIdx){var c=this.scoreData.getMeasure(this.opts.partIdx,this.measureIdx),d=k.getDpq(c);if(b<this.opts.startTimePos*d/this.opts.startDpq)return!1}if(this.measureIdx===this.opts.stopMeasureIdx){var e=this.scoreData.getMeasure(this.opts.partIdx,this.measureIdx),f=k.getDpq(e);if(b>=this.opts.stopTimePos*f/this.opts.stopDpq)return!1}return!0},o.createWrappedAction=function(a){var b=this.scoreData.getMeasure(this.opts.partIdx,this.measureIdx),c=k.getDpq(b),e=m.getTimePos(a),f=l.copy(this.opts.transpose),g={partIdx:this.opts.partIdx,measureIdx:this.measureIdx,timePos:e,dpq:c,transpose:f},h=null,i=new d(this.scoreData,g,h),j={action:i,error:null,checked:!1};this.wrappedActions.push(j)},o.callPerform=function(a){null===a.error&&(a.action.cancelStack=this.cancelStack,a.checked?a.action.perform():h(a.action,q))};var q=function(){return!1}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.keyUtils,c=Adagio.edit.primitive.AddOwnKey=function(a,b,c){this.init(a,b,c)};c.NAME="primitive.AddOwnKey";var d=c.prototype;d.name=c.NAME,d.init=function(a,b,c){this.fullData=a,this.cancelStack=c,this.opts=b},d.perform=function(){var c=this.getMeasure(),d=a.getWrappedOwnKey(c),f=this.opts.staffIdx,g=e(d.getEntry(f)),h=b.copy(this.opts.key);d.setEntry(h,f);var i=d.dumpAttribute();a.setOwnKey(c,i),this.updateStack(g)};var e=function(a){return null===a?null:b.copy(a)};d.getMeasure=function(){return this.fullData.getPartContent(this.opts.partIdx).measure[this.opts.measureIdx]},d.updateStack=function(a){var c={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,previousKey:a,newKey:b.copy(this.opts.key)}};this.cancelStack.push(c)}}.call(this),function(){"use strict";var a=Adagio.edit.primitive.AddOwnKey,b=Adagio.Utils.measureUtils,c=Adagio.Utils.keyUtils,d=Adagio.edit.composite.AddOwnKeyIfNeeded=function(a,b,c){this.init(a,b,c)};d.NAME="composite.AddOwnKeyIfNeeded";var e=d.prototype;e.name=d.NAME,e.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.measure=null},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.shouldAddOwnKey()&&this.addOwnKey()},e.shouldAddOwnKey=function(){return!this.hasOwnKey()||this.hasDifferentOwnKey()},e.hasOwnKey=function(){var a=this.getMeasure();return b.getWrappedOwnKey(a).hasEntry(this.opts.staffIdx)},e.hasDifferentOwnKey=function(){var a=this.getKey(),b=this.getOwnKey();return!c.isSame(b,a)},e.getOwnKey=function(){var a=this.getMeasure();return b.getWrappedOwnKey(a).getEntry(this.opts.staffIdx)},e.addOwnKey=function(){var b=this.getKey(),d={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,key:c.copy(b)};new a(this.scoreData,d,this.cancelStack).perform()},e.getKey=function(){var a=this.getMeasure();return b.getWrappedKey(a).getEntry(this.opts.staffIdx)},e.getMeasure=function(){return null===this.measure&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.keyUtils,c=Adagio.edit.primitive.RemoveOwnKey=function(a,b,c){this.init(a,b,c)};c.NAME="primitive.RemoveOwnKey";var d=c.prototype;d.name=c.NAME,d.init=function(a,b,c){this.fullData=a,this.cancelStack=c,this.opts=b},d.perform=function(){var c=this.getMeasure(),d=a.getWrappedOwnKey(c),e=this.opts.staffIdx,f=b.copy(d.getEntry(e));d.setEntry(null,e);var g=d.dumpAttribute();a.setOwnKey(c,g),this.updateStack(f)},d.getMeasure=function(){return this.fullData.getPartContent(this.opts.partIdx).measure[this.opts.measureIdx]},d.updateStack=function(a){var b={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,removedKey:a}};this.cancelStack.push(b)}}.call(this),function(){"use strict";var a=Adagio.edit.primitive.RemoveOwnKey,b=Adagio.Utils.measureUtils,c=Adagio.edit.composite.RemoveOwnKeyIfNeeded=function(a,b,c){this.init(a,b,c)};c.NAME="composite.RemoveOwnKeyIfNeeded";var d=c.prototype;d.name=c.NAME,d.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.measure=null},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.hasOwnKey()&&this.removeOwnKey()},d.hasOwnKey=function(){var a=this.getMeasure();return b.getWrappedOwnKey(a).hasEntry(this.opts.staffIdx)},d.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},d.removeOwnKey=function(){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx};new a(this.scoreData,b,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.edit.composite.AddOwnKeyIfNeeded,b=Adagio.edit.composite.RemoveOwnKeyIfNeeded,c=Adagio.edit.primitive.AddOwnKey,d=Adagio.Utils.measureUtils,e=Adagio.Utils.keyUtils,f=0,g=Adagio.edit.composite.UpdateNextOwnKey=function(a,b,c){this.init(a,b,c)};g.NAME="composite.UpdateNextOwnKey";var h=g.prototype;h.name=g.NAME,h.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.measures=null},h.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.hasNextMeasure()&&this.updateNextKey()},h.hasNextMeasure=function(){var a=this.getNbMeasures();return this.opts.measureIdx<a-1},h.getNbMeasures=function(){return this.getMeasures().length},h.updateNextKey=function(){this.isNextMeasureKeySame()?this.removeNextOwnKey():this.isNextKeyC()?this.refreshNextCIfNeeded():this.addNextOwnKey()},h.isNextMeasureKeySame=function(){var a=this.getCurrentMeasureKey(),b=this.getNextMeasureKey();return e.isSame(a,b)},h.removeNextOwnKey=function(){var a=this.deriveOpts();new b(this.scoreData,a,this.cancelStack).perform()},h.isNextKeyC=function(){var a=this.getNextMeasureKey();return e.getFifths(a)===f},h.getNextMeasureKey=function(){return this.getMeasureKey(this.opts.measureIdx+1)},h.refreshNextCIfNeeded=function(){this.hasCurrentKeyChanged()?this.forceAddNextOwnKey():this.addNextOwnKey()},h.hasCurrentKeyChanged=function(){var a=this.getCurrentMeasureKey();return!e.isSame(a,this.opts.savedKey)},h.getCurrentMeasureKey=function(){return this.getMeasureKey(this.opts.measureIdx)},h.getMeasureKey=function(a){var b=this.getMeasure(a);return d.getWrappedKey(b).getEntry(this.opts.staffIdx)},h.getMeasure=function(a){return this.getMeasures()[a]},h.getMeasures=function(){if(null===this.measures){var a=this.scoreData.getPartContent(this.opts.partIdx);this.measures=a.measure}return this.measures},h.forceAddNextOwnKey=function(){var a=this.deriveOpts(),b=this.getNextMeasureKey();a.key=e.copy(b),new c(this.scoreData,a,this.cancelStack).perform()},h.addNextOwnKey=function(){var b=this.deriveOpts();new a(this.scoreData,b,this.cancelStack).perform()},h.deriveOpts=function(){return{partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,measureIdx:this.opts.measureIdx+1}}}.call(this),function(){"use strict";var a=Adagio.edit.composite.AddOwnKeyIfNeeded,b=Adagio.edit.composite.RemoveOwnKeyIfNeeded,c=Adagio.Utils.measureUtils,d=Adagio.Utils.clone,e=Adagio.Utils.keyUtils,f=Adagio.edit.composite.UpdateOwnKey=function(a,b,c){this.init(a,b,c)};f.NAME="composite.UpdateOwnKey";var g=f.prototype;g.name=f.NAME,g.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.measures=null},g.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.shouldHaveOwnKey()?this.addOwnKey():this.removeOwnKey()},g.shouldHaveOwnKey=function(){return!this.hasPreviousMeasure()||this.isPreviousMeasureKeyDifferent()},g.hasPreviousMeasure=function(){return this.opts.measureIdx>0},g.isPreviousMeasureKeyDifferent=function(){var a=this.getCurrentMeasureKey(),b=this.getPreviousMeasureKey();return!e.isSame(b,a)},g.getCurrentMeasureKey=function(){return this.getMeasureKey(this.opts.measureIdx)},g.getPreviousMeasureKey=function(){return this.getMeasureKey(this.opts.measureIdx-1)},g.getMeasureKey=function(a){var b=this.getMeasure(a);return c.getWrappedKey(b).getEntry(this.opts.staffIdx)},g.getMeasure=function(a){return this.getMeasures(a)[a]},g.getMeasures=function(){if(null===this.measures){var a=this.scoreData.getPartContent(this.opts.partIdx);this.measures=a.measure}return this.measures},g.addOwnKey=function(){var b=d(this.opts);new a(this.scoreData,b,this.cancelStack).perform()},g.removeOwnKey=function(){var a=d(this.opts);new b(this.scoreData,a,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.edit.composite.UpdateOwnKey,b=Adagio.edit.composite.UpdateInternalOwnKeyRange=function(a,b,c){this.init(a,b,c)};b.NAME="composite.UpdateInternalOwnKeyRange";var c=b.prototype;c.name=b.NAME,c.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},c.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);for(var a=this.opts.firstMeasureIdx,b=this.opts.lastMeasureIdx,c=a;c<=b;c++)this.updateMeasureOwnKey(c)},c.updateMeasureOwnKey=function(b){var c={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,measureIdx:b};new a(this.scoreData,c,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.edit.composite.UpdateNextOwnKey,b=Adagio.edit.composite.UpdateInternalOwnKeyRange,c=Adagio.Utils.clone,d=Adagio.Utils.keyUtils,e=Adagio.edit.composite.UpdateOwnKeyRange=function(a,b,c){this.init(a,b,c)};e.NAME="composite.UpdateOwnKeyRange";var f=e.prototype;f.name=e.NAME,f.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},f.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.updateInternalOwnKeyRange(),this.updateNextOwnKey()},f.updateInternalOwnKeyRange=function(){var a=c(this.opts);new b(this.scoreData,a,this.cancelStack).perform()},f.updateNextOwnKey=function(){var b={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,measureIdx:this.opts.lastMeasureIdx,savedKey:d.copy(this.opts.savedKey)};new a(this.scoreData,b,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.keyUtils,c=Adagio.edit.primitive.SetKey=function(a,b,c){this.init(a,b,c)};c.NAME="primitive.SetKey";var d=c.prototype;d.name=c.NAME,d.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a=this.setKey();this.updateStack(a)},d.setKey=function(){var c=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx),d=a.getWrappedKey(c),e=this.opts.staffIdx,f=b.copy(d.getEntry(e)),g=b.copy(this.opts.key);d.setEntry(g,e);var h=d.dumpAttribute();return a.setKey(c,h),f},d.updateStack=function(a){var c={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,previousKey:a,newKey:b.copy(this.opts.key)}};this.cancelStack.push(c)}}.call(this),function(){"use strict";var a=Adagio.edit.primitive.UpdateAccidentals,b=Adagio.edit.primitive.SetKey,c=Adagio.edit.common.createScrollableMeasureData,d=Adagio.Utils.keyUtils,e=Adagio.edit.composite.SetKey=function(a,b,c){this.init(a,b,c)};e.NAME="composite.SetKey";var f=e.prototype;f.name=e.NAME,f.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.measureData=null},f.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.setKey(),this.updateVoicesAccidentals()},f.setKey=function(){var a=d.copy(this.opts.key),c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,key:a};new b(this.scoreData,c,this.cancelStack).perform()},f.updateVoicesAccidentals=function(){this.getMeasureData().forEachVoice(this.updateVoiceAccidentals,this)},f.updateVoiceAccidentals=function(b,c){var d=this.getMeasureData(),e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:c};new a(d,e,this.cancelStack).perform()},f.getMeasureData=function(){return null===this.measureData&&(this.measureData=c(this.scoreData,this.opts.partIdx,this.opts.measureIdx)),this.measureData}}.call(this),function(){"use strict";var a=Adagio.Utils.keyUtils,b=Adagio.edit.composite.SetKey,c=Adagio.edit.composite.SetMeasuresRangeKey=function(a,b,c){this.init(a,b,c)};c.NAME="composite.SetMeasuresRangeKey";var d=c.prototype;d.name=c.NAME,d.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);for(var a=this.opts.startMeasureIdx;a<=this.opts.stopMeasureIdx;a++)this.setMeasureKey(a)},d.setMeasureKey=function(c){var d=a.copy(this.opts.key),e={partIdx:this.opts.partIdx,measureIdx:c,staffIdx:this.opts.staffIdx,key:d};new b(this.scoreData,e,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Utils.keyUtils,b=Adagio.Utils.measureUtils,c=Adagio.edit.composite.UpdateOwnKeyRange,d=Adagio.edit.composite.SetMeasuresRangeKey,e=Adagio.edit.composite.SetKeySegment=function(a,b,c){this.init(a,b,c)};e.NAME="composite.SetKeySegment";var f=e.prototype;f.name=e.NAME,f.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},f.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a=this.getKey();this.setKey(),this.updateOwnKey(a)},f.getKey=function(){var c=this.scoreData.getMeasure(this.opts.partIdx,this.opts.startMeasureIdx),d=b.getWrappedKey(c),e=this.opts.staffIdx;return a.copy(d.getEntry(e))},f.setKey=function(){var b=a.copy(this.opts.key),c={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,key:b};new d(this.scoreData,c,this.cancelStack).perform()},f.updateOwnKey=function(a){var b={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,firstMeasureIdx:this.opts.startMeasureIdx,lastMeasureIdx:this.opts.stopMeasureIdx,savedKey:a};new c(this.scoreData,b,this.cancelStack).perform()}}.call(this),function(){"use strict";Adagio.edit.common.convertMeasuresFirstLast=function(a,b){void 0!==b.firstMeasureIdx&&(b.startMeasureIdx=b.firstMeasureIdx,delete b.firstMeasureIdx),void 0!==b.lastMeasureIdx&&(b.stopMeasureIdx=b.lastMeasureIdx,delete b.lastMeasureIdx)}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadMeasureIdxError,b=Adagio.Error.noChange.SameAttrError,c=Adagio.Error.client.RevertRangeError,d=Adagio.Error.client.InconsistentAttributesError,e=Adagio.Error.client.NotPossibleOnUnpitchedError,f=Adagio.Error.client.BadVoiceError,g=Adagio.Utils.measureUtils,h=Adagio.Utils.keyUtils,i=Adagio.Utils.math,j=Adagio.edit.composite.SetKeySegment,k=Adagio.edit.common.convertPartUuidToGetPartIdx,l=Adagio.edit.common.convertMeasuresUuidsToMeasuresIdxs,m=Adagio.edit.common.convertMeasuresFirstLast,n=Adagio.edit.action.SetKeySegment=function(a,b,c){this.init(a,b,c)};n.NAME="action.SetKeySegment";var o=n.prototype;o.name=n.NAME,o.init=function(a,b,c){l(a,b),k(a,b),m(a,b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.location=null,this.firstKey=null},o.checkPreconditions=function(){h.check(this.opts.key),this.checkPitchedPart(),this.checkLocation(),this.checkDifferentKey(),this.checkCurrentConsistent()},o.checkPitchedPart=function(){if(this.scoreData.isPartUnpitched(this.opts.partIdx))throw new e},o.checkLocation=function(){this.checkMeasureIdx(this.opts.startMeasureIdx),this.checkMeasureIdx(this.opts.stopMeasureIdx);var a=this.opts.startMeasureIdx,b=this.opts.stopMeasureIdx;if(b-a<0)throw new c(c.MEASURE,a,b);var d=this.getFirstMeasure(),e=g.getNbStaves(d),h=this.opts.staffIdx;if(!i.isInteger(h)||h<0||h>=e)throw new f(h,f.GET)},o.checkMeasureIdx=function(b){var c=this.scoreData.getNbMeasures();if(!i.isInteger(b)||b<0||b>=c)throw new a(b,a.GET)},o.checkDifferentKey=function(){var a=this.getFirstKey(),c=this.opts.key;if(h.isSame(c,a))throw new b(b.KEY,h.copy(a),h.copy(c))},o.checkCurrentConsistent=function(){for(var a=this.getFirstKey(),b=this.opts.startMeasureIdx+1;b<=this.opts.stopMeasureIdx;b++){var c=this.getKey(b);if(!h.isSame(c,a))throw new d(d.KEY)}},o.getFirstKey=function(){return null===this.firstKey&&(this.firstKey=this.getKey(this.opts.startMeasureIdx)),this.firstKey},o.getKey=function(a){var b=this.scoreData.getMeasure(this.opts.partIdx,a);return g.getWrappedKey(b).getEntry(this.opts.staffIdx)},o.getFirstMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.startMeasureIdx)},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a=this.getFirstKey();a=h.copy(a),this.setKeySegment(),this.updateStack(a)},o.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b=a.measureUuids.slice(),c=h.copy(this.opts.key),d={actionName:this.name,opts:{partUuid:a.partUuid,measureUuids:b,staffIdx:this.opts.staffIdx,key:c}};this.cancelStack.storeAction(d)}},o.setKeySegment=function(){var a=h.copy(this.opts.key),b={partIdx:this.opts.partIdx,startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,staffIdx:this.opts.staffIdx,key:a};new j(this.scoreData,b,this.cancelStack).perform()},o.updateStack=function(a){var b=this.getLocation(),c=b.measureUuids.slice(),d=h.copy(this.opts.key),e={type:this.name,noDraw:!0,opts:{partUuid:b.partUuid,measureUuids:c,staffIdx:this.opts.staffIdx,previousKey:a,newKey:d}};this.cancelStack.push(e)},o.getLocation=function(){if(null===this.location){var a=this.scoreData.getMeasureUuids(this.opts.startMeasureIdx,this.opts.stopMeasureIdx),b=this.scoreData.getPartUuid(this.opts.partIdx);this.location={partUuid:b,measureUuids:a}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.keyUtils,c=Adagio.edit.action.SetKeySegment,d=Adagio.edit.composite.TransposeKeysRange=function(a,b,c){this.init(a,b,c)};d.NAME="composite.TransposeKeysRange";var e=d.prototype;e.name=d.NAME,e.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.key=null,this.startMeasureIdx=null,this.stopMeasureIdx=null},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);for(var a=this.opts.startMeasureIdx,b=this.opts.stopMeasureIdx,c=a;c<=b;c++){var d=this.getKey(c);this.addKey(d,c)}this.finishSegment()},e.getKey=function(b){var c=this.scoreData.getMeasure(this.opts.partIdx,b);return a.getWrappedKey(c).getEntry(this.opts.staffIdx)},e.addKey=function(a,b){this.hasOngoing()?this.isSameKey(a)?this.continueSegment(b):(this.finishSegment(),this.startSegment(a,b)):this.startSegment(a,b)},e.hasOngoing=function(){return null!==this.key},e.startSegment=function(a,c){this.key=b.copy(a),this.startMeasureIdx=c,this.stopMeasureIdx=c},e.isSameKey=function(a){return b.isSame(a,this.key)},e.continueSegment=function(a){this.stopMeasureIdx=a},e.finishSegment=function(){this.transposeKeySegment(this.startMeasureIdx,this.stopMeasureIdx),this.key=null,this.startMeasureIdx=null,this.stopMeasureIdx=null},e.transposeKeySegment=function(a,d){var e=this.key,f=b.transpose(e,this.opts.transpose);if(!b.isSame(e,f)){var g={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,startMeasureIdx:a,stopMeasureIdx:d,key:f},h=new c(this.scoreData,g,this.cancelStack);h.checkPreconditions(),h.perform()}}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadMeasureIdxError,b=Adagio.Error.client.BadStaffIdxError,c=Adagio.Error.client.RevertRangeError,d=Adagio.Error.client.BadTimePosError,e=Adagio.Error.client.PitchCollisionError,f=Adagio.Error.client.PitchOverflowError,g=Adagio.Error.client.LineOutOfRangeError,h=Adagio.Error.client.NotPossibleOnUnpitchedError,i=Adagio.Error.noChange.NoChangeError,j=Adagio.edit.action.TransposeVoiceRange,k=Adagio.edit.action.TransposeHarmoniesRange,l=Adagio.edit.composite.TransposeKeysRange,m=Adagio.edit.common.convertPartUuidToGetPartIdx,n=Adagio.edit.common.convertMeasuresUuidsToMeasuresIdxs,o=Adagio.edit.common.getMeasuresScroller,p=Adagio.edit.common.assertPerform,q=Adagio.Utils.math,r=Adagio.Utils.measureUtils,s=Adagio.Utils.noteUtils,t=Adagio.Utils.transposeUtils,u=Adagio.Utils.partContentUtils,v=Adagio.edit.action.TransposeStaffRange=function(a,b,c){this.init(a,b,c)};v.NAME="action.TransposeStaffRange";var w=v.prototype;w.name=v.NAME,w.init=function(a,b,c){n(a,b),m(a,b),this.measuresScroller=o(a,b),this.cancelStack=c,this.opts=b,this.location=null,this.wrappedActions=null},w.checkPreconditions=function(){if(this.checkLocation(),t.check(this.opts.transpose),this.sanitize(),t.isIdentity(this.opts.transpose))throw new i;this.checkActions()},w.checkLocation=function(){this.checkPitchedPart();var a=this.measuresScroller.getScoreData(),d=a.getPartContent(this.opts.partIdx),e=u.getNbStaves(d),f=this.opts.staffIdx;if(!q.isInteger(f)||f<0||f>=e)throw new b(f);this.checkMeasureIdx(this.opts.startMeasureIdx),this.checkMeasureIdx(this.opts.stopMeasureIdx);var g=this.opts.startMeasureIdx,h=this.opts.stopMeasureIdx,i=h-g;if(i<0)throw new c(c.MEASURE,g,h);this.hasNoteIndexes()&&(this.checkNoteIndexes(i),this.convertNoteIndexes()),this.checkTimePos(i)},w.checkPitchedPart=function(){if(this.measuresScroller.getScoreData().isPartUnpitched(this.opts.partIdx))throw new h},w.checkMeasureIdx=function(b){var c=this.measuresScroller.getNbMeasures();if(!q.isInteger(b)||b<0||b>=c)throw new a(b,a.GET)},w.checkNoteIndexes=function(){
var a=this.measuresScroller.getMeasureData(this.opts.startMeasureIdx);a.checkVoiceIdx(this.opts.startVoiceIdx),a.getVoice(this.opts.startVoiceIdx).checkNoteIdx(this.opts.startNoteIdx);var b=this.measuresScroller.getMeasureData(this.opts.stopMeasureIdx);b.checkVoiceIdx(this.opts.stopVoiceIdx),b.getVoice(this.opts.stopVoiceIdx).checkNoteIdx(this.opts.stopNoteIdx)},w.checkTimePos=function(a){var b=this.measuresScroller.getMeasureData(this.opts.startMeasureIdx);this.checkStartTimePos(b,this.opts.startDpq,this.opts.startTimePos);var d=this.measuresScroller.getMeasureData(this.opts.stopMeasureIdx);if(this.checkStopTimePos(d,this.opts.stopDpq,this.opts.stopTimePos),0===a&&this.opts.startTimePos>this.opts.stopTimePos)throw new c(c.NOTE,this.opts.startTimePos,this.opts.stopTimePos)},w.checkStartTimePos=function(a,b,c){var e=a.getDpqValue(),f=a.getMeasure(),g=r.getNbDivisions(f),h=q.lcm(e,b);if(g*=h/e,c*=h/b,!q.isInteger(c)||c<0||c>=g)throw new d(c,h)},w.checkStopTimePos=function(a,b,c){var e=a.getDpqValue(),f=a.getMeasure(),g=r.getNbDivisions(f),h=q.lcm(e,b);if(g*=h/e,c*=h/b,!q.isInteger(c)||c<0||c>g)throw new d(c,h)},w.sanitize=function(){void 0===this.opts.checkLine&&(this.opts.checkLine=!0),void 0===this.opts.updateKeys&&(this.opts.updateKeys=!1),void 0===this.opts.preserveTies&&(this.opts.preserveTies=!1),void 0===this.opts.updateGraces&&(this.opts.updateGraces=!1),void 0===this.opts.updateHarmonies&&(this.opts.updateHarmonies=!1)},w.checkActions=function(){var a=this.getWrappedActions();if(!a.some(x)&&!this.shouldUpdateKeys())throw a[0].error};var x=function(a){try{a.action.checkPreconditions()}catch(b){if(y(b))return a.checked=!0,a.error=b,!1;throw b}return a.checked=!0,!0};w.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.getWrappedActions().forEach(this.callPerform,this),this.shouldUpdateKeys()&&this.updateMeasuresKeys()},w.hasNoteIndexes=function(){return void 0!==this.opts.startNoteIdx||void 0!==this.opts.startVoiceIdx||void 0!==this.opts.stopNoteIdx||void 0!==this.opts.stopVoiceIdx},w.convertNoteIndexes=function(){var a=this.measuresScroller.getMeasureData(this.opts.startMeasureIdx);this.opts.startDpq=a.getDpqValue();var b=a.getVoice(this.opts.startVoiceIdx);this.opts.startTimePos=b.getRangeSpace(0,this.opts.startNoteIdx);var c=this.measuresScroller.getMeasureData(this.opts.stopMeasureIdx);this.opts.stopDpq=c.getDpqValue();var d=c.getVoice(this.opts.stopVoiceIdx),e=d.getNote(this.opts.stopNoteIdx),f=s.getDuration(e);this.opts.stopTimePos=d.getRangeSpace(0,this.opts.stopNoteIdx)+f,delete this.opts.startVoiceIdx,delete this.opts.startNoteIdx,delete this.opts.stopVoiceIdx,delete this.opts.stopNoteIdx},w.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b=a.measureUuids.slice(),c=t.copy(this.opts.transpose),d={actionName:this.name,opts:{partUuid:a.partUuid,measureUuids:b,staffIdx:this.opts.staffIdx,startDpq:this.opts.startDpq,startTimePos:this.opts.startTimePos,stopDpq:this.opts.stopDpq,stopTimePos:this.opts.stopTimePos,checkLine:this.opts.checkLine,updateKeys:this.opts.updateKeys,preserveTies:this.opts.preserveTies,updateGraces:this.opts.updateGraces,updateHarmonies:this.opts.updateHarmonies,transpose:c}};this.cancelStack.storeAction(d)}},w.getLocation=function(){if(null===this.location){var a=this.measuresScroller.getScoreData(),b=a.getMeasureUuids(this.opts.startMeasureIdx,this.opts.stopMeasureIdx),c=a.getPartUuid(this.opts.partIdx);this.location={partUuid:c,measureUuids:b}}return this.location},w.getWrappedActions=function(){return null===this.wrappedActions&&this.createWrappedActions(),this.wrappedActions},w.createWrappedActions=function(){var a=this.getStaffVoicesIndexes();this.wrappedActions=a.map(this.createWrappedAction,this),this.shouldUpdateHarmonies()&&this.addUpdateHarmonies()},w.getStaffVoicesIndexes=function(){return this.measuresScroller.getScoreData().getPartStaffVoicesIndexes(this.opts.partIdx,this.opts.staffIdx)},w.createWrappedAction=function(a){var b=t.copy(this.opts.transpose),c={partIdx:this.opts.partIdx,voiceIdx:a,startMeasureIdx:this.opts.startMeasureIdx,startTimePos:this.opts.startTimePos,startDpq:this.opts.startDpq,stopMeasureIdx:this.opts.stopMeasureIdx,stopTimePos:this.opts.stopTimePos,stopDpq:this.opts.stopDpq,transpose:b,checkLine:this.opts.checkLine,preserveTies:this.opts.preserveTies,updateGraces:this.opts.updateGraces};return{action:new j(this.measuresScroller,c,null),error:null,checked:!1}},w.callPerform=function(a){null===a.error&&(a.action.cancelStack=this.cancelStack,a.checked?a.action.perform():p(a.action,y))};var y=function(a){return a instanceof e||a instanceof f||a instanceof g||a instanceof c&&a.type===c.NOTE||a instanceof i};w.shouldUpdateKeys=function(){return this.opts.updateKeys&&!t.isUnison(this.opts.transpose)},w.updateMeasuresKeys=function(){var a=this.opts.startMeasureIdx,b=null,c=null;for(0===this.opts.startTimePos&&(b=a),a++;a<=this.opts.stopMeasureIdx;a++)null===b&&(b=a),c=a;if(null!==b){var d=t.copy(this.opts.transpose),e={partIdx:this.opts.partIdx,startMeasureIdx:b,stopMeasureIdx:c,staffIdx:this.opts.staffIdx,transpose:d},f=this.measuresScroller.getScoreData();new l(f,e,this.cancelStack).perform()}},w.shouldUpdateHarmonies=function(){return this.opts.updateHarmonies&&!t.isUnison(this.opts.transpose)},w.addUpdateHarmonies=function(){var a=t.copy(this.opts.transpose),b={partIdx:this.opts.partIdx,startMeasureIdx:this.opts.startMeasureIdx,startTimePos:this.opts.startTimePos,startDpq:this.opts.startDpq,stopMeasureIdx:this.opts.stopMeasureIdx,stopTimePos:this.opts.stopTimePos,stopDpq:this.opts.stopDpq,transpose:a},c=this.measuresScroller.getScoreData(),d=new k(c,b,this.cancelStack),e={action:d,error:null,checked:!1};this.wrappedActions.push(e)}}.call(this),function(){"use strict";var a=Adagio.Error.client.NoOctaveShiftError,b=Adagio.Error.client.BadStaffIdxError,c=Adagio.Error.client.TimePosOutOfRangeError,d=Adagio.Error.client.RevertRangeError,e=Adagio.Error.noChange.NoChangeError,f=Adagio.Error.InternalError,g=Adagio.Utils.measureUtils,h=Adagio.Utils.directionUtils,i=Adagio.Utils.math,j=Adagio.Utils.partContentUtils,k=Adagio.Utils.transposeUtils,l=Adagio.Values.DirectionPlacement,m=Adagio.Values.OctaveShiftSize,n=Adagio.edit.common.convertPartUuidToGetPartIdx,o=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,p=Adagio.edit.common.optsToLocalGetTimePos,q=Adagio.edit.common.searchOctaveShiftSides,r=Adagio.Data.octaveShift.searchOctaveShift,s=Adagio.edit.composite.RemoveOctaveShift,t=Adagio.edit.action.TransposeStaffRange,u=Adagio.edit.action.RemoveOctaveShiftAtTimePos=function(a,b,c){this.init(a,b,c)};u.NAME="action.RemoveOctaveShiftAtTimePos";var v=u.prototype;v.name=u.NAME,v.init=function(a,b,c){n(a,b),o(a,b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.localTimePos=null,this.measureData=null,this.location=null,this.previousData=null,this.transposeAction=null},v.checkPreconditions=function(){this.checkLocation(),this.checkTimePos(),this.checkExistence(),this.sanitize(),this.opts.transpose&&this.checkCanTranspose()},v.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx);var a=this.getMeasure(),c=g.getNbStaves(a);if(this.opts.staffIdx<0||this.opts.staffIdx>=c)throw new b(this.opts.staffIdx)},v.checkTimePos=function(){var a=this.getLocalTimePos(),b=this.getMeasure(),d=g.getNbDivisions(b);if(!i.isNumber(a)||a<0||a>=d){var e=g.getDpq(b);throw new c(a,e)}},v.checkExistence=function(){if(!this.hasOctaveShift())throw new a},v.hasOctaveShift=function(){var a=this.getLocalTimePos(),b=this.getMeasure(),c=g.getOctaveShifts(b,this.opts.staffIdx),d=this.extractLeftOctaveShift(b);return null!==r(d,c,a)},v.extractLeftOctaveShift=function(a){return g.hasLeftOctaveShift(a,this.opts.staffIdx)?g.getLeftOctaveShift(a,this.opts.staffIdx):null},v.searchOctaveShift=function(a){var b=this;return h.getPosTime(a)===b},v.getLocalTimePos=function(){if(null===this.localTimePos){var a=this.getMeasure();this.localTimePos=p(this.opts,a)}return this.localTimePos},v.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},v.sanitize=function(){void 0===this.opts.transpose&&(this.opts.transpose=!1)},v.checkCanTranspose=function(){var a=this.getTransposeAction();try{a.checkPreconditions(),this.canTranspose=!0}catch(a){if(!(a instanceof d||a instanceof e))throw a;this.canTranspose=!1}},v.perform=function(){if(this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.opts.transpose&&this.canTranspose){var a=this.getTransposeAction();a.cancelStack=this.cancelStack,a.perform()}var b=this.getPreviousData();this.removeOctaveShift(),this.updateStack(b)},v.getTransposeAction=function(){if(null===this.transposeAction){var a=this.getTransposeValue(),b=this.getPreviousData(),c={partIdx:this.opts.partIdx,startMeasureIdx:b.startMeasureIdx,startTimePos:b.startTimePos,startDpq:b.startDpq,stopMeasureIdx:b.stopMeasureIdx,stopTimePos:b.stopTimePos,stopDpq:b.stopDpq,staffIdx:this.opts.staffIdx,transpose:a,checkLine:!1};this.transposeAction=new t(this.scoreData,c,null)}return this.transposeAction},v.getTransposeValue=function(){var a=this.getPreviousData(),b=k.createDefault(),c=w(a.placement),d=m.sizeToOctaveShift(a.size);return d*=c,k.setOctaveChange(b,d),b};var w=function(a){if(a===l.ABOVE)return-1;if(a===l.BELOW)return 1;throw new f("Unexpedted")};v.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,timePos:this.opts.timePos,dpq:this.opts.dpq,staffIdx:this.opts.staffIdx,transpose:this.opts.transpose}};this.cancelStack.storeAction(b)}},v.getPreviousData=function(){if(null===this.previousData){var a=this.getLocalTimePos(),b=this.scoreData.getPartContent(this.opts.partIdx),c=j.getMeasures(b),d=q(c,this.opts.measureIdx,this.opts.staffIdx,a),e=d.startMeasureIdx,f=this.scoreData.getMeasureUuid(e),h=d.stopMeasureIdx,i=this.scoreData.getMeasureUuid(h),k=this.scoreData.getMeasure(this.opts.partIdx,d.startMeasureIdx),l=g.getDpq(k),m=this.scoreData.getMeasure(this.opts.partIdx,d.stopMeasureIdx),n=g.getDpq(m);this.previousData={startMeasureUuid:f,startMeasureIdx:e,startTimePos:d.startTimePos,startDpq:l,stopMeasureUuid:i,stopMeasureIdx:h,stopTimePos:d.stopTimePos,stopDpq:n,placement:d.placement,type:d.type,size:d.size}}return this.previousData},v.removeOctaveShift=function(){var a=this.getLocalTimePos(),b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,timePos:a};new s(this.scoreData,b,this.cancelStack).perform()},v.updateStack=function(a){var b=this.getLocation(),c={type:this.name,noDraw:!0,opts:{partUuid:b.partUuid,startMeasureUuid:a.startMeasureUuid,startTimePos:a.startTimePos,startDpq:a.startDpq,stopMeasureUuid:a.stopMeasureUuid,stopTimePos:a.stopTimePos,stopDpq:a.stopDpq,staffIdx:this.opts.staffIdx,placement:a.placement,type:a.type,size:a.size}};this.cancelStack.push(c)},v.getLocation=function(){if(null===this.location){var a=this.scoreData.getPartUuid(this.opts.partIdx),b=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={partUuid:a,measureUuid:b}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Utils.math,b=Adagio.Utils.measureUtils,c=Adagio.Utils.direction.octaveShiftDirectionUtils,d=Adagio.Values.OctaveShiftType,e=Adagio.edit.action.RemoveOctaveShiftAtTimePos,f=Adagio.edit.common.assertPerform,g=Adagio.edit.composite.RemoveOctaveShiftsRange=function(a,b,c){this.init(a,b,c)};g.NAME="composite.RemoveOctaveShiftsRange";var h=g.prototype;h.name=g.NAME,h.init=function(a,b,c){this.scoreData=a,this.opts=b,this.cancelStack=c,this.currentMeasureIdx=null},h.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeLeftOctaveShifts(),this.removeLeftMeasureOctaveShifts(),this.removeMiddleMeasureOctaveShifts(),this.removeRightMeasureOctaveShifts()},h.removeLeftOctaveShifts=function(){this.currentMeasureIdx=this.opts.startMeasureIdx;var a=this.getMeasure(this.currentMeasureIdx),c=b.getOctaveShifts(a,this.opts.staffIdx);if(c=c.filter(function(a){return this.isBeforeLimit(a,this.opts.startMeasureIdx,this.opts.startTimePos,this.opts.startDpq)},this),0!==c.length){var d=c.pop();i(d)&&this.removeFromEntry(d)}else this.hasLeftOctaveShift()&&this.removeCrossMeasureOctaveShift()},h.removeCrossMeasureOctaveShift=function(){this.removeOctaveShift(0,1,this.opts.staffIdx)},h.removeLeftMeasureOctaveShifts=function(){var a=this.getOctaveShiftStarts();a=a.filter(this.isWithinLimits,this),a.forEach(this.removeFromEntry,this);var b=this.getOctaveShiftsStops();b=b.filter(this.isWithinLimits,this),b.forEach(this.removeFromEntry,this)},h.removeMiddleMeasureOctaveShifts=function(){for(var a=this.opts.startMeasureIdx+1;a<this.opts.stopMeasureIdx;a++){this.currentMeasureIdx=a;this.getOctaveShiftStarts().forEach(this.removeFromEntry,this);this.getOctaveShiftsStops().forEach(this.removeFromEntry,this)}},h.removeRightMeasureOctaveShifts=function(){this.currentMeasureIdx=this.opts.stopMeasureIdx;var a=this.getOctaveShiftStarts();a=a.filter(this.isWithinLimits,this),a.forEach(this.removeFromEntry,this);var b=this.getOctaveShiftsStops();b=b.filter(this.isWithinLimits,this),b.forEach(this.removeFromEntry,this)},h.removeFromEntry=function(a){var d=c.getTimePos(a),e=c.getStaffIdx(a),f=this.getMeasure(this.currentMeasureIdx),g=b.getDpq(f);this.removeOctaveShift(d,g,e)},h.removeOctaveShift=function(a,b,c){var d={partIdx:this.opts.partIdx,measureIdx:this.currentMeasureIdx,timePos:a,dpq:b,staffIdx:c,transpose:this.opts.transposeOverrided},g=new e(this.scoreData,d,this.cancelStack);f(g)},h.isWithinLimits=function(a){return!(this.currentMeasureIdx<this.opts.startMeasureIdx)&&(!(this.currentMeasureIdx>this.opts.stopMeasureIdx)&&(this.currentMeasureIdx>this.opts.startMeasureIdx&&this.currentMeasureIdx<this.opts.stopMeasureIdx||!(this.currentMeasureIdx===this.opts.startMeasureIdx&&!this.isAfterLimit(a,this.opts.startMeasureIdx,this.opts.startTimePos,this.opts.startDpq))&&!(this.currentMeasureIdx===this.opts.stopMeasureIdx&&!this.isBeforeLimit(a,this.opts.stopMeasureIdx,this.opts.stopTimePos,this.opts.stopDpq))))},h.isAfterLimit=function(d,e,f,g){var h=this.getMeasure(e),i=b.getDpq(h),j=a.lcm(i,g);return!(c.getTimePos(d)*j/i<f*j/g)},h.isBeforeLimit=function(d,e,f,g){var h=this.getMeasure(e),i=b.getDpq(h),j=a.lcm(i,g);return!(c.getTimePos(d)*j/i>f*j/g)},h.getOctaveShiftStarts=function(){var a=this.getMeasure(this.currentMeasureIdx),c=b.getOctaveShifts(a,this.opts.staffIdx);return c=c.filter(i)};var i=function(a){var b=c.getType(a);return b===d.UP||b===d.DOWN};h.getOctaveShiftsStops=function(){var a=this.getMeasure(this.currentMeasureIdx),c=b.getOctaveShifts(a,this.opts.staffIdx);return c=c.filter(j)};var j=function(a){return c.getType(a)===d.STOP};h.getMeasure=function(a){return this.scoreData.getMeasure(this.opts.partIdx,a)},h.hasLeftOctaveShift=function(){var a=this.getMeasure(this.currentMeasureIdx);return b.hasLeftOctaveShift(a,this.opts.staffIdx)}}.call(this),function(){"use strict";var a=Adagio.edit.composite.AdaptDpqToPosition,b=Adagio.edit.common.optsToLocalGetTimePos,c=Adagio.Values.OctaveShiftType,d=Adagio.Utils.measureUtils,e=Adagio.edit.primitive.AddOctaveShift,f=Adagio.edit.primitive.AddOctaveShiftContinue,g=Adagio.edit.composite.RemoveOctaveShiftsRange,h=Adagio.edit.composite.AddOctaveShift=function(a,b,c){this.init(a,b,c)};h.NAME="composite.AddOctaveShift";var i=h.prototype;i.name=h.NAME,i.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},i.perform=function(){this.updateStartDpq(),this.updateStopDpq(),this.removeExistingOctaveShifts(),this.addOctaveShiftLeftSide(),this.addOctaveShiftRightSide(),this.addOctaveShiftContinues()},i.updateStartDpq=function(){var c={partIdx:this.opts.partIdx,measureIdx:this.opts.startMeasureIdx,timePos:this.opts.startTimePos,dpq:this.opts.startDpq};new a(this.scoreData,c,this.cancelStack).perform();var e=this.scoreData.getMeasure(this.opts.partIdx,this.opts.startMeasureIdx),f={timePos:this.opts.startTimePos,dpq:this.opts.startDpq};this.opts.startTimePos=b(f,e),this.opts.startDpq=d.getDpq(e)},i.updateStopDpq=function(){var c={partIdx:this.opts.partIdx,measureIdx:this.opts.stopMeasureIdx,timePos:this.opts.stopTimePos,dpq:this.opts.stopDpq};new a(this.scoreData,c,this.cancelStack).perform();var e=this.scoreData.getMeasure(this.opts.partIdx,this.opts.stopMeasureIdx),f={timePos:this.opts.stopTimePos,dpq:this.opts.stopDpq};this.opts.stopTimePos=b(f,e),this.opts.stopDpq=d.getDpq(e)},i.removeExistingOctaveShifts=function(){var a={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,startTimePos:this.opts.startTimePos,startDpq:this.opts.startDpq,stopTimePos:this.opts.stopTimePos,stopDpq:this.opts.stopDpq,transposeOverrided:this.opts.transposeOverrided};new g(this.scoreData,a,this.cancelStack).perform()},i.addOctaveShiftLeftSide=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.startMeasureIdx,timePos:this.opts.startTimePos,staffIdx:this.opts.staffIdx,placement:this.opts.placement,type:this.opts.type,size:this.opts.size};new e(this.scoreData,a,this.cancelStack).perform()},i.addOctaveShiftRightSide=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.stopMeasureIdx,timePos:this.opts.stopTimePos,staffIdx:this.opts.staffIdx,placement:this.opts.placement,type:c.STOP,size:this.opts.size};new e(this.scoreData,a,this.cancelStack).perform()},i.addOctaveShiftContinues=function(){for(var a=this.opts.startMeasureIdx;a<this.opts.stopMeasureIdx;a++)this.addOctaveShiftContinue(a)},i.addOctaveShiftContinue=function(a){var b={partIdx:this.opts.partIdx,measureIdx:a,placement:this.opts.placement,staffIdx:this.opts.staffIdx,type:this.opts.type,size:this.opts.size};new f(this.scoreData,b,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.edit.common.convertPartUuidToGetPartIdx,b=Adagio.edit.common.convertMeasureUuidToStartStop,c=Adagio.edit.common.optsToLocalGetTimePos,d=Adagio.Utils.measureUtils,e=Adagio.Utils.math,f=Adagio.Utils.transposeUtils,g=Adagio.Error.InternalError,h=Adagio.Error.client.TimePosOutOfRangeError,i=Adagio.Error.client.RevertRangeError,j=Adagio.Error.client.EmptyRangeError,k=Adagio.Error.client.BadStaffIdxError,l=Adagio.Error.client.NotPossibleOnUnpitchedError,m=Adagio.Error.noChange.NoChangeError,n=Adagio.Values.DirectionPlacement,o=Adagio.Values.OctaveShiftType,p=Adagio.Values.OctaveShiftSize,q=Adagio.edit.action.TransposeStaffRange,r=Adagio.edit.composite.AddOctaveShift,s=Adagio.edit.action.AddOctaveShiftAtTimePos=function(a,b,c){this.init(a,b,c)};s.NAME="action.AddOctaveShiftAtTimePos";var t=s.prototype;t.name=s.NAME,t.init=function(c,d,e){a(c,d),b(c,d),this.scoreData=c,this.opts=d,this.cancelStack=e,this.location=null,this.transposeAction=null},t.checkPreconditions=function(){this.checkPitchedPart(),this.checkLocation(),this.checkValues(),this.sanitize(),this.opts.transpose&&this.checkCanTranspose()},t.checkPitchedPart=function(){if(this.scoreData.isPartUnpitched(this.opts.partIdx))throw new l},t.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.startMeasureIdx),this.scoreData.checkMeasureIdx(this.opts.stopMeasureIdx),this.checkStartTimePos(),this.checkStopTimePos(),this.checkRevertRange(),this.checkStaffIdx()},t.checkStartTimePos=function(){var a=this.getStartMeasure(),b={dpq:this.opts.startDpq,timePos:this.opts.startTimePos},f=c(b,a),g=d.getNbDivisions(a);if(!e.isNumber(f)||f<0||f>=g){var i=d.getDpq(a);throw new h(f,i)}},t.checkStopTimePos=function(){var a=this.getStopMeasure(),b={dpq:this.opts.stopDpq,timePos:this.opts.stopTimePos},f=c(b,a),g=d.getNbDivisions(a);if(!e.isNumber(f)||f<0||f>g){var i=d.getDpq(a);throw new h(f,i)}},t.checkRevertRange=function(){var a=this.opts.startMeasureIdx,b=this.opts.stopMeasureIdx,c=b-a;if(c<0)throw new i(i.MEASURE,a,b);if(0===c){var d=this.opts.startTimePos,e=this.opts.stopTimePos;if(d>e)throw new i(i.TIME_POS,d,e);if(d===e)throw new j(j.TIME_POS)}},t.checkStaffIdx=function(){var a=this.getStartMeasure(),b=d.getNbStaves(a);if(this.opts.staffIdx<0||this.opts.staffIdx>=b)throw new k(this.opts.staffIdx)},t.checkValues=function(){n.check(this.opts.placement),p.check(this.opts.size)},t.getStartMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.startMeasureIdx)},t.getStopMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.stopMeasureIdx)},t.sanitize=function(){void 0===this.opts.transpose&&(this.opts.transpose=!1),void 0===this.opts.transposeOverrided&&(this.opts.transposeOverrided=!1)},t.checkCanTranspose=function(){var a=this.getTransposeAction();try{a.checkPreconditions(),this.canTranspose=!0}catch(a){if(!(a instanceof i||a instanceof m))throw a;this.canTranspose=!1}},t.perform=function(){if(this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.opts.transpose&&this.canTranspose){var a=this.getTransposeAction();a.cancelStack=this.cancelStack,a.perform()}this.addOctaveShift(),this.updateStack()},t.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,startMeasureUuid:a.startMeasureUuid,startTimePos:this.opts.startTimePos,startDpq:this.opts.startDpq,stopMeasureUuid:a.stopMeasureUuid,stopTimePos:this.opts.stopTimePos,stopDpq:this.opts.stopDpq,staffIdx:this.opts.staffIdx,placement:this.opts.placement,size:this.opts.size,transpose:this.opts.transpose,transposeOverrided:this.opts.transposeOverrided}};this.cancelStack.storeAction(b)}},t.getTransposeAction=function(){if(null===this.transposeAction){var a=this.getTransposeValue(),b={partIdx:this.opts.partIdx,startMeasureIdx:this.opts.startMeasureIdx,startTimePos:this.opts.startTimePos,startDpq:this.opts.startDpq,stopMeasureIdx:this.opts.stopMeasureIdx,stopTimePos:this.opts.stopTimePos,stopDpq:this.opts.stopDpq,staffIdx:this.opts.staffIdx,transpose:a,checkLine:!1};this.transposeAction=new q(this.scoreData,b,null)}return this.transposeAction},t.getTransposeValue=function(){var a=f.createDefault(),b=u(this.opts.placement),c=p.sizeToOctaveShift(this.opts.size);return c*=b,f.setOctaveChange(a,c),a};var u=function(a){if(a===n.ABOVE)return 1;if(a===n.BELOW)return-1;throw new g("Unexpedted")};t.addOctaveShift=function(){var a=this.getType(),b={partIdx:this.opts.partIdx,startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,staffIdx:this.opts.staffIdx,startTimePos:this.opts.startTimePos,startDpq:this.opts.startDpq,stopTimePos:this.opts.stopTimePos,stopDpq:this.opts.stopDpq,placement:this.opts.placement,type:a,size:this.opts.size,transposeOverrided:this.opts.transposeOverrided};new r(this.scoreData,b,this.cancelStack).perform()},t.getType=function(){if(this.isAbove())return o.DOWN;if(this.isBelow())return o.UP;throw new g("Unexpedted")},t.isAbove=function(){return this.opts.placement===n.ABOVE},t.isBelow=function(){return this.opts.placement===n.BELOW},t.updateStack=function(){var a=this.getLocation(),b={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuid:a.startMeasureUuid,timePos:this.opts.startTimePos,dpq:this.opts.startDpq,staffIdx:this.opts.staffIdx}};this.cancelStack.push(b)},t.getLocation=function(){if(null===this.location){var a=this.scoreData.getPartUuid(this.opts.partIdx),b=this.scoreData.getMeasureUuid(this.opts.startMeasureIdx),c=this.scoreData.getMeasureUuid(this.opts.stopMeasureIdx);this.location={partUuid:a,startMeasureUuid:b,stopMeasureUuid:c}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Utils.partContentUtils,b=Adagio.Utils.noteUtils,c=Adagio.edit.common.MeasuresScroller,d=Adagio.edit.common.voiceIdxToStartStop,e=Adagio.edit.action.AddOctaveShiftAtTimePos,f=Adagio.edit.action.AddOctaveShift=function(a,b,c){this.init(a,b,c)};f.NAME="action.AddOctaveShift";var g=f.prototype;g.name=f.NAME,g.init=function(a,b,c){d(b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.measuresScroller=null,this.action=null,this.startTimePos=null,this.stopTimePos=null},g.checkPreconditions=function(){this.checkLocation(),this.getAction().checkPreconditions()},g.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.startMeasureIdx),this.scoreData.checkMeasureIdx(this.opts.stopMeasureIdx),this.getStartMeasureData().checkVoiceIdx(this.opts.startVoiceIdx),this.getStartVoice().checkNoteIdx(this.opts.startNoteIdx),this.getStopMeasureData().checkVoiceIdx(this.opts.stopVoiceIdx),this.getStopVoice().checkInsertionIdx(this.opts.stopNoteIdx)},g.getAction=function(){if(null===this.action){var a=this.getStartMeasureData(),b=a.getDpqValue(),c=this.getStartTimePos(),d=this.getStopMeasureData(),f=d.getDpqValue(),g=this.getStopTimePos(),h={partIdx:this.opts.partIdx,startMeasureIdx:this.opts.startMeasureIdx,startTimePos:c,startDpq:b,stopMeasureIdx:this.opts.stopMeasureIdx,stopTimePos:g,stopDpq:f,staffIdx:this.opts.staffIdx,placement:this.opts.placement,size:this.opts.size,transpose:!0,transposeOverrided:!0};this.action=new e(this.scoreData,h,this.cancelStack)}return this.action},g.getStartTimePos=function(){if(null===this.startTimePos){var a=this.getStartVoice();this.startTimePos=h(a,this.opts.startNoteIdx)}return this.startTimePos},g.getStopTimePos=function(){if(null===this.stopTimePos){var a=this.getStopVoice();this.stopTimePos=h(a,this.opts.stopNoteIdx)}return this.stopTimePos};var h=function(a,c){for(var d=0,e=0;e<c;e++){var f=a.getNote(e);d+=b.getDuration(f)}return d};g.getStartVoice=function(){return this.getStartMeasureData().getVoice(this.opts.startVoiceIdx)},g.getStopVoice=function(){return this.getStopMeasureData().getVoice(this.opts.stopVoiceIdx)},g.getStartMeasureData=function(){return this.getMeasuresScroller().getMeasureData(this.opts.startMeasureIdx)},g.getStopMeasureData=function(){return this.getMeasuresScroller().getMeasureData(this.opts.stopMeasureIdx)},g.getMeasuresScroller=function(){if(null===this.measuresScroller){var b=this.opts.partIdx,d=this.scoreData.getPartContent(b),e=a.getMeasures(d);this.measuresScroller=new c(e,b,this.scoreData)}return this.measuresScroller},g.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a=this.getAction();a.cancelStack=this.cancelStack,a.perform()}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.typeUtils,c=Adagio.Utils.pitchUtils,d=Adagio.edit.common.initMeasureData,e=Adagio.edit.primitive.AddHammerOnPullOffSide=function(a,b,c){this.init(a,b,c)};e.NAME="primitive.AddHammerOnPullOffSide";var f=e.prototype;f.name=e.NAME,f.initMeasureData=d,f.init=function(a,b,c){this.initMeasureData(a,b),this.opts=b,this.cancelStack=c},f.perform=function(){var c=this.measureData.getVoice(this.opts.voiceIdx),d=c.getChord(this.opts.noteIdx);d=b.makeArray(d);var e=d.find(this.pitchPredicate,this);a.addTechnical(e,this.opts.technicalType,this.opts.technicalOpts),this.updateStack()},f.pitchPredicate=function(b){var d=a.getPitch(b);return c.isSameLine(d,this.opts.pitch)},f.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:c.copy(this.opts.pitch)}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.edit.common.CrossMeasure,b=Adagio.edit.common.initMeasureData,c=Adagio.edit.common.getMeasuresScroller,d=Adagio.edit.common.fetchSlurStart,e=Adagio.edit.common.fetchSlurStop,f=Adagio.edit.common.assertPerform,g=Adagio.Values.HammerOnPullOffType,h=Adagio.Values.TechnicalType,i=Adagio.Utils.noteUtils,j=Adagio.Utils.hammerOnPullOffUtils,k=Adagio.Utils.math,l=Adagio.Utils.pitchUtils,m=Adagio.edit.primitive.AddHammerOnPullOffSide,n=Adagio.edit.action.RemoveSlur,o=Adagio.edit.action.MoveSlurSide,p=Adagio.edit.action.AddSlur,q=Adagio.edit.action.RemoveHammerOnPullOff,r=Adagio.edit.composite.AddHammerOnPullOff=function(a,b,c){this.init(a,b,c)};r.NAME="composite.AddHammerOnPullOff";var s=r.prototype;s.name=r.NAME,s.initMeasureData=b,s.init=function(b,c,d){this.initMeasureData(b,c),this.opts=c,this.cancelStack=d,this.leftNote=null,this.rightNote=null,this.crossMeasure=new a(this.measureData,c.voiceIdx,c.noteIdx)},s.perform=function(){this.extendOrCreateSlur(),this.addStartHammerOnPullOff(),this.addStopHammerOnPullOff()},s.extendOrCreateSlur=function(){var a=this.crossMeasure.getLeftMeasure(),b=this.getSlurEdges(a,{partIdx:this.opts.partIdx,measureIdx:this.crossMeasure.getLeftMeasureIdx(),voiceIdx:this.opts.voiceIdx,noteIdx:this.crossMeasure.getLeftNoteIdx()}),c=this.crossMeasure.getRightMeasure(),d=this.getSlurEdges(c,{partIdx:this.opts.partIdx,measureIdx:this.crossMeasure.getRightMeasureIdx(),voiceIdx:this.opts.voiceIdx,noteIdx:this.crossMeasure.getRightNoteIdx()});null!==d&&null!==b?(this.isSameEdges(b,d)||this.removeSlur(c,d),this.extendSlur({startMeasureIdx:k.min2(b.startMeasureIdx,d.startMeasureIdx),startNoteIdx:k.min2(b.startNoteIdx,d.startNoteIdx),stopMeasureIdx:k.max2(b.stopMeasureIdx,d.stopMeasureIdx),stopNoteIdx:k.max2(b.stopNoteIdx,d.stopNoteIdx)})):null!==d||null!==b?this.extendSlur(d||b):this.addSlur(this.crossMeasure.getLeftMeasure(),{startMeasureIdx:this.crossMeasure.getLeftMeasureIdx(),startNoteIdx:this.crossMeasure.getLeftNoteIdx(),stopMeasureIdx:this.crossMeasure.getRightMeasureIdx(),stopNoteIdx:this.crossMeasure.getRightNoteIdx()})},s.getSlurEdges=function(a,b){var f=c(a,this.opts),g=d(f,b),h=e(f,b);return null===g||null===h?null:{startMeasureIdx:g.measureIdx,startNoteIdx:g.noteIdx,stopMeasureIdx:h.measureIdx,stopNoteIdx:h.noteIdx}},s.isSameEdges=function(a,b){return a.startMeasureIdx===b.startMeasureIdx&&a.startNoteIdx===b.startNoteIdx&&a.stopMeasureIdx===b.stopMeasureIdx&&b.stopNoteIdx===b.stopNoteIdx},s.removeSlur=function(a,b){var c={partIdx:this.opts.partIdx,measureIdx:b.startMeasureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:b.startNoteIdx},d=new n(a,c,this.cancelStack);d.checkPreconditions(),d.perform()},s.extendSlur=function(a){this.crossMeasure.getLeftMeasureIdx()<=a.startMeasureIdx&&this.crossMeasure.getLeftNoteIdx()<a.startNoteIdx&&this.extendSlurSide(this.crossMeasure.getLeftMeasure(),{oldMeasureIdx:a.startMeasureIdx,oldNoteIdx:a.startNoteIdx,newNoteIdx:this.crossMeasure.getLeftNoteIdx(),newMeasureIdx:this.crossMeasure.getLeftMeasureIdx()}),this.crossMeasure.getRightMeasureIdx()>=a.stopMeasureIdx&&this.crossMeasure.getRightNoteIdx()>a.stopNoteIdx&&this.extendSlurSide(this.crossMeasure.getRightMeasure(),{oldMeasureIdx:a.stopMeasureIdx,oldNoteIdx:a.stopNoteIdx,newNoteIdx:this.crossMeasure.getRightNoteIdx(),newMeasureIdx:this.crossMeasure.getRightMeasureIdx()})},s.extendSlurSide=function(a,b){var c={partIdx:this.opts.partIdx,voiceIdx:this.opts.voiceIdx,oldMeasureIdx:b.oldMeasureIdx,oldNoteIdx:b.oldNoteIdx,newNoteIdx:b.newNoteIdx,newMeasureIdx:b.newMeasureIdx},d=new o(a,c,this.cancelStack);d.checkPreconditions(),d.perform()},s.addSlur=function(a,b){var c={partIdx:this.opts.partIdx,voiceIdx:this.opts.voiceIdx,startMeasureIdx:b.startMeasureIdx,startNoteIdx:b.startNoteIdx,stopMeasureIdx:b.stopMeasureIdx,stopNoteIdx:b.stopNoteIdx},d=new p(a,c,this.cancelStack);d.checkPreconditions(),d.perform()},s.addStartHammerOnPullOff=function(){var a=this.getLeftNote(),b=this.getTechnicalOpts(g.START);this.hasPrevious(a,b)&&this.removePrevious(a,b);var c=i.getPitch(a),d={partIdx:this.opts.partIdx,measureIdx:this.crossMeasure.getLeftMeasureIdx(),voiceIdx:this.opts.voiceIdx,noteIdx:this.crossMeasure.getLeftNoteIdx(),technicalType:this.opts.technicalType,technicalOpts:b,pitch:l.copy(c)};new m(this.crossMeasure.getLeftMeasure(),d,this.cancelStack).perform()},s.hasPrevious=function(a,b){return i.hasTechnical(a,h.HAMMER_ON,b)||i.hasTechnical(a,h.PULL_OFF,b)},s.removePrevious=function(a){
var b=i.getPitch(a);b=l.copy(b);var c={partIdx:this.opts.partIdx,measureIdx:this.crossMeasure.getLeftMeasureIdx(),voiceIdx:this.opts.voiceIdx,noteIdx:this.crossMeasure.getLeftNoteIdx(),pitch:b},d=this.crossMeasure.getLeftMeasure(),e=new q(d,c,this.cancelStack);f(e)},s.addStopHammerOnPullOff=function(){var a=this.getRightNote(),b=this.getTechnicalOpts(g.STOP),c=i.getPitch(a),d={partIdx:this.opts.partIdx,measureIdx:this.crossMeasure.getRightMeasureIdx(),voiceIdx:this.opts.voiceIdx,noteIdx:this.crossMeasure.getRightNoteIdx(),technicalType:this.opts.technicalType,technicalOpts:b,pitch:l.copy(c)};new m(this.crossMeasure.getRightMeasure(),d,this.cancelStack).perform()},s.getRightNote=function(){if(null===this.rightNote){var a=this.getLeftNote(),b=this.crossMeasure.getRightChord(),c=i.getFretData(a);this.rightNote=b.find(this.stringPredicate,c)}return this.rightNote},s.getLeftNote=function(){if(null===this.leftNote){var a=this.crossMeasure.getLeftChord();this.leftNote=a.find(this.pitchPredicate,this)}return this.leftNote},s.pitchPredicate=function(a){var b=i.getPitch(a);return l.isSameLine(b,this.opts.pitch)},s.stringPredicate=function(a){var b=i.getFretData(a),c=this;return b.string===c.string},s.getTechnicalOpts=function(a){return{hammerOnPullOff:j.create(a)}}}.call(this),function(){"use strict";var a=Adagio.edit.common.initMeasureData,b=Adagio.edit.common.convertPartUuidToGetPartIdx,c=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,d=Adagio.edit.common.convertTimePosToGetNoteIdx,e=Adagio.edit.common.noteIdxToTimePos,f=Adagio.edit.common.checkTabPart,g=Adagio.edit.common.convertLineToPitch,h=Adagio.edit.common.convertExistingFretToPitch,i=Adagio.edit.common.checkOptsPitch,j=Adagio.edit.common.transposePitchAccidentalOpts,k=Adagio.edit.common.CrossMeasure,l=Adagio.Error.client.NotPossibleOnUnpitchedError,m=Adagio.Error.client.NotPossibleOnRestsError,n=Adagio.Error.client.PitchCollisionError,o=Adagio.Error.client.NoFretDataError,p=Adagio.Error.noChange.NoChangeError,q=Adagio.Values.TechnicalType,r=Adagio.Values.HammerOnPullOffType,s=Adagio.Utils.clone,t=Adagio.Utils.noteUtils,u=Adagio.Utils.pitchUtils,v=Adagio.Utils.hammerOnPullOffUtils,w=Adagio.edit.composite.AddHammerOnPullOff,x=Adagio.edit.action.AddHammerOnPullOff=function(a,b,c){this.init(a,b,c)};x.NAME="action.AddHammerOnPullOff";var y=x.prototype;y.name=x.NAME,y.initMeasureData=a,y.init=function(a,e,f){b(a,e),c(a,e),this.initMeasureData(a,e),this.opts=e,this.cancelStack=f,this.location=null,this.leftNote=null,this.rightNote=null,this.technicalType=null,this.sanitized=!1,d(this.measureData,e),this.crossMeasure=new k(this.measureData,this.opts.voiceIdx,this.opts.noteIdx)},y.checkPreconditions=function(){this.checkPitchedPart(),this.crossMeasure.checkVoiceIdx(),this.checkNoteIdx(),this.checkNotRest(),this.checkTabPart(),this.sanitizeIfNeeded(),this.checkPitch(),this.checkCompatibility(),this.checkExistence()},y.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new l},y.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},y.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},y.checkNotRest=function(){if(this.isLeftRest()||this.isRightRest())throw new m},y.isLeftRest=function(){return this.crossMeasure.isLeftRest()},y.isRightRest=function(){return this.crossMeasure.isRightRest()},y.checkTabPart=function(){f(this.measureData,this.opts)},y.sanitizeIfNeeded=function(){this.sanitized||(void 0!==this.opts.line&&g(this.measureData,this.opts),this.opts.isConcertPitch&&j(this.measureData,this.opts),void 0!==this.opts.fretData&&this.convertExistingFretToPitch(),this.sanitized=!0)},y.convertExistingFretToPitch=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,fretData:s(this.opts.fretData)};this.opts.pitch=h(this.measureData,a)},y.checkPitch=function(){i(this.opts)},y.checkCompatibility=function(){var a,b=this.getLeftNote();if(void 0===b)throw a={msgPrefix:"there is no left note"},new n(a,this.opts.pitch);if(!t.hasFretData(b))throw new o(this.opts.pitch);if(void 0===this.getRightNote())throw a={msgPrefix:"there is no right note"},new n(a,this.opts.pitch)},y.checkExistence=function(){var a=this.crossMeasure.getLeftChord(),b=this.crossMeasure.getRightChord();if(a.some(this.hasStartTechnical,this)||b.some(this.hasStopTechnical,this))throw new p},y.hasStartTechnical=function(a){var b=this.getTechnicalType(),c=this.getTechnicalOpts(r.START);return t.hasTechnical(a,b,c)},y.hasStopTechnical=function(a){var b=this.getTechnicalType(),c=this.getTechnicalOpts(r.STOP);return t.hasTechnical(a,b,c)},y.getTechnicalOpts=function(a){return{hammerOnPullOff:v.create(a)}},y.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a=this.getTechnicalType(),b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,technicalType:a,pitch:u.copy(this.opts.pitch)};new w(this.measureData,b,this.cancelStack).perform(),this.updateStack()},y.getTechnicalType=function(){if(null===this.technicalType){var a=this.getLeftNote(),b=this.getRightNote(),c=t.getPitch(a),d=t.getPitch(b);u.naiveComparePitch(c,d)>0?this.technicalType=q.PULL_OFF:this.technicalType=q.HAMMER_ON}return this.technicalType},y.getRightNote=function(){if(null===this.rightNote){var a=this.getLeftNote(),b=this.crossMeasure.getRightChord(),c=t.getFretData(a);this.rightNote=b.find(this.stringPredicate,c)}return this.rightNote},y.getLeftNote=function(){if(null===this.leftNote){var a=this.crossMeasure.getLeftChord();this.leftNote=a.find(this.pitchPredicate,this)}return this.leftNote},y.pitchPredicate=function(a){var b=t.getPitch(a);return u.isSameLine(b,this.opts.pitch)},y.stringPredicate=function(a){var b=t.getFretData(a),c=this;return!!t.hasFretData(a)&&b.string===c.string},y.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,timePos:a.timePos,divisions:a.dpq,pitch:u.copy(this.opts.pitch)}};this.cancelStack.storeAction(b)}},y.updateStack=function(){var a=this.getLocation(),b={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,timePos:a.timePos,divisions:a.dpq,pitch:u.copy(this.opts.pitch)}};this.cancelStack.push(b)},y.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=this.crossMeasure.getLeftMeasureIdx(),d=a.getMeasureUuid(c),f=this.crossMeasure.getLeftMeasure().getDpqValue(),g=this.crossMeasure.getLeftVoice(),h=this.crossMeasure.getLeftNoteIdx(),i=e(g,h);this.location={partUuid:b,measureUuid:d,dpq:f,timePos:i}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.noteUtils,c=Adagio.edit.common.getGraceAtUnpitched,d=Adagio.edit.common.getMIDIUnpitched,e=Adagio.edit.common.initMeasureData,f=Adagio.edit.primitive.ChangeGraceHeadPercu=function(a,b,c){this.init(a,b,c)};f.NAME="primitive.ChangeGraceHeadPercu";var g=f.prototype;g.initMeasureData=e,g.name=f.NAME,g.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},g.perform=function(){var a=this.getGraceAtUnpitched();b.setHead(a,this.opts.notehead);var c=this.getInstrumentId();b.setInstrumentId(a,c),this.updateStack()},g.getGraceAtUnpitched=function(){var b=this.measureData.getVoice(this.opts.voiceIdx),d=c(b,this.opts.noteIdx,this.opts.graceIdx,this.opts.unpitched);if(void 0===d)throw new a("NoGraceAtPitch");return d},g.getInstrumentId=function(){var a=d(this.measureData,this.opts.partIdx,this.opts.unpitched,this.opts.notehead);return this.measureData.searchUnpitchedInstrumentId(a)},g.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.Error.noChange.NoChangeError,b=Adagio.Error.client.NotPossibleOnUnpitchedError,c=Adagio.Error.client.UnpitchedCollisionError,d=Adagio.Utils.noteUtils,e=Adagio.Utils.unpitchedUtils,f=Adagio.Utils.staffDetailsUtils,g=Adagio.edit.primitive.ChangeGraceHeadPercu,h=Adagio.edit.common.getGraceAtUnpitched,i=Adagio.edit.common.convertLineToUnpitched,j=Adagio.edit.common.convertTimePosToGetNoteIdx,k=Adagio.edit.common.convertPartUuidToGetPartIdx,l=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,m=Adagio.edit.common.checkUnpitchedMeasure,n=Adagio.edit.common.checkUnpitchedInstrument,o=Adagio.edit.common.initMeasureData,p=Adagio.edit.action.ChangeGraceHeadPercu=function(a,b,c){this.init(a,b,c)};p.NAME="action.ChangeGraceHeadPercu",p.isNoChange=function(b){return b instanceof a};var q=p.prototype;q.name=p.NAME,q.initMeasureData=o,q.init=function(a,b,c){k(a,b),l(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.sanitized=!1,this.voice=null,this.graceAtUnpitched=null,this.location=null},q.checkPreconditions=function(){this.checkUnpitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),j(this.measureData,this.opts),this.checkGraceIdx(),this.sanitizeIfNeeded(),this.checkNoteAtUnpitched(),this.checkInstrument(),this.checkHeadDifferent()},q.checkUnpitchedPart=function(){m(this.measureData)},q.checkUnpitchededPart=function(){if(this.measureData.isUnpitched())throw new b},q.checkGraceIdx=function(){this.getVoice().checkGraceIdx(this.opts.noteIdx,this.opts.graceIdx)},q.getVoice=function(){return null===this.voice&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},q.checkNoteAtUnpitched=function(){if(void 0===this.getGraceAtUnpitched()){var a=e.copy(this.opts.unpitched),b=this.opts.staffIdx||0,d=this.measureData.getStaffDetails(b),g=f.getNbStaffLines(d);throw new c(c.GET,a,g)}},q.checkInstrument=function(){n(this.measureData,this.opts)},q.checkHeadDifferent=function(){var b=this.getCurrentHead();if(this.opts.notehead===b)throw new a},q.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),j(this.measureData,this.opts),this.sanitizeIfNeeded(),this.storeAction();var a=this.getNoteData();this.changeHead(),this.updateStack(a)},q.sanitizeIfNeeded=function(){this.sanitized||(void 0!==this.opts.line&&i(this.measureData,this.opts),this.sanitized=!0)},q.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos,graceIdx:this.opts.graceIdx,unpitched:e.copy(this.opts.unpitched),notehead:this.opts.notehead}};this.cancelStack.storeAction(b)}},q.getNoteData=function(){return{notehead:this.getCurrentHead()}},q.getCurrentHead=function(){var a=this.getGraceAtUnpitched();return d.getHead(a)},q.getGraceAtUnpitched=function(){if(null===this.graceAtUnpitched){var a=this.getVoice();this.graceAtUnpitched=h(a,this.opts.noteIdx,this.opts.graceIdx,this.opts.unpitched)}return this.graceAtUnpitched},q.changeHead=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,unpitched:e.copy(this.opts.unpitched),notehead:this.opts.notehead};new g(this.measureData,a,this.cancelStack).perform()},q.updateStack=function(a){var b=this.getLocation(),c={type:this.name,noDraw:!0,opts:{partUuid:b.partUuid,measureUuid:b.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:b.dpq,timePos:b.timePos,graceIdx:this.opts.graceIdx,unpitched:e.copy(this.opts.unpitched),notehead:a.notehead}};this.cancelStack.push(c)},q.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadHarmonyIdxError,b=Adagio.Utils.measureUtils,c=Adagio.Utils.rootUtils,d=Adagio.Utils.bassUtils,e=Adagio.Utils.degreesUtils,f=Adagio.Utils.harmonyUtils,g=Adagio.Utils.math,h=Adagio.edit.action.AddHarmonyAtTimePos,i=Adagio.edit.common.convertPartUuidToGetPartIdx,j=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,k=Adagio.edit.action.ChangeHarmony=function(a,b,c){this.init(a,b,c)};k.NAME="action.ChangeHarmony";var l=k.prototype;l.name=k.NAME,l.init=function(a,b,c){i(a,b),j(a,b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.addHarmonyAction=null},l.checkPreconditions=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx),this.checkHarmonyIdx(),this.getAddHarmonyAction().checkPreconditions()},l.checkHarmonyIdx=function(){var c=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx),d=b.getNbHarmonies(c),e=this.opts.harmonyIdx;if(!g.isInteger(e)||e<0||e>=d)throw new a(e)},l.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.addHarmony()},l.addHarmony=function(){var a=this.getAddHarmonyAction();a.cancelStack=this.cancelStack,a.perform()},l.getAddHarmonyAction=function(){if(null===this.addHarmonyAction){var a=this.getTimePos(),b=this.getDpq(),d=c.copy(this.opts.root),f=m(this.opts.bass),g=this.opts.degrees||[];g=e.copy(g);var i={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:a,dpq:b,root:d,kind:this.opts.kind,bass:f,degrees:g};this.addHarmonyAction=new h(this.scoreData,i,null)}return this.addHarmonyAction};var m=function(a){return null===a||void 0===a?null:d.copy(a)};l.getTimePos=function(){var a=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx),c=b.getHarmonies(a),d=c[this.opts.harmonyIdx];return f.getTimePos(d)},l.getDpq=function(){var a=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx);return b.getDpq(a)}}.call(this),function(){"use strict";var a=Adagio.Utils.staffDetailsUtils,b=Adagio.Utils.measureUtils,c=Adagio.Utils.attributesUtils,d=Adagio.Utils.partContentUtils,e=Adagio.edit.primitive.SetStaffDetails=function(a,b,c){this.init(a,b,c)};e.NAME="primitive.SetStaffDetails";var f=e.prototype;f.name=e.NAME,f.init=function(a,b,c){this.scoreData=a,this.opts=b,this.cancelStack=c},f.perform=function(){for(var a=this.scoreData.getPartContent(this.opts.partIdx),b=d.getNbMeasures(a),c=0;c<b;c++){var e=d.getMeasure(a,c);0===c&&this.setOwnAttributesStaffDetails(e),this.setAttributesStaffDetails(e)}this.updateStack()},f.setOwnAttributesStaffDetails=function(d){var e=b.getOwnAttributes(d),f=b.getWrappedOwnStaffDetails(d),g=a.copy(this.opts.staffDetails);f.setEntry(g,this.opts.staffIdx),c.setStaffDetails(e,f.dumpAttribute())},f.setAttributesStaffDetails=function(d){var e=b.getAttributes(d),f=b.getWrappedStaffDetails(d),g=a.copy(this.opts.staffDetails);f.setEntry(g,this.opts.staffIdx),c.setStaffDetails(e,f.dumpAttribute())},f.updateStack=function(){var b={type:this.name,noDraw:!0,opts:{partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,staffDetails:a.copy(this.opts.staffDetails)}};this.cancelStack.push(b)}}.call(this),function(){"use strict";var a=Adagio.edit.composite.SetChordsFrets,b=Adagio.edit.composite.SetMeasureFrets=function(a,b,c){this.init(a,b,c)},c=b.prototype;c.init=function(a,b,c){this.measureData=a,this.opts=b,this.cancelStack=c,this.actions=null},c.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},c.perform=function(){this.getActions().forEach(this.performAction)},c.performAction=function(a){a.perform()},c.getActions=function(){return null===this.actions&&(this.actions=this.getSetChordsFretsActions()),this.actions},c.getSetChordsFretsActions=function(){for(var b=this.getVoice(),c=b.getNbNotes(),d=[],e=0;e<c;e++){var f={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:e},g=new a(this.measureData,f,this.cancelStack);d.push(g)}return d}}.call(this),function(){"use strict";var a=Adagio.edit.common.initMeasureData,b=Adagio.edit.common.convertPartUuidToGetPartIdx,c=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,d=Adagio.Error.client.NotPossibleOnUnpitchedError,e=Adagio.edit.composite.SetMeasureFrets,f=Adagio.edit.action.SetMeasureFrets=function(a,b,c){this.init(a,b,c)};f.NAME="action.SetMeasureFrets";var g=f.prototype;g.name=f.NAME,g.initMeasureData=a,g.init=function(a,d,e){b(a,d),c(a,d),this.initMeasureData(a,d),this.opts=d,this.cancelStack=e,this.location=null},g.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx)},g.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new d},g.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx};new e(this.measureData,a,this.cancelStack).perform(),this.updateStack()},g.updateStack=function(){var a=this.getLocation(),b={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx}};this.cancelStack.push(b)},g.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx}};this.cancelStack.storeAction(b)}},g.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx);this.location={partUuid:b,measureUuid:c}}return this.location}}.call(this),function(){"use strict";var a=Adagio.edit.action.SetMeasureFrets,b=Adagio.edit.common.getMeasuresScroller,c=Adagio.edit.composite.SetMeasuresFrets=function(a,b,c){this.init(a,b,c)};c.NAME="composite.SetMeasuresFrets";var d=c.prototype;d.init=function(a,b,c){this.scoreData=a,this.opts=b,this.cancelStack=c,this.actions=null},d.perform=function(){this.getActions().forEach(this.performAction)},d.performAction=function(a){a.checkPreconditions(),a.perform()},d.getActions=function(){if(null===this.actions){for(var c=[],d={partIdx:this.opts.partIdx},e=b(this.scoreData,d),f=this.scoreData.getNbMeasures(),g=0;g<f;g++){if(e.getMeasureData(g).hasVoice(this.opts.voiceIdx)){var h={partIdx:this.opts.partIdx,measureIdx:g,voiceIdx:this.opts.voiceIdx},i=new a(this.scoreData,h,this.cancelStack);c.push(i)}}this.actions=c}return this.actions}}.call(this),function(){"use strict";var a=Adagio.Utils.typeUtils,b=Adagio.Utils.noteUtils,c=Adagio.Utils.pitchUtils,d=Adagio.edit.action.SetFret,e=Adagio.edit.composite.UnsetMeasureFrets=function(a,b,c){this.init(a,b,c)},f=e.prototype;f.init=function(a,b,c){this.measureData=a,this.opts=b,this.cancelStack=c,this.actions=null},f.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},f.perform=function(){this.getUnsetFretActions().forEach(this.performActionIfPossible)},f.performActionIfPossible=function(a){a.performIfPossible()},f.getUnsetFretActions=function(){return null===this.actions&&(this.actions=this.getChordsActions()),this.actions},f.getChordsActions=function(){for(var b=this.getVoice(),c=b.getNbNotes(),d=[],e=0;e<c;e++)if(!b.isRest(e)){var f=b.getChord(e);f=a.makeArray(f);var g=this.getChordActions(f,e);d=d.concat(g)}return d},f.getChordActions=function(a,e){var f=[];return a.forEach(function(a){var g=b.getPitch(a),h={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:e,pitch:c.copy(g),fretData:null,record:!0},i=new d(this.measureData,h,this.cancelStack);f.push(i)},this),f}}.call(this),function(){"use strict";var a=Adagio.edit.common.initMeasureData,b=Adagio.edit.common.convertPartUuidToGetPartIdx,c=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,d=Adagio.Error.client.NotPossibleOnUnpitchedError,e=Adagio.edit.composite.UnsetMeasureFrets,f=Adagio.edit.action.UnsetMeasureFrets=function(a,b,c){this.init(a,b,c)};f.NAME="action.UnsetMeasureFrets";var g=f.prototype;g.name=f.NAME,g.initMeasureData=a,g.init=function(a,d,e){b(a,d),c(a,d),this.initMeasureData(a,d),this.opts=d,this.cancelStack=e,this.location=null},g.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx)},g.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new d},g.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx};new e(this.measureData,a,this.cancelStack).perform(),this.updateStack()},g.updateStack=function(){var a=this.getLocation(),b={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx}};this.cancelStack.push(b)},g.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx}};this.cancelStack.storeAction(b)}},g.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx);this.location={partUuid:b,measureUuid:c}}return this.location}}.call(this),function(){"use strict";var a=Adagio.edit.action.UnsetMeasureFrets,b=Adagio.edit.common.assertPerform,c=Adagio.edit.common.getMeasuresScroller,d=Adagio.edit.composite.UnsetMeasuresFrets=function(a,b,c){this.init(a,b,c)};d.NAME="composite.UnsetMeasuresFrets";var e=d.prototype;e.init=function(a,b,c){this.scoreData=a,this.opts=b,this.cancelStack=c,this.actions=null},e.perform=function(){this.getActions().forEach(f)};var f=function(a){b(a)};e.getMeasures=function(){return this.scoreData.getMeasures(this.opts.partIdx)},e.getActions=function(){if(null===this.actions){for(var b=[],d=this.getMeasures(),e=d.length,f=c(this.scoreData,this.opts),g=0;g<e;g++){var h=f.getMeasureData(g);if(h.hasVoice(this.opts.voiceIdx)){var i={partIdx:this.opts.partIdx,measureIdx:g,voiceIdx:this.opts.voiceIdx},j=new a(h,i,this.cancelStack);b.push(j)}}this.actions=b}return this.actions}}.call(this),function(){"use strict";var a=Adagio.edit.primitive.SetStaffDetails,b=Adagio.Utils.staffDetailsUtils,c=Adagio.Utils.measureUtils,d=Adagio.edit.composite.SetMeasuresFrets,e=Adagio.edit.composite.UnsetMeasuresFrets,f=Adagio.edit.composite.SetStaffDetails=function(a,b,c){this.init(a,b,c)};f.NAME="composite.SetStaffDetails";var g=f.prototype;g.name=f.NAME,g.init=function(a,b,c){this.scoreData=a,this.opts=b,this.cancelStack=c,this.setMeasuresFretsActions=null,this.unsetMeasuresFretsActions=null},g.perform=function(){var a=this.isTabStaff();this.setStaffDetails(),this.opts.updateFrets&&(this.hasTuningOpts()&&!a||this.unsetMeasuresFrets(),this.hasTuningOpts()&&this.setMeasuresFrets())},g.isTabStaff=function(){var a=this.scoreData.getMeasure(this.opts.partIdx,0),d=c.getWrappedStaffDetailsOrDefault(a),e=d.getEntry(this.opts.staffIdx);return b.hasStaffTuning(e)},g.hasTuningOpts=function(){return b.hasStaffTuning(this.opts.staffDetails)&&b.getStaffTuningsLength(this.opts.staffDetails)>0},g.setStaffDetails=function(){var c={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,staffDetails:b.copy(this.opts.staffDetails)};new a(this.scoreData,c,this.cancelStack).perform()},g.getVoiceIndexes=function(){return this.scoreData.getPartStaffVoicesIndexes(this.opts.partIdx,this.opts.staffIdx)},g.performAction=function(a){a.perform()},g.setMeasuresFrets=function(){this.getSetMeasuresFretsActions().forEach(this.performAction)},g.unsetMeasuresFrets=function(){this.getUnsetMeasuresFretsActions().forEach(this.performAction)},g.getSetMeasuresFretsActions=function(){if(null===this.setMeasuresFretsActions){var a=[];this.getVoiceIndexes().forEach(function(b){var c={partIdx:this.opts.partIdx,voiceIdx:b},e=new d(this.scoreData,c,this.cancelStack);a.push(e)},this),this.setMeasuresFretsActions=a}return this.setMeasuresFretsActions},g.getUnsetMeasuresFretsActions=function(){if(null===this.unsetMeasuresFretsActions){var a=[];this.getVoiceIndexes().forEach(function(b){var c={partIdx:this.opts.partIdx,voiceIdx:b},d=new e(this.scoreData,c,this.cancelStack);a.push(d)},this),this.unsetMeasuresFretsActions=a}return this.unsetMeasuresFretsActions}}.call(this),function(){"use strict";var a=Adagio.edit.common.convertPartUuidToGetPartIdx,b=Adagio.Utils.staffDetailsUtils,c=Adagio.Utils.measureUtils,d=Adagio.Utils.math,e=Adagio.Utils.partContentUtils,f=Adagio.Error.client.NotPossibleOnUnpitchedError,g=Adagio.Error.client.BadStaffIdxError,h=Adagio.edit.composite.SetStaffDetails,i=Adagio.edit.action.SetStaffDetails=function(a,b,c){this.init(a,b,c)};i.NAME="action.SetStaffDetails";var j=i.prototype;j.name=i.NAME,j.init=function(b,c,d){a(b,c),this.scoreData=b,this.cancelStack=d,this.opts=c,this.location=null,this.sanitized=!1},j.checkPreconditions=function(){this.checkStaffDetails(),this.checkPitchedPart(),this.checkLocation(),this.sanitizeIfNeeded()},j.checkStaffDetails=function(){b.check(this.opts.staffDetails)},j.checkPitchedPart=function(){if(this.scoreData.isPartUnpitched(this.opts.partIdx))throw new f},j.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx);var a=this.getFirstMeasure(),b=c.getNbStaves(a),e=this.opts.staffIdx;if(!d.isInteger(e)||e<0||e>=b)throw new g(e,g.action.GET)},j.sanitizeIfNeeded=function(){this.sanitized||(void 0===this.opts.updateFrets&&(this.opts.updateFrets=!0),this.sanitized=!0)},j.getFirstMeasure=function(){var a=this.scoreData.getPartContent(this.opts.partIdx);return e.getFirstMeasure(a)},j.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a=this.getPreviousStaffDetails();this.storeAction();var c={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,staffDetails:b.copy(this.opts.staffDetails),updateFrets:this.opts.updateFrets};new h(this.scoreData,c,this.cancelStack).perform(),this.updateStack(a)},j.getPreviousStaffDetails=function(){var a=this.getFirstMeasure();return c.getWrappedStaffDetailsOrDefault(a).getEntry(this.opts.staffIdx)},j.updateStack=function(a){var c=this.getLocation(),d=b.copy(a),e={type:this.name,noDraw:!0,opts:{partUuid:c.partUuid,staffIdx:this.opts.staffIdx,staffDetails:d,updateFrets:!1}};this.cancelStack.push(e),this.cancelStack.stateNeedCompleteRedraw()},j.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),c=b.copy(this.opts.staffDetails),d={actionName:this.name,opts:{partUuid:a.partUuid,staffIdx:this.opts.staffIdx,staffDetails:c}};this.cancelStack.storeAction(d)}},j.getLocation=function(){if(null===this.location){var a=this.scoreData.getPartUuid(this.opts.partIdx);this.location={partUuid:a}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadPartIdxError,b=Adagio.Error.client.MissingOptionError,c=Adagio.Error.client.NotPossibleOnUnpitchedError,d=Adagio.Error.noChange.NoChangeError,e=Adagio.Utils.partContentUtils,f=Adagio.Utils.measureUtils,g=Adagio.Utils.transposeUtils,h=Adagio.Utils.MIDIInstrumentUtils,i=Adagio.Utils.scoreInstrumentUtils,j=Adagio.Utils.partHeaderUtils,k=Adagio.Utils.clefUtils,l=Adagio.Utils.typeUtils,m=Adagio.Utils.staffDetailsUtils,n=Adagio.edit.common.MeasureData,o=Adagio.edit.common.convertPartUuidToGetPartIdx,p=Adagio.edit.action.TransposeStaffRange,q=Adagio.edit.action.SetClef,r=Adagio.edit.action.SetStaffDetails,s=Adagio.edit.action.ChangeInstrument=function(a,b,c){this.init(a,b,c)};s.NAME="action.ChangeInstrument";var t=s.prototype;t.name=s.NAME,t.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,o(this.scoreData,this.opts),this.transposeActions=null,this.setClefActions=null,this.setStaffDetailsActions=null,this.sanitized=!1},t.checkPreconditions=function(){var c=this.scoreData.getNbParts(),d=this.opts.partIdx;if(d<0||d>=c)throw new a(d,a.GET);if(this.checkPitchedPart(),this.sanitizeIfNeeded(),"string"!=typeof this.opts.instrumentName)throw new b("instrumentName");h.checkMIDIProgram(this.opts.MIDIProgram),void 0!==this.opts.transpose?g.check(this.opts.transpose):this.opts.transpose=g.createDefault(),this.checkTransposes(),this.checkClefs(),this.checkSetClefs(),1===this.getNbStaves()&&this.checkStaffDetails()},t.checkPitchedPart=function(){if(this.scoreData.isPartUnpitched(this.opts.partIdx))throw new c},t.checkTransposes=function(){this.getTransposeActions().forEach(function(a){try{a.action.checkPreconditions(),a.error=null}catch(b){if(a.error=b,!(b instanceof d))throw b}})},t.checkStaffDetails=function(){this.getSetStaffDetailsActions().forEach(function(a){a.checkPreconditions()})},t.checkClefs=function(){if(!l.isArray(this.opts.clefs))throw new b("clefs");this.opts.clefs.forEach(k.check)},t.checkSetClefs=function(){this.getSetClefActions().forEach(function(a){a.checkPreconditions()})},t.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded(),this.storeAction();var a=this.getPreviousData();this.opts.noTranspose||this.transpose(),this.updateInstrument(),this.updateTranspose(),this.setClef(),1===this.getNbStaves()&&this.updateStaffDetails(),this.updateStack(a)},t.sanitizeIfNeeded=function(){this.sanitized||(void 0===this.opts.clefs&&(this.opts.clefs=[]),l.isArray(this.opts.staffDetails)||(this.opts.staffDetails=[m.createDefault()]),this.sanitized=!0)},t.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.scoreData.getPartUuid(this.opts.partIdx),b=g.copy(this.opts.transpose),c=this.opts.clefs.map(k.copy),d=this.opts.staffDetails.map(m.copy),e={actionName:this.name,opts:{partUuid:a,MIDIProgram:this.opts.MIDIProgram,partName:this.opts.partName,abbreviation:this.opts.abbreviation,transpose:b,instrumentName:this.opts.instrumentName,noTranspose:!!this.opts.noTranspose,clefs:c,staffDetails:d}};this.cancelStack.storeAction(e)}},t.getPreviousData=function(){var a=this.scoreData.getPartHeader(this.opts.partIdx),b={};b.partName=j.getName(a),j.hasAbbreviation(a)&&(b.abbreviation=j.getAbbreviation(a));var c=j.getScoreInstruments(a)[0];b.instrumentName=i.getName(c);var d=j.getMIDIInstruments(a)[0];b.MIDIProgram=h.getMIDIProgram(d);var e=this.scoreData.getMeasure(this.opts.partIdx,0),f=new n(e),k=f.getTranspose(0);return b.transpose=g.copy(k),b},t.getStaffDetailsInMeasure=function(a,b){return f.getWrappedStaffDetails(a).getEntry(b)},t.hasMeasuresDifferentStaffDetails=function(a,b){return a.some(function(a){var c=this.getStaffDetailsInMeasure(a,b),d=this.opts.staffDetails,e=d.length<=b?d[d.length-1]:d[b];return!m.isSame(c,e)},this)},t.getNbStaves=function(){var a=this.scoreData.getPartContent(this.opts.partIdx);return e.getNbStaves(a)},t.getSetStaffDetailsActions=function(){return null===this.setStaffDetailsActions&&this.initSetStaffDetailsActions(),this.setStaffDetailsActions},t.initSetStaffDetailsActions=function(){var a=this.scoreData.getPartByIdx(this.opts.partIdx),b=a.measure,c=this.getNbStaves(),d=this.opts.staffDetails;if(this.setStaffDetailsActions=[],d.length>0)for(var e=0;e<c;e++)if(this.hasMeasuresDifferentStaffDetails(b,e)){var f={partIdx:this.opts.partIdx,staffIdx:e,staffDetails:d.length<=e?d[d.length-1]:d[e]},g=new r(this.scoreData,f,this.cancelStack);this.setStaffDetailsActions.push(g)}},t.getTransposeActions=function(){return null===this.transposeActions&&this.initTransposeActions(),this.transposeActions},t.initTransposeActions=function(){this.transposeActions=[];for(var a=this.getNbStaves(),b=0;b<a;b++)this.initTransposeAction(b)},t.initTransposeAction=function(a){var b=this.getRelativeTranspose(),c=this.getNbMeasures(),d=this.scoreData.getMeasure(this.opts.partIdx,c-1),e=f.getDpq(d),h=f.getNbDivisions(d),i={partIdx:this.opts.partIdx,staffIdx:a,startMeasureIdx:0,startTimePos:0,startDpq:1,stopMeasureIdx:c-1,stopTimePos:h,stopDpq:e,transpose:g.copy(b),updateKeys:!0,checkLine:!1,updateHarmonies:!0,preserveTies:!0},j=new p(this.scoreData,i,this.cancelStack),k={action:j,
error:null};this.transposeActions.push(k)},t.getSetClefActions=function(){return null===this.setClefActions&&this.initSetClefActions(),this.setClefActions},t.initSetClefActions=function(){var a=this.scoreData.getPartContent(this.opts.partIdx),b=e.getNbStaves(a),c=e.getMeasures(a),d=this.getNbMeasures(),f=this.opts.clefs;if(this.setClefActions=[],f.length>0)for(var g=0;g<b;g++)if(this.hasMeasuresDifferentClefs(c,g)){var h={partIdx:this.opts.partIdx,startMeasureIdx:0,stopMeasureIdx:d-1,staffIdx:g,clef:f.length<=g?f[f.length-1]:f[g]},i=new q(this.scoreData,h,this.cancelStack);this.setClefActions.push(i)}},t.getRelativeTranspose=function(){var a=this.scoreData.getMeasure(this.opts.partIdx,0),b=f.getWrappedTranspose(a),c=b.getAnyEntry(),d=g.getDiff(this.opts.transpose,c);return g.getReverse(d)},t.getVoicesIndexes=function(){return this.scoreData.getPartVoicesIndexes(this.opts.partIdx)},t.getNbMeasures=function(){return this.scoreData.getPartContent(this.opts.partIdx).measure.length},t.transpose=function(){this.getTransposeActions().forEach(function(a){null===a.error&&(a.action.cancelStack=this.cancelStack,a.action.perform())},this)},t.setClef=function(){this.getSetClefActions().forEach(function(a){a.perform()})},t.updateInstrument=function(){var a,b=this.scoreData.getPartsHeaders(),c=b[this.opts.partIdx];a=void 0!==this.opts.partName?this.opts.partName:this.opts.instrumentName,j.setName(c,a),void 0!==this.opts.abbreviation?j.setAbbreviation(c,this.opts.abbreviation):j.removeAbbreviation(c);var d=i.create(this.opts.instrumentName),e={};h.setMIDIProgram(e,this.opts.MIDIProgram),j.setInstrument(c,d,e),j.initInstrumentsIds(c)},t.updateTranspose=function(){var a=this.scoreData.getPartContent(this.opts.partIdx),b=a.measure,c=b[0];this.updateFirstMeasureTranspose(c),b.slice(1).forEach(this.updateOtherMeasureTranspose,this)},t.hasMeasuresDifferentClefs=function(a,b){return a.some(function(a){var c=this.getClefInMeasure(a,b),d=this.opts.clefs,e=d.length<=b?d[d.length-1]:d[b];return!k.isSame(c,e)},this)},t.getClefInMeasure=function(a,b){return f.getWrappedClef(a).getEntry(b)},t.updateFirstMeasureTranspose=function(a){for(var b=f.getNbStaves(a),c=f.getWrappedOwnTranspose(a),d=0;d<b;d++)c.setEntry(g.copy(this.opts.transpose),d);var e=c.dumpAttribute();f.setOwnTranspose(a,e),this.updateOtherMeasureTranspose(a)},t.updateOtherMeasureTranspose=function(a){for(var b=f.getNbStaves(a),c=f.getWrappedTranspose(a),d=0;d<b;d++)c.setEntry(g.copy(this.opts.transpose),d);var e=c.dumpAttribute();f.setTranspose(a,e)},t.updateStaffDetails=function(){this.getSetStaffDetailsActions().forEach(function(a){a.perform()})},t.updateStack=function(a){var b=this.scoreData.getPartUuid(this.opts.partIdx),c={type:this.name,noDraw:!0,opts:{partUuid:b,instrumentName:a.instrumentName,MIDIProgram:a.MIDIProgram,partName:a.partName,abbreviation:a.abbreviation,transpose:g.copy(a.transpose)}};this.cancelStack.push(c),this.cancelStack.stateNeedCompleteRedraw()}}.call(this),function(){"use strict";var a=Adagio.Error.client.MissingOptionError,b=Adagio.Utils.partHeaderUtils,c=Adagio.edit.common.convertPartUuidToGetPartIdx,d=Adagio.edit.action.ChangePartName=function(a,b,c){this.init(a,b,c)};d.NAME="action.ChangePartName";var e=d.prototype;e.name=d.NAME,e.init=function(a,b,d){this.scoreData=a,this.cancelStack=d,this.opts=b,c(this.scoreData,this.opts)},e.checkPreconditions=function(){if(this.scoreData.checkPartIdx(this.opts.partIdx),"string"!=typeof this.opts.partName)throw new a("partName");if("string"!=typeof this.opts.partAbbreviation&&null!==this.opts.partAbbreviation)throw new a("partAbbreviation")},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a=this.getPreviousData();this.storeAction(),this.changePartName(),this.updateStack(a)},e.getPreviousData=function(){var a=this.scoreData.getPartHeader(this.opts.partIdx),c={};return c.partName=b.getName(a),b.hasAbbreviation(a)?c.abbreviation=b.getAbbreviation(a):c.abbreviation=null,c},e.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.scoreData.getPartUuid(this.opts.partIdx),b={actionName:this.name,opts:{partUuid:a,partName:this.opts.partName,partAbbreviation:this.opts.partAbbreviation}};this.cancelStack.storeAction(b)}},e.changePartName=function(){var a=this.scoreData.getPartHeader(this.opts.partIdx);b.setName(a,this.opts.partName),null!==this.opts.partAbbreviation?b.setAbbreviation(a,this.opts.partAbbreviation):b.removeAbbreviation(a)},e.updateStack=function(a){var b=this.scoreData.getPartUuid(this.opts.partIdx),c={partUuid:b,previousName:a.partName,previousAbbreviation:a.abbreviation},d={type:this.name,opts:c};this.cancelStack.push(d),this.cancelStack.stateNeedCompleteRedraw()}}.call(this),function(){"use strict";var a=Adagio.edit.action.AddToChordPercu,b=Adagio.edit.action.RemoveFromChordPercu,c=Adagio.Utils.unpitchedUtils,d=Adagio.edit.common.initMeasureData,e=Adagio.edit.common.convertPartUuidToGetPartIdx,f=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,g=Adagio.edit.common.convertTimePosToGetNoteIdx,h=Adagio.edit.common.getDefaultMIDIHead,i=Adagio.edit.action.ChangePitchPercu=function(a,b,c){this.init(a,b,c)};i.NAME="action.ChangePitchPercu",i.copyAddOpts=function(a){var b={partIdx:a.partIdx,measureIdx:a.measureIdx,noteIdx:a.noteIdx,voiceIdx:a.voiceIdx,staffIdx:a.staffIdx,notehead:a.notehead};return void 0!==a.toLine?b.line=a.toLine:void 0!==a.toUnpitched&&(b.unpitched=c.copy(a.toUnpitched)),b},i.copyRemoveOpts=function(a){var b={partIdx:a.partIdx,measureIdx:a.measureIdx,noteIdx:a.noteIdx,staffIdx:a.staffIdx,voiceIdx:a.voiceIdx};return void 0!==a.fromLine?b.line=a.fromLine:void 0!==a.fromUnpitched&&(b.unpitched=c.copy(a.fromUnpitched)),b};var j=i.prototype;j.name=i.NAME,j.initMeasureData=d,j.init=function(a,b,c){e(a,b),f(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.addAction=null,this.removeAction=null,this.location=null,g(this.measureData,this.opts)},j.checkPreconditions=function(){this.getAddAction().checkPreconditions(),this.getRemoveAction().checkPitch()},j.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.getActions().forEach(this.callPerform,this)},j.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b=this.getRemoveAction(),d=c.copy(b.opts.unpitched),e=this.getAddAction(),f=c.copy(e.opts.unpitched),g=this.opts.notehead;void 0===this.opts.notehead&&(g=h(this.measureData,this.opts.partIdx,f));var i={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,divisions:a.dpq,timePos:a.timePos,fromUnpitched:d,toUnpitched:f,notehead:g}};this.cancelStack.storeAction(i)}},j.callPerform=function(a){a.cancelStack=this.cancelStack,a.perform()},j.getActions=function(){return[this.getAddAction(),this.getRemoveAction()]},j.getAddAction=function(){if(null===this.addAction){var b=i.copyAddOpts(this.opts);this.addAction=new a(this.measureData,b,this.cancelStack)}return this.addAction},j.getRemoveAction=function(){if(null===this.removeAction){var a=i.copyRemoveOpts(this.opts);this.removeAction=new b(this.measureData,a,this.cancelStack)}return this.removeAction},j.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.value.DoesntHaveTechnicalError,b=Adagio.edit.common.initMeasureData,c=Adagio.edit.common.convertPartUuidToGetPartIdx,d=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,e=Adagio.edit.common.checkCompatibleVoiceStaffIdx,f=Adagio.edit.common.convertFretToPitch,g=Adagio.edit.common.convertTimePosToGetNoteIdx,h=Adagio.edit.common.convertExistingFretToPitch,i=Adagio.edit.common.checkTabPart,j=Adagio.Utils.clone,k=Adagio.Utils.pitchUtils,l=Adagio.edit.action.AddAccidental,m=Adagio.edit.action.ChangePitch,n=Adagio.edit.action.ChangeFret=function(a,b,c){this.init(a,b,c)};n.NAME="action.ChangeFret";var o=n.prototype;o.name=n.NAME,o.initMeasureData=b,o.init=function(a,b,e){c(a,b),d(a,b),this.initMeasureData(a,b),this.cancelStack=e,this.opts=b,this.location=null,this.action=null,g(this.measureData,this.opts)},o.checkPreconditions=function(){this.checkVoiceIdx(),this.checkCompatibleVoiceStaffIdx(),this.checkNoteIdx(),this.checkValues(),this.checkTabPart(),this.getAction().checkPreconditions()},o.checkVoiceIdx=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx)},o.checkCompatibleVoiceStaffIdx=function(){e(this.measureData,this.opts)},o.checkNoteIdx=function(){this.measureData.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},o.checkValues=function(){if(void 0===this.opts.fromFretData)throw new a("fromFretData");if(void 0===this.opts.toFretData)throw new a("toFretData")},o.checkTabPart=function(){i(this.measureData,this.opts)},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a=this.getAction();a.cancelStack=this.cancelStack,a.perform()},o.getAction=function(){return null===this.action&&this.createAction(),this.action},o.createAction=function(){var a=this.getToPitch(),b=this.getFromPitch();k.isSameLine(a,b)?this.createAddAccidental(a):this.createChangePitch(b,a)},o.getToPitch=function(){var a=j(this.opts);return a.fretData=this.opts.toFretData,f(this.measureData,a),a.pitch},o.getFromPitch=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,noteIdx:this.opts.noteIdx,voiceIdx:this.opts.voiceIdx,fretData:j(this.opts.fromFretData)};return h(this.measureData,a)},o.createAddAccidental=function(a){var b=k.getAlter(a),c=k.alterToAccidental(b);a=k.copyWithoutAlter(a);var d=j(this.opts.toFretData),e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:a,fretData:d,accidental:c};this.action=new l(this.measureData,e,null)},o.createChangePitch=function(a,b){var c=k.getAlter(b),d=k.alterToAccidental(c),e=j(this.opts.toFretData),f={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,fromPitch:k.copyWithoutAlter(a),toPitch:k.copyWithoutAlter(b),fretData:e,accidental:d};this.action=new m(this.measureData,f,null)}}.call(this),function(){"use strict";var a=Adagio.Utils.partContentUtils,b=Adagio.Utils.measureUtils,c=Adagio.Utils.noteUtils,d=Adagio.Utils.math,e=Adagio.Utils.direction.pedalDirectionUtils,f=Adagio.edit.common.MeasuresScroller,g=Adagio.edit.common.checkCompatibleVoiceStaffIdx,h=Adagio.edit.common.searchPedalSides,i=Adagio.edit.action.RemovePedalAtTimePos,j=Adagio.edit.action.AddPedal,k=Adagio.Error.client.BadPedalIdxError,l=Adagio.edit.action.ChangePedal=function(a,b,c){this.init(a,b,c)};l.NAME="action.ChangePedal";var m=l.prototype;m.name=l.NAME,m.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.measuresScroller=null,this.removeAction=null,this.addAction=null,this.previousData=null,this.sanitized=!1},m.checkPreconditions=function(){this.checkLocation(),this.sanitizeIfNeeded(),this.getRemoveAction().checkPreconditions()},m.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx),this.getMeasureData().checkVoiceIdx(this.opts.voiceIdx),g(this.scoreData,this.opts),this.scoreData.checkMeasureIdx(this.opts.startMeasureIdx),this.scoreData.checkMeasureIdx(this.opts.stopMeasureIdx),this.getStartMeasureData().checkVoiceIdx(this.opts.voiceIdx),this.getStartVoice().checkNoteIdx(this.opts.startNoteIdx),this.getStopMeasureData().checkVoiceIdx(this.opts.voiceIdx),this.getStopVoice().checkNoteIdx(this.opts.stopNoteIdx)},m.sanitizeIfNeeded=function(){if(!this.sanitized){if(void 0!==this.opts.pedalIdx){var a=this.getMeasure(),b=this.getPedals(a);if(!d.isInteger(this.opts.pedalIdx)||this.opts.pedalIdx<0||this.opts.pedalIdx>=b.length)throw new k(this.opts.pedalIdx);var c=b[this.opts.pedalIdx];this.timePos=e.getTimePos(c)}if(void 0!==this.opts.noteIdx){var f=this.getVoice();f.checkNoteIdx(this.opts.noteIdx),this.timePos=n(f,this.opts.noteIdx)}this.sanitized=!0}};var n=function(a,b){for(var d=0,e=0;e<b;e++){var f=a.getNote(e);d+=c.getDuration(f)}return d};m.getVoice=function(){return this.getMeasureData().getVoice(this.opts.voiceIdx)},m.getStartVoice=function(){return this.getStartMeasureData().getVoice(this.opts.voiceIdx)},m.getStopVoice=function(){return this.getStopMeasureData().getVoice(this.opts.voiceIdx)},m.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},m.getPedals=function(a){return b.getPedals(a,this.opts.staffIdx)},m.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a=this.getPreviousData();this.getRemoveAction().perform();var b=this.getAddAction(a);b.checkPreconditions(),b.perform()},m.getRemoveAction=function(){if(null===this.removeAction){var a=this.getMeasureData(),b=a.getDpqValue(),c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,timePos:this.timePos,dpq:b};this.removeAction=new i(this.scoreData,c,this.cancelStack)}return this.removeAction},m.getAddAction=function(a){if(null===this.addAction){var b={partIdx:this.opts.partIdx,voiceIdx:this.opts.voiceIdx,startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,startNoteIdx:this.opts.startNoteIdx,stopNoteIdx:this.opts.stopNoteIdx,placement:a.placement,staffIdx:this.opts.staffIdx};this.addAction=new j(this.scoreData,b,this.cancelStack)}return this.addAction},m.getPreviousData=function(){if(null===this.previousData){var b=this.timePos,c=this.scoreData.getPartContent(this.opts.partIdx),d=a.getMeasures(c),e=h(d,this.opts.measureIdx,this.opts.staffIdx,b);this.previousData={startMeasureIdx:e.startMeasureIdx,startTimePos:e.startTimePos,stopTimePos:e.stopTimePos,stopMeasureIdx:e.stopMeasureIdx,placement:e.placement}}return this.previousData},m.getMeasureData=function(){return this.getMeasuresScroller().getMeasureData(this.opts.measureIdx)},m.getStartMeasureData=function(){return this.getMeasuresScroller().getMeasureData(this.opts.startMeasureIdx)},m.getStopMeasureData=function(){return this.getMeasuresScroller().getMeasureData(this.opts.stopMeasureIdx)},m.getMeasuresScroller=function(){if(null===this.measuresScroller){var b=this.opts.partIdx,c=this.scoreData.getPartContent(b),d=a.getMeasures(c);this.measuresScroller=new f(d,b,this.scoreData)}return this.measuresScroller}}.call(this),function(){"use strict";var a=Adagio.Utils.partContentUtils,b=Adagio.Utils.noteUtils,c=Adagio.Utils.math,d=Adagio.Utils.direction.tempoChangeDirectionUtils,e=Adagio.edit.common.MeasuresScroller,f=Adagio.edit.common.searchTempoChangeSides,g=Adagio.edit.action.RemoveTempoChangeAtTimePos,h=Adagio.edit.action.AddTempoChange,i=Adagio.Error.client.BadTempoChangeIdxError,j=Adagio.edit.action.ChangeTempoChange=function(a,b,c){this.init(a,b,c)};j.NAME="action.ChangeTempoChange";var k=j.prototype;k.name=j.NAME,k.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.measuresScroller=null,this.removeAction=null,this.addAction=null,this.previousData=null,this.sanitized=!1},k.checkPreconditions=function(){this.checkLocation(),this.sanitizeIfNeeded(),this.getRemoveAction().checkPreconditions()},k.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx),this.getMeasureData().checkVoiceIdx(this.opts.voiceIdx),this.scoreData.checkMeasureIdx(this.opts.startMeasureIdx),this.scoreData.checkMeasureIdx(this.opts.stopMeasureIdx),this.getStartMeasureData().checkVoiceIdx(this.opts.voiceIdx),this.getStartVoice().checkNoteIdx(this.opts.startNoteIdx),this.getStopMeasureData().checkVoiceIdx(this.opts.voiceIdx),this.getStopVoice().checkNoteIdx(this.opts.stopNoteIdx)},k.sanitizeIfNeeded=function(){if(!this.sanitized){if(void 0!==this.opts.tempoChangeIdx){var a=this.getTempoChanges();if(!c.isInteger(this.opts.tempoChangeIdx)||this.opts.tempoChangeIdx<0||this.opts.tempoChangeIdx>=a.length)throw new i(this.opts.tempoChangeIdx);var b=a[this.opts.tempoChangeIdx];this.timePos=d.getTimePos(b),this.dpq=d.getDpq(b)}if(void 0!==this.opts.noteIdx){var e=this.getVoice();e.checkNoteIdx(this.opts.noteIdx),this.timePos=l(e,this.opts.noteIdx),this.dpq=this.getDpq()}this.sanitized=!0}};var l=function(a,c){for(var d=0,e=0;e<c;e++){var f=a.getNote(e);d+=b.getDuration(f)}return d};k.getDpq=function(){return this.getMeasureData().getDpqValue()},k.getVoice=function(){return this.getMeasureData().getVoice(this.opts.voiceIdx)},k.getStartVoice=function(){return this.getStartMeasureData().getVoice(this.opts.voiceIdx)},k.getStopVoice=function(){return this.getStopMeasureData().getVoice(this.opts.voiceIdx)},k.getTempoChanges=function(){return this.getCommonContent().getTempoChanges(this.opts.measureIdx)},k.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a=this.getPreviousData();this.getRemoveAction().perform();var b=this.getAddAction(a);b.checkPreconditions(),b.perform()},k.getRemoveAction=function(){if(null===this.removeAction){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:this.timePos,dpq:this.dpq};this.removeAction=new g(this.scoreData,a,this.cancelStack)}return this.removeAction},k.getAddAction=function(a){if(null===this.addAction){var b={partIdx:this.opts.partIdx,voiceIdx:this.opts.voiceIdx,startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,startNoteIdx:this.opts.startNoteIdx,stopNoteIdx:this.opts.stopNoteIdx,type:a.type};this.addAction=new h(this.scoreData,b,this.cancelStack)}return this.addAction},k.getPreviousData=function(){if(null===this.previousData){var a=this.timePos,b=this.dpq,c=this.getCommonContent(),d=f(c,this.opts.measureIdx,a,b);this.previousData={startMeasureIdx:d.startMeasureIdx,startTimePos:d.startTimePos,stopTimePos:d.stopTimePos,stopMeasureIdx:d.stopMeasureIdx,type:d.type}}return this.previousData},k.getCommonContent=function(){return this.scoreData.getCommonContent()},k.getMeasureData=function(){return this.getMeasuresScroller().getMeasureData(this.opts.measureIdx)},k.getStartMeasureData=function(){return this.getMeasuresScroller().getMeasureData(this.opts.startMeasureIdx)},k.getStopMeasureData=function(){return this.getMeasuresScroller().getMeasureData(this.opts.stopMeasureIdx)},k.getMeasuresScroller=function(){if(null===this.measuresScroller){var b=this.opts.partIdx,c=this.scoreData.getPartContent(this.opts.partIdx),d=a.getMeasures(c);this.measuresScroller=new e(d,b,this.scoreData)}return this.measuresScroller}}.call(this),function(){"use strict";var a=Adagio.Utils.math,b=Adagio.edit.common.timePosToFloorNoteIdx;Adagio.edit.common.convertTimePosToFloorNoteIdx=function(c,d){var e=c.getDivisions().getDivisions(),f=a.lcm(e,d.divisions),g=f/e,h=f/d.divisions;d.timePos*=h;var i=c.getVoice(d.voiceIdx),j=b(i,g,d.timePos);d.noteIdx=j,delete d.timePos,delete d.divisions}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Error.client.ClientError,c=Adagio.Error.value.ValueError,d=Adagio.Error.noChange.NoChangeError,e=Adagio.Utils.noteUtils,f=Adagio.edit.action.RemoveTuplet,g=Adagio.edit.common.convertTimePosToFloorNoteIdx,h=Adagio.edit.common.initMeasureData,i=Adagio.edit.composite.RemoveVoiceTupletsAfter=function(a,b,c){this.init(a,b,c)};i.NAME="composite.RemoveVoiceTupletsAfter";var j=i.prototype;j.initMeasureData=h,j.name=i.NAME,j.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},j.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),g(this.measureData,this.opts),this.removeTuplets()},j.removeTuplets=function(){for(var a=this.getVoice(),b=a.getStopNoteIdx();b>=this.opts.noteIdx;){var c=a.getNote(b);if(e.hasTupletStop(c)){b-=this.removeTuplet(b)}else b--}},j.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},j.removeTuplet=function(a){var b=this.getTuplet(a),c=b.size(),d=b.getStopNoteIdx();return this.strictRemoveTuplet(d),this.clearTupletCache(),c},j.getTuplet=function(a){var b=this.opts.voiceIdx;return this.measureData.getVoiceOrTupletForGet(b,a)},j.strictRemoveTuplet=function(e){var g={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:e},h=new f(this.measureData,g,this.cancelStack);try{h.checkPreconditions(),h.perform()}catch(e){if(e instanceof b||e instanceof c||e instanceof d){var i="An action has failed while performing a [RemoveVoiceTupletsAfter]. The score should be still consistent. Here is the error message: "+e.message,j=new a("UnexpectedError",i);throw j.parent=e,j}throw e}},j.clearTupletCache=function(){this.measureData.clearTupletCache(this.opts.voiceIdx)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.noteUtils,c=Adagio.Utils.typeUtils,d=Adagio.Utils.pitchUtils,e=Adagio.Utils.unpitchedUtils,f=Adagio.edit.values.InsertMode,g=Adagio.edit.action.RemoveNote,h=Adagio.edit.action.RemoveNotePercu,i=Adagio.edit.composite.UnlockRest,j=Adagio.edit.common.convertTimePosToFloorNoteIdx,k=Adagio.edit.common.initMeasureData,l=Adagio.edit.common.assertPerform,m=Adagio.edit.composite.RemoveVoiceNotesAfter=function(a,b,c){this.init(a,b,c)};m.NAME="composite.RemoveVoiceNotesAfter";var n=m.prototype;n.initMeasureData=k,n.name=m.NAME,n.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},n.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),j(this.measureData,this.opts),this.removeNotes()},n.removeNotes=function(){for(var a=this.getVoice(),b=a.getStopNoteIdx(),c=b;c>=this.opts.noteIdx;c--)a.isRest(c)?this.unlockRest(c):this.removeChord(c)},n.removeChord=function(a){var b=this.getVoice(),d=b.getChord(a);d=c.makeArray(d).slice(),this.noteIdx=a,d.forEach(this.removeChordHead,this)},n.removeChordHead=function(c){if(b.hasPitch(c)){var d=b.getPitch(c);this.removePitched(d)}else{if(!b.hasUnpitched(c)){throw new a("Unexpected","Cannot have a note neither pitched nor unpitched.")}var e=b.getUnpitched(c);this.removeUnpitched(e)}},n.removePitched=function(a){a=d.copy(a);var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.noteIdx,pitch:a,insertMode:f.REPLACE},c=new g(this.measureData,b,this.cancelStack);l(c)},n.removeUnpitched=function(a){a=e.copy(a);var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.noteIdx,unpitched:a,insertMode:f.REPLACE},c=new h(this.measureData,b,this.cancelStack);l(c)},n.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},n.unlockRest=function(a){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:a};new i(this.measureData,b,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.directionUtils,c=Adagio.Utils.wedgeUtils,d=Adagio.Values.WedgeLocation,e=Adagio.edit.action.RemoveWedgeAtTimePos,f=Adagio.edit.common.optsToLocalGetTimePos,g=Adagio.edit.composite.RemoveWedgesFrom=function(a,b,c){this.init(a,b,c)};g.NAME="composite.RemoveWedgesFrom";var h=g.prototype;h.name=g.NAME,h.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.measure=null,this.limitTimePos=null},h.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeWedgesFrom()},h.removeWedgesFrom=function(){this.getWedgesStarts().forEach(this.removeWedge,this),this.getWedgesStops().forEach(this.removeWedge,this)},h.getWedgesStarts=function(){var a=this.getWedges();return a=a.filter(i)};var i=function(a){return b.getWedges(a).some(j)},j=function(a){return c.getLocation(a)===d.LEFT};h.getWedgesStops=function(){var a=this.getWedges();return a=a.filter(k)};var k=function(a){return b.getWedges(a).some(l)},l=function(a){return c.getLocation(a)===d.RIGHT};h.getWedges=function(){var c=this.getMeasure(),d=a.getWedgeDirections(c);return d=d.filter(this.isGoodStaff,this),d=d.filter(b.hasWedge),d=d.filter(this.isBeyoudLimit,this)},h.isGoodStaff=function(a){return b.getStaffIdx(a)===this.opts.staffIdx},h.isBeyoudLimit=function(a){var c=this.getLimitTimePos();return b.getTimePos(a)>=c},h.getLimitTimePos=function(){if(null===this.limitTimePos){var a=this.getMeasure();this.limitTimePos=f(this.opts,a)}return this.limitTimePos},h.removeWedge=function(c){var d=b.getTimePos(c),f=b.getStaffIdx(c),g=this.getMeasure(),h=a.getDpq(g),i={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:d,dpq:h,staffIdx:f};new e(this.scoreData,i,this.cancelStack).perform()},h.getMeasure=function(){return null===this.measure&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.direction.pedalDirectionUtils,c=Adagio.Values.PedalType,d=Adagio.edit.action.RemovePedalAtTimePos,e=Adagio.edit.common.optsToLocalGetTimePos,f=Adagio.edit.composite.RemovePedalsFrom=function(a,b,c){this.init(a,b,c)};f.NAME="composite.RemovePedalsFrom";var g=f.prototype;g.name=f.NAME,g.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.measure=null,this.limitTimePos=null},g.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removePedalsFrom()},g.removePedalsFrom=function(){this.getPedalsStarts().forEach(this.removePedal,this),this.getPedalsStops().forEach(this.removePedal,this)},g.getPedalsStarts=function(){var a=this.getPedals();return a=a.filter(h)};var h=function(a){return b.getType(a)===c.START};g.getPedalsStops=function(){var a=this.getPedals();return a=a.filter(i)};var i=function(a){return b.getType(a)===c.STOP};g.getPedals=function(){var b=this.getMeasure(),c=a.getPedals(b,this.opts.staffIdx);return c=c.filter(this.isBeyoudLimit,this)},g.isBeyoudLimit=function(a){var c=this.getLimitTimePos();return b.getTimePos(a)>=c},g.getLimitTimePos=function(){if(null===this.limitTimePos){var a=this.getMeasure();this.limitTimePos=e(this.opts,a)}return this.limitTimePos},g.removePedal=function(c){var e=b.getTimePos(c),f=b.getStaffIdx(c),g=this.getMeasure(),h=a.getDpq(g),i={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:e,dpq:h,staffIdx:f};new d(this.scoreData,i,this.cancelStack).perform()},g.getMeasure=function(){return null===this.measure&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.direction.dynamicDirectionUtils,c=Adagio.edit.action.RemoveDynamicAtTimePos,d=Adagio.edit.common.optsToLocalGetTimePos,e=Adagio.edit.composite.RemoveDynamicsFrom=function(a,b,c){this.init(a,b,c)};e.NAME="composite.RemoveDynamicsFrom";var f=e.prototype;f.name=e.NAME,f.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.measure=null,this.limitTimePos=null},f.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeDynamicsFrom()},f.removeDynamicsFrom=function(){var b=this.getMeasure(),c=a.getDynamics(b,this.opts.staffIdx);c=c.filter(this.isBeyoudLimit,this),c.forEach(this.removeDynamic,this)},f.isBeyoudLimit=function(a){var c=this.getLimitTimePos();return b.getTimePos(a)>=c},f.getLimitTimePos=function(){if(null===this.limitTimePos){var a=this.getMeasure();this.limitTimePos=d(this.opts,a)}return this.limitTimePos},f.removeDynamic=function(d){var e=b.getTimePos(d),f=this.getMeasure(),g=a.getDpq(f),h={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,timePos:e,dpq:g};new c(this.scoreData,h,this.cancelStack).perform()},f.getMeasure=function(){return null===this.measure&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.direction.pizzicatoDirectionUtils,c=Adagio.edit.action.RemovePizzicatoAtTimePos,d=Adagio.edit.common.optsToLocalGetTimePos,e=Adagio.edit.composite.RemovePizzicatosFrom=function(a,b,c){this.init(a,b,c)};e.NAME="composite.RemovePizzicatosFrom";var f=e.prototype;f.name=e.NAME,f.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.measure=null,this.limitTimePos=null},f.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removePizzicatosFrom()},f.removePizzicatosFrom=function(){var b=this.getMeasure(),c=a.getPizzicatos(b,this.opts.staffIdx);c=c.filter(this.isBeyoudLimit,this),c.forEach(this.removePizzicato,this)},f.isBeyoudLimit=function(a){var c=this.getLimitTimePos();return b.getTimePos(a)>=c},f.getLimitTimePos=function(){if(null===this.limitTimePos){var a=this.getMeasure();this.limitTimePos=d(this.opts,a)}return this.limitTimePos},f.removePizzicato=function(d){var e=b.getTimePos(d),f=this.getMeasure(),g=a.getDpq(f),h={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,timePos:e,dpq:g};new c(this.scoreData,h,this.cancelStack).perform()},f.getMeasure=function(){return null===this.measure&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.direction.pizzicatoDirectionUtils,c=Adagio.edit.action.RemoveWordAtTimePos,d=Adagio.edit.common.optsToLocalGetTimePos,e=Adagio.edit.composite.RemoveWordsFrom=function(a,b,c){this.init(a,b,c)};e.NAME="composite.RemoveWordsFrom";var f=e.prototype;f.name=e.NAME,f.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.measure=null,this.limitTimePos=null},f.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeWordsFrom()},f.removeWordsFrom=function(){var b=this.getMeasure(),c=a.getWords(b,this.opts.staffIdx);c=c.filter(this.isBeyoudLimit,this),c.forEach(this.removeWord,this)},f.isBeyoudLimit=function(a){var c=this.getLimitTimePos();return b.getTimePos(a)>=c},f.getLimitTimePos=function(){if(null===this.limitTimePos){var a=this.getMeasure();this.limitTimePos=d(this.opts,a)}return this.limitTimePos},f.removeWord=function(d){var e=b.getTimePos(d),f=this.getMeasure(),g=a.getDpq(f),h={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,timePos:e,dpq:g};new c(this.scoreData,h,this.cancelStack).perform()},f.getMeasure=function(){return null===this.measure&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.direction.octaveShiftDirectionUtils,c=Adagio.Values.OctaveShiftType,d=Adagio.edit.action.RemoveOctaveShiftAtTimePos,e=Adagio.edit.common.optsToLocalGetTimePos,f=Adagio.edit.composite.RemoveOctaveShiftsFrom=function(a,b,c){this.init(a,b,c)};f.NAME="composite.RemoveOctaveShiftsFrom";var g=f.prototype;g.name=f.NAME,g.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.measure=null,this.limitTimePos=null},g.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeOctaveShiftsFrom()},g.removeOctaveShiftsFrom=function(){this.getOctaveShiftsStarts().forEach(this.removeOctaveShift,this),this.getOctaveShiftsStops().forEach(this.removeOctaveShift,this)},g.getOctaveShiftsStarts=function(){var a=this.getOctaveShifts();return a=a.filter(h)};var h=function(a){var d=b.getType(a);return d===c.UP||d===c.DOWN};g.getOctaveShiftsStops=function(){var a=this.getOctaveShifts();return a=a.filter(i)};var i=function(a){return b.getType(a)===c.STOP};g.getOctaveShifts=function(){var b=this.getMeasure(),c=a.getOctaveShifts(b,this.opts.staffIdx)
;return c=c.filter(this.isBeyoudLimit,this)},g.isBeyoudLimit=function(a){var c=this.getLimitTimePos();return b.getTimePos(a)>=c},g.getLimitTimePos=function(){if(null===this.limitTimePos){var a=this.getMeasure();this.limitTimePos=e(this.opts,a)}return this.limitTimePos},g.removeOctaveShift=function(c){var e=b.getTimePos(c),f=b.getStaffIdx(c),g=this.getMeasure(),h=a.getDpq(g),i={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:e,dpq:h,staffIdx:f};new d(this.scoreData,i,this.cancelStack).perform()},g.getMeasure=function(){return null===this.measure&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure}}.call(this),function(){"use strict";var a=Adagio.edit.composite.RemoveWedgesFrom,b=Adagio.edit.composite.RemovePedalsFrom,c=Adagio.edit.composite.RemoveDynamicsFrom,d=Adagio.edit.composite.RemovePizzicatosFrom,e=Adagio.edit.composite.RemoveWordsFrom,f=Adagio.edit.composite.RemoveOctaveShiftsFrom,g=Adagio.edit.composite.ClearMeasureStaffFloatings=function(a,b,c){this.init(a,b,c)};g.NAME="composite.ClearMeasureStaffFloatings";var h=g.prototype;h.name=g.NAME,h.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},h.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.clearDynamics(),this.clearPizzicatos(),this.clearWords(),this.clearWedges(),this.clearPedals(),this.clearOctaveShifts()},h.clearPizzicatos=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,timePos:0,dpq:1};new d(this.scoreData,a,this.cancelStack).perform()},h.clearWords=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,timePos:0,dpq:1};new e(this.scoreData,a,this.cancelStack).perform()},h.clearDynamics=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,timePos:0,dpq:1};new c(this.scoreData,a,this.cancelStack).perform()},h.clearWedges=function(){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,timePos:0,dpq:1};new a(this.scoreData,b,this.cancelStack).perform()},h.clearPedals=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,timePos:0,dpq:1};new b(this.scoreData,a,this.cancelStack).perform()},h.clearOctaveShifts=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,timePos:0,dpq:1};new f(this.scoreData,a,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.edit.action.RemoveSlur,c=Adagio.edit.common.initMeasureData,d=Adagio.edit.composite.RemoveVoiceSlurs=function(a,b,c){this.init(a,b,c)};d.NAME="composite.RemoveVoiceSlurs";var e=d.prototype;e.name=d.NAME,e.initMeasureData=c,e.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeVoiceSlurs()},e.removeVoiceSlurs=function(){for(var b=this.measureData.getVoice(this.opts.voiceIdx),c=b.size(),d=0;d<c;d++){var e=b.getNote(d);a.hasSlur(e)&&this.removeSlur(d)}},e.removeSlur=function(a){var c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:a};new b(this.measureData,c,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.edit.composite.RemoveVoiceTupletsAfter,b=Adagio.edit.composite.RemoveVoiceNotesAfter,c=Adagio.edit.composite.ClearMeasureStaffFloatings,d=Adagio.edit.composite.RemoveVoiceSlurs,e=Adagio.edit.common.initMeasureData,f=Adagio.edit.composite.ClearVoice=function(a,b,c){this.init(a,b,c)};f.NAME="composite.ClearVoice";var g=f.prototype;g.initMeasureData=e,g.name=f.NAME,g.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},g.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeVoiceSlurs(),this.clearTuplets(),this.clearChords(),this.opts.removeFloating&&this.clearFloating()},g.removeVoiceSlurs=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx};new d(this.measureData,a,this.cancelStack).perform()},g.clearTuplets=function(){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,timePos:0,divisions:1};new a(this.measureData,b,this.cancelStack).perform()},g.clearChords=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,timePos:0,divisions:1};new b(this.measureData,a,this.cancelStack).perform()},g.clearFloating=function(){var a=this.measureData.getScoreData(),b=a.getPartVoiceMainStaffIdx(this.opts.partIdx,this.opts.voiceIdx),d={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:b};new c(a,d,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.edit.composite.ClearVoice,b=Adagio.edit.common.initMeasureData,c=Adagio.edit.common.convertPartUuidToGetPartIdx,d=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,e=Adagio.edit.action.ClearVoice=function(a,b,c){this.init(a,b,c)};e.NAME="action.ClearVoice";var f=e.prototype;f.name=e.NAME,f.initMeasureData=b,f.init=function(a,b,e){c(a,b),d(a,b),this.initMeasureData(a,b),this.cancelStack=e,this.opts=b},f.checkPreconditions=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx)},f.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),void 0===this.opts.removeFloating&&(this.opts.removeFloating=!0),this.storeAction();var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,removeFloating:this.opts.removeFloating};new a(this.measureData,b,this.cancelStack).perform()},f.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.measureData.getScoreData(),b={actionName:this.name,opts:{partUuid:a.getPartUuid(this.opts.partIdx),measureUuid:a.getMeasureUuid(this.opts.measureIdx),voiceIdx:this.opts.voiceIdx,removeFloating:this.opts.removeFloating}};this.cancelStack.storeAction(b)}}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadMeasureIdxError,b=Adagio.Error.client.BadVoiceError,c=Adagio.Error.client.RevertRangeError,d=Adagio.edit.action.ClearVoice,e=Adagio.edit.common.convertPartUuidToGetPartIdx,f=Adagio.edit.common.convertMeasuresUuidsToMeasuresIdxs,g=Adagio.Utils.math,h=Adagio.edit.action.ClearMeasuresVoice=function(a,b,c){this.init(a,b,c)};h.NAME="action.ClearMeasuresVoice";var i=h.prototype;i.name=h.NAME,i.init=function(a,b,c){f(a,b),e(a,b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.location=null},i.checkPreconditions=function(){if(!this.scoreData.hasPartVoiceIdx(this.opts.partIdx,this.opts.voiceIdx))throw new b(this.opts.voiceIdx);this.checkMeasureIdx(this.opts.startMeasureIdx),this.checkMeasureIdx(this.opts.stopMeasureIdx);var a=this.opts.startMeasureIdx,d=this.opts.stopMeasureIdx;if(d-a<0)throw new c(c.MEASURE,a,d)},i.checkMeasureIdx=function(b){var c=this.scoreData.getNbMeasures();if(!g.isInteger(b)||b<0||b>=c)throw new a(b,a.GET)},i.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.clearMeasuresVoice()},i.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b=a.measureUuids.slice(),c={actionName:this.name,opts:{partUuid:a.partUuid,measureUuids:b,voiceIdx:this.opts.voiceIdx}};this.cancelStack.storeAction(c)}},i.getLocation=function(){if(null===this.location){var a=this.scoreData.getMeasureUuids(this.opts.startMeasureIdx,this.opts.stopMeasureIdx),b=this.scoreData.getPartUuid(this.opts.partIdx);this.location={partUuid:b,measureUuids:a}}return this.location},i.clearMeasuresVoice=function(){for(var a=this.opts.startMeasureIdx,b=this.opts.stopMeasureIdx,c=a;c<=b;c++)this.clearMeasureVoice(c)},i.clearMeasureVoice=function(a){var b={partIdx:this.opts.partIdx,measureIdx:a,voiceIdx:this.opts.voiceIdx};new d(this.scoreData,b,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.edit.action.ClearVoice,b=Adagio.edit.common.initMeasureData,c=Adagio.edit.common.convertPartUuidToGetPartIdx,d=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,e=Adagio.Error.client.BadStaffIdxError,f=Adagio.Utils.math,g=Adagio.edit.action.ClearStaffVoices=function(a,b,c){this.init(a,b,c)};g.NAME="action.ClearStaffVoices";var h=g.prototype;h.name=g.NAME,h.initMeasureData=b,h.init=function(a,b,e){c(a,b),d(a,b),this.initMeasureData(a,b),this.cancelStack=e,this.opts=b},h.checkPreconditions=function(){var a=this.measureData.getNbStaves(),b=this.opts.staffIdx;if(!f.isInteger(b)||b<0||b>=a)throw new e(b)},h.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.measureData.getScoreData().getPartStaffVoicesIndexes(this.opts.partIdx,this.opts.staffIdx).forEach(this.clearVoice,this)},h.clearVoice=function(b){var c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:b};new a(this.measureData,c,this.cancelStack).perform()},h.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.measureData.getScoreData(),b={actionName:this.name,opts:{partUuid:a.getPartUuid(this.opts.partIdx),measureUuid:a.getMeasureUuid(this.opts.measureIdx),staffIdx:this.opts.staffIdx}};this.cancelStack.storeAction(b)}}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadMeasureIdxError,b=Adagio.Error.client.BadStaffIdxError,c=Adagio.Error.client.RevertRangeError,d=Adagio.edit.action.ClearStaffVoices,e=Adagio.edit.common.convertPartUuidToGetPartIdx,f=Adagio.edit.common.convertMeasuresUuidsToMeasuresIdxs,g=Adagio.Utils.math,h=Adagio.Utils.partContentUtils,i=Adagio.edit.action.ClearMeasuresStaffVoices=function(a,b,c){this.init(a,b,c)};i.NAME="action.ClearMeasuresStaffVoices";var j=i.prototype;j.name=i.NAME,j.init=function(a,b,c){f(a,b),e(a,b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.location=null},j.checkPreconditions=function(){var a=this.scoreData.getPartContent(this.opts.partIdx),d=h.getNbStaves(a),e=this.opts.staffIdx;if(!g.isInteger(e)||e<0||e>=d)throw new b(e);this.checkMeasureIdx(this.opts.startMeasureIdx),this.checkMeasureIdx(this.opts.stopMeasureIdx);var f=this.opts.startMeasureIdx,i=this.opts.stopMeasureIdx;if(i-f<0)throw new c(c.MEASURE,f,i)},j.checkMeasureIdx=function(b){var c=this.scoreData.getNbMeasures();if(!g.isInteger(b)||b<0||b>=c)throw new a(b,a.GET)},j.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.clearMeasuresStaffVoices()},j.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b=a.measureUuids.slice(),c={actionName:this.name,opts:{partUuid:a.partUuid,measureUuids:b,staffIdx:this.opts.staffIdx}};this.cancelStack.storeAction(c)}},j.getLocation=function(){if(null===this.location){var a=this.scoreData.getMeasureUuids(this.opts.startMeasureIdx,this.opts.stopMeasureIdx),b=this.scoreData.getPartUuid(this.opts.partIdx);this.location={partUuid:b,measureUuids:a}}return this.location},j.clearMeasuresStaffVoices=function(){for(var a=this.opts.startMeasureIdx,b=this.opts.stopMeasureIdx,c=a;c<=b;c++)this.clearMeasureStaffVoices(c)},j.clearMeasureStaffVoices=function(a){var b={partIdx:this.opts.partIdx,measureIdx:a,staffIdx:this.opts.staffIdx};new d(this.scoreData,b,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadHarmonyIdxError,b=Adagio.Utils.math,c=Adagio.Utils.harmonyUtils,d=Adagio.Utils.measureUtils,e=Adagio.Utils.rootUtils,f=Adagio.Utils.bassUtils,g=Adagio.Utils.degreeUtils,h=Adagio.edit.action.RemoveHarmonyAtTimePos,i=Adagio.edit.primitive.RemoveHarmony,j=Adagio.edit.common.convertPartUuidToGetPartIdx,k=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,l=Adagio.edit.action.RemoveHarmony=function(a,b,c){this.init(a,b,c)};l.NAME="action.RemoveHarmony";var m=l.prototype;m.name=l.NAME,m.init=function(a,b,c){j(a,b),k(a,b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.location=null},m.checkPreconditions=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx),this.checkHarmonyIdx()},m.checkHarmonyIdx=function(){var c=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx),e=d.getNbHarmonies(c),f=this.opts.harmonyIdx;if(!b.isInteger(f)||f<0||f>=e)throw new a(f)},m.perform=function(){var a=d.getHarmonies(this.getMeasure()),b=a[this.opts.harmonyIdx],e=c.getTimePos(b),f=d.getDpq(this.getMeasure()),h=c.getRoot(b),i=c.getKindValue(b),j=n(b),k=c.getDegrees(b);k=k.map(g.copy),this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(e,f),this.removeHarmony(),this.updateStack(e,f,h,i,j,k)};var n=function(a){if(c.hasBass(a)){var b=c.getBass(a);return b=f.copy(b)}return null};m.storeAction=function(a,b){if(!this.cancelStack.hasAction()){var c=this.getLocation(),d={actionName:h.NAME,opts:{partUuid:c.partUuid,measureUuid:c.measureUuid,dpq:b,timePos:a}};this.cancelStack.storeAction(d)}},m.removeHarmony=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,harmonyIdx:this.opts.harmonyIdx};new i(this.scoreData,a,this.cancelStack).perform()},m.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},m.updateStack=function(a,b,c,d,f,g){var i=this.getLocation(),j={type:h.NAME,noDraw:!0,opts:{partUuid:i.partUuid,measureUuid:i.measureUuid,timePos:a,dpq:b,root:e.copy(c),kind:d,bass:f,degrees:g}};this.cancelStack.push(j)},m.getLocation=function(){if(null===this.location){var a=this.scoreData.getPartUuid(this.opts.partIdx),b=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={partUuid:a,measureUuid:b}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.harmonyUtils,c=Adagio.edit.action.RemoveHarmony,d=Adagio.edit.common.optsToLocalGetTimePos,e=Adagio.edit.composite.RemoveHarmoniesFrom=function(a,b,c){this.init(a,b,c)};e.NAME="composite.RemoveHarmoniesFrom";var f=e.prototype;f.name=e.NAME,f.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.measure=null},f.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeHarmoniesFrom()},f.removeHarmoniesFrom=function(){for(var c=this.getLimitTimePos(),d=this.getMeasure(),e=a.getHarmonies(d),f=e.length,g=f-1;g>=0;g--){var h=e[g];if(!(b.getTimePos(h)>=c))break;this.removeHarmony(g)}},f.getLimitTimePos=function(){var a=this.getMeasure();return d(this.opts,a)},f.removeHarmony=function(a){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,harmonyIdx:a};new c(this.scoreData,b,this.cancelStack).perform()},f.getMeasure=function(){return null===this.measure&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure}}.call(this),function(){"use strict";var a=Adagio.edit.composite.RemoveHarmoniesFrom,b=Adagio.edit.action.ClearVoice,c=Adagio.edit.composite.ClearMeasureStaffFloatings,d=Adagio.edit.common.initMeasureData,e=Adagio.edit.common.assertPerform,f=Adagio.edit.composite.ClearPartMeasure=function(a,b,c){this.init(a,b,c)};f.NAME="composite.ClearPartMeasure";var g=f.prototype;g.initMeasureData=d,g.name=f.NAME,g.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},g.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.clearHarmonies(),this.clearVoices(),this.clearStaffFloatings()},g.clearHarmonies=function(){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:0,dpq:1},c=this.measureData.getScoreData();new a(c,b,this.cancelStack).perform()},g.clearVoices=function(){this.measureData.forEachVoice(this.clearVoice,this)},g.clearVoice=function(a,c){var d={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:c,removeFloating:!1},f=new b(this.measureData,d,this.cancelStack);e(f)},g.clearStavesFloatings=function(){for(var a=this.measureData.getNbStaves(),b=0;b<a;b++)this.clearStaffFloatings(b)},g.clearStaffFloatings=function(a){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:a},d=this.measureData.getScoreData();new c(d,b,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Utils.durationUtils,b=Adagio.Utils.direction.tempoChangeDirectionUtils,c=Adagio.edit.action.RemoveTempoChangeAtTimePos,d=Adagio.Values.TempoChangeType,e=Adagio.edit.composite.RemoveTempoChangesFrom=function(a,b,c){this.init(a,b,c)};e.NAME="composite.RemoveTempoChangesFrom";var f=e.prototype;f.name=e.NAME,f.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.measure=null,this.limitQuarterPos=null},f.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeTempoChangesFrom()},f.removeTempoChangesFrom=function(){this.getTempoChangesStarts().forEach(this.removeTempoChange,this),this.getTempoChangesStops().forEach(this.removeTempoChange,this)},f.getTempoChangesStarts=function(){var a=this.getTempoChanges();return a=a.filter(g)};var g=function(a){var c=b.getType(a);return d.isStart(c)};f.getTempoChangesStops=function(){var a=this.getTempoChanges();return a=a.filter(h)};var h=function(a){return b.getType(a)===d.STOP};f.getTempoChanges=function(){var a=this.scoreData.getCommonContent(),b=a.getTempoChanges(this.opts.measureIdx);return b=b.filter(this.isBeyoudLimit,this)},f.isBeyoudLimit=function(a){var c=this.getLimitQuarterPos();return b.getQuarterPos(a)>=c},f.getLimitQuarterPos=function(){return null===this.limitQuarterPos&&(this.limitQuarterPos=a.divisionsToQuarter(this.opts.timePos,this.opts.dpq)),this.limitQuarterPos},f.removeTempoChange=function(a){var d=b.getTimePos(a),e=b.getDpq(a),f={measureIdx:this.opts.measureIdx,timePos:d,dpq:e};new c(this.scoreData,f,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.noChange.NoChangeError,b=Adagio.edit.action.RemoveJumpTag,c=Adagio.edit.action.RemoveJumpCall,d=Adagio.edit.action.RemoveRehearsalMain,e=Adagio.edit.action.RemoveBarline,f=Adagio.edit.composite.ClearPartMeasure,g=Adagio.edit.composite.RemoveTempoChangesFrom,h=Adagio.edit.common.assertPerform,i=Adagio.edit.values.PosBarline,j=Adagio.edit.composite.ClearMeasureColumn=function(a,b,c){this.init(a,b,c)};j.NAME="composite.ClearMeasureColumn";var k=j.prototype;k.name=j.NAME,k.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},k.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.clearPartsMeasure(),this.removeJumps(),this.removeTempoChanges(),this.removeRehearsal(),this.opts.clearBarlines&&this.removeBarlines()},k.clearPartsMeasure=function(){for(var a=this.scoreData.getNbParts(),b=0;b<a;b++)this.clearPartMeasure(b)},k.clearPartMeasure=function(a){var b={partIdx:a,measureIdx:this.opts.measureIdx};new f(this.scoreData,b,this.cancelStack).perform()},k.removeJumps=function(){var a=this.scoreData.getCommonContent();a.hasJumpTag(this.opts.measureIdx)&&this.removeJumpTag(),a.hasJumpCall(this.opts.measureIdx)&&this.removeJumpCall()},k.removeJumpTag=function(){var a={measureIdx:this.opts.measureIdx},c=new b(this.scoreData,a,this.cancelStack);h(c)},k.removeJumpCall=function(){var a={measureIdx:this.opts.measureIdx},b=new c(this.scoreData,a,this.cancelStack);h(b)},k.removeTempoChanges=function(){var a={measureIdx:this.opts.measureIdx,timePos:0,dpq:1};new g(this.scoreData,a,this.cancelStack).perform()},k.removeRehearsal=function(){if(this.scoreData.getCommonContent().hasRehearsal(this.opts.measureIdx)){var a={measureIdx:this.opts.measureIdx},b=new d(this.scoreData,a,this.cancelStack);h(b)}},k.removeBarlines=function(){this.removeLeftBarline(),this.removeRightBarline()},k.removeLeftBarline=function(){var a={measureIdx:this.opts.measureIdx,side:i.LEFT},b=new e(this.scoreData,a,this.cancelStack);h(b,l)},k.removeRightBarline=function(){var a={measureIdx:this.opts.measureIdx,side:i.RIGHT},b=new e(this.scoreData,a,this.cancelStack);h(b,l)};var l=function(b){return b instanceof a}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadMeasureIdxError,b=Adagio.Utils.math,c=Adagio.edit.composite.ClearMeasureColumn,d=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,e=Adagio.edit.action.ClearMeasureColumn=function(a,b,c){this.init(a,b,c)};e.NAME="action.ClearMeasureColumn";var f=e.prototype;f.name=e.NAME,f.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,d(a,b),this.location=null},f.checkPreconditions=function(){this.checkLocation()},f.checkLocation=function(){var c=this.scoreData.getNbMeasures(),d=this.opts.measureIdx;if(!b.isInteger(d)||d<0||d>=c)throw new a(d,a.GET)},f.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.clearMeasureColumn()},f.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{measureUuid:a.measureUuid,clearBarlines:!!this.opts.clearBarlines}};this.cancelStack.storeAction(b)}},f.clearMeasureColumn=function(){var a={measureIdx:this.opts.measureIdx,clearBarlines:!!this.opts.clearBarlines};new c(this.scoreData,a,this.cancelStack).perform()},f.getLocation=function(){if(null===this.location){var a=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={measureUuid:a}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.math,c=Adagio.edit.action.RemoveChord,d=Adagio.edit.action.RemoveChordPercu,e=Adagio.edit.common.timePosToFloorNoteIdx,f=Adagio.edit.common.hasTimePosExactNoteIdx,g=Adagio.edit.common.initMeasureData,h=Adagio.edit.common.assertPerform,i=Adagio.edit.composite.RemoveSpaceChordsInternal=function(a,b,c){this.init(a,b,c)};i.NAME="composite.RemoveSpaceChordsInternal";var j=i.prototype;j.name=i.NAME,j.initMeasureData=g,j.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.measure=null,this.noteIdx=null,this.position=null,this.mergedDpq=null,this.internalCoeff=null,this.startTimePos=null,this.stopTimePos=null},j.perform=function(){if(this.cancelStack=this.cancelStack.createSubstack(this.name),this.measureData.hasVoice(this.opts.voiceIdx)){var a=this.measureData.getDpqValue();this.mergedDpq=b.lcm(a,this.opts.dpq);var c=this.mergedDpq/this.opts.dpq;this.startTimePos=this.opts.timePos*c;var d=this.opts.duration*c;for(this.stopTimePos=this.startTimePos+d,this.internalCoeff=this.mergedDpq/a,this.fetchNoteIdx(),this.fetchPosition();!this.done();)this.isNote()&&this.removeChord(),this.moveForward()}},j.fetchNoteIdx=function(){var a=this.getVoice();this.noteIdx=e(a,this.internalCoeff,this.startTimePos),f(a,this.internalCoeff,this.startTimePos)||this.noteIdx++},j.fetchPosition=function(){for(var b=0,c=this.getVoice(),d=0;d<this.noteIdx;d++){var e=c.getNote(d);b+=a.getDuration(e)}this.position=b*this.internalCoeff},j.isNote=function(){return!this.getVoice().isRest(this.noteIdx)},j.done=function(){var a=this.getVoice(),b=a.size();return this.noteIdx>=b||this.position>=this.stopTimePos},j.getDpq=function(){return this.measureData.getDpqValue()},j.removeChord=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.noteIdx,formatRests:!0},b=this.getAction(),c=new b(this.measureData,a,this.cancelStack);h(c),this.measureData.clearTupletCache(this.opts.voiceIdx)},j.getAction=function(){return this.measureData.isUnpitched()?d:c},j.moveForward=function(){var a=this.getCurrentNoteDuration();this.position+=a,this.noteIdx++},j.getCurrentNoteDuration=function(){var b=this.getVoice(),c=b.getNote(this.noteIdx);return a.getDuration(c)*this.internalCoeff},j.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)}}.call(this),function(){"use strict";var a=Adagio.Utils.durationUtils,b=Adagio.Utils.math,c=Adagio.edit.composite.RemoveSpaceChordsInternal,d=Adagio.edit.common.initMeasureData,e=Adagio.edit.composite.RemoveSpaceChordsInternalCrossMeasure=function(a,b,c){this.init(a,b,c)};e.NAME="composite.RemoveSpaceChordsInternalCrossMeasure";var f=e.prototype;f.name=e.NAME,f.initMeasureData=d,f.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.endReached=!1},f.perform=function(){for(this.cancelStack=this.cancelStack.createSubstack(this.name),this.measureIdx=this.opts.measureIdx,this.dpq=this.opts.dpq,this.duration=this.opts.duration,this.timePos=this.opts.timePos;!this.isDone();)this.adaptValue(),this.removeSpaceChords(),this.moveForward()},f.isDone=function(){return 0===this.duration||this.endReached},f.adaptValue=function(){var a=this.measureData.getDpqValue(),c=b.lcm(a,this.dpq),d=c/this.dpq;this.dpq*=d,this.timePos*=d,this.duration*=d},f.removeSpaceChords=function(){var a=this.getSegmentDuration(),b={partIdx:this.opts.partIdx,measureIdx:this.measureIdx,voiceIdx:this.opts.voiceIdx,timePos:this.timePos,dpq:this.dpq,duration:a};new c(this.measureData,b,this.cancelStack).perform(),this.duration-=a},f.getSegmentDuration=function(){var a=this.getMeasureDuration(),b=a-this.timePos;return Math.min(b,this.duration)},f.getMeasureDuration=function(){var b=this.measureData.getDpqValue(),c=this.dpq/b,d=this.measureData.getAnyTime(),e=a.timeToDivisions(d,b);return e*=c},f.moveForward=function(){this.measureData.hasNextMeasure()?(this.measureData=this.measureData.getNextMeasure(),this.measureIdx++,this.timePos=0):this.endReached=!0}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadMeasureIdxError,b=Adagio.Error.client.BadStaffIdxError,c=Adagio.Error.client.RevertRangeError,d=Adagio.Error.client.BadTimePosError,e=Adagio.edit.composite.RemoveSpaceChordsInternalCrossMeasure,f=Adagio.edit.common.convertPartUuidToGetPartIdx,g=Adagio.edit.common.convertMeasuresUuidsToMeasuresIdxs,h=Adagio.edit.common.getMeasuresScroller,i=Adagio.Utils.clone,j=Adagio.Utils.math,k=Adagio.Utils.measureUtils,l=Adagio.Utils.noteUtils,m=Adagio.Utils.partContentUtils,n=Adagio.edit.action.ClearStaffContentCrossMeasure=function(a,b,c){this.init(a,b,c)};n.NAME="action.ClearStaffContentCrossMeasure";var o=n.prototype;o.name=n.NAME,o.init=function(a,b,c){g(a,b),f(a,b),this.measuresScroller=h(a,b),this.cancelStack=c,this.opts=b,this.location=null,this.actionOpts=null},o.checkPreconditions=function(){var a=this.measuresScroller.getScoreData(),d=a.getPartContent(this.opts.partIdx),e=m.getNbStaves(d),f=this.opts.staffIdx;if(!j.isInteger(f)||f<0||f>=e)throw new b(f);this.checkMeasureIdx(this.opts.startMeasureIdx),this.checkMeasureIdx(this.opts.stopMeasureIdx);var g=this.opts.startMeasureIdx,h=this.opts.stopMeasureIdx,i=h-g;if(i<0)throw new c(c.MEASURE,g,h);this.hasNoteIndexes()&&(this.checkNoteIndexes(i),this.convertNoteIndexes()),this.checkTimePos(i)},o.checkMeasureIdx=function(b){var c=this.measuresScroller.getNbMeasures();if(!j.isInteger(b)||b<0||b>=c)throw new a(b,a.GET)},o.checkNoteIndexes=function(a){var b=this.measuresScroller.getMeasureData(this.opts.startMeasureIdx);b.checkVoiceIdx(this.opts.startVoiceIdx),b.getVoice(this.opts.startVoiceIdx).checkNoteIdx(this.opts.startNoteIdx);var d=this.measuresScroller.getMeasureData(this.opts.stopMeasureIdx);if(d.checkVoiceIdx(this.opts.stopVoiceIdx),d.getVoice(this.opts.stopVoiceIdx).checkNoteIdx(this.opts.stopNoteIdx),0===a&&this.opts.startNoteIdx>this.opts.stopNoteIdx)throw new c(c.NOTE,this.opts.startNoteIdx,this.opts.stopNoteIdx)},o.checkTimePos=function(a){var b=this.measuresScroller.getMeasureData(this.opts.startMeasureIdx);this.checkStartTimePos(b,this.opts.startDpq,this.opts.startTimePos);var d=this.measuresScroller.getMeasureData(this.opts.stopMeasureIdx);if(this.checkStopTimePos(d,this.opts.stopDpq,this.opts.stopTimePos),0===a&&this.opts.startTimePos>this.opts.stopTimePos)throw new c(c.NOTE,this.opts.startTimePos,this.opts.stopTimePos)},o.checkStartTimePos=function(a,b,c){var e=a.getDpqValue(),f=a.getMeasure(),g=k.getNbDivisions(f),h=j.lcm(e,b);if(g*=h/e,c*=h/b,!j.isInteger(c)||c<0||c>=g)throw new d(c,h)},o.checkStopTimePos=function(a,b,c){var e=a.getDpqValue(),f=a.getMeasure(),g=k.getNbDivisions(f),h=j.lcm(e,b);if(g*=h/e,c*=h/b,!j.isInteger(c)||c<0||c>g)throw new d(c,h)},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.hasNoteIndexes()&&this.convertNoteIndexes(),this.storeAction(),this.clearMeasuresStaffVoices()},o.hasNoteIndexes=function(){return void 0!==this.opts.startNoteIdx||void 0!==this.opts.startVoiceIdx||void 0!==this.opts.stopNoteIdx||void 0!==this.opts.stopVoiceIdx},o.convertNoteIndexes=function(){var a=this.measuresScroller.getMeasureData(this.opts.startMeasureIdx);this.opts.startDpq=a.getDpqValue();var b=a.getVoice(this.opts.startVoiceIdx);this.opts.startTimePos=b.getRangeSpace(0,this.opts.startNoteIdx);var c=this.measuresScroller.getMeasureData(this.opts.stopMeasureIdx);this.opts.stopDpq=c.getDpqValue();var d=c.getVoice(this.opts.stopVoiceIdx),e=d.getNote(this.opts.stopNoteIdx),f=l.getDuration(e);this.opts.stopTimePos=d.getRangeSpace(0,this.opts.stopNoteIdx)+f,delete this.opts.startVoiceIdx,delete this.opts.startNoteIdx,delete this.opts.stopVoiceIdx,delete this.opts.stopNoteIdx},o.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b=a.measureUuids.slice(),c={actionName:this.name,opts:{partUuid:a.partUuid,measureUuids:b,staffIdx:this.opts.staffIdx,startDpq:this.opts.startDpq,startTimePos:this.opts.startTimePos,stopDpq:this.opts.stopDpq,stopTimePos:this.opts.stopTimePos}};this.cancelStack.storeAction(c)}},o.getLocation=function(){if(null===this.location){var a=this.measuresScroller.getScoreData(),b=a.getMeasureUuids(this.opts.startMeasureIdx,this.opts.stopMeasureIdx),c=a.getPartUuid(this.opts.partIdx);this.location={partUuid:c,measureUuids:b}}return this.location},o.clearMeasuresStaffVoices=function(){this.getStaffVoicesIndexes().forEach(this.clearMeasuresVoice,this)},o.getStaffVoicesIndexes=function(){return this.measuresScroller.getScoreData().getPartStaffVoicesIndexes(this.opts.partIdx,this.opts.staffIdx)},o.clearMeasuresVoice=function(a){var b=this.getActionOpts(),c=this.measuresScroller.getMeasureData(this.opts.startMeasureIdx);b.voiceIdx=a,new e(c,b,this.cancelStack).perform()},o.getActionOpts=function(){return null===this.actionOpts&&this.createActionOpts(),i(this.actionOpts)},o.createActionOpts=function(){var a=this.opts.startMeasureIdx,b=this.opts.stopMeasureIdx,c=0,d=this.opts.startDpq,e=j.lcm(this.opts.startDpq,this.opts.stopDpq),f=this.opts.startTimePos;f*=e/d,d=e;for(var g=a;g<=b;g++){var h=this.measuresScroller.getMeasureData(g),i=h.getDpqValue();e=j.lcm(d,i),f*=e/d,d=e;var l=h.getMeasure(),m=k.getNbDivisions(l);m*=e/i,g===b&&(m=this.opts.stopTimePos*d/this.opts.stopDpq),g===a&&(m-=f),c+=m}this.actionOpts={partIdx:this.opts.partIdx,measureIdx:this.opts.startMeasureIdx,dpq:d,timePos:f,duration:c}}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.edit.values.InsertMode,c=Adagio.edit.action.RemoveTie,d=Adagio.edit.action.RemoveTiePercu,e=Adagio.edit.action.FormatBeamsRandPos,f=Adagio.edit.action.RemoveGlissandos,g=Adagio.edit.action.RemoveHammerOnPullOffs,h=Adagio.edit.composite.AdaptDpqToTimeSignature,i=Adagio.edit.composite.AddRests,j=Adagio.edit.composite.UnlockRest,k=Adagio.edit.primitive.RemoveRest,l=Adagio.edit.common.initMeasureData,m=Adagio.edit.composite.DeleteRest=function(a,b,c){this.init(a,b,c)};m.NAME="composite.DeleteRest";var n=m.prototype;n.name=m.NAME,n.initMeasureData=l,n.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},n.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.adaptDpqToTimeSignature(),this.removeTie(),this.removeGlissandos(),this.removeHammerOnPullOffs(),this.unlockRest();var a=this.getNote();this.deleteRest(),this.restoreSpace(a),this.formatBeams()},n.adaptDpqToTimeSignature=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx};new h(this.measureData,a,this.cancelStack).perform()},n.removeTie=function(){var a=this.getVoiceOrTuplet(),b=a.getStopNoteIdx(),e={
partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:b};new(this.measureData.isUnpitched()?d:c)(this.measureData,e,this.cancelStack).performIfPossible()},n.removeGlissandos=function(){var a=this.getVoiceOrTuplet(),b=a.getStopNoteIdx(),c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:b};new f(this.measureData,c,this.cancelStack).performIfPossible()},n.removeHammerOnPullOffs=function(){var a=this.getVoiceOrTuplet(),b=a.getStopNoteIdx(),c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:b};new g(this.measureData,c,this.cancelStack).performIfPossible()},n.getVoiceOrTuplet=function(){var a=this.opts.voiceIdx,b=this.opts.noteIdx;return this.measureData.getVoiceOrTupletForGet(a,b)},n.unlockRest=function(){var b=this.getNote();if(a.needRestLock(b)){var c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new j(this.measureData,c,this.cancelStack).perform()}},n.getNote=function(){return this.getVoice().getNote(this.opts.noteIdx)},n.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},n.deleteRest=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new k(this.measureData,a,this.cancelStack).perform()},n.restoreSpace=function(c){var d=a.getDuration(c),e=a.getStaffIdx(c),f={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:e,noteIdx:this.opts.noteIdx,duration:d,insertMode:b.INSERT};new i(this.measureData,f,this.cancelStack).perform()},n.formatBeams=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new e(this.measureData,a,this.cancelStack).performIfPossible()}}.call(this),function(){"use strict";var a=Adagio.edit.composite.DeleteRest,b=Adagio.Utils.timeModifUtils,c=Adagio.Utils.noteUtils,d=Adagio.edit.common.initMeasureData,e=Adagio.edit.common.convertPartUuidToGetPartIdx,f=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,g=Adagio.edit.common.convertTimePosToDurationNoteIdx,h=Adagio.edit.common.extractNoteDurationType,i=Adagio.edit.action.DeleteRest=function(a,b,c){this.init(a,b,c)};i.NAME="action.DeleteRest";var j=i.prototype;j.name=i.NAME,j.initMeasureData=d,j.init=function(a,b,c){e(a,b),f(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.sanitized=!1,this.voice=null,this.location=null,g(this.measureData,b)},j.checkPreconditions=function(){this.sanitizeIfNeeded(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkNoteIdx(),this.checkRest()},j.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},j.checkRest=function(){this.getVoice().checkRest(this.opts.noteIdx)},j.getVoice=function(){return null===this.voice&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},j.perform=function(){var b=this.getPrevioudData();this.sanitizeIfNeeded(),this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(b);var c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new a(this.measureData,c,this.cancelStack).perform(),this.updateStack(b)},j.getPrevioudData=function(){var a=this.getVoice(),d=a.getNote(this.opts.noteIdx),e=c.getNbDots(d),f=this.measureData.getDpqValue(),g=h(d,f),i=c.getTimeModif(d);return i=b.copy(i),{nbDots:e,durationType:g,timeModif:i,staffIdx:c.getStaffIdx(d)}},j.storeAction=function(a){if(!this.cancelStack.hasAction()){var c=this.getLocation(),d=b.copy(a.timeModif),e={actionName:this.name,opts:{partUuid:c.partUuid,measureUuid:c.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:c.dpq,timePos:c.timePos,durationType:a.durationType,nbDots:a.nbDots,timeModif:d}};this.cancelStack.storeAction(e)}},j.sanitizeIfNeeded=function(){this.sanitized||(this.sanitized=!0)},j.updateStack=function(a){var c=this.getLocation(),d=b.copy(a.timeModif),e={type:this.name,noDraw:!0,opts:{partUuid:c.partUuid,measureUuid:c.measureUuid,voiceIdx:this.opts.voiceIdx,staffIdx:a.staffIdx,timePos:c.timePos,divisions:c.dpq,timeModif:d,durationType:a.durationType,nbDots:a.nbDots}};this.cancelStack.push(e)},j.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location}}.call(this),function(){"use strict";var a=Adagio.edit.common.initMeasureData,b=Adagio.edit.composite.HideMeasureEmptyVoice=function(a,b,c){this.init(a,b,c)};b.NAME="composite.HideMeasureEmptyVoice";var c=b.prototype;c.name=b.NAME,c.initMeasureData=a,c.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},c.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeVoice(),this.updateStack()},c.removeVoice=function(){this.measureData.removeVoice(this.opts.voiceIdx)},c.updateStack=function(){var a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.edit.action.ClearVoice,b=Adagio.edit.composite.HideMeasureEmptyVoice,c=Adagio.edit.common.initMeasureData,d=Adagio.edit.composite.HideMeasureVoice=function(a,b,c){this.init(a,b,c)};d.NAME="composite.HideMeasureVoice";var e=d.prototype;e.name=d.NAME,e.initMeasureData=c,e.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.clearVoice(),this.removeVoice()},e.clearVoice=function(){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,removeFloating:!1};new a(this.measureData,b,this.cancelStack).perform()},e.removeVoice=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx};new b(this.measureData,a,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.noChange.NoChangeError,b=Adagio.Error.client.BadVoiceError,c=Adagio.Error.client.RemoveLastError,d=Adagio.edit.composite.HideMeasureVoice,e=Adagio.edit.common.convertPartUuidToGetPartIdx,f=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,g=Adagio.edit.common.initMeasureData,h=Adagio.edit.action.HideMeasureVoice=function(a,b,c){this.init(a,b,c)};h.NAME="action.HideMeasureVoices";var i=h.prototype;i.name=h.NAME,i.initMeasureData=g,i.init=function(a,b,c){e(a,b),f(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.location=null},i.checkPreconditions=function(){var d=this.measureData.getScoreData();if(!d.hasPartVoiceIdx(this.opts.partIdx,this.opts.voiceIdx))throw new b(this.opts.voiceIdx);if(!this.measureData.hasVoice(this.opts.voiceIdx))throw new a;var e=d.getPartVoiceMainStaffIdx(this.opts.partIdx,this.opts.voiceIdx);if(this.measureData.getStaffNbVoices(e)<2)throw new c(c.DISPLAYED_VOICE)},i.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.hideMeasureVoice(),this.updateStack()},i.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx},c={actionName:this.name,opts:b};this.cancelStack.storeAction(c)}},i.hideMeasureVoice=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx};new d(this.measureData,a,this.cancelStack).perform()},i.updateStack=function(){var a=this.getLocation(),b={partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx},c={type:this.name,noDraw:!0,opts:b};this.cancelStack.push(c)},i.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx);this.location={partUuid:b,measureUuid:c}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadVoiceError,b=Adagio.Error.noChange.NoChangeError,c=Adagio.edit.action.DeleteRest,d=Adagio.edit.action.HideMeasureVoice,e=Adagio.edit.common.initMeasureData,f=Adagio.edit.common.assertPerform,g=Adagio.edit.action.DeleteRestOrHideVoice=function(a,b,c){this.init(a,b,c)};g.NAME="action.DeleteRestOrHideVoice";var h=g.prototype;h.name=g.NAME,h.initMeasureData=e,h.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},h.checkPreconditions=function(){if(this.checkVoiceIdx(),!this.measureData.hasVoice(this.opts.voiceIdx))throw new b;var a=this.measureData.getVoice(this.opts.voiceIdx);a.checkNoteIdx(this.opts.noteIdx),a.checkRest(this.opts.noteIdx);var c=this.measureData.getVoicesIndexes().length;if(this.isVoiceEmpty()&&1===c)throw new b},h.checkVoiceIdx=function(){if(!this.measureData.getScoreData().hasPartVoiceIdx(this.opts.partIdx,this.opts.voiceIdx))throw new a(this.opts.voiceIdx)},h.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.isVoiceEmpty()?this.hideVoice():this.deleteRest()},h.isVoiceEmpty=function(){return this.measureData.getVoice(this.opts.voiceIdx).isOnlyRests()},h.deleteRest=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx},b=new c(this.measureData,a,this.cancelStack);f(b)},h.hideVoice=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx},b=new d(this.measureData,a,this.cancelStack);f(b)}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.pitchUtils,c=Adagio.edit.common.initMeasureData,d=Adagio.edit.primitive.InsertGraceNote=function(a,b,c){this.init(a,b,c)};d.NAME="primitive.InsertGraceNote";var e=d.prototype;e.name=d.NAME,e.initMeasureData=c,e.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},e.perform=function(){var a=this.getVoice(),b=this.createNote();a.insertGrace(b,this.opts.noteIdx,this.opts.graceIdx),this.updateStack()},e.getVoice=function(){var a=this.opts.voiceIdx;return this.measureData.getVoice(a)},e.createNote=function(){var c={};a.makeGrace(c),a.setDuration(c,0),a.setStaffIdx(c,this.opts.staffIdx),a.setVoiceIdx(c,this.opts.voiceIdx),a.setDurationType(c,this.opts.durationType);var d=b.copy(this.opts.pitch);return a.setPitch(c,d),null!==this.opts.accidental&&a.setAccidental(c,this.opts.accidental),c},e.updateStack=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx},b={type:this.name,opts:a};this.cancelStack.push(b)}}.call(this),function(){"use strict";var a=Adagio.Utils.pitchUtils,b=Adagio.edit.primitive.InsertGraceNote,c=Adagio.edit.action.RemoveTie,d=Adagio.edit.composite.UpdateGraceAccidental,e=Adagio.edit.common.initMeasureData,f=Adagio.edit.composite.InsertGraceNote=function(a,b,c){this.init(a,b,c)};f.NAME="composite.InsertGraceNote";var g=f.prototype;g.name=f.NAME,g.initMeasureData=e,g.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},g.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeTie(),this.insertGraceNote(),this.updateAccidental()},g.removeTie=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx-1};new c(this.measureData,a,this.cancelStack).performIfPossible()},g.insertGraceNote=function(){var c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,durationType:this.opts.durationType,pitch:a.copy(this.opts.pitch),accidental:null};new b(this.measureData,c,this.cancelStack).perform()},g.updateAccidental=function(){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,pitch:a.copy(this.opts.pitch)};new d(this.measureData,b,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.client.NotPossibleOnUnpitchedError,b=Adagio.Utils.pitchUtils,c=Adagio.Values.AccidentalStyle,d=Adagio.Values.DurationType,e=Adagio.edit.common.checkOptsPitch,f=Adagio.edit.common.fillGraceOptsAlter,g=Adagio.edit.common.fillOptsAlter,h=Adagio.edit.common.convertLineToPitch,i=Adagio.edit.common.checkCompatibleVoiceStaffIdx,j=Adagio.edit.common.checkLineOverflow,k=Adagio.edit.common.convertPartUuidToGetPartIdx,l=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,m=Adagio.edit.common.convertTimePosToGetNoteIdx,n=Adagio.edit.common.transposePitchAccidentalOpts,o=Adagio.edit.composite.InsertGraceNote,p=Adagio.edit.common.initMeasureData,q=Adagio.edit.action.InsertGraceNote=function(a,b,c){this.init(a,b,c)};q.NAME="action.InsertGraceNote";var r=q.prototype;r.name=q.NAME,r.initMeasureData=p,r.init=function(a,b,c){k(a,b),l(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,m(this.measureData,this.opts),this.sanitized=!1,this.location=null},r.checkPreconditions=function(){this.checkValues(),this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkCompatibleVoiceStaffIdx(),this.checkNoteIdx(),this.checkNotRest(),this.checkGraceInsertionIdx(),this.sanitizeIfNeeded(),this.checkPitch(),this.opts.checkLine&&j(this.measureData,this.opts)},r.checkValues=function(){d.check(this.opts.durationType),e(this.opts),null!==this.opts.accidental&&c.check(this.opts.accidental)},r.checkPitch=function(){b.check(this.opts.pitch)},r.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new a},r.checkCompatibleVoiceStaffIdx=function(){i(this.measureData,this.opts)},r.checkNoteIdx=function(){this.measureData.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},r.checkNotRest=function(){this.measureData.getVoice(this.opts.voiceIdx).checkNotRest(this.opts.noteIdx)},r.checkGraceInsertionIdx=function(){this.measureData.getVoice(this.opts.voiceIdx).checkGraceInsertionIdx(this.opts.noteIdx,this.opts.graceIdx)},r.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded(),this.storeAction(),this.insertGraceNote(),this.updateStack()},r.sanitizeIfNeeded=function(){this.sanitized||(void 0!==this.opts.line&&h(this.measureData,this.opts,!0),this.opts.isConcertPitch&&n(this.measureData,this.opts),s(this.measureData,this.opts),void 0===this.opts.checkLine&&(this.opts.checkLine=!0),this.sanitized=!0)};var s=function(a,b){var c=a.getVoice(b.voiceIdx),d=c.getNbGraces(b.noteIdx);b.graceIdx<d?f(a,b):g(a,b)};r.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),c={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,graceIdx:this.opts.graceIdx,timePos:a.timePos,divisions:a.dpq,durationType:this.opts.durationType,pitch:b.copyWithoutAlter(this.opts.pitch),accidental:this.opts.accidental,checkLine:this.opts.checkLine}};this.cancelStack.storeAction(c)}},r.insertGraceNote=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,durationType:this.opts.durationType,pitch:b.copy(this.opts.pitch)};new o(this.measureData,a,this.cancelStack).perform()},r.updateStack=function(){var a=this.getLocation(),b={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,graceIdx:this.opts.graceIdx,timePos:a.timePos,divisions:a.dpq}};this.cancelStack.push(b)},r.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.unpitchedUtils,c=Adagio.edit.common.initMeasureData,d=Adagio.edit.common.getMIDIUnpitched,e=Adagio.edit.primitive.InsertGraceNotePercu=function(a,b,c){this.init(a,b,c)};e.NAME="primitive.InsertGraceNotePercu";var f=e.prototype;f.name=e.NAME,f.initMeasureData=c,f.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},f.perform=function(){var a=this.getVoice(),b=this.createNote();a.insertGrace(b,this.opts.noteIdx,this.opts.graceIdx),this.updateStack()},f.getVoice=function(){var a=this.opts.voiceIdx;return this.measureData.getVoice(a)},f.createNote=function(){var c={};a.makeGrace(c),a.setDuration(c,0),a.setStaffIdx(c,this.opts.staffIdx),a.setVoiceIdx(c,this.opts.voiceIdx),a.setDurationType(c,this.opts.durationType);var d=b.copy(this.opts.unpitched);a.setUnpitched(c,d),a.setHead(c,this.opts.notehead);var e=this.getInstrumentId();return a.setInstrumentId(c,e),c},f.getInstrumentId=function(){var a=d(this.measureData,this.opts.partIdx,this.opts.unpitched,this.opts.notehead);return this.measureData.searchUnpitchedInstrumentId(a)},f.updateStack=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx},b={type:this.name,opts:a};this.cancelStack.push(b)}}.call(this),function(){"use strict";var a=Adagio.Utils.unpitchedUtils,b=Adagio.Values.DurationType,c=Adagio.edit.common.convertLineToUnpitched,d=Adagio.edit.common.checkCompatibleVoiceStaffIdx,e=Adagio.edit.common.checkUnpitchedInstrument,f=Adagio.edit.common.convertPartUuidToGetPartIdx,g=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,h=Adagio.edit.common.convertTimePosToGetNoteIdx,i=Adagio.edit.common.checkUnpitchedMeasure,j=Adagio.edit.common.getDefaultMIDIHead,k=Adagio.edit.primitive.InsertGraceNotePercu,l=Adagio.edit.common.initMeasureData,m=Adagio.edit.action.InsertGraceNotePercu=function(a,b,c){this.init(a,b,c)};m.NAME="action.InsertGraceNotePercu";var n=m.prototype;n.name=m.NAME,n.initMeasureData=l,n.init=function(a,b,c){f(a,b),g(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,h(this.measureData,this.opts),this.sanitized=!1,this.location=null},n.checkPreconditions=function(){this.checkValues(),this.checkUnpitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkCompatibleVoiceStaffIdx(),this.checkNoteIdx(),this.checkNotRest(),this.checkGraceInsertionIdx(),this.sanitizeIfNeeded(),this.checkInstrument()},n.checkValues=function(){b.check(this.opts.durationType)},n.checkUnpitchedPart=function(){i(this.measureData)},n.checkCompatibleVoiceStaffIdx=function(){d(this.measureData,this.opts)},n.checkNoteIdx=function(){this.measureData.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},n.checkNotRest=function(){this.measureData.getVoice(this.opts.voiceIdx).checkNotRest(this.opts.noteIdx)},n.checkGraceInsertionIdx=function(){this.measureData.getVoice(this.opts.voiceIdx).checkGraceInsertionIdx(this.opts.noteIdx,this.opts.graceIdx)},n.checkInstrument=function(){e(this.measureData,this.opts)},n.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded(),this.fillHeadIfMissing(),this.storeAction(),this.insertGraceNote(),this.updateStack()},n.sanitizeIfNeeded=function(){this.sanitized||(void 0!==this.opts.line&&c(this.measureData,this.opts),this.sanitized=!0)},n.fillHeadIfMissing=function(){void 0===this.opts.notehead&&(this.opts.notehead=j(this.measureData,this.opts.partIdx,this.opts.unpitched))},n.storeAction=function(){if(!this.cancelStack.hasAction()){var b=this.getLocation(),c={actionName:this.name,opts:{partUuid:b.partUuid,measureUuid:b.measureUuid,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,graceIdx:this.opts.graceIdx,timePos:b.timePos,divisions:b.dpq,durationType:this.opts.durationType,unpitched:a.copy(this.opts.unpitched),notehead:this.opts.notehead}};this.cancelStack.storeAction(c)}},n.insertGraceNote=function(){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,durationType:this.opts.durationType,unpitched:a.copy(this.opts.unpitched),notehead:this.opts.notehead};new k(this.measureData,b,this.cancelStack).perform()},n.updateStack=function(){var a=this.getLocation(),b={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,graceIdx:this.opts.graceIdx,timePos:a.timePos,divisions:a.dpq}};this.cancelStack.push(b)},n.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Utils.unpitchedUtils,b=Adagio.Values.DurationType,c=Adagio.edit.common.convertLineToUnpitched,d=Adagio.edit.common.checkCompatibleVoiceStaffIdx,e=Adagio.edit.common.convertPartUuidToGetPartIdx,f=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,g=Adagio.edit.common.convertTimePosToGetNoteIdx,h=Adagio.edit.common.checkUnpitchedMeasure,i=Adagio.edit.common.getDefaultMIDIHead,j=Adagio.edit.common.assertPerform,k=Adagio.edit.action.InsertGraceNotePercu,l=Adagio.edit.action.AddGraceSlash,m=Adagio.edit.common.initMeasureData,n=Adagio.edit.action.InsertSlashedGraceNotePercu=function(a,b,c){this.init(a,b,c)};n.NAME="action.InsertSlashedGraceNotePercu";var o=n.prototype;o.name=n.NAME,o.initMeasureData=m,o.init=function(a,b,c){e(a,b),f(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,g(this.measureData,this.opts),this.sanitized=!1,this.location=null,this.insertGraceAction=null},o.checkPreconditions=function(){this.checkUnpitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkCompatibleVoiceStaffIdx(),this.checkNoteIdx(),this.checkNotRest(),this.checkGraceInsertionIdx(),this.sanitizeIfNeeded(),this.getInsertGraceAction().checkPreconditions()},o.checkUnpitchedPart=function(){h(this.measureData)},o.checkCompatibleVoiceStaffIdx=function(){d(this.measureData,this.opts)},o.checkNoteIdx=function(){this.measureData.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},o.checkNotRest=function(){this.measureData.getVoice(this.opts.voiceIdx).checkNotRest(this.opts.noteIdx)},o.checkGraceInsertionIdx=function(){this.measureData.getVoice(this.opts.voiceIdx).checkGraceInsertionIdx(this.opts.noteIdx,this.opts.graceIdx)},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded(),this.storeAction(),this.insertGraceNote(),this.addSlash()},o.sanitizeIfNeeded=function(){this.sanitized||(void 0!==this.opts.line&&c(this.measureData,this.opts),this.fillHeadIfMissing(),this.sanitized=!0)},o.fillHeadIfMissing=function(){void 0===this.opts.notehead&&(this.opts.notehead=i(this.measureData,this.opts.partIdx,this.opts.unpitched))},o.storeAction=function(){if(!this.cancelStack.hasAction()){var b=this.getLocation(),c={actionName:this.name,opts:{partUuid:b.partUuid,measureUuid:b.measureUuid,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,graceIdx:this.opts.graceIdx,timePos:b.timePos,divisions:b.dpq,unpitched:a.copy(this.opts.unpitched),notehead:this.opts.notehead}};this.cancelStack.storeAction(c)}},o.insertGraceNote=function(){this.getInsertGraceAction().perform()},o.getInsertGraceAction=function(){if(null===this.insertGraceAction){var c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,durationType:b.EIGHT,unpitched:a.copy(this.opts.unpitched),notehead:this.opts.notehead};this.insertGraceAction=new k(this.measureData,c,this.cancelStack)}return this.insertGraceAction},o.addSlash=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx},b=new l(this.measureData,a,this.cancelStack);j(b)},o.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.client.NotPossibleOnUnpitchedError,b=Adagio.Utils.pitchUtils,c=Adagio.Values.AccidentalStyle,d=Adagio.Values.DurationType,e=Adagio.edit.common.checkOptsPitch,f=Adagio.edit.common.fillGraceOptsAlter,g=Adagio.edit.common.fillOptsAlter,h=Adagio.edit.common.convertLineToPitch,i=Adagio.edit.common.checkCompatibleVoiceStaffIdx,j=Adagio.edit.common.convertPartUuidToGetPartIdx,k=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,l=Adagio.edit.common.convertTimePosToGetNoteIdx,m=Adagio.edit.common.transposePitchAccidentalOpts,n=Adagio.edit.common.assertPerform,o=Adagio.edit.action.InsertGraceNote,p=Adagio.edit.action.AddGraceSlash,q=Adagio.edit.common.initMeasureData,r=Adagio.edit.action.InsertSlashedGraceNote=function(a,b,c){this.init(a,b,c)};r.NAME="action.InsertSlashedGraceNote";var s=r.prototype;s.name=r.NAME,s.initMeasureData=q,s.init=function(a,b,c){j(a,b),k(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,l(this.measureData,this.opts),this.sanitized=!1,this.insertGraceAction=null,this.location=null},s.checkPreconditions=function(){this.checkValues(),this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkCompatibleVoiceStaffIdx(),this.checkNoteIdx(),this.checkNotRest(),this.checkGraceInsertionIdx(),this.sanitizeIfNeeded(),this.getInsertGraceAction().checkPreconditions()},s.checkValues=function(){e(this.opts),null!==this.opts.accidental&&c.check(this.opts.accidental)},s.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new a},s.checkCompatibleVoiceStaffIdx=function(){i(this.measureData,this.opts)},s.checkNoteIdx=function(){this.measureData.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},s.checkNotRest=function(){this.measureData.getVoice(this.opts.voiceIdx).checkNotRest(this.opts.noteIdx)},s.checkGraceInsertionIdx=function(){this.measureData.getVoice(this.opts.voiceIdx).checkGraceInsertionIdx(this.opts.noteIdx,this.opts.graceIdx)},s.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded(),this.storeAction(),this.insertGraceNote(),this.addSlash()},s.sanitizeIfNeeded=function(){this.sanitized||(void 0!==this.opts.line&&h(this.measureData,this.opts,!0),this.opts.isConcertPitch&&m(this.measureData,this.opts),t(this.measureData,this.opts),void 0===this.opts.checkLine&&(this.opts.checkLine=!0),this.sanitized=!0)};var t=function(a,b){var c=a.getVoice(b.voiceIdx),d=c.getNbGraces(b.noteIdx);b.graceIdx<d?f(a,b):g(a,b)};s.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),c={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,graceIdx:this.opts.graceIdx,timePos:a.timePos,divisions:a.dpq,pitch:b.copyWithoutAlter(this.opts.pitch),accidental:this.opts.accidental,checkLine:this.opts.checkLine}};this.cancelStack.storeAction(c)}},s.insertGraceNote=function(){var a=this.getInsertGraceAction();a.cancelStack=this.cancelStack,a.perform()},s.getInsertGraceAction=function(){if(null===this.insertGraceAction){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,durationType:d.EIGHT,pitch:b.copyWithoutAlter(this.opts.pitch),accidental:this.opts.accidental};this.insertGraceAction=new o(this.measureData,a,null)}return this.insertGraceAction},s.addSlash=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx},b=new p(this.measureData,a,this.cancelStack);n(b)},s.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.NonBinaryDurationError=function(b,d){var e=c(b,d),f=a.call(this,e);return this.name=f.name="NonBinaryDurationError",this.stack=f.stack,this.message=f.message,this.divisions=b,this.dpq=d,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a,b){return"The quarter duration ["+a+"/"+b+"] is not binary."}}.call(this),function(){"use strict";var a=Adagio.Utils.pitchUtils,b=Adagio.Utils.clone,c=Adagio.Utils.keyUtils,d=Adagio.Utils.transposeUtils,e=Adagio.Utils.staffDetailsUtils;Adagio.edit.common.transposeMeasureDump=function(a,b){var c={attributes:i(a.attributes,b),staffDetails:e.createDefault()},d=new f(a.notes,a.ties,a.slurs,a.glissandos,b);return c.ties=d.ties,c.notes=d.notes,c.slurs=d.slurs,c.glissandos=d.glissandos,c};var f=function(a,c,d,e,f){this.transpose=f,this.makeTieMap(c),this.notes=[],this.ties=[],this.glissandos=void 0===e||null===e?[]:b(e),this.slurs=void 0===d||null===d?[]:b(d),a.forEach(this.processNote,this)},g=f.prototype;g.makeTieMap=function(a){this.tiesMap={},a.forEach(function(a){var b=h(a.noteIdx,a.octave,a.step);this.tiesMap[b]=!0},this)},g.processNote=function(a,c){this.noteIdx=c,a.isRest?this.notes.push(b(a)):this.processPitched(a)},g.processPitched=function(a){var c={nbDots:a.nbDots,durationType:a.durationType,heads:a.heads.map(this.transposePitch,this)};void 0!==a.lyrics&&(c.lyrics=a.lyrics.map(b)),void 0!==a.articulations&&(c.articulations=b(a.articulations)),void 0!==a.technicals&&(c.technicals=b(a.technicals)),void 0!==a.ornaments&&(c.ornaments=b(a.ornaments)),void 0!==a.tuplet&&(c.tuplet=a.tuplet),this.notes.push(c)},g.transposePitch=function(b){var c=!0,d=a.transpose(b.pitch,this.transpose,c);return this.hasTie(b.pitch)&&this.addTie(d),{pitch:d}},g.hasTie=function(b){var c=a.getStep(b),d=a.getOctave(b),e=h(this.noteIdx,d,c);return!0===this.tiesMap[e]};var h=function(a,b,c){return a+"/"+b+"/"+c};g.addTie=function(b){var c={noteIdx:this.noteIdx,step:a.getStep(b),octave:a.getOctave(b)};this.ties.push(c)};var i=function(a,b){var e={transpose:d.getDiff(a.transpose,b)};return void 0!==a.key&&(e.key=c.transpose(a.key,b)),e}}.call(this),function(){"use strict";var a=Adagio.Utils.clone,b=Adagio.Utils.timeModifUtils,c=Adagio.Utils.durationUtils,d=Adagio.Values.DurationType;Adagio.edit.common.calcNotesOptsQuarterDuration=function(a){return h().extract(a)};var e=function(){},f=e.prototype;f.extract=function(a){for(this.reset(a);!this.endReached();)this.processNote();var b=this.quarterDuration;return this.cleanup(),b},f.reset=function(a){this.notes=a,this.nbNotes=a.length,this.quarterDuration=0,this.noteIdx=0},f.endReached=function(){return this.noteIdx===this.nbNotes},f.processNote=function(){void 0!==this.notes[this.noteIdx].tuplet?this.processTuplet():this.processNormalNote()},f.processTuplet=function(){this.addTupletDuration(),this.skipTuplet()},f.addTupletDuration=function(){var a=this.notes[this.noteIdx],c=b.getNormal(a.tuplet.timeModif),e=d.toQuarterDuration(a.tuplet.durationType),f=c*e;this.quarterDuration+=f},f.skipTuplet=function(){
for(var e=this.notes[this.noteIdx],f=b.getActual(e.tuplet.timeModif),g=d.toQuarterDuration(e.tuplet.durationType),h=f*g,i=0;i<h;){var j=a(this.notes[this.noteIdx]);i+=c.durationOptsToQuarter(j),this.noteIdx++}},f.processNormalNote=function(){var b=a(this.notes[this.noteIdx]),d=c.durationOptsToQuarter(b);this.quarterDuration+=d,this.noteIdx++},f.cleanup=function(){this.notes=null};var g=null,h=function(){return null===g&&(g=new e),g}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Error.client.ClientError,c=Adagio.Error.noChange.NoChangeError,d=Adagio.Error.client.NotPossibleOnUnpitchedError,e=Adagio.Error.client.NotPossibleOnPitchedError,f=Adagio.Error.client.NotEnoughSpaceError,g=Adagio.Error.client.BadTimePosError,h=Adagio.Error.value.BadOrnamentTypeError,i=Adagio.Error.value.BadTechnicalTypeError,j=Adagio.Error.value.BadArticulationTypeError,k=Adagio.Error.value.NonBinaryDurationError,l=Adagio.edit.action.AddNote,m=Adagio.edit.action.AddLyric,n=Adagio.edit.action.AddNotePercu,o=Adagio.edit.action.AddTieArc,p=Adagio.edit.action.AddTieArcPercu,q=Adagio.edit.action.ChangeDurationFormat,r=Adagio.edit.action.AddTuplet,s=Adagio.edit.action.AddNotations,t=Adagio.edit.action.AddArticulations,u=Adagio.edit.action.AddSlur,v=Adagio.edit.action.AddTechnical,w=Adagio.edit.action.AddOrnament,x=Adagio.edit.composite.RemoveSpaceTuplets,y=Adagio.edit.composite.RemoveSpaceChordsQuarter,z=Adagio.edit.composite.SplitRestIfNeeded,A=Adagio.edit.values.InsertMode,B=Adagio.edit.common.transposeMeasureDump,C=Adagio.edit.common.convertPartUuidToGetPartIdx,D=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,E=Adagio.edit.common.calcNotesOptsQuarterDuration,F=Adagio.edit.common.assertPerform,G=Adagio.edit.common.timePosToNoteIdx,H=Adagio.edit.common.initMeasureData,I=Adagio.edit.common.checkCompatibleVoiceStaffIdx,J=Adagio.Values.SyllabicType,K=Adagio.Values.TupletType,L=Adagio.Values.NotationType,M=Adagio.Values.TechnicalType,N=Adagio.Values.OrnamentType,O=Adagio.Values.ArticulationType,P=Adagio.Utils.clone,Q=Adagio.Utils.mapUtils,R=Adagio.Utils.math,S=Adagio.Utils.measureUtils,T=Adagio.Utils.attributesUtils,U=Adagio.Utils.transposeUtils,V=Adagio.Utils.staffDetailsUtils,W=Adagio.Utils.durationUtils,X=Adagio.Utils.pitchUtils,Y=Adagio.Utils.timeModifUtils,Z=Adagio.Utils.unpitchedUtils,$=Adagio.edit.action.InsertNotesAtTimePos=function(a,b,c){this.init(a,b,c)};$.NAME="action.InsertNotesAtTimePos",$.convertLyricLegacy=function(a){a.notes.forEach(_)};var _=function(a){if(void 0!==a.lyric){var b=a.lyric,c=J.hasRightConnection(b.syllabic),d={text:b.text,hasRightConnection:c,level:0};a.lyrics=[d],delete a.lyric}},aa=$.prototype;aa.name=$.NAME,aa.initMeasureData=H,aa.init=function(a,b,c){C(a,b),D(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.sanitized=!1,this.notesQuarterDuration=null,this.measureQuarterDuration=null,this.quarterPos=null,this.isSameStaffDetailsValue=null,this.location=null},aa.checkPreconditions=function(){this.checkLocation(),this.checkPartType(),this.checkTimePos(),this.checkDuration(),this.sanitizeIfNeeded(),this.checkCompatibleVoiceStaffIdx()},aa.checkLocation=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx)},aa.checkPartType=function(){var a=this.measureData.getScoreData();if(!this.opts.data.isUnpitched&&a.isPartUnpitched(this.opts.partIdx))throw new d;if(this.opts.data.isUnpitched&&!a.isPartUnpitched(this.opts.partIdx))throw new e},aa.checkTimePos=function(){var a=this.getQuarterPos(),b=this.getMeasureQuarterDuration();if(!R.isNumber(a)||a<0||a>=b)throw new g(this.opts.timePos,this.opts.dpq);if(!W.isValidQuarter(a))throw new k(this.opts.timePos,this.opts.dpq)},aa.checkDuration=function(){var a=this.getMeasureQuarterDuration(),b=this.getQuarterPos(),c=this.getNotesQuarterDuration();if(b+c>a){var d=a-b,e=Y.createDefault();throw new f(c,d,1,e)}},aa.getQuarterPos=function(){return null===this.quarterPos&&(this.quarterPos=W.divisionsToQuarter(this.opts.timePos,this.opts.dpq)),this.quarterPos},aa.getNotesQuarterDuration=function(){return null===this.notesQuarterDuration&&(this.notesQuarterDuration=E(this.opts.data.notes)),this.notesQuarterDuration},aa.getMeasureQuarterDuration=function(){if(null===this.measureQuarterDuration){var a=this.measureData.getMeasure();this.measureQuarterDuration=S.getQuarterDuration(a)}return this.measureQuarterDuration},aa.getSrcTranspose=function(){return this.opts.data.attributes.transpose},aa.getDestTranspose=function(){var a=this.getDestAttributes();return T.getWrappedTranspose(a).getEntry(this.opts.staffIdx)},aa.getDestAttributes=function(){return this.measureData.getAttributes()},aa.checkCompatibleVoiceStaffIdx=function(){I(this.measureData,this.opts)},aa.perform=function(){this.sanitizeIfNeeded(),$.convertLyricLegacy(this.opts.data),this.transposeDumpIfNeeded(),this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.clearSpace(),this.splitRest(),this.fetchNoteIdx(),this.insertNotes(),this.insertTies(),this.insertSlurs()},aa.sanitizeIfNeeded=function(){if(!this.sanitized){if(void 0===this.opts.staffIdx){var a=this.measureData.getScoreData();this.opts.staffIdx=a.getPartVoiceMainStaffIdx(this.opts.partIdx,this.opts.voiceIdx)}this.sanitized=!0}},aa.transposeDumpIfNeeded=function(){if(!this.opts.data.isUnpitched){var a=this.getDestTranspose(),b=this.getSrcTranspose();if(!U.isSimilar(b,a)){var c=U.getDiff(a,b);c=U.getReverse(c),this.opts.data=B(this.opts.data,c)}}},aa.clearSpace=function(){this.removeSpaceTuplets(),this.removeSpaceChords()},aa.removeSpaceTuplets=function(){var a=this.getQuarterPos(),b=this.getNotesQuarterDuration(),c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,quarterPosition:a,quarterDuration:b};new x(this.measureData,c,this.cancelStack).perform(),this.measureData.clearTupletCache(this.opts.voiceIdx)},aa.removeSpaceChords=function(){var a=this.getQuarterPos(),b=this.getNotesQuarterDuration(),c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,quarterPosition:a,quarterDuration:b};new y(this.measureData,c,this.cancelStack).perform()},aa.splitRest=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,timePos:this.opts.timePos,dpq:this.opts.dpq};new z(this.measureData,a,this.cancelStack).perform()},aa.fetchNoteIdx=function(){var a=this.measureData.getDpqValue(),b=R.lcm(a,this.opts.dpq),c=b/this.opts.dpq,d=this.opts.timePos*c,e=b/a,f=this.measureData.getVoice(this.opts.voiceIdx);this.noteIdx=G(f,e,d),this.startNoteIdx=this.noteIdx},aa.insertNotes=function(){this.opts.data.notes.forEach(this.insertNote,this)},aa.insertNote=function(a){this.noteData=a,void 0!==a.tuplet&&this.insertTuplet(),a.isRest?this.resizeRest():this.insertChord(),this.noteIdx++},aa.insertTuplet=function(){var a=this.noteData.tuplet.timeModif,b=Y.getWholeNbDots(a),c=Y.getShiftToWholeDurationType(a),d=this.noteData.tuplet.durationType+c,e=this.getNoteLocation();e.insertMode=A.REPLACE,e.durationType=d,e.nbDots=b,e.formatRests=!1;var f=new q(this.measureData,e,this.cancelStack);F(f,ba);var g=K.fromTimeModif(a),h=this.getNoteLocation();h.tupletType=g;var i=new r(this.measureData,h,this.cancelStack);F(i),this.measureData.clearTupletCache(this.opts.voiceIdx)},aa.resizeRest=function(){var a=this.getNoteLocation();a.durationType=this.noteData.durationType,a.nbDots=this.noteData.nbDots,a.formatRests=!1,a.insertMode=A.REPLACE;var b=new q(this.measureData,a,this.cancelStack);F(b,ba),this.measureData.clearTupletCache(this.opts.voiceIdx)};var ba=function(a){return a instanceof c};aa.insertChord=function(){this.hasInsertedHead=!1,this.noteData.heads.forEach(this.insertHead,this),this.measureData.clearTupletCache(this.opts.voiceIdx),this.hasInsertedHead?this.addChordAttributes():this.resizeRest()},aa.insertHead=function(b){if(this.headData=b,void 0!==b.unpitched)this.insertUnpitchedHead();else{if(void 0===b.pitch)throw new a("Unexpected");this.insertPitchedHead()}},aa.insertUnpitchedHead=function(){var a=Z.copy(this.headData.unpitched),b=this.getNoteLocation();b.staffIdx=this.opts.staffIdx,b.durationType=this.noteData.durationType,b.nbDots=this.noteData.nbDots,b.unpitched=a,b.notehead=this.headData.notehead,b.insertMode=A.REPLACE;var c=new n(this.measureData,b,this.cancelStack);F(c,ca)&&(this.hasInsertedHead=!0),this.measureData.clearTupletCache(this.opts.voiceIdx)},aa.insertPitchedHead=function(){var a=X.copyWithoutAlter(this.headData.pitch),b=X.alterToAccidental(X.getAlter(this.headData.pitch)),c=this.getNoteLocation();c.staffIdx=this.opts.staffIdx,c.durationType=this.noteData.durationType,c.nbDots=this.noteData.nbDots,c.pitch=a,c.accidental=b,c.insertMode=A.REPLACE,void 0!==this.headData.fretData&&this.isSameStaffDetails()&&(c.fretData=P(this.headData.fretData));var d=new l(this.measureData,c,this.cancelStack);F(d,ca)&&(this.hasInsertedHead=!0),this.measureData.clearTupletCache(this.opts.voiceIdx)},aa.isSameStaffDetails=function(){if(null===this.isSameStaffDetailsValue){var a=this.getSrcStaffDetails(),b=this.getDestStaffDetails();this.isSameStaffDetailsValue=V.isSame(a,b)}return this.isSameStaffDetailsValue},aa.getSrcStaffDetails=function(){return this.opts.data.attributes.staffDetails},aa.getDestStaffDetails=function(){var a=this.getDestAttributes();return T.getWrappedStaffDetailsOrDefault(a).getEntry(this.opts.staffIdx)},aa.addChordAttributes=function(){void 0!==this.noteData.lyrics&&this.noteData.lyrics.forEach(function(a){var b=this.getNoteLocation();b.lyric=a.text,b.hasRightConnection=a.hasRightConnection,b.level=a.level;var c=new m(this.measureData,b,this.cancelStack);F(c,ba)},this),void 0!==this.noteData.articulations&&Object.keys(this.noteData.articulations).forEach(function(a){var b,c=this.getNoteLocation();if(L.isValid(a))c.notationType=a,b=new s(this.measureData,c,this.cancelStack),F(b);else{if(!O.isValid(a))throw new j(a);c.articulationType=a,b=new t(this.measureData,c,this.cancelStack),F(b)}},this),void 0!==this.noteData.technicals&&Object.keys(this.noteData.technicals).forEach(function(a){if(M.isCommonValid(a)){var b=this.getNoteLocation();b.technicalType=a;var c=new v(this.measureData,b,this.cancelStack);F(c)}else if(!M.isValid)throw new i(a)},this),void 0!==this.noteData.ornaments&&Q.forEach(this.noteData.ornaments,function(a,b){if(!N.isValid(a))throw new h(a);var c=this.getNoteLocation();c.ornamentType=a,c.ornamentsOpts=b;var d=new w(this.measureData,c,this.cancelStack);F(d)},this)},aa.insertTies=function(){this.opts.data.ties.forEach(function(a){var b,c=a.noteIdx+this.startNoteIdx,d=this.getNoteLocation(c);this.measureData.isUnpitched()?(d["display-step"]=a["display-step"],d["display-octave"]=a["display-octave"],b=new p(this.measureData,d,this.cancelStack)):(d.step=a.step,d.octave=a.octave,b=new o(this.measureData,d,this.cancelStack)),F(b,ca)},this)},aa.insertSlurs=function(){this.opts.data.slurs.forEach(function(a){var b={partIdx:this.opts.partIdx,voiceIdx:this.opts.voiceIdx,startMeasureIdx:this.opts.measureIdx,startNoteIdx:a.startNoteIdx+this.startNoteIdx,stopMeasureIdx:this.opts.measureIdx,stopNoteIdx:a.stopNoteIdx+this.startNoteIdx},c=new u(this.measureData,b,this.cancelStack);F(c,ca)},this)};var ca=function(a){return a instanceof b};aa.getNoteLocation=function(a){return void 0===a&&(a=this.noteIdx),{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:a}},aa.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,timePos:this.opts.timePos,dpq:this.opts.dpq,data:P(this.opts.data)},c={actionName:this.name,opts:b};this.cancelStack.storeAction(c)}},aa.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx);this.location={partUuid:b,measureUuid:c}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadPartIdxError,b=Adagio.Error.client.BadMeasureIdxError,c=Adagio.Error.client.BadVoiceError,d=Adagio.edit.action.InsertNotesAtTimePos,e=Adagio.edit.action.AddMeasure,f=Adagio.edit.common.MeasureData,g=Adagio.edit.common.convertPartUuidToGetPartIdx,h=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,i=Adagio.Utils.clone,j=Adagio.Utils.uuidUtils,k=Adagio.edit.action.InsertStaffContent=function(a,b,c){this.init(a,b,c)};k.NAME="action.InsertStaffContent";var l=k.prototype;l.name=k.NAME,l.init=function(a,b,c){g(a,b),null===b.measureUuid&&(b.measureIdx=a.getNbMeasures(),delete b.measureUuid),h(a,b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.needAddMeasureVal=null},l.checkPreconditions=function(){this.checkLocation()},l.checkLocation=function(){var d=this.scoreData.getNbParts(),e=this.opts.partIdx;if(e<0||e>=d)throw new a(e,a.GET);var f=this.scoreData.getNbMeasures(),g=this.opts.measureIdx;if(g<0||g>f)throw new b(g,b.INSERT);g===f&&g--;var h=this.opts.voiceIdx;if(!this.scoreData.hasPartVoiceIdx(this.opts.partIdx,h))throw new c(h,c.GET)},l.perform=function(){if(this.cancelStack=this.cancelStack.createSubstack(this.name),this.needAddMeasure()){var a=j.generate();this.addMeasure(a)}this.insertNotes()},l.needAddMeasure=function(){return null===this.needAddMeasureVal&&(this.needAddMeasureVal=this.isAfterEnd()||!this.isDestEmpty()),this.needAddMeasureVal},l.isAfterEnd=function(){var a=this.scoreData.getPartContent(this.opts.partIdx),b=a.measure.length;return this.opts.measureIdx===b},l.isDestEmpty=function(){var a=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx);return new f(a).getVoice(this.opts.voiceIdx).isOnlyRests()},l.addMeasure=function(a){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,measureUuid:a,isSubAction:!0};new e(this.scoreData,b,this.cancelStack).perform()},l.insertNotes=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,timePos:0,dpq:1,data:i(this.opts.data)},b=new d(this.scoreData,a,this.cancelStack);b.checkPreconditions(),b.perform()}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadPartIdxError,b=Adagio.Error.client.BadMeasureIdxError,c=Adagio.Error.client.BadVoiceError,d=Adagio.Error.client.BadStaffIdxError,e=Adagio.Error.client.NotEnoughSpaceError,f=Adagio.edit.action.InsertStaffContent,g=Adagio.edit.action.AddMeasure,h=Adagio.edit.common.convertPartUuidToGetPartIdx,i=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,j=Adagio.edit.common.assertPerform,k=Adagio.edit.common.MeasureData,l=Adagio.Utils.clone,m=Adagio.Utils.math,n=Adagio.Utils.partContentUtils,o=Adagio.Utils.uuidUtils,p=Adagio.edit.action.InsertMeasuresVoiceContent=function(a,b,c){this.init(a,b,c)};p.NAME="action.InsertMeasuresVoiceContent";var q=p.prototype;q.name=p.NAME,q.init=function(a,b,c){h(a,b),i(a,b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.location=null,this.needAddMeasureVal=null},q.checkPreconditions=function(){this.checkLocation()},q.checkLocation=function(){var e=this.scoreData.getNbParts(),f=this.opts.partIdx;if(!m.isInteger(f)||f<0||f>=e)throw new a(f,a.GET);var g=this.scoreData.getNbMeasures(),h=this.opts.measureIdx;if(h<0||h>g)throw new b(h,b.INSERT);h===g&&h--;var i=this.opts.voiceIdx;if(!this.scoreData.hasPartVoiceIdx(this.opts.partIdx,i))throw new c(i,c.GET);var j=this.opts.staffIdx,k=this.scoreData.getPartContent(this.opts.partIdx),l=n.getNbStaves(k);if(!m.isInteger(j)||j<0||j>=l)throw new d(j)},q.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a;this.needAddMeasure()?(a=o.generate(),this.addMeasure(a)):a=this.getMeasureUuid(),this.storeAction(a),this.opts.measuresData.forEach(this.insertVoice,this)},q.needAddMeasure=function(){return null===this.needAddMeasureVal&&(this.needAddMeasureVal=this.isAfterEnd()||!this.isDestEmpty()),this.needAddMeasureVal},q.isAfterEnd=function(){var a=this.scoreData.getPartContent(this.opts.partIdx),b=a.measure.length;return this.opts.measureIdx===b},q.isDestEmpty=function(){var a=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx);return new k(a).getVoice(this.opts.voiceIdx).isOnlyRests()},q.addMeasure=function(a){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,measureUuid:a,isSubAction:!0};new g(this.scoreData,b,this.cancelStack).perform()},q.getMeasureUuid=function(){return this.scoreData.getMeasureUuid(this.opts.measureIdx)},q.insertVoice=function(a,b){var c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx+b,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,data:l(a)},d=new f(this.scoreData,c,this.cancelStack);j(d,r)};var r=function(a){return a instanceof b||a instanceof e};q.storeAction=function(a){var b=this.getLocation(),c={partUuid:b.partUuid,measureUuid:a,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,measuresData:l(this.opts.measuresData)},d={actionName:this.name,opts:c};this.cancelStack.storeAction(d)},q.getLocation=function(){if(null===this.location){var a=this.scoreData.getPartUuid(this.opts.partIdx);this.location={partUuid:a}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadPartIdxError,b=Adagio.Error.client.BadMeasureIdxError,c=Adagio.Error.client.BadStaffIdxError,d=Adagio.Error.client.NotEnoughSpaceError,e=Adagio.edit.action.InsertStaffContent,f=Adagio.edit.action.AddMeasure,g=Adagio.edit.common.convertPartUuidToGetPartIdx,h=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,i=Adagio.edit.common.assertPerform,j=Adagio.edit.common.MeasureData,k=Adagio.Utils.clone,l=Adagio.Utils.math,m=Adagio.Utils.partContentUtils,n=Adagio.Utils.uuidUtils,o=Adagio.edit.action.InsertMeasuresVoicesContent=function(a,b,c){this.init(a,b,c)};o.NAME="action.InsertMeasuresVoicesContent";var p=o.prototype;p.name=o.NAME,p.init=function(a,b,c){g(a,b),h(a,b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.location=null,this.needAddMeasureVal=null},p.checkPreconditions=function(){this.checkLocation()},p.checkLocation=function(){var d=this.scoreData.getNbParts(),e=this.opts.partIdx;if(!l.isInteger(e)||e<0||e>=d)throw new a(e,a.GET);var f=this.scoreData.getNbMeasures(),g=this.opts.measureIdx;if(g<0||g>f)throw new b(g,b.INSERT);g===f&&g--;var h=this.opts.staffIdx,i=this.scoreData.getPartContent(this.opts.partIdx),j=m.getNbStaves(i);if(!l.isInteger(h)||h<0||h>=j)throw new c(h)},p.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a;this.needAddMeasure()?(a=n.generate(),this.addMeasure(a)):a=this.getMeasureUuid(),this.storeAction(a),this.opts.measuresData.forEach(this.insertVoices,this)},p.needAddMeasure=function(){return null===this.needAddMeasureVal&&(this.needAddMeasureVal=this.isAfterEnd()||!this.isDestEmpty()),this.needAddMeasureVal},p.isAfterEnd=function(){var a=this.scoreData.getPartContent(this.opts.partIdx),b=a.measure.length;return this.opts.measureIdx===b},p.isDestEmpty=function(){var a=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx),b=new j(a),c=this.scoreData.getPartStaffVoicesIndexes(this.opts.partIdx,this.opts.staffIdx),d=this.opts.measuresData[0].length;return c=c.slice(0,d),c.every(function(a){return b.getVoice(a).isOnlyRests()})},p.addMeasure=function(a){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,measureUuid:a,isSubAction:!0};new f(this.scoreData,b,this.cancelStack).perform()},p.getMeasureUuid=function(){return this.scoreData.getMeasureUuid(this.opts.measureIdx)},p.insertVoices=function(a,b){this.measureIdx=b+this.opts.measureIdx;var c=this.getNbVoices();a=a.slice(0,c),a.forEach(this.insertVoice,this)},p.getNbVoices=function(){return this.scoreData.getPartStaffVoicesIndexes(this.opts.partIdx,this.opts.staffIdx).length},p.insertVoice=function(a,b){var c=this.scoreData.getPartStaffVoiceAtIdx(this.opts.partIdx,this.opts.staffIdx,b),d={partIdx:this.opts.partIdx,measureIdx:this.measureIdx,voiceIdx:c,staffIdx:this.opts.staffIdx,data:k(a)},f=new e(this.scoreData,d,this.cancelStack);i(f,q)};var q=function(a){return a instanceof b||a instanceof d};p.storeAction=function(a){var b=this.getLocation(),c={partUuid:b.partUuid,measureUuid:a,staffIdx:this.opts.staffIdx,measuresData:k(this.opts.measuresData)},d={actionName:this.name,opts:c};this.cancelStack.storeAction(d)},p.getLocation=function(){if(null===this.location){var a=this.scoreData.getPartUuid(this.opts.partIdx);this.location={partUuid:a}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.client.NotEnoughSpaceError,b=Adagio.Error.client.NotPossibleOnUnpitchedError,c=Adagio.Utils.clone,d=Adagio.Utils.noteUtils,e=Adagio.Utils.pitchUtils,f=Adagio.Utils.durationUtils,g=Adagio.edit.values.InsertMode,h=Adagio.edit.common.calcDuration,i=Adagio.edit.common.checkOptsDuration,j=Adagio.edit.action.ChangeDurationCrossMeasure,k=Adagio.edit.action.AddChord,l=Adagio.edit.common.initMeasureData,m=Adagio.edit.action.AddChordCrossMeasure2=function(a,b,c){this.init(a,b,c)};m.NAME="action.AddChordCrossMeasure2";var n=m.prototype;n.initMeasureData=l,n.name=m.NAME,n.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.sanitized=!1,this.addChordAction=null},n.checkPreconditions=function(){this.sanitizeIfNeeded(),i(this.opts),this.checkPitchedPart(),this.checkLocation(),this.checkAvailableSpace(),this.checkNoteData()},n.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new b},n.checkLocation=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.measureData.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},n.checkAvailableSpace=function(){var a=this.getRequiredDuration(),b=this.getActualDuration();if(!(b>a)&&b!==a&&(a-=b,this.isTuplet())){var c=this.getAvailableSpace();c<a&&this.raiseNotEnoughSpace(a,c)}},n.getRequiredDuration=function(){var a=this.measureData.getDpqValue(),b=this.getTimeModif();return h(this.opts,a,b)},n.getTimeModif=function(){return this.getVoiceOrTupletForGet().getAbsoluteTimeModif()},n.getActualDuration=function(){var a=this.getVoice(),b=a.getNote(this.opts.noteIdx);return d.getDuration(b)},n.isTuplet=function(){return this.getVoiceOrTupletForGet().isTuplet()},n.getAvailableSpace=function(){var a=this.getVoiceOrTupletForGet(),b=this.opts.noteIdx+1;return a.getSpaceFromIdx(b)},n.raiseNotEnoughSpace=function(b,c){var d=this.getVoiceOrTupletForGet(),e=this.measureData.getDpqValue(),f=d.getAbsoluteTimeModif();throw new a(b,c,e,f)},n.getVoiceOrTupletForGet=function(){var a=this.opts.voiceIdx,b=this.opts.noteIdx;return this.measureData.getVoiceOrTupletForGet(a,b)},n.checkNoteData=function(){this.getAddChordAction().checkPreconditions()},n.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded(),this.addNote();var a=this.getRequiredDuration();this.getActualDuration()!==a&&this.changeDuration()},n.sanitizeIfNeeded=function(){this.sanitized||(void 0===this.opts.checkLine&&(this.opts.checkLine=!0),this.sanitized=!0)},n.addNote=function(){var a=this.getAddChordAction();a.cancelStack=this.cancelStack,a.perform()},n.getAddChordAction=function(){if(null===this.addChordAction){var a=this.getActualDurationOpts(),b=this.opts.heads.map(o),c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,noteIdx:this.opts.noteIdx,insertMode:g.REPLACE,durationType:a.durationType,nbDots:a.nbDots,heads:b,checkLine:this.opts.checkLine};this.addChordAction=new k(this.measureData,c,this.cancelStack)}return this.addChordAction};var o=function(a){var b=e.copy(a.pitch),d={pitch:b};return void 0!==a.fretData&&(d.fretData=c(a.fretData)),d};n.getActualDurationOpts=function(){var a=this.getVoice(),b=a.getNote(this.opts.noteIdx),c=this.measureData.getDpqValue(),e=d.getNormalQuarterDuration(b,c);return f.quarterToDurationOpts(e)},n.changeDuration=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,durationType:this.opts.durationType,nbDots:this.opts.nbDots},b=new j(this.measureData,a,this.cancelStack);b.checkPreconditions(),b.perform()},n.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)}}.call(this),function(){"use strict";var a=Adagio.Utils.durationUtils,b=Adagio.edit.composite.RemoveSpaceChordsQuarter,c=Adagio.edit.common.initMeasureData,d=Adagio.edit.composite.RemoveSpaceChordsQuarterCrossMeasure=function(a,b,c){this.init(a,b,c)};d.NAME="composite.RemoveSpaceChordsQuarterCrossMeasure";var e=d.prototype;e.name=d.NAME,e.initMeasureData=c,e.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.measure=null,this.quarterPosition=null,this.quarterDuration=null,this.endReached=!1},e.perform=function(){for(this.cancelStack=this.cancelStack.createSubstack(this.name),this.quarterPosition=this.opts.quarterPosition,this.measureIdx=this.opts.measureIdx,this.quarterDuration=this.opts.quarterDuration;!this.isDone();)this.removeSpaceChords(),this.moveForward()},e.isDone=function(){return 0===this.quarterDuration||this.endReached},e.removeSpaceChords=function(){var a=this.getSegmentDuration(),c={partIdx:this.opts.partIdx,measureIdx:this.measureIdx,voiceIdx:this.opts.voiceIdx,quarterPosition:this.quarterPosition,quarterDuration:a};new b(this.measureData,c,this.cancelStack).perform(),this.quarterDuration-=a},e.getSegmentDuration=function(){var a=this.getMeasureDuration(),b=a-this.quarterPosition;return Math.min(b,this.quarterDuration)},e.getMeasureDuration=function(){var b=this.measureData.getAnyTime();return a.timeToQuarter(b)},e.moveForward=function(){this.measureData.hasNextMeasure()?(this.measureData=this.measureData.getNextMeasure(),this.measureIdx++,this.quarterPosition=0):this.endReached=!0}}.call(this),function(){"use strict";var a=Adagio.Utils.durationUtils,b=Adagio.edit.composite.RemoveSpaceTuplets,c=Adagio.edit.common.initMeasureData,d=Adagio.edit.composite.RemoveSpaceTupletsCrossMeasure=function(a,b,c){this.init(a,b,c)};d.NAME="composite.RemoveSpaceTupletsCrossMeasure";var e=d.prototype;e.name=d.NAME,e.initMeasureData=c,e.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.measure=null,this.quarterPosition=null,this.quarterDuration=null,this.endReached=!1},e.perform=function(){for(this.cancelStack=this.cancelStack.createSubstack(this.name),this.quarterPosition=this.opts.quarterPosition,this.measureIdx=this.opts.measureIdx,this.quarterDuration=this.opts.quarterDuration;!this.isDone();)this.removeSpaceTuplets(),this.moveForward()},e.isDone=function(){return 0===this.quarterDuration||this.endReached},e.removeSpaceTuplets=function(){var a=this.getSegmentDuration(),c={partIdx:this.opts.partIdx,measureIdx:this.measureIdx,voiceIdx:this.opts.voiceIdx,quarterPosition:this.quarterPosition,quarterDuration:a};new b(this.measureData,c,this.cancelStack).perform(),this.quarterDuration-=a},e.getSegmentDuration=function(){var a=this.getMeasureDuration(),b=a-this.quarterPosition;return Math.min(b,this.quarterDuration)},e.getMeasureDuration=function(){var b=this.measureData.getAnyTime();return a.timeToQuarter(b)},e.moveForward=function(){this.measureData.hasNextMeasure()?(this.measureData=this.measureData.getNextMeasure(),this.measureIdx++,this.quarterPosition=0):this.endReached=!0}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Error.noChange.NoChangeError,c=Adagio.Error.client.ClientError,d=Adagio.Error.value.BadArticulationTypeError,e=Adagio.Error.value.BadTechnicalTypeError,f=Adagio.Error.value.BadOrnamentTypeError,g=Adagio.Values.TupletType,h=Adagio.Values.NotationType,i=Adagio.Values.ArticulationType,j=Adagio.Values.TechnicalType,k=Adagio.Values.OrnamentType,l=Adagio.Utils.clone,m=Adagio.Utils.math,n=Adagio.Utils.mapUtils,o=Adagio.Utils.noteUtils,p=Adagio.Utils.pitchUtils,q=Adagio.Utils.durationUtils,r=Adagio.Utils.timeModifUtils,s=Adagio.Utils.measureUtils,t=Adagio.Utils.unpitchedUtils,u=Adagio.edit.action.AddMeasure,v=Adagio.edit.action.AddTuplet,w=Adagio.edit.action.ChangeDurationFormat,x=Adagio.edit.action.ShowMeasureVoice,y=Adagio.edit.action.ChangeDurationCrossMeasure,z=Adagio.edit.action.AddRestCrossMeasure,A=Adagio.edit.action.AddChordCrossMeasure2,B=Adagio.edit.action.AddChordPercuCrossMeasure2,C=Adagio.edit.action.AddLyric,D=Adagio.edit.action.AddNotations,E=Adagio.edit.action.AddArticulations,F=Adagio.edit.action.AddTechnical,G=Adagio.edit.action.AddOrnament,H=Adagio.edit.action.AddTieArc,I=Adagio.edit.action.AddSlur,J=Adagio.edit.action.AddGlissandoSide,K=Adagio.edit.action.InsertGraceNote,L=Adagio.edit.action.AddGraceToChord,M=Adagio.edit.action.InsertGraceNotePercu,N=Adagio.edit.action.AddGraceToChordPercu,O=Adagio.edit.action.AddGhostNotePercu,P=Adagio.edit.composite.SplitRestIfNeeded,Q=Adagio.edit.composite.RemoveSpaceChordsQuarterCrossMeasure,R=Adagio.edit.composite.RemoveSpaceTupletsCrossMeasure,S=Adagio.edit.common.timePosToNoteIdx,T=Adagio.edit.common.assertPerform,U=Adagio.edit.common.createScrollableMeasureData,V=Adagio.edit.common.calcNotesOptsQuarterDuration,W=Adagio.edit.common.getMeasuresScroller,X=Adagio.edit.values.InsertMode,Y=Adagio.edit.composite.InsertVoiceContentCrossMeasure=function(a,b,c){this.init(a,b,c)};Y.NAME="action.InsertVoiceContentCrossMeasure";var Z=Y.prototype;Z.name=Y.NAME,Z.init=function(a,b,c){this.measuresScroller=W(a,b),this.scoreData=this.measuresScroller.getScoreData(),this.cancelStack=c,this.opts=b,this.notesQuarterDuration=null,this.quarterPos=null,this.noteIdx=null,this.measureIdx=null,this.measuresScroller=null,this.locationsMap={}},Z.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.measureIdx=this.opts.measureIdx,this.timePos=this.opts.timePos,this.dpq=this.opts.dpq,this.clearSpace(),this.insertNotes(),this.storePosition(),this.insertTies(),this.insertSlurs(),this.insertGlissandos()},Z.clearSpace=function(){this.removeSpaceTuplets(),this.removeSpaceChords()},Z.removeSpaceTuplets=function(){var a=this.getQuarterPos(),b=this.getNotesQuarterDuration(),c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,quarterPosition:a,quarterDuration:b},d=this.getMeasureData();new R(d,c,this.cancelStack).perform()},Z.removeSpaceChords=function(){var a=this.getQuarterPos(),b=this.getNotesQuarterDuration(),c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,quarterPosition:a,quarterDuration:b},d=this.getMeasureData();new Q(d,c,this.cancelStack).perform()},Z.getQuarterPos=function(){return null===this.quarterPos&&(this.quarterPos=q.divisionsToQuarter(this.opts.timePos,this.opts.dpq)),this.quarterPos},Z.getNotesQuarterDuration=function(){return null===this.notesQuarterDuration&&(this.notesQuarterDuration=V(this.opts.data.notes)),this.notesQuarterDuration},Z.insertNotes=function(){this.opts.data.notes.forEach(this.insertNote,this)},Z.insertNote=function(a,b){this.needAddMeasure()&&this.addMeasure(),this.noteData=a,this.relativeNoteIdx=b,void 0!==a.tuplet&&this.insertTuplet(),a.isRest?this.resizeRest():(this.insertChord(),this.insertGraces(),this.addChordAttributes()),this.recordLocation(),this.moveForward()},Z.needAddMeasure=function(){var b=this.scoreData.getNbMeasures();if(this.measureIdx<b)return!1;if(this.measureIdx===b)return!0;throw new a("Unexpected")},Z.addMeasure=function(){var a={measureIdx:this.measureIdx},b=new u(this.scoreData,a,this.cancelStack);T(b),this.measuresScroller=null},Z.insertTuplet=function(){this.showVoiceIfNeeded();var a=this.noteData.tuplet.timeModif,b=r.getWholeNbDots(a),c=r.getShiftToWholeDurationType(a),d=this.noteData.tuplet.durationType+c,e=this.getNoteLocation();e.insertMode=X.REPLACE,e.durationType=d,e.nbDots=b,e.formatRests=!1;var f=this.getMeasureData(),h=new w(f,e,this.cancelStack);T(h,$);var i=g.fromTimeModif(a),j=this.getNoteLocation();j.tupletType=i;var k=new v(f,j,this.cancelStack);T(k),f.clearTupletCache(this.opts.voiceIdx)
},Z.resizeRest=function(){this.hasVoiceDisplayed()?this.changeRestDuration():this.addRestCrossMeasure()},Z.changeRestDuration=function(){var a=this.getNoteLocation();a.durationType=this.noteData.durationType,a.nbDots=this.noteData.nbDots,a.formatRests=!1,a.insertMode=X.REPLACE;var b=this.getMeasureData(),c=new y(b,a,this.cancelStack);T(c,$),this.measuresScroller=null};var $=function(a){return a instanceof b};Z.addRestCrossMeasure=function(){var a=this.getQuarterLocation(),b={durationType:this.noteData.durationType,nbDots:this.noteData.nbDots};a.quarterDuration=q.durationOptsToQuarter(b);var c=new z(this.scoreData,a,this.cancelStack);T(c),this.measuresScroller=null},Z.insertChord=function(){if(this.showVoiceIfNeeded(),void 0!==this.noteData.heads)this.insertPitchedChord();else{if(void 0===this.noteData.instruments)throw new a("Unexpected");this.insertUnpitchedChord(),this.addChordGhostsPercu()}},Z.showVoiceIfNeeded=function(){this.hasVoiceDisplayed()||this.showVoice()},Z.showVoice=function(){var a=this.getMeasureData(),b={partIdx:this.opts.partIdx,measureIdx:this.measureIdx,voiceIdx:this.opts.voiceIdx},c=new x(a,b,this.cancelStack);T(c)},Z.insertPitchedChord=function(){var a=this.getNoteLocation(),b=this.noteData.heads.map(_);a.staffIdx=this.opts.staffIdx,a.durationType=this.noteData.durationType,a.nbDots=this.noteData.nbDots,a.heads=b,a.checkLine=!1;var c=this.getMeasureData(),d=new A(c,a,this.cancelStack);T(d),this.measuresScroller=null};var _=function(a){var b=p.copy(a.pitch),c={pitch:b};return void 0!==a.fretData&&(c.fretData=l(a.fretData)),c};Z.insertUnpitchedChord=function(){var a=this.getNoteLocation(),b=l(this.noteData.instruments);a.staffIdx=this.opts.staffIdx,a.durationType=this.noteData.durationType,a.nbDots=this.noteData.nbDots,a.instruments=b;var c=this.getMeasureData(),d=new B(c,a,this.cancelStack);T(d),this.measuresScroller=null},Z.addChordGhostsPercu=function(){this.noteData.instruments.filter(aa).forEach(this.addHeadGhostPercu,this)};var aa=function(a){return a.isGhost};Z.addHeadGhostPercu=function(a){var b=this.getNoteLocation();b.unpitched=t.copy(a.unpitched);var c=this.getMeasureData(),d=new O(c,b,this.cancelStack);T(d)},Z.insertGraces=function(){var b=this.noteData.graces;if(void 0!==b)if(void 0!==this.noteData.heads)b.forEach(this.insertPitchedGraces,this);else{if(void 0===this.noteData.instruments)throw new a("Unexpected");b.forEach(this.insertUnpitchedGraces,this)}},Z.insertPitchedGraces=function(a,b){(a.heads||[]).forEach(function(c,d){var e=this.getNoteLocation();e.staffIdx=this.opts.staffIdx,e.graceIdx=b,e.durationType=a.durationType,e.pitch=l(c.pitch),e.accidental=null;var f=this.getMeasureData(),g=0===d?new K(f,e,this.cancelStack):new L(f,e,this.cancelStack);T(g)},this)},Z.insertUnpitchedGraces=function(a,b){(a.heads||[]).forEach(function(c,d){var e=this.getNoteLocation();e.staffIdx=this.opts.staffIdx,e.graceIdx=b,e.durationType=a.durationType,e.unpitched=l(c.unpitched),e.notehead=c.notehead;var f=this.getMeasureData(),g=0===d?new M(f,e,this.cancelStack):new N(f,e,this.cancelStack);T(g)},this)},Z.addChordAttributes=function(){(this.noteData.lyrics||[]).forEach(this.addLyric,this);var a=this.noteData.articulations||{};n.forEach(a,this.addArticulation,this);var b=this.noteData.technicals||{};n.forEach(b,this.addTechnical,this);var c=this.noteData.ornaments||{};n.forEach(c,this.addOrnament,this)},Z.addLyric=function(a){var b=this.getNoteLocation();b.lyric=a.text,b.hasRightConnection=a.hasRightConnection,b.level=a.level;var c=this.getMeasureData(),d=new C(c,b,this.cancelStack);T(d,$)},Z.addArticulation=function(a){var b,c=this.getNoteLocation(),e=this.getMeasureData();if(h.isValid(a))c.notationType=a,b=new D(e,c,this.cancelStack),T(b);else{if(!i.isValid(a))throw new d(a);c.articulationType=a,b=new E(e,c,this.cancelStack),T(b)}},Z.addTechnical=function(a){if(j.isCommonValid(a)){var b=this.getNoteLocation();b.technicalType=a;var c=this.getMeasureData(),d=new F(c,b,this.cancelStack);T(d)}else if(!j.isValid)throw new e(a)},Z.addOrnament=function(a,b){if(!k.isValid(a))throw new f(a);var c=this.getNoteLocation();c.ornamentType=a,c.ornamentsOpts=b;var d=this.getMeasureData(),e=new G(d,c,this.cancelStack);T(e)},Z.recordLocation=function(){if(null!==this.noteIdx){var a={noteIdx:this.noteIdx,measureIdx:this.measureIdx};this.locationsMap[this.relativeNoteIdx]=a}},Z.moveForward=function(){for(var a=this.getCurrentTimeModif(),b={durationType:this.noteData.durationType,nbDots:this.noteData.nbDots},c=q.durationOptsToQuarter(b);c>0;)c=this.hasVoiceDisplayed()?this.moveForwardOnDisplayedVoice(c,a):this.moveForwardOnHiddenVoice(c,a)},Z.moveForwardOnDisplayedVoice=function(b,c){var d=this.getMeasureData(),e=d.getVoice(this.opts.voiceIdx),f=e.getNote(this.noteIdx),g=o.getTimeModif(f);if(!r.isSame(g,c))throw new a("Unexpected");var h=d.getDpqValue();b-=o.getNormalQuarterDuration(f,h),this.noteIdx++;var i=o.getDuration(f);return this.moveTimePosForward(i,h),this.noteIdx>=e.getNbNotes()&&(this.noteIdx=0,this.measureIdx++,this.timePos=0),b},Z.moveForwardOnHiddenVoice=function(b,c){if(this.noteIdx=null,!r.isNormal(c))throw new a("Unexpected","A normal time modif is expoected.");var d=this.scoreData.getMeasure(this.opts.partIdx,this.measureIdx),e=s.getQuarterDuration(d),f=this.getQuarterPosition(),g=e-f,h=Math.min(g,b);g-=h,b-=h;var i=q.quarterDurationToRequiredDpq(h),j=q.quarterToDivisions(h,i);return this.moveTimePosForward(j,i),0===g&&(this.noteIdx=0,this.measureIdx++,this.timePos=0),b},Z.moveTimePosForward=function(a,b){var c=m.lcm(this.dpq,b);this.timePos*=c/this.dpq,a*=c/b,this.timePos+=a},Z.getCurrentTimeModif=function(){if(this.hasVoiceDisplayed()){var a=this.getMeasureData(),b=a.getVoice(this.opts.voiceIdx),c=b.getNote(this.noteIdx);return o.getTimeModif(c)}return r.createDefault()},Z.hasVoiceDisplayed=function(){return this.getMeasureData().hasVoice(this.opts.voiceIdx)},Z.getMeasureData=function(){var a;return null===this.measuresScroller?(a=U(this.scoreData,this.opts.partIdx,this.measureIdx),this.measuresScroller=a.getMeasuresScroller()):a=this.measuresScroller.getMeasureData(this.measureIdx),a},Z.storePosition=function(){var a={measureIdx:this.measureIdx,noteIdx:this.noteIdx};this.cancelStack.storePosition(a)},Z.insertTies=function(){this.opts.data.ties.forEach(this.insertTie,this)},Z.insertTie=function(a){var b=a.noteIdx+1,c=this.locationsMap[b],d=c.measureIdx,e=c.noteIdx-1,f=this.measuresScroller.getMeasureData(d),g={partIdx:this.opts.partIdx,measureIdx:d,voiceIdx:this.opts.voiceIdx,noteIdx:e,step:a.step,octave:a.octave},h=new H(f,g,this.cancelStack);T(h)},Z.insertSlurs=function(){this.opts.data.slurs.forEach(this.insertSlur,this)},Z.insertSlur=function(a){var b=this.locationsMap[a.startNoteIdx],c=this.locationsMap[a.stopNoteIdx],d={partIdx:this.opts.partIdx,voiceIdx:this.opts.voiceIdx,startMeasureIdx:b.measureIdx,startNoteIdx:b.noteIdx,stopMeasureIdx:c.measureIdx,stopNoteIdx:c.noteIdx},e=new I(this.measuresScroller,d,this.cancelStack);T(e,ba)},Z.insertGlissandos=function(){(this.opts.data.glissandos||[]).forEach(this.insertGlissando,this)},Z.insertGlissando=function(a){var b=this.locationsMap[a.noteIdx],c=this.measuresScroller.getMeasureData(b.measureIdx),d={partIdx:this.opts.partIdx,voiceIdx:this.opts.voiceIdx,measureIdx:b.measureIdx,noteIdx:b.noteIdx,pitch:p.create(a.octave,a.step),glissandoType:a.glissandoType,number:a.number},e=new J(c,d,this.cancelStack);T(e,ba)};var ba=function(a){return a instanceof c};Z.getQuarterLocation=function(){var a=this.getQuarterPosition();return{partIdx:this.opts.partIdx,measureIdx:this.measureIdx,voiceIdx:this.opts.voiceIdx,quarterPosition:a}},Z.getQuarterPosition=function(){var b=q.divisionsToQuarter(this.timePos,this.dpq);if(!q.isValidQuarter(b))throw new a("Unexpected");return b},Z.getNoteLocation=function(){return null===this.noteIdx&&(this.splitRest(),this.fetchNoteIdx()),{partIdx:this.opts.partIdx,measureIdx:this.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.noteIdx}},Z.splitRest=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,timePos:this.timePos,dpq:this.dpq},b=this.getMeasureData();new P(b,a,this.cancelStack).perform()},Z.fetchNoteIdx=function(){var a=this.getMeasureData(),b=a.getDpqValue(),c=m.lcm(b,this.dpq),d=c/this.dpq,e=this.timePos*d,f=c/b,g=a.getVoice(this.opts.voiceIdx);this.noteIdx=S(g,f,e),this.startNoteIdx=this.noteIdx}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.TupletCrossMeasureError=function(){var b="There is a tuplet across two measures.",c=a.call(this,b);return this.name=c.name="TupletCrossMeasureError",this.stack=c.stack,this.message=c.message,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}})}.call(this),function(){"use strict";var a=Adagio.Error.client.TupletCrossMeasureError,b=Adagio.Error.InternalError,c=Adagio.Utils.measureUtils,d=Adagio.Utils.durationUtils,e=Adagio.Utils.timeModifUtils,f=Adagio.Utils.clone,g=Adagio.Values.DurationType,h=Adagio.edit.common.getMeasuresScroller,i=Adagio.edit.common.checkTupletCrossMeasure=function(a,b){a=h(a,b);for(var c=new j(b),d=new l(a,b);c.hasNext();){var e=c.isTuplet(),f=c.getDuration();e?d.addTupletDuration(f):d.addNormalDuration(f)}},j=i.OptsDurations=function(a){this.init(a)},k=j.prototype;k.init=function(a){this.noteIdx=0,this.notes=a.data.notes},k.hasNext=function(){return this.noteIdx<this.notes.length},k.isTuplet=function(){return void 0!==this.notes[this.noteIdx].tuplet},k.getDuration=function(){var a,b=this.notes[this.noteIdx];if(this.isTuplet()){var c=g.toQuarterDuration(b.tuplet.durationType),f=e.getActual(b.tuplet.timeModif),h=f*c;this.skipTuplet(h);return e.getNormal(b.tuplet.timeModif)*c}return a={durationType:b.durationType,nbDots:b.nbDots},this.noteIdx++,d.durationOptsToQuarter(a)},k.skipTuplet=function(a){for(var c=0;c<a;){var e=f(this.notes[this.noteIdx]);c+=d.durationOptsToQuarter(e),this.noteIdx++}if(c!==a)throw new b("Unexpected")};var l=i.MeasuresDurations=function(a,b){this.init(a,b)},m=l.prototype;m.init=function(a,b){this.measuresScroller=a,this.opts=b,this.isFirst=!0,this.measureDuration=null;var c=this.measuresScroller.getNbMeasures();this.measureIdx=b.measureIdx,b.measureIdx>=c&&(this.measureIdx=c-1)},m.addNormalDuration=function(a){for(;a>0;){var b=this.getMeasureDuration(),c=Math.min(a,b);a-=c,this.consumeSpace(c)}},m.addTupletDuration=function(b){if(b>this.getMeasureDuration())throw new a;this.consumeSpace(b)},m.getMeasureDuration=function(){if(null!==this.measureDuration)return this.measureDuration;var a=this.measuresScroller.getMeasureData(this.measureIdx).getMeasure(),b=c.getQuarterDuration(a);if(this.isFirst){b-=d.divisionsToQuarter(this.opts.timePos,this.opts.dpq),this.isFirst=!1}return this.measureDuration=b,this.measureDuration},m.consumeSpace=function(a){if(a>this.measureDuration)throw new b("Unexpected");this.measureDuration-=a,0===this.measureDuration&&(this.measureDuration=null,this.measureIdx<this.measuresScroller.getNbMeasures()-1&&this.measureIdx++)}}.call(this),function(){"use strict";var a=Adagio.Utils.clone,b=Adagio.Utils.mapUtils,c=Adagio.Utils.unpitchedUtils;Adagio.edit.common.extractContentUnpitchedInstruments=function(a){var c={};return a.forEach(d,c),b.getValues(c)};var d=function(a){var b=this;void 0!==a.instruments&&a.instruments.forEach(e,b)},e=function(b){var d=this,e=c.stringify(b.unpitched);if(e+="-"+b.notehead,void 0===d[e]){var f=a(b);d[e]=f}}}.call(this),function(){"use strict";var a=Adagio.edit.common.extractContentUnpitchedInstruments,b=Adagio.edit.common.checkUnpitchedInstrument,c=Adagio.Utils.unpitchedUtils;Adagio.edit.common.checkUnpitchedInstrumentsOnContent=function(b,c){var e=a(c.data.notes),f={scoreData:b,opts:c};e.forEach(d,f)};var d=function(a){var d=c.copy(a.unpitched),e={partIdx:this.opts.partIdx,notehead:a.notehead,unpitched:d};b(this.scoreData,e)}}.call(this),function(){"use strict";var a=Adagio.Error.client.NotPossibleOnUnpitchedError,b=Adagio.Error.client.NotPossibleOnPitchedError,c=Adagio.Error.client.BadTimePosError,d=Adagio.Error.client.BadVoiceError,e=Adagio.Error.value.NonBinaryDurationError,f=Adagio.Utils.math,g=Adagio.Utils.clone,h=Adagio.Utils.durationUtils,i=Adagio.Utils.measureUtils,j=Adagio.Utils.staffDetailsUtils,k=Adagio.Utils.transposeUtils,l=Adagio.edit.composite.InsertVoiceContentCrossMeasure,m=Adagio.edit.common.convertPartUuidToGetPartIdx,n=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,o=Adagio.edit.common.checkCompatibleVoiceStaffIdx,p=Adagio.edit.common.checkTupletCrossMeasure,q=Adagio.edit.common.getMeasuresScroller,r=Adagio.edit.common.transposeMeasureDump,s=Adagio.edit.common.checkUnpitchedInstrumentsOnContent,t=Adagio.edit.action.InsertVoiceContentCrossMeasure=function(a,b,c){this.init(a,b,c)};t.NAME="action.InsertVoiceContentCrossMeasure",t.removeTabData=function(a){a.attributes.staffDetails=j.createDefault(),a.notes.forEach(u)};var u=function(a){void 0!==a.heads&&a.heads.forEach(v)},v=function(a){delete a.fretData},w=t.prototype;w.name=t.NAME,w.init=function(a,b,c){m(a,b),n(a,b),this.measuresScroller=q(a,b),this.cancelStack=c,this.opts=b,this.sanitized=!1,this.location=null},w.checkPreconditions=function(){this.checkLocation(),this.checkPartType(),this.checkUnpitchedInstruments(),this.checkTimePos(),this.sanitizeIfNeeded(),this.checkCompatibleVoiceStaffIdx(),this.checkTupletCrossMeasure()},w.checkLocation=function(){this.measuresScroller.checkMeasureIdx(this.opts.measureIdx),this.measureData=this.measuresScroller.getMeasureData(this.opts.measureIdx),this.checkVoiceIdx()},w.checkVoiceIdx=function(){if(!this.measuresScroller.getScoreData().hasPartVoiceIdx(this.opts.partIdx,this.opts.voiceIdx))throw new d(this.opts.voiceIdx)},w.checkPartType=function(){var c=this.measuresScroller.getScoreData();if(this.opts.data.isUnpitched&&!c.isPartUnpitched(this.opts.partIdx))throw new b;if(!this.opts.data.isUnpitched&&c.isPartUnpitched(this.opts.partIdx))throw new a},w.checkUnpitchedInstruments=function(){var a=this.measuresScroller.getScoreData();this.opts.data.isUnpitched&&s(a,this.opts)},w.checkTimePos=function(){var a=h.divisionsToQuarter(this.opts.timePos,this.opts.dpq),b=this.measureData.getMeasure(),d=i.getQuarterDuration(b);if(!f.isNumber(a)||a<0||a>=d)throw new c(this.opts.timePos,this.opts.dpq);if(!h.isValidQuarter(a))throw new e(this.opts.timePos,this.opts.dpq)},w.checkCompatibleVoiceStaffIdx=function(){o(this.measureData,this.opts)},w.checkTupletCrossMeasure=function(){p(this.measuresScroller,this.opts)},w.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded(),this.shouldRemoveTabData()&&this.removeTabData(),this.transposeDumpIfNeeded(),this.storeAction(),this.insertVoiceContent()},w.sanitizeIfNeeded=function(){if(!this.sanitized){if(void 0===this.opts.staffIdx){var a=this.measureData.getScoreData();this.opts.staffIdx=a.getPartVoiceMainStaffIdx(this.opts.partIdx,this.opts.voiceIdx)}this.sanitized=!0}},w.shouldRemoveTabData=function(){if(this.opts.data.isUnpitched)return!1;var a=this.getDestStaffDetails();return!j.isSame(a,this.opts.data.attributes.staffDetails)},w.getDestStaffDetails=function(){return this.measuresScroller.getMeasureData(this.opts.measureIdx).getStaffDetails(this.opts.staffIdx)},w.transposeDumpIfNeeded=function(){if(!this.opts.data.isUnpitched){var a=this.getDestTranspose(),b=this.getSrcTranspose();if(!k.isSimilar(b,a)){var c=k.getDiff(a,b);c=k.getReverse(c),this.opts.data=r(this.opts.data,c),this.removeTabData()}}},w.getDestTranspose=function(){return this.measuresScroller.getMeasureData(this.opts.measureIdx).getTranspose(this.opts.staffIdx)},w.getSrcTranspose=function(){return this.opts.data.attributes.transpose},w.removeTabData=function(){t.removeTabData(this.opts.data)},w.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,timePos:this.opts.timePos,dpq:this.opts.dpq,data:g(this.opts.data)},c={actionName:this.name,opts:b};this.cancelStack.storeAction(c)}},w.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx);this.location={partUuid:b,measureUuid:c}}return this.location},w.insertVoiceContent=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,timePos:this.opts.timePos,dpq:this.opts.dpq,data:g(this.opts.data)};new l(this.measuresScroller,a,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.edit.action.InsertNotesAtTimePos,b=Adagio.edit.common.initMeasureData,c=Adagio.Utils.clone,d=Adagio.Utils.noteUtils,e=Adagio.edit.action.InsertNotesAtIdx=function(a,b,c){this.init(a,b,c)};e.NAME="action.InsertNotesAtIdx";var f=e.prototype;f.name=e.NAME,f.initMeasureData=b,f.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.action=null},f.checkPreconditions=function(){this.checkLocation(),this.getAction().checkPreconditions()},f.checkLocation=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.measureData.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},f.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a=this.getAction();a.cancelStack=this.cancelStack,a.perform()},f.getAction=function(){if(null===this.action){this.searchTupletStart();var b=this.getTimePos(),d=this.measureData.getDpqValue(),e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,timePos:b,dpq:d,data:c(this.opts.data)};this.action=new a(this.measureData,e,null)}return this.action},f.searchTupletStart=function(){var a=this.opts.noteIdx,b=this.measureData.getVoice(this.opts.voiceIdx),c=b.getNote(a);if(!d.hasNormalTimeModif(c))for(;!d.hasTupletStart(c);)a--,c=b.getNote(a);this.noteIdx=a},f.getTimePos=function(){return this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.noteIdx)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.fractionUtils,c=Adagio.edit.common.TimePositionsMeasuresMatcher=function(a,b,c){this.init(a,b,c)},d=c.prototype;d.init=function(a,c,d){this.scoreData=a,this.opts=c,this.entities=d,this.measureIdx=this.opts.measureIdx,this.position=b.create(0,1),this.entityIdx=0},d.splitEntities=function(){for(var a=[],b=this.entities.length,c=0;c<b;c++){var d=this.entities[c],e={stop:!0,timePos:d.stopTimePos,dpq:d.stopDpq};d.start=!0,d.timePos=d.startTimePos,d.dpq=d.startDpq,a.push(d),a.push(e)}this.entities=a},d.shiftEntities=function(){this.entities.forEach(this.shiftEntity,this)},d.shiftEntity=function(a){var c=b.create(a.timePos,a.dpq),d=b.create(this.opts.timePos,this.opts.dpq);c=b.add(c,d),a.timePos=b.getNumerator(c),a.dpq=b.getDenominator(c)},d.hasNext=function(){if(!this.hasNextEntity())return!1;var a=this.scoreData.getNbMeasures();return!(this.measureIdx>=a)&&(this.skipMeasures(),!(this.measureIdx>=a))},d.hasNextInside=function(){if(!this.hasNextEntity())return!1;var a=this.scoreData.getNbMeasures();return!(this.measureIdx>=a)&&(this.skipMeasuresInside(),!(this.measureIdx>=a))},d.hasNextEntity=function(){return this.entityIdx<this.entities.length},d.getEntity=function(){return this.entities[this.entityIdx]},d.skipMeasures=function(){var a=this.scoreData.getNbMeasures(),c=this.entities[this.entityIdx],d=b.create(c.timePos,c.dpq);d=b.sub(d,this.position);for(var e=this.getMeasureDuration(this.measureIdx);b.isGreaterOrEqualThan(d,e);){if(this.position=b.add(this.position,e),d=b.sub(d,e),++this.measureIdx>=a)return;e=this.getMeasureDuration(this.measureIdx)}},d.skipMeasuresInside=function(){var a=this.scoreData.getNbMeasures(),c=this.entities[this.entityIdx],d=b.create(c.timePos,c.dpq);d=b.sub(d,this.position);for(var e=this.getMeasureDuration(this.measureIdx);b.isGreater(d,e);){if(this.position=b.add(this.position,e),d=b.sub(d,e),++this.measureIdx>=a)return;e=this.getMeasureDuration(this.measureIdx)}},d.getNext=function(){var a=this.entities[this.entityIdx],c=b.create(a.timePos,a.dpq);c=b.sub(c,this.position);var d=b.getNumerator(c),e=b.getDenominator(c),f={entity:a,location:{measureIdx:this.measureIdx,timePos:d,dpq:e}};return this.entityIdx++,f},d.getMeasureDuration=function(c){var d=this.getMeasure(c),e=a.getDpq(d),f=a.getNbDivisions(d);return b.create(f,e)},d.getMeasure=function(a){return this.scoreData.getMeasure(this.opts.partIdx,a)}}.call(this),function(){"use strict";var a=Adagio.edit.action.AddDynamicAtTimePos,b=Adagio.edit.common.TimePositionsMeasuresMatcher,c=Adagio.edit.common.assertPerform,d=Adagio.edit.composite.InsertDynamics=function(a,b,c){this.init(a,b,c)};d.NAME="composite.InsertDynamics";var e=d.prototype;e.name=d.NAME,e.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:this.opts.timePos,dpq:this.opts.dpq},c=new b(this.scoreData,a,this.opts.dynamics);for(c.shiftEntities();c.hasNext();){var d=c.getNext();this.processEntry(d)}},e.processEntry=function(b){var d={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,measureIdx:b.location.measureIdx,timePos:b.location.timePos,dpq:b.location.dpq,style:b.entity.style,sound:b.entity.sound,placement:b.entity.placement},e=new a(this.scoreData,d,this.cancelStack);c(e)}}.call(this),function(){"use strict";var a=Adagio.edit.action.AddWordAtTimePos,b=Adagio.edit.common.TimePositionsMeasuresMatcher,c=Adagio.edit.common.assertPerform,d=Adagio.edit.composite.InsertWords=function(a,b,c){this.init(a,b,c)};d.NAME="composite.InsertWords";var e=d.prototype;e.name=d.NAME,e.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:this.opts.timePos,dpq:this.opts.dpq},c=new b(this.scoreData,a,this.opts.words);for(c.shiftEntities();c.hasNext();){var d=c.getNext();this.processEntry(d)}},e.processEntry=function(b){var d={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,measureIdx:b.location.measureIdx,timePos:b.location.timePos,dpq:b.location.dpq,text:b.entity.text,placement:b.entity.placement},e=new a(this.scoreData,d,this.cancelStack);c(e)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.edit.action.AddOctaveShiftAtTimePos,c=Adagio.edit.common.TimePositionsMeasuresMatcher,d=Adagio.edit.common.assertPerform,e=Adagio.edit.composite.InsertOctaveShifts=function(a,b,c){this.init(a,b,c)};e.NAME="composite.InsertOctaveShifts";var f=e.prototype;f.name=e.NAME,f.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.ongoing=null},f.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:this.opts.timePos,dpq:this.opts.dpq},b=new c(this.scoreData,a,this.opts.octaveShifts);for(b.splitEntities(),b.shiftEntities();g(b);){var d=b.getNext();this.processEntry(d)}};var g=function(b){if(!b.hasNextEntity())return!1;var c=b.getEntity();if(c.start)return b.hasNext();if(c.stop)return b.hasNextInside();throw new a("Unexpected")};f.processEntry=function(b){if(b.entity.start)this.processStart(b);else{if(!b.entity.stop)throw new a("Unexpected");this.processStop(b)}},f.processStart=function(b){if(this.hasOngoing())throw new a("Unexpected");this.ongoing=b},f.processStop=function(c){if(!this.hasOngoing())throw new a("Unexpected");var e=this.ongoing;this.ongoing=null;var f={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,startMeasureIdx:e.location.measureIdx,startTimePos:e.location.timePos,startDpq:e.location.dpq,size:e.entity.size,placement:e.entity.placement,stopMeasureIdx:c.location.measureIdx,stopTimePos:c.location.timePos,stopDpq:c.location.dpq},g=new b(this.scoreData,f,this.cancelStack);d(g)},f.hasOngoing=function(){return null!==this.ongoing}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.edit.action.AddTempoChangeAtTimePos,c=Adagio.edit.common.TimePositionsMeasuresMatcher,d=Adagio.edit.common.assertPerform,e=Adagio.edit.composite.InsertTempoChanges=function(a,b,c){this.init(a,b,c)};e.NAME="composite.InsertTempoChanges";var f=e.prototype;f.name=e.NAME,f.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.ongoing=null},f.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a={partIdx:0,measureIdx:this.opts.measureIdx,timePos:this.opts.timePos,dpq:this.opts.dpq},b=new c(this.scoreData,a,this.opts.tempoChanges);for(b.splitEntities(),b.shiftEntities();g(b);){var d=b.getNext();this.processEntry(d)}};var g=function(b){if(!b.hasNextEntity())return!1;var c=b.getEntity();if(c.start)return b.hasNext();if(c.stop)return b.hasNextInside();throw new a("Unexpected")};f.processEntry=function(b){if(b.entity.start)this.processStart(b);else{if(!b.entity.stop)throw new a("Unexpected");this.processStop(b)}},f.processStart=function(b){if(this.hasOngoing())throw new a("Unexpected");this.ongoing=b},f.processStop=function(c){if(!this.hasOngoing())throw new a("Unexpected");var e=this.ongoing;this.ongoing=null;var f={startMeasureIdx:e.location.measureIdx,startTimePos:e.location.timePos,startDpq:e.location.dpq,type:e.entity.type,stopMeasureIdx:c.location.measureIdx,stopTimePos:c.location.timePos,stopDpq:c.location.dpq},g=new b(this.scoreData,f,this.cancelStack);d(g)},f.hasOngoing=function(){return null!==this.ongoing}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.edit.action.AddPedalAtTimePos,c=Adagio.edit.common.TimePositionsMeasuresMatcher,d=Adagio.edit.common.assertPerform,e=Adagio.edit.composite.InsertPedals=function(a,b,c){this.init(a,b,c)};e.NAME="composite.InsertPedals";var f=e.prototype;f.name=e.NAME,f.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.ongoing=null},f.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:this.opts.timePos,dpq:this.opts.dpq},b=new c(this.scoreData,a,this.opts.pedals);for(b.splitEntities(),b.shiftEntities();g(b);){var d=b.getNext();this.processEntry(d)}};var g=function(b){if(!b.hasNextEntity())return!1;var c=b.getEntity();if(c.start)return b.hasNext();if(c.stop)return b.hasNextInside();throw new a("Unexpected")};f.processEntry=function(b){if(b.entity.start)this.processStart(b);else{if(!b.entity.stop)throw new a("Unexpected");this.processStop(b)}},f.processStart=function(b){if(this.hasOngoing())throw new a("Unexpected");this.ongoing=b},f.processStop=function(c){if(!this.hasOngoing())throw new a("Unexpected");var e=this.ongoing;this.ongoing=null;var f={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,startMeasureIdx:e.location.measureIdx,startTimePos:e.location.timePos,startDpq:e.location.dpq,placement:e.entity.placement,stopMeasureIdx:c.location.measureIdx,stopTimePos:c.location.timePos,stopDpq:c.location.dpq},g=new b(this.scoreData,f,this.cancelStack);d(g)},f.hasOngoing=function(){return null!==this.ongoing}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.edit.action.AddWedgeAtTimePos,c=Adagio.edit.common.TimePositionsMeasuresMatcher,d=Adagio.edit.common.assertPerform,e=Adagio.edit.composite.InsertWedges=function(a,b,c){this.init(a,b,c)};e.NAME="composite.InsertWedges";var f=e.prototype;f.name=e.NAME,f.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.ongoing=null},f.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:this.opts.timePos,dpq:this.opts.dpq},b=new c(this.scoreData,a,this.opts.wedges);for(b.splitEntities(),b.shiftEntities();g(b);){var d=b.getNext();this.processEntry(d)}};var g=function(b){if(!b.hasNextEntity())return!1;var c=b.getEntity();if(c.start)return b.hasNext();if(c.stop)return b.hasNextInside();throw new a("Unexpected")};f.processEntry=function(b){if(b.entity.start)this.processStart(b);else{if(!b.entity.stop)throw new a("Unexpected");this.processStop(b)}},f.processStart=function(b){if(this.hasOngoing())throw new a("Unexpected");this.ongoing=b},f.processStop=function(c){if(!this.hasOngoing())throw new a("Unexpected");var e=this.ongoing;this.ongoing=null;var f={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,startMeasureIdx:e.location.measureIdx,startTimePos:e.location.timePos,startDpq:e.location.dpq,placement:e.entity.placement,type:e.entity.type,stopMeasureIdx:c.location.measureIdx,stopTimePos:c.location.timePos,stopDpq:c.location.dpq},g=new b(this.scoreData,f,this.cancelStack);d(g)},f.hasOngoing=function(){return null!==this.ongoing}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadPartIdxError,b=Adagio.Error.client.BadStaffIdxError,c=Adagio.Utils.math,d=Adagio.Utils.clone,e=Adagio.Utils.partContentUtils,f=Adagio.Utils.measureUtils,g=Adagio.Utils.durationUtils,h=Adagio.Utils.staffDetailsUtils,i=Adagio.edit.action.InsertVoiceContentCrossMeasure,j=Adagio.edit.action.AddVoice,k=Adagio.edit.composite.InsertDynamics,l=Adagio.edit.composite.InsertWords,m=Adagio.edit.composite.InsertOctaveShifts,n=Adagio.edit.composite.InsertTempoChanges,o=Adagio.edit.composite.InsertPedals,p=Adagio.edit.composite.InsertWedges,q=Adagio.edit.common.convertPartUuidToGetPartIdx,r=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,s=Adagio.edit.common.checkTupletCrossMeasure,t=Adagio.edit.common.getMeasuresScroller,u=Adagio.edit.common.assertPerform,v=Adagio.edit.action.InsertStaffContentCrossMeasure=function(a,b,c){this.init(a,b,c)};v.NAME="action.InsertStaffContentCrossMeasure",v.removeTabData=function(a){a.voices.forEach(w)};var w=function(a){null!==a&&i.removeTabData(a.data)},x=v.prototype;x.name=v.NAME,x.init=function(a,b,c){q(a,b),r(a,b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.location=null,this.firstAction=null,this.actionsOpts=null,this.nextPositions={}},x.checkPreconditions=function(){this.checkLocation(),this.checkActions()},x.checkLocation=function(){var d=this.scoreData.getNbParts(),f=this.opts.partIdx;if(!c.isInteger(f)||f<0||f>=d)throw new a(f,a.GET);var g=this.opts.staffIdx,h=this.scoreData.getPartContent(this.opts.partIdx),i=e.getNbStaves(h);if(!c.isInteger(g)||g<0||g>=i)throw new b(g)},x.checkActions=function(){this.getFirstAction().checkPreconditions();var a=this.getActionsOpts();a=a.slice(1),a.forEach(this.checkTupletCrossMeasure,this)},x.checkTupletCrossMeasure=function(a){var b=t(this.scoreData,a);s(b,a)},x.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.shouldRemoveTabData()&&this.removeTabData(),this.storeAction(),this.opts.addVoice&&this.addVoiceIfNeeded(),this.performActions(),this.storePosition()},x.shouldRemoveTabData=function(){if(this.opts.data.isUnpitched)return!1;var a=this.getDestStaffDetails(a);return this.opts.data.voices.some(y,a)},x.getDestStaffDetails=function(){var a=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx);return f.getWrappedStaffDetails(a).getEntry(this.opts.staffIdx)};var y=function(a){if(null===a)return!1;var b=this;return!h.isSame(b,a.data.attributes.staffDetails)};x.removeTabData=function(){v.removeTabData(this.opts.data)},x.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={partUuid:a.partUuid,measureUuid:a.measureUuid,staffIdx:this.opts.staffIdx,timePos:this.opts.timePos,dpq:this.opts.dpq,addVoice:!!this.opts.addVoice,data:d(this.opts.data)},c={actionName:this.name,opts:b};this.cancelStack.storeAction(c)}},x.getLocation=function(){if(null===this.location){var a=this.scoreData.getPartUuid(this.opts.partIdx),b=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={
partUuid:a,measureUuid:b}}return this.location},x.addVoiceIfNeeded=function(){var a=this.opts.data.voices.filter(z).length;this.getNbVoices()<a&&(this.addVoice(),this.addVoiceOpts())};var z=function(a){return null!==a};x.addVoice=function(){var a={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,idxInStaff:1,show:!1},b=new j(this.scoreData,a,this.cancelStack);u(b)},x.addVoiceOpts=function(){var a=this.opts.data.voices[1];this.createOpts(a,1);var b=this.actionsOpts[1];this.updateOptsTimePos(b)},x.performActions=function(){this.addVoices(),this.insertDynamics(),this.insertWords(),this.insertOctaveShifts(),this.insertTempoChanges(),this.insertPedals(),this.insertWedges()},x.addVoices=function(){var a=this.getFirstAction();a.cancelStack=this.cancelStack,a.perform(),this.nextPositions[a.opts.voiceIdx]=this.cancelStack.getPosition();var b=this.getActionsOpts();b=b.slice(1),b.forEach(this.performOtherAction,this)},x.performOtherAction=function(a){var b=new i(this.scoreData,a,this.cancelStack);u(b),this.nextPositions[b.opts.voiceIdx]=this.cancelStack.getPosition()},x.addAction=function(a,b){if(null!==a){var c=this.scoreData.getPartStaffVoiceAtIdx(this.opts.partIdx,this.opts.staffIdx,b),e=this.getDpq(a),f=this.getTimePos(a,e),g={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,dpq:e,timePos:f,voiceIdx:c,staffIdx:this.opts.staffIdx,data:d(a.data)},h=null,j=new i(this.scoreData,g,h);this.actions.push(j)}},x.getFirstAction=function(){if(null===this.firstAction){var a=this.getActionsOpts(),b=a[0];this.firstAction=new i(this.scoreData,b,null)}return this.firstAction},x.getActionsOpts=function(){if(null===this.actionsOpts){this.actionsOpts=[];var a=this.opts.data.voices,b=this.getNbVoices();a=a.slice(0,b),a.forEach(this.createOpts,this),this.actionsOpts.sort(A),this.actionsOpts.forEach(this.updateOptsTimePos,this)}return this.actionsOpts},x.getNbVoices=function(){return this.scoreData.getPartStaffVoicesIndexes(this.opts.partIdx,this.opts.staffIdx).length},x.createOpts=function(a,b){if(null!==a){var c=this.scoreData.getPartStaffVoiceAtIdx(this.opts.partIdx,this.opts.staffIdx,b),e=this.getDpq(a),f=this.getTimePos(a,e),g={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,dpq:e,timePos:f,voiceIdx:c,staffIdx:this.opts.staffIdx,data:d(a.data)};return this.actionsOpts.push(g),g}};var A=function(a,b){return g.divisionsToQuarter(a.timePos,a.dpq)-g.divisionsToQuarter(b.timePos,b.dpq)};x.updateOptsTimePos=function(a){for(var b=g.divisionsToQuarter(a.timePos,a.dpq);;){var c=this.getMeasureQuarterDuration(a.measureIdx);if(!(b>=c))return void(a.timePos=g.quarterToDuration(b,a.dpq));b-=c,a.measureIdx++}},x.getMeasureQuarterDuration=function(a){var b=this.scoreData.getNbMeasures();a>=b&&(a=b-1);var c=this.scoreData.getMeasure(this.opts.partIdx,a);return f.getQuarterDuration(c)},x.getDpq=function(a){return c.lcm(a.dpq,this.opts.dpq)},x.getTimePos=function(a,b){return this.opts.timePos*b/this.opts.dpq+a.timePosShift*b/a.dpq},x.storePosition=function(){this.cancelStack.storePosition(this.nextPositions)},x.insertDynamics=function(){var a=this.opts.data.dynamics||[];if(a.length>0){a=d(a);var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,dpq:this.opts.dpq,timePos:this.opts.timePos,staffIdx:this.opts.staffIdx,dynamics:a};new k(this.scoreData,b,this.cancelStack).perform()}},x.insertWords=function(){var a=this.opts.data.words||[];if(a.length>0){a=d(a);var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,dpq:this.opts.dpq,timePos:this.opts.timePos,staffIdx:this.opts.staffIdx,words:a};new l(this.scoreData,b,this.cancelStack).perform()}},x.insertOctaveShifts=function(){var a=this.opts.data.octaveShifts||[];if(a.length>0){a=d(a);var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,dpq:this.opts.dpq,timePos:this.opts.timePos,staffIdx:this.opts.staffIdx,octaveShifts:a};new m(this.scoreData,b,this.cancelStack).perform()}},x.insertTempoChanges=function(){var a=this.opts.data.tempoChanges||[];if(a.length>0){a=d(a);var b={measureIdx:this.opts.measureIdx,dpq:this.opts.dpq,timePos:this.opts.timePos,tempoChanges:a};new n(this.scoreData,b,this.cancelStack).perform()}},x.insertPedals=function(){var a=this.opts.data.pedals||[];if(a.length>0){a=d(a);var b={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,measureIdx:this.opts.measureIdx,dpq:this.opts.dpq,timePos:this.opts.timePos,pedals:a};new o(this.scoreData,b,this.cancelStack).perform()}},x.insertWedges=function(){var a=this.opts.data.wedges||[];if(a.length>0){a=d(a);var b={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,measureIdx:this.opts.measureIdx,dpq:this.opts.dpq,timePos:this.opts.timePos,wedges:a};new p(this.scoreData,b,this.cancelStack).perform()}}}.call(this),function(){"use strict";var a=Adagio.edit.action.InsertStaffContentCrossMeasure,b=Adagio.edit.common.initMeasureData,c=Adagio.Utils.clone,d=Adagio.Utils.noteUtils,e=Adagio.edit.action.InsertStaffContentCrossMeasureAtIdx=function(a,b,c){this.init(a,b,c)};e.NAME="action.InsertStaffContentCrossMeasureAtIdx";var f=e.prototype;f.name=e.NAME,f.initMeasureData=b,f.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.action=null},f.checkPreconditions=function(){this.checkLocation(),this.getAction().checkPreconditions()},f.checkLocation=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.measureData.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},f.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a=this.getAction();a.cancelStack=this.cancelStack,a.perform(),this.storePosition()},f.getAction=function(){if(null===this.action){this.searchTupletStart();var b=this.getTimePos(),d=this.measureData.getDpqValue(),e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,timePos:b,dpq:d,addVoice:!!this.opts.addVoice,data:c(this.opts.data)},f=this.measureData.getScoreData();this.action=new a(f,e,null)}return this.action},f.searchTupletStart=function(){var a=this.opts.noteIdx,b=this.measureData.getVoice(this.opts.voiceIdx),c=b.getNote(a);if(!d.hasNormalTimeModif(c))for(;!d.hasTupletStart(c);)a--,c=b.getNote(a);this.noteIdx=a},f.getTimePos=function(){return this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.noteIdx)},f.storePosition=function(){var a=this.cancelStack.getPosition();this.cancelStack.storePosition(a[this.opts.voiceIdx])}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.math,c=Adagio.Utils.noteUtils,d=Adagio.Utils.timeModifUtils,e=Adagio.edit.common.hasTimePosExactNoteIdx,f=Adagio.edit.common.timePosToNoteIdx;Adagio.edit.common.initTupletCacheIfNeeded=function(a,b){new g(a,b).process()};var g=function(a,b){this.init(a,b)},h=g.prototype;h.init=function(a,b){this.measureData=a,this.opts=b,this.coeff=null},h.process=function(){this.hasTimePos()&&(this.checkHasTimeModif(),this.checkHasDivisions(),this.adaptTimePos(),this.hasTimePosExactNoteIdx()&&(this.convertTimePosToNoteIdx(),this.shouldInitTuplet()&&this.initTupletCache()))},h.hasTimePos=function(){return void 0!==this.opts.timePos},h.checkHasTimeModif=function(){if(void 0===this.opts.timeModif){throw new a("Unexpected","There should be a timeModif when there is a timePos value.")}},h.checkHasDivisions=function(){if(void 0===this.opts.divisions){throw new a("Unexpected","There should be a divisions value when there is a timePos value.")}},h.adaptTimePos=function(){var a=this.measureData.getDivisions().getDivisions(),c=b.lcm(a,this.opts.divisions),d=c/a,e=c/this.opts.divisions;this.opts.timePos*=e,this.opts.divisions*=e,this.coeff=d},h.hasTimePosExactNoteIdx=function(){var a=this.getVoice();return e(a,this.coeff,this.opts.timePos)},h.convertTimePosToNoteIdx=function(){var a=this.getVoice();this.opts.noteIdx=f(a,this.coeff,this.opts.timePos),delete this.opts.timePos,delete this.opts.divisions},h.shouldInitTuplet=function(){var a=this.getVoice(),b=a.getNote(this.opts.noteIdx);return c.hasTupletStart(b)&&d.isNormal(this.opts.timeModif)},h.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},h.initTupletCache=function(){this.measureData.initTupletCacheWithVoice(this.opts.voiceIdx)}}.call(this),function(){"use strict";var a=Adagio.edit.common.calcDuration,b=Adagio.edit.primitive.AddRest,c=Adagio.edit.action.RemoveBeamEdge,d=Adagio.edit.action.RemoveTie,e=Adagio.edit.action.RemoveTiePercu,f=Adagio.edit.action.RemoveGlissandos,g=Adagio.edit.action.RemoveHammerOnPullOffs,h=Adagio.edit.composite.AdaptDpqToDuration,i=Adagio.edit.composite.AdaptDpqToTimeSignature,j=Adagio.edit.composite.RemoveRests,k=Adagio.edit.composite.UnlockRests,l=Adagio.edit.values.InsertMode,m=Adagio.edit.common.initMeasureData,n=Adagio.edit.composite.InsertRest=function(a,b,c){this.init(a,b,c)};n.NAME="composite.InsertRest";var o=n.prototype;o.name=n.NAME,o.initMeasureData=m,o.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.breakConnection(),this.adaptDpqToNoteDuration(),this.adaptDpqToTimeSignature(),this.unlockRests(),this.addRest(),this.consumeSpace()},o.breakConnection=function(){this.removeLeftTie(),this.removeLeftGlissandos(),this.removeLeftHammerOnPullOffs(),this.removeBeamEdge()},o.removeLeftTie=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx-1};new(this.measureData.isUnpitched()?e:d)(this.measureData,a,this.cancelStack).performIfPossible()},o.removeLeftGlissandos=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx-1};new f(this.measureData,a,this.cancelStack).performIfPossible()},o.removeLeftHammerOnPullOffs=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx-1};new g(this.measureData,a,this.cancelStack).performIfPossible()},o.removeBeamEdge=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx-1};new c(this.measureData,a,this.cancelStack).performIfPossible()},o.adaptDpqToNoteDuration=function(){var a=this.getVoice(),b=a.getAbsoluteTimeModif(),c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,durationType:this.opts.durationType,nbDots:this.opts.nbDots,timeModif:b};new h(this.measureData,c,this.cancelStack).perform()},o.adaptDpqToTimeSignature=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx};new i(this.measureData,a,this.cancelStack).perform()},o.getVoice=function(){var a=this.opts.voiceIdx,b=this.opts.noteIdx;return this.measureData.getVoiceOrTupletForGet(a,b)},o.unlockRests=function(){var a=this.getDuration(),b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,insertMode:l.INSERT,duration:a};new k(this.measureData,b,this.cancelStack).perform()},o.addRest=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,noteIdx:this.opts.noteIdx,durationType:this.opts.durationType,nbDots:this.opts.nbDots};new b(this.measureData,a,this.cancelStack).perform()},o.consumeSpace=function(){var a=this.getDuration(),b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx+1,insertMode:l.INSERT,duration:a};new j(this.measureData,b,this.cancelStack).perform()},o.getDuration=function(){var b=this.measureData.getDivisionsPerQuarterValue(),c=this.opts.voiceIdx,d=this.opts.noteIdx,e=this.measureData.getVoiceOrTupletForGet(c,d),f=e.getAbsoluteTimeModif();return a(this.opts,b,f)}}.call(this),function(){"use strict";var a=Adagio.Utils.clone,b=Adagio.Utils.timeModifUtils,c=Adagio.edit.common.checkOptsDuration,d=Adagio.edit.common.checkCompatibleVoiceStaffIdx,e=Adagio.edit.common.checkSpaceForAdd,f=Adagio.edit.common.convertPartUuidToGetPartIdx,g=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,h=Adagio.edit.common.convertTimePosToInsertNoteIdx,i=Adagio.edit.common.initTupletCacheIfNeeded,j=Adagio.edit.composite.InsertRest,k=Adagio.edit.values.InsertMode,l=Adagio.edit.common.initMeasureData,m=Adagio.edit.action.InsertRest=function(a,b,c){this.init(a,b,c)};m.NAME="action.InsertRest";var n=m.prototype;n.name=m.NAME,n.initMeasureData=l,n.init=function(a,b,c){f(a,b),g(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.sanitized=!1,this.location=null,i(this.measureData,b),h(this.measureData,b)},n.checkPreconditions=function(){this.checkValues(),this.sanitizeIfNeeded(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkCompatibleVoiceStaffIdx(),this.checkNoteIdx(),this.checkSpace()},n.checkValues=function(){c(this.opts)},n.checkCompatibleVoiceStaffIdx=function(){d(this.measureData,this.opts)},n.checkNoteIdx=function(){this.measureData.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},n.checkSpace=function(){var b=a(this.opts);b.insertMode=k.INSERT,e(this.measureData,b)},n.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded();var a=this.getContextData();this.storeAction(a);var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,durationType:this.opts.durationType,nbDots:this.opts.nbDots};new j(this.measureData,b,this.cancelStack).perform(),this.updateStack(a)},n.getContextData=function(){var a=this.measureData.getVoiceOrTupletForGet(this.opts.voiceIdx,this.opts.noteIdx),c=a.getAbsoluteTimeModif();return c=b.copy(c),{timeModif:c}},n.sanitizeIfNeeded=function(){this.sanitized||(this.sanitized=!0)},n.storeAction=function(a){if(!this.cancelStack.hasAction()){var c=this.getLocation(),d=b.copy(a.timeModif),e={actionName:this.name,opts:{partUuid:c.partUuid,measureUuid:c.measureUuid,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,divisions:c.dpq,timePos:c.timePos,durationType:this.opts.durationType,nbDots:this.opts.nbDots,timeModif:d}};this.cancelStack.storeAction(e)}},n.updateStack=function(a){var c=this.getLocation(),d=b.copy(a.timeModif),e={type:this.name,noDraw:!0,opts:{partUuid:c.partUuid,measureUuid:c.measureUuid,voiceIdx:this.opts.voiceIdx,timePos:c.timePos,divisions:c.dpq,timeModif:d,durationType:this.opts.durationType,nbDots:this.opts.nbDots}};this.cancelStack.push(e)},n.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.Error.client.MoveCollisionError=function(b,d,e){var f=c(b,d,e),g=a.call(this,f);return this.name=g.name="MoveCollisionError",this.stack=g.stack,this.message=g.message,this.entity=e,this.fromIdx=b,this.toIdx=d,this};b.PART="part",b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a,b,c){return"cannot remove "+c+" from ["+a+"] to ["+b+"], these locations are equivalent. "}}.call(this),function(){"use strict";var a=Adagio.Error.client.MoveCollisionError,b=Adagio.Error.client.BadPartIdxError,c=Adagio.edit.common.partUuidToPartIdx,d=Adagio.edit.common.partUuidsToPartIdx,e=Adagio.edit.action.MovePart=function(a,b,c){this.init(a,b,c)};e.NAME="action.MovePart";var f=e.prototype;f.name=e.NAME,f.init=function(a,b,e){this.scoreData=a,this.cancelStack=e,this.opts=b,void 0===b.previousUuid&&void 0===b.nextUuid||(b.toPartIdx=d(a,b.previousUuid,b.nextUuid)),void 0!==b.fromPartUuid&&(b.fromPartIdx=c(a.getPartsHeaders(),b.fromPartUuid))},f.checkPreconditions=function(){var c=this.scoreData.getNbParts(),d=this.opts.fromPartIdx;if(d<0||d>=c)throw new b(d,b.GET);var e=this.opts.toPartIdx;if(e<0||e>c)throw new b(e,b.INSERT);if(e===d||e===d+1)throw new a(d,e,a.PART)},f.perform=function(){var a=this.getFromUuid(),b=this.getUuidsAround(a);this.scoreData.movePart(this.opts.fromPartIdx,this.opts.toPartIdx),this.updateStack(a,b);var c=this.getUuidsAround(a);this.storeAction(a,c)},f.getFromUuid=function(){return this.scoreData.getPartUuid(this.opts.fromPartIdx)},f.getUuidsAround=function(a){var b,d=c(this.scoreData.getPartsHeaders(),a);b=0===d?null:this.scoreData.getPartUuid(d-1);var e,f=this.scoreData.getNbParts();return e=d===f-1?null:this.scoreData.getPartUuid(d+1),{previousUuid:b,nextUuid:e}},f.updateStack=function(a,b){this.cancelStack=this.cancelStack.createSubstack(this.name);var c={type:this.name,opts:{fromPartUuid:a,previousUuid:b.previousUuid,nextUuid:b.nextUuid}};this.cancelStack.push(c),this.cancelStack.stateNeedCompleteRedraw()},f.storeAction=function(a,b){if(!this.cancelStack.hasAction()){var c={actionName:this.name,opts:{fromPartUuid:a,previousUuid:b.previousUuid,nextUuid:b.nextUuid}};this.cancelStack.storeAction(c)}}}.call(this),function(){"use strict";var a=Adagio.Utils.pitchUtils,b=Adagio.edit.action.AddAccidental,c=Adagio.edit.common.initMeasureData,d=Adagio.edit.common.convertPartUuidToGetPartIdx,e=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,f=Adagio.edit.action.RemoveAccidental=function(a,b,c){this.init(a,b,c)};f.NAME="action.RemoveAccidentals";var g=f.prototype;g.name=f.NAME,g.initMeasureData=c,g.init=function(a,b,c){d(a,b),e(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.action=null},g.checkPreconditions=function(){this.getAction().checkPreconditions()},g.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a=this.getAction();a.cancelStack=this.cancelStack,a.perform()},g.getAction=function(){if(null===this.action){var c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,divisions:this.opts.divisions,accidental:null,record:this.opts.record,isConcertPitch:this.opts.isConcertPitch};(void 0!==this.opts.line||this.opts.isConcertPitch)&&(c.staffIdx=this.opts.staffIdx),void 0!==this.opts.line?c.line=this.opts.line:c.pitch=a.copy(this.opts.pitch),void 0!==this.opts.noteIdx?c.noteIdx=this.opts.noteIdx:(c.divisions=this.opts.divisions,c.timePos=this.opts.timePos),this.action=new b(this.measureData,c,this.cancelStack)}return this.action}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadStaffIdxError,b=Adagio.Utils.measureUtils,c=Adagio.Utils.noteUtils,d=Adagio.edit.common.MeasureData,e=Adagio.edit.action.RemoveDynamicAtTimePos,f=Adagio.edit.action.RemoveDynamics=function(a,b,c){this.init(a,b,c)};f.NAME="action.RemoveDynamics";var g=f.prototype;g.name=f.NAME,g.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.voice=null,this.timePos=null,this.action=null},g.checkPreconditions=function(){this.checkLocation(),this.getAction().checkPreconditions()},g.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx);var c=this.getMeasure(),d=b.getNbStaves(c);if(this.opts.staffIdx<0||this.opts.staffIdx>=d)throw new a(this.opts.staffIdx);this.getVoice().checkInsertionIdx(this.opts.noteIdx)},g.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a=this.getAction();a.cancelStack=this.cancelStack,a.perform()},g.getAction=function(){if(null===this.action){var a=this.getTimePos(),c=this.getMeasure(),d=b.getDpq(c),f={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,dpq:d,timePos:a};this.action=new e(this.scoreData,f,this.cancelStack)}return this.action},g.getTimePos=function(){if(null===this.timePos){for(var a=0,b=this.getVoice(),d=0;d<this.opts.noteIdx;d++){var e=b.getNote(d);a+=c.getDuration(e)}this.timePos=a}return this.timePos},g.getVoice=function(){if(null===this.voice){var a=this.getMeasure(),b=new d(a);b.checkVoiceIdx(this.opts.voiceIdx),this.voice=b.getVoice(this.opts.voiceIdx)}return this.voice},g.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadStaffIdxError,b=Adagio.Error.client.BadDynamicIdxError,c=Adagio.Utils.math,d=Adagio.Utils.measureUtils,e=Adagio.Utils.direction.dynamicDirectionUtils,f=Adagio.edit.action.RemoveDynamicAtTimePos,g=Adagio.edit.common.convertPartUuidToGetPartIdx,h=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,i=Adagio.edit.action.RemoveDynamicAtIdx=function(a,b,c){this.init(a,b,c)};i.NAME="action.RemoveDynamicAtIdx";var j=i.prototype;j.name=i.NAME,j.init=function(a,b,c){g(a,b),h(a,b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.dynamics=null,this.measure=null,this.action=null},j.checkPreconditions=function(){var e=this.getMeasure(),f=d.getNbStaves(e),g=this.opts.staffIdx;if(!c.isInteger(g)||g<0||g>=f)throw new a(g);var h=this.getDynamics(),i=h.length,j=this.opts.dynamicIdx;if(!c.isInteger(j)||j<0||j>=i)throw new b(j);this.getAction().checkPreconditions()},j.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a=this.getAction();a.cancelStack=this.cancelStack,a.perform()},j.getAction=function(){if(null===this.action){var a=this.getTimePos(),b=this.getDpq(),c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,timePos:a,dpq:b};this.action=new f(this.scoreData,c,null)}return this.action},j.getTimePos=function(){var a=this.getDynamics(),b=a[this.opts.dynamicIdx];return e.getTimePos(b)},j.getDynamics=function(){if(null===this.dynamics){var a=this.getMeasure();this.dynamics=d.getDynamics(a,this.opts.staffIdx)}return this.dynamics},j.getDpq=function(){var a=this.getMeasure();return d.getDpq(a)},j.getMeasure=function(){return null===this.measure&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.edit.common.MeasureData,c=Adagio.edit.common.checkCompatibleVoiceStaffIdx,d=Adagio.edit.action.RemoveWedgeAtTimePos,e=Adagio.edit.action.RemoveWedge=function(a,b,c){this.init(a,b,c)};e.NAME="action.RemoveWedge";var f=e.prototype;f.name=e.NAME,f.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.timePos=null,this.measureData=null,this.action=null},f.checkPreconditions=function(){this.checkLocation(),this.fillTimePosFromNoteIdx(),this.getAction().checkPreconditions()},f.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx),this.getMeasureData().checkVoiceIdx(this.opts.voiceIdx),this.getVoice().checkNoteIdx(this.opts.noteIdx),c(this.scoreData,this.opts)},f.fillTimePosFromNoteIdx=function(){var a=this.getVoice();this.timePos=g(a,this.opts.noteIdx)};var g=function(b,c){for(var d=0,e=0;e<c;e++){var f=b.getNote(e);d+=a.getDuration(f)}return d};f.getVoice=function(){return this.getMeasureData().getVoice(this.opts.voiceIdx)},f.getMeasureData=function(){if(null===this.measureData){var a=this.getMeasure();this.measureData=new b(a)}return this.measureData},f.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},f.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.getAction().perform()},f.getAction=function(){if(null===this.action){var a=this.getMeasureData(),b=a.getDpqValue(),c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,timePos:this.timePos,dpq:b};this.action=new d(this.scoreData,c,this.cancelStack)}return this.action}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadStaffIdxError,b=Adagio.Error.client.BadWordIdxError,c=Adagio.Utils.math,d=Adagio.Utils.measureUtils,e=Adagio.Utils.direction.wordDirectionUtils,f=Adagio.edit.action.RemoveWordAtTimePos,g=Adagio.edit.common.convertPartUuidToGetPartIdx,h=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,i=Adagio.edit.action.RemoveWordAtIdx=function(a,b,c){this.init(a,b,c)};i.NAME="action.RemoveWordAtIdx";var j=i.prototype;j.name=i.NAME,j.init=function(a,b,c){g(a,b),h(a,b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.words=null,this.measure=null,this.action=null},j.checkPreconditions=function(){var e=this.getMeasure(),f=d.getNbStaves(e),g=this.opts.staffIdx;if(!c.isInteger(g)||g<0||g>=f)throw new a(g);var h=this.getWords(),i=h.length,j=this.opts.wordIdx;if(!c.isInteger(j)||j<0||j>=i)throw new b(j);this.getAction().checkPreconditions()},j.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a=this.getAction();a.cancelStack=this.cancelStack,a.perform()},j.getAction=function(){if(null===this.action){var a=this.getTimePos(),b=this.getDpq(),c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,timePos:a,dpq:b};this.action=new f(this.scoreData,c,null)}return this.action},j.getTimePos=function(){var a=this.getWords(),b=a[this.opts.wordIdx];return e.getTimePos(b)},j.getWords=function(){if(null===this.words){var a=this.getMeasure();this.words=d.getWords(a,this.opts.staffIdx)}return this.words},j.getDpq=function(){var a=this.getMeasure();return d.getDpq(a)},j.getMeasure=function(){return null===this.measure&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure}}.call(this),function(){"use strict";var a=Adagio.Utils.pitchUtils,b=Adagio.edit.action.AddGraceAccidental,c=Adagio.edit.common.initMeasureData,d=Adagio.edit.common.convertPartUuidToGetPartIdx,e=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,f=Adagio.edit.action.RemoveGraceAccidental=function(a,b,c){this.init(a,b,c)};f.NAME="action.RemoveGraceAccidentals";var g=f.prototype;g.name=f.NAME,g.initMeasureData=c,g.init=function(a,b,c){d(a,b),e(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.action=null},g.checkPreconditions=function(){this.getAction().checkPreconditions()},g.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a=this.getAction();a.cancelStack=this.cancelStack,a.perform()},g.getAction=function(){if(null===this.action){var c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,divisions:this.opts.divisions,graceIdx:this.opts.graceIdx,accidental:null,isConcertPitch:this.opts.isConcertPitch};(void 0!==this.opts.line||this.opts.isConcertPitch)&&(c.staffIdx=this.opts.staffIdx),void 0!==this.opts.line?c.line=this.opts.line:c.pitch=a.copy(this.opts.pitch),void 0!==this.opts.noteIdx?c.noteIdx=this.opts.noteIdx:(c.divisions=this.opts.divisions,c.timePos=this.opts.timePos),this.action=new b(this.measureData,c,this.cancelStack)}return this.action}}.call(this),function(){"use strict";var a=Adagio.Utils.clone,b=Adagio.edit.action.RemoveTie,c=Adagio.edit.action.RemoveTiePercu,d=Adagio.edit.common.initMeasureData,e=Adagio.edit.composite.RemoveStaffMeasureRightTies=function(a,b,c){this.init(a,b,c)};e.NAME="composite.RemoveStaffMeasureRightTies";var f=e.prototype;f.initMeasureData=d,f.name=e.NAME,f.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},f.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var d=this.measureData.getVoice(this.opts.voiceIdx),e=d.size()-1,f=a(this.opts);f.noteIdx=e,new(this.measureData.isUnpitched()?c:b)(this.measureData,f,this.cancelStack).performIfPossible()}}.call(this),function(){"use strict";var a=Adagio.Utils.clone,b=Adagio.edit.composite.RemoveStaffMeasureRightTies,c=Adagio.edit.common.initMeasureData,d=Adagio.edit.composite.RemoveMeasureRightTies=function(a,b,c){this.init(a,b,c)};d.NAME="composite.RemoveMeasureRightTies";var e=d.prototype;e.initMeasureData=c,e.name=d.NAME,e.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.measureData.forEachVoice(this.removeVoiceTies,this)},e.removeVoiceTies=function(c,d){var e=a(this.opts);e.voiceIdx=d,new b(this.measureData,e,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Utils.durationUtils,b=Adagio.Utils.noteUtils,c=Adagio.Utils.timeUtils,d=Adagio.Utils.math,e=Adagio.edit.values.InsertMode,f=Adagio.edit.composite.RemoveMeasureRightTies,g=Adagio.edit.composite.AddRests,h=Adagio.edit.primitive.IncreaseDivisions,i=Adagio.edit.common.initMeasureData,j=Adagio.edit.composite.IncreaseMeasureDuration=function(a,b,c){this.init(a,b,c)};j.NAME="composite.IncreaseMeasureDuration";var k=j.prototype;k.initMeasureData=i,k.name=j.NAME,k.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.divsPerQuarterCoeff=null,this.divisionsToAdd=null},k.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeMeasureRightTies(),this.calcDivsPerQuarterRatio(),this.increaseDivisionsIfNeeded(),this.addVoicesRests()},k.removeMeasureRightTies=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx};new f(this.measureData,a,this.cancelStack).perform()},k.calcDivsPerQuarterRatio=function(){var b=this.getDivsPerQuarter(),e=a.quarterToRequiredDivisions(this.opts.quarterDuration),f=this.measureData.getAnyTime(),g=c.getBeatType(f),h=a.beatTypeToQuarter(g),i=a.quarterToRequiredDivisions(h),j=d.lcm(b,e);j=d.lcm(j,i),this.divsPerQuarterCoeff=j/b},k.increaseDivisionsIfNeeded=function(){this.needIncreaseDivisions()&&this.increaseDivisions()},k.needIncreaseDivisions=function(){return this.divsPerQuarterCoeff>1},k.increaseDivisions=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,coeff:this.divsPerQuarterCoeff};new h(this.measureData,a,this.cancelStack).perform()},k.addVoicesRests=function(){this.measureData.forEachVoice(this.addVoiceRests,this)},k.addVoiceRests=function(a,b){this.measureData.initTupletCacheWithVoice(b);var c=this.getDivisionsToAdd(),d=a.getNbNotes(),f=this.getStaffIdxForVoice(b),h={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:b,staffIdx:f,noteIdx:d,insertMode:e.REPLACE,duration:c};new g(this.measureData,h,this.cancelStack).perform()},k.getDivisionsToAdd=function(){if(null===this.divisionsToAdd){var b=this.getDivsPerQuarter();this.divisionsToAdd=a.quarterToDuration(this.opts.quarterDuration,b)}return this.divisionsToAdd},k.getDivsPerQuarter=function(){return this.measureData.getDivisionsPerQuarterValue()},k.getStaffIdxForVoice=function(a){var c=this.getVoice(a),d=c.getStopNoteIdx(),e=c.getNote(d);return b.getStaffIdx(e)},k.getVoice=function(a){return this.measureData.getVoice(a)}}.call(this),function(){"use strict";var a=Adagio.edit.composite.RemoveVoiceTupletsAfter,b=Adagio.edit.common.initMeasureData,c=Adagio.edit.composite.RemoveMeasureTupletsAfter=function(a,b,c){this.init(a,b,c)};c.NAME="composite.RemoveMeasureTupletsAfter";var d=c.prototype;d.initMeasureData=b,d.name=c.NAME,d.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeVoicesTuplets()},d.removeVoicesTuplets=function(){this.measureData.forEachVoice(this.removeVoiceTuplets,this)},d.removeVoiceTuplets=function(b,c){var d={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:c,timePos:this.opts.timePos,divisions:this.opts.divisions};new a(this.measureData,d,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.edit.composite.RemoveVoiceNotesAfter,b=Adagio.edit.common.initMeasureData,c=Adagio.edit.composite.RemoveMeasureNotesAfter=function(a,b,c){this.init(a,b,c)};c.NAME="composite.RemoveMeasureNotesAfter";var d=c.prototype;d.initMeasureData=b,d.name=c.NAME,d.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeVoicesNotes()},d.removeVoicesNotes=function(){
this.measureData.forEachVoice(this.removeVoiceNotes,this)},d.removeVoiceNotes=function(b,c){var d={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:c,timePos:this.opts.timePos,divisions:this.opts.divisions};new a(this.measureData,d,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Utils.durationUtils,b=Adagio.Utils.noteUtils,c=Adagio.Utils.math,d=Adagio.Utils.timeUtils,e=Adagio.edit.values.InsertMode,f=Adagio.edit.composite.RemoveRests,g=Adagio.edit.composite.RemoveMeasureTupletsAfter,h=Adagio.edit.composite.RemoveMeasureNotesAfter,i=Adagio.edit.composite.RemoveHarmoniesFrom,j=Adagio.edit.composite.RemoveWedgesFrom,k=Adagio.edit.composite.RemoveDynamicsFrom,l=Adagio.edit.composite.RemovePizzicatosFrom,m=Adagio.edit.composite.RemoveWordsFrom,n=Adagio.edit.composite.RemovePedalsFrom,o=Adagio.edit.composite.RemoveOctaveShiftsFrom,p=Adagio.edit.composite.RemoveTempoChangesFrom,q=Adagio.edit.primitive.IncreaseDivisions,r=Adagio.edit.common.initMeasureData,s=Adagio.edit.composite.ReduceMeasureDuration=function(a,b,c){this.init(a,b,c)};s.NAME="composite.ReduceMeasureDuration";var t=s.prototype;t.initMeasureData=r,t.name=s.NAME,t.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.divsPerQuarterCoeff=null,this.divisions=null,this.timePos=null,this.divisionsToRemove=null},t.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.calcDivsPerQuarterRatio(),this.increaseDivisionsIfNeeded(),this.createTimePos(),this.removeHarmoniesFrom(),this.removeWedgesFrom(),this.removeDynamicsFrom(),this.removePizzicatosFrom(),this.removeWordsFrom(),this.removePedalsFrom(),this.removeTempoChangesFrom(),this.removeTupletsAfter(),this.removeNotesAfter(),this.removeVoicesRests()},t.calcDivsPerQuarterRatio=function(){var b=this.getDivsPerQuarter(),e=a.quarterToRequiredDivisions(this.opts.quarterDuration),f=this.measureData.getAnyTime(),g=d.getBeatType(f),h=a.beatTypeToQuarter(g),i=a.quarterToRequiredDivisions(h),j=c.lcm(b,e);j=c.lcm(j,i),this.divsPerQuarterCoeff=j/b},t.increaseDivisionsIfNeeded=function(){this.needIncreaseDivisions()&&this.increaseDivisions()},t.needIncreaseDivisions=function(){return this.divsPerQuarterCoeff>1},t.increaseDivisions=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,coeff:this.divsPerQuarterCoeff};new q(this.measureData,a,this.cancelStack).perform()},t.createTimePos=function(){this.divisions=this.measureData.getDivisionsPerQuarterValue();var a=this.getMeasureDuration(),b=this.getDivisionsToRemove();this.timePos=a-b},t.getMeasureDuration=function(){for(var a=this.measureData.getAnyVoice(),c=a.size(),d=0,e=0;e<c;e++){var f=a.getNote(e);d+=b.getDuration(f)}return d},t.removeHarmoniesFrom=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:this.timePos,dpq:this.divisions},b=this.measureData.scoreData;new i(b,a,this.cancelStack).perform()},t.removeWedgesFrom=function(){for(var a=this.measureData.getNbStaves(),b=0;b<a;b++){var c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:b,timePos:this.timePos,dpq:this.divisions},d=this.measureData.scoreData;new j(d,c,this.cancelStack).perform()}},t.removeDynamicsFrom=function(){for(var a=this.measureData.getNbStaves(),b=0;b<a;b++){var c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:b,timePos:this.timePos,dpq:this.divisions},d=this.measureData.scoreData;new k(d,c,this.cancelStack).perform()}},t.removePizzicatosFrom=function(){for(var a=this.measureData.getNbStaves(),b=0;b<a;b++){var c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:b,timePos:this.timePos,dpq:this.divisions},d=this.measureData.scoreData;new l(d,c,this.cancelStack).perform()}},t.removeWordsFrom=function(){for(var a=this.measureData.getNbStaves(),b=0;b<a;b++){var c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:b,timePos:this.timePos,dpq:this.divisions},d=this.measureData.scoreData;new m(d,c,this.cancelStack).perform()}},t.removePedalsFrom=function(){for(var a=this.measureData.getNbStaves(),b=0;b<a;b++){var c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:b,timePos:this.timePos,dpq:this.divisions},d=this.measureData.scoreData;new n(d,c,this.cancelStack).perform()}},t.removeTempoChangesFrom=function(){var a={measureIdx:this.opts.measureIdx,timePos:this.timePos,dpq:this.divisions},b=this.measureData.scoreData;new p(b,a,this.cancelStack).perform()},t.removeOctaveShiftsFrom=function(){for(var a=this.measureData.getNbStaves(),b=0;b<a;b++){var c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:b,timePos:this.timePos,dpq:this.divisions},d=this.measureData.scoreData;new o(d,c,this.cancelStack).perform()}},t.removeTupletsAfter=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,divisions:this.divisions,timePos:this.timePos};new g(this.measureData,a,this.cancelStack).perform()},t.removeNotesAfter=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,divisions:this.divisions,timePos:this.timePos};new h(this.measureData,a,this.cancelStack).perform()},t.removeVoicesRests=function(){this.measureData.forEachVoice(this.removeVoiceRests,this)},t.removeVoiceRests=function(a,b){this.measureData.initTupletCacheWithVoice(b);var c=this.getDivisionsToRemove(),d={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:b,noteIdx:0,insertMode:e.INSERT,duration:c};new f(this.measureData,d,this.cancelStack).perform()},t.getDivisionsToRemove=function(){if(null===this.divisionsToRemove){var b=this.getDivsPerQuarter();this.divisionsToRemove=a.quarterToDuration(this.opts.quarterDuration,b)}return this.divisionsToRemove},t.getDivsPerQuarter=function(){return this.measureData.getDivisionsPerQuarterValue()},t.getVoice=function(a){return this.measureData.getVoice(a)}}.call(this),function(){"use strict";var a=Adagio.Utils.durationUtils,b=Adagio.Utils.noteUtils,c=Adagio.edit.composite.IncreaseMeasureDuration,d=Adagio.edit.composite.ReduceMeasureDuration,e=Adagio.edit.common.initMeasureData,f=Adagio.edit.composite.UpdateMeasureDuration=function(a,b,c){this.init(a,b,c)};f.NAME="composite.UpdateMeasureDuration";var g=f.prototype;g.initMeasureData=e,g.name=f.NAME,g.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.quarterDiff=null},g.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.gatherQuarterDiff(),this.quarterDiff>0?this.increaseDuration():this.quarterDiff<0&&this.reduceDuration()},g.gatherQuarterDiff=function(){var a=this.getTimeQuarter(),b=this.getMeasureQuarter();this.quarterDiff=a-b},g.getTimeQuarter=function(){var b=this.measureData.getAnyTime();return a.timeToQuarter(b)},g.getMeasureQuarter=function(){for(var c=this.getDivsPerQuarter(),d=0,e=this.getAnyVoice(),f=e.size(),g=0;g<f;g++){var h=e.getNote(g);d+=b.getDuration(h)}return a.divisionsToQuarter(d,c)},g.getDivsPerQuarter=function(){return this.measureData.getDivisionsPerQuarterValue()},g.getAnyVoice=function(){return this.measureData.getAnyVoice()},g.increaseDuration=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,quarterDuration:this.quarterDiff};new c(this.measureData,a,this.cancelStack).perform()},g.reduceDuration=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,quarterDuration:-this.quarterDiff};new d(this.measureData,a,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.edit.action.FormatRests,b=Adagio.edit.common.assertPerform,c=Adagio.edit.common.initMeasureData,d=Adagio.Utils.noteUtils,e=Adagio.edit.composite.FormatMeasureRests=function(a,b,c){this.init(a,b,c)};e.NAME="composite.FormatMeasureRests";var f=e.prototype;f.name=e.NAME,f.initMeasureData=c,f.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},f.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.formatVoicesRests()},f.formatVoicesRests=function(){this.measureData.forEachVoice(this.formatVoiceRests,this)},f.formatVoiceRests=function(c,d){if(g(c)){var e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:d,noteIdx:0},f=new a(this.measureData,e,this.cancelStack);b(f)}};var g=function(a){var b=0;if(!a.isRest(b))return!1;var c=a.getNote(b);return!d.hasTupletStart(c)&&!d.needRestLock(c)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.timeUtils,c=Adagio.edit.common.initMeasureData,d=Adagio.edit.primitive.SetTimeSignature=function(a,b,c){this.init(a,b,c)};d.NAME="primitive.SetTimeSignature";var e=d.prototype;e.name=d.NAME,e.initMeasureData=c,e.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.previousTime=null},e.perform=function(){this.savePreviousTime(),this.setTimeSignature(),this.updateStack()},e.savePreviousTime=function(){var a=this.measureData.getAnyTime();this.previousTime=b.copy(a)},e.setTimeSignature=function(){for(var c=this.measureData.getTimes(),d=c.getNbStaves(),e=0;e<d;e++){var f=b.copy(this.opts.timeSignature);c.setEntry(f,e)}var g=c.dumpAttribute(),h=this.measureData.getMeasure();a.setTime(h,g)},e.updateStack=function(){var a=b.copy(this.previousTime),c=b.copy(this.opts.timeSignature),d={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,previousTimeSignature:a,newTimeSignature:c}};this.cancelStack.push(d)}}.call(this),function(){"use strict";var a=Adagio.Utils.timeUtils,b=Adagio.edit.composite.UpdateMeasureDuration,c=Adagio.edit.composite.FormatMeasureRests,d=Adagio.edit.primitive.SetTimeSignature,e=Adagio.edit.common.initMeasureData,f=Adagio.edit.composite.SetTimeSignature=function(a,b,c){this.init(a,b,c)};f.NAME="composite.SetTimeSignature";var g=f.prototype;g.initMeasureData=e,g.name=f.NAME,g.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},g.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.setTimeSignature(),this.updateMeasureDuration(),this.formatRests()},g.setTimeSignature=function(){var b=a.copy(this.opts.timeSignature),c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timeSignature:b};new d(this.measureData,c,this.cancelStack).perform()},g.updateMeasureDuration=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx};new b(this.measureData,a,this.cancelStack).perform()},g.formatRests=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx};new c(this.measureData,a,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Utils.timeUtils,b=Adagio.edit.composite.SetTimeSignature,c=Adagio.edit.common.initMeasureData,d=Adagio.edit.composite.SetTimeSignatureIfNeeded=function(a,b,c){this.init(a,b,c)};d.NAME="composite.SetTimeSignatureIfNeeded";var e=d.prototype;e.initMeasureData=c,e.name=d.NAME,e.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.previousTime=null},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.gatherPreviousTime(),this.needSetTime()&&this.setTime()},e.gatherPreviousTime=function(){var b=this.measureData.getAnyTime();this.previousTime=a.copy(b)},e.needSetTime=function(){return!a.isSame(this.opts.timeSignature,this.previousTime)},e.setTime=function(){var c=a.copy(this.opts.timeSignature),d={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timeSignature:c};new b(this.measureData,d,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Utils.timeUtils,b=Adagio.edit.composite.SetTimeSignatureIfNeeded,c=Adagio.edit.composite.SetMeasuresRangeTimeSignature=function(a,b,c){this.init(a,b,c)};c.NAME="composite.SetMeasuresRangeTimeSignature";var d=c.prototype;d.name=c.NAME,d.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);for(var a=this.opts.startMeasureIdx;a<=this.opts.stopMeasureIdx;a++)this.setMeasuresColumnTimeSignature(a)},d.setMeasuresColumnTimeSignature=function(a){for(var b=this.scoreData.getNbParts(),c=0;c<b;c++)this.setMeasureTimeSignature(c,a)},d.setMeasureTimeSignature=function(c,d){var e=a.copy(this.opts.timeSignature),f={partIdx:c,measureIdx:d,timeSignature:e};new b(this.scoreData,f,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Utils.timeUtils,b=Adagio.edit.composite.SetMeasuresRangeDisplayedTime=function(a,b,c){this.init(a,b,c)};b.NAME="composite.SetMeasuresRangeDisplayedTime";var c=b.prototype;c.name=b.NAME,c.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},c.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);for(var a=this.opts.startMeasureIdx;a<=this.opts.stopMeasureIdx;a++)this.setMeasureDisplayedTime(a)},c.setMeasureDisplayedTime=function(b){var c=a.copy(this.opts.displayedTime);this.scoreData.getCommonContent().setDisplayedTime(b,c)}}.call(this),function(){"use strict";var a=Adagio.Utils.timeUtils,b=Adagio.Utils.measureUtils,c=Adagio.edit.composite.UpdateMeasuresRangeOwnTimeSignature,d=Adagio.edit.composite.SetMeasuresRangeTimeSignature,e=Adagio.edit.composite.SetMeasuresRangeDisplayedTime,f=Adagio.edit.composite.SetTimeSegment=function(a,b,c){this.init(a,b,c)};f.NAME="composite.SetTimeSegment";var g=f.prototype;g.name=f.NAME,g.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},g.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.setTimeIfNeeded(),this.setDisplayedTimeIfNeeded()},g.setTimeIfNeeded=function(){this.needSetTime()&&this.setTime()},g.needSetTime=function(){var c=this.scoreData.getMeasure(0,this.opts.startMeasureIdx),d=b.getAnyTime(c);return!a.isSame(d,this.opts.timeSignature)},g.setTime=function(){var b=a.copy(this.opts.timeSignature),c={startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,timeSignature:b};new d(this.scoreData,c,this.cancelStack).perform()},g.setDisplayedTimeIfNeeded=function(){this.needSetDisplayedTime()&&(this.setDisplayedTime(),this.updateOwnTime())},g.needSetDisplayedTime=function(){var b=this.scoreData.getCommonContent(),c=b.getDisplayedTime(this.opts.startMeasureIdx);return!a.isSame(c,this.opts.displayedTime)},g.setDisplayedTime=function(){var b=a.copy(this.opts.displayedTime),c={startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,displayedTime:b};new e(this.scoreData,c,this.cancelStack).perform()},g.updateOwnTime=function(){var a={startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx};new c(this.scoreData,a,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadMeasureIdxError,b=Adagio.Error.noChange.SameAttrError,c=Adagio.Error.client.RevertRangeError,d=Adagio.Error.client.InconsistentAttributesError,e=Adagio.Utils.measureUtils,f=Adagio.Utils.timeUtils,g=Adagio.Utils.math,h=Adagio.edit.composite.SetTimeSegment,i=Adagio.edit.common.convertMeasuresUuidsToMeasuresIdxs,j=Adagio.edit.action.SetTimeSegment=function(a,b,c){this.init(a,b,c)};j.NAME="action.SetTimeSegment";var k=j.prototype;k.name=j.NAME,k.init=function(a,b,c){i(a,b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.firstTime=null,this.location=null,void 0===this.opts.displayedTime&&(this.opts.displayedTime=f.copy(this.opts.timeSignature))},k.checkPreconditions=function(){f.check(this.opts.timeSignature),f.check(this.opts.displayedTime),this.checkLocation(),this.checkDifferentTime(),this.checkCurrentConsistent()},k.checkLocation=function(){this.checkMeasureIdx(this.opts.startMeasureIdx),this.checkMeasureIdx(this.opts.stopMeasureIdx);var a=this.opts.startMeasureIdx,b=this.opts.stopMeasureIdx;if(b-a<0)throw new c(c.MEASURE,a,b)},k.checkMeasureIdx=function(b){var c=this.scoreData.getNbMeasures();if(!g.isInteger(b)||b<0||b>=c)throw new a(b,a.GET)},k.checkDifferentTime=function(){var a=this.getFirstTime(),c=this.opts.timeSignature,d=this.getFirstDisplayedTime(),e=this.opts.displayedTime;if(f.isSame(c,a)&&f.isSame(e,d))throw new b(b.TIME,f.copy(a),f.copy(c))},k.checkCurrentConsistent=function(){for(var a=this.scoreData.getCommonContent(),b=this.getFirstDisplayedTime(),c=this.getFirstTime(),e=this.opts.startMeasureIdx+1;e<=this.opts.stopMeasureIdx;e++){var g=this.getTime(e),h=a.getDisplayedTime(e);if(!f.isSame(g,c)||!f.isSame(h,b))throw new d(d.TIME)}},k.getFirstDisplayedTime=function(){return this.scoreData.getCommonContent().getDisplayedTime(this.opts.startMeasureIdx)},k.getFirstTime=function(){return null===this.firstTime&&(this.firstTime=this.getTime(this.opts.startMeasureIdx)),this.firstTime},k.getTime=function(a){var b=this.scoreData.getMeasure(0,a);return e.getWrappedTime(b).getAnyEntry()},k.getFirstMeasure=function(){return this.scoreData.getMeasure(0,this.opts.startMeasureIdx)},k.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a=this.getFirstTime();a=f.copy(a);var b=this.getFirstDisplayedTime();b=f.copy(b),this.setTimeSegment(),this.updateStack(a,b)},k.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b=a.measureUuids.slice(),c=f.copy(this.opts.timeSignature),d=f.copy(this.opts.displayedTime),e={actionName:this.name,opts:{measureUuids:b,timeSignature:c,displayedTime:d}};this.cancelStack.storeAction(e)}},k.setTimeSegment=function(){var a=f.copy(this.opts.timeSignature),b=f.copy(this.opts.displayedTime),c={startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,timeSignature:a,displayedTime:b};new h(this.scoreData,c,this.cancelStack).perform()},k.updateStack=function(a,b){var c=this.getLocation(),d=c.measureUuids.slice(),e=f.copy(this.opts.timeSignature),g=f.copy(this.opts.displayedTime),h={type:this.name,noDraw:!0,opts:{measureUuids:d,previousTime:a,previousDisplayedTime:b,newTime:e,newDisplayedTime:g}};this.cancelStack.push(h)},k.getLocation=function(){if(null===this.location){var a=this.scoreData.getMeasureUuids(this.opts.startMeasureIdx,this.opts.stopMeasureIdx);this.location={measureUuids:a}}return this.location}}.call(this),function(){"use strict";var a=Adagio.edit.composite.UpdateOwnTempo,b=Adagio.edit.composite.UpdateOwnSwing,c=Adagio.edit.composite.RemoveCommonContentMeasure=function(a,b,c){this.init(a,b,c)};c.NAME="composite.RemoveCommonContentMeasure";var d=c.prototype;d.name=c.NAME,d.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeMeasure(),this.hasRemovedAtEnd()||(this.updateOwnTempo(),this.updateOwnSwing())},d.removeMeasure=function(){this.scoreData.getCommonContent().removeMeasure(this.opts.measureIdx)},d.hasRemovedAtEnd=function(){var a=this.scoreData.getCommonContent(),b=a.getNbMeasures();return this.opts.measureIdx===b},d.updateOwnTempo=function(){var b={measureIdx:this.opts.measureIdx};new a(this.scoreData,b,this.cancelStack).perform()},d.updateOwnSwing=function(){var a={measureIdx:this.opts.measureIdx};new b(this.scoreData,a,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Error.client.RemoveLastError,c=Adagio.Utils.measureUtils,d=Adagio.Utils.clone,e=Adagio.Utils.timeUtils,f=Adagio.Utils.keyUtils,g=Adagio.Utils.clefUtils,h=Adagio.edit.action.SetTimeSegment,i=Adagio.edit.action.SetKeySegment,j=Adagio.edit.action.SetClefSegment,k=Adagio.edit.action.ShowMeasureVoice,l=Adagio.edit.action.HideMeasureVoice,m=Adagio.edit.primitive.RemoveMeasure,n=Adagio.edit.composite.ClearRightBarline,o=Adagio.edit.composite.ClearMeasureColumn,p=Adagio.edit.composite.RemoveCommonContentMeasure,q=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,r=Adagio.edit.common.MeasureData,s=Adagio.edit.action.RemoveMeasure=function(a,b,c){this.init(a,b,c)};s.NAME="action.RemoveMeasure";var t=s.prototype;t.name=s.NAME,t.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.uuids=null,q(this.scoreData,this.opts)},t.checkPreconditions=function(){if(this.scoreData.getMeasure(0,this.opts.measureIdx),this.scoreData.getPartContent(0).measure.length<=1)throw new b(b.MEASURE)},t.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a=this.getPreviousNextUuids();this.storeAction(a),this.clearMeasureColumn(),this.recordTimeSignature(a),this.recordAttributes(a),this.recordVoices(a),this.removeMeasures(),this.removeCommonContentMeasure(),this.removeHeader(),this.wasLastMeasure()&&this.restoreFinalBarline(),this.signalAttributesUpdated(),this.updateStack(a)},t.clearMeasureColumn=function(){var a={measureIdx:this.opts.measureIdx,clearBarlines:!0};new o(this.scoreData,a,this.cancelStack).perform()},t.recordTimeSignature=function(a){var b=this.scoreData.getMeasure(0,this.opts.measureIdx),d=c.getAnyTime(b);d=e.copy(d);var f=this.scoreData.getCommonContent(),g=f.getDisplayedTime(this.opts.measureIdx);g=e.copy(g);var i={type:h.NAME,noDraw:!0,opts:{measureUuids:[a.measureUuid],previousTime:d,previousDisplayedTime:g}};this.cancelStack.push(i)},t.recordAttributes=function(a){for(var b=this.scoreData.getNbParts(),c=0;c<b;c++)this.recordPartAttributes(c,a)},t.recordPartAttributes=function(a,b){if(!this.scoreData.isPartUnpitched(a))for(var d=this.scoreData.getPartUuid(a),e=this.scoreData.getMeasure(a,this.opts.measureIdx),h=new r(e),k=c.getNbStaves(e),l=0;l<k;l++){var m=h.getKey(l);m=f.copy(m);var n={type:i.NAME,noDraw:!0,opts:{partUuid:d,measureUuids:[b.measureUuid],previousKey:m,staffIdx:l}};this.cancelStack.push(n);var o=h.getClef(l);o=g.copy(o);var p={type:j.NAME,noDraw:!0,opts:{partUuid:d,measureUuids:[b.measureUuid],previousClef:o,staffIdx:l}};this.cancelStack.push(p)}},t.recordVoices=function(a){for(var b=this.scoreData.getNbParts(),c=0;c<b;c++)this.recordPartVoices(c,a)},t.recordPartVoices=function(a,b){var c=this.scoreData.getPartUuid(a),d=this.scoreData.getMeasure(a,this.opts.measureIdx),e=new r(d),f=this.scoreData.getPartVoicesIndexes(a);f.forEach(function(a){if(!e.hasVoice(a)){var d={partUuid:c,measureUuid:b.measureUuid,voiceIdx:a},f={type:k.NAME,noDraw:!0,opts:d};this.cancelStack.push(f)}},this),f.forEach(function(a){if(e.hasVoice(a)){var d={partUuid:c,measureUuid:b.measureUuid,voiceIdx:a},f={type:l.NAME,noDraw:!0,opts:d};this.cancelStack.push(f)}},this)},t.removeMeasures=function(){for(var a=this.scoreData.getPartsContents(),b=0;b<a.length;b++){var c=this.adaptOption(this.opts,b);new m(this.scoreData,c,this.cancelStack).perform()}},t.removeCommonContentMeasure=function(){var a={measureIdx:this.opts.measureIdx};new p(this.scoreData,a,this.cancelStack).perform()},t.wasLastMeasure=function(){return this.scoreData.getPartContent(0).measure.length===this.opts.measureIdx},t.restoreFinalBarline=function(){if(this.shouldRestoreFinalBarline()){var a={measureIdx:this.opts.measureIdx-1};new n(this.scoreData,a,this.cancelStack).perform()}},t.shouldRestoreFinalBarline=function(){var a=0,b=this.scoreData.getMeasure(a,this.opts.measureIdx-1);return!c.hasRightBarline(b)||"light"===c.getRightBarlineStyle(b)},t.signalAttributesUpdated=function(){this.opts.measureIdx>0&&this.signalMeasureAttributesUpdated(this.opts.measureIdx-1);var a=this.scoreData.getNbMeasures();this.opts.measureIdx<a&&this.signalMeasureAttributesUpdated(this.opts.measureIdx)},t.signalMeasureAttributesUpdated=function(a){this.scoreData.getPartsContents().forEach(function(b,c){var d={type:"primitive.updateAttributes",opts:{measureIdx:a,partIdx:c}};this.cancelStack.push(d)},this)},t.adaptOption=function(a,b){var c=d(a);return c.partIdx=b,c},t.removeHeader=function(){this.scoreData.removeMeasureHeader(this.opts.measureIdx)},t.getPreviousNextUuids=function(){if(null===this.uuids){var b={previousUuid:this.opts.measureIdx-1<0?null:this.scoreData.getMeasureUuid(this.opts.measureIdx-1),nextUuid:this.opts.measureIdx+1>=this.scoreData.getNbMeasuresHeaders()?null:this.scoreData.getMeasureUuid(this.opts.measureIdx+1),measureUuid:this.scoreData.getMeasureUuid(this.opts.measureIdx)};if(b.previousUuid===b.measureUuid||b.nextUuid===b.measureUuid){var c="The removed measure uuid ["+b.measureUuid+"] also apprears on the surroundings. ",d=new a("Inconsistency",c);throw d.measureUuid=b.measureUuid,d}this.uuids=b}return this.uuids},t.updateStack=function(a){var b={type:this.name,noDraw:!0,opts:{previousUuid:a.previousUuid,nextUuid:a.nextUuid,measureUuid:a.measureUuid}};this.cancelStack.push(b)},t.storeAction=function(a){if(!this.cancelStack.hasAction()){var b={actionName:this.name,opts:{previousUuid:a.previousUuid,nextUuid:a.nextUuid,measureUuid:a.measureUuid}};this.cancelStack.storeAction(b)}}}.call(this),function(){"use strict";var a=Adagio.edit.action.ClearMeasureColumn,b=Adagio.edit.action.RemoveMeasure,c=Adagio.edit.action.RemoveOrClearMeasure=function(a,b,c){this.init(a,b,c)};c.NAME="action.RemoveOrClearMeasure";var d=c.prototype;d.name=c.NAME,d.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.action=null},d.checkPreconditions=function(){this.getAction().checkPreconditions()},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a=this.getAction();a.cancelStack=this.cancelStack,a.perform()},d.getAction=function(){if(null===this.action){var a={measureIdx:this.opts.measureIdx,clearBarlines:!0},b=this.getActionConstructor();this.action=new b(this.scoreData,a,null)}return this.action},d.getActionConstructor=function(){return this.hasOnlyOneMeasure()?a:b},d.hasOnlyOneMeasure=function(){return 1===this.scoreData.getNbMeasures()}}.call(this),function(){"use strict";var a=Adagio.Error.client.NoNoteAtFretError,b=Adagio.Error.InternalError,c=Adagio.edit.common.initMeasureData,d=Adagio.edit.common.convertPartUuidToGetPartIdx,e=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,f=Adagio.edit.common.convertTimePosToGetNoteIdx,g=Adagio.edit.common.getNoteAtFretData,h=Adagio.edit.common.checkTabPart,i=Adagio.Utils.noteUtils,j=Adagio.Utils.pitchUtils,k=Adagio.Utils.clone,l=Adagio.edit.action.RemoveNote,m=Adagio.edit.action.RemoveNoteTab=function(a,b,c){this.init(a,b,c)};m.NAME="action.RemoveNoteTab";var n=m.prototype;n.name=m.NAME,n.initMeasureData=c,n.init=function(a,b,c){d(a,b),e(a,b),this.initMeasureData(a,b),this.opts=b,this.cancelStack=c,this.sanitized=!1,this.action=null,f(this.measureData,this.opts)},n.checkPreconditions=function(){this.checkTabPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx);var a=this.measureData.getVoice(this.opts.voiceIdx);a.checkNoteIdx(this.opts.noteIdx),a.checkNotRest(this.opts.noteIdx),this.sanitizeIfNeeded(),this.getRemoveAction().checkPreconditions()},n.checkTabPart=function(){h(this.measureData,this.opts)},n.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded(),this.getRemoveAction().perform()},n.sanitizeIfNeeded=function(){if(!this.sanitized){if(void 0===this.opts.fretData){throw new b("MissingFretData","fret data are expected for RemoveNoteTab")}this.opts.pitch=this.getFromFretData(),this.sanitized=!0}},n.getFromFretData=function(){var b=this.measureData.getVoice(this.opts.voiceIdx),c=g(b,this.opts.noteIdx,this.opts.fretData);if(void 0!==c){var d=i.getPitch(c);return d=j.copy(d)}var e=k(this.opts.fromFretData);throw new a(e)},n.getRemoveAction=function(){if(null===this.action){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:this.opts.pitch,insertMode:this.opts.insertMode,formatRests:this.opts.formatRests};this.action=new l(this.measureData,a,this.cancelStack)}return this.action}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError;(Adagio.edit.values.PartType={UNPITCHED:"unpitched",NORMAL:"normal"}).raiseError=function(b){throw new a("BadPartTypeValue","The part type: ["+b+"] is invalid")}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Error.client.RemoveLastError,c=Adagio.Error.client.BadPartIdxError,d=Adagio.Utils.partHeaderUtils,e=Adagio.Utils.scoreInstrumentUtils,f=Adagio.Utils.MIDIInstrumentUtils,g=Adagio.Utils.clefUtils,h=Adagio.Utils.keyUtils,i=Adagio.Utils.transposeUtils,j=Adagio.Utils.clone,k=Adagio.Utils.staffDetailsUtils,l=Adagio.edit.values.PartType,m=Adagio.edit.common.MeasureData,n=Adagio.edit.common.convertPartUuidToGetPartIdx,o=Adagio.edit.common.copyPitchMapping,p=Adagio.edit.composite.ClearPartMeasure,q=Adagio.edit.action.RemovePart=function(a,b,c){this.init(a,b,c)};q.NAME="action.RemovePart";var r=q.prototype;r.name=q.NAME,r.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,n(this.scoreData,this.opts),void 0===b.recordContent&&(b.recordContent=!0)},r.checkPreconditions=function(){var a=this.scoreData.getNbParts(),d=this.opts.partIdx;if(d<0||d>=a)throw new c(d,c.GET);if(a<2)throw new b(b.PART)},r.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a=this.getPreviousNextUuids(),b=this.getPreviousData();this.storeAction(a),this.opts.recordContent&&this.removeMeasures(),this.scoreData.removePart(this.opts.partIdx),this.updateStack(a,b)},r.getPreviousNextUuids=function(){var b,c=this.scoreData.getPartUuid(this.opts.partIdx);b=this.opts.partIdx>0?this.scoreData.getPartUuid(this.opts.partIdx-1):null;var d,e=this.scoreData.getNbParts();if(d=this.opts.partIdx+1<e-1?this.scoreData.getPartUuid(this.opts.partIdx+1):null,b===c||d===c){var f="The removed part uuid ["+this.opts.partUuid+"] also apprears on the surroundings. ",g=new a("Inconsistency",f);throw g.partUuid=this.opte.partUuid,g}return{previousUuid:b,partUuid:c,nextUuid:d}},r.getPreviousData=function(){var a=this.scoreData.getPartHeader(this.opts.partIdx),b=d.getStaffMapping(a),c={};c.name=d.getName(a),d.hasAbbreviation(a)&&(c.abbreviation=d.getAbbreviation(a)),c.volume=d.getGlobalVolume(a);var n,p=this.scoreData.getMeasure(this.opts.partIdx,0),q=new m(p);if(this.scoreData.isPartUnpitched(this.opts.partIdx)){c.partType=l.UNPITCHED;var r=d.getPitchMapping(a);c.pitchMapping=o(r),c.instrumentsList=d.getUnpitchedInstrumentsList(a),n=q.getStaffDetails(0),c.nbStaffLines=k.getNbStaffLines(n)}else{c.partType=l.NORMAL;var s=d.getScoreInstruments(a)[0];c.instrumentName=e.getName(s);var t=d.getMIDIInstruments(a)[0];c.MIDIProgram=f.getMIDIProgram(t);for(var u=[],v=q.getNbStaves(),w=0;w<v;w++){var x={},y=q.getClef(w);x.clef=g.copy(y);var z=q.getKey(w);x.key=h.copy(z);var A=q.getTranspose(w);x.transpose=i.copy(A),n=q.getStaffDetails(w),k.hasStaffTuning(n)&&(x.staffDetails=k.copy(n)),x.voicesData=j(b[w]),u.push(x)}c.staves=u}return c},r.storeAction=function(a){if(!this.cancelStack.hasAction()){var b={actionName:this.name,opts:{partUuid:a.partUuid}};this.cancelStack.storeAction(b)}},r.removeMeasures=function(){for(var a=this.scoreData.getNbMeasures(),b=0;b<a;b++)this.removeMeasure(b)},r.removeMeasure=function(a){var b={partIdx:this.opts.partIdx,measureIdx:a};new p(this.scoreData,b,this.cancelStack).perform()},r.updateStack=function(a,b){var c={previousUuid:a.previousUuid,nextUuid:a.nextUuid,partUuid:a.partUuid,name:b.name,partType:b.partType,volume:b.volume};void 0!==b.abbreviation&&(c.abbreviation=b.abbreviation),b.partType===l.UNPITCHED?(c.instrumentsList=b.instrumentsList,c.pitchMapping=b.pitchMapping,c.nbStaffLines=b.nbStaffLines):b.partType===l.NORMAL?(c.instrumentName=b.instrumentName,c.MIDIProgram=b.MIDIProgram,c.staves=j(b.staves)):l.raiseError(c.partType);var d={type:this.name,opts:c};this.cancelStack.push(d),this.cancelStack.stateNeedCompleteRedraw()}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadStaffIdxError,b=Adagio.Error.client.BadPizzicatoIdxError,c=Adagio.Utils.math,d=Adagio.Utils.measureUtils,e=Adagio.Utils.direction.pizzicatoDirectionUtils,f=Adagio.edit.action.RemovePizzicatoAtTimePos,g=Adagio.edit.common.convertPartUuidToGetPartIdx,h=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,i=Adagio.edit.action.RemovePizzicatoAtIdx=function(a,b,c){this.init(a,b,c)}
;i.NAME="action.RemovePizzicatoAtIdx";var j=i.prototype;j.name=i.NAME,j.init=function(a,b,c){g(a,b),h(a,b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.pizzicatos=null,this.measure=null,this.action=null},j.checkPreconditions=function(){var e=this.getMeasure(),f=d.getNbStaves(e),g=this.opts.staffIdx;if(!c.isInteger(g)||g<0||g>=f)throw new a(g);var h=this.getPizzicatos(),i=h.length,j=this.opts.pizzicatoIdx;if(!c.isInteger(j)||j<0||j>=i)throw new b(j);this.getAction().checkPreconditions()},j.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a=this.getAction();a.cancelStack=this.cancelStack,a.perform()},j.getAction=function(){if(null===this.action){var a=this.getTimePos(),b=this.getDpq(),c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,timePos:a,dpq:b};this.action=new f(this.scoreData,c,null)}return this.action},j.getTimePos=function(){var a=this.getPizzicatos(),b=a[this.opts.pizzicatoIdx];return e.getTimePos(b)},j.getPizzicatos=function(){if(null===this.pizzicatos){var a=this.getMeasure();this.pizzicatos=d.getPizzicatos(a,this.opts.staffIdx)}return this.pizzicatos},j.getDpq=function(){var a=this.getMeasure();return d.getDpq(a)},j.getMeasure=function(){return null===this.measure&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure}}.call(this),function(){"use strict";var a=Adagio.edit.action.ClearVoice,b=Adagio.edit.composite.ClearMeasureStaffFloatings,c=Adagio.edit.common.getMeasuresScroller,d=Adagio.edit.common.assertPerform,e=Adagio.edit.composite.ClearStaffContent=function(a,b,c){this.init(a,b,c)};e.NAME="composite.ClearStaffContent";var f=e.prototype;f.name=e.NAME,f.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.measuresScroller=null},f.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.clearVoices(),this.clearFloatting()},f.clearVoices=function(){var a=this.opts.partIdx,b=this.opts.staffIdx;this.scoreData.getPartStaffVoicesIndexes(a,b).forEach(this.clearVoice,this)},f.clearVoice=function(a){for(var b=this.scoreData.getNbMeasures(),c=0;c<b;c++){this.getMeasureData(c).hasVoice(a)&&this.clearMeasureVoice(a,c)}},f.clearMeasureVoice=function(b,c){var e=this.getMeasureData(c),f={partIdx:this.opts.partIdx,measureIdx:c,voiceIdx:b},g=new a(e,f,this.cancelStack);d(g)},f.getMeasureData=function(a){return this.getMeasuresScroller().getMeasureData(a)},f.getMeasuresScroller=function(){if(null===this.measuresScroller){var a={partIdx:this.opts.partIdx};this.measuresScroller=c(this.scoreData,a)}return this.measuresScroller},f.clearFloatting=function(){for(var a=this.scoreData.getNbMeasures(),b=0;b<a;b++)this.clearMeasureFloatting(b)},f.clearMeasureFloatting=function(a){var c={partIdx:this.opts.partIdx,measureIdx:a,staffIdx:this.opts.staffIdx};new b(this.scoreData,c,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Utils.partHeaderUtils,b=Adagio.Utils.mapUtils;Adagio.edit.common.removeStaffInPartHeader=function(e,f){a.getStaffMapping(e).splice(f,1);var g=a.getVoiceMapping(e);b.forEach(g,c,f),g=b.map(g,d,f),a.setVoiceMapping(e,g)};var c=function(a,b,c){var d=this.valueOf();b[0]===d&&delete c[a]},d=function(a,b){var c=this.valueOf();return b=b.filter(e,c),b=b.map(f,c)},e=function(a){return a!==this.valueOf()},f=function(a){return a>this.valueOf()?a-1:a}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.noteUtils;Adagio.edit.common.removeStaffInNotes=function(b,e){var f=a.getNotes(b);f=f.filter(c,e),a.setNotes(b,f),f.forEach(d,e)};var c=function(a){var c=this.valueOf();return b.getStaffIdx(a)!==c},d=function(a){var c=this.valueOf(),d=b.getStaffIdx(a);d>c&&(d--,b.setStaffIdx(a,d))}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.directionUtils,c=Adagio.Utils.intraMeasureUtils,d=Adagio.Utils.crossMeasureUtils;Adagio.edit.common.removeStaffInFloatings=function(b,c){var d=a.getNbStaves(b),h=a.getStaffContentMap(b);e(h,d,c),f(h,d,c),a.setStaffContentMap(b,h);var i=a.getLeftStaffMap(b);e(i,d,c),g(i,d,c),a.setLeftStaffMap(b,i);var j=a.getRightStaffMap(b);e(j,d,c),g(j,d,c),a.setRightStaffMap(b,j)};var e=function(a,b,c){delete a[c];for(var d=c+1;d<b;d++)if(void 0!==a[d]){var e=a[d];delete a[d],a[d-1]=e}},f=function(a,b,d){for(var e=d;e<b-1;e++)if(void 0!==a[e]){var f=a[e],g=c.getDynamics(f);g.forEach(h,e);var i=c.getPizzicatos(f);i.forEach(h,e);var j=c.getWords(f);j.forEach(h,e);var k=c.getPedals(f);k.forEach(h,e);var l=c.getOctaveShifts(f);l.forEach(h,e)}},g=function(a,b,c){for(var e=c;e<b-1;e++)if(void 0!==a[e]){var f=a[e];if(d.hasWedge(f)){var g=d.getWedge(f);i(g,e)}if(d.hasPedal(f)){var h=d.getPedal(f);i(h,e)}if(d.hasOctaveShift(f)){var j=d.getOctaveShift(f);i(j,e)}}},h=function(a){var b=this.valueOf();i(a,b)},i=function(a,c){b.setStaffIdx(a,c)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.directionUtils;Adagio.edit.common.removeStaffInDirections=function(b,e){var f=a.getRawDirections(b);f=f.filter(c,e),a.setDirections(b,f),f.forEach(d,e)};var c=function(a){var c=this.valueOf();return b.getStaffIdx(a)!==c},d=function(a){var c=this.valueOf(),d=b.getStaffIdx(a);d>c&&b.setStaffIdx(a,d-1)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.attributesUtils;Adagio.edit.common.removeStaffInAttributes=function(b,d){var e=a.getNbStaves(b),f=a.getAttributes(b);c(f,e,d),a.setAttributes(b,f);var g=a.getOwnAttributes(b);c(g,e,d),a.setOwnAttributes(b,g)};var c=function(a,c,d){var e=b.getWrappedStaffDetails(a,c);e.removeEntry(d);var f=e.dumpAttribute();b.setStaffDetails(a,f);var g=b.getWrappedClef(a,c);g.removeEntry(d);var h=g.dumpAttribute();b.setClef(a,h);var i=b.getWrappedKey(a,c);i.removeEntry(d);var j=i.dumpAttribute();b.setKey(a,j);var k=b.getWrappedTime(a,c);k.removeEntry(d);var l=k.dumpAttribute();b.setTime(a,l);var m=b.getWrappedTranspose(a,c);m.removeEntry(d);var n=m.dumpAttribute();b.setTranspose(a,n),b.hasNbStaves(a)&&b.setNbStaves(a,c-1)}}.call(this),function(){"use strict";var a=Adagio.edit.common.removeStaffInNotes,b=Adagio.edit.common.removeStaffInFloatings,c=Adagio.edit.common.removeStaffInDirections,d=Adagio.edit.common.removeStaffInAttributes;Adagio.edit.common.removeStaffInMeasure=function(e,f){a(e,f),b(e,f),c(e,f),d(e,f)}}.call(this),function(){"use strict";var a=Adagio.Utils.partContentUtils,b=Adagio.edit.common.removeStaffInPartHeader,c=Adagio.edit.common.removeStaffInMeasure,d=Adagio.edit.primitive.RemoveStaff=function(a,b,c){this.init(a,b,c)};d.NAME="primitive.RemoveStaff";var e=d.prototype;e.name=d.NAME,e.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},e.perform=function(){this.removeStaffInPartHeader(),this.removeStaffInMeasures()},e.removeStaffInPartHeader=function(){var a=this.scoreData.getPartHeader(this.opts.partIdx);b(a,this.opts.staffIdx)},e.removeStaffInMeasures=function(){var b=this.scoreData.getPartContent(this.opts.partIdx);a.getMeasures(b).forEach(this.removeStaffInMeasure,this)},e.removeStaffInMeasure=function(a){c(a,this.opts.staffIdx)}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.clefUtils,c=Adagio.Utils.keyUtils,d=Adagio.edit.action.SetClefSegment,e=Adagio.edit.action.SetKeySegment;Adagio.edit.common.logStaffAttributes=function(a,b,c,d){f(a,b,c,d),g(a,b,c,d)};var f=function(c,e,f,g){for(var h=c.getPartUuid(f),i=c.getNbMeasures(),j=0;j<i;j++){var k=c.getMeasure(f,j),l=a.getWrappedClef(k),m=l.getEntry(g);m=b.copy(m);var n=c.getMeasureUuids(j,j),o={type:d.NAME,noDraw:!0,opts:{partUuid:h,measureUuids:n,staffIdx:g,previousClef:m,newClef:null}};e.push(o)}},g=function(b,d,f,g){for(var h=b.getPartUuid(f),i=b.getNbMeasures(),j=0;j<i;j++){var k=b.getMeasure(f,j),l=a.getWrappedKey(k),m=l.getEntry(g);m=c.copy(m);var n=b.getMeasureUuids(j,j),o={type:e.NAME,noDraw:!0,opts:{partUuid:h,measureUuids:n,staffIdx:g,previousKey:m,newKey:null}};d.push(o)}}}.call(this),function(){"use strict";var a=Adagio.edit.composite.ClearStaffContent,b=Adagio.edit.primitive.RemoveStaff,c=Adagio.edit.common.logStaffAttributes,d=Adagio.edit.composite.RemoveStaff=function(a,b,c){this.init(a,b,c)};d.NAME="action.RemoveStaff";var e=d.prototype;e.name=d.NAME,e.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.clearStaffContent(),this.logStaffAttributes(),this.removeStaff()},e.clearStaffContent=function(){var b={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx};new a(this.scoreData,b,this.cancelStack).perform()},e.logStaffAttributes=function(){var a=this.opts.partIdx,b=this.opts.staffIdx;c(this.scoreData,this.cancelStack,a,b)},e.removeStaff=function(){var a={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx};new b(this.scoreData,a,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadStaffIdxError,b=Adagio.Error.client.RemoveLastError,c=Adagio.Error.client.BadPartIdxError,d=Adagio.Error.client.NotPossibleOnUnpitchedError,e=Adagio.Error.client.NotPossibleOnTabError,f=Adagio.edit.composite.RemoveStaff,g=Adagio.edit.common.convertPartUuidToGetPartIdx,h=Adagio.Utils.partContentUtils,i=Adagio.Utils.clone,j=Adagio.Utils.measureUtils,k=Adagio.Utils.clefUtils,l=Adagio.edit.action.RemoveStaff=function(a,b,c){this.init(a,b,c)};l.NAME="action.RemoveStaff";var m=l.prototype;m.name=l.NAME,m.init=function(a,b,c){g(a,b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.location=null},m.checkPreconditions=function(){var d=this.scoreData.getNbParts(),e=this.opts.partIdx;if(e<0||e>=d)throw new c(e);this.checkNotUnpitched(),this.checkNotTab();var f=this.scoreData.getPartContent(e),g=h.getNbStaves(f),i=this.opts.staffIdx;if(i<0||i>=g)throw new a(i);if(1===g)throw new b(b.STAFF)},m.checkNotUnpitched=function(){if(this.scoreData.isPartUnpitched(this.opts.partIdx))throw new d},m.checkNotTab=function(){if(this.scoreData.isPartTab(this.opts.partIdx))throw new e},m.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a=this.getPreviousData();this.removeStaff(),this.updateStack(a)},m.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={partUuid:a.partUuid,staffIdx:this.opts.staffIdx},c={actionName:this.name,opts:b};this.cancelStack.storeAction(c)}},m.getPreviousData=function(){var a=this.scoreData.getPartStaffMapping(this.opts.partIdx),b=a[this.opts.staffIdx],c=this.scoreData.getMeasure(this.opts.partIdx,0),d=j.getWrappedClef(c),e=d.getEntry(this.opts.staffIdx);return e=k.copy(e),{voicesData:i(b),clef:e}},m.removeStaff=function(){var a={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx};new f(this.scoreData,a,this.cancelStack).perform()},m.updateStack=function(a){var b=this.getLocation(),c=i(a.voicesData),d={type:this.name,opts:{partUuid:b.partUuid,staffIdx:this.opts.staffIdx,voicesData:c,clef:k.copy(a.clef)}};this.cancelStack.push(d),this.cancelStack.stateNeedCompleteRedraw()},m.getLocation=function(){if(null===this.location){var a=this.scoreData.getPartUuid(this.opts.partIdx);this.location={partUuid:a}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.client.NotTupletError,b=Adagio.Error.noChange.NoChangeError,c=Adagio.Utils.timeModifUtils,d=Adagio.edit.action.RemoveTuplet,e=Adagio.edit.action.ChangeDuration,f=Adagio.edit.common.initMeasureData,g=Adagio.edit.common.convertPartUuidToGetPartIdx,h=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,i=Adagio.edit.common.convertTimePosToGetNoteIdx,j=Adagio.edit.common.assertPerform,k=Adagio.edit.values.InsertMode,l=Adagio.edit.action.RemoveTupletChangeDuration=function(a,b,c){this.init(a,b,c)};l.NAME="action.RemoveTupletChangeDuration";var m=l.prototype;m.name=l.NAME,m.initMeasureData=f,m.init=function(a,b,c){g(a,b),h(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.location=null,this.startNoteIdx=null,i(this.measureData,this.opts)},m.checkPreconditions=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkNoteIdx(),this.checkTuplet()},m.checkNoteIdx=function(){this.measureData.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},m.checkTuplet=function(){var b=this.getVoiceOrTupletForGet(),d=b.getAbsoluteTimeModif();if(c.isNormal(d))throw new a},m.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.startNoteIdx=this.getStartNoteIdx(),this.durationType=this.getDurationType(),this.storeAction(),this.removeTuplet(),this.changeDuration()},m.getDurationType=function(){return this.getVoiceOrTupletForGet().getDurationType()},m.getStartNoteIdx=function(){return this.getVoiceOrTupletForGet().getStartNoteIdx()},m.getVoiceOrTupletForGet=function(){var a=this.opts.voiceIdx,b=this.opts.noteIdx;return this.measureData.getVoiceOrTupletForGet(a,b)},m.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.startTimePos}};this.cancelStack.storeAction(b)}},m.removeTuplet=function(){var a=this.getStartNoteIdx(),b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:a},c=new d(this.measureData,b,this.cancelStack);j(c)},m.changeDuration=function(){var a=this.getStartNoteIdx(),b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:a,durationType:this.durationType,nbDots:0,insertMode:k.REPLACE},c=new e(this.measureData,b,this.cancelStack);j(c,n)};var n=function(a){return a instanceof b};m.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.startNoteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,startTimePos:f}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.edit.action.ShowMeasureVoice,c=Adagio.edit.action.HideMeasureVoice,d=Adagio.edit.common.initMeasureData,e=Adagio.edit.common.assertPerform,f=Adagio.edit.composite.ForceHideMeasureVoice=function(a,b,c){this.init(a,b,c)};f.NAME="composite.ForceHideMeasureVoice";var g=f.prototype;g.name=f.NAME,g.initMeasureData=d,g.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},g.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.showOtherVoiceIfNeeded(),this.hideVoice()},g.showOtherVoiceIfNeeded=function(){if(this.needShowOtherVoice()){var a=this.getOtherVoiceIdx();this.showVoice(a)}},g.needShowOtherVoice=function(){var a=this.getStaffIdx();return this.measureData.getStaffNbVoices(a)<2},g.getOtherVoiceIdx=function(){for(var b=this.getStaffIdx(),c=this.measureData.getScoreData(),d=c.getPartStaffMapping(this.opts.partIdx),e=d[b],f=e.voices.length,g=0;g<f;g++){var h=e.voices[g];if(h!==this.opts.voiceIdx)return h}throw new a("Unexpected")},g.getStaffIdx=function(){return this.measureData.getScoreData().getPartVoiceMainStaffIdx(this.opts.partIdx,this.opts.voiceIdx)},g.showVoice=function(a){var c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:a},d=new b(this.measureData,c,this.cancelStack);e(d)},g.hideVoice=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx},b=new c(this.measureData,a,this.cancelStack);e(b)}}.call(this),function(){"use strict";var a=Adagio.edit.composite.ForceHideMeasureVoice,b=Adagio.edit.common.initMeasureData,c=Adagio.edit.composite.ForceHidePartVoice=function(a,b,c){this.init(a,b,c)};c.NAME="composite.ForceHidePartVoice";var d=c.prototype;d.name=c.NAME,d.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.forceHidePartVoice()},d.forceHidePartVoice=function(){for(var a=this.scoreData.getNbMeasures(),b=0;b<a;b++)this.forceHideMeasureVoiceIfNeeded(b)},d.forceHideMeasureVoiceIfNeeded=function(a){var b=this.getMeasureData(a);b.hasVoice(this.opts.voiceIdx)&&this.forceHideMeasureVoice(b,a)},d.getMeasureData=function(a){var c={partIdx:this.opts.partIdx,measureIdx:a},d={};return b.call(d,this.scoreData,c),d.measureData},d.forceHideMeasureVoice=function(b,c){var d={partIdx:this.opts.partIdx,measureIdx:c,voiceIdx:this.opts.voiceIdx};new a(b,d,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.edit.primitive.ChangeMainVoice=function(a,b,c){this.init(a,b,c)};a.NAME="primitive.ChangeMainVoice";var b=a.prototype;b.name=a.NAME,b.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},b.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.changeMainVoice()},b.changeMainVoice=function(){var a=this.scoreData.getPartVoiceMainStaffIdx(this.opts.partIdx,this.opts.mainVoiceIdx);this.scoreData.getPartStaffMapping(this.opts.partIdx)[a].mainVoiceIdx=this.opts.mainVoiceIdx}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.edit.primitive.ChangeMainVoice,c=Adagio.edit.composite.ChooseOtherMainVoice=function(a,b,c){this.init(a,b,c)};c.NAME="primitive.ChooseOtherMainVoice";var d=c.prototype;d.name=c.NAME,d.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.chooseOtherMainVoice()},d.chooseOtherMainVoice=function(){var a=this.getMainVoiceIdx();this.changeMainVoice(a)},d.getMainVoiceIdx=function(){var b=this.scoreData.getPartVoiceMainStaffIdx(this.opts.partIdx,this.opts.formerMainVoiceIdx),c=this.scoreData.getPartStaffMapping(this.opts.partIdx),d=c[b];if(d.mainVoiceIdx!==this.opts.formerMainVoiceIdx)throw new a("NoMainVoice");if(d.voices.length<2)throw new a("SingleVoice");return d.voices.includes(this.opts.candidateMainVoiceIdx)&&this.opts.candidateMainVoiceIdx!==d.mainVoiceIdx?this.opts.candidateMainVoiceIdx:e(d)};var e=function(b){for(var c=b.voices.length,d=0;d<c;d++){var e=b.voices[d];if(e!==b.mainVoiceIdx)return e}throw new a("Unexpected")};d.changeMainVoice=function(a){var c={partIdx:this.opts.partIdx,mainVoiceIdx:a};new b(this.scoreData,c,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Utils.partHeaderUtils,b=Adagio.Error.InternalError,c=Adagio.edit.primitive.RemoveVoice=function(a,b,c){this.init(a,b,c)};c.NAME="primitive.RemoveVoice";var d=c.prototype;d.name=c.NAME,d.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.addVoice()},d.addVoice=function(){var b=this.scoreData.getPartHeader(this.opts.partIdx),c=this.opts.voiceIdx,d=a.getVoiceMapping(b),e=d[c];delete d[c],a.setVoiceMapping(b,d),e.forEach(this.removeInStaffMapping,this)},d.removeInStaffMapping=function(a){var c=this.scoreData.getPartStaffMapping(this.opts.partIdx),d=c[a];if(d.mainVoiceIdx===this.opts.voiceIdx){throw new b("MainVoice","Cannot remove the main voice.")}var e=d.voices.indexOf(this.opts.voiceIdx);if(-1===e)throw new b("Unexpected");d.voices.splice(e,1)}}.call(this),function(){"use strict";var a=Adagio.edit.composite.ForceHidePartVoice,b=Adagio.edit.composite.ChooseOtherMainVoice,c=Adagio.edit.primitive.RemoveVoice,d=Adagio.edit.composite.RemoveVoice=function(a,b,c){this.init(a,b,c)};d.NAME="composite.RemoveVoice";var e=d.prototype;e.name=d.NAME,e.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.forceHidePartVoice(),this.isMainVoice()&&this.chooseOtherMainVoice(),this.removeVoice()},e.forceHidePartVoice=function(){var b={partIdx:this.opts.partIdx,voiceIdx:this.opts.voiceIdx};new a(this.scoreData,b,this.cancelStack).perform()},e.isMainVoice=function(){var a=this.scoreData.getPartVoiceMainStaffIdx(this.opts.partIdx,this.opts.voiceIdx),b=this.scoreData.getPartStaffMainVoiceIdx(this.opts.partIdx,a);return this.opts.voiceIdx===b},e.chooseOtherMainVoice=function(){var a={partIdx:this.opts.partIdx,formerMainVoiceIdx:this.opts.voiceIdx,candidateMainVoiceIdx:this.opts.candidateMainVoiceIdx};new b(this.scoreData,a,this.cancelStack).perform()},e.removeVoice=function(){var a={partIdx:this.opts.partIdx,voiceIdx:this.opts.voiceIdx};new c(this.scoreData,a,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadVoiceError,b=Adagio.Error.client.RemoveLastError,c=Adagio.Values.VoiceIdx,d=Adagio.edit.composite.RemoveVoice,e=Adagio.edit.common.convertPartUuidToGetPartIdx,f=Adagio.edit.action.RemoveVoice=function(a,b,c){this.init(a,b,c)};f.NAME="action.RemoveVoice";var g=f.prototype;g.name=f.NAME,g.init=function(a,b,c){e(a,b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.location=null,this.sanitized=!1},g.checkPreconditions=function(){if(c.check(this.opts.voiceIdx),!this.scoreData.hasPartVoiceIdx(this.opts.partIdx,this.opts.voiceIdx))throw new a(this.opts.voiceIdx);var d=this.scoreData.getPartVoiceMainStaffIdx(this.opts.partIdx,this.opts.voiceIdx);if(this.scoreData.getPartStaffNbVoices(this.opts.partIdx,d)<2)throw new b(b.VOICE)},g.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded(),this.storeAction();var a=this.getPreviousData();this.removeVoice(),this.updateStack(a)},g.sanitizeIfNeeded=function(){this.sanitized||(void 0===this.opts.candidateMainVoiceIdx&&(this.opts.candidateMainVoiceIdx=null),this.sanitized=!0)},g.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={partUuid:a.partUuid,voiceIdx:this.opts.voiceIdx,candidateMainVoiceIdx:this.opts.candidateMainVoiceIdx},c={actionName:this.name,opts:b};this.cancelStack.storeAction(c)}},g.getPreviousData=function(){var a=this.scoreData.getPartVoiceMainStaffIdx(this.opts.partIdx,this.opts.voiceIdx),b=this.scoreData.getPartStaffMapping(this.opts.partIdx),c=b[a];return{staffIdx:a,idxInStaff:c.voices.indexOf(this.opts.voiceIdx),isMainVoice:c.mainVoiceIdx===this.opts.voiceIdx}},g.removeVoice=function(){var a={partIdx:this.opts.partIdx,voiceIdx:this.opts.voiceIdx,candidateMainVoiceIdx:this.opts.candidateMainVoiceIdx};new d(this.scoreData,a,this.cancelStack).perform()},g.updateStack=function(a){var b=this.getLocation(),c={partUuid:b.partUuid,voiceIdx:this.opts.voiceIdx,staffIdx:a.staffIdx,idxInStaff:a.idxInStaff,isMainVoice:a.isMainVoice},d={type:this.name,noDraw:!0,opts:c};this.cancelStack.push(d)},g.getLocation=function(){if(null===this.location){var a=this.scoreData.getPartUuid(this.opts.partIdx);this.location={partUuid:a}}return this.location}}.call(this),function(){"use strict";var a=Adagio.edit.common.convertPartUuidToGetPartIdx,b=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,c=Adagio.edit.common.convertTimePosToGetNoteIdx,d=Adagio.edit.common.initMeasureData,e=Adagio.edit.common.getNoteAtPitch,f=Adagio.Error.client.NotPossibleOnUnpitchedError,g=Adagio.Error.client.PitchCollisionError,h=Adagio.Error.client.NoGlissandoToRemove,i=Adagio.Error.value.BadGlissandoNumberError,j=Adagio.Utils.pitchUtils,k=Adagio.Utils.noteUtils,l=Adagio.Values.GlissandoType,m=Adagio.edit.primitive.RemoveGlissandoSide,n=Adagio.edit.action.RemoveGlissandoSide=function(a,b,c){this.init(a,b,c)};n.NAME="action.RemoveGlissandoSide";var o=n.prototype;o.name=n.NAME,o.initMeasureData=d,o.init=function(d,e,f){a(d,e),b(d,e),this.initMeasureData(d,e),this.opts=e,this.cancelStack=f,this.noteAtPitch=null,this.location=null,this.sanitized=!1,c(this.measureData,e)},o.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkNoteIdx(),this.checkNotRest(),this.checkPitch(),this.checkNoteAtPitch(),this.sanitizeIfNeeded(),this.checkGlissandoType(),this.checkNumber(),this.checkExistence()},o.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new f},o.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},o.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},o.checkPitch=function(){j.check(this.opts.pitch)},o.checkNoteAtPitch=function(){if(void 0===this.getNoteAtPitch()){var a=j.copy(this.opts.pitch);throw new g(g.action.GET,a)}},o.sanitizeIfNeeded=function(){this.sanitized||(void 0===this.opts.number&&(this.opts.number=1),this.sanitized=!0)},o.checkGlissandoType=function(){l.check(this.opts.glissandoType)},o.checkNumber=function(){if("number"!=typeof this.opts.number||this.opts.number<0)throw new i(this.opts.number)},o.checkExistence=function(){var a=this.getNoteAtPitch();if(!k.hasGlissando(a,this.opts.glissandoType,this.opts.number))throw new h},o.getNoteAtPitch=function(){if(null===this.noteAtPitch){var a=this.getVoice();this.noteAtPitch=e(a,this.opts.noteIdx,this.opts.pitch)}return this.noteAtPitch},o.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:j.copy(this.opts.pitch),glissandoType:this.opts.glissandoType,number:this.opts.number};new m(this.measureData,a,this.cancelStack).perform(),this.updateStack()},o.updateStack=function(){var a=this.getLocation(),b={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,timePos:a.timePos,divisions:a.dpq,pitch:j.copy(this.opts.pitch),glissandoType:this.opts.glissandoType,number:this.opts.number}};this.cancelStack.push(b)},o.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,timePos:a.timePos,divisions:a.dpq,pitch:j.copy(this.opts.pitch),glissandoType:this.opts.glissandoType,number:this.opts.number}};this.cancelStack.storeAction(b)}},o.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.measureUtils,c=Adagio.Utils.math,d=Adagio.Utils.direction.pedalDirectionUtils,e=Adagio.edit.common.MeasureData,f=Adagio.edit.common.checkCompatibleVoiceStaffIdx,g=Adagio.edit.action.RemovePedalAtTimePos,h=Adagio.Error.client.BadPedalIdxError,i=Adagio.edit.action.RemovePedal=function(a,b,c){this.init(a,b,c)};i.NAME="action.RemovePedal";var j=i.prototype;j.name=i.NAME,j.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.timePos=null,this.measureData=null,this.action=null,this.sanitized=!1},j.checkPreconditions=function(){this.checkLocation(),this.sanitizeIfNeeded(),this.getAction().checkPreconditions()},j.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx),this.getMeasureData().checkVoiceIdx(this.opts.voiceIdx),f(this.scoreData,this.opts)},j.sanitizeIfNeeded=function(){if(!this.sanitized){if(void 0!==this.opts.pedalIdx){var a=this.getPedals();if(!c.isInteger(this.opts.pedalIdx)||this.opts.pedalIdx<0||this.opts.pedalIdx>=a.length)throw new h(this.opts.pedalIdx);var b=a[this.opts.pedalIdx];this.timePos=d.getTimePos(b)}if(void 0!==this.opts.noteIdx){var e=this.getVoice();e.checkNoteIdx(this.opts.noteIdx),this.timePos=k(e,this.opts.noteIdx)}this.sanitized=!0}};var k=function(b,c){for(var d=0,e=0;e<c;e++){var f=b.getNote(e);d+=a.getDuration(f)}return d};j.getVoice=function(){return this.getMeasureData().getVoice(this.opts.voiceIdx)},j.getMeasureData=function(){if(null===this.measureData){var a=this.getMeasure();this.measureData=new e(a)}return this.measureData},j.getPedals=function(){var a=this.getMeasure();return b.getPedals(a,this.opts.staffIdx)},j.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},j.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.getAction().perform()},j.getAction=function(){if(null===this.action){var a=this.getMeasureData(),b=a.getDpqValue(),c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,timePos:this.timePos,dpq:b};this.action=new g(this.scoreData,c,this.cancelStack)}return this.action}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.math,c=Adagio.Utils.direction.tempoChangeDirectionUtils,d=Adagio.edit.common.MeasureData,e=Adagio.edit.action.RemoveTempoChangeAtTimePos,f=Adagio.Error.client.BadTempoChangeIdxError,g=Adagio.edit.action.RemoveTempoChange=function(a,b,c){this.init(a,b,c)};g.NAME="action.RemoveTempoChange";var h=g.prototype;h.name=g.NAME,h.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.timePos=null,this.measureData=null,this.action=null,this.sanitized=!1},h.checkPreconditions=function(){this.checkLocation(),this.sanitizeIfNeeded(),this.getAction().checkPreconditions()},h.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx),this.getMeasureData().checkVoiceIdx(this.opts.voiceIdx)},h.sanitizeIfNeeded=function(){if(!this.sanitized){if(void 0!==this.opts.tempoChangeIdx){var a=this.getTempoChanges();if(!b.isInteger(this.opts.tempoChangeIdx)||this.opts.tempoChangeIdx<0||this.opts.tempoChangeIdx>=a.length)throw new f(this.opts.tempoChangeIdx);var d=a[this.opts.tempoChangeIdx];this.timePos=c.getTimePos(d),this.dpq=c.getDpq(d)}if(void 0!==this.opts.noteIdx){var e=this.getVoice();e.checkNoteIdx(this.opts.noteIdx),this.timePos=i(e,this.opts.noteIdx);var g=this.getMeasureData();this.dpq=g.getDpqValue()}this.sanitized=!0}};var i=function(b,c){for(var d=0,e=0;e<c;e++){var f=b.getNote(e);d+=a.getDuration(f)}return d};h.getVoice=function(){return this.getMeasureData().getVoice(this.opts.voiceIdx)},h.getMeasureData=function(){if(null===this.measureData){var a=this.getMeasure();this.measureData=new d(a)}return this.measureData},h.getTempoChanges=function(){return this.scoreData.getCommonContent().getTempoChanges(this.opts.measureIdx)},h.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},h.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.getAction().perform()},h.getAction=function(){if(null===this.action){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:this.timePos,dpq:this.dpq};this.action=new e(this.scoreData,a,this.cancelStack)}return this.action}}.call(this),function(){"use strict";var a=Adagio.Utils.noteUtils,b=Adagio.Utils.measureUtils,c=Adagio.Utils.math,d=Adagio.Utils.direction.octaveShiftDirectionUtils,e=Adagio.edit.common.MeasureData,f=Adagio.edit.common.checkCompatibleVoiceStaffIdx,g=Adagio.edit.action.RemoveOctaveShiftAtTimePos,h=Adagio.Error.client.BadOctaveShiftIdxError,i=Adagio.edit.action.RemoveOctaveShift=function(a,b,c){this.init(a,b,c)};i.NAME="action.RemoveOctaveShift";var j=i.prototype;j.name=i.NAME,j.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.timePos=null,this.measureData=null,this.action=null,this.sanitized=!1},j.checkPreconditions=function(){this.checkLocation(),this.sanitizeIfNeeded(),this.getAction().checkPreconditions()},j.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx),this.getMeasureData().checkVoiceIdx(this.opts.voiceIdx),f(this.scoreData,this.opts)},j.sanitizeIfNeeded=function(){if(!this.sanitized){if(void 0!==this.opts.octaveShiftIdx){
var a=this.getOctaveShifts();if(!c.isInteger(this.opts.octaveShiftIdx)||this.opts.octaveShiftIdx<0||this.opts.octaveShiftIdx>=a.length)throw new h(this.opts.octaveShiftIdx);var b=a[this.opts.octaveShiftIdx];this.timePos=d.getTimePos(b)}if(void 0!==this.opts.noteIdx){var e=this.getVoice();e.checkNoteIdx(this.opts.noteIdx),this.timePos=k(e,this.opts.noteIdx)}this.sanitized=!0}};var k=function(b,c){for(var d=0,e=0;e<c;e++){var f=b.getNote(e);d+=a.getDuration(f)}return d};j.getVoice=function(){return this.getMeasureData().getVoice(this.opts.voiceIdx)},j.getMeasureData=function(){if(null===this.measureData){var a=this.getMeasure();this.measureData=new e(a)}return this.measureData},j.getOctaveShifts=function(){var a=this.getMeasure();return b.getOctaveShifts(a,this.opts.staffIdx)},j.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},j.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.getAction().perform()},j.getAction=function(){if(null===this.action){var a=this.getMeasureData(),b=a.getDpqValue(),c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,timePos:this.timePos,dpq:b,transpose:!0};this.action=new g(this.scoreData,c,this.cancelStack)}return this.action}}.call(this),function(){"use strict";var a=Adagio.Error.client.MissingOptionError,b=Adagio.Utils.math,c=Adagio.Utils.pageMarginUtils,d=Adagio.edit.action.SetBottomMargin=function(a,b,c){this.init(a,b,c)};d.NAME="action.SetBottomMargin";var e=d.prototype;e.name=d.NAME,e.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},e.checkPreconditions=function(){if(c.checkType(this.opts.type),!b.isNumber(this.opts.millimeters)||this.opts.millimeters<=0)throw new a("millimeters")},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.scoreData.setPageBottomMarginMillimeters(this.opts.millimeters,this.opts.type),this.cancelStack.stateNeedCompleteRedraw()},e.storeAction=function(){if(!this.cancelStack.hasAction()){var a={actionName:this.name,opts:{millimeters:this.opts.millimeters,type:this.opts.type}};this.cancelStack.storeAction(a)}}}.call(this),function(){"use strict";var a=Adagio.Error.client.MissingOptionError,b=Adagio.edit.action.SetComposer=function(a,b,c){this.init(a,b,c)};b.NAME="action.SetComposer";var c=b.prototype;c.name=b.NAME,c.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},c.checkPreconditions=function(){if("string"!=typeof this.opts.composer)throw new a("composer")},c.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a=this.getPreviousComposer();this.storeAction(a),this.scoreData.setComposerStr(this.opts.composer),this.updateStack(a)},c.getPreviousComposer=function(){return this.scoreData.hasComposer()?this.scoreData.getComposerStr():""},c.updateStack=function(a){var b={previousComposer:a,newComposer:this.opts.composer},c={type:this.name,noDraw:!0,opts:b};this.cancelStack.push(c),this.cancelStack.stateNeedCompleteRedraw()},c.storeAction=function(a){if(!this.cancelStack.hasAction()){var b={actionName:this.name,opts:{previousComposer:a,composer:this.opts.composer}};this.cancelStack.storeAction(b)}}}.call(this),function(){"use strict";var a=Adagio.Error.client.MissingOptionError,b=Adagio.Utils.math,c=Adagio.Utils.pageMarginUtils,d=Adagio.edit.action.SetLeftMargin=function(a,b,c){this.init(a,b,c)};d.NAME="action.SetLeftMargin";var e=d.prototype;e.name=d.NAME,e.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},e.checkPreconditions=function(){if(c.checkType(this.opts.type),!b.isNumber(this.opts.millimeters)||this.opts.millimeters<=0)throw new a("millimeters")},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.scoreData.setPageLeftMarginMillimeters(this.opts.millimeters,this.opts.type),this.cancelStack.stateNeedCompleteRedraw()},e.storeAction=function(){if(!this.cancelStack.hasAction()){var a={actionName:this.name,opts:{millimeters:this.opts.millimeters,type:this.opts.type}};this.cancelStack.storeAction(a)}}}.call(this),function(){"use strict";var a=Adagio.Error.client.MissingOptionError,b=Adagio.edit.action.SetLyricist=function(a,b,c){this.init(a,b,c)};b.NAME="action.SetLyricist";var c=b.prototype;c.name=b.NAME,c.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},c.checkPreconditions=function(){if("string"!=typeof this.opts.lyricist)throw new a("lyricist")},c.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a=this.getPreviousLyricist();this.storeAction(a),this.scoreData.setLyricistStr(this.opts.lyricist),this.updateStack(a)},c.getPreviousLyricist=function(){return this.scoreData.hasLyricist()?this.scoreData.getLyricistStr():""},c.updateStack=function(a){var b={previousLyricist:a,newLyricist:this.opts.lyricist},c={type:this.name,noDraw:!0,opts:b};this.cancelStack.push(c),this.cancelStack.stateNeedCompleteRedraw()},c.storeAction=function(a){if(!this.cancelStack.hasAction()){var b={actionName:this.name,opts:{previousLyricist:a,lyricist:this.opts.lyricist}};this.cancelStack.storeAction(b)}}}.call(this),function(){"use strict";var a=Adagio.Error.client.MissingOptionError,b=Adagio.edit.action.SetRights=function(a,b,c){this.init(a,b,c)};b.NAME="action.SetRights";var c=b.prototype;c.name=b.NAME,c.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},c.checkPreconditions=function(){if("string"!=typeof this.opts.rights)throw new a("rights")},c.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a=this.getPreviousRights();this.scoreData.setRightsStr(this.opts.rights),this.updateStack(a)},c.storeAction=function(){if(!this.cancelStack.hasAction()){var a={actionName:this.name,opts:{rights:this.opts.rights}};this.cancelStack.storeAction(a)}},c.getPreviousRights=function(){return this.scoreData.hasRights()?this.scoreData.getRightsStr():""},c.updateStack=function(a){var b={previousRights:a,newRights:this.opts.rights},c={type:this.name,noDraw:!0,opts:b};this.cancelStack.push(c),this.cancelStack.stateNeedCompleteRedraw()}}.call(this),function(){"use strict";var a=Adagio.Error.client.MissingOptionError,b=Adagio.Utils.math,c=Adagio.edit.action.SetScaling=function(a,b,c){this.init(a,b,c)};c.NAME="action.SetScaling";var d=c.prototype;d.name=c.NAME,d.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},d.checkPreconditions=function(){if(!b.isNumber(this.opts.tenths)||this.opts.tenths<=0)throw new a("tenths");if(!b.isNumber(this.opts.millimeters)||this.opts.millimeters<=0)throw new a("millimeters")},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.scoreData.setScaling(this.opts.millimeters,this.opts.tenths),this.cancelStack.stateNeedCompleteRedraw()},d.storeAction=function(){if(!this.cancelStack.hasAction()){var a={actionName:this.name,opts:{millimeters:this.opts.millimeters,tenths:this.opts.tenths}};this.cancelStack.storeAction(a)}}}.call(this),function(){"use strict";var a=Adagio.Error.client.MissingOptionError,b=Adagio.edit.action.SetSubtitle=function(a,b,c){this.init(a,b,c)};b.NAME="action.SetSubtitle";var c=b.prototype;c.name=b.NAME,c.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},c.checkPreconditions=function(){if("string"!=typeof this.opts.subtitle)throw new a("subtitle")},c.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a=this.getPreviousSubtitle();this.storeAction(a),this.scoreData.setSubtitle(this.opts.subtitle),this.updateStack(a)},c.getPreviousSubtitle=function(){return this.scoreData.hasSubtitle()?this.scoreData.getSubtitle():""},c.updateStack=function(a){var b={previousSubtitle:a,newSubtitle:this.opts.subtitle},c={type:this.name,noDraw:!0,opts:b};this.cancelStack.push(c),this.cancelStack.stateNeedCompleteRedraw()},c.storeAction=function(a){if(!this.cancelStack.hasAction()){var b={actionName:this.name,opts:{previousSubtitle:a,subtitle:this.opts.subtitle}};this.cancelStack.storeAction(b)}}}.call(this),function(){"use strict";var a=Adagio.Error.noChange.NoChangeError,b=Adagio.Utils.systemBreakPolicyUtils,c=Adagio.edit.action.SetSystemBreakPolicy=function(a,b,c){this.init(a,b,c)};c.NAME="action.SetSystemBreakPolicy";var d=c.prototype;d.name=c.NAME,d.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},d.checkPreconditions=function(){b.check(this.opts.config);var c=this.scoreData.getSystemBreakPolicy();if(b.isSame(this.opts.config,c))throw new a},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a=this.getPreviousData();this.setSystemBreakPolicy(),this.updateStack(a)},d.storeAction=function(){if(!this.cancelStack.hasAction()){var a={actionName:this.name,opts:{config:b.copy(this.opts.config)}};this.cancelStack.storeAction(a)}},d.getPreviousData=function(){return{config:this.scoreData.getSystemBreakPolicy()}},d.setSystemBreakPolicy=function(){this.scoreData.setSystemBreakPolicy(b.copy(this.opts.config))},d.updateStack=function(a){var c={type:this.name,noDraw:!0,opts:{previousConfig:b.copy(a.config)}};this.cancelStack.push(c),this.cancelStack.stateNeedCompleteRedraw()}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.keyUtils,c=Adagio.edit.action.SetKeySegment,d=Adagio.edit.composite.SetKeyMain=function(a,b,c){this.init(a,b,c)};d.NAME="composite.SetKeyMain";var e=d.prototype;e.name=d.NAME,e.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.key=null,this.startMeasureIdx=null,this.stopMeasureIdx=null},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);for(var a=this.opts.startMeasureIdx,b=this.opts.stopMeasureIdx,c=a;c<=b;c++){var d=this.getKey(c);this.addKey(d,c)}this.finishSegment()},e.getKey=function(b){var c=this.scoreData.getMeasure(this.opts.partIdx,b);return a.getWrappedKey(c).getEntry(this.opts.staffIdx)},e.addKey=function(a,b){this.hasOngoing()?this.isSameKey(a)?this.continueSegment(b):(this.finishSegment(),this.startSegment(a,b)):this.startSegment(a,b)},e.hasOngoing=function(){return null!==this.key},e.startSegment=function(a,c){this.key=b.copy(a),this.startMeasureIdx=c,this.stopMeasureIdx=c},e.isSameKey=function(a){return b.isSame(a,this.key)},e.continueSegment=function(a){this.stopMeasureIdx=a},e.finishSegment=function(){b.isSame(this.key,this.opts.key)||this.setKeySegment(this.startMeasureIdx,this.stopMeasureIdx),this.key=null,this.startMeasureIdx=null,this.stopMeasureIdx=null},e.setKeySegment=function(a,d){var e=b.copy(this.opts.key),f={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,startMeasureIdx:a,stopMeasureIdx:d,key:e},g=new c(this.scoreData,f,this.cancelStack);g.checkPreconditions(),g.perform()}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadMeasureIdxError,b=Adagio.Error.client.RevertRangeError,c=Adagio.Error.noChange.SameAttrError,d=Adagio.Error.client.NotPossibleOnUnpitchedError,e=Adagio.Error.client.BadVoiceError,f=Adagio.Utils.measureUtils,g=Adagio.Utils.keyUtils,h=Adagio.Utils.math,i=Adagio.edit.composite.SetKeyMain,j=Adagio.edit.common.convertPartUuidToGetPartIdx,k=Adagio.edit.common.convertMeasuresUuidsToMeasuresIdxs,l=Adagio.edit.common.convertMeasuresFirstLast,m=Adagio.edit.action.SetKey=function(a,b,c){this.init(a,b,c)};m.NAME="action.SetKey";var n=m.prototype;n.name=m.NAME,n.init=function(a,b,c){j(a,b),k(a,b),l(a,b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.location=null},n.checkPreconditions=function(){g.check(this.opts.key),this.checkPitchedPart(),this.checkLocation(),this.checkDifferentKey()},n.checkPitchedPart=function(){if(this.scoreData.isPartUnpitched(this.opts.partIdx))throw new d},n.checkLocation=function(){this.checkMeasureIdx(this.opts.startMeasureIdx),this.checkMeasureIdx(this.opts.stopMeasureIdx);var a=this.opts.startMeasureIdx,c=this.opts.stopMeasureIdx;if(c-a<0)throw new b(b.MEASURE,a,c);var d=this.getFirstMeasure(),g=f.getNbStaves(d),i=this.opts.staffIdx;if(!h.isInteger(i)||i<0||i>=g)throw new e(i,e.GET)},n.checkMeasureIdx=function(b){var c=this.scoreData.getNbMeasures();if(!h.isInteger(b)||b<0||b>=c)throw new a(b,a.GET)},n.checkDifferentKey=function(){if(!this.hasSomeDifferent())throw new c(c.KEY)},n.hasSomeDifferent=function(){for(var a=this.opts.startMeasureIdx;a<=this.opts.stopMeasureIdx;a++){var b=this.getKey(a);if(!g.isSame(b,this.opts.key))return!0}return!1},n.getKey=function(a){var b=this.scoreData.getMeasure(this.opts.partIdx,a);return f.getWrappedKey(b).getEntry(this.opts.staffIdx)},n.getFirstMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.startMeasureIdx)},n.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.setKey()},n.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b=a.measureUuids.slice(),c=g.copy(this.opts.key),d={actionName:this.name,opts:{partUuid:a.partUuid,measureUuids:b,staffIdx:this.opts.staffIdx,key:c}};this.cancelStack.storeAction(d)}},n.getLocation=function(){if(null===this.location){var a=this.scoreData.getMeasureUuids(this.opts.startMeasureIdx,this.opts.stopMeasureIdx),b=this.scoreData.getPartUuid(this.opts.partIdx);this.location={partUuid:b,measureUuids:a}}return this.location},n.setKey=function(){var a=g.copy(this.opts.key),b={partIdx:this.opts.partIdx,startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,staffIdx:this.opts.staffIdx,key:a};new i(this.scoreData,b,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadKeyTransposeError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadKeyTransposeError",this.stack=e.stack,this.message=e.message,this.keyTranspose=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"the keyTranspose option ["+a+"] is invalid."}}.call(this);(function(){"use strict";var a=Adagio.Error.value.BadKeyTransposeError,b=Adagio.edit.values.KeyTranspose={NONE:"none",UP:"up",DOWN:"down"};b.values=[b.NONE,b.UP,b.DOWN],b.DEFAULT=b.NONE,b.valueOrDefault=function(a){return void 0!==a?a:b.DEFAULT},b.check=function(c){if(!b.values.includes(c))throw new a(c)},b.isTranspose=function(a){return a===b.UP||a===b.DOWN}}).call(this),function(){"use strict";var a=Adagio.Error.noChange.NoChangeError,b=Adagio.Error.client.NotPossibleOnUnpitchedError,c=Adagio.Utils.partContentUtils,d=Adagio.Utils.measureUtils,e=Adagio.Utils.keyUtils,f=Adagio.Utils.transposeUtils,g=Adagio.edit.action.SetKey,h=Adagio.edit.common.assertPerform,i=Adagio.edit.common.convertMeasuresUuidsToMeasuresIdxs,j=Adagio.edit.common.convertMeasuresFirstLast,k=Adagio.edit.values.KeyTranspose,l=Adagio.edit.action.SetKeyColumn=function(a,b,c){this.init(a,b,c)};l.NAME="action.SetKeyColumn";var m=l.prototype;m.name=l.NAME,m.init=function(a,b,c){i(a,b),j(a,b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.opts.keyTranspose=k.valueOrDefault(this.opts.keyTranspose),this.wrappedActions=null,this.location=null},m.checkPreconditions=function(){e.check(this.opts.concertKey),this.checkActions()},m.checkActions=function(){var a=this.getWrappedActions();if(!a.some(n))throw a[0].error};var n=function(a){try{a.action.checkPreconditions()}catch(b){if(o(b))return a.checked=!0,a.error=b,!1;throw b}return a.checked=!0,!0};m.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.getWrappedActions().forEach(this.callPerform,this)},m.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b=a.measureUuids.slice(),c=e.copy(this.opts.concertKey),d={actionName:this.name,opts:{measureUuids:b,concertKey:c}};this.cancelStack.storeAction(d)}},m.getLocation=function(){if(null===this.location){var a=this.scoreData.getMeasureUuids(this.opts.startMeasureIdx,this.opts.stopMeasureIdx);this.location={measureUuids:a}}return this.location},m.getWrappedActions=function(){return null===this.wrappedActions&&this.createWrappedActions(),this.wrappedActions},m.createWrappedActions=function(){this.wrappedActions=[];for(var a=this.scoreData.getNbParts(),b=0;b<a;b++)this.addPartActions(b)},m.addPartActions=function(a){for(var b=this.scoreData.getPartContent(a),g=c.getFirstMeasure(b),h=d.getNbStaves(g),i=d.getWrappedTranspose(g),j=0;j<h;j++){var k=i.getEntry(j);k=f.getReverse(k);var l=e.transpose(this.opts.concertKey,k);this.addStaffAction(a,j,l)}},m.addStaffAction=function(a,b,c){var d={partIdx:a,staffIdx:b,startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,key:e.copy(c)},f=null,h=new g(this.scoreData,d,f),i={action:h,error:null,checked:!1};this.wrappedActions.push(i)},m.callPerform=function(a){null===a.error&&(a.action.cancelStack=this.cancelStack,a.checked?a.action.perform():h(a.action,o))};var o=function(c){return c instanceof a||c instanceof b}}.call(this),function(){"use strict";var a=Adagio.Error.noChange.NoChangeError,b=Adagio.Values.MeasureNumberingPolicy,c=Adagio.edit.action.SetMeasureNumberingPolicy=function(a,b,c){this.init(a,b,c)};c.NAME="action.SetMeasureNumberingPolicy";var d=c.prototype;d.name=c.NAME,d.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},d.checkPreconditions=function(){b.check(this.opts.policy);var c=this.scoreData.getMeasureNumberingPolicy();if(this.opts.policy===c)throw new a},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a=this.getPreviousData();this.setMeasureNumberingPolicy(),this.updateStack(a)},d.storeAction=function(){if(!this.cancelStack.hasAction()){var a={actionName:this.name,opts:{policy:this.opts.policy}};this.cancelStack.storeAction(a)}},d.getPreviousData=function(){return{policy:this.scoreData.getMeasureNumberingPolicy()}},d.setMeasureNumberingPolicy=function(){this.scoreData.setMeasureNumberingPolicy(this.opts.policy)},d.updateStack=function(a){var b={type:this.name,noDraw:!0,opts:{previousPolicy:a.policy}};this.cancelStack.push(b),this.cancelStack.stateNeedCompleteRedraw()}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadNotesSpacingCoeffError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadNotesSpacingCoeffError",this.stack=e.stack,this.message=e.message,this.coeff=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"The notes spacing coeff ["+a+"] is invalid. It must be a number between 1 and 10."}}.call(this),function(){"use strict";var a=Adagio.Error.value.BadNotesSpacingCoeffError,b=Adagio.Utils.math,c=Adagio.Values.NotesSpacingCoeff={};c.check=function(b){if(!c.isValid(b))throw new a(b)},c.isValid=function(a){return b.isNumber(a)&&1<=a&&a<=5}}.call(this),function(){"use strict";var a=Adagio.Error.noChange.NoChangeError,b=Adagio.Values.NotesSpacingCoeff,c=Adagio.edit.action.SetNotesSpacingCoeff=function(a,b,c){this.init(a,b,c)};c.NAME="action.SetNotesSpacingCoeff";var d=c.prototype;d.name=c.NAME,d.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},d.checkPreconditions=function(){b.check(this.opts.coeff);var c=this.scoreData.getNotesSpacingCoeff();if(this.opts.coeff===c)throw new a},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a=this.getPreviousData();this.setNotesSpacingCoeff(),this.updateStack(a)},d.storeAction=function(){if(!this.cancelStack.hasAction()){var a={actionName:this.name,opts:{coeff:this.opts.coeff}};this.cancelStack.storeAction(a)}},d.getPreviousData=function(){return{coeff:this.scoreData.getNotesSpacingCoeff()}},d.setNotesSpacingCoeff=function(){this.scoreData.setNotesSpacingCoeff(this.opts.coeff)},d.updateStack=function(a){var b={type:this.name,noDraw:!0,opts:{previousCoeff:a.coeff}};this.cancelStack.push(b),this.cancelStack.stateNeedCompleteRedraw()}}.call(this),function(){"use strict";var a=Adagio.Error.client.MissingOptionError,b=Adagio.Utils.math,c=Adagio.Utils.pageMarginUtils,d=Adagio.edit.action.SetRightMargin=function(a,b,c){this.init(a,b,c)};d.NAME="action.SetRightMargin";var e=d.prototype;e.name=d.NAME,e.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},e.checkPreconditions=function(){if(c.checkType(this.opts.type),!b.isNumber(this.opts.millimeters)||this.opts.millimeters<=0)throw new a("millimeters")},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.scoreData.setPageRightMarginMillimeters(this.opts.millimeters,this.opts.type),this.cancelStack.stateNeedCompleteRedraw()},e.storeAction=function(){if(!this.cancelStack.hasAction()){var a={actionName:this.name,opts:{millimeters:this.opts.millimeters,type:this.opts.type}};this.cancelStack.storeAction(a)}}}.call(this),function(){"use strict";var a=Adagio.Error.client.MissingOptionError,b=Adagio.Utils.math,c=Adagio.edit.action.SetPageSize=function(a,b,c){this.init(a,b,c)};c.NAME="action.SetPageSize";var d=c.prototype;d.name=c.NAME,d.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},d.checkPreconditions=function(){if(!b.isNumber(this.opts.height)||this.opts.height<=0)throw new a("height");if(!b.isNumber(this.opts.width)||this.opts.width<=0)throw new a("width")},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.scoreData.setPageSizeAsMillimeters(this.opts.width,this.opts.height),this.cancelStack.stateNeedCompleteRedraw()},d.storeAction=function(){if(!this.cancelStack.hasAction()){var a={actionName:this.name,opts:{width:this.opts.width,height:this.opts.height}};this.cancelStack.storeAction(a)}}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadPartIdxError,b=Adagio.Error.noChange.NoChangeError,c=Adagio.edit.common.convertPartUuidToGetPartIdx,d=Adagio.Values.Volume,e=Adagio.Utils.math,f=Adagio.Utils.partHeaderUtils,g=Adagio.edit.action.SetPartGlobalVolume=function(a,b,c){this.init(a,b,c)};g.NAME="action.SetPartGlobalVolume";var h=g.prototype;h.name=g.NAME,h.init=function(a,b,d){c(a,b),this.scoreData=a,this.cancelStack=d,this.opts=b,this.location=null},h.checkPreconditions=function(){this.checkLocation(),d.check(this.opts.volume);var a=this.getCurrentVolume();if(this.opts.volume===a)throw new b},h.checkLocation=function(){var b=this.opts.partIdx,c=this.scoreData.getNbParts();if(!e.isInteger(b)||b<0||b>=c)throw new a(b)},h.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a=this.getPreviousData();this.setVolume(),this.updateStack(a)},h.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,volume:this.opts.volume}};this.cancelStack.storeAction(b)}},h.getPreviousData=function(){return{volume:this.getCurrentVolume()}},h.getCurrentVolume=function(){var a=this.scoreData.getPartHeader(this.opts.partIdx);return f.getGlobalVolume(a)},h.setVolume=function(){var a=this.scoreData.getPartHeader(this.opts.partIdx);f.setGlobalVolume(a,this.opts.volume)},h.updateStack=function(a){var b=this.getLocation(),c={type:this.name,noDraw:!0,opts:{partUuid:b.partUuid,previousVolume:a.volume}};this.cancelStack.push(c)},h.getLocation=function(){if(null===this.location){var a=this.scoreData.getPartUuid(this.opts.partIdx);this.location={partUuid:a}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadPartIdxError,b=Adagio.Error.noChange.NoChangeError,c=Adagio.edit.common.convertPartUuidToGetPartIdx,d=Adagio.Values.Reverberation,e=Adagio.Utils.math,f=Adagio.Utils.partHeaderUtils,g=Adagio.edit.action.SetPartGlobalReverberation=function(a,b,c){this.init(a,b,c)};g.NAME="action.SetPartGlobalReverberation";var h=g.prototype;h.name=g.NAME,h.init=function(a,b,d){c(a,b),this.scoreData=a,this.cancelStack=d,this.opts=b,this.location=null},h.checkPreconditions=function(){this.checkLocation(),d.check(this.opts.reverberation);var a=this.getCurrentReverberation();if(this.opts.reverberation===a)throw new b},h.checkLocation=function(){var b=this.opts.partIdx,c=this.scoreData.getNbParts();if(!e.isInteger(b)||b<0||b>=c)throw new a(b)},h.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a=this.getPreviousData();this.setReverberation(),this.updateStack(a)},h.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,reverberation:this.opts.reverberation}};this.cancelStack.storeAction(b)}},h.getPreviousData=function(){return{reverberation:this.getCurrentReverberation()}},h.getCurrentReverberation=function(){var a=this.scoreData.getPartHeader(this.opts.partIdx);return f.getGlobalReverberation(a)},h.setReverberation=function(){var a=this.scoreData.getPartHeader(this.opts.partIdx);f.setGlobalReverberation(a,this.opts.reverberation)},h.updateStack=function(a){var b=this.getLocation(),c={type:this.name,noDraw:!0,opts:{partUuid:b.partUuid,previousReverberation:a.reverberation}};this.cancelStack.push(c)},h.getLocation=function(){if(null===this.location){var a=this.scoreData.getPartUuid(this.opts.partIdx);this.location={partUuid:a}}return this.location}}.call(this),function(){"use strict";var a=Adagio.edit.composite.UpdateOwnTempo,b=Adagio.edit.composite.UpdateRangeOwnTempo=function(a,b,c){this.init(a,b,c)};b.NAME="composite.UpdateRangeOwnTempo";var c=b.prototype;c.name=b.NAME,c.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},c.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);for(var a=this.opts.startMeasureIdx;a<=this.opts.stopMeasureIdx;a++)this.updateMeasureTempo(a);this.hasMeasureAfter()&&this.updateMeasureTempo(this.opts.stopMeasureIdx+1)},c.hasMeasureAfter=function(){var a=this.scoreData.getNbMeasures();return this.opts.stopMeasureIdx+1<a},c.updateMeasureTempo=function(b){var c={measureIdx:b};new a(this.scoreData,c,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.edit.common.getCommonContent,b=Adagio.Utils.tempoUtils,c=Adagio.edit.primitive.SetTempo=function(a,b,c){this.init(a,b,c)};c.NAME="primitive.SetTempo";var d=c.prototype;d.name=c.NAME,d.init=function(b,c,d){this.commonContent=a(b),this.cancelStack=d,this.opts=c},d.perform=function(){this.setTempo(),this.updateStack()},d.setTempo=function(){var a=b.copy(this.opts.tempo);this.commonContent.setTempo(this.opts.measureIdx,a)},d.updateStack=function(){var a={type:this.name,noDraw:!0,opts:{measureIdx:this.opts.measureIdx}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.edit.primitive.SetTempo,b=Adagio.edit.common.getCommonContent,c=Adagio.Utils.tempoUtils,d=Adagio.edit.composite.SetTempoIfNeeded=function(a,b,c){this.init(a,b,c)};d.NAME="composite.SetTempoIfNeeded";var e=d.prototype;e.name=d.NAME,e.init=function(a,c,d){this.commonContent=b(a,c),this.cancelStack=d,this.opts=c},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.needSetTempo()&&this.setTempo()},e.needSetTempo=function(){var a=this.commonContent.getTempo(this.opts.measureIdx);return!c.isSame(a,this.opts.tempo)},e.setTempo=function(){var b={measureIdx:this.opts.measureIdx,tempo:c.copy(this.opts.tempo)};new a(this.commonContent,b,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.edit.composite.SetTempoIfNeeded,b=Adagio.Utils.tempoUtils,c=Adagio.edit.composite.SetRangeTempo=function(a,b,c){this.init(a,b,c)};c.NAME="composite.SetRangeTempo";var d=c.prototype;d.name=c.NAME,d.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);for(var a=this.opts.startMeasureIdx;a<=this.opts.stopMeasureIdx;a++)this.setTempo(a)},d.setTempo=function(c){var d=b.copy(this.opts.tempo),e={measureIdx:c,tempo:d};new a(this.scoreData,e,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.edit.composite.UpdateRangeOwnTempo,b=Adagio.edit.composite.SetRangeTempo,c=Adagio.Utils.tempoUtils,d=Adagio.edit.composite.SetTempoSegment=function(a,b,c){this.init(a,b,c)};d.NAME="composite.SetTempoSegment";var e=d.prototype;e.name=d.NAME,e.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.setTempo(),this.updateOwnTempo()},e.setTempo=function(){var a=c.copy(this.opts.tempo),d={startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,tempo:a};new b(this.scoreData,d,this.cancelStack).perform()},e.updateOwnTempo=function(){var b={startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx};new a(this.scoreData,b,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.client.RevertRangeError,b=Adagio.Error.client.BadMeasureIdxError,c=Adagio.Error.client.InconsistentAttributesError,d=Adagio.Error.noChange.NoChangeError,e=Adagio.Utils.tempoUtils,f=Adagio.edit.composite.SetTempoSegment,g=Adagio.edit.common.convertMeasuresUuidsToMeasuresIdxs,h=Adagio.edit.action.SetTempoSegment=function(a,b,c){this.init(a,b,c)};h.NAME="action.SetTempoSegment";var i=h.prototype;i.name=h.NAME,i.init=function(a,b,c){g(a,b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.location=null},i.checkPreconditions=function(){this.checkLocation(),this.sanitize(),e.check(this.opts.tempo),this.checkDifferentTempo(),this.checkCurrentConsistent()},i.checkLocation=function(){var c=this.scoreData.getPartMeasures(0),d=c.length,e=this.opts.startMeasureIdx,f=e;if(f<0||f>=d)throw new b(f,b.GET);var g=this.opts.stopMeasureIdx;if(g<e)throw new a(a.MEASURE,e,g);if((f=this.opts.stopMeasureIdx)<0||f>=d)throw new b(f,b.GET)},i.sanitize=function(){"number"==typeof this.opts.tempo&&(this.opts.tempo=e.createWithDefaultDisplay(this.opts.tempo))},i.checkDifferentTempo=function(){if(!this.hasDifferentTempo())throw new d},i.hasDifferentTempo=function(){var a=this.getFirstTempo();return!e.isSame(a,this.opts.tempo)},i.checkCurrentConsistent=function(){for(var a=this.getFirstTempo(),b=this.opts.startMeasureIdx+1;b<=this.opts.stopMeasureIdx;b++){var d=this.scoreData.getRealTempo(b);if(!e.isSame(d,a))throw new c(c.TEMPO)}},i.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a=this.getPreviousData();this.setTempo(),this.updateStack(a)},i.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b=a.measureUuids.slice(),c=e.copy(this.opts.tempo),d={actionName:this.name,opts:{measureUuids:b,tempo:c}};this.cancelStack.storeAction(d)}},i.getPreviousData=function(){return{tempo:this.getFirstTempo()}},i.getFirstTempo=function(){return this.scoreData.getRealTempo(this.opts.startMeasureIdx)},i.setTempo=function(){var a=e.copy(this.opts.tempo),b={startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,tempo:a};new f(this.scoreData,b,this.cancelStack).perform()},i.updateStack=function(a){var b=this.getLocation(),c=b.measureUuids.slice(),d=e.copy(a.tempo),f={type:this.name,noDraw:!0,opts:{measureUuids:c,previousTempo:d}};this.cancelStack.push(f)},i.getLocation=function(){if(null===this.location){var a=this.scoreData.getMeasureUuids(this.opts.startMeasureIdx,this.opts.stopMeasureIdx);this.location={measureUuids:a}}return this.location}}.call(this),function(){"use strict";var a=Adagio.edit.action.SetTempoSegment,b=Adagio.Utils.tempoUtils,c=Adagio.edit.composite.SetTempoMain=function(a,b,c){this.init(a,b,c)};c.NAME="composite.SetTempoMain";var d=c.prototype;d.name=c.NAME,d.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.tempo=null,this.startMeasureIdx=null,this.stopMeasureIdx=null},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name)
;for(var a=this.opts.startMeasureIdx,b=this.opts.stopMeasureIdx,c=a;c<=b;c++){var d=this.scoreData.getRealTempo(c);this.addTempo(d,c)}this.finishSegment()},d.addTempo=function(a,b){this.hasOngoing()?this.isSameTempo(a)?this.continueSegment(b):(this.finishSegment(),this.startSegment(a,b)):this.startSegment(a,b)},d.hasOngoing=function(){return null!==this.tempo},d.startSegment=function(a,b){this.tempo=a,this.startMeasureIdx=b,this.stopMeasureIdx=b},d.isSameTempo=function(a){return b.isSame(this.tempo,a)},d.continueSegment=function(a){this.stopMeasureIdx=a},d.finishSegment=function(){b.isSame(this.tempo,this.opts.tempo)||this.setTempoSegment(this.startMeasureIdx,this.stopMeasureIdx),this.tempo=null,this.startMeasureIdx=null,this.stopMeasureIdx=null},d.setTempoSegment=function(c,d){var e=b.copy(this.opts.tempo),f={startMeasureIdx:c,stopMeasureIdx:d,tempo:e},g=new a(this.scoreData,f,this.cancelStack);g.checkPreconditions(),g.perform()}}.call(this),function(){"use strict";var a=Adagio.Error.client.RevertRangeError,b=Adagio.Error.client.BadMeasureIdxError,c=Adagio.Error.noChange.NoChangeError,d=Adagio.Utils.tempoUtils,e=Adagio.edit.composite.SetTempoMain,f=Adagio.edit.common.convertMeasuresUuidsToMeasuresIdxs,g=Adagio.edit.action.SetTempo=function(a,b,c){this.init(a,b,c)};g.NAME="action.SetTempo";var h=g.prototype;h.name=g.NAME,h.init=function(a,b,c){f(a,b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.location=null},h.checkPreconditions=function(){this.checkLocation(),this.sanitize(),d.check(this.opts.tempo),this.checkDifferentTempo()},h.checkLocation=function(){var c=this.scoreData.getPartMeasures(0),d=c.length,e=this.opts.startMeasureIdx,f=e;if(f<0||f>=d)throw new b(f,b.GET);var g=this.opts.stopMeasureIdx;if(g<e)throw new a(a.MEASURE,e,g);if((f=this.opts.stopMeasureIdx)<0||f>=d)throw new b(f,b.GET)},h.sanitize=function(){"number"==typeof this.opts.tempo&&(this.opts.tempo=d.createWithDefaultDisplay(this.opts.tempo))},h.checkDifferentTempo=function(){if(!this.hasDifferentTempo())throw new c},h.hasDifferentTempo=function(){for(var a=this.opts.startMeasureIdx;a<=this.opts.stopMeasureIdx;a++){var b=this.scoreData.getRealTempo(a);if(!d.isSame(b,this.opts.tempo))return!0}return!1},h.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.setTempo()},h.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b=a.measureUuids.slice(),c={actionName:this.name,opts:{measureUuids:b,tempo:this.opts.tempo}};this.cancelStack.storeAction(c)}},h.getLocation=function(){if(null===this.location){var a=this.scoreData.getMeasureUuids(this.opts.startMeasureIdx,this.opts.stopMeasureIdx);this.location={measureUuids:a}}return this.location},h.setTempo=function(){var a={startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,tempo:d.copy(this.opts.tempo)};new e(this.scoreData,a,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.edit.composite.UpdateOwnSwing,b=Adagio.edit.composite.UpdateRangeOwnSwing=function(a,b,c){this.init(a,b,c)};b.NAME="composite.UpdateRangeOwnSwing";var c=b.prototype;c.name=b.NAME,c.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},c.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);for(var a=this.opts.startMeasureIdx;a<=this.opts.stopMeasureIdx;a++)this.updateMeasureSwing(a);this.hasMeasureAfter()&&this.updateMeasureSwing(this.opts.stopMeasureIdx+1)},c.hasMeasureAfter=function(){var a=this.scoreData.getNbMeasures();return this.opts.stopMeasureIdx+1<a},c.updateMeasureSwing=function(b){var c={measureIdx:b};new a(this.scoreData,c,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.edit.common.getCommonContent,b=Adagio.Utils.swingUtils,c=Adagio.edit.primitive.SetSwing=function(a,b,c){this.init(a,b,c)};c.NAME="primitive.SetSwing";var d=c.prototype;d.name=c.NAME,d.init=function(b,c,d){this.commonContent=a(b),this.cancelStack=d,this.opts=c},d.perform=function(){this.setSwing(),this.updateStack()},d.setSwing=function(){this.commonContent.setSwing(this.opts.measureIdx,b.copy(this.opts.swing))},d.updateStack=function(){var a={type:this.name,noDraw:!0,opts:{measureIdx:this.opts.measureIdx}};this.cancelStack.push(a)}}.call(this),function(){"use strict";var a=Adagio.edit.primitive.SetSwing,b=Adagio.edit.common.getCommonContent,c=Adagio.Utils.swingUtils,d=Adagio.edit.composite.SetSwingIfNeeded=function(a,b,c){this.init(a,b,c)};d.NAME="composite.SetSwingIfNeeded";var e=d.prototype;e.name=d.NAME,e.init=function(a,c,d){this.commonContent=b(a,c),this.cancelStack=d,this.opts=c},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.needSetSwing()&&this.setSwingIfNeeded()},e.needSetSwing=function(){var a=this.commonContent.getSwing(this.opts.measureIdx);return!c.isSame(a,this.opts.swing)},e.setSwingIfNeeded=function(){var b={measureIdx:this.opts.measureIdx,swing:c.copy(this.opts.swing)};new a(this.commonContent,b,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.edit.composite.SetSwingIfNeeded,b=Adagio.Utils.swingUtils,c=Adagio.edit.composite.SetRangeSwing=function(a,b,c){this.init(a,b,c)};c.NAME="composite.SetRangeSwing";var d=c.prototype;d.name=c.NAME,d.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);for(var a=this.opts.startMeasureIdx;a<=this.opts.stopMeasureIdx;a++)this.setSwing(a)},d.setSwing=function(c){var d={measureIdx:c,swing:b.copy(this.opts.swing)};new a(this.scoreData,d,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.edit.composite.UpdateRangeOwnSwing,b=Adagio.edit.composite.SetRangeSwing,c=Adagio.Utils.swingUtils,d=Adagio.edit.composite.SetSwingSegment=function(a,b,c){this.init(a,b,c)};d.NAME="composite.SetSwingSegment";var e=d.prototype;e.name=d.NAME,e.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.setSwing(),this.updateOwnSwing()},e.setSwing=function(){var a={startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,swing:c.copy(this.opts.swing)};new b(this.scoreData,a,this.cancelStack).perform()},e.updateOwnSwing=function(){var b={startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx};new a(this.scoreData,b,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.client.RevertRangeError,b=Adagio.Error.client.BadMeasureIdxError,c=Adagio.Error.client.InconsistentAttributesError,d=Adagio.Error.noChange.NoChangeError,e=Adagio.Utils.swingUtils,f=Adagio.edit.composite.SetSwingSegment,g=Adagio.edit.common.convertMeasuresUuidsToMeasuresIdxs,h=Adagio.edit.action.SetSwingSegment=function(a,b,c){this.init(a,b,c)};h.NAME="action.SetSwingSegment";var i=h.prototype;i.name=h.NAME,i.init=function(a,b,c){g(a,b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.location=null},i.checkPreconditions=function(){this.checkLocation(),e.check(this.opts.swing),this.checkDifferentSwing(),this.checkCurrentConsistent()},i.checkLocation=function(){var c=this.scoreData.getPartMeasures(0),d=c.length,e=this.opts.startMeasureIdx,f=e;if(f<0||f>=d)throw new b(f,b.GET);var g=this.opts.stopMeasureIdx;if(g<e)throw new a(a.MEASURE,e,g);if((f=this.opts.stopMeasureIdx)<0||f>=d)throw new b(f,b.GET)},i.checkDifferentSwing=function(){if(!this.hasDifferentSwing())throw new d},i.hasDifferentSwing=function(){var a=this.getFirstSwing();return!e.isSame(a,this.opts.swing)},i.checkCurrentConsistent=function(){for(var a=this.getFirstSwing(),b=this.opts.startMeasureIdx+1;b<=this.opts.stopMeasureIdx;b++){var d=this.scoreData.getSwing(b);if(!e.isSame(d,a))throw new c(c.SWING)}},i.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a=this.getPreviousData();this.setSwing(),this.updateStack(a)},i.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b=a.measureUuids.slice(),c={actionName:this.name,opts:{measureUuids:b,swing:e.copy(this.opts.swing)}};this.cancelStack.storeAction(c)}},i.getPreviousData=function(){var a=this.getFirstSwing();return{swing:e.copy(a)}},i.getFirstSwing=function(){return this.scoreData.getSwing(this.opts.startMeasureIdx)},i.setSwing=function(){var a={startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,swing:e.copy(this.opts.swing)};new f(this.scoreData,a,this.cancelStack).perform()},i.updateStack=function(a){var b=this.getLocation(),c=b.measureUuids.slice(),d={type:this.name,noDraw:!0,opts:{measureUuids:c,previousSwing:e.copy(a.swing)}};this.cancelStack.push(d)},i.getLocation=function(){if(null===this.location){var a=this.scoreData.getMeasureUuids(this.opts.startMeasureIdx,this.opts.stopMeasureIdx);this.location={measureUuids:a}}return this.location}}.call(this),function(){"use strict";var a=Adagio.edit.action.SetSwingSegment,b=Adagio.Utils.swingUtils,c=Adagio.edit.composite.SetSwingMain=function(a,b,c){this.init(a,b,c)};c.NAME="composite.SetSwingMain";var d=c.prototype;d.name=c.NAME,d.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.swing=null,this.startMeasureIdx=null,this.stopMeasureIdx=null},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);for(var a=this.opts.startMeasureIdx,b=this.opts.stopMeasureIdx,c=a;c<=b;c++){var d=this.scoreData.getSwing(c);this.addSwing(d,c)}this.finishSegment()},d.addSwing=function(a,b){this.hasOngoing()?this.isSameSwing(a)?this.continueSegment(b):(this.finishSegment(),this.startSegment(a,b)):this.startSegment(a,b)},d.hasOngoing=function(){return null!==this.swing},d.startSegment=function(a,b){this.swing=a,this.startMeasureIdx=b,this.stopMeasureIdx=b},d.isSameSwing=function(a){return b.isSame(this.swing,a)},d.continueSegment=function(a){this.stopMeasureIdx=a},d.finishSegment=function(){b.isSame(this.swing,this.opts.swing)||this.setSwingSegment(this.startMeasureIdx,this.stopMeasureIdx),this.swing=null,this.startMeasureIdx=null,this.stopMeasureIdx=null},d.setSwingSegment=function(c,d){var e={startMeasureIdx:c,stopMeasureIdx:d,swing:b.copy(this.opts.swing)},f=new a(this.scoreData,e,this.cancelStack);f.checkPreconditions(),f.perform()}}.call(this),function(){"use strict";var a=Adagio.edit.common.convertMeasuresUuidsToMeasuresIdxs,b=Adagio.Error.client.BadMeasureIdxError,c=Adagio.Error.client.RevertRangeError,d=Adagio.Error.noChange.NoChangeError,e=Adagio.edit.composite.SetSwingMain,f=Adagio.Utils.swingUtils,g=Adagio.edit.action.SetSwing=function(a,b,c){this.init(a,b,c)};g.NAME="action.SetSwing";var h=g.prototype;h.name=g.NAME,h.init=function(b,c,d){a(b,c),this.scoreData=b,this.cancelStack=d,this.opts=c,this.location=null},h.checkPreconditions=function(){this.checkLocation(),f.check(this.opts.swing),this.checkDifferentSwing()},h.checkLocation=function(){var a=this.scoreData.getPartMeasures(0),d=a.length,e=this.opts.startMeasureIdx,f=e;if(f<0||f>=d)throw new b(f,b.GET);var g=this.opts.stopMeasureIdx;if(g<e)throw new c(c.MEASURE,e,g);if((f=this.opts.stopMeasureIdx)<0||f>=d)throw new b(f,b.GET)},h.checkDifferentSwing=function(){if(!this.hasDifferentSwing())throw new d},h.hasDifferentSwing=function(){for(var a=this.opts.startMeasureIdx;a<=this.opts.stopMeasureIdx;a++){var b=this.scoreData.getSwing(a);if(!f.isSame(b,this.opts.swing))return!0}return!1},h.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.setSwing()},h.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b=a.measureUuids.slice(),c={actionName:this.name,opts:{measureUuids:b,swing:f.copy(this.opts.swing)}};this.cancelStack.storeAction(c)}},h.getLocation=function(){if(null===this.location){var a=this.scoreData.getMeasureUuids(this.opts.startMeasureIdx,this.opts.stopMeasureIdx);this.location={measureUuids:a}}return this.location},h.setSwing=function(){var a={startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,swing:f.copy(this.opts.swing)};new e(this.scoreData,a,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.edit.action.SetSwing,b=Adagio.Utils.swingUtils,c=Adagio.edit.action.SetGlobalSwing=function(a,b,c){this.init(a,b,c)};c.NAME="action.SetGlobalSwing";var d=c.prototype;d.name=c.NAME,d.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.action=null},d.checkPreconditions=function(){b.check(this.opts.swing),this.getAction().checkPreconditions()},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a=this.getAction();a.cancelStack=this.cancelStack,a.perform()},d.getAction=function(){if(null===this.action){var c=this.scoreData.getNbMeasures(),d={startMeasureIdx:0,stopMeasureIdx:c-1,swing:b.copy(this.opts.swing)};this.action=new a(this.scoreData,d,null)}return this.action}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.timeUtils,c=Adagio.edit.action.SetTimeSegment,d=Adagio.edit.composite.SetTimeSignatureMain=function(a,b,c){this.init(a,b,c)};d.NAME="composite.SetTimeSignatureMain";var e=d.prototype;e.name=d.NAME,e.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.time=null,this.displayedTime=null,this.startMeasureIdx=null,this.stopMeasureIdx=null},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);for(var a=this.opts.startMeasureIdx,b=this.opts.stopMeasureIdx,c=a;c<=b;c++){var d=this.getTime(c),e=this.getDisplayedTime(c);this.addTime(d,e,c)}this.finishSegment()},e.getTime=function(b){var c=this.scoreData.getMeasure(0,b);return a.getWrappedTime(c).getAnyEntry()},e.getDisplayedTime=function(a){return this.scoreData.getCommonContent().getDisplayedTime(a)},e.addTime=function(a,b,c){this.hasOngoing()?this.isSameTime(a,b)?this.continueSegment(c):(this.finishSegment(),this.startSegment(a,b,c)):this.startSegment(a,b,c)},e.hasOngoing=function(){return null!==this.time},e.startSegment=function(a,c,d){this.time=b.copy(a),this.displayedTime=b.copy(c),this.startMeasureIdx=d,this.stopMeasureIdx=d},e.isSameTime=function(a,c){return b.isSame(a,this.time)&&b.isSame(c,this.displayedTime)},e.continueSegment=function(a){this.stopMeasureIdx=a},e.finishSegment=function(){b.isSame(this.time,this.opts.timeSignature)&&b.isSame(this.displayedTime,this.opts.displayedTime)||this.setTimeSegment(this.startMeasureIdx,this.stopMeasureIdx),this.time=null,this.displayedTime=null,this.startMeasureIdx=null,this.stopMeasureIdx=null},e.setTimeSegment=function(a,d){var e=b.copy(this.opts.timeSignature),f=b.copy(this.opts.displayedTime),g={startMeasureIdx:a,stopMeasureIdx:d,timeSignature:e,displayedTime:f},h=new c(this.scoreData,g,this.cancelStack);h.checkPreconditions(),h.perform()}}.call(this),function(){"use strict";var a=Adagio.Error.client.RevertRangeError,b=Adagio.Error.client.BadMeasureIdxError,c=Adagio.Error.noChange.SameAttrError,d=Adagio.Utils.measureUtils,e=Adagio.Utils.timeUtils,f=Adagio.Utils.math,g=Adagio.edit.composite.SetTimeSignatureMain,h=Adagio.edit.common.convertMeasuresUuidsToMeasuresIdxs,i=Adagio.edit.action.SetTimeSignature=function(a,b,c){this.init(a,b,c)};i.NAME="action.SetTimeSignature";var j=i.prototype;j.name=i.NAME,j.init=function(a,b,c){h(a,b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.location=null,void 0===this.opts.displayedTime&&(this.opts.displayedTime=e.copy(this.opts.timeSignature))},j.checkPreconditions=function(){this.checkLocation(),e.check(this.opts.timeSignature),this.checkDifferentTime()},j.checkLocation=function(){var c=this.scoreData.getPartMeasures(0),d=c.length,e=this.opts.startMeasureIdx,g=e;if(!f.isInteger(g)||g<0||g>=d)throw new b(g,b.GET);var h=this.opts.stopMeasureIdx;if(h<e)throw new a(a.MEASURE,e,h);if(g=this.opts.stopMeasureIdx,!f.isInteger(g)||g<0||g>=d)throw new b(g,b.GET)},j.checkDifferentTime=function(){if(!this.getMeasuresRange().some(this.isTimeDifferent,this))throw new c(c.TIME)},j.getMeasuresRange=function(){var a=this.opts.startMeasureIdx,b=this.opts.stopMeasureIdx+1;return this.getMeasures().slice(a,b)},j.getMeasures=function(){return this.scoreData.getPartMeasures(0)},j.isTimeDifferent=function(a,b){var c=b+this.opts.startMeasureIdx,f=this.scoreData.getCommonContent(),g=f.getDisplayedTime(c),h=d.getAnyTime(a);return!e.isSame(h,this.opts.timeSignature)||!e.isSame(g,this.opts.displayedTime)},j.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.setTime()},j.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b=a.measureUuids.slice(),c=e.copy(this.opts.timeSignature),d=e.copy(this.opts.displayedTime),f={actionName:this.name,opts:{measureUuids:b,timeSignature:c,displayedTime:d}};this.cancelStack.storeAction(f)}},j.getLocation=function(){if(null===this.location){var a=this.scoreData.getMeasureUuids(this.opts.startMeasureIdx,this.opts.stopMeasureIdx);this.location={measureUuids:a}}return this.location},j.setTime=function(){var a=e.copy(this.opts.timeSignature),b=e.copy(this.opts.displayedTime),c={startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,timeSignature:a,displayedTime:b};new g(this.scoreData,c,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.client.MissingOptionError,b=Adagio.edit.action.SetTitle=function(a,b,c){this.init(a,b,c)};b.NAME="action.SetTitle";var c=b.prototype;c.name=b.NAME,c.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},c.checkPreconditions=function(){if("string"!=typeof this.opts.title)throw new a("title")},c.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a=this.getPreviousTitle();this.storeAction(a),this.scoreData.setTitle(this.opts.title),this.updateStack(a)},c.getPreviousTitle=function(){return this.scoreData.hasTitle()?this.scoreData.getTitle():""},c.updateStack=function(a){var b={previousTitle:a,newTitle:this.opts.title},c={type:this.name,noDraw:!0,opts:b};this.cancelStack.push(c),this.cancelStack.stateNeedCompleteRedraw()},c.storeAction=function(a){if(!this.cancelStack.hasAction()){var b={actionName:this.name,opts:{previousTitle:a,title:this.opts.title}};this.cancelStack.storeAction(b)}}}.call(this),function(){"use strict";var a=Adagio.Error.client.MissingOptionError,b=Adagio.Utils.math,c=Adagio.Utils.pageMarginUtils,d=Adagio.edit.action.SetTopMargin=function(a,b,c){this.init(a,b,c)};d.NAME="action.SetTopMargin";var e=d.prototype;e.name=d.NAME,e.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},e.checkPreconditions=function(){if(c.checkType(this.opts.type),!b.isNumber(this.opts.millimeters)||this.opts.millimeters<=0)throw new a("millimeters")},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.scoreData.setPageTopMarginMillimeters(this.opts.millimeters,this.opts.type),this.cancelStack.stateNeedCompleteRedraw()},e.storeAction=function(){if(!this.cancelStack.hasAction()){var a={actionName:this.name,opts:{millimeters:this.opts.millimeters,type:this.opts.type}};this.cancelStack.storeAction(a)}}}.call(this),function(){"use strict";var a=Adagio.Utils.measureUtils,b=Adagio.Utils.staffDetailsUtils,c=Adagio.edit.action.SetStaffDetails,d=Adagio.edit.composite.SetTuning=function(a,b,c){this.init(a,b,c)};d.NAME="composite.SetTuning";var e=d.prototype;e.name=d.NAME,e.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b},e.getAnyMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,0)},e.getAnyStaffDetails=function(){var b=this.getAnyMeasure();return a.getWrappedStaffDetailsOrDefault(b).getEntry(this.opts.staffIdx)},e.perform=function(){this.setStaffDetails()},e.setStaffDetails=function(){var a=this.opts.staffTunings,d=a.length,e=this.opts.capo,f=b.create(d,a,e),g={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,staffDetails:b.copy(f)},h=new c(this.scoreData,g,this.cancelStack);h.checkPreconditions(),h.perform()}}.call(this),function(){"use strict";var a=Adagio.edit.common.convertPartUuidToGetPartIdx,b=Adagio.Error.client.NotPossibleOnNonTabError,c=Adagio.Error.client.NotPossibleOnUnpitchedError,d=Adagio.Error.client.BadStaffIdxError,e=Adagio.Error.client.MissingOptionError,f=Adagio.Utils.measureUtils,g=Adagio.Utils.staffDetailsUtils,h=Adagio.Utils.typeUtils,i=Adagio.Utils.staffTuningUtils,j=Adagio.Utils.math,k=Adagio.Values.TabCapo,l=Adagio.edit.composite.SetTuning,m=Adagio.edit.action.SetTuning=function(a,b,c){this.init(a,b,c)};m.NAME="action.SetTuning";var n=m.prototype;n.name=m.NAME,n.init=function(b,c,d){a(b,c),this.scoreData=b,this.cancelStack=d,this.opts=c,this.location=null},n.checkPreconditions=function(){this.checkStaffIdx(),this.checkPitchedPart(),this.checkTabStaff(),this.checkStaffTunings()},n.getAnyMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,0)},n.checkStaffIdx=function(){var a=this.getAnyMeasure(),b=f.getNbStaves(a);if(!j.isNumber(this.opts.staffIdx)||this.opts.staffIdx<0||this.opts.staffIdx>=b)throw new d(this.opts.staffIdx,d.action.GET)},n.checkPitchedPart=function(){if(this.scoreData.isPartUnpitched(this.opts.partIdx))throw new c},n.getAnyStaffDetails=function(){var a=this.getAnyMeasure();return f.getWrappedStaffDetailsOrDefault(a).getEntry(this.opts.staffIdx)},n.checkTabStaff=function(){var a=this.getAnyStaffDetails();if(!g.hasStaffTuning(a))throw new b},n.checkStaffTunings=function(){if(void 0===this.opts.capo&&(this.opts.capo=k.DEFAULT),k.check(this.opts.capo),!h.isArray(this.opts.staffTunings))throw new e("staffTunings");this.opts.staffTunings.forEach(function(a){i.check(a)})},n.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,staffTunings:this.opts.staffTunings.map(i.copy),capo:this.opts.capo};new l(this.scoreData,a,this.cancelStack).perform()},n.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b=this.opts.staffTunings.map(i.copy),c={actionName:this.name,opts:{partUuid:a.partUuid,staffIdx:this.opts.staffIdx,staffTunings:b,capo:this.opts.capo}};this.cancelStack.storeAction(c)}},n.getLocation=function(){if(null===this.location){var a=this.scoreData.getPartUuid(this.opts.partIdx);this.location={partUuid:a}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.PitchRangeError,b=Adagio.Error.client.NotPossibleOnUnpitchedError,c=Adagio.Error.client.PitchCollisionError,d=Adagio.Error.client.PitchOverflowError,e=Adagio.Utils.noteUtils,f=Adagio.Utils.pitchUtils,g=Adagio.Utils.pitchShift,h=Adagio.Utils.transposeUtils,i=Adagio.edit.action.AddAccidental,j=Adagio.edit.action.ChangePitch,k=Adagio.edit.common.getNoteAtPitch,l=Adagio.edit.common.convertTimePosToGetNoteIdx,m=Adagio.edit.common.convertPartUuidToGetPartIdx,n=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,o=Adagio.edit.common.transposePitchLineOpts,p=Adagio.edit.common.initMeasureData,q=Adagio.edit.action.ShiftHalfToneUp=function(a,b,c){this.init(a,b,c)};q.NAME="action.ShiftHalfToneUp";var r=q.prototype;r.name=q.NAME,r.initMeasureData=p,r.init=function(a,b,c){m(a,b),n(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.sanitized=!1,this.noteHead=null,this.voice=null,this.action=null,this.location=null},r.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),l(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),f.check(this.opts.pitch),this.sanitizeIfNeeded(),this.checkNoteAtPitch(),this.getAction().checkPreconditions()},r.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new b},r.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},r.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},r.checkNoteAtPitch=function(){if(void 0===this.getNoteAtPitch()){var a=f.copy(this.opts.pitch);throw new c(c.action.GET,a)}},r.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),l(this.measureData,this.opts),this.sanitizeIfNeeded(),this.storeAction();var a=this.getAction();a.cancelStack=this.cancelStack,a.perform()},r.sanitizeIfNeeded=function(){this.sanitized||(void 0===this.opts.checkLine&&(this.opts.checkLine=!0),this.opts.isConcertPitch&&(o(this.measureData,this.opts),f.check(this.opts.pitch)),this.sanitized=!0)},r.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos,pitch:f.copyWithoutAlter(this.opts.pitch),isConcertPitch:!1,checkLine:this.opts.checkLine},c={actionName:this.name,opts:b};this.cancelStack.storeAction(c)}},r.getNoteAtPitch=function(){if(null===this.noteHead){var a=this.getVoice();this.noteHead=k(a,this.opts.noteIdx,this.opts.pitch)}return this.noteHead},r.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location},r.getAction=function(){if(null===this.action){var b,c=this.getNoteAtPitch(),k=e.getPitch(c),l=e.getStaffIdx(c),m=this.measureData.getKey(l);try{b=g.shiftHalfToneUp(k,m)}catch(b){if(b instanceof a){var n=f.copyWithoutAlter(k),o=h.create(1);throw h.setDiatonic(o,1),new d(n,o)}throw b}var p=f.getAlter(b),q=f.alterToAccidental(p),r={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx},s=null;f.isSameLine(k,b)?(r.pitch=f.copyWithoutAlter(k),r.accidental=q,this.action=new i(this.measureData,r,s)):(r.fromPitch=f.copyWithoutAlter(k),r.toPitch=f.copyWithoutAlter(b),r.accidental=q,r.checkLine=this.opts.checkLine,r.staffIdx=l,this.action=new j(this.measureData,r,s))}return this.action},r.getVoice=function(){return null===this.voice&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice}}.call(this),function(){"use strict";var a=Adagio.Error.client.NotPossibleOnUnpitchedError,b=Adagio.Error.client.PitchCollisionError,c=Adagio.Error.client.PitchOverflowError,d=Adagio.Error.client.LineOutOfRangeError,e=Adagio.Utils.noteUtils,f=Adagio.Utils.pitchUtils,g=Adagio.Utils.typeUtils,h=Adagio.edit.action.ShiftHalfToneUp,i=Adagio.edit.common.convertTimePosToGetNoteIdx,j=Adagio.edit.common.convertPartUuidToGetPartIdx,k=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,l=Adagio.edit.common.assertPerform,m=Adagio.edit.common.initMeasureData,n=Adagio.edit.action.ShiftChordHalfToneUp=function(a,b,c){this.init(a,b,c)};n.NAME="action.ShiftChordHalfToneUp";var o=n.prototype;o.name=n.NAME,o.initMeasureData=m,o.init=function(a,b,c){j(a,b),k(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.sanitized=!1,this.voice=null,this.wrappedActions=null,this.location=null},o.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),i(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),this.sanitizeIfNeeded();var a=this.getWrappedActions();if(!a.some(p))throw a[0].error};var p=function(a){try{a.action.checkPreconditions()}catch(b){if(r(b))return a.checked=!0,a.error=b,!1;throw b}return a.checked=!0,!0};o.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new a},o.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},o.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),i(this.measureData,this.opts),this.sanitizeIfNeeded(),this.storeAction(),this.getWrappedActions().forEach(this.callPerform,this)},o.sanitizeIfNeeded=function(){this.sanitized||(void 0===this.opts.checkLine&&(this.opts.checkLine=!0),this.sanitized=!0)},o.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos,checkLine:this.opts.checkLine},c={actionName:this.name,opts:b};this.cancelStack.storeAction(c)}},o.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location},o.getWrappedActions=function(){if(null===this.wrappedActions){var a=this.getVoice(),b=a.getChord(this.opts.noteIdx);b=g.makeArray(b);var c=b.map(e.getPitch);c.sort(q),this.wrappedActions=c.map(this.createWrappedAction,this)}return this.wrappedActions};var q=function(a,b){return-f.compareLine(a,b)};o.createWrappedAction=function(a){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:f.copyWithoutAlter(a),checkLine:this.opts.checkLine,isConcertPitch:!1};return{action:new h(this.measureData,b,null),error:null,checked:!1}},o.getVoice=function(){return null===this.voice&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},o.callPerform=function(a){null===a.error&&(a.action.cancelStack=this.cancelStack,a.checked?a.action.perform():l(a.action,r))};var r=function(a){return a instanceof b||a instanceof c||a instanceof d}}.call(this),function(){"use strict";var a=Adagio.Error.PitchRangeError,b=Adagio.Error.client.NotPossibleOnUnpitchedError,c=Adagio.Error.client.PitchCollisionError,d=Adagio.Error.client.PitchOverflowError,e=Adagio.Utils.noteUtils,f=Adagio.Utils.pitchUtils,g=Adagio.Utils.pitchShift,h=Adagio.Utils.transposeUtils,i=Adagio.edit.action.AddAccidental,j=Adagio.edit.action.ChangePitch,k=Adagio.edit.common.getNoteAtPitch,l=Adagio.edit.common.convertTimePosToGetNoteIdx,m=Adagio.edit.common.convertPartUuidToGetPartIdx,n=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,o=Adagio.edit.common.transposePitchLineOpts,p=Adagio.edit.common.initMeasureData,q=Adagio.edit.action.ShiftHalfToneDown=function(a,b,c){this.init(a,b,c)};q.NAME="action.ShiftHalfToneDown";var r=q.prototype;r.name=q.NAME,r.initMeasureData=p,r.init=function(a,b,c){m(a,b),n(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.sanitized=!1,this.noteHead=null,this.voice=null,this.action=null,this.location=null},r.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),l(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),f.check(this.opts.pitch),this.sanitizeIfNeeded(),this.checkNoteAtPitch(),this.getAction().checkPreconditions()},r.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new b},r.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},r.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},r.checkNoteAtPitch=function(){if(void 0===this.getNoteAtPitch()){var a=f.copy(this.opts.pitch);throw new c(c.action.GET,a)}},r.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),l(this.measureData,this.opts),this.sanitizeIfNeeded(),this.storeAction();var a=this.getAction();a.cancelStack=this.cancelStack,a.perform()},r.sanitizeIfNeeded=function(){this.sanitized||(void 0===this.opts.checkLine&&(this.opts.checkLine=!0),this.opts.isConcertPitch&&(o(this.measureData,this.opts),f.check(this.opts.pitch)),this.sanitized=!0)},r.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos,pitch:f.copyWithoutAlter(this.opts.pitch),isConcertPitch:!1,checkLine:this.opts.checkLine
},c={actionName:this.name,opts:b};this.cancelStack.storeAction(c)}},r.getNoteAtPitch=function(){if(null===this.noteHead){var a=this.getVoice();this.noteHead=k(a,this.opts.noteIdx,this.opts.pitch)}return this.noteHead},r.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location},r.getAction=function(){if(null===this.action){var b,c=this.getNoteAtPitch(),k=e.getPitch(c),l=e.getStaffIdx(c),m=this.measureData.getKey(l);try{b=g.shiftHalfToneDown(k,m)}catch(b){if(b instanceof a){var n=f.copyWithoutAlter(k),o=h.create(-1);throw h.setDiatonic(o,-1),new d(n,o)}throw b}var p=f.getAlter(b),q=f.alterToAccidental(p),r={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx},s=null;f.isSameLine(k,b)?(r.pitch=f.copyWithoutAlter(k),r.accidental=q,this.action=new i(this.measureData,r,s)):(r.fromPitch=f.copyWithoutAlter(k),r.toPitch=f.copyWithoutAlter(b),r.accidental=q,r.checkLine=this.opts.checkLine,r.staffIdx=l,this.action=new j(this.measureData,r,s))}return this.action},r.getVoice=function(){return null===this.voice&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice}}.call(this),function(){"use strict";var a=Adagio.Error.client.NotPossibleOnUnpitchedError,b=Adagio.Error.client.PitchCollisionError,c=Adagio.Error.client.PitchOverflowError,d=Adagio.Error.client.LineOutOfRangeError,e=Adagio.Utils.noteUtils,f=Adagio.Utils.pitchUtils,g=Adagio.Utils.typeUtils,h=Adagio.edit.action.ShiftHalfToneDown,i=Adagio.edit.common.convertTimePosToGetNoteIdx,j=Adagio.edit.common.convertPartUuidToGetPartIdx,k=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,l=Adagio.edit.common.assertPerform,m=Adagio.edit.common.initMeasureData,n=Adagio.edit.action.ShiftChordHalfToneDown=function(a,b,c){this.init(a,b,c)};n.NAME="action.ShiftChordHalfToneDown";var o=n.prototype;o.name=n.NAME,o.initMeasureData=m,o.init=function(a,b,c){j(a,b),k(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.sanitized=!1,this.voice=null,this.wrappedActions=null,this.location=null},o.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),i(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),this.sanitizeIfNeeded();var a=this.getWrappedActions();if(!a.some(p))throw a[0].error};var p=function(a){try{a.action.checkPreconditions()}catch(b){if(r(b))return a.checked=!0,a.error=b,!1;throw b}return a.checked=!0,!0};o.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new a},o.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},o.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),i(this.measureData,this.opts),this.sanitizeIfNeeded(),this.storeAction(),this.getWrappedActions().forEach(this.callPerform,this)},o.sanitizeIfNeeded=function(){this.sanitized||(void 0===this.opts.checkLine&&(this.opts.checkLine=!0),this.sanitized=!0)},o.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos,checkLine:this.opts.checkLine},c={actionName:this.name,opts:b};this.cancelStack.storeAction(c)}},o.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location},o.getWrappedActions=function(){if(null===this.wrappedActions){var a=this.getVoice(),b=a.getChord(this.opts.noteIdx);b=g.makeArray(b);var c=b.map(e.getPitch);c.sort(q),this.wrappedActions=c.map(this.createWrappedAction,this)}return this.wrappedActions};var q=function(a,b){return f.compareLine(a,b)};o.createWrappedAction=function(a){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:f.copyWithoutAlter(a),checkLine:this.opts.checkLine,isConcertPitch:!1};return{action:new h(this.measureData,b,null),error:null,checked:!1}},o.getVoice=function(){return null===this.voice&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},o.callPerform=function(a){null===a.error&&(a.action.cancelStack=this.cancelStack,a.checked?a.action.perform():l(a.action,r))};var r=function(a){return a instanceof b||a instanceof c||a instanceof d}}.call(this),function(){"use strict";var a=Adagio.Error.PitchRangeError,b=Adagio.Error.client.NotPossibleOnUnpitchedError,c=Adagio.Error.client.PitchCollisionError,d=Adagio.Error.client.PitchOverflowError,e=Adagio.Utils.noteUtils,f=Adagio.Utils.pitchUtils,g=Adagio.Utils.pitchShift,h=Adagio.Utils.transposeUtils,i=Adagio.edit.action.ChangePitch,j=Adagio.edit.common.getNoteAtPitch,k=Adagio.edit.common.convertTimePosToGetNoteIdx,l=Adagio.edit.common.convertPartUuidToGetPartIdx,m=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,n=Adagio.edit.common.transposePitchLineOpts,o=Adagio.edit.common.initMeasureData,p=Adagio.edit.action.ShiftDiatonicUp=function(a,b,c){this.init(a,b,c)};p.NAME="action.ShiftDiatonicUp";var q=p.prototype;q.name=p.NAME,q.initMeasureData=o,q.init=function(a,b,c){l(a,b),m(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.sanitized=!1,this.noteHead=null,this.voice=null,this.action=null,this.location=null},q.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),k(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),f.check(this.opts.pitch),this.sanitizeIfNeeded(),this.checkNoteAtPitch(),this.getAction().checkPreconditions()},q.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new b},q.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},q.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},q.checkNoteAtPitch=function(){if(void 0===this.getNoteAtPitch()){var a=f.copy(this.opts.pitch);throw new c(c.action.GET,a)}},q.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),k(this.measureData,this.opts),this.sanitizeIfNeeded(),this.storeAction();var a=this.getAction();a.cancelStack=this.cancelStack,a.perform()},q.sanitizeIfNeeded=function(){this.sanitized||(void 0===this.opts.checkLine&&(this.opts.checkLine=!0),this.opts.isConcertPitch&&(n(this.measureData,this.opts),f.check(this.opts.pitch)),this.sanitized=!0)},q.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos,pitch:f.copyWithoutAlter(this.opts.pitch),isConcertPitch:!1,checkLine:this.opts.checkLine},c={actionName:this.name,opts:b};this.cancelStack.storeAction(c)}},q.getNoteAtPitch=function(){if(null===this.noteHead){var a=this.getVoice();this.noteHead=j(a,this.opts.noteIdx,this.opts.pitch)}return this.noteHead},q.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location},q.getAction=function(){if(null===this.action){var b,c=this.getNoteAtPitch(),j=e.getPitch(c),k=e.getStaffIdx(c),l=this.measureData.getKey(k);try{b=g.shiftDiatonicUp(j,l)}catch(b){if(b instanceof a){var m=f.copyWithoutAlter(j),n=h.create(1);throw h.setDiatonic(n,1),new d(m,n)}throw b}var o=f.getAlter(b),p=f.alterToAccidental(o),q={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};q.fromPitch=f.copyWithoutAlter(j),q.toPitch=f.copyWithoutAlter(b),q.accidental=p,q.checkLine=this.opts.checkLine,q.staffIdx=k,this.action=new i(this.measureData,q,null)}return this.action},q.getVoice=function(){return null===this.voice&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice}}.call(this),function(){"use strict";var a=Adagio.Error.client.NotPossibleOnUnpitchedError,b=Adagio.Error.client.PitchCollisionError,c=Adagio.Error.client.PitchOverflowError,d=Adagio.Error.client.LineOutOfRangeError,e=Adagio.Utils.noteUtils,f=Adagio.Utils.pitchUtils,g=Adagio.Utils.typeUtils,h=Adagio.edit.action.ShiftDiatonicUp,i=Adagio.edit.common.convertTimePosToGetNoteIdx,j=Adagio.edit.common.convertPartUuidToGetPartIdx,k=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,l=Adagio.edit.common.assertPerform,m=Adagio.edit.common.initMeasureData,n=Adagio.edit.action.ShiftChordDiatonicUp=function(a,b,c){this.init(a,b,c)};n.NAME="action.ShiftChordDiatonicUp";var o=n.prototype;o.name=n.NAME,o.initMeasureData=m,o.init=function(a,b,c){j(a,b),k(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.sanitized=!1,this.voice=null,this.wrappedActions=null,this.location=null},o.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),i(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),this.sanitizeIfNeeded();var a=this.getWrappedActions();if(!a.some(p))throw a[0].error};var p=function(a){try{a.action.checkPreconditions()}catch(b){if(r(b))return a.checked=!0,a.error=b,!1;throw b}return a.checked=!0,!0};o.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new a},o.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},o.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),i(this.measureData,this.opts),this.sanitizeIfNeeded(),this.storeAction(),this.getWrappedActions().forEach(this.callPerform,this)},o.sanitizeIfNeeded=function(){this.sanitized||(void 0===this.opts.checkLine&&(this.opts.checkLine=!0),this.sanitized=!0)},o.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos,checkLine:this.opts.checkLine},c={actionName:this.name,opts:b};this.cancelStack.storeAction(c)}},o.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location},o.getWrappedActions=function(){if(null===this.wrappedActions){var a=this.getVoice(),b=a.getChord(this.opts.noteIdx);b=g.makeArray(b);var c=b.map(e.getPitch);c.sort(q),this.wrappedActions=c.map(this.createWrappedAction,this)}return this.wrappedActions};var q=function(a,b){return-f.compareLine(a,b)};o.createWrappedAction=function(a){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:f.copyWithoutAlter(a),checkLine:this.opts.checkLine,isConcertPitch:!1};return{action:new h(this.measureData,b,null),error:null,checked:!1}},o.getVoice=function(){return null===this.voice&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},o.callPerform=function(a){null===a.error&&(a.action.cancelStack=this.cancelStack,a.checked?a.action.perform():l(a.action,r))};var r=function(a){return a instanceof b||a instanceof c||a instanceof d}}.call(this),function(){"use strict";var a=Adagio.Error.PitchRangeError,b=Adagio.Error.client.NotPossibleOnUnpitchedError,c=Adagio.Error.client.PitchCollisionError,d=Adagio.Error.client.PitchOverflowError,e=Adagio.Utils.noteUtils,f=Adagio.Utils.pitchUtils,g=Adagio.Utils.pitchShift,h=Adagio.Utils.transposeUtils,i=Adagio.edit.action.ChangePitch,j=Adagio.edit.common.getNoteAtPitch,k=Adagio.edit.common.convertTimePosToGetNoteIdx,l=Adagio.edit.common.convertPartUuidToGetPartIdx,m=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,n=Adagio.edit.common.transposePitchLineOpts,o=Adagio.edit.common.initMeasureData,p=Adagio.edit.action.ShiftDiatonicDown=function(a,b,c){this.init(a,b,c)};p.NAME="action.ShiftDiatonicDown";var q=p.prototype;q.name=p.NAME,q.initMeasureData=o,q.init=function(a,b,c){l(a,b),m(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.sanitized=!1,this.noteHead=null,this.voice=null,this.action=null,this.location=null},q.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),k(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),f.check(this.opts.pitch),this.sanitizeIfNeeded(),this.checkNoteAtPitch(),this.getAction().checkPreconditions()},q.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new b},q.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},q.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},q.checkNoteAtPitch=function(){if(void 0===this.getNoteAtPitch()){var a=f.copy(this.opts.pitch);throw new c(c.action.GET,a)}},q.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),k(this.measureData,this.opts),this.sanitizeIfNeeded(),this.storeAction();var a=this.getAction();a.cancelStack=this.cancelStack,a.perform()},q.sanitizeIfNeeded=function(){this.sanitized||(void 0===this.opts.checkLine&&(this.opts.checkLine=!0),this.opts.isConcertPitch&&(n(this.measureData,this.opts),f.check(this.opts.pitch)),this.sanitized=!0)},q.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos,pitch:f.copyWithoutAlter(this.opts.pitch),isConcertPitch:!1,checkLine:this.opts.checkLine},c={actionName:this.name,opts:b};this.cancelStack.storeAction(c)}},q.getNoteAtPitch=function(){if(null===this.noteHead){var a=this.getVoice();this.noteHead=j(a,this.opts.noteIdx,this.opts.pitch)}return this.noteHead},q.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location},q.getAction=function(){if(null===this.action){var b,c=this.getNoteAtPitch(),j=e.getPitch(c),k=e.getStaffIdx(c),l=this.measureData.getKey(k);try{b=g.shiftDiatonicDown(j,l)}catch(b){if(b instanceof a){var m=f.copyWithoutAlter(j),n=h.create(-1);throw h.setDiatonic(n,-1),new d(m,n)}throw b}var o=f.getAlter(b),p=f.alterToAccidental(o),q={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};q.fromPitch=f.copyWithoutAlter(j),q.toPitch=f.copyWithoutAlter(b),q.accidental=p,q.checkLine=this.opts.checkLine,q.staffIdx=k,this.action=new i(this.measureData,q,null)}return this.action},q.getVoice=function(){return null===this.voice&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice}}.call(this),function(){"use strict";var a=Adagio.Error.client.NotPossibleOnUnpitchedError,b=Adagio.Error.client.PitchCollisionError,c=Adagio.Error.client.PitchOverflowError,d=Adagio.Error.client.LineOutOfRangeError,e=Adagio.Utils.noteUtils,f=Adagio.Utils.pitchUtils,g=Adagio.Utils.typeUtils,h=Adagio.edit.action.ShiftDiatonicDown,i=Adagio.edit.common.convertTimePosToGetNoteIdx,j=Adagio.edit.common.convertPartUuidToGetPartIdx,k=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,l=Adagio.edit.common.assertPerform,m=Adagio.edit.common.initMeasureData,n=Adagio.edit.action.ShiftChordDiatonicDown=function(a,b,c){this.init(a,b,c)};n.NAME="action.ShiftChordDiatonicDown";var o=n.prototype;o.name=n.NAME,o.initMeasureData=m,o.init=function(a,b,c){j(a,b),k(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.sanitized=!1,this.voice=null,this.wrappedActions=null,this.location=null},o.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),i(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),this.sanitizeIfNeeded();var a=this.getWrappedActions();if(!a.some(p))throw a[0].error};var p=function(a){try{a.action.checkPreconditions()}catch(b){if(r(b))return a.checked=!0,a.error=b,!1;throw b}return a.checked=!0,!0};o.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new a},o.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},o.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),i(this.measureData,this.opts),this.sanitizeIfNeeded(),this.storeAction(),this.getWrappedActions().forEach(this.callPerform,this)},o.sanitizeIfNeeded=function(){this.sanitized||(void 0===this.opts.checkLine&&(this.opts.checkLine=!0),this.sanitized=!0)},o.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos,checkLine:this.opts.checkLine},c={actionName:this.name,opts:b};this.cancelStack.storeAction(c)}},o.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location},o.getWrappedActions=function(){if(null===this.wrappedActions){var a=this.getVoice(),b=a.getChord(this.opts.noteIdx);b=g.makeArray(b);var c=b.map(e.getPitch);c.sort(q),this.wrappedActions=c.map(this.createWrappedAction,this)}return this.wrappedActions};var q=function(a,b){return f.compareLine(a,b)};o.createWrappedAction=function(a){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:f.copyWithoutAlter(a),checkLine:this.opts.checkLine,isConcertPitch:!1};return{action:new h(this.measureData,b,null),error:null,checked:!1}},o.getVoice=function(){return null===this.voice&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},o.callPerform=function(a){null===a.error&&(a.action.cancelStack=this.cancelStack,a.checked?a.action.perform():l(a.action,r))};var r=function(a){return a instanceof b||a instanceof c||a instanceof d}}.call(this),function(){"use strict";var a=Adagio.Error.PitchRangeError,b=Adagio.Error.client.NotPossibleOnUnpitchedError,c=Adagio.Error.client.PitchCollisionError,d=Adagio.Error.client.PitchOverflowError,e=Adagio.Utils.noteUtils,f=Adagio.Utils.pitchUtils,g=Adagio.Utils.pitchShift,h=Adagio.Utils.transposeUtils,i=Adagio.edit.action.AddGraceAccidental,j=Adagio.edit.action.ChangeGracePitch,k=Adagio.edit.common.getGraceAtPitch,l=Adagio.edit.common.convertTimePosToGetNoteIdx,m=Adagio.edit.common.convertPartUuidToGetPartIdx,n=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,o=Adagio.edit.common.transposePitchLineOpts,p=Adagio.edit.common.initMeasureData,q=Adagio.edit.action.ShiftGraceDiatonicUp=function(a,b,c){this.init(a,b,c)};q.NAME="action.ShiftGraceDiatonicUp";var r=q.prototype;r.name=q.NAME,r.initMeasureData=p,r.init=function(a,b,c){m(a,b),n(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.sanitized=!1,this.noteHead=null,this.voice=null,this.action=null,this.location=null},r.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),l(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),this.checkGraceIdx(),f.check(this.opts.pitch),this.sanitizeIfNeeded(),this.checkNoteAtPitch(),this.getAction().checkPreconditions()},r.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new b},r.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},r.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},r.checkGraceIdx=function(){this.getVoice().checkGraceIdx(this.opts.noteIdx,this.opts.graceIdx)},r.checkNoteAtPitch=function(){if(void 0===this.getGraceAtPitch()){var a=f.copy(this.opts.pitch);throw new c(c.action.GET,a)}},r.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),l(this.measureData,this.opts),this.sanitizeIfNeeded(),this.storeAction();var a=this.getAction();a.cancelStack=this.cancelStack,a.perform()},r.sanitizeIfNeeded=function(){this.sanitized||(void 0===this.opts.checkLine&&(this.opts.checkLine=!0),this.opts.isConcertPitch&&(o(this.measureData,this.opts),f.check(this.opts.pitch)),this.sanitized=!0)},r.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,graceIdx:this.opts.graceIdx,divisions:a.dpq,timePos:a.timePos,pitch:f.copyWithoutAlter(this.opts.pitch),isConcertPitch:!1,checkLine:this.opts.checkLine},c={actionName:this.name,opts:b};this.cancelStack.storeAction(c)}},r.getGraceAtPitch=function(){if(null===this.noteHead){var a=this.getVoice();this.noteHead=k(a,this.opts.noteIdx,this.opts.graceIdx,this.opts.pitch)}return this.noteHead},r.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location},r.getAction=function(){if(null===this.action){var b,c=this.getGraceAtPitch(),k=e.getPitch(c),l=e.getStaffIdx(c),m=this.measureData.getKey(l);try{b=g.shiftDiatonicUp(k,m)}catch(b){if(b instanceof a){var n=f.copyWithoutAlter(k),o=h.create(1);throw h.setDiatonic(o,1),new d(n,o)}throw b}var p=f.getAlter(b),q=f.alterToAccidental(p),r={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx},s=null;f.isSameLine(k,b)?(r.pitch=f.copyWithoutAlter(k),r.accidental=q,this.action=new i(this.measureData,r,s)):(r.fromPitch=f.copyWithoutAlter(k),r.toPitch=f.copyWithoutAlter(b),r.accidental=q,r.checkLine=this.opts.checkLine,r.staffIdx=l,this.action=new j(this.measureData,r,s))}return this.action},r.getVoice=function(){return null===this.voice&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice}}.call(this),function(){"use strict";var a=Adagio.Error.client.NotPossibleOnUnpitchedError,b=Adagio.Error.client.PitchCollisionError,c=Adagio.Error.client.PitchOverflowError,d=Adagio.Error.client.LineOutOfRangeError,e=Adagio.Utils.noteUtils,f=Adagio.Utils.pitchUtils,g=Adagio.Utils.typeUtils,h=Adagio.edit.action.ShiftGraceDiatonicUp,i=Adagio.edit.common.convertTimePosToGetNoteIdx,j=Adagio.edit.common.convertPartUuidToGetPartIdx,k=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,l=Adagio.edit.common.assertPerform,m=Adagio.edit.common.initMeasureData,n=Adagio.edit.action.ShiftGraceChordDiatonicUp=function(a,b,c){this.init(a,b,c)};n.NAME="action.ShiftGraceChordDiatonicUp";var o=n.prototype;o.name=n.NAME,o.initMeasureData=m,o.init=function(a,b,c){j(a,b),k(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.sanitized=!1,this.voice=null,this.wrappedActions=null,this.location=null},o.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),i(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),this.checkGraceIdx(),this.sanitizeIfNeeded();var a=this.getWrappedActions();if(!a.some(p))throw a[0].error};var p=function(a){try{a.action.checkPreconditions()}catch(b){if(r(b))return a.checked=!0,a.error=b,!1;throw b}return a.checked=!0,!0};o.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new a},o.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},o.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},o.checkGraceIdx=function(){this.getVoice().checkGraceIdx(this.opts.noteIdx,this.opts.graceIdx)},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),i(this.measureData,this.opts),this.sanitizeIfNeeded(),this.storeAction(),this.getWrappedActions().forEach(this.callPerform,this)},o.sanitizeIfNeeded=function(){this.sanitized||(void 0===this.opts.checkLine&&(this.opts.checkLine=!0),this.sanitized=!0)},o.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,graceIdx:this.opts.graceIdx,divisions:a.dpq,timePos:a.timePos,checkLine:this.opts.checkLine},c={actionName:this.name,opts:b};this.cancelStack.storeAction(c)}},o.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location},o.getWrappedActions=function(){if(null===this.wrappedActions){var a=this.getVoice(),b=a.getGraceChord(this.opts.noteIdx,this.opts.graceIdx);b=g.makeArray(b);var c=b.map(e.getPitch);c.sort(q),this.wrappedActions=c.map(this.createWrappedAction,this)}return this.wrappedActions};var q=function(a,b){return-f.compareLine(a,b)};o.createWrappedAction=function(a){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,pitch:f.copyWithoutAlter(a),checkLine:this.opts.checkLine,isConcertPitch:!1};return{action:new h(this.measureData,b,null),error:null,checked:!1}},o.getVoice=function(){return null===this.voice&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},o.callPerform=function(a){null===a.error&&(a.action.cancelStack=this.cancelStack,a.checked?a.action.perform():l(a.action,r))};var r=function(a){return a instanceof b||a instanceof c||a instanceof d}}.call(this),function(){"use strict";var a=Adagio.Error.PitchRangeError,b=Adagio.Error.client.NotPossibleOnUnpitchedError,c=Adagio.Error.client.PitchCollisionError,d=Adagio.Error.client.PitchOverflowError,e=Adagio.Utils.noteUtils,f=Adagio.Utils.pitchUtils,g=Adagio.Utils.pitchShift,h=Adagio.Utils.transposeUtils,i=Adagio.edit.action.AddGraceAccidental,j=Adagio.edit.action.ChangeGracePitch,k=Adagio.edit.common.getGraceAtPitch,l=Adagio.edit.common.convertTimePosToGetNoteIdx,m=Adagio.edit.common.convertPartUuidToGetPartIdx,n=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,o=Adagio.edit.common.transposePitchLineOpts,p=Adagio.edit.common.initMeasureData,q=Adagio.edit.action.ShiftGraceDiatonicDown=function(a,b,c){this.init(a,b,c)};q.NAME="action.ShiftGraceDiatonicDown";var r=q.prototype;r.name=q.NAME,r.initMeasureData=p,r.init=function(a,b,c){m(a,b),n(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.sanitized=!1,this.noteHead=null,this.voice=null,this.action=null,this.location=null},r.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),l(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),this.checkGraceIdx(),f.check(this.opts.pitch),this.sanitizeIfNeeded(),this.checkNoteAtPitch(),this.getAction().checkPreconditions()},r.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new b},r.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},r.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},r.checkGraceIdx=function(){this.getVoice().checkGraceIdx(this.opts.noteIdx,this.opts.graceIdx)},r.checkNoteAtPitch=function(){if(void 0===this.getGraceAtPitch()){var a=f.copy(this.opts.pitch);throw new c(c.action.GET,a)}},r.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),l(this.measureData,this.opts),this.sanitizeIfNeeded(),this.storeAction();var a=this.getAction();a.cancelStack=this.cancelStack,a.perform()},r.sanitizeIfNeeded=function(){this.sanitized||(void 0===this.opts.checkLine&&(this.opts.checkLine=!0),this.opts.isConcertPitch&&(o(this.measureData,this.opts),f.check(this.opts.pitch)),this.sanitized=!0)},r.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,graceIdx:this.opts.graceIdx,divisions:a.dpq,timePos:a.timePos,pitch:f.copyWithoutAlter(this.opts.pitch),isConcertPitch:!1,checkLine:this.opts.checkLine},c={actionName:this.name,opts:b};this.cancelStack.storeAction(c)}},r.getGraceAtPitch=function(){if(null===this.noteHead){var a=this.getVoice();this.noteHead=k(a,this.opts.noteIdx,this.opts.graceIdx,this.opts.pitch)}return this.noteHead},r.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location},r.getAction=function(){if(null===this.action){var b,c=this.getGraceAtPitch(),k=e.getPitch(c),l=e.getStaffIdx(c),m=this.measureData.getKey(l);try{b=g.shiftDiatonicDown(k,m)}catch(b){if(b instanceof a){var n=f.copyWithoutAlter(k),o=h.create(-1);throw h.setDiatonic(o,-1),new d(n,o)}throw b}var p=f.getAlter(b),q=f.alterToAccidental(p),r={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx},s=null;f.isSameLine(k,b)?(r.pitch=f.copyWithoutAlter(k),r.accidental=q,this.action=new i(this.measureData,r,s)):(r.fromPitch=f.copyWithoutAlter(k),r.toPitch=f.copyWithoutAlter(b),r.accidental=q,r.checkLine=this.opts.checkLine,r.staffIdx=l,this.action=new j(this.measureData,r,s))}return this.action},r.getVoice=function(){return null===this.voice&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice}}.call(this),function(){"use strict";var a=Adagio.Error.client.NotPossibleOnUnpitchedError,b=Adagio.Error.client.PitchCollisionError,c=Adagio.Error.client.PitchOverflowError,d=Adagio.Error.client.LineOutOfRangeError,e=Adagio.Utils.noteUtils,f=Adagio.Utils.pitchUtils,g=Adagio.Utils.typeUtils,h=Adagio.edit.action.ShiftGraceDiatonicDown,i=Adagio.edit.common.convertTimePosToGetNoteIdx,j=Adagio.edit.common.convertPartUuidToGetPartIdx,k=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,l=Adagio.edit.common.assertPerform,m=Adagio.edit.common.initMeasureData,n=Adagio.edit.action.ShiftGraceChordDiatonicDown=function(a,b,c){this.init(a,b,c)};n.NAME="action.ShiftGraceChordDiatonicDown";var o=n.prototype;o.name=n.NAME,o.initMeasureData=m,o.init=function(a,b,c){j(a,b),k(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.sanitized=!1,this.voice=null,this.wrappedActions=null,this.location=null},o.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),i(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),this.checkGraceIdx(),this.sanitizeIfNeeded();var a=this.getWrappedActions();if(!a.some(p))throw a[0].error};var p=function(a){try{a.action.checkPreconditions()}catch(b){if(r(b))return a.checked=!0,a.error=b,!1;throw b}return a.checked=!0,!0};o.checkPitchedPart=function(){
if(this.measureData.isUnpitched())throw new a},o.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},o.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},o.checkGraceIdx=function(){this.getVoice().checkGraceIdx(this.opts.noteIdx,this.opts.graceIdx)},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),i(this.measureData,this.opts),this.sanitizeIfNeeded(),this.storeAction(),this.getWrappedActions().forEach(this.callPerform,this)},o.sanitizeIfNeeded=function(){this.sanitized||(void 0===this.opts.checkLine&&(this.opts.checkLine=!0),this.sanitized=!0)},o.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,graceIdx:this.opts.graceIdx,divisions:a.dpq,timePos:a.timePos,checkLine:this.opts.checkLine},c={actionName:this.name,opts:b};this.cancelStack.storeAction(c)}},o.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location},o.getWrappedActions=function(){if(null===this.wrappedActions){var a=this.getVoice(),b=a.getGraceChord(this.opts.noteIdx,this.opts.graceIdx);b=g.makeArray(b);var c=b.map(e.getPitch);c.sort(q),this.wrappedActions=c.map(this.createWrappedAction,this)}return this.wrappedActions};var q=function(a,b){return f.compareLine(a,b)};o.createWrappedAction=function(a){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,pitch:f.copyWithoutAlter(a),checkLine:this.opts.checkLine,isConcertPitch:!1};return{action:new h(this.measureData,b,null),error:null,checked:!1}},o.getVoice=function(){return null===this.voice&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},o.callPerform=function(a){null===a.error&&(a.action.cancelStack=this.cancelStack,a.checked?a.action.perform():l(a.action,r))};var r=function(a){return a instanceof b||a instanceof c||a instanceof d}}.call(this),function(){"use strict";var a=Adagio.Error.client.NotPossibleOnUnpitchedError,b=Adagio.Error.client.PitchCollisionError,c=Adagio.Error.client.PitchOverflowError,d=Adagio.Error.client.LineOutOfRangeError,e=Adagio.Error.noChange.NoChangeError,f=Adagio.edit.action.ShiftGraceChordDiatonicUp,g=Adagio.edit.common.convertTimePosToGetNoteIdx,h=Adagio.edit.common.convertPartUuidToGetPartIdx,i=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,j=Adagio.edit.common.assertPerform,k=Adagio.edit.common.initMeasureData,l=Adagio.edit.action.ShiftGracesDiatonicUp=function(a,b,c){this.init(a,b,c)};l.NAME="action.ShiftGracesDiatonicUp";var m=l.prototype;m.name=l.NAME,m.initMeasureData=k,m.init=function(a,b,c){h(a,b),i(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.sanitized=!1,this.voice=null,this.wrappedActions=null,this.location=null},m.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),g(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),this.sanitizeIfNeeded();var a=this.getWrappedActions();if(0===a.length)throw new e;if(!a.some(n))throw a[0].error};var n=function(a){try{a.action.checkPreconditions()}catch(b){if(o(b))return a.checked=!0,a.error=b,!1;throw b}return a.checked=!0,!0};m.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new a},m.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},m.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},m.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),g(this.measureData,this.opts),this.sanitizeIfNeeded(),this.storeAction(),this.getWrappedActions().forEach(this.callPerform,this)},m.sanitizeIfNeeded=function(){this.sanitized||(void 0===this.opts.checkLine&&(this.opts.checkLine=!0),this.sanitized=!0)},m.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos,checkLine:this.opts.checkLine},c={actionName:this.name,opts:b};this.cancelStack.storeAction(c)}},m.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location},m.getWrappedActions=function(){if(null===this.wrappedActions){this.wrappedActions=[];for(var a=this.getVoice(),b=a.getNbGraces(this.opts.noteIdx),c=0;c<b;c++){var d=this.createWrappedAction(c);this.wrappedActions.push(d)}}return this.wrappedActions},m.createWrappedAction=function(a){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:a,checkLine:this.opts.checkLine,isConcertPitch:!1};return{action:new f(this.measureData,b,null),error:null,checked:!1}},m.getVoice=function(){return null===this.voice&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},m.callPerform=function(a){null===a.error&&(a.action.cancelStack=this.cancelStack,a.checked?a.action.perform():j(a.action,o))};var o=function(a){return a instanceof b||a instanceof c||a instanceof d}}.call(this),function(){"use strict";var a=Adagio.Error.client.NotPossibleOnUnpitchedError,b=Adagio.Error.client.PitchCollisionError,c=Adagio.Error.client.PitchOverflowError,d=Adagio.Error.client.LineOutOfRangeError,e=Adagio.Error.noChange.NoChangeError,f=Adagio.edit.action.ShiftGraceChordDiatonicDown,g=Adagio.edit.common.convertTimePosToGetNoteIdx,h=Adagio.edit.common.convertPartUuidToGetPartIdx,i=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,j=Adagio.edit.common.assertPerform,k=Adagio.edit.common.initMeasureData,l=Adagio.edit.action.ShiftGracesDiatonicDown=function(a,b,c){this.init(a,b,c)};l.NAME="action.ShiftGracesDiatonicDown";var m=l.prototype;m.name=l.NAME,m.initMeasureData=k,m.init=function(a,b,c){h(a,b),i(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.sanitized=!1,this.voice=null,this.wrappedActions=null,this.location=null},m.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),g(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),this.sanitizeIfNeeded();var a=this.getWrappedActions();if(0===a.length)throw new e;if(!a.some(n))throw a[0].error};var n=function(a){try{a.action.checkPreconditions()}catch(b){if(o(b))return a.checked=!0,a.error=b,!1;throw b}return a.checked=!0,!0};m.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new a},m.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},m.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},m.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),g(this.measureData,this.opts),this.sanitizeIfNeeded(),this.storeAction(),this.getWrappedActions().forEach(this.callPerform,this)},m.sanitizeIfNeeded=function(){this.sanitized||(void 0===this.opts.checkLine&&(this.opts.checkLine=!0),this.sanitized=!0)},m.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos,checkLine:this.opts.checkLine},c={actionName:this.name,opts:b};this.cancelStack.storeAction(c)}},m.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location},m.getWrappedActions=function(){if(null===this.wrappedActions){this.wrappedActions=[];for(var a=this.getVoice(),b=a.getNbGraces(this.opts.noteIdx),c=0;c<b;c++){var d=this.createWrappedAction(c);this.wrappedActions.push(d)}}return this.wrappedActions},m.createWrappedAction=function(a){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:a,checkLine:this.opts.checkLine,isConcertPitch:!1};return{action:new f(this.measureData,b,null),error:null,checked:!1}},m.getVoice=function(){return null===this.voice&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},m.callPerform=function(a){null===a.error&&(a.action.cancelStack=this.cancelStack,a.checked?a.action.perform():j(a.action,o))};var o=function(a){return a instanceof b||a instanceof c||a instanceof d}}.call(this),function(){"use strict";var a=Adagio.Error.PitchRangeError,b=Adagio.Error.client.NotPossibleOnUnpitchedError,c=Adagio.Error.client.PitchCollisionError,d=Adagio.Error.client.PitchOverflowError,e=Adagio.Utils.noteUtils,f=Adagio.Utils.pitchUtils,g=Adagio.Utils.pitchShift,h=Adagio.Utils.transposeUtils,i=Adagio.edit.action.AddGraceAccidental,j=Adagio.edit.action.ChangeGracePitch,k=Adagio.edit.common.getGraceAtPitch,l=Adagio.edit.common.convertTimePosToGetNoteIdx,m=Adagio.edit.common.convertPartUuidToGetPartIdx,n=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,o=Adagio.edit.common.transposePitchLineOpts,p=Adagio.edit.common.initMeasureData,q=Adagio.edit.action.ShiftGraceHalfToneUp=function(a,b,c){this.init(a,b,c)};q.NAME="action.ShiftGraceHalfToneUp";var r=q.prototype;r.name=q.NAME,r.initMeasureData=p,r.init=function(a,b,c){m(a,b),n(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.sanitized=!1,this.noteHead=null,this.voice=null,this.action=null,this.location=null},r.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),l(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),this.checkGraceIdx(),f.check(this.opts.pitch),this.sanitizeIfNeeded(),this.checkNoteAtPitch(),this.getAction().checkPreconditions()},r.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new b},r.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},r.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},r.checkGraceIdx=function(){this.getVoice().checkGraceIdx(this.opts.noteIdx,this.opts.graceIdx)},r.checkNoteAtPitch=function(){if(void 0===this.getGraceAtPitch()){var a=f.copy(this.opts.pitch);throw new c(c.action.GET,a)}},r.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),l(this.measureData,this.opts),this.sanitizeIfNeeded(),this.storeAction();var a=this.getAction();a.cancelStack=this.cancelStack,a.perform()},r.sanitizeIfNeeded=function(){this.sanitized||(void 0===this.opts.checkLine&&(this.opts.checkLine=!0),this.opts.isConcertPitch&&(o(this.measureData,this.opts),f.check(this.opts.pitch)),this.sanitized=!0)},r.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,graceIdx:this.opts.graceIdx,divisions:a.dpq,timePos:a.timePos,pitch:f.copyWithoutAlter(this.opts.pitch),isConcertPitch:!1,checkLine:this.opts.checkLine},c={actionName:this.name,opts:b};this.cancelStack.storeAction(c)}},r.getGraceAtPitch=function(){if(null===this.noteHead){var a=this.getVoice();this.noteHead=k(a,this.opts.noteIdx,this.opts.graceIdx,this.opts.pitch)}return this.noteHead},r.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location},r.getAction=function(){if(null===this.action){var b,c=this.getGraceAtPitch(),k=e.getPitch(c),l=e.getStaffIdx(c),m=this.measureData.getKey(l);try{b=g.shiftHalfToneUp(k,m)}catch(b){if(b instanceof a){var n=f.copyWithoutAlter(k),o=h.create(1);throw h.setDiatonic(o,1),new d(n,o)}throw b}var p=f.getAlter(b),q=f.alterToAccidental(p),r={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx},s=null;f.isSameLine(k,b)?(r.pitch=f.copyWithoutAlter(k),r.accidental=q,this.action=new i(this.measureData,r,s)):(r.fromPitch=f.copyWithoutAlter(k),r.toPitch=f.copyWithoutAlter(b),r.accidental=q,r.checkLine=this.opts.checkLine,r.staffIdx=l,this.action=new j(this.measureData,r,s))}return this.action},r.getVoice=function(){return null===this.voice&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice}}.call(this),function(){"use strict";var a=Adagio.Error.client.NotPossibleOnUnpitchedError,b=Adagio.Error.client.PitchCollisionError,c=Adagio.Error.client.PitchOverflowError,d=Adagio.Error.client.LineOutOfRangeError,e=Adagio.Utils.noteUtils,f=Adagio.Utils.pitchUtils,g=Adagio.Utils.typeUtils,h=Adagio.edit.action.ShiftGraceHalfToneUp,i=Adagio.edit.common.convertTimePosToGetNoteIdx,j=Adagio.edit.common.convertPartUuidToGetPartIdx,k=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,l=Adagio.edit.common.assertPerform,m=Adagio.edit.common.initMeasureData,n=Adagio.edit.action.ShiftGraceChordHalfToneUp=function(a,b,c){this.init(a,b,c)};n.NAME="action.ShiftGraceChordHalfToneUp";var o=n.prototype;o.name=n.NAME,o.initMeasureData=m,o.init=function(a,b,c){j(a,b),k(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.sanitized=!1,this.voice=null,this.wrappedActions=null,this.location=null},o.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),i(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),this.checkGraceIdx(),this.sanitizeIfNeeded();var a=this.getWrappedActions();if(!a.some(p))throw a[0].error};var p=function(a){try{a.action.checkPreconditions()}catch(b){if(r(b))return a.checked=!0,a.error=b,!1;throw b}return a.checked=!0,!0};o.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new a},o.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},o.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},o.checkGraceIdx=function(){this.getVoice().checkGraceIdx(this.opts.noteIdx,this.opts.graceIdx)},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),i(this.measureData,this.opts),this.sanitizeIfNeeded(),this.storeAction(),this.getWrappedActions().forEach(this.callPerform,this)},o.sanitizeIfNeeded=function(){this.sanitized||(void 0===this.opts.checkLine&&(this.opts.checkLine=!0),this.sanitized=!0)},o.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,graceIdx:this.opts.graceIdx,divisions:a.dpq,timePos:a.timePos,checkLine:this.opts.checkLine},c={actionName:this.name,opts:b};this.cancelStack.storeAction(c)}},o.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location},o.getWrappedActions=function(){if(null===this.wrappedActions){var a=this.getVoice(),b=a.getGraceChord(this.opts.noteIdx,this.opts.graceIdx);b=g.makeArray(b);var c=b.map(e.getPitch);c.sort(q),this.wrappedActions=c.map(this.createWrappedAction,this)}return this.wrappedActions};var q=function(a,b){return-f.compareLine(a,b)};o.createWrappedAction=function(a){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,pitch:f.copyWithoutAlter(a),checkLine:this.opts.checkLine,isConcertPitch:!1};return{action:new h(this.measureData,b,null),error:null,checked:!1}},o.getVoice=function(){return null===this.voice&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},o.callPerform=function(a){null===a.error&&(a.action.cancelStack=this.cancelStack,a.checked?a.action.perform():l(a.action,r))};var r=function(a){return a instanceof b||a instanceof c||a instanceof d}}.call(this),function(){"use strict";var a=Adagio.Error.client.NotPossibleOnUnpitchedError,b=Adagio.Error.client.PitchCollisionError,c=Adagio.Error.client.PitchOverflowError,d=Adagio.Error.client.LineOutOfRangeError,e=Adagio.Error.noChange.NoChangeError,f=Adagio.edit.action.ShiftGraceChordHalfToneUp,g=Adagio.edit.common.convertTimePosToGetNoteIdx,h=Adagio.edit.common.convertPartUuidToGetPartIdx,i=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,j=Adagio.edit.common.assertPerform,k=Adagio.edit.common.initMeasureData,l=Adagio.edit.action.ShiftGracesHalfToneUp=function(a,b,c){this.init(a,b,c)};l.NAME="action.ShiftGracesHalfToneUp";var m=l.prototype;m.name=l.NAME,m.initMeasureData=k,m.init=function(a,b,c){h(a,b),i(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.sanitized=!1,this.voice=null,this.wrappedActions=null,this.location=null},m.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),g(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),this.sanitizeIfNeeded();var a=this.getWrappedActions();if(0===a.length)throw new e;if(!a.some(n))throw a[0].error};var n=function(a){try{a.action.checkPreconditions()}catch(b){if(o(b))return a.checked=!0,a.error=b,!1;throw b}return a.checked=!0,!0};m.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new a},m.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},m.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},m.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),g(this.measureData,this.opts),this.sanitizeIfNeeded(),this.storeAction(),this.getWrappedActions().forEach(this.callPerform,this)},m.sanitizeIfNeeded=function(){this.sanitized||(void 0===this.opts.checkLine&&(this.opts.checkLine=!0),this.sanitized=!0)},m.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos,checkLine:this.opts.checkLine},c={actionName:this.name,opts:b};this.cancelStack.storeAction(c)}},m.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location},m.getWrappedActions=function(){if(null===this.wrappedActions){this.wrappedActions=[];for(var a=this.getVoice(),b=a.getNbGraces(this.opts.noteIdx),c=0;c<b;c++){var d=this.createWrappedAction(c);this.wrappedActions.push(d)}}return this.wrappedActions},m.createWrappedAction=function(a){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:a,checkLine:this.opts.checkLine,isConcertPitch:!1};return{action:new f(this.measureData,b,null),error:null,checked:!1}},m.getVoice=function(){return null===this.voice&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},m.callPerform=function(a){null===a.error&&(a.action.cancelStack=this.cancelStack,a.checked?a.action.perform():j(a.action,o))};var o=function(a){return a instanceof b||a instanceof c||a instanceof d}}.call(this),function(){"use strict";var a=Adagio.Error.PitchRangeError,b=Adagio.Error.client.NotPossibleOnUnpitchedError,c=Adagio.Error.client.PitchCollisionError,d=Adagio.Error.client.PitchOverflowError,e=Adagio.Utils.noteUtils,f=Adagio.Utils.pitchUtils,g=Adagio.Utils.pitchShift,h=Adagio.Utils.transposeUtils,i=Adagio.edit.action.AddGraceAccidental,j=Adagio.edit.action.ChangeGracePitch,k=Adagio.edit.common.getGraceAtPitch,l=Adagio.edit.common.convertTimePosToGetNoteIdx,m=Adagio.edit.common.convertPartUuidToGetPartIdx,n=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,o=Adagio.edit.common.transposePitchLineOpts,p=Adagio.edit.common.initMeasureData,q=Adagio.edit.action.ShiftGraceHalfToneDown=function(a,b,c){this.init(a,b,c)};q.NAME="action.ShiftGraceHalfToneDown";var r=q.prototype;r.name=q.NAME,r.initMeasureData=p,r.init=function(a,b,c){m(a,b),n(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.sanitized=!1,this.noteHead=null,this.voice=null,this.action=null,this.location=null},r.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),l(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),this.checkGraceIdx(),f.check(this.opts.pitch),this.sanitizeIfNeeded(),this.checkNoteAtPitch(),this.getAction().checkPreconditions()},r.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new b},r.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},r.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},r.checkGraceIdx=function(){this.getVoice().checkGraceIdx(this.opts.noteIdx,this.opts.graceIdx)},r.checkNoteAtPitch=function(){if(void 0===this.getGraceAtPitch()){var a=f.copy(this.opts.pitch);throw new c(c.action.GET,a)}},r.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),l(this.measureData,this.opts),this.sanitizeIfNeeded(),this.storeAction();var a=this.getAction();a.cancelStack=this.cancelStack,a.perform()},r.sanitizeIfNeeded=function(){this.sanitized||(void 0===this.opts.checkLine&&(this.opts.checkLine=!0),this.opts.isConcertPitch&&(o(this.measureData,this.opts),f.check(this.opts.pitch)),this.sanitized=!0)},r.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,graceIdx:this.opts.graceIdx,divisions:a.dpq,timePos:a.timePos,pitch:f.copyWithoutAlter(this.opts.pitch),isConcertPitch:!1,checkLine:this.opts.checkLine},c={actionName:this.name,opts:b};this.cancelStack.storeAction(c)}},r.getGraceAtPitch=function(){if(null===this.noteHead){var a=this.getVoice();this.noteHead=k(a,this.opts.noteIdx,this.opts.graceIdx,this.opts.pitch)}return this.noteHead},r.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location},r.getAction=function(){if(null===this.action){var b,c=this.getGraceAtPitch(),k=e.getPitch(c),l=e.getStaffIdx(c),m=this.measureData.getKey(l);try{b=g.shiftHalfToneDown(k,m)}catch(b){if(b instanceof a){var n=f.copyWithoutAlter(k),o=h.create(-1);throw h.setDiatonic(o,-1),new d(n,o)}throw b}var p=f.getAlter(b),q=f.alterToAccidental(p),r={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx},s=null;f.isSameLine(k,b)?(r.pitch=f.copyWithoutAlter(k),r.accidental=q,this.action=new i(this.measureData,r,s)):(r.fromPitch=f.copyWithoutAlter(k),r.toPitch=f.copyWithoutAlter(b),r.accidental=q,r.checkLine=this.opts.checkLine,r.staffIdx=l,this.action=new j(this.measureData,r,s))}return this.action},r.getVoice=function(){return null===this.voice&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice}}.call(this),function(){"use strict";var a=Adagio.Error.client.NotPossibleOnUnpitchedError,b=Adagio.Error.client.PitchCollisionError,c=Adagio.Error.client.PitchOverflowError,d=Adagio.Error.client.LineOutOfRangeError,e=Adagio.Utils.noteUtils,f=Adagio.Utils.pitchUtils,g=Adagio.Utils.typeUtils,h=Adagio.edit.action.ShiftGraceHalfToneDown,i=Adagio.edit.common.convertTimePosToGetNoteIdx,j=Adagio.edit.common.convertPartUuidToGetPartIdx,k=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,l=Adagio.edit.common.assertPerform,m=Adagio.edit.common.initMeasureData,n=Adagio.edit.action.ShiftGraceChordHalfToneDown=function(a,b,c){this.init(a,b,c)};n.NAME="action.ShiftGraceChordHalfToneDown";var o=n.prototype;o.name=n.NAME,o.initMeasureData=m,o.init=function(a,b,c){j(a,b),k(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.sanitized=!1,this.voice=null,this.wrappedActions=null,this.location=null},o.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),i(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),this.checkGraceIdx(),this.sanitizeIfNeeded();var a=this.getWrappedActions();if(!a.some(p))throw a[0].error};var p=function(a){try{a.action.checkPreconditions()}catch(b){if(r(b))return a.checked=!0,a.error=b,!1;throw b}return a.checked=!0,!0};o.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new a},o.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},o.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},o.checkGraceIdx=function(){this.getVoice().checkGraceIdx(this.opts.noteIdx,this.opts.graceIdx)},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),i(this.measureData,this.opts),this.sanitizeIfNeeded(),this.storeAction(),this.getWrappedActions().forEach(this.callPerform,this)},o.sanitizeIfNeeded=function(){this.sanitized||(void 0===this.opts.checkLine&&(this.opts.checkLine=!0),this.sanitized=!0)},o.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,graceIdx:this.opts.graceIdx,divisions:a.dpq,timePos:a.timePos,checkLine:this.opts.checkLine},c={actionName:this.name,opts:b};this.cancelStack.storeAction(c)}},o.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location},o.getWrappedActions=function(){if(null===this.wrappedActions){var a=this.getVoice(),b=a.getGraceChord(this.opts.noteIdx,this.opts.graceIdx);b=g.makeArray(b);var c=b.map(e.getPitch);c.sort(q),this.wrappedActions=c.map(this.createWrappedAction,this)}return this.wrappedActions};var q=function(a,b){return f.compareLine(a,b)};o.createWrappedAction=function(a){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,pitch:f.copyWithoutAlter(a),checkLine:this.opts.checkLine,isConcertPitch:!1};return{action:new h(this.measureData,b,null),error:null,checked:!1}},o.getVoice=function(){return null===this.voice&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},o.callPerform=function(a){null===a.error&&(a.action.cancelStack=this.cancelStack,a.checked?a.action.perform():l(a.action,r))};var r=function(a){return a instanceof b||a instanceof c||a instanceof d}}.call(this),function(){"use strict";var a=Adagio.Error.client.NotPossibleOnUnpitchedError,b=Adagio.Error.client.PitchCollisionError,c=Adagio.Error.client.PitchOverflowError,d=Adagio.Error.client.LineOutOfRangeError,e=Adagio.Error.noChange.NoChangeError,f=Adagio.edit.action.ShiftGraceChordHalfToneDown,g=Adagio.edit.common.convertTimePosToGetNoteIdx,h=Adagio.edit.common.convertPartUuidToGetPartIdx,i=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,j=Adagio.edit.common.assertPerform,k=Adagio.edit.common.initMeasureData,l=Adagio.edit.action.ShiftGracesHalfToneDown=function(a,b,c){this.init(a,b,c)};l.NAME="action.ShiftGracesHalfToneDown";var m=l.prototype;m.name=l.NAME,m.initMeasureData=k,m.init=function(a,b,c){h(a,b),i(a,b),this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.sanitized=!1,this.voice=null,this.wrappedActions=null,this.location=null},m.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),g(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),this.sanitizeIfNeeded();var a=this.getWrappedActions();if(0===a.length)throw new e;if(!a.some(n))throw a[0].error};var n=function(a){try{a.action.checkPreconditions()}catch(b){if(o(b))return a.checked=!0,a.error=b,!1;throw b}return a.checked=!0,!0};m.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new a},m.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},m.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},m.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),g(this.measureData,this.opts),this.sanitizeIfNeeded(),this.storeAction(),this.getWrappedActions().forEach(this.callPerform,this)},m.sanitizeIfNeeded=function(){this.sanitized||(void 0===this.opts.checkLine&&(this.opts.checkLine=!0),this.sanitized=!0)},m.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:a.dpq,timePos:a.timePos,checkLine:this.opts.checkLine},c={actionName:this.name,opts:b};this.cancelStack.storeAction(c)}},m.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location},m.getWrappedActions=function(){if(null===this.wrappedActions){this.wrappedActions=[];for(var a=this.getVoice(),b=a.getNbGraces(this.opts.noteIdx),c=0;c<b;c++){var d=this.createWrappedAction(c);this.wrappedActions.push(d)}}return this.wrappedActions},m.createWrappedAction=function(a){var b={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:a,checkLine:this.opts.checkLine,isConcertPitch:!1};return{action:new f(this.measureData,b,null),error:null,checked:!1}},m.getVoice=function(){return null===this.voice&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},m.callPerform=function(a){null===a.error&&(a.action.cancelStack=this.cancelStack,a.checked?a.action.perform():j(a.action,o))};var o=function(a){return a instanceof b||a instanceof c||a instanceof d}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.Error.value.BadPitchShiftDirectionError=function(b){var d=c(b),e=a.call(this,d);return this.name=e.name="BadPitchShiftDirectionError",this.stack=e.stack,this.message=e.message,this.direction=b,this};b.prototype=Object.create(a.prototype,{constructor:{value:b}});var c=function(a){return"the pitch shift direction ["+a+"] is invalid."}}.call(this),function(){"use strict";var a=Adagio.Error.value.BadPitchShiftDirectionError,b=Adagio.edit.values.PitchShiftDirection={UP:"up",DOWN:"down"};b.values=[b.UP,b.DOWN],b.check=function(c){if(!b.isValid(c))throw new a(c)},b.isValid=function(a){return b.values.includes(a)}}.call(this),function(){"use strict"
;var a=Adagio.Error.InternalError,b=Adagio.Error.client.BadMeasureIdxError,c=Adagio.Error.client.RevertRangeError,d=Adagio.Error.client.BadTimePosError,e=Adagio.Error.client.NotPossibleOnUnpitchedError,f=Adagio.Error.client.PitchCollisionError,g=Adagio.Error.client.LineOutOfRangeError,h=Adagio.Error.client.PitchOverflowError,i=Adagio.Error.client.BadVoiceError,j=Adagio.Error.noChange.NoChangeError,k=Adagio.edit.action.ShiftChordHalfToneUp,l=Adagio.edit.action.ShiftChordHalfToneDown,m=Adagio.edit.action.ShiftGracesHalfToneUp,n=Adagio.edit.action.ShiftGracesHalfToneDown,o=Adagio.edit.composite.AddChordsTies,p=Adagio.edit.common.convertPartUuidToGetPartIdx,q=Adagio.edit.common.convertMeasuresUuidsToMeasuresIdxs,r=Adagio.edit.common.getMeasuresScroller,s=Adagio.edit.common.timePosIntervalToNoteIdxInterval,t=Adagio.edit.common.assertPerform,u=Adagio.edit.common.extractVoiceRangeTies,v=Adagio.edit.values.PitchShiftDirection,w=Adagio.Utils.math,x=Adagio.Utils.measureUtils,y=Adagio.Utils.noteUtils,z=Adagio.edit.action.ShiftVoiceRangeHalfTone=function(a,b,c){this.init(a,b,c)};z.NAME="action.ShiftVoiceRangeHalfTone";var A=z.prototype;A.name=z.NAME,A.init=function(a,b,c){q(a,b),p(a,b),this.measuresScroller=r(a,b),this.cancelStack=c,this.opts=b,this.location=null,this.wrappedActions=null},A.checkPreconditions=function(){this.checkLocation(),v.check(this.opts.direction),this.sanitize(),this.checkActions()},A.checkLocation=function(){this.checkPitchedPart(),this.checkMeasureIdx(this.opts.startMeasureIdx),this.checkMeasureIdx(this.opts.stopMeasureIdx);var a=this.opts.startMeasureIdx,b=this.opts.stopMeasureIdx,d=b-a;if(d<0)throw new c(c.MEASURE,a,b);this.checkVoiceIdx(),this.hasNoteIndexes()?(this.startMeasureIdx=a,this.stopMeasureIdx=b):(this.checkTimePos(d),this.convertTimePosToNoteIndexes()),this.checkNoteIndexes(d)},A.checkPitchedPart=function(){if(this.measuresScroller.getScoreData().isPartUnpitched(this.opts.partIdx))throw new e},A.checkMeasureIdx=function(a){var c=this.measuresScroller.getNbMeasures();if(!w.isInteger(a)||a<0||a>=c)throw new b(a,b.GET)},A.checkVoiceIdx=function(){if(!this.measuresScroller.getScoreData().hasPartVoiceIdx(this.opts.partIdx,this.opts.voiceIdx))throw new i(this.opts.voiceIdx)},A.checkNoteIndexes=function(a){if(0===a&&this.opts.startNoteIdx>this.opts.stopNoteIdx)throw new c(c.NOTE,this.opts.startNoteIdx,this.opts.stopNoteIdx);var b=this.measuresScroller.getMeasureData(this.startMeasureIdx);b.checkVoiceIdx(this.opts.voiceIdx),b.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.startNoteIdx);var d=this.measuresScroller.getMeasureData(this.stopMeasureIdx);d.checkVoiceIdx(this.opts.voiceIdx),d.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.stopNoteIdx)},A.hasNoteIndexes=function(){return void 0!==this.opts.startNoteIdx||void 0!==this.opts.stopNoteIdx},A.checkTimePos=function(a){var b=this.measuresScroller.getMeasureData(this.opts.startMeasureIdx);this.checkStartTimePos(b,this.opts.startDpq,this.opts.startTimePos);var d=this.measuresScroller.getMeasureData(this.opts.stopMeasureIdx);if(this.checkStopTimePos(d,this.opts.stopDpq,this.opts.stopTimePos),0===a&&this.opts.startTimePos>this.opts.stopTimePos)throw new c(c.NOTE,this.opts.startTimePos,this.opts.stopTimePos)},A.checkStartTimePos=function(a,b,c){var e=a.getDpqValue(),f=a.getMeasure(),g=x.getNbDivisions(f),h=w.lcm(e,b);if(g*=h/e,c*=h/b,!w.isInteger(c)||c<0||c>=g)throw new d(c,h)},A.checkStopTimePos=function(a,b,c){var e=a.getDpqValue(),f=a.getMeasure(),g=x.getNbDivisions(f),h=w.lcm(e,b);if(g*=h/e,c*=h/b,!w.isInteger(c)||c<0||c>g)throw new d(c,h)},A.convertTimePosToNoteIndexes=function(){var a={startMeasureIdx:this.opts.startMeasureIdx,startTimePos:this.opts.startTimePos,startDpq:this.opts.startDpq,stopMeasureIdx:this.opts.stopMeasureIdx,stopTimePos:this.opts.stopTimePos,stopDpq:this.opts.stopDpq};if(null===(a=s(this.measuresScroller,a,this.opts.voiceIdx)))throw new j;this.startMeasureIdx=a.startMeasureIdx,this.opts.startNoteIdx=a.startNoteIdx,this.stopMeasureIdx=a.stopMeasureIdx,this.opts.stopNoteIdx=a.stopNoteIdx},A.sanitize=function(){void 0===this.opts.checkLine&&(this.opts.checkLine=!0)},A.checkActions=function(){var a=this.getWrappedActions();if(0===a.length)throw new j;if(!a.some(B))throw a[0].error};var B=function(a){try{a.action.checkPreconditions()}catch(b){if(D(b))return a.checked=!0,a.error=b,!1;throw b}return a.checked=!0,!0};A.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.opts.preserveTies&&this.recordTies(),this.getWrappedActions().forEach(this.callPerform,this),this.opts.preserveTies&&this.restoreTies()},A.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b=a.measureUuids.slice();this.hasTimePos()||this.convertNoteIndexesToTimePos();var c={actionName:this.name,opts:{partUuid:a.partUuid,measureUuids:b,voiceIdx:this.opts.voiceIdx,startDpq:this.opts.startDpq,startTimePos:this.opts.startTimePos,stopDpq:this.opts.stopDpq,stopTimePos:this.opts.stopTimePos,checkLine:this.opts.checkLine,direction:this.opts.direction,preserveTies:!!this.opts.preserveTies,updateGraces:!!this.opts.updateGraces}};this.cancelStack.storeAction(c)}},A.getLocation=function(){if(null===this.location){var a=this.measuresScroller.getScoreData(),b=a.getMeasureUuids(this.opts.startMeasureIdx,this.opts.stopMeasureIdx),c=a.getPartUuid(this.opts.partIdx);this.location={partUuid:c,measureUuids:b}}return this.location},A.hasTimePos=function(){return void 0!==this.opts.startTimePos||void 0!==this.opts.startDpq||void 0!==this.opts.stopTimePos||void 0!==this.opts.stopDpq},A.convertNoteIndexesToTimePos=function(){var a=this.measuresScroller.getMeasureData(this.opts.startMeasureIdx);this.opts.startDpq=a.getDpqValue();var b=a.getVoice(this.opts.voiceIdx);this.opts.startTimePos=b.getRangeSpace(0,this.opts.startNoteIdx);var c=this.measuresScroller.getMeasureData(this.opts.stopMeasureIdx);this.opts.stopDpq=c.getDpqValue();var d=c.getVoice(this.opts.voiceIdx),e=d.getNote(this.opts.stopNoteIdx),f=y.getDuration(e);this.opts.stopTimePos=d.getRangeSpace(0,this.opts.stopNoteIdx)+f},A.recordTies=function(){var a={voiceIdx:this.opts.voiceIdx,startMeasureIdx:this.opts.startMeasureIdx,startNoteIdx:this.opts.startNoteIdx,stopMeasureIdx:this.opts.stopMeasureIdx,stopNoteIdx:this.opts.stopNoteIdx};this.chordsTies=u(this.measuresScroller,a)},A.getWrappedActions=function(){return null===this.wrappedActions&&this.createWrappedActions(),this.wrappedActions},A.createWrappedActions=function(){this.wrappedActions=[];for(var a=this.opts.startNoteIdx,b=this.startMeasureIdx,c=this.opts.stopNoteIdx,d=this.stopMeasureIdx;C(b,d,a,c);){var e=this.measuresScroller.getMeasureData(b);if(e.hasVoice(this.opts.voiceIdx)){var f=e.getVoice(this.opts.voiceIdx);f.isRest(a)||this.createWrappedAction(e,b,a),a++,a===f.getNbNotes()&&(a=0,b++)}else a=0,b++}};var C=function(a,b,c,d){return a<b||a===b&&c<=d};A.createWrappedAction=function(a,b,c){var d={partIdx:this.opts.partIdx,measureIdx:b,voiceIdx:this.opts.voiceIdx,noteIdx:c,checkLine:this.opts.checkLine},e=null,f=this.getActionConstructor(),g=new f(a,d,e),h={action:g,error:null,checked:!1};this.wrappedActions.push(h),this.opts.updateGraces&&this.createGracesAction(a,b,c)},A.getActionConstructor=function(){if(this.opts.direction===v.UP)return k;if(this.opts.direction===v.DOWN)return l;throw new a("Unexpected")},A.createGracesAction=function(a,b,c){var d={partIdx:this.opts.partIdx,measureIdx:b,voiceIdx:this.opts.voiceIdx,noteIdx:c,checkLine:this.opts.checkLine},e=null,f=this.getGracesActionConstructor(),g=new f(a,d,e),h={action:g,error:null,checked:!1};this.wrappedActions.push(h)},A.getGracesActionConstructor=function(){if(this.opts.direction===v.UP)return m;if(this.opts.direction===v.DOWN)return n;throw new a("Unexpected")},A.callPerform=function(a){null===a.error&&(a.action.cancelStack=this.cancelStack,a.checked?a.action.perform():t(a.action,D))};var D=function(a){return a instanceof f||a instanceof h||a instanceof g||a instanceof j};A.restoreTies=function(){var a={partIdx:this.opts.partIdx,chordsTies:this.chordsTies};new o(this.measuresScroller,a,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadMeasureIdxError,b=Adagio.Error.client.BadStaffIdxError,c=Adagio.Error.client.RevertRangeError,d=Adagio.Error.client.BadTimePosError,e=Adagio.Error.client.PitchCollisionError,f=Adagio.Error.client.PitchOverflowError,g=Adagio.Error.client.LineOutOfRangeError,h=Adagio.Error.client.NotPossibleOnUnpitchedError,i=Adagio.Error.noChange.NoChangeError,j=Adagio.edit.action.ShiftVoiceRangeHalfTone,k=Adagio.edit.common.convertPartUuidToGetPartIdx,l=Adagio.edit.common.convertMeasuresUuidsToMeasuresIdxs,m=Adagio.edit.common.getMeasuresScroller,n=Adagio.edit.common.assertPerform,o=Adagio.edit.values.PitchShiftDirection,p=Adagio.Utils.math,q=Adagio.Utils.measureUtils,r=Adagio.Utils.noteUtils,s=Adagio.Utils.partContentUtils,t=Adagio.edit.action.ShiftStaffRangeHalfTone=function(a,b,c){this.init(a,b,c)};t.NAME="action.ShiftStaffRangeHalfTone";var u=t.prototype;u.name=t.NAME,u.init=function(a,b,c){l(a,b),k(a,b),this.measuresScroller=m(a,b),this.cancelStack=c,this.opts=b,this.location=null,this.wrappedActions=null},u.checkPreconditions=function(){this.checkLocation(),o.check(this.opts.direction),this.sanitize(),this.checkActions()},u.checkLocation=function(){this.checkPitchedPart();var a=this.measuresScroller.getScoreData(),d=a.getPartContent(this.opts.partIdx),e=s.getNbStaves(d),f=this.opts.staffIdx;if(!p.isInteger(f)||f<0||f>=e)throw new b(f);this.checkMeasureIdx(this.opts.startMeasureIdx),this.checkMeasureIdx(this.opts.stopMeasureIdx);var g=this.opts.startMeasureIdx,h=this.opts.stopMeasureIdx,i=h-g;if(i<0)throw new c(c.MEASURE,g,h);this.hasNoteIndexes()&&(this.checkNoteIndexes(i),this.convertNoteIndexes()),this.checkTimePos(i)},u.checkPitchedPart=function(){if(this.measuresScroller.getScoreData().isPartUnpitched(this.opts.partIdx))throw new h},u.checkMeasureIdx=function(b){var c=this.measuresScroller.getNbMeasures();if(!p.isInteger(b)||b<0||b>=c)throw new a(b,a.GET)},u.checkNoteIndexes=function(a){var b=this.measuresScroller.getMeasureData(this.opts.startMeasureIdx);b.checkVoiceIdx(this.opts.startVoiceIdx),b.getVoice(this.opts.startVoiceIdx).checkNoteIdx(this.opts.startNoteIdx);var d=this.measuresScroller.getMeasureData(this.opts.stopMeasureIdx);if(d.checkVoiceIdx(this.opts.stopVoiceIdx),d.getVoice(this.opts.stopVoiceIdx).checkNoteIdx(this.opts.stopNoteIdx),0===a&&this.opts.startNoteIdx>this.opts.stopNoteIdx)throw new c(c.NOTE,this.opts.startNoteIdx,this.opts.stopNoteIdx)},u.checkTimePos=function(a){var b=this.measuresScroller.getMeasureData(this.opts.startMeasureIdx);this.checkStartTimePos(b,this.opts.startDpq,this.opts.startTimePos);var d=this.measuresScroller.getMeasureData(this.opts.stopMeasureIdx);if(this.checkStopTimePos(d,this.opts.stopDpq,this.opts.stopTimePos),0===a&&this.opts.startTimePos>this.opts.stopTimePos)throw new c(c.NOTE,this.opts.startTimePos,this.opts.stopTimePos)},u.checkStartTimePos=function(a,b,c){var e=a.getDpqValue(),f=a.getMeasure(),g=q.getNbDivisions(f),h=p.lcm(e,b);if(g*=h/e,c*=h/b,!p.isInteger(c)||c<0||c>=g)throw new d(c,h)},u.checkStopTimePos=function(a,b,c){var e=a.getDpqValue(),f=a.getMeasure(),g=q.getNbDivisions(f),h=p.lcm(e,b);if(g*=h/e,c*=h/b,!p.isInteger(c)||c<0||c>g)throw new d(c,h)},u.sanitize=function(){void 0===this.opts.checkLine&&(this.opts.checkLine=!0)},u.checkActions=function(){var a=this.getWrappedActions();if(!a.some(v))throw a[0].error};var v=function(a){try{a.action.checkPreconditions()}catch(b){if(w(b))return a.checked=!0,a.error=b,!1;throw b}return a.checked=!0,!0};u.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.getWrappedActions().forEach(this.callPerform,this)},u.hasNoteIndexes=function(){return void 0!==this.opts.startNoteIdx||void 0!==this.opts.startVoiceIdx||void 0!==this.opts.stopNoteIdx||void 0!==this.opts.stopVoiceIdx},u.convertNoteIndexes=function(){var a=this.measuresScroller.getMeasureData(this.opts.startMeasureIdx);this.opts.startDpq=a.getDpqValue();var b=a.getVoice(this.opts.startVoiceIdx);this.opts.startTimePos=b.getRangeSpace(0,this.opts.startNoteIdx);var c=this.measuresScroller.getMeasureData(this.opts.stopMeasureIdx);this.opts.stopDpq=c.getDpqValue();var d=c.getVoice(this.opts.stopVoiceIdx),e=d.getNote(this.opts.stopNoteIdx),f=r.getDuration(e);this.opts.stopTimePos=d.getRangeSpace(0,this.opts.stopNoteIdx)+f,delete this.opts.startVoiceIdx,delete this.opts.startNoteIdx,delete this.opts.stopVoiceIdx,delete this.opts.stopNoteIdx},u.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b=a.measureUuids.slice(),c={actionName:this.name,opts:{partUuid:a.partUuid,measureUuids:b,staffIdx:this.opts.staffIdx,startDpq:this.opts.startDpq,startTimePos:this.opts.startTimePos,stopDpq:this.opts.stopDpq,stopTimePos:this.opts.stopTimePos,checkLine:this.opts.checkLine,preserveTies:!!this.opts.preserveTies,updateGraces:!!this.opts.updateGraces,direction:this.opts.direction}};this.cancelStack.storeAction(c)}},u.getLocation=function(){if(null===this.location){var a=this.measuresScroller.getScoreData(),b=a.getMeasureUuids(this.opts.startMeasureIdx,this.opts.stopMeasureIdx),c=a.getPartUuid(this.opts.partIdx);this.location={partUuid:c,measureUuids:b}}return this.location},u.getWrappedActions=function(){return null===this.wrappedActions&&this.createWrappedActions(),this.wrappedActions},u.createWrappedActions=function(){var a=this.getStaffVoicesIndexes();this.wrappedActions=a.map(this.createWrappedAction,this)},u.getStaffVoicesIndexes=function(){return this.measuresScroller.getScoreData().getPartStaffVoicesIndexes(this.opts.partIdx,this.opts.staffIdx)},u.createWrappedAction=function(a){var b={partIdx:this.opts.partIdx,voiceIdx:a,startMeasureIdx:this.opts.startMeasureIdx,startTimePos:this.opts.startTimePos,startDpq:this.opts.startDpq,stopMeasureIdx:this.opts.stopMeasureIdx,stopTimePos:this.opts.stopTimePos,stopDpq:this.opts.stopDpq,direction:this.opts.direction,checkLine:this.opts.checkLine,preserveTies:this.opts.preserveTies,updateGraces:this.opts.updateGraces};return{action:new j(this.measuresScroller,b,null),error:null,checked:!1}},u.callPerform=function(a){null===a.error&&(a.action.cancelStack=this.cancelStack,a.checked?a.action.perform():n(a.action,w))};var w=function(a){return a instanceof e||a instanceof f||a instanceof g||a instanceof c&&a.type===c.NOTE||a instanceof i}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Error.client.BadMeasureIdxError,c=Adagio.Error.client.RevertRangeError,d=Adagio.Error.client.BadTimePosError,e=Adagio.Error.client.NotPossibleOnUnpitchedError,f=Adagio.Error.client.PitchCollisionError,g=Adagio.Error.client.LineOutOfRangeError,h=Adagio.Error.client.PitchOverflowError,i=Adagio.Error.client.BadVoiceError,j=Adagio.Error.noChange.NoChangeError,k=Adagio.edit.action.ShiftChordDiatonicUp,l=Adagio.edit.action.ShiftChordDiatonicDown,m=Adagio.edit.action.ShiftGracesDiatonicUp,n=Adagio.edit.action.ShiftGracesDiatonicDown,o=Adagio.edit.composite.AddChordsTies,p=Adagio.edit.common.convertPartUuidToGetPartIdx,q=Adagio.edit.common.convertMeasuresUuidsToMeasuresIdxs,r=Adagio.edit.common.getMeasuresScroller,s=Adagio.edit.common.timePosIntervalToNoteIdxInterval,t=Adagio.edit.common.assertPerform,u=Adagio.edit.common.extractVoiceRangeTies,v=Adagio.edit.values.PitchShiftDirection,w=Adagio.Utils.math,x=Adagio.Utils.measureUtils,y=Adagio.Utils.noteUtils,z=Adagio.edit.action.ShiftVoiceRangeDiatonic=function(a,b,c){this.init(a,b,c)};z.NAME="action.ShiftVoiceRangeDiatonic";var A=z.prototype;A.name=z.NAME,A.init=function(a,b,c){q(a,b),p(a,b),this.measuresScroller=r(a,b),this.cancelStack=c,this.opts=b,this.location=null,this.wrappedActions=null},A.checkPreconditions=function(){this.checkLocation(),v.check(this.opts.direction),this.sanitize(),this.checkActions()},A.checkLocation=function(){this.checkPitchedPart(),this.checkMeasureIdx(this.opts.startMeasureIdx),this.checkMeasureIdx(this.opts.stopMeasureIdx);var a=this.opts.startMeasureIdx,b=this.opts.stopMeasureIdx,d=b-a;if(d<0)throw new c(c.MEASURE,a,b);this.checkVoiceIdx(),this.hasNoteIndexes()?(this.startMeasureIdx=a,this.stopMeasureIdx=b):(this.checkTimePos(d),this.convertTimePosToNoteIndexes()),this.checkNoteIndexes(d)},A.checkPitchedPart=function(){if(this.measuresScroller.getScoreData().isPartUnpitched(this.opts.partIdx))throw new e},A.checkMeasureIdx=function(a){var c=this.measuresScroller.getNbMeasures();if(!w.isInteger(a)||a<0||a>=c)throw new b(a,b.GET)},A.checkVoiceIdx=function(){if(!this.measuresScroller.getScoreData().hasPartVoiceIdx(this.opts.partIdx,this.opts.voiceIdx))throw new i(this.opts.voiceIdx)},A.checkNoteIndexes=function(a){if(0===a&&this.opts.startNoteIdx>this.opts.stopNoteIdx)throw new c(c.NOTE,this.opts.startNoteIdx,this.opts.stopNoteIdx);var b=this.measuresScroller.getMeasureData(this.startMeasureIdx);b.checkVoiceIdx(this.opts.voiceIdx),b.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.startNoteIdx);var d=this.measuresScroller.getMeasureData(this.stopMeasureIdx);d.checkVoiceIdx(this.opts.voiceIdx),d.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.stopNoteIdx)},A.hasNoteIndexes=function(){return void 0!==this.opts.startNoteIdx||void 0!==this.opts.stopNoteIdx},A.checkTimePos=function(a){var b=this.measuresScroller.getMeasureData(this.opts.startMeasureIdx);this.checkStartTimePos(b,this.opts.startDpq,this.opts.startTimePos);var d=this.measuresScroller.getMeasureData(this.opts.stopMeasureIdx);if(this.checkStopTimePos(d,this.opts.stopDpq,this.opts.stopTimePos),0===a&&this.opts.startTimePos>this.opts.stopTimePos)throw new c(c.NOTE,this.opts.startTimePos,this.opts.stopTimePos)},A.checkStartTimePos=function(a,b,c){var e=a.getDpqValue(),f=a.getMeasure(),g=x.getNbDivisions(f),h=w.lcm(e,b);if(g*=h/e,c*=h/b,!w.isInteger(c)||c<0||c>=g)throw new d(c,h)},A.checkStopTimePos=function(a,b,c){var e=a.getDpqValue(),f=a.getMeasure(),g=x.getNbDivisions(f),h=w.lcm(e,b);if(g*=h/e,c*=h/b,!w.isInteger(c)||c<0||c>g)throw new d(c,h)},A.convertTimePosToNoteIndexes=function(){var a={startMeasureIdx:this.opts.startMeasureIdx,startTimePos:this.opts.startTimePos,startDpq:this.opts.startDpq,stopMeasureIdx:this.opts.stopMeasureIdx,stopTimePos:this.opts.stopTimePos,stopDpq:this.opts.stopDpq};if(null===(a=s(this.measuresScroller,a,this.opts.voiceIdx)))throw new j;this.startMeasureIdx=a.startMeasureIdx,this.opts.startNoteIdx=a.startNoteIdx,this.stopMeasureIdx=a.stopMeasureIdx,this.opts.stopNoteIdx=a.stopNoteIdx},A.sanitize=function(){void 0===this.opts.checkLine&&(this.opts.checkLine=!0)},A.checkActions=function(){var a=this.getWrappedActions();if(0===a.length)throw new j;if(!a.some(B))throw a[0].error};var B=function(a){try{a.action.checkPreconditions()}catch(b){if(D(b))return a.checked=!0,a.error=b,!1;throw b}return a.checked=!0,!0};A.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.opts.preserveTies&&this.recordTies(),this.getWrappedActions().forEach(this.callPerform,this),this.opts.preserveTies&&this.restoreTies()},A.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b=a.measureUuids.slice();this.hasTimePos()||this.convertNoteIndexesToTimePos();var c={actionName:this.name,opts:{partUuid:a.partUuid,measureUuids:b,voiceIdx:this.opts.voiceIdx,startDpq:this.opts.startDpq,startTimePos:this.opts.startTimePos,stopDpq:this.opts.stopDpq,stopTimePos:this.opts.stopTimePos,checkLine:this.opts.checkLine,preserveTies:!!this.opts.preserveTies,updateGraces:!!this.opts.updateGraces,direction:this.opts.direction}};this.cancelStack.storeAction(c)}},A.getLocation=function(){if(null===this.location){var a=this.measuresScroller.getScoreData(),b=a.getMeasureUuids(this.opts.startMeasureIdx,this.opts.stopMeasureIdx),c=a.getPartUuid(this.opts.partIdx);this.location={partUuid:c,measureUuids:b}}return this.location},A.hasTimePos=function(){return void 0!==this.opts.startTimePos||void 0!==this.opts.startDpq||void 0!==this.opts.stopTimePos||void 0!==this.opts.stopDpq},A.convertNoteIndexesToTimePos=function(){var a=this.measuresScroller.getMeasureData(this.opts.startMeasureIdx);this.opts.startDpq=a.getDpqValue();var b=a.getVoice(this.opts.voiceIdx);this.opts.startTimePos=b.getRangeSpace(0,this.opts.startNoteIdx);var c=this.measuresScroller.getMeasureData(this.opts.stopMeasureIdx);this.opts.stopDpq=c.getDpqValue();var d=c.getVoice(this.opts.voiceIdx),e=d.getNote(this.opts.stopNoteIdx),f=y.getDuration(e);this.opts.stopTimePos=d.getRangeSpace(0,this.opts.stopNoteIdx)+f},A.recordTies=function(){var a={voiceIdx:this.opts.voiceIdx,startMeasureIdx:this.opts.startMeasureIdx,startNoteIdx:this.opts.startNoteIdx,stopMeasureIdx:this.opts.stopMeasureIdx,stopNoteIdx:this.opts.stopNoteIdx};this.chordsTies=u(this.measuresScroller,a)},A.getWrappedActions=function(){return null===this.wrappedActions&&this.createWrappedActions(),this.wrappedActions},A.createWrappedActions=function(){this.wrappedActions=[];for(var a=this.opts.startNoteIdx,b=this.startMeasureIdx,c=this.opts.stopNoteIdx,d=this.stopMeasureIdx;C(b,d,a,c);){var e=this.measuresScroller.getMeasureData(b);if(e.hasVoice(this.opts.voiceIdx)){var f=e.getVoice(this.opts.voiceIdx);f.isRest(a)||this.createWrappedAction(e,b,a),a++,a===f.getNbNotes()&&(a=0,b++)}else a=0,b++}};var C=function(a,b,c,d){return a<b||a===b&&c<=d};A.createWrappedAction=function(a,b,c){var d={partIdx:this.opts.partIdx,measureIdx:b,voiceIdx:this.opts.voiceIdx,noteIdx:c,checkLine:this.opts.checkLine},e=null,f=this.getActionConstructor(),g=new f(a,d,e),h={action:g,error:null,checked:!1};this.wrappedActions.push(h),this.opts.updateGraces&&this.createGracesAction(a,b,c)},A.getActionConstructor=function(){if(this.opts.direction===v.UP)return k;if(this.opts.direction===v.DOWN)return l;throw new a("Unexpected")},A.createGracesAction=function(a,b,c){var d={partIdx:this.opts.partIdx,measureIdx:b,voiceIdx:this.opts.voiceIdx,noteIdx:c,checkLine:this.opts.checkLine},e=null,f=this.getGracesActionConstructor(),g=new f(a,d,e),h={action:g,error:null,checked:!1};this.wrappedActions.push(h)},A.getGracesActionConstructor=function(){if(this.opts.direction===v.UP)return m;if(this.opts.direction===v.DOWN)return n;throw new a("Unexpected")},A.callPerform=function(a){null===a.error&&(a.action.cancelStack=this.cancelStack,a.checked?a.action.perform():t(a.action,D))};var D=function(a){return a instanceof f||a instanceof h||a instanceof g||a instanceof j};A.restoreTies=function(){var a={partIdx:this.opts.partIdx,chordsTies:this.chordsTies};new o(this.measuresScroller,a,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadMeasureIdxError,b=Adagio.Error.client.BadStaffIdxError,c=Adagio.Error.client.RevertRangeError,d=Adagio.Error.client.BadTimePosError,e=Adagio.Error.client.PitchCollisionError,f=Adagio.Error.client.PitchOverflowError,g=Adagio.Error.client.LineOutOfRangeError,h=Adagio.Error.client.NotPossibleOnUnpitchedError,i=Adagio.Error.noChange.NoChangeError,j=Adagio.edit.action.ShiftVoiceRangeDiatonic,k=Adagio.edit.common.convertPartUuidToGetPartIdx,l=Adagio.edit.common.convertMeasuresUuidsToMeasuresIdxs,m=Adagio.edit.common.getMeasuresScroller,n=Adagio.edit.common.assertPerform,o=Adagio.edit.values.PitchShiftDirection,p=Adagio.Utils.math,q=Adagio.Utils.measureUtils,r=Adagio.Utils.noteUtils,s=Adagio.Utils.partContentUtils,t=Adagio.edit.action.ShiftStaffRangeDiatonic=function(a,b,c){this.init(a,b,c)};t.NAME="action.ShiftStaffRangeDiatonic";var u=t.prototype;u.name=t.NAME,u.init=function(a,b,c){l(a,b),k(a,b),this.measuresScroller=m(a,b),this.cancelStack=c,this.opts=b,this.location=null,this.wrappedActions=null},u.checkPreconditions=function(){this.checkLocation(),o.check(this.opts.direction),this.sanitize(),this.checkActions()},u.checkLocation=function(){this.checkPitchedPart();var a=this.measuresScroller.getScoreData(),d=a.getPartContent(this.opts.partIdx),e=s.getNbStaves(d),f=this.opts.staffIdx;if(!p.isInteger(f)||f<0||f>=e)throw new b(f);this.checkMeasureIdx(this.opts.startMeasureIdx),this.checkMeasureIdx(this.opts.stopMeasureIdx);var g=this.opts.startMeasureIdx,h=this.opts.stopMeasureIdx,i=h-g;if(i<0)throw new c(c.MEASURE,g,h);this.hasNoteIndexes()&&(this.checkNoteIndexes(i),this.convertNoteIndexes()),this.checkTimePos(i)},u.checkPitchedPart=function(){if(this.measuresScroller.getScoreData().isPartUnpitched(this.opts.partIdx))throw new h},u.checkMeasureIdx=function(b){var c=this.measuresScroller.getNbMeasures();if(!p.isInteger(b)||b<0||b>=c)throw new a(b,a.GET)},u.checkNoteIndexes=function(a){var b=this.measuresScroller.getMeasureData(this.opts.startMeasureIdx);b.checkVoiceIdx(this.opts.startVoiceIdx),b.getVoice(this.opts.startVoiceIdx).checkNoteIdx(this.opts.startNoteIdx);var d=this.measuresScroller.getMeasureData(this.opts.stopMeasureIdx);if(d.checkVoiceIdx(this.opts.stopVoiceIdx),d.getVoice(this.opts.stopVoiceIdx).checkNoteIdx(this.opts.stopNoteIdx),0===a&&this.opts.startNoteIdx>this.opts.stopNoteIdx)throw new c(c.NOTE,this.opts.startNoteIdx,this.opts.stopNoteIdx)},u.checkTimePos=function(a){var b=this.measuresScroller.getMeasureData(this.opts.startMeasureIdx);this.checkStartTimePos(b,this.opts.startDpq,this.opts.startTimePos);var d=this.measuresScroller.getMeasureData(this.opts.stopMeasureIdx);if(this.checkStopTimePos(d,this.opts.stopDpq,this.opts.stopTimePos),0===a&&this.opts.startTimePos>this.opts.stopTimePos)throw new c(c.NOTE,this.opts.startTimePos,this.opts.stopTimePos)},u.checkStartTimePos=function(a,b,c){var e=a.getDpqValue(),f=a.getMeasure(),g=q.getNbDivisions(f),h=p.lcm(e,b);if(g*=h/e,c*=h/b,!p.isInteger(c)||c<0||c>=g)throw new d(c,h)},u.checkStopTimePos=function(a,b,c){var e=a.getDpqValue(),f=a.getMeasure(),g=q.getNbDivisions(f),h=p.lcm(e,b);if(g*=h/e,c*=h/b,!p.isInteger(c)||c<0||c>g)throw new d(c,h)},u.sanitize=function(){void 0===this.opts.checkLine&&(this.opts.checkLine=!0)},u.checkActions=function(){var a=this.getWrappedActions();if(!a.some(v))throw a[0].error};var v=function(a){try{a.action.checkPreconditions()}catch(b){if(w(b))return a.checked=!0,a.error=b,!1;throw b}return a.checked=!0,!0};u.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.getWrappedActions().forEach(this.callPerform,this)},u.hasNoteIndexes=function(){return void 0!==this.opts.startNoteIdx||void 0!==this.opts.startVoiceIdx||void 0!==this.opts.stopNoteIdx||void 0!==this.opts.stopVoiceIdx},u.convertNoteIndexes=function(){var a=this.measuresScroller.getMeasureData(this.opts.startMeasureIdx);this.opts.startDpq=a.getDpqValue();var b=a.getVoice(this.opts.startVoiceIdx);this.opts.startTimePos=b.getRangeSpace(0,this.opts.startNoteIdx);var c=this.measuresScroller.getMeasureData(this.opts.stopMeasureIdx);this.opts.stopDpq=c.getDpqValue();var d=c.getVoice(this.opts.stopVoiceIdx),e=d.getNote(this.opts.stopNoteIdx),f=r.getDuration(e);this.opts.stopTimePos=d.getRangeSpace(0,this.opts.stopNoteIdx)+f,delete this.opts.startVoiceIdx,delete this.opts.startNoteIdx,delete this.opts.stopVoiceIdx,delete this.opts.stopNoteIdx},u.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b=a.measureUuids.slice(),c={actionName:this.name,opts:{partUuid:a.partUuid,measureUuids:b,staffIdx:this.opts.staffIdx,startDpq:this.opts.startDpq,startTimePos:this.opts.startTimePos,stopDpq:this.opts.stopDpq,stopTimePos:this.opts.stopTimePos,checkLine:this.opts.checkLine,preserveTies:!!this.opts.preserveTies,updateGraces:!!this.opts.updateGraces,direction:this.opts.direction}};this.cancelStack.storeAction(c)}},u.getLocation=function(){if(null===this.location){var a=this.measuresScroller.getScoreData(),b=a.getMeasureUuids(this.opts.startMeasureIdx,this.opts.stopMeasureIdx),c=a.getPartUuid(this.opts.partIdx);this.location={partUuid:c,measureUuids:b}}return this.location},u.getWrappedActions=function(){return null===this.wrappedActions&&this.createWrappedActions(),this.wrappedActions},u.createWrappedActions=function(){var a=this.getStaffVoicesIndexes();this.wrappedActions=a.map(this.createWrappedAction,this)},u.getStaffVoicesIndexes=function(){return this.measuresScroller.getScoreData().getPartStaffVoicesIndexes(this.opts.partIdx,this.opts.staffIdx)},u.createWrappedAction=function(a){var b={partIdx:this.opts.partIdx,voiceIdx:a,startMeasureIdx:this.opts.startMeasureIdx,startTimePos:this.opts.startTimePos,startDpq:this.opts.startDpq,stopMeasureIdx:this.opts.stopMeasureIdx,stopTimePos:this.opts.stopTimePos,stopDpq:this.opts.stopDpq,direction:this.opts.direction,checkLine:this.opts.checkLine,preserveTies:this.opts.preserveTies,updateGraces:this.opts.updateGraces};return{action:new j(this.measuresScroller,b,null),error:null,checked:!1}},u.callPerform=function(a){null===a.error&&(a.action.cancelStack=this.cancelStack,a.checked?a.action.perform():n(a.action,w))};var w=function(a){return a instanceof e||a instanceof f||a instanceof g||a instanceof c&&a.type===c.NOTE||a instanceof i}}.call(this),function(){"use strict";var a=Adagio.edit.common.initMeasureData,b=Adagio.edit.common.convertPartUuidToGetPartIdx,c=Adagio.edit.common.convertMeasureUuidToGetMeasureIdx,d=Adagio.edit.common.convertTimePosToGetNoteIdx,e=Adagio.edit.common.convertLineToPitch,f=Adagio.edit.common.transposePitchLineOpts,g=Adagio.edit.common.getNoteAtPitch,h=Adagio.Error.client.NotPossibleOnUnpitchedError,i=Adagio.Error.client.PitchCollisionError,j=Adagio.Error.client.BadStaffIdxError,k=Adagio.Error.noChange.NoChangeError,l=Adagio.Utils.clone,m=Adagio.Utils.pitchUtils,n=Adagio.Utils.pitchShift,o=Adagio.Utils.noteUtils,p=Adagio.edit.action.ChangePitch,q=Adagio.edit.action.SwitchEnharmonic=function(a,b,c){this.init(a,b,c)};q.NAME="action.SwitchEnharmonic";var r=q.prototype;r.name=q.NAME,r.initMeasureData=a,r.init=function(a,e,f){b(a,e),c(a,e),this.initMeasureData(a,e),this.opts=e,this.cancelStack=f,this.location=null,this.noteHead=null,this.swicthedPitch=null,this.sanitized=!1,d(this.measureData,this.opts)},r.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkStaffIdx(),this.checkNoteIdx(),this.checkNotRest(),this.sanitizeIfNeeded(),this.checkNoteAtPitch(),this.checkSwitchedPitch()},r.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new h},r.checkStaffIdx=function(){var a=this.measureData.getNbStaves();if(this.opts.staffIdx<0||this.opts.staffIdx>=a)throw new j(this.opts.staffIdx)},r.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},r.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},r.sanitizeIfNeeded=function(){this.sanitized||(void 0!==this.opts.line&&e(this.measureData,this.opts,!0),this.opts.isConcertPitch&&f(this.measureData,this.opts),this.sanitized=!0)},r.checkNoteAtPitch=function(){if(void 0===this.getNoteAtPitch()){var a=m.copy(this.opts.pitch);throw new i(i.action.GET,a)}},r.checkSwitchedPitch=function(){var a=this.getSwitchedPitch();if(m.isSamePitch(this.opts.pitch,a))throw new k},r.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();var a=this.getNoteAtPitch(),b=o.getPitch(a),c=this.getSwitchedPitch(),d=m.getAlter(c),e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,fromPitch:m.copy(b),toPitch:m.copy(c),accidental:m.alterToAccidental(d)};if(o.hasFretData(a)){var f=o.getFretData(a);e.fretData=l(f)}var g=new p(this.measureData,e,this.cancelStack);g.checkPreconditions(),g.perform()},r.getSwitchedPitch=function(){if(null===this.swicthedPitch){var a=this.getKey(),b=this.getNoteAtPitch(),c=o.getPitch(b);this.swicthedPitch=n.switchEnharmonic(c,a)}return this.swicthedPitch},r.getKey=function(){return this.measureData.getKey(this.opts.staffIdx)},r.getNoteAtPitch=function(){if(null===this.noteHead){
var a=this.getVoice();this.noteHead=g(a,this.opts.noteIdx,this.opts.pitch)}return this.noteHead},r.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},r.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,timePos:a.timePos,divisions:a.dpq,pitch:m.copy(this.opts.pitch)}};this.cancelStack.storeAction(b)}},r.getLocation=function(){if(null===this.location){var a=this.measureData.getScoreData(),b=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),d=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx),f=e.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:b,measureUuid:c,dpq:d,timePos:f}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.client.PitchOverflowError,b=Adagio.Utils.typeUtils,c=Adagio.Utils.pitchUtils,d=Adagio.Utils.noteUtils;Adagio.edit.common.checkVoicePitchOverflow=function(a,b,c){for(var d=a.getNbNotes(),g=0;g<d;g++){var h=e(a,g);f(h,b,c)}};var e=function(a,c){if(a.isRest(c))return[];var d=a.getChord(c);return b.makeArray(d)},f=function(b,e,f){var g=b.map(d.getPitch),h=g.find(function(a){return c.willOverflow(a,e,f)});if(void 0!==h)throw new a(h,e)}}.call(this),function(){"use strict";var a=Adagio.Error.client.LineOutOfRangeError,b=Adagio.Utils.typeUtils,c=Adagio.Utils.pitchUtils,d=Adagio.Utils.noteUtils;Adagio.edit.common.checkVoiceLineOverflow=function(a,b,c,d){for(var g=a.getNbNotes(),h=0;h<g;h++){var i=e(a,h);f(i,b,c,d)}};var e=function(a,c){if(a.isRest(c))return[];var d=a.getChord(c);return b.makeArray(d)},f=function(b,e,f,g){b.forEach(function(b){var h=d.getStaffIdx(b),i=f.getEntry(h),j=d.getPitch(b),k=c.transpose(j,e,g),l=c.pitchToLine(k,i);if(l<c.MIN_LINE||l>c.MAX_LINE)throw new a(l)})}}.call(this),function(){"use strict";var a=Adagio.Utils.pitchUtils,b=Adagio.Utils.transposeUtils,c=Adagio.Utils.typeUtils,d=Adagio.Utils.noteUtils,e=Adagio.edit.common.TransposedPitches=function(a,b,c){this.init(a,b,c)};e.create=function(a,h){var i=b.copy(h.transpose),j=a.getVoice(h.voiceIdx),k=j.getChord(h.noteIdx);k=c.makeArray(k);var l=k.map(d.getPitch);return b.isUpward(i)?l.sort(f):l.sort(g),new e(l,i,h.allowDoubleAccidentals)};var f=function(a,b){return-g(a,b)},g=function(b,c){return a.naiveComparePitch(b,c)},h=e.prototype;h.init=function(a,b,c){this.pitches=a,this.transposedPitches=null,this.transpose=b,this.allowDoubleAccidentals=c},h.getNbHeads=function(){return this.pitches.length},h.getTransposedPitch=function(a){return this.getTransposedPitches()[a]},h.getTransposedPitches=function(){return null===this.transposedPitches&&(this.transposedPitches=this.pitches.map(this.transposePitch,this)),this.transposedPitches},h.transposePitch=function(b){return a.transpose(b,this.transpose,this.allowDoubleAccidentals)},h.getPitch=function(a){return this.pitches[a]},h.hasPreviousOnSameLine=function(a){return!!this.hasPrevious(a)&&this.isPreviousOnSameLine(a)},h.hasPrevious=function(a){return a>0},h.isPreviousOnSameLine=function(b){var c=this.getTransposedPitch(b),d=this.getTransposedPitch(b-1);return a.isSameLine(c,d)}}.call(this),function(){"use strict";var a=Adagio.Utils.clone,b=Adagio.Utils.pitchUtils,c=Adagio.edit.composite.RemoveFromChord,d=Adagio.edit.common.TransposedPitches,e=Adagio.edit.common.initMeasureData,f=Adagio.edit.composite.RemoveTransposedCollidingHeadsFromChord=function(a,b,c){this.init(a,b,c)};f.NAME="composite.RemoveTransposedCollidingHeadsFromChord";var g=f.prototype;g.name=f.NAME,g.initMeasureData=e,g.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.wrappedPitches=null},g.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);for(var a=this.getNbHeads(),b=0;b<a;b++)this.updateChordHead(b)},g.getNbHeads=function(){return this.getWrappedPitches().getNbHeads()},g.updateChordHead=function(a){this.hasPreviousOnSameLine(a)&&this.removeHead(a)},g.hasPreviousOnSameLine=function(a){return this.getWrappedPitches().hasPreviousOnSameLine(a)},g.removeHead=function(d){var e=this.getPitch(d),f=a(this.opts);f.pitch=b.copy(e),new c(this.measureData,f,this.cancelStack).perform()},g.getPitch=function(a){return this.getWrappedPitches().getPitch(a)},g.getWrappedPitches=function(){return null===this.wrappedPitches&&(this.wrappedPitches=d.create(this.measureData,this.opts)),this.wrappedPitches}}.call(this),function(){"use strict";var a=Adagio.Utils.clone,b=Adagio.edit.composite.RemoveTransposedCollidingHeadsFromChord,c=Adagio.edit.common.initMeasureData,d=Adagio.edit.composite.RemoveTransposedCollidingHeadsFromStaffMeasure=function(a,b,c){this.init(a,b,c)};d.NAME="composite.RemoveTransposedCollidingHeadsFromStaffMeasure";var e=d.prototype;e.name=d.NAME,e.initMeasureData=c,e.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.wrappedPitches=null},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);for(var a=this.measureData.getVoice(this.opts.voiceIdx),b=a.size(),c=0;c<b;c++)a.isRest(c)||this.removeCollidingHeadsFromChord(c)},e.removeCollidingHeadsFromChord=function(c){var d=a(this.opts);d.noteIdx=c,new b(this.measureData,d,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Utils.typeUtils,b=Adagio.Utils.pitchUtils,c=Adagio.Utils.noteUtils,d=Adagio.edit.common.initMeasureData,e=Adagio.edit.common.getVoice,f=Adagio.edit.primitive.ChangePitch=function(a,b,c){this.init(a,b,c)};f.NAME="primitive.ChangePitch";var g=f.prototype;g.name=f.NAME,g.initMeasureData=d,g.getVoice=e,g.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c},g.perform=function(){var d=this.getVoice(),e=d.getChord(this.opts.noteIdx);e=a.makeArray(e);var f=e.find(this.pitchPredicate,this),g=b.copy(c.getPitch(f)),h=b.copy(this.opts.toPitch);c.setPitch(f,h),this.updateStack(g)},g.pitchPredicate=function(a){var d=c.getPitch(a);return b.isSameLine(d,this.opts.fromPitch)},g.updateStack=function(a){var c={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,previousPitch:b.copy(a),newPitch:b.copy(this.opts.toPitch)}};this.cancelStack.push(c)}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.Utils.clone,c=Adagio.Utils.pitchUtils,d=Adagio.edit.primitive.ChangePitch,e=Adagio.edit.common.TransposedPitches,f=Adagio.edit.common.initMeasureData,g=Adagio.edit.composite.TransposeChord=function(a,b,c){this.init(a,b,c)};g.NAME="composite.TransposeChord";var h=g.prototype;h.initMeasureData=f,h.name=g.NAME,h.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b,this.wrappedPitches=null},h.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);for(var a=this.getNbHeads(),b=0;b<a;b++)this.updateChordHead(b)},h.getNbHeads=function(){return this.getWrappedPitches().getNbHeads()},h.hasPreviousOnSameLine=function(a){return this.getWrappedPitches().hasPreviousOnSameLine(a)},h.updateChordHead=function(a){this.hasPreviousOnSameLine(a)?this.raiseWTF(a):this.changeHead(a)},h.getPitch=function(a){return this.getWrappedPitches().getPitch(a)},h.getWrappedPitches=function(){return null===this.wrappedPitches&&(this.wrappedPitches=e.create(this.measureData,this.opts)),this.wrappedPitches},h.raiseWTF=function(b){var d=this.opts.partIdx,e=this.opts.measureIdx,f=this.opts.voiceIdx,g=this.opts.noteIdx,h=this.getPitch(b),i=c.stringify(h),j="The note that would collide once transposed should be removed. part["+d+"] measure["+e+"] voice["+f+"] note["+g+"] pitch["+i+"].",k=new a("HeadNotRemoved",j);throw k.partIdx=d,k.measureIdx=e,k.voiceIdx=f,k.noteIdx=g,k.pitch=c.copy(h),k},h.changeHead=function(a){var e=this.getPitch(a),f=this.getTransposedPitch(a),g=b(this.opts);g.fromPitch=c.copy(e),g.toPitch=c.copy(f),new d(this.measureData,g,this.cancelStack).perform()},h.getTransposedPitch=function(a){return this.getWrappedPitches().getTransposedPitch(a)}}.call(this),function(){"use strict";var a=Adagio.Utils.clone,b=Adagio.edit.composite.TransposeChord,c=Adagio.edit.common.initMeasureData,d=Adagio.edit.composite.TransposeStaffMeasure=function(a,b,c){this.init(a,b,c)};d.NAME="composite.TransposeStaffMeasure";var e=d.prototype;e.initMeasureData=c,e.name=d.NAME,e.init=function(a,b,c){this.initMeasureData(a,b),this.cancelStack=c,this.opts=b},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);for(var a=this.measureData.getVoice(this.opts.voiceIdx),b=a.size(),c=0;c<b;c++)a.isRest(c)||this.transposeChord(c)},e.transposeChord=function(c){var d=a(this.opts);d.noteIdx=c,new b(this.measureData,d,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Utils.transposeUtils,b=Adagio.edit.composite.RemoveStaffMeasureRightTies,c=Adagio.edit.composite.RemoveTransposedCollidingHeadsFromStaffMeasure,d=Adagio.edit.composite.TransposeStaffMeasure,e=Adagio.edit.common.initMeasureData,f=Adagio.edit.composite.TransposeForPitchShift=function(a,b,c){this.init(a,b,c)};f.NAME="composite.TransposeForPitchShift";var g=f.prototype;g.name=f.NAME,g.init=function(a,b,c){this.scoreData=a,this.cancelStack=c,this.opts=b,this.measures=null},g.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.untieEdgeMeasures(),this.processMeasures()},g.untieEdgeMeasures=function(){this.hasPreviousMeasure()&&this.untieFromPreviousMeasure(),this.hasNextMeasure()&&this.untieFromNextMeasure()},g.hasPreviousMeasure=function(){return this.opts.firstMeasureIdx>0},g.untieFromPreviousMeasure=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.firstMeasureIdx-1,voiceIdx:this.opts.voiceIdx};new b(this.scoreData,a,this.cancelStack).perform()},g.hasNextMeasure=function(){var a=this.getNbMeasures();return this.lastMeasureIdx<a-1},g.getNbMeasures=function(){return this.getMeasures().length},g.getMeasures=function(){return this.scoreData.getPartContent(this.opts.partIdx).measure},g.untieFromNextMeasure=function(){var a={partIdx:this.opts.partIdx,measureIdx:this.opts.lastMeasureIdx,voiceIdx:this.opts.voiceIdx};new b(this.scoreData,a,this.cancelStack).perform()},g.processMeasures=function(){for(var a=this.opts.firstMeasureIdx,b=this.opts.lastMeasureIdx,c=a;c<=b;c++)this.processMeasure(c)},g.processMeasure=function(a){var b={},c={partIdx:this.opts.partIdx,measureIdx:a};e.call(b,this.scoreData,c);var d=b.measureData;d.hasVoice(this.opts.voiceIdx)&&(this.removeCollidingFromStaffMeasure(d,a),this.transposeMeasure(d,a))},g.removeCollidingFromStaffMeasure=function(b,d){var e={partIdx:this.opts.partIdx,voiceIdx:this.opts.voiceIdx,measureIdx:d,transpose:a.copy(this.opts.transpose),allowDoubleAccidentals:this.opts.allowDoubleAccidentals};new c(b,e,this.cancelStack).perform()},g.transposeMeasure=function(b,c){var e={partIdx:this.opts.partIdx,voiceIdx:this.opts.voiceIdx,measureIdx:c,transpose:a.copy(this.opts.transpose),allowDoubleAccidentals:this.opts.allowDoubleAccidentals};new d(b,e,this.cancelStack).perform()}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadMeasureIdxError,b=Adagio.Error.client.RevertRangeError,c=Adagio.Error.client.BadVoiceError,d=Adagio.Error.client.NotPossibleOnUnpitchedError,e=Adagio.Error.client.NotPossibleOnTabError,f=Adagio.Utils.transposeUtils,g=Adagio.edit.common.MeasureData,h=Adagio.edit.common.checkVoicePitchOverflow,i=Adagio.edit.common.checkVoiceLineOverflow,j=Adagio.edit.common.convertPartUuidToGetPartIdx,k=Adagio.edit.common.convertMeasuresUuidsToMeasuresIdxs,l=Adagio.edit.common.convertMeasuresFirstLast,m=Adagio.edit.common.initMeasureData,n=Adagio.edit.composite.TransposeForPitchShift,o=Adagio.edit.primitive.UpdateAccidentals,p=Adagio.edit.action.TransposeVoice=function(a,b,c){this.init(a,b,c)};p.NAME="action.TransposeVoice";var q=p.prototype;q.name=p.NAME,q.init=function(a,b,c){j(a,b),k(a,b),l(a,b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.location=null,this.sanitized=!1},q.checkPreconditions=function(){this.checkLocation(),this.sanitizedIfNeeded(),this.checkPitchedPart(),this.checkNotTab(),f.check(this.opts.transpose),this.checkPitchOverflow()},q.checkLocation=function(){var d=this.getMeasures(),e=d.length,f=this.opts.startMeasureIdx,g=f;if(g<0||g>=e)throw new a(g,a.GET);var h=this.opts.stopMeasureIdx;if(h<f)throw new b(b.MEASURE,f,h);if((g=this.opts.stopMeasureIdx)<0||g>=e)throw new a(g,a.GET);if(!this.scoreData.hasPartVoiceIdx(this.opts.partIdx,this.opts.voiceIdx))throw new c(this.opts.voiceIdx,c.GET)},q.sanitizedIfNeeded=function(){this.sanitized||(void 0===this.opts.checkNotTab&&(this.opts.checkNotTab=!0),void 0===this.opts.allowDoubleAccidentals&&(this.opts.allowDoubleAccidentals=!1),this.sanitized=!0)},q.checkPitchedPart=function(){if(this.scoreData.isPartUnpitched(this.opts.partIdx))throw new d},q.checkNotTab=function(){if(this.opts.checkNotTab&&this.scoreData.isPartTab(this.opts.partIdx))throw new e},q.checkPitchOverflow=function(){this.getMeasuresRange().forEach(function(a){var b=new g(a);if(b.hasVoice(this.opts.voiceIdx)){var c=b.getVoice(this.opts.voiceIdx);h(c,this.opts.transpose,this.opts.allowDoubleAccidentals);var d=b.getClefs();i(c,this.opts.transpose,d,this.opts.allowDoubleAccidentals)}},this)},q.getMeasuresRange=function(){var a=this.opts.startMeasureIdx,b=this.opts.stopMeasureIdx+1;return this.getMeasures().slice(a,b)},q.getMeasures=function(){return this.scoreData.getPartContent(this.opts.partIdx).measure},q.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.isIdentity()||(this.transpose(),this.isUnison()||this.updateMeasuresRangeAccidentals(),this.updateStack())},q.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b=a.measureUuids.slice(),c=f.copy(this.opts.transpose),d={actionName:this.name,opts:{partUuid:a.partUuid,measureUuids:b,voiceIdx:this.opts.voiceIdx,transpose:c,allowDoubleAccidentals:this.opts.allowDoubleAccidentals}};this.cancelStack.storeAction(d)}},q.isIdentity=function(){return f.isIdentity(this.opts.transpose)},q.transpose=function(){var a={partIdx:this.opts.partIdx,voiceIdx:this.opts.voiceIdx,firstMeasureIdx:this.opts.startMeasureIdx,lastMeasureIdx:this.opts.stopMeasureIdx,transpose:f.copy(this.opts.transpose),allowDoubleAccidentals:this.opts.allowDoubleAccidentals};new n(this.scoreData,a,this.cancelStack).perform()},q.isUnison=function(){return f.isUnison(this.opts.transpose)},q.updateMeasuresRangeAccidentals=function(){for(var a=this.opts.startMeasureIdx,b=this.opts.stopMeasureIdx,c=a;c<=b;c++)this.updateMeasureAccidentals(c)},q.updateMeasureAccidentals=function(a){var b={partIdx:this.opts.partIdx,voiceIdx:this.opts.voiceIdx,measureIdx:a},c={};m.call(c,this.scoreData,b);var d=c.measureData;if(d.hasVoice(b.voiceIdx)){new o(d,b,this.cancelStack).perform()}},q.updateStack=function(){var a=this.getLocation(),b=a.measureUuids.slice(),c=f.copy(this.opts.transpose),d={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuids:b,voiceIdx:this.opts.voiceIdx,transpose:c,allowDoubleAccidentals:this.opts.allowDoubleAccidentals}};this.cancelStack.push(d)},q.getLocation=function(){if(null===this.location){var a=this.scoreData.getMeasureUuids(this.opts.startMeasureIdx,this.opts.stopMeasureIdx),b=this.scoreData.getPartUuid(this.opts.partIdx);this.location={partUuid:b,measureUuids:a}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Error.client.BadMeasureIdxError,b=Adagio.Error.client.RevertRangeError,c=Adagio.Error.client.BadStaffIdxError,d=Adagio.Error.client.NotPossibleOnUnpitchedError,e=Adagio.Error.client.NotPossibleOnTabError,f=Adagio.Utils.partContentUtils,g=Adagio.Utils.transposeUtils,h=Adagio.edit.common.convertPartUuidToGetPartIdx,i=Adagio.edit.common.convertMeasuresUuidsToMeasuresIdxs,j=Adagio.edit.common.convertMeasuresFirstLast,k=Adagio.edit.composite.TransposeKeysRange,l=Adagio.edit.action.TransposeVoice,m=Adagio.edit.action.TransposeStaff=function(a,b,c){this.init(a,b,c)};m.NAME="action.TransposeStaff";var n=m.prototype;n.name=m.NAME,n.init=function(a,b,c){h(a,b),i(a,b),j(a,b),this.scoreData=a,this.cancelStack=c,this.opts=b,this.location=null,this.firstKey=null,this.subActions=null,this.sanitized=!1},n.checkPreconditions=function(){this.checkLocation(),this.sanitizedIfNeeded(),this.checkPitchedPart(),this.checkNotTab(),g.check(this.opts.transpose),this.checkSubActions()},n.checkLocation=function(){this.scoreData.getPartContent(this.opts.partIdx);var d=this.scoreData.getNbMeasures(),e=this.opts.startMeasureIdx,g=e;if(g<0||g>=d)throw new a(g,a.GET);var h=this.opts.stopMeasureIdx;if(h<e)throw new b(b.MEASURE,e,h);if((g=this.opts.stopMeasureIdx)<0||g>=d)throw new a(g,a.GET);var i=this.scoreData.getPartContent(this.opts.partIdx),j=f.getNbStaves(i),k=this.opts.staffIdx;if(k<0||k>=j)throw new c(k,c.actionGET)},n.sanitizedIfNeeded=function(){this.sanitized||(void 0===this.opts.checkNotTab&&(this.opts.checkNotTab=!0),void 0===this.opts.allowDoubleAccidentals&&(this.opts.allowDoubleAccidentals=!1),this.sanitized=!0)},n.checkPitchedPart=function(){if(this.scoreData.isPartUnpitched(this.opts.partIdx))throw new d},n.checkNotTab=function(){if(this.opts.checkNotTab&&this.scoreData.isPartTab(this.opts.partIdx))throw new e},n.checkSubActions=function(){this.getSubActions().forEach(o)};var o=function(a){a.checkPreconditions()};n.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.transpose(),this.shouldTransposeKeys()&&this.transposeKeys()},n.storeAction=function(){if(!this.cancelStack.hasAction()){var a=this.getLocation(),b=a.measureUuids.slice(),c=g.copy(this.opts.transpose),d={actionName:this.name,opts:{partUuid:a.partUuid,measureUuids:b,staffIdx:this.opts.staffIdx,transpose:c,updateKeys:!!this.opts.updateKeys,allowDoubleAccidentals:this.opts.allowDoubleAccidentals}};this.cancelStack.storeAction(d)}},n.transpose=function(){this.getSubActions().forEach(this.callPerform,this)},n.getSubActions=function(){if(null===this.subActions){var a=this.scoreData.getPartStaffVoicesIndexes(this.opts.partIdx,this.opts.staffIdx);this.subActions=a.map(this.createSubAction,this)}return this.subActions},n.createSubAction=function(a){var b=g.copy(this.opts.transpose),c={partIdx:this.opts.partIdx,startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,voiceIdx:a,transpose:b,checkNotTab:this.opts.checkNotTab,allowDoubleAccidentals:this.opts.allowDoubleAccidentals};return new l(this.scoreData,c,null)},n.callPerform=function(a){a.cancelStack=this.cancelStack,a.perform()},n.shouldTransposeKeys=function(){return(this.opts.updateKeys||!1)&&!this.isUnison()},n.isUnison=function(){return g.isUnison(this.opts.transpose)},n.transposeKeys=function(){var a={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,transpose:g.copy(this.opts.transpose)};new k(this.scoreData,a,this.cancelStack).perform()},n.getLocation=function(){if(null===this.location){var a=this.scoreData.getMeasureUuids(this.opts.startMeasureIdx,this.opts.stopMeasureIdx),b=this.scoreData.getPartUuid(this.opts.partIdx);this.location={partUuid:b,measureUuids:a}}return this.location}}.call(this),function(){"use strict";var a=Adagio.Utils.transposeUtils,b=Adagio.edit.common.convertPartUuidToGetPartIdx,c=Adagio.edit.common.convertMeasuresUuidsToMeasuresIdxs,d=Adagio.edit.common.convertMeasuresFirstLast,e=Adagio.edit.action.TransposeStaff,f=Adagio.edit.action.Transpose=function(a,b,c){this.init(a,b,c)};f.NAME="action.Transpose";var g=f.prototype;g.name=f.NAME,g.init=function(a,e,f){b(a,e),c(a,e),d(a,e),this.scoreData=a,this.cancelStack=f,this.opts=e,this.action=null},g.checkPreconditions=function(){this.getAction().checkPreconditions()},g.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);var a=this.getAction();a.cancelStack=this.cancelStack,a.perform()},g.getAction=function(){if(null===this.action){var b=a.copy(this.opts.transpose),c={partIdx:this.opts.partIdx,startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,staffIdx:this.opts.voiceIdx,updateKeys:this.opts.updateKeys,transpose:b,allowDoubleAccidentals:!1};this.action=new e(this.scoreData,c,null)}return this.action}}.call(this),function(){"use strict";var a=Adagio.Error.InternalError,b=Adagio.edit.action.TestPerformInternalError=function(a,b,c){this.init(a,b,c)};b.NAME="action.TestPerformInternalError",b.isNoChange=function(b){return b instanceof a};var c=b.prototype;c.name=b.NAME,c.init=function(a,b,c){this.cancelStack=c},c.checkPreconditions=function(){},c.perform=function(){throw this.cancelStack=this.cancelStack.createSubstack(this.name),new a("Adagio.edit.action.TestPerformInternalError-InternalError")}}.call(this),function(){"use strict";var a=Adagio.edit.action.TestPerformError=function(a,b,c){this.init(a,b,c)};a.NAME="action.TestPerformError",a.isNoChange=function(a){return a instanceof Error};var b=a.prototype;b.name=a.NAME,b.init=function(a,b,c){this.cancelStack=c},b.checkPreconditions=function(){},b.perform=function(){throw this.cancelStack=this.cancelStack.createSubstack(this.name),new Error("Adagio.edit.action.TestPerformError-Error")}}.call(this),function(){"use strict";var a=Adagio.Error.noChange.NoChangeError,b=Adagio.edit.action.TestPerformNoChangeError=function(a,b,c){this.init(a,b,c)};b.NAME="action.TestPerformNoChangeError",b.isNoChange=function(b){return b instanceof a};var c=b.prototype;c.name=b.NAME,c.init=function(a,b,c){this.cancelStack=c},c.checkPreconditions=function(){},c.perform=function(){throw this.cancelStack=this.cancelStack.createSubstack(this.name),new a("Adagio.edit.action.TestPerformNoChangeError-Error")}}.call(this),function(){"use strict";var a=Adagio.Error.client.ClientError,b=Adagio.edit.action.TestPerformClientError=function(a,b,c){this.init(a,b,c)};b.NAME="action.TestPerformClientError",b.isNoChange=function(b){return b instanceof a};var c=b.prototype;c.name=b.NAME,c.init=function(a,b,c){this.cancelStack=c},c.checkPreconditions=function(){},c.perform=function(){throw this.cancelStack=this.cancelStack.createSubstack(this.name),new a("Adagio.edit.action.TestPerformClientError-Error")}}.call(this),function(){"use strict";var a=Adagio.Error.value.ValueError,b=Adagio.edit.action.TestPerformValueError=function(a,b,c){this.init(a,b,c)};b.NAME="action.TestPerformValueError",b.isNoChange=function(b){return b instanceof a};var c=b.prototype;c.name=b.NAME,c.init=function(a,b,c){this.cancelStack=c},c.checkPreconditions=function(){},c.perform=function(){throw this.cancelStack=this.cancelStack.createSubstack(this.name),new a("Adagio.edit.action.TestPerformValueError-Error")}}.call(this),function(){"use strict";var a=Adagio.Data,b=Adagio.edit.action,c=Adagio.edit.common.CancelStack,d=Adagio.edit.values.ActionOrigin,e=Adagio.Error.noChange.NoChangeError,f=Adagio.Error.client.ClientError,g=Adagio.Error.value.ValueError,h=Adagio.Error.InternalError,i=Adagio.Utils.clone,j="noop",k=function(a){return function(b,f){if(b.actionOrigin===d.INVALIDATED)throw new h("InvalidatedOpts","Using invalidated opts.");f=f||new c,f.resetAction();var g=this;g.assertWritable();var i=new a(g,b,f),k=!0;try{i.checkPreconditions()}catch(a){if(!(a instanceof e))throw a;k=!1}if(k)try{i.perform()}catch(a){l(i,a)}else f.createSubstack(j);var m=f.getActions();return m.forEach(n,b),b.actionOrigin=d.INVALIDATED,void 0!==b.logs&&m.forEach(q,b.logs),m}},l=function(a,b){if(!m(b))throw b;var c="Error while performing action ["+a.name+"]: "+b.message,d=new h("Unexpected",c);throw d.cause=b,d},m=function(a){return a instanceof f||a instanceof e||a instanceof g},n=function(a){var b=this,c=b.actionOrigin||d.DEFAULT;a.opts.settedOrigin=c};for(var o in b){var p=b[o];a.prototype[p.NAME]=k(p)}var q=function(a){var b=this;a.opts.logs=i(b)}}.call(this),function(){"use strict";var a=Adagio.Utils.pitchUtils,b=Adagio.Utils.clone,c=Adagio.edit.action.AddAccidental,d=function(d){var e={partUuid:d.partUuid,measureUuid:d.measureUuid,voiceIdx:d.voiceIdx,timePos:d.timePos,divisions:d.divisions,pitch:a.copyWithoutAlter(d.pitch),accidental:d.previousAccidental};return void 0!==d.fretData&&(e.fretData=b(d.fretData)),{name:c.NAME,opts:e}};Adagio.undo.safe.reverseAddAccidental={type:c.NAME,getReverseAction:d}}.call(this),function(){"use strict";var a=Adagio.Utils.pitchUtils,b=Adagio.edit.action.RemoveNote,c=Adagio.edit.action.AddNote,d=function(c){return{name:b.NAME,opts:{partUuid:c.partUuid,measureUuid:c.measureUuid,voiceIdx:c.voiceIdx,timePos:c.timePos,divisions:c.divisions,pitch:a.copy(c.pitch),insertMode:c.insertMode}}};Adagio.undo.safe.reverseAddNote={type:c.NAME,getReverseAction:d}}.call(this),function(){"use strict";var a=Adagio.Utils.pitchUtils,b=Adagio.edit.action.AddTieArc,c=Adagio.edit.action.RemoveTieArc,d=function(b){return{name:c.NAME,opts:{partUuid:b.partUuid,measureUuid:b.measureUuid,voiceIdx:b.voiceIdx,timePos:b.timePos,divisions:b.divisions,step:a.getStep(b.pitch),octave:a.getOctave(b.pitch)}}};Adagio.undo.safe.reverseAddTieArc={type:b.NAME,getReverseAction:d}}.call(this),function(){"use strict";var a=Adagio.edit.action.ChangeDuration,b=function(b){return{name:a.NAME,opts:{partUuid:b.partUuid,measureUuid:b.measureUuid,voiceIdx:b.voiceIdx,timePos:b.timePos,divisions:b.divisions,durationType:b.previousDurationType,nbDots:b.previousNbDots,insertMode:b.insertMode}}};Adagio.undo.safe.reverseChangeDuration={type:a.NAME,getReverseAction:b}}.call(this),function(){"use strict";var a=Adagio.Utils.pitchUtils,b=Adagio.Utils.timeModifUtils,c=Adagio.edit.action.RemoveNote,d=Adagio.edit.action.AddNote,e=function(c){return{name:d.NAME,opts:{partUuid:c.partUuid,measureUuid:c.measureUuid,voiceIdx:c.voiceIdx,staffIdx:c.staffIdx,timePos:c.timePos,divisions:c.divisions,pitch:a.copy(c.pitch),accidental:c.accidental,fretData:c.fretData,durationType:c.durationType,nbDots:c.nbDots,insertMode:c.insertMode,timeModif:b.copy(c.timeModif),checkLine:!1}}};Adagio.undo.safe.reverseRemoveNote={type:c.NAME,getReverseAction:e}}.call(this),function(){"use strict";var a=Adagio.Utils.pitchUtils,b=Adagio.edit.action.AddTieArc,c=Adagio.edit.action.RemoveTieArc,d=function(c){return{name:b.NAME,opts:{partUuid:c.partUuid,measureUuid:c.measureUuid,voiceIdx:c.voiceIdx,timePos:c.timePos,divisions:c.divisions,step:a.getStep(c.pitch),octave:a.getOctave(c.pitch)}}};Adagio.undo.safe.reverseRemoveTieArc={type:c.NAME,getReverseAction:d}}.call(this),function(){"use strict";var a=Adagio.edit.action.AddArticulations,b=Adagio.edit.action.RemoveArticulation,c=function(a){return{name:b.NAME,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:a.voiceIdx,timePos:a.timePos,divisions:a.divisions,articulationType:a.articulationType}}};Adagio.undo.safe.reverseAddArticulation={type:a.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.edit.action.AddArticulations,b=Adagio.edit.action.RemoveArticulation,c=function(b){return{name:a.NAME,opts:{partUuid:b.partUuid,measureUuid:b.measureUuid,voiceIdx:b.voiceIdx,timePos:b.timePos,divisions:b.divisions,articulationType:b.articulationType}}};Adagio.undo.safe.reverseRemoveArticulation={type:b.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.edit.action.RemoveTechnical,b=Adagio.edit.action.AddTechnical,c=function(b){return{name:a.NAME,opts:{partUuid:b.partUuid,measureUuid:b.measureUuid,voiceIdx:b.voiceIdx,timePos:b.timePos,divisions:b.divisions,technicalType:b.technicalType}}};Adagio.undo.safe.reverseAddTechnical={type:b.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.edit.action.RemoveTechnical,b=Adagio.edit.action.AddTechnical,c=function(a){return{name:b.NAME,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:a.voiceIdx,timePos:a.timePos,divisions:a.divisions,technicalType:a.technicalType,technicalOpts:a.technicalOpts}}};Adagio.undo.safe.reverseRemoveTechnical={type:a.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.edit.action.AddSlur,b=Adagio.edit.action.RemoveSlur,c=function(a){return{name:b.NAME,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:a.voiceIdx,timePos:a.timePos,divisions:a.divisions}}};Adagio.undo.safe.reverseAddSlur={type:a.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.edit.action.AddSlur,b=Adagio.edit.action.RemoveSlur,c=function(b){return{name:a.NAME,opts:{partUuid:b.partUuid,voiceIdx:b.voiceIdx,startMeasureUuid:b.startMeasureUuid,startTimePos:b.startTimePos,startDivisions:b.startDivisions,stopMeasureUuid:b.stopMeasureUuid,stopTimePos:b.stopTimePos,stopDivisions:b.stopDivisions}}};Adagio.undo.safe.reverseRemoveSlur={type:b.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.edit.action.RemoveHarmonyAtTimePos,b=Adagio.edit.action.AddHarmonyAtTimePos,c=function(b){return{name:a.NAME,opts:{partUuid:b.partUuid,measureUuid:b.measureUuid,timePos:b.timePos,dpq:b.dpq}}};Adagio.undo.safe.reverseAddHarmonyAtTimePos={type:b.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.Utils.rootUtils,b=Adagio.Utils.bassUtils,c=Adagio.Utils.degreeUtils,d=Adagio.edit.action.RemoveHarmonyAtTimePos,e=Adagio.edit.action.AddHarmonyAtTimePos,f=function(b){return{name:e.NAME,opts:{partUuid:b.partUuid,measureUuid:b.measureUuid,timePos:b.timePos,dpq:b.dpq,root:a.copy(b.root),kind:b.kind,bass:g(b.bass),degrees:b.degrees.map(c.copy)}}},g=function(a){return null===a?null:b.copy(a)};Adagio.undo.safe.reverseRemoveHarmonyAtTimePos={type:d.NAME,getReverseAction:f}}.call(this),function(){"use strict";var a=Adagio.Utils.unpitchedUtils,b=Adagio.edit.action.AddToChordPercu,c=Adagio.edit.action.RemoveNotePercu,d=function(b){return{name:c.NAME,opts:{partUuid:b.partUuid,measureUuid:b.measureUuid,voiceIdx:b.voiceIdx,timePos:b.timePos,divisions:b.divisions,unpitched:a.copy(b.unpitched)}}};Adagio.undo.safe.reverseAddToChordPercu={type:b.NAME,getReverseAction:d}}.call(this),function(){"use strict";var a=Adagio.Utils.unpitchedUtils,b=Adagio.edit.action.AddToChordPercu,c=Adagio.edit.action.RemoveFromChordPercu,d=function(c){return{name:b.NAME,opts:{partUuid:c.partUuid,measureUuid:c.measureUuid,voiceIdx:c.voiceIdx,staffIdx:c.staffIdx,timePos:c.timePos,divisions:c.divisions,unpitched:a.copy(c.unpitched),notehead:c.notehead}}};Adagio.undo.safe.reverseRemoveFromChordPercu={type:c.NAME,getReverseAction:d}}.call(this),function(){"use strict";var a=Adagio.Utils.unpitchedUtils,b=Adagio.edit.action.AddSingleNotePercu,c=Adagio.edit.action.RemoveNotePercu,d=function(b){return{name:c.NAME,opts:{partUuid:b.partUuid,measureUuid:b.measureUuid,voiceIdx:b.voiceIdx,timePos:b.timePos,divisions:b.divisions,unpitched:a.copy(b.unpitched),insertMode:b.insertMode}}};Adagio.undo.safe.reverseAddSingleNotePercu={type:b.NAME,getReverseAction:d}}.call(this),function(){"use strict";var a=Adagio.Utils.unpitchedUtils,b=Adagio.Utils.timeModifUtils,c=Adagio.edit.action.AddSingleNotePercu,d=Adagio.edit.action.RemoveSingleNotePercu,e=function(d){var e=b.copy(d.timeModif);return{name:c.NAME,opts:{partUuid:d.partUuid,measureUuid:d.measureUuid,voiceIdx:d.voiceIdx,staffIdx:d.staffIdx,timePos:d.timePos,divisions:d.divisions,durationType:d.durationType,nbDots:d.nbDots,unpitched:a.copy(d.unpitched),notehead:d.notehead,timeModif:e}}};Adagio.undo.safe.reverseRemoveSingleNotePercu={type:d.NAME,getReverseAction:e}}.call(this),function(){"use strict";var a=Adagio.Utils.unpitchedUtils,b=Adagio.edit.action.ChangeHeadPercu,c=function(c){return{name:b.NAME,opts:{partUuid:c.partUuid,measureUuid:c.measureUuid,voiceIdx:c.voiceIdx,timePos:c.timePos,divisions:c.divisions,unpitched:a.copy(c.unpitched),notehead:c.previousNotehead}}};Adagio.undo.safe.reverseChangeHeadPercu={type:b.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.edit.action.RemoveTuplet,b=Adagio.edit.action.AddTuplet,c=function(b){return{
name:a.NAME,opts:{partUuid:b.partUuid,measureUuid:b.measureUuid,voiceIdx:b.voiceIdx,timePos:b.timePos,divisions:b.divisions}}};Adagio.undo.safe.reverseAddTuplet={type:b.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.edit.action.RemoveTuplet,b=Adagio.edit.action.AddTuplet,c=Adagio.Utils.timeModifUtils,d=function(a){var d=c.copy(a.timeModif);return{name:b.NAME,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:a.voiceIdx,timePos:a.timePos,divisions:a.divisions,tupletType:a.tupletType,timeModif:d,durationType:a.durationType,nbDots:a.nbDots}}};Adagio.undo.safe.reverseRemoveTuplet={type:a.NAME,getReverseAction:d}}.call(this),function(){"use strict";var a=Adagio.edit.action.RemoveMeasure,b=Adagio.edit.action.AddMeasure,c=function(b){return{name:a.NAME,opts:{measureUuid:b.measureUuid}}};Adagio.undo.safe.reverseAddMeasure={type:b.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.edit.action.AddMeasure,b=Adagio.edit.action.RemoveMeasure,c=function(b){return{name:a.NAME,opts:{measureUuid:b.measureUuid,previousUuid:b.previousUuid,nextUuid:b.nextUuid}}};Adagio.undo.safe.reverseRemoveMeasure={type:b.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.edit.action.AddOrnament,b=Adagio.edit.action.RemoveOrnament,c=function(a){return{name:b.NAME,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:a.voiceIdx,timePos:a.timePos,divisions:a.divisions,ornamentType:a.ornamentType}}};Adagio.undo.safe.reverseAddOrnament={type:a.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.edit.action.AddOrnament,b=Adagio.edit.action.RemoveOrnament,c=function(b){return{name:a.NAME,opts:{partUuid:b.partUuid,measureUuid:b.measureUuid,voiceIdx:b.voiceIdx,timePos:b.timePos,divisions:b.divisions,ornamentType:b.ornamentType,ornamentsOpts:b.ornamentsOpts}}};Adagio.undo.safe.reverseRemoveOrnament={type:b.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.Utils.clefUtils,b=Adagio.edit.action.SetClef,c=Adagio.edit.action.SetClefSegment,d=function(c){var d=c.measureUuids.slice();return{name:b.NAME,opts:{partUuid:c.partUuid,measureUuids:d,staffIdx:c.staffIdx,clef:a.copy(c.previousClef)}}};Adagio.undo.safe.reverseSetClef={type:c.NAME,getReverseAction:d}}.call(this),function(){"use strict";var a=Adagio.edit.action.AddNotations,b=Adagio.edit.action.RemoveNotation,c=function(a){return{name:b.NAME,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:a.voiceIdx,timePos:a.timePos,divisions:a.divisions,notationType:a.notationType}}};Adagio.undo.safe.reverseAddNotation={type:a.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.edit.action.AddNotations,b=Adagio.edit.action.RemoveNotation,c=Adagio.Utils.timeModifUtils,d=function(b){var d=c.copy(b.timeModif);return{name:a.NAME,opts:{partUuid:b.partUuid,measureUuid:b.measureUuid,voiceIdx:b.voiceIdx,timePos:b.timePos,divisions:b.divisions,timeModif:d,notationType:b.notationType}}};Adagio.undo.safe.reverseRemoveNotation={type:b.NAME,getReverseAction:d}}.call(this),function(){"use strict";var a=Adagio.Utils.timeUtils,b=Adagio.edit.action.SetTimeSignature,c=Adagio.edit.action.SetTimeSegment,d=function(c){var d=c.measureUuids.slice();return{name:b.NAME,opts:{measureUuids:d,timeSignature:a.copy(c.previousTime),displayedTime:a.copy(c.previousDisplayedTime)}}};Adagio.undo.safe.reverseSetTimeSignature={type:c.NAME,getReverseAction:d}}.call(this),function(){"use strict";var a=Adagio.Utils.keyUtils,b=Adagio.edit.action.SetKey,c=Adagio.edit.action.SetKeySegment,d=function(c){var d=c.measureUuids.slice();return{name:b.NAME,opts:{partUuid:c.partUuid,measureUuids:d,staffIdx:c.staffIdx,key:a.copy(c.previousKey)}}};Adagio.undo.safe.reverseSetKey={type:c.NAME,getReverseAction:d}}.call(this),function(){"use strict";var a=Adagio.Utils.transposeUtils,b=Adagio.edit.action.TransposeVoice,c=function(c){var d=c.measureUuids.slice(),e=a.getReverse(c.transpose);return{name:b.NAME,opts:{partUuid:c.partUuid,measureUuids:d,voiceIdx:c.voiceIdx,transpose:e,allowDoubleAccidentals:c.allowDoubleAccidentals}}};Adagio.undo.safe.reverseTransposeVoice={type:b.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.edit.action.AddLyric,b=Adagio.edit.action.RemoveLyric,c=function(a){return{name:b.NAME,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:a.voiceIdx,divisions:a.divisions,timePos:a.timePos,level:a.level}}};Adagio.undo.safe.reverseAddLyric={type:a.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.edit.action.AddLyric,b=Adagio.edit.action.RemoveLyric,c=Adagio.Utils.timeModifUtils,d=function(b){var d=c.copy(b.timeModif);return{name:a.NAME,opts:{partUuid:b.partUuid,measureUuid:b.measureUuid,voiceIdx:b.voiceIdx,divisions:b.divisions,timePos:b.timePos,timeModif:d,level:b.level,lyric:b.lyric,hasRightConnection:b.hasRightConnection}}};Adagio.undo.safe.reverseRemoveLyric={type:b.NAME,getReverseAction:d}}.call(this),function(){"use strict";var a=Adagio.edit.action.AddEnding,b=Adagio.edit.action.RemoveEnding,c=function(a){return{name:b.NAME,opts:{measureUuid:a.measureUuid}}};Adagio.undo.safe.reverseAddEnding={type:a.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.edit.action.AddEnding,b=Adagio.edit.action.RemoveEnding,c=function(b){var c=b.numbers.slice();return{name:a.NAME,opts:{measureUuid:b.measureUuid,numbers:c}}};Adagio.undo.safe.reverseRemoveEnding={type:b.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.Utils.timeModifUtils,b=Adagio.edit.action.DeleteRest,c=Adagio.edit.action.InsertRest,d=function(c){var d=a.copy(c.timeModif);return{name:b.NAME,opts:{partUuid:c.partUuid,measureUuid:c.measureUuid,voiceIdx:c.voiceIdx,timePos:c.timePos,divisions:c.divisions,durationType:c.durationType,nbDots:c.nbDots,timeModif:d}}};Adagio.undo.safe.reverseInsertRest={type:c.NAME,getReverseAction:d}}.call(this),function(){"use strict";var a=Adagio.Utils.timeModifUtils,b=Adagio.edit.action.DeleteRest,c=Adagio.edit.action.InsertRest,d=function(b){var d=a.copy(b.timeModif);return{name:c.NAME,opts:{partUuid:b.partUuid,measureUuid:b.measureUuid,voiceIdx:b.voiceIdx,staffIdx:b.staffIdx,timePos:b.timePos,divisions:b.divisions,durationType:b.durationType,nbDots:b.nbDots,timeModif:d}}};Adagio.undo.safe.reverseDeleteRest={type:b.NAME,getReverseAction:d}}.call(this),function(){"use strict";var a=Adagio.edit.action.AddDynamicAtTimePos,b=Adagio.edit.action.RemoveDynamicAtTimePos,c=function(b){return{name:a.NAME,opts:{partUuid:b.partUuid,measureUuid:b.measureUuid,staffIdx:b.staffIdx,placement:b.placement,timePos:b.timePos,dpq:b.dpq,style:b.style,sound:b.sound}}};Adagio.undo.safe.reverseRemoveDynamic={type:b.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.edit.action.AddDynamicAtTimePos,b=Adagio.edit.action.RemoveDynamicAtTimePos,c=function(a){return{name:b.NAME,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,staffIdx:a.staffIdx,timePos:a.timePos,dpq:a.dpq}}};Adagio.undo.safe.reverseAddDynamic={type:a.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.edit.action.AddWedgeAtTimePos,b=Adagio.edit.action.RemoveWedgeAtTimePos,c=function(b){return{name:a.NAME,opts:{partUuid:b.partUuid,staffIdx:b.staffIdx,voiceIdx:b.voiceIdx,startMeasureUuid:b.startMeasureUuid,startTimePos:b.startTimePos,startDpq:b.startDpq,stopMeasureUuid:b.stopMeasureUuid,stopTimePos:b.stopTimePos,stopDpq:b.stopDpq,placement:b.placement,type:b.type}}};Adagio.undo.safe.reverseRemoveWedge={type:b.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.edit.action.AddWedgeAtTimePos,b=Adagio.edit.action.RemoveWedgeAtTimePos,c=function(a){return{name:b.NAME,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,staffIdx:a.staffIdx,voiceIdx:a.voiceIdx,timePos:a.timePos,dpq:a.dpq}}};Adagio.undo.safe.reverseAddWedge={type:a.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.edit.action.MovePart,b=function(b){return{name:a.NAME,opts:{fromPartUuid:b.fromPartUuid,previousUuid:b.previousUuid,nextUuid:b.nextUuid}}};Adagio.undo.safe.reverseMovePart={type:a.NAME,getReverseAction:b}}.call(this),function(){"use strict";var a=Adagio.edit.action.AddPart,b=Adagio.edit.action.AddPartPercu,c=Adagio.edit.action.RemovePart,d=Adagio.edit.common.copyPitchMapping,e=Adagio.edit.values.PartType,f=Adagio.Utils.clone,g=function(c){var g,h={previousUuid:c.previousUuid,nextUuid:c.nextUuid,partUuid:c.partUuid,volume:c.volume,name:c.name};return void 0!==c.abbreviation&&(h.abbreviation=c.abbreviation),c.partType===e.NORMAL?(g=a.NAME,h.instrumentName=c.instrumentName,h.MIDIProgram=c.MIDIProgram,h.staves=f(c.staves)):c.partType===e.UNPITCHED?(g=b.NAME,h.pitchMapping=d(c.pitchMapping),h.instrumentsList=f(c.instrumentsList),h.nbStaffLines=c.nbStaffLines):e.raiseError(c.partType),{name:g,opts:h}};Adagio.undo.safe.reverseRemovePart={type:c.NAME,getReverseAction:g}}.call(this),function(){"use strict";var a=Adagio.edit.action.RemovePart,b=Adagio.edit.action.AddPart,c=function(b){return{name:a.NAME,opts:{partUuid:b.partUuid}}};Adagio.undo.safe.reverseAddPart={type:b.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.edit.action.RemovePart,b=Adagio.edit.action.AddPartPercu,c=function(b){return{name:a.NAME,opts:{partUuid:b.partUuid}}};Adagio.undo.safe.reverseAddPartPercu={type:b.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.edit.action.ChangeInstrument,b=Adagio.Utils.transposeUtils,c=function(c){var d=b.copy(c.transpose);return{name:a.NAME,opts:{partUuid:c.partUuid,MIDIProgram:c.MIDIProgram,instrumentName:c.instrumentName,partName:c.partName,abbreviation:c.abbreviation,transpose:d,noTranspose:!0,clefs:[],staffDetails:[]}}};Adagio.undo.safe.reverseChangeInstrument={type:a.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.edit.action.ChangePartName,b=function(b){return{name:a.NAME,opts:{partUuid:b.partUuid,partName:b.previousName,partAbbreviation:b.previousAbbreviation}}};Adagio.undo.safe.reverseChangePartName={type:a.NAME,getReverseAction:b}}.call(this),function(){"use strict";var a=Adagio.edit.action.RemoveArpeggio,b=Adagio.edit.action.AddArpeggio,c=function(a){return{name:b.NAME,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:a.voiceIdx,timePos:a.timePos,divisions:a.divisions}}};Adagio.undo.safe.reverseRemoveArpeggio={type:a.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.edit.action.AddArpeggio,b=Adagio.edit.action.RemoveArpeggio,c=function(a){return{name:b.NAME,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:a.voiceIdx,timePos:a.timePos,divisions:a.divisions}}};Adagio.undo.safe.reverseAddArpeggio={type:a.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.edit.action.RemoveJumpTag,b=Adagio.edit.action.AddJumpTag,c=function(b){return{name:a.NAME,opts:{measureUuid:b.measureUuid}}};Adagio.undo.safe.reverseAddJumpTag={type:b.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.edit.action.RemoveJumpTag,b=Adagio.edit.action.AddJumpTag,c=function(a){return{name:b.NAME,opts:{measureUuid:a.measureUuid,type:a.type}}};Adagio.undo.safe.reverseRemoveJumpTag={type:a.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.edit.action.RemoveJumpCall,b=Adagio.edit.action.AddJumpCall,c=function(b){return{name:a.NAME,opts:{measureUuid:b.measureUuid}}};Adagio.undo.safe.reverseAddJumpCall={type:b.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.edit.action.RemoveJumpCall,b=Adagio.edit.action.AddJumpCall,c=function(a){return{name:b.NAME,opts:{measureUuid:a.measureUuid,type:a.type}}};Adagio.undo.safe.reverseRemoveJumpCall={type:a.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.Utils.pitchUtils,b=Adagio.edit.action.RemoveNote,c=Adagio.edit.action.AddToChord,d=Adagio.edit.values.InsertMode,e=function(c){return{name:b.NAME,opts:{partUuid:c.partUuid,measureUuid:c.measureUuid,voiceIdx:c.voiceIdx,timePos:c.timePos,divisions:c.divisions,pitch:a.copy(c.pitch),insertMode:d.REPLACE}}};Adagio.undo.safe.reverseAddToChord={type:c.NAME,getReverseAction:e}}.call(this),function(){"use strict";var a=Adagio.Utils.pitchUtils,b=Adagio.Utils.timeModifUtils,c=Adagio.Utils.clone,d=Adagio.edit.action.AddNote,e=Adagio.edit.action.RemoveFromChord,f=Adagio.edit.values.InsertMode,g=function(e){var g={partUuid:e.partUuid,measureUuid:e.measureUuid,staffIdx:e.staffIdx,voiceIdx:e.voiceIdx,timePos:e.timePos,divisions:e.divisions,pitch:a.copyWithoutAlter(e.pitch),accidental:e.accidental,durationType:e.durationType,nbDots:e.nbDots,timeModif:b.copy(e.timeModif),insertMode:f.REPLACE,checkLine:!1};return void 0!==e.fretData&&(g.fretData=c(e.fretData)),{name:d.NAME,opts:g}};Adagio.undo.safe.reverseRemoveFromChord={type:e.NAME,getReverseAction:g}}.call(this),function(){"use strict";var a=Adagio.edit.action.MoveSlurSide,b=function(b){return{name:a.NAME,opts:{partUuid:b.partUuid,voiceIdx:b.voiceIdx,oldMeasureUuid:b.newMeasureUuid,oldDivisions:b.newDivisions,oldTimePos:b.newTimePos,newMeasureUuid:b.oldMeasureUuid,newDivisions:b.oldDivisions,newTimePos:b.oldTimePos}}};Adagio.undo.safe.reverseMoveSlurSide={type:a.NAME,getReverseAction:b}}.call(this),function(){"use strict";var a=Adagio.edit.action.SetTempo,b=Adagio.edit.action.SetTempoSegment,c=Adagio.Utils.tempoUtils,d=function(b){var d,e=b.measureUuids.slice();return d="number"==typeof b.previousTempo?c.createWithDefaultDisplay(b.previousTempo):c.copy(b.previousTempo),{name:a.NAME,opts:{measureUuids:e,tempo:d}}};Adagio.undo.safe.reverseSetTempoSegment={type:b.NAME,getReverseAction:d}}.call(this),function(){"use strict";var a=Adagio.Utils.pitchUtils,b=Adagio.edit.action.RemoveGraceFromChord,c=Adagio.edit.action.AddGraceToChord,d=function(c){return{name:b.NAME,opts:{partUuid:c.partUuid,measureUuid:c.measureUuid,voiceIdx:c.voiceIdx,timePos:c.timePos,divisions:c.divisions,graceIdx:c.graceIdx,pitch:a.copy(c.pitch)}}};Adagio.undo.safe.reverseAddGraceToChord={type:c.NAME,getReverseAction:d}}.call(this),function(){"use strict";var a=Adagio.Utils.pitchUtils,b=Adagio.edit.action.AddGraceToChord,c=Adagio.edit.action.RemoveGraceFromChord,d=function(c){var d={partUuid:c.partUuid,measureUuid:c.measureUuid,staffIdx:c.staffIdx,voiceIdx:c.voiceIdx,timePos:c.timePos,divisions:c.divisions,graceIdx:c.graceIdx,pitch:a.copyWithoutAlter(c.pitch),accidental:c.accidental,durationType:c.durationType,checkLine:!0};return{name:b.NAME,opts:d}};Adagio.undo.safe.reverseRemoveGraceFromChord={type:c.NAME,getReverseAction:d}}.call(this),function(){"use strict";var a=Adagio.edit.action.DeleteGraceNote,b=Adagio.edit.action.InsertGraceNote,c=function(b){return{name:a.NAME,opts:{partUuid:b.partUuid,measureUuid:b.measureUuid,voiceIdx:b.voiceIdx,timePos:b.timePos,divisions:b.divisions,graceIdx:b.graceIdx}}};Adagio.undo.safe.reverseInsertGraceNote={type:b.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.Utils.pitchUtils,b=Adagio.edit.action.DeleteGraceNote,c=Adagio.edit.action.InsertGraceNote,d=function(b){return{name:c.NAME,opts:{partUuid:b.partUuid,measureUuid:b.measureUuid,voiceIdx:b.voiceIdx,staffIdx:b.staffIdx,timePos:b.timePos,divisions:b.divisions,graceIdx:b.graceIdx,pitch:a.copyWithoutAlter(b.pitch),accidental:b.accidental,durationType:b.durationType,checkLine:!0}}};Adagio.undo.safe.reverseDeleteGraceNote={type:b.NAME,getReverseAction:d}}.call(this),function(){"use strict";var a=Adagio.Utils.pitchUtils,b=Adagio.edit.action.AddGraceAccidental,c=function(c){var d={partUuid:c.partUuid,measureUuid:c.measureUuid,voiceIdx:c.voiceIdx,timePos:c.timePos,divisions:c.divisions,graceIdx:c.graceIdx,pitch:a.copyWithoutAlter(c.pitch),accidental:c.previousAccidental};return{name:b.NAME,opts:d}};Adagio.undo.safe.reverseAddGraceAccidental={type:b.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.edit.action.ChangeGraceDuration,b=function(b){return{name:a.NAME,opts:{partUuid:b.partUuid,measureUuid:b.measureUuid,voiceIdx:b.voiceIdx,timePos:b.timePos,divisions:b.divisions,graceIdx:b.graceIdx,durationType:b.oldDurationType}}};Adagio.undo.safe.reverseChangeGraceDuration={type:a.NAME,getReverseAction:b}}.call(this),function(){"use strict";var a=Adagio.edit.action.HideMeasureVoice,b=Adagio.edit.action.ShowMeasureVoice,c=function(a){return{name:b.NAME,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:a.voiceIdx}}};Adagio.undo.safe.reverseHideMeasureVoice={type:a.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.edit.action.ShowMeasureVoice,b=Adagio.edit.action.HideMeasureVoice,c=function(a){return{name:b.NAME,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:a.voiceIdx}}};Adagio.undo.safe.reverseShowMeasureVoice={type:a.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.edit.action.RemoveVoice,b=Adagio.edit.action.AddVoice,c=function(a){return{name:b.NAME,opts:{partUuid:a.partUuid,voiceIdx:a.voiceIdx,staffIdx:a.staffIdx,idxInStaff:a.idxInStaff,isMainVoice:a.isMainVoice}}};Adagio.undo.safe.reverseRemoveVoice={type:a.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.edit.action.AddVoice,b=Adagio.edit.action.RemoveVoice,c=function(a){return{name:b.NAME,opts:{partUuid:a.partUuid,voiceIdx:a.voiceIdx,candidateMainVoiceIdx:a.candidateMainVoiceIdx}}};Adagio.undo.safe.reverseAddVoice={type:a.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.edit.action.AddGlissando,b=Adagio.edit.action.RemoveGlissando,c=Adagio.Utils.pitchUtils,d=function(a){return{name:b.NAME,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:a.voiceIdx,timePos:a.timePos,divisions:a.divisions,leftPitch:c.copy(a.leftPitch),rightPitch:c.copy(a.rightPitch),number:a.number}}};Adagio.undo.safe.reverseAddGlissando={type:a.NAME,getReverseAction:d}}.call(this),function(){"use strict";var a=Adagio.edit.action.AddGlissando,b=Adagio.edit.action.RemoveGlissando,c=Adagio.Utils.pitchUtils,d=function(b){return{name:a.NAME,opts:{partUuid:b.partUuid,measureUuid:b.measureUuid,voiceIdx:b.voiceIdx,timePos:b.timePos,divisions:b.divisions,leftPitch:c.copy(b.leftPitch),rightPitch:c.copy(b.rightPitch),number:b.number}}};Adagio.undo.safe.reverseRemoveGlissando={type:b.NAME,getReverseAction:d}}.call(this),function(){"use strict";var a=Adagio.Utils.pitchUtils,b=Adagio.Utils.clone,c=Adagio.edit.action.SetFret,d=function(d){return{name:c.NAME,opts:{partUuid:d.partUuid,measureUuid:d.measureUuid,voiceIdx:d.voiceIdx,timePos:d.timePos,divisions:d.divisions,pitch:a.copy(d.pitch),fretData:null!==d.fretData?b(d.fretData):null}}};Adagio.undo.safe.reverseSetFret={type:c.NAME,getReverseAction:d}}.call(this),function(){"use strict";var a=Adagio.Utils.staffDetailsUtils,b=Adagio.edit.action.SetStaffDetails,c=function(c){return{name:b.NAME,opts:{partUuid:c.partUuid,staffIdx:c.staffIdx,staffDetails:a.copy(c.staffDetails),updateFrets:c.updateFrets}}};Adagio.undo.safe.reverseSetStaffDetails={type:b.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.edit.action.AddPizzicatoAtTimePos,b=Adagio.edit.action.RemovePizzicatoAtTimePos,c=function(a){return{name:b.NAME,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,staffIdx:a.staffIdx,timePos:a.timePos,dpq:a.dpq}}};Adagio.undo.safe.reverseAddPizzicato={type:a.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.edit.action.AddPizzicatoAtTimePos,b=Adagio.edit.action.RemovePizzicatoAtTimePos,c=function(b){return{name:a.NAME,opts:{partUuid:b.partUuid,measureUuid:b.measureUuid,staffIdx:b.staffIdx,placement:b.placement,timePos:b.timePos,dpq:b.dpq,type:b.type}}};Adagio.undo.safe.reverseRemovePizzicato={type:b.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.edit.action.AddWordAtTimePos,b=Adagio.edit.action.RemoveWordAtTimePos,c=function(a){return{name:b.NAME,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,staffIdx:a.staffIdx,timePos:a.timePos,dpq:a.dpq}}};Adagio.undo.safe.reverseAddWord={type:a.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.edit.action.AddWordAtTimePos,b=Adagio.edit.action.RemoveWordAtTimePos,c=function(b){return{name:a.NAME,opts:{partUuid:b.partUuid,measureUuid:b.measureUuid,staffIdx:b.staffIdx,placement:b.placement,timePos:b.timePos,dpq:b.dpq,text:b.text}}};Adagio.undo.safe.reverseRemoveWord={type:b.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.edit.action.AddPedalAtTimePos,b=Adagio.edit.action.RemovePedalAtTimePos,c=function(a){return{name:b.NAME,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,staffIdx:a.staffIdx,voiceIdx:a.voiceIdx,timePos:a.timePos,dpq:a.dpq}}};Adagio.undo.safe.reverseAddPedal={type:a.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.edit.action.AddPedalAtTimePos,b=Adagio.edit.action.RemovePedalAtTimePos,c=function(b){return{name:a.NAME,opts:{partUuid:b.partUuid,staffIdx:b.staffIdx,voiceIdx:b.voiceIdx,startMeasureUuid:b.startMeasureUuid,startTimePos:b.startTimePos,startDpq:b.startDpq,stopMeasureUuid:b.stopMeasureUuid,stopTimePos:b.stopTimePos,stopDpq:b.stopDpq,placement:b.placement}}};Adagio.undo.safe.reverseRemovePedal={type:b.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.edit.action.AddOctaveShiftAtTimePos,b=Adagio.edit.action.RemoveOctaveShiftAtTimePos,c=function(a){return{name:b.NAME,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,staffIdx:a.staffIdx,timePos:a.timePos,dpq:a.dpq,transpose:!1}}};Adagio.undo.safe.reverseAddOctaveShift={type:a.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.edit.action.AddOctaveShiftAtTimePos,b=Adagio.edit.action.RemoveOctaveShiftAtTimePos,c=function(b){return{name:a.NAME,opts:{partUuid:b.partUuid,staffIdx:b.staffIdx,startMeasureUuid:b.startMeasureUuid,startTimePos:b.startTimePos,startDpq:b.startDpq,stopMeasureUuid:b.stopMeasureUuid,stopTimePos:b.stopTimePos,stopDpq:b.stopDpq,placement:b.placement,size:b.size,transpose:!1}}};Adagio.undo.safe.reverseRemoveOctaveShift={type:b.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.Utils.unpitchedUtils,b=Adagio.edit.action.DeleteGraceNotePercu,c=Adagio.edit.action.InsertGraceNotePercu,d=function(b){return{name:c.NAME,opts:{partUuid:b.partUuid,measureUuid:b.measureUuid,voiceIdx:b.voiceIdx,staffIdx:b.staffIdx,timePos:b.timePos,divisions:b.divisions,graceIdx:b.graceIdx,unpitched:a.copy(b.unpitched),notehead:b.notehead,durationType:b.durationType}}};Adagio.undo.safe.reverseDeleteGraceNotePercu={type:b.NAME,getReverseAction:d}}.call(this),function(){"use strict";var a=Adagio.edit.action.DeleteGraceNotePercu,b=Adagio.edit.action.InsertGraceNotePercu,c=function(b){return{name:a.NAME,opts:{partUuid:b.partUuid,measureUuid:b.measureUuid,voiceIdx:b.voiceIdx,timePos:b.timePos,divisions:b.divisions,graceIdx:b.graceIdx}}};Adagio.undo.safe.reverseInsertGraceNotePercu={type:b.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.Utils.unpitchedUtils,b=Adagio.edit.action.AddGraceToChordPercu,c=Adagio.edit.action.RemoveGraceFromChordPercu,d=function(c){var d={partUuid:c.partUuid,measureUuid:c.measureUuid,staffIdx:c.staffIdx,voiceIdx:c.voiceIdx,timePos:c.timePos,divisions:c.divisions,graceIdx:c.graceIdx,unpitched:a.copy(c.unpitched),notehead:c.notehead};return{name:b.NAME,opts:d}};Adagio.undo.safe.reverseRemoveGraceFromChordPercu={type:c.NAME,getReverseAction:d}}.call(this),function(){"use strict";var a=Adagio.Utils.unpitchedUtils,b=Adagio.edit.action.RemoveGraceFromChordPercu,c=Adagio.edit.action.AddGraceToChordPercu,d=function(c){return{name:b.NAME,opts:{partUuid:c.partUuid,measureUuid:c.measureUuid,voiceIdx:c.voiceIdx,timePos:c.timePos,divisions:c.divisions,graceIdx:c.graceIdx,unpitched:a.copy(c.unpitched)}}};Adagio.undo.safe.reverseAddGraceToChordPercu={type:c.NAME,getReverseAction:d}}.call(this),function(){"use strict";var a=Adagio.Utils.unpitchedUtils,b=Adagio.edit.action.ChangeGraceHeadPercu,c=function(c){var d={partUuid:c.partUuid,measureUuid:c.measureUuid,voiceIdx:c.voiceIdx,timePos:c.timePos,divisions:c.divisions,graceIdx:c.graceIdx,unpitched:a.copy(c.unpitched),notehead:c.notehead};return{name:b.NAME,opts:d}};Adagio.undo.safe.reverseChangeGraceHeadPercu={type:b.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.Utils.unpitchedUtils,b=Adagio.edit.action.AddTieArcPercu,c=Adagio.edit.action.RemoveTieArcPercu,d=function(b){return{name:c.NAME,opts:{partUuid:b.partUuid,measureUuid:b.measureUuid,voiceIdx:b.voiceIdx,timePos:b.timePos,divisions:b.divisions,"display-step":a.getStep(b.unpitched),"display-octave":a.getOctave(b.unpitched)}}};Adagio.undo.safe.reverseAddTieArcPercu={type:b.NAME,getReverseAction:d}}.call(this),function(){"use strict";var a=Adagio.Utils.unpitchedUtils,b=Adagio.edit.action.AddTieArcPercu,c=Adagio.edit.action.RemoveTieArcPercu,d=function(c){return{name:b.NAME,opts:{partUuid:c.partUuid,measureUuid:c.measureUuid,voiceIdx:c.voiceIdx,timePos:c.timePos,divisions:c.divisions,"display-step":a.getStep(c.unpitched),"display-octave":a.getOctave(c.unpitched)}}};Adagio.undo.safe.reverseRemoveTieArcPercu={type:c.NAME,getReverseAction:d}}.call(this),function(){"use strict";var a=Adagio.edit.action.RemoveHammerOnPullOff,b=Adagio.edit.action.AddHammerOnPullOff,c=Adagio.Utils.pitchUtils,d=function(b){return{name:a.NAME,opts:{partUuid:b.partUuid,measureUuid:b.measureUuid,voiceIdx:b.voiceIdx,timePos:b.timePos,divisions:b.divisions,pitch:c.copy(b.pitch)}}};Adagio.undo.safe.reverseAddHammerOnPullOff={type:b.NAME,getReverseAction:d}}.call(this),function(){"use strict";var a=Adagio.edit.action.RemoveHammerOnPullOff,b=Adagio.edit.action.AddHammerOnPullOff,c=Adagio.Utils.pitchUtils,d=function(a){return{name:b.NAME,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:a.voiceIdx,timePos:a.timePos,divisions:a.divisions,pitch:c.copy(a.pitch)}}};Adagio.undo.safe.reverseRemoveHammerOnPullOff={type:a.NAME,getReverseAction:d}}.call(this),function(){"use strict";var a=Adagio.edit.action.AddGlissandoSide,b=Adagio.edit.action.RemoveGlissandoSide,c=Adagio.Utils.pitchUtils,d=function(a){return{name:b.NAME,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:a.voiceIdx,timePos:a.timePos,divisions:a.divisions,pitch:c.copy(a.pitch),number:a.number,glissandoType:a.glissandoType}}};Adagio.undo.safe.reverseAddGlissandoSide={type:a.NAME,getReverseAction:d}}.call(this),function(){"use strict";var a=Adagio.edit.action.AddGlissandoSide,b=Adagio.edit.action.RemoveGlissandoSide,c=Adagio.Utils.pitchUtils,d=function(b){return{name:a.NAME,opts:{partUuid:b.partUuid,measureUuid:b.measureUuid,voiceIdx:b.voiceIdx,timePos:b.timePos,divisions:b.divisions,pitch:c.copy(b.pitch),number:b.number,glissandoType:b.glissandoType}}};Adagio.undo.safe.reverseRemoveGlissandoSide={type:b.NAME,getReverseAction:d}}.call(this),function(){"use strict";var a=Adagio.edit.action.SetSwing,b=Adagio.edit.action.SetSwingSegment,c=Adagio.Utils.swingUtils,d=function(b){var d=b.measureUuids.slice();return{name:a.NAME,opts:{measureUuids:d,swing:c.copy(b.previousSwing)}}};Adagio.undo.safe.reverseSetSwingSegment={type:b.NAME,getReverseAction:d}}.call(this),function(){"use strict";var a=Adagio.edit.action.AddTempoChangeAtTimePos,b=Adagio.edit.action.RemoveTempoChangeAtTimePos,c=function(a){return{name:b.NAME,opts:{measureUuid:a.measureUuid,timePos:a.timePos,dpq:a.dpq}}};Adagio.undo.safe.reverseAddTempoChange={type:a.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.edit.action.AddTempoChangeAtTimePos,b=Adagio.edit.action.RemoveTempoChangeAtTimePos,c=function(b){return{name:a.NAME,opts:{startMeasureUuid:b.startMeasureUuid,startTimePos:b.startTimePos,startDpq:b.startDpq,stopMeasureUuid:b.stopMeasureUuid,stopTimePos:b.stopTimePos,stopDpq:b.stopDpq,type:b.type}}};Adagio.undo.safe.reverseRemoveTempoChange={type:b.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.edit.action.RemoveStaff,b=Adagio.edit.action.AddStaff,c=function(b){return{name:a.NAME,opts:{partUuid:b.partUuid,staffIdx:b.staffIdx}}};Adagio.undo.safe.reverseAddStaff={type:b.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.Utils.clefUtils,b=Adagio.Utils.clone,c=Adagio.edit.action.RemoveStaff,d=Adagio.edit.action.AddStaff,e=function(c){var e=b(c.voicesData),f=a.copy(c.clef);return{name:d.NAME,opts:{partUuid:c.partUuid,staffIdx:c.staffIdx,voicesData:e,clef:f}}};Adagio.undo.safe.reverseRemoveStaff={type:c.NAME,getReverseAction:e}}.call(this),function(){"use strict";var a=Adagio.edit.action.AddRehearsal,b=Adagio.edit.action.RemoveRehearsal,c=function(a){return{name:b.NAME,opts:{measureUuid:a.measureUuid}}};Adagio.undo.safe.reverseAddRehearsal={type:a.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.edit.action.AddRehearsal,b=Adagio.edit.action.RemoveRehearsal,c=function(b){return{name:a.NAME,opts:{measureUuid:b.measureUuid,rehearsal:b.rehearsal,type:b.type}}};Adagio.undo.safe.reverseRemoveRehearsal={type:b.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.edit.action.SetNotesSpacingCoeff,b=function(b){return{name:a.NAME,opts:{coeff:b.previousCoeff}}};Adagio.undo.safe.reverseSetNotesSpacingCoeff={type:a.NAME,getReverseAction:b}}.call(this),function(){"use strict";var a=Adagio.edit.action.SetSystemBreakPolicy,b=Adagio.Utils.systemBreakPolicyUtils,c=function(c){var d=b.copy(c.previousConfig);return{name:a.NAME,opts:{config:d}}};Adagio.undo.safe.reverseSetSystemBreakPolicy={type:a.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.edit.action.SetMeasureNumberingPolicy,b=function(b){return{name:a.NAME,opts:{policy:b.previousPolicy}}};Adagio.undo.safe.reverseSetMeasureNumberingPolicy={type:a.NAME,getReverseAction:b}}.call(this),function(){"use strict";var a=Adagio.edit.action.SetPartGlobalVolume,b=function(b){return{name:a.NAME,opts:{partUuid:b.partUuid,volume:b.previousVolume}}};Adagio.undo.safe.reverseSetPartGlobalVolume={type:a.NAME,getReverseAction:b}}.call(this),function(){"use strict";var a=Adagio.edit.action.SetPartGlobalReverberation,b=function(b){return{name:a.NAME,opts:{partUuid:b.partUuid,reverberation:b.previousReverberation}}};Adagio.undo.safe.reverseSetPartGlobalReverberation={type:a.NAME,getReverseAction:b}}.call(this),function(){"use strict";var a=Adagio.edit.action.AddGraceSlash,b=Adagio.edit.action.RemoveGraceSlash,c=function(a){return{name:b.NAME,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceIdx:a.voiceIdx,timePos:a.timePos,divisions:a.divisions,graceIdx:a.graceIdx}}};Adagio.undo.safe.reverseAddGraceSlash={type:a.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.edit.action.AddGraceSlash,b=Adagio.edit.action.RemoveGraceSlash,c=function(b){return{name:a.NAME,opts:{partUuid:b.partUuid,measureUuid:b.measureUuid,voiceIdx:b.voiceIdx,timePos:b.timePos,divisions:b.divisions,graceIdx:b.graceIdx}}};Adagio.undo.safe.reverseRemoveGraceSlash={type:b.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.Utils.pitchUtils,b=Adagio.edit.action.AddCourtesyAccidental,c=Adagio.edit.action.RemoveCourtesyAccidental,d=function(b){var d={partUuid:b.partUuid,measureUuid:b.measureUuid,voiceIdx:b.voiceIdx,timePos:b.timePos,divisions:b.divisions,pitch:a.copyWithoutAlter(b.pitch),isConcertPitch:!1};return{name:c.NAME,opts:d}};Adagio.undo.safe.reverseAddCourtesyAccidental={type:b.NAME,getReverseAction:d}}.call(this),function(){"use strict";var a=Adagio.Utils.pitchUtils,b=Adagio.edit.action.RemoveCourtesyAccidental,c=Adagio.edit.action.AddCourtesyAccidental,d=function(b){var d={partUuid:b.partUuid,measureUuid:b.measureUuid,voiceIdx:b.voiceIdx,timePos:b.timePos,divisions:b.divisions,pitch:a.copyWithoutAlter(b.pitch),isConcertPitch:!1};return{name:c.NAME,opts:d}};Adagio.undo.safe.reverseRemoveCourtesyAccidental={type:b.NAME,getReverseAction:d}}.call(this),function(){"use strict"
;var a=Adagio.Utils.unpitchedUtils,b=Adagio.edit.action.AddGhostNotePercu,c=Adagio.edit.action.RemoveGhostNotePercu,d=function(b){var d={partUuid:b.partUuid,measureUuid:b.measureUuid,voiceIdx:b.voiceIdx,timePos:b.timePos,divisions:b.divisions,unpitched:a.copy(b.unpitched)};return{name:c.NAME,opts:d}};Adagio.undo.safe.reverseAddGhostNotePercu={type:b.NAME,getReverseAction:d}}.call(this),function(){"use strict";var a=Adagio.Utils.unpitchedUtils,b=Adagio.edit.action.RemoveGhostNotePercu,c=Adagio.edit.action.AddGhostNotePercu,d=function(b){var d={partUuid:b.partUuid,measureUuid:b.measureUuid,voiceIdx:b.voiceIdx,timePos:b.timePos,divisions:b.divisions,unpitched:a.copy(b.unpitched),isConcertPitch:!1};return{name:c.NAME,opts:d}};Adagio.undo.safe.reverseRemoveGhostNotePercu={type:b.NAME,getReverseAction:d}}.call(this),function(){"use strict";var a=Adagio.Utils.pitchUtils,b=Adagio.edit.action.AddGhostNote,c=Adagio.edit.action.RemoveGhostNote,d=function(b){var d={partUuid:b.partUuid,measureUuid:b.measureUuid,voiceIdx:b.voiceIdx,timePos:b.timePos,divisions:b.divisions,pitch:a.copy(b.pitch)};return{name:c.NAME,opts:d}};Adagio.undo.safe.reverseAddGhostNote={type:b.NAME,getReverseAction:d}}.call(this),function(){"use strict";var a=Adagio.Utils.pitchUtils,b=Adagio.edit.action.RemoveGhostNote,c=Adagio.edit.action.AddGhostNote,d=function(b){var d={partUuid:b.partUuid,measureUuid:b.measureUuid,voiceIdx:b.voiceIdx,timePos:b.timePos,divisions:b.divisions,pitch:a.copy(b.pitch),isConcertPitch:!1};return{name:c.NAME,opts:d}};Adagio.undo.safe.reverseRemoveGhostNote={type:b.NAME,getReverseAction:d}}.call(this),function(){"use strict";var a=Adagio.edit.action.RemoveRepeat,b=Adagio.edit.action.AddRepeat,c=function(b){return{name:a.NAME,opts:{measureUuid:b.measureUuid,direction:b.direction}}};Adagio.undo.safe.reverseAddRepeat={type:b.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.edit.action.RemoveRepeat,b=Adagio.edit.action.AddRepeat,c=function(a){return{name:b.NAME,opts:{measureUuid:a.measureUuid,direction:a.direction}}};Adagio.undo.safe.reverseRemoveRepeat={type:a.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.edit.action.RemoveDoubleBarline,b=Adagio.edit.action.AddDoubleBarline,c=function(b){return{name:a.NAME,opts:{measureUuid:b.measureUuid}}};Adagio.undo.safe.reverseAddDoubleBarline={type:b.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.edit.action.RemoveDoubleBarline,b=Adagio.edit.action.AddDoubleBarline,c=function(a){return{name:b.NAME,opts:{measureUuid:a.measureUuid}}};Adagio.undo.safe.reverseRemoveDoubleBarline={type:a.NAME,getReverseAction:c}}.call(this),function(){"use strict";var a=Adagio.Utils.pitchUtils,b=Adagio.edit.action.AddFingering,c=Adagio.edit.action.RemoveFingering,d=function(b){var d={partUuid:b.partUuid,measureUuid:b.measureUuid,voiceIdx:b.voiceIdx,timePos:b.timePos,divisions:b.divisions,pitch:a.copyWithoutAlter(b.pitch),isConcertPitch:!1};return{name:c.NAME,opts:d}};Adagio.undo.safe.reverseAddFingering={type:b.NAME,getReverseAction:d}}.call(this),function(){"use strict";var a=Adagio.Utils.pitchUtils,b=Adagio.edit.action.RemoveFingering,c=Adagio.edit.action.AddFingering,d=function(b){var d={partUuid:b.partUuid,measureUuid:b.measureUuid,voiceIdx:b.voiceIdx,timePos:b.timePos,divisions:b.divisions,pitch:a.copyWithoutAlter(b.pitch),isConcertPitch:!1,fingering:b.fingering};return{name:c.NAME,opts:d}};Adagio.undo.safe.reverseRemoveFingering={type:b.NAME,getReverseAction:d}}.call(this),function(){"use strict";var a=Adagio.Utils.typeUtils,b=Adagio.undo.safe.reverseAddAccidental,c=Adagio.undo.safe.reverseAddNote,d=Adagio.undo.safe.reverseAddTieArc,e=Adagio.undo.safe.reverseChangeDuration,f=Adagio.undo.safe.reverseRemoveNote,g=Adagio.undo.safe.reverseRemoveTieArc,h=Adagio.undo.safe.reverseAddArticulation,i=Adagio.undo.safe.reverseRemoveArticulation,j=Adagio.undo.safe.reverseAddTechnical,k=Adagio.undo.safe.reverseRemoveTechnical,l=Adagio.undo.safe.reverseAddSlur,m=Adagio.undo.safe.reverseRemoveSlur,n=Adagio.undo.safe.reverseAddHarmonyAtTimePos,o=Adagio.undo.safe.reverseRemoveHarmonyAtTimePos,p=Adagio.undo.safe.reverseAddToChordPercu,q=Adagio.undo.safe.reverseRemoveFromChordPercu,r=Adagio.undo.safe.reverseAddSingleNotePercu,s=Adagio.undo.safe.reverseRemoveSingleNotePercu,t=Adagio.undo.safe.reverseChangeHeadPercu,u=Adagio.undo.safe.reverseAddTuplet,v=Adagio.undo.safe.reverseRemoveTuplet,w=Adagio.undo.safe.reverseAddMeasure,x=Adagio.undo.safe.reverseRemoveMeasure,y=Adagio.undo.safe.reverseAddOrnament,z=Adagio.undo.safe.reverseRemoveOrnament,A=Adagio.undo.safe.reverseSetClef,B=Adagio.undo.safe.reverseAddNotation,C=Adagio.undo.safe.reverseRemoveNotation,D=Adagio.undo.safe.reverseSetTimeSignature,E=Adagio.undo.safe.reverseSetKey,F=Adagio.undo.safe.reverseTransposeVoice,G=Adagio.undo.safe.reverseAddLyric,H=Adagio.undo.safe.reverseRemoveLyric,I=Adagio.undo.safe.reverseAddEnding,J=Adagio.undo.safe.reverseRemoveEnding,K=Adagio.undo.safe.reverseInsertRest,L=Adagio.undo.safe.reverseDeleteRest,M=Adagio.undo.safe.reverseAddDynamic,N=Adagio.undo.safe.reverseRemoveDynamic,O=Adagio.undo.safe.reverseRemoveWedge,P=Adagio.undo.safe.reverseAddWedge,Q=Adagio.undo.safe.reverseMovePart,R=Adagio.undo.safe.reverseRemovePart,S=Adagio.undo.safe.reverseAddPart,T=Adagio.undo.safe.reverseAddPartPercu,U=Adagio.undo.safe.reverseChangeInstrument,V=Adagio.undo.safe.reverseChangePartName,W=Adagio.undo.safe.reverseAddArpeggio,X=Adagio.undo.safe.reverseRemoveArpeggio,Y=Adagio.undo.safe.reverseAddJumpTag,Z=Adagio.undo.safe.reverseRemoveJumpTag,$=Adagio.undo.safe.reverseAddJumpCall,_=Adagio.undo.safe.reverseRemoveJumpCall,aa=Adagio.undo.safe.reverseAddToChord,ba=Adagio.undo.safe.reverseRemoveFromChord,ca=Adagio.undo.safe.reverseMoveSlurSide,da=Adagio.undo.safe.reverseSetTempoSegment,ea=Adagio.undo.safe.reverseAddGraceToChord,fa=Adagio.undo.safe.reverseRemoveGraceFromChord,ga=Adagio.undo.safe.reverseInsertGraceNote,ha=Adagio.undo.safe.reverseDeleteGraceNote,ia=Adagio.undo.safe.reverseAddGraceAccidental,ja=Adagio.undo.safe.reverseChangeGraceDuration,ka=Adagio.undo.safe.reverseHideMeasureVoice,la=Adagio.undo.safe.reverseShowMeasureVoice,ma=Adagio.undo.safe.reverseAddVoice,na=Adagio.undo.safe.reverseRemoveVoice,oa=Adagio.undo.safe.reverseAddGlissando,pa=Adagio.undo.safe.reverseRemoveGlissando,qa=Adagio.undo.safe.reverseSetFret,ra=Adagio.undo.safe.reverseSetStaffDetails,sa=Adagio.undo.safe.reverseAddPizzicato,ta=Adagio.undo.safe.reverseRemovePizzicato,ua=Adagio.undo.safe.reverseAddWord,va=Adagio.undo.safe.reverseRemoveWord,wa=Adagio.undo.safe.reverseAddPedal,xa=Adagio.undo.safe.reverseRemovePedal,ya=Adagio.undo.safe.reverseAddOctaveShift,za=Adagio.undo.safe.reverseRemoveOctaveShift,Aa=Adagio.undo.safe.reverseInsertGraceNotePercu,Ba=Adagio.undo.safe.reverseDeleteGraceNotePercu,Ca=Adagio.undo.safe.reverseAddGraceToChordPercu,Da=Adagio.undo.safe.reverseRemoveGraceFromChordPercu,Ea=Adagio.undo.safe.reverseChangeGraceHeadPercu,Fa=Adagio.undo.safe.reverseAddTieArcPercu,Ga=Adagio.undo.safe.reverseRemoveTieArcPercu,Ha=Adagio.undo.safe.reverseAddHammerOnPullOff,Ia=Adagio.undo.safe.reverseRemoveHammerOnPullOff,Ja=Adagio.undo.safe.reverseAddGlissandoSide,Ka=Adagio.undo.safe.reverseRemoveGlissandoSide,La=Adagio.undo.safe.reverseSetSwingSegment,Ma=Adagio.undo.safe.reverseAddTempoChange,Na=Adagio.undo.safe.reverseRemoveTempoChange,Oa=Adagio.undo.safe.reverseRemoveStaff,Pa=Adagio.undo.safe.reverseAddStaff,Qa=Adagio.undo.safe.reverseAddRehearsal,Ra=Adagio.undo.safe.reverseRemoveRehearsal,Sa=Adagio.undo.safe.reverseSetNotesSpacingCoeff,Ta=Adagio.undo.safe.reverseSetSystemBreakPolicy,Ua=Adagio.undo.safe.reverseSetMeasureNumberingPolicy,Va=Adagio.undo.safe.reverseSetPartGlobalVolume,Wa=Adagio.undo.safe.reverseSetPartGlobalReverberation,Xa=Adagio.undo.safe.reverseAddGraceSlash,Ya=Adagio.undo.safe.reverseRemoveGraceSlash,Za=Adagio.undo.safe.reverseAddCourtesyAccidental,$a=Adagio.undo.safe.reverseRemoveCourtesyAccidental,_a=Adagio.undo.safe.reverseAddGhostNotePercu,ab=Adagio.undo.safe.reverseRemoveGhostNotePercu,bb=Adagio.undo.safe.reverseAddGhostNote,cb=Adagio.undo.safe.reverseRemoveGhostNote,db=Adagio.undo.safe.reverseRemoveRepeat,eb=Adagio.undo.safe.reverseAddRepeat,fb=Adagio.undo.safe.reverseRemoveDoubleBarline,gb=Adagio.undo.safe.reverseAddDoubleBarline,hb=Adagio.undo.safe.reverseRemoveFingering,ib=Adagio.undo.safe.reverseAddFingering,jb=a.pairsToMap([{key:b.type,value:b},{key:c.type,value:c},{key:d.type,value:d},{key:e.type,value:e},{key:f.type,value:f},{key:g.type,value:g},{key:h.type,value:h},{key:i.type,value:i},{key:j.type,value:j},{key:k.type,value:k},{key:l.type,value:l},{key:m.type,value:m},{key:n.type,value:n},{key:o.type,value:o},{key:p.type,value:p},{key:q.type,value:q},{key:r.type,value:r},{key:s.type,value:s},{key:t.type,value:t},{key:u.type,value:u},{key:v.type,value:v},{key:x.type,value:x},{key:w.type,value:w},{key:y.type,value:y},{key:z.type,value:z},{key:A.type,value:A},{key:B.type,value:B},{key:C.type,value:C},{key:D.type,value:D},{key:E.type,value:E},{key:F.type,value:F},{key:G.type,value:G},{key:H.type,value:H},{key:I.type,value:I},{key:J.type,value:J},{key:K.type,value:K},{key:L.type,value:L},{key:M.type,value:M},{key:N.type,value:N},{key:O.type,value:O},{key:P.type,value:P},{key:Q.type,value:Q},{key:R.type,value:R},{key:S.type,value:S},{key:T.type,value:T},{key:U.type,value:U},{key:V.type,value:V},{key:W.type,value:W},{key:X.type,value:X},{key:Y.type,value:Y},{key:Z.type,value:Z},{key:$.type,value:$},{key:_.type,value:_},{key:aa.type,value:aa},{key:ba.type,value:ba},{key:ca.type,value:ca},{key:da.type,value:da},{key:ea.type,value:ea},{key:fa.type,value:fa},{key:ga.type,value:ga},{key:ha.type,value:ha},{key:ia.type,value:ia},{key:ja.type,value:ja},{key:ka.type,value:ka},{key:la.type,value:la},{key:na.type,value:na},{key:ma.type,value:ma},{key:oa.type,value:oa},{key:pa.type,value:pa},{key:qa.type,value:qa},{key:ra.type,value:ra},{key:ta.type,value:ta},{key:sa.type,value:sa},{key:va.type,value:va},{key:ua.type,value:ua},{key:wa.type,value:wa},{key:xa.type,value:xa},{key:ya.type,value:ya},{key:za.type,value:za},{key:Aa.type,value:Aa},{key:Ba.type,value:Ba},{key:Ca.type,value:Ca},{key:Da.type,value:Da},{key:Ea.type,value:Ea},{key:Fa.type,value:Fa},{key:Ga.type,value:Ga},{key:Ha.type,value:Ha},{key:Ia.type,value:Ia},{key:Ja.type,value:Ja},{key:Ka.type,value:Ka},{key:La.type,value:La},{key:Ma.type,value:Ma},{key:Na.type,value:Na},{key:Pa.type,value:Pa},{key:Oa.type,value:Oa},{key:Qa.type,value:Qa},{key:Ra.type,value:Ra},{key:Sa.type,value:Sa},{key:Ta.type,value:Ta},{key:Ua.type,value:Ua},{key:Va.type,value:Va},{key:Wa.type,value:Wa},{key:Xa.type,value:Xa},{key:Ya.type,value:Ya},{key:Za.type,value:Za},{key:$a.type,value:$a},{key:_a.type,value:_a},{key:ab.type,value:ab},{key:bb.type,value:bb},{key:cb.type,value:cb},{key:eb.type,value:eb},{key:db.type,value:db},{key:gb.type,value:gb},{key:fb.type,value:fb},{key:ib.type,value:ib},{key:hb.type,value:hb}]),kb=Adagio.undo.safe.revertersList={};kb.canReverseRecord=function(a){return kb.hasReverter(a.type)},kb.hasReverter=function(a){return void 0!==jb[a]},kb.getReverseData=function(a){return kb.getReverter(a.type).getReverseAction(a.opts)},kb.getReverter=function(a){return jb[a]}}.call(this),function(){"use strict";var a=Adagio.Utils.cancelStackUtils,b=Adagio.undo.safe.revertersList;Adagio.undo.safe.getReverseActionData=function(c){var d=a.extractTrueActions(c);d=d.filter(b.canReverseRecord);var e=d.map(b.getReverseData);return e.reverse(),e}}.call(this),function(){"use strict";var a=Adagio.undo.safe.getReverseActionData,b=Adagio.edit.common.CancelStack;Adagio.undo.safe.reverseAction=function(c,d,e){void 0===e&&(e=new b);var f=a(d);e=e.createSubstack("action.undo"),f.forEach(function(a){c[a.name](a.opts,e)})}}.call(this),"undefined"!=typeof module&&module.exports&&(module.exports=Adagio),function(){"use strict";Adagio.assets={}}.call(this),function(){"use strict";Adagio.assets.smufl={}}.call(this);(function(){"use strict";Adagio.assets.smufl.bravura={glyphs:{brace:{alternateCodepoint:"U+1D114",codepoint:"U+E000",description:"Brace",bBoxNE:[.328,3.988],bBoxSW:[.008,0],path:"M145 0q-6 0 -16 12q-100 127 -100 381q0 76 36 212q63 237 17 318q-25 45 -49 67q-24 23 -29 30q49 57 73 103q23 47 23 107t-35 184q-36 124 -36 235q0 256 100 379q12 14 15 14t10 -6q4 0 4 -9t-11 -20q-57 -102 -57 -227q0 -61 39 -237t39 -242t-40 -159t-87 -122 q47 -29 87 -122t40 -159t-39 -241q-39 -174 -39 -240t22 -132t35 -91q10 -12 11 -23q0 -12 -13 -12z"},bracketTop:{codepoint:"U+E003",description:"Bracket top",bBoxNE:[1.876,1.18],bBoxSW:[0,0],path:"M0 0v240q0 14 16 14h207q111 8 219 43q178 58 319 165q87 65 132 113q20 29 51 29q16 -6 16 -24t-2 -25q-106 -442 -702 -555h-256z"},bracketBottom:{codepoint:"U+E004",description:"Bracket bottom",bBoxNE:[1.876,0],bBoxSW:[0,-1.18],path:"M0 -240v240h256q596 -113 702 -555q10 -40 -14 -49q-31 0 -51 29q-34 39 -116 101q-83 62 -155 102t-181 75q-108 35 -218 43h-207q-16 0 -16 14z"},repeatDots:{alternateCodepoint:"U+1D108",codepoint:"U+E043",description:"Repeat dots",bBoxNE:[.4,2.68],bBoxSW:[0,1.272],path:"M0 754q0 42 30 72t71 30q42 0 73 -30t31 -72t-31 -73q-31 -30 -73 -30q-41 0 -71 30t-30 73zM101 1167q-41 0 -71 31t-30 73q0 41 30 71t71 30q42 0 73 -30t31 -72t-31 -72q-31 -31 -73 -31z"},coda:{alternateCodepoint:"U+1D10C",codepoint:"U+E048",description:"Coda",bBoxNE:[3.82,3.592],bBoxSW:[-.016,-.632],path:"M1036 721v-623q183 20 245 209q52 160 56 414h-301zM647 721q0 -300 47 -420q20 -51 51 -97q60 -89 193 -106v623h-291zM647 819h291v606q-114 -9 -168 -59q-30 -28 -52 -54t-41 -101q-30 -113 -30 -392zM1337 819q0 324 -47 432t-132 146q-52 23 -122 28v-606h301z M1919 819q37 0 37 -49t-37 -49h-244q-14 -285 -201 -493t-438 -228v-287q0 -37 -49 -37t-49 37v287q-250 20 -436 228t-203 493h-270q-37 0 -37 49t37 49h270q15 287 201 494t438 227v264q0 35 49 35t49 -35v-264q252 -20 438 -227t201 -494h244z"},gClef:{alternateCodepoint:"U+1D11E",codepoint:"U+E050",description:"G clef",bBoxNE:[2.684,4.392],bBoxSW:[0,-2.632],path:"M881 516q219 0 356 -145t137 -331t-92 -314q-92 -127 -252 -191q-2 -2 -15 -7t-13 -11q0 -7 30 -179q31 -172 31 -273t-30 -178q-31 -77 -73 -120t-113 -78t-185 -36t-194 32q-135 56 -179 192q-18 54 -19 109q0 98 60 167t154 69t148 -60t54 -146q0 -85 -40 -132 q-40 -48 -102 -66t-61 -32q0 -23 43 -41q44 -19 110 -19t114 11t104 44q55 33 87 106t32 177t-55 414q-2 16 -8 19t-46 -5q-38 -8 -119 -8q-182 0 -327 58q-144 58 -234 156q-184 200 -184 489q0 290 229 577q127 156 379 364q16 14 20 22t-1 28q-29 168 -29 335 q0 414 201 637q90 98 133 99q16 0 49 -33t57 -70q133 -195 133 -477q-1 -172 -73 -347t-201 -316q-55 -61 -115 -117q-16 -16 -12 -39l51 -297q3 -29 11 -33t49 -4zM164 41q0 -215 162 -349t428 -134q59 0 99 7t43 11t1 21l-102 610q-5 16 -11 19t-30 -3q-94 -27 -150 -90 t-55 -141q0 -78 41 -138t89 -81t48 -35q0 -23 -24 -23t-56 13q-106 37 -171 132q-64 95 -64 228t81 244t216 155q29 9 31 15t-1 35l-43 262q-4 16 -8 18t-20 -10q-193 -156 -314 -291q-190 -215 -190 -475zM1206 -94q0 133 -88 228t-215 106q-18 2 -22 -4t0 -25l100 -584 q2 -18 8 -20t25 8q88 45 140 121t52 170zM963 1931q-101 0 -187 -145t-86 -371q0 -109 12 -188q6 -35 27 -17q63 55 129 121q227 227 227 432q0 82 -34 125q-35 43 -88 43z"},gClef15mb:{codepoint:"U+E051",description:"G clef quindicesima bassa",bBoxNE:[2.684,4.392],bBoxSW:[0,-3.524],path:"M881 516q219 0 356 -145t137 -331t-92 -314q-92 -127 -252 -191q-2 -2 -15 -7t-13 -11q0 -7 30 -179q31 -172 31 -276q0 -184 -87 -277t-212 -120q34 -8 78 -8q48 0 78 10t39 10t9 -12t-18 -27q-76 -72 -170 -72q-20 0 -44 3t-27 -9l-19 -57q-4 -10 0 -14t22 2t54 6 q133 0 133 -103q0 -88 -57 -143t-132 -55t-109 28t-34 64q-1 37 17 57t45 21q49 0 49 -43t-33 -58q-16 -6 -16 -14q0 -23 51 -23t84 54t33 114q0 59 -58 60q-39 0 -75 -37q-14 -14 -25 -14q-20 0 -21 20q0 4 7 23l69 204v2q-12 -2 -35 -2t-63 5l-2 -5v-4l-123 -387 q-4 -16 4 -16l43 -4q18 -2 19 -19q0 -16 -21 -16h-211q-20 0 -20 16t18 19l43 4q10 0 16 12l87 270q2 7 2 15q1 8 -7 8t-16 -12l-47 -51q-8 -12 -23 -13q-20 0 -20 19q0 6 10 20l135 152q6 10 15 10q-121 39 -174 128q-54 89 -54 185t60 165t154 69t148 -60t54 -146 q0 -85 -40 -132q-40 -48 -102 -66t-61 -32q0 -23 43 -41q44 -19 110 -19t114 11t104 44q55 33 87 106t32 177t-55 414q-2 16 -8 19t-46 -5q-38 -8 -119 -8q-182 0 -327 58q-144 58 -234 156q-184 200 -184 489q0 290 229 577q127 156 379 364q16 14 20 22t-1 28 q-29 168 -29 335q0 414 201 637q90 98 133 99q16 0 49 -33t57 -70q133 -195 133 -477q-1 -172 -73 -347t-201 -316q-55 -61 -115 -117q-16 -16 -12 -39l51 -297q3 -29 11 -33t49 -4zM164 41q0 -215 162 -349t428 -134q59 0 99 7t43 11t1 21l-102 610q-5 16 -11 19t-30 -3 q-94 -27 -150 -90t-55 -141q0 -78 41 -138t89 -81t48 -35q0 -23 -24 -23t-56 13q-106 37 -171 132q-64 95 -64 228t81 244t216 155q29 9 31 15t-1 35l-43 262q-4 16 -8 18t-20 -10q-193 -156 -314 -291q-190 -215 -190 -475zM963 1931q-101 0 -187 -145t-86 -371 q0 -109 12 -188q6 -35 27 -17q63 55 129 121q227 227 227 432q0 82 -34 125q-35 43 -88 43zM1206 -94q0 133 -88 228t-215 106q-18 2 -22 -4t0 -25l100 -584q2 -18 8 -20t25 8q88 45 140 121t52 170z"},gClef8vb:{alternateCodepoint:"U+1D120",codepoint:"U+E052",description:"G clef ottava bassa",bBoxNE:[2.684,4.392],bBoxSW:[0,-3.512],path:"M881 516q219 0 356 -145t137 -331t-92 -314q-92 -127 -252 -191q-2 -2 -15 -7t-13 -11q0 -7 30 -179q31 -172 31 -276q0 -307 -264 -389q63 -27 63 -95t-76 -108q-22 -11 -16 -19q2 -3 10 -14q33 -35 33 -97t-53 -100t-133 -38t-120 34t-40 87q0 84 92 121q27 9 6 34 t-20 70q0 72 57 106q-176 16 -254 116t-78 206q0 108 60 177t154 69t148 -60t54 -146q0 -85 -40 -132q-40 -48 -102 -66t-61 -32q0 -23 43 -41q44 -19 110 -19t114 11t104 44q55 33 87 106t32 177t-55 414q-2 16 -8 19t-46 -5q-38 -8 -119 -8q-182 0 -327 58 q-144 58 -234 156q-184 200 -184 489q0 290 229 577q127 156 379 364q16 14 20 22t-1 28q-29 168 -29 335q0 414 201 637q90 98 133 99q16 0 49 -33t57 -70q133 -195 133 -477q-1 -172 -73 -347t-201 -316q-55 -61 -115 -117q-16 -16 -12 -39l51 -297q3 -29 11 -33t49 -4z M164 41q0 -215 162 -349t428 -134q59 0 99 7t43 11t1 21l-102 610q-5 16 -11 19t-30 -3q-94 -27 -150 -90t-55 -141q0 -78 41 -138t89 -81t48 -35q0 -23 -24 -23t-56 13q-106 37 -171 132q-64 95 -64 228t81 244t216 155q29 9 31 15t-1 35l-43 262q-4 16 -8 18t-20 -10 q-193 -156 -314 -291q-190 -215 -190 -475zM963 1931q-101 0 -187 -145t-86 -371q0 -109 12 -188q6 -35 27 -17q63 55 129 121q227 227 227 432q0 82 -34 125q-35 43 -88 43zM1206 -94q0 133 -88 228t-215 106q-18 2 -22 -4t0 -25l100 -584q2 -18 8 -20t25 8q88 45 140 121 t52 170zM547 -1690q0 -34 19 -56q18 -22 60 -22t66 22t25 52t-15 47q-16 16 -67 58q-19 14 -31 6q-57 -35 -57 -107zM719 -1346q-35 0 -57 -19t-21 -53q0 -34 64 -83q20 -12 30 -4q49 35 49 94q1 65 -65 65z"},gClef8va:{alternateCodepoint:"U+1D11F",codepoint:"U+E053",description:"G clef ottava alta",bBoxNE:[2.684,5.28],bBoxSW:[0,-2.632],path:"M881 516q219 0 356 -145t137 -331t-92 -314q-92 -127 -252 -191q-2 -2 -15 -7t-13 -11q0 -7 30 -179q31 -172 31 -273t-30 -178q-31 -77 -73 -120t-113 -78t-185 -36t-194 32q-135 56 -179 192q-18 54 -19 109q0 98 60 167t154 69t148 -60t54 -146q0 -85 -40 -132 q-40 -48 -102 -66t-61 -32q0 -23 43 -41q44 -19 110 -19t114 11t104 44q55 33 87 106t32 177t-55 414q-2 16 -8 19t-46 -5q-38 -8 -119 -8q-182 0 -327 58q-144 58 -234 156q-184 200 -184 489q0 290 229 577q127 156 379 364q16 14 20 22t-1 28q-29 168 -29 335 q0 414 201 637q41 45 80 72q-103 23 -103 112t92 126q27 9 6 34q-20 24 -20 80t48 92t124 37t111 -29t34 -77q0 -70 -75 -109q-22 -11 -17 -20q2 -4 11 -14q32 -32 32 -90t-42 -96t-105 -48q37 -33 63 -74q133 -195 133 -477q-1 -172 -73 -347t-201 -316q-55 -61 -115 -117 q-16 -16 -12 -39l51 -297q3 -29 11 -33t49 -4zM164 41q0 -215 162 -349t428 -134q59 0 99 7t43 11t1 21l-102 610q-5 16 -11 19t-30 -3q-94 -27 -150 -90t-55 -141q0 -78 41 -138t89 -81t48 -35q0 -23 -24 -23t-56 13q-106 37 -171 132q-64 95 -64 228t81 244t216 155 q29 9 31 15t-1 35l-43 262q-4 16 -8 18t-20 -10q-193 -156 -314 -291q-190 -215 -190 -475zM963 1931q-101 0 -187 -145t-86 -371q0 -109 12 -188q6 -35 27 -17q63 55 129 121q227 227 227 432q0 82 -34 125q-35 43 -88 43zM1206 -94q0 133 -88 228t-215 106q-18 2 -22 -4 t0 -25l100 -584q2 -18 8 -20t25 8q88 45 140 121t52 170zM938 2249q40 1 64 23t24 52t-15 46t-49 44t-49 19q-57 -35 -57 -107t72 -77h10zM1028 2673q-34 1 -56 -19t-22 -55t64 -82q18 -14 30 -4q50 33 50 97t-66 63z"},gClef15ma:{codepoint:"U+E054",description:"G clef quindicesima alta",bBoxNE:[2.684,5.276],bBoxSW:[0,-2.632],path:"M881 516q219 0 356 -145t137 -331t-92 -314q-92 -127 -252 -191q-2 -2 -15 -7t-13 -11q0 -7 30 -179q31 -172 31 -273t-30 -178q-31 -77 -73 -120t-113 -78t-185 -36t-194 32q-135 56 -179 192q-18 54 -19 109q0 98 60 167t154 69t148 -60t54 -146q0 -85 -40 -132 q-40 -48 -102 -66t-61 -32q0 -23 43 -41q44 -19 110 -19t114 11t104 44q55 33 87 106t32 177t-55 414q-2 16 -8 19t-46 -5q-38 -8 -119 -8q-182 0 -327 58q-144 58 -234 156q-184 200 -184 489q0 290 229 577q127 156 379 364q16 14 20 22t-1 28q-29 168 -29 335 q0 414 201 637q90 98 133 99q16 0 49 -33t57 -70q133 -195 133 -477q-1 -172 -73 -347t-201 -316q-55 -61 -115 -117q-16 -16 -12 -39l51 -297q3 -29 11 -33t49 -4zM164 41q0 -215 162 -349t428 -134q59 0 99 7t43 11t1 21l-102 610q-5 16 -11 19t-30 -3q-94 -27 -150 -90 t-55 -141q0 -78 41 -138t89 -81t48 -35q0 -23 -24 -23t-56 13q-106 37 -171 132q-64 95 -64 228t81 244t216 155q29 9 31 15t-1 35l-43 262q-4 16 -8 18t-20 -10q-193 -156 -314 -291q-190 -215 -190 -475zM1206 -94q0 133 -88 228t-215 106q-18 2 -22 -4t0 -25l100 -584 q2 -18 8 -20t25 8q88 45 140 121t52 170zM963 1931q-101 0 -187 -145t-86 -371q0 -109 12 -188q6 -35 27 -17q63 55 129 121q227 227 227 432q0 82 -34 125q-35 43 -88 43zM1189 2681q48 0 93 10q27 10 35 10t8 -11t-18 -30q-78 -70 -170 -69q-20 0 -44 3t-28 -9l-18 -58 q-4 -10 0 -14q5 -4 27 2t48 6q133 0 133 -104q0 -87 -57 -143q-56 -56 -132 -56t-110 29q-32 29 -32 65t17 57q17 22 44 21q49 0 49 -47q0 -39 -33 -53q-16 -10 -16 -17q0 -23 51 -23t84 55q33 54 33 115t-57 60q-43 0 -76 -39q-14 -12 -25 -12q-20 0 -20 18q0 7 6 25 l70 203q6 23 26 22q10 0 37 -8t75 -8zM952 2689q0 -10 -2 -16l-123 -387q-4 -16 4 -19l43 -4q18 0 19 -16q0 -18 -21 -19h-210q-20 0 -21 19q0 16 18 16l43 4q12 2 17 14l86 269q2 6 2 14t-7 8t-16 -10l-47 -51q-10 -14 -22 -14q-20 0 -21 18q1 8 11 22l135 152q10 10 18 10 l39 -12l43 12q12 0 12 -10z"},cClef:{alternateCodepoint:"U+1D121",codepoint:"U+E05C",description:"C clef",bBoxNE:[2.796,2.024],bBoxSW:[0,-2.024],path:"M471 987v-897q0 -16 18 -12q133 37 183 299q10 51 38 51t48 -70t68 -124q48 -52 146 -52t134 94q37 94 37 304t-47 301q-47 90 -170 90q-66 -1 -120 -17t-54 -39q0 -10 55 -30q82 -29 82 -133q0 -66 -39 -104q-38 -38 -104 -38t-110 45t-44 123q0 106 92 182t264 76 q232 0 358 -135t126 -331t-114 -329q-114 -132 -314 -132q-66 0 -115 15t-71 1t-48 -55t-25 -70q0 -29 26 -70t47 -55q20 -14 70 1t116 15q200 0 314 -132q114 -133 114 -329t-125 -331t-359 -135q-172 0 -264 76t-92 182q0 78 44 123t110 45t104 -38q39 -38 39 -104 q0 -104 -82 -133q-55 -20 -55 -30q0 -23 54 -39t120 -17q123 0 170 90t47 300q0 211 -37 305t-134 94q-98 0 -146 -52t-68 -123t-48 -71t-38 51q-49 262 -183 299q-18 4 -18 -12v-897q0 -43 -43 -43h-2q-43 0 -43 43v1974q0 43 43 43h2q43 0 43 -43zM43 1030h176 q43 0 43 -43v-1974q0 -43 -43 -43h-176q-43 0 -43 43v1974q0 43 43 43z"},cClef8vb:{codepoint:"U+E05D",description:"C clef ottava bassa",bBoxNE:[2.796,2.024],bBoxSW:[0,-2.964],path:"M471 987v-897q0 -16 18 -12q133 37 183 299q10 51 38 51t48 -70t68 -124q48 -52 146 -52t134 94q37 94 37 304t-47 301q-47 90 -170 90q-66 -1 -120 -17t-54 -39q0 -10 55 -30q82 -29 82 -133q0 -66 -39 -104q-38 -38 -104 -38t-110 45t-44 123q0 106 92 182t264 76 q232 0 358 -135t126 -331t-114 -329q-114 -132 -314 -132q-66 0 -115 15t-71 1t-48 -55t-25 -70q0 -29 26 -70t47 -55q20 -14 70 1t116 15q200 0 314 -132q114 -133 114 -329t-125 -331t-359 -135q-172 0 -264 76t-92 182q0 78 44 123t110 45t104 -38q39 -38 39 -104 q0 -104 -82 -133q-55 -20 -55 -30q0 -23 54 -39t120 -17q123 0 170 90t47 300q0 211 -37 305t-134 94q-98 0 -146 -52t-68 -123t-48 -71t-38 51q-49 262 -183 299q-18 4 -18 -12v-897q0 -43 -43 -43h-2q-43 0 -43 43v1974q0 43 43 43h2q43 0 43 -43zM43 1030h176 q43 0 43 -43v-1974q0 -43 -43 -43h-176q-43 0 -43 43v1974q0 43 43 43zM713 -1034q141 0 141 -107q0 -70 -76 -108q-22 -11 -16 -20q2 -3 10 -13q33 -34 33 -96t-53 -101q-54 -39 -134 -39t-120 34t-39 87q0 84 92 121q25 8 5 34t-20 80t49 91q48 37 128 37zM539 -1409 q0 -33 19 -55q18 -22 60 -23q42 0 66 22q24 23 25 53t-15 46t-67 57q-19 14 -31 6q-57 -35 -57 -106zM711 -1065q-35 0 -57 -19q-22 -20 -22 -54t64 -83q20 -12 31 -4q49 35 49 95q1 65 -65 65z"},fClef:{alternateCodepoint:"U+1D122",codepoint:"U+E062",description:"F clef",bBoxNE:[2.736,1.048],bBoxSW:[-.02,-2.54],path:"M1288 369q47 0 80 -33t33 -80t-33 -80t-80 -33t-80 33t-32 80q0 47 32 80q33 33 80 33zM1290 -145q47 0 79 -32t32 -79t-32 -79t-79 -32t-79 32t-31 79q0 47 31 79q32 32 79 32zM516 537q264 0 418 -162t153 -432q0 -403 -274 -699t-762 -534q-20 -10 -35 -10 q-27 0 -26 24q0 20 30 37q410 236 585 506t175 657q0 252 -77 393t-227 141t-244 -78q-94 -79 -95 -153q0 -37 33 -37q10 0 41 8t61 7q80 1 138 -59t59 -155q0 -95 -60 -155t-168 -61q-109 0 -175 88t-66 233t124 286q60 69 162 112t230 43z"},fClef15mb:{codepoint:"U+E063",description:"F clef quindicesima bassa",bBoxNE:[2.736,1.048],bBoxSW:[-.02,-2.968],path:"M561 -1048q0 -10 -2 -17l-123 -387q-4 -16 4 -18l43 -5q18 0 19 -16q0 -18 -21 -18h-211q-20 0 -20 17t18 17l43 5q12 2 17 14l86 268q2 6 2 14t-6 9q-8 0 -17 -11l-47 -51q-10 -14 -26 -14q-16 -1 -16 13t9 28l97 110q-133 -88 -359 -200q-20 -10 -35 -10q-27 0 -26 24 q0 20 30 37q410 236 585 506t175 657q0 252 -77 393t-227 141t-244 -78q-94 -79 -95 -153q0 -37 33 -37q10 0 41 8t61 7q80 1 138 -59t59 -155q0 -95 -60 -155t-168 -61q-109 0 -175 88t-66 233t124 286q60 69 162 112t230 43q264 0 418 -162t153 -432q0 -403 -284 -711 q-135 -143 -320 -274q16 -9 23 -9l43 13q12 0 12 -10zM686 -1040q10 0 37 -8t75 -9q48 0 93 10q27 11 35 11t8 -12t-19 -29q-78 -70 -170 -70q-19 0 -43 3t-28 -9l-19 -57q-4 -10 0 -14t27 1q23 6 49 6q133 0 133 -104q0 -88 -57 -143q-57 -56 -133 -56t-109 29t-33 65 t18 58t44 20q49 0 49 -47q0 -39 -33 -53q-16 -10 -16 -16q0 -23 51 -23t84 54t33 115t-57 61q-43 0 -76 -39q-13 -12 -29 -12t-16 18q0 6 6 24l69 203q6 23 27 23zM1288 369q47 0 80 -33t33 -80t-33 -80t-80 -33t-80 33t-32 80q0 47 32 80q33 33 80 33zM1290 -145 q47 0 79 -32t32 -79t-32 -79t-79 -32t-79 32t-31 79q0 47 31 79q32 32 79 32z"},fClef8vb:{alternateCodepoint:"U+1D124",codepoint:"U+E064",description:"F clef ottava bassa",bBoxNE:[2.736,1.048],bBoxSW:[-.02,-2.976],path:"M553 -1069q-35 1 -57 -19t-21 -55q0 -35 64 -82q18 -14 30 -4q49 33 49 92q1 68 -65 68zM381 -1413q0 -33 19 -57q18 -24 60 -23q42 0 66 23q24 22 25 52q0 30 -15 46t-67 57q-17 14 -31 6q-57 -35 -57 -104zM566 -1038q62 0 96 -30q35 -30 34 -77q0 -70 -75 -108 q-22 -11 -17 -21q2 -4 10 -14q33 -34 33 -96t-54 -101t-133 -39t-119 34t-40 87q0 84 92 121q27 9 6 34q-21 24 -21 72t32 84q-172 -109 -359 -198q-20 -10 -35 -10q-27 0 -26 24q0 20 30 37q410 236 585 506t175 657q0 252 -77 393t-227 141t-244 -78q-94 -79 -95 -153 q0 -37 33 -37q10 0 41 8t61 7q80 1 138 -59t59 -155q0 -95 -60 -155t-168 -61q-109 0 -175 88t-66 233t124 286q60 69 162 112t230 43q264 0 418 -162t153 -432q0 -403 -284 -711q-139 -152 -334 -285q35 15 97 15zM1288 369q47 0 80 -33t33 -80t-33 -80t-80 -33t-80 33 t-32 80q0 47 32 80q33 33 80 33zM1290 -145q47 0 79 -32t32 -79t-32 -79t-79 -32t-79 32t-31 79q0 47 31 79q32 32 79 32z"},fClef8va:{alternateCodepoint:"U+1D123",codepoint:"U+E065",description:"F clef ottava alta",bBoxNE:[2.736,1.98],bBoxSW:[-.02,-2.54],path:"M647 983q-35 0 -57 -19q-22 -18 -21 -54q0 -36 64 -83q18 -14 31 -4q49 33 49 92q0 68 -66 68zM475 639q-1 -33 19 -57t61 -23q41 0 66 23q25 22 25 52t-16 46q-15 16 -67 57q-17 14 -31 6q-57 -35 -57 -104zM645 1014q76 0 111 -30t35 -77q0 -70 -76 -108 q-22 -11 -17 -21q2 -4 11 -14q33 -33 33 -90t-41 -95q-40 -38 -101 -49q227 -26 357 -184t130 -403q0 -403 -274 -699t-762 -534q-20 -10 -35 -10q-27 0 -26 24q0 20 30 37q410 236 585 506t175 657q0 252 -77 393t-227 141t-244 -78q-94 -79 -95 -153q0 -37 33 -37 q10 0 41 8t61 7q80 1 138 -59t59 -155q0 -95 -60 -155t-168 -61q-109 0 -175 88t-66 217q0 164 127 305t360 152q-92 25 -92 111t92 122q26 9 11 31q-25 27 -25 83t48 93t124 37zM1288 369q47 0 80 -33t33 -80t-33 -80t-80 -33t-80 33t-32 80q0 47 32 80q33 33 80 33z M1290 -145q47 0 79 -32t32 -79t-32 -79t-79 -32t-79 32t-31 79q0 47 31 79q32 32 79 32z"},fClef15ma:{codepoint:"U+E066",description:"F clef quindicesima alta",bBoxNE:[2.736,1.984],bBoxSW:[-.02,-2.54],path:"M516 537q264 0 418 -162t153 -432q0 -403 -274 -699t-762 -534q-20 -10 -35 -10q-27 0 -26 24q0 20 30 37q410 236 585 506t175 657q0 252 -77 393t-227 141t-244 -78q-94 -79 -95 -153q0 -37 33 -37q10 0 41 8t61 7q80 1 138 -59t59 -155q0 -95 -60 -155t-168 -61 q-109 0 -175 88t-66 233t124 286q60 69 162 112t230 43zM1290 -145q47 0 79 -32t32 -79t-32 -79t-79 -32t-79 32t-31 79q0 47 31 79q32 32 79 32zM1288 369q47 0 80 -33t33 -80t-33 -80t-80 -33t-80 33t-32 80q0 47 32 80q33 33 80 33zM692 1012q10 0 37 -8q72 -21 168 2 q27 10 35 10t8 -11t-18 -30q-78 -70 -170 -70q-20 0 -44 3t-28 -9l-18 -57q-4 -10 0 -14t26 1q22 6 49 7q133 0 133 -105q0 -88 -57 -143q-57 -56 -133 -56t-109 29t-33 65t18 58q17 22 44 21q49 0 49 -48q0 -39 -33 -53q-16 -10 -16 -16q0 -23 51 -23q51 1 84 55t33 114 t-57 61q-43 0 -76 -39q-16 -12 -25 -13q-20 0 -20 19q0 6 6 24l70 203q6 23 26 23zM567 1004q0 -10 -2 -17l-123 -387q-4 -16 4 -18l43 -4q18 0 19 -17q0 -18 -21 -18h-211q-20 0 -20 17t18 18l43 4q12 2 17 14l86 268q2 6 2 14t-7 9q-7 0 -16 -10l-47 -52q-10 -14 -26 -14 q-16 -1 -16 13t9 28l136 152q10 10 18 10l39 -13l43 13q12 0 12 -10z"},unpitchedPercussionClef1:{alternateCodepoint:"U+1D125",codepoint:"U+E069",description:"Unpitched percussion clef 1",bBoxNE:[1.528,1],bBoxSW:[0,-1],path:"M782 481v-962q0 -31 -28 -31h-271q-29 0 -28 31v962q0 31 28 31h271q28 0 28 -31zM328 -481q0 -31 -29 -31h-270q-29 0 -29 31v962q0 31 29 31h270q29 0 29 -31v-962z"},timeSig0:{codepoint:"U+E080",description:"Time signature 0",bBoxNE:[1.72,1.004],bBoxSW:[0,-1],path:"M440 451q-63 0 -108 -127q-45 -126 -45 -308t45 -309t108 -127t109 127q45 127 45 307t-46 308t-108 129zM881 0q0 -212 -129 -362q-130 -150 -312 -150t-311 150t-129 362t129 364q129 150 311 150t312 -150q129 -151 129 -364z"},timeSig1:{codepoint:"U+E081",description:"Time signature 1",bBoxNE:[1.172,1.004],bBoxSW:[-.004,-1],path:"M504 -377q0 -25 22 -49t46 -23q26 0 26 -22l2 -8q0 -33 -33 -33h-436q-45 0 -45 32t35 32t63 22q28 23 27 55v529q0 29 -12 28q-8 0 -21 -20l-110 -180q-8 -18 -20 -18q-52 -2 -50 32l8 27l197 448q16 39 37 39l4 -2h6q45 -6 106 -6l107 8q41 -2 41 -47v-844z"},timeSig2:{codepoint:"U+E082",description:"Time signature 2",bBoxNE:[1.656,1.016],bBoxSW:[.032,-1.028],path:"M551 272q0 197 -184 197q-80 0 -119 -25t-43 -53q0 -13 35 -31q34 -18 70 -52t36 -78t-8 -80t-43 -72q-35 -37 -90 -37t-101 32q-45 32 -69 81q-18 47 -19 88q0 78 68 160t182 104q61 14 136 14t120 -6t115 -30q211 -72 211 -275q0 -196 -238 -259q-94 -26 -182 -68 t-117 -89q35 12 76 12q98 0 221 -49q9 -5 47 -16q39 -12 59 -12q38 0 70 88l2 2v4q6 20 27 20q25 1 25 -28q-28 -249 -153 -302q-56 -24 -130 -24q-109 0 -223 83q-37 28 -79 28q-71 0 -139 -94q-24 -31 -37 -31t-20 4q-37 23 -37 63q45 195 230 314q137 84 219 192t82 225z "},timeSig3:{codepoint:"U+E083",description:"Time signature 3",bBoxNE:[1.54,.996],bBoxSW:[.016,-1.004],path:"M549 40q0 -11 3 -16t19 -10l68 -18l43 -25q31 -18 49 -43q50 -58 57 -143v-14q0 -129 -124 -207t-287 -78h-19q-344 6 -350 225q0 86 45 125q50 55 107 55q57 1 96 -23q64 -38 66 -124q-2 -31 -25 -73t-23 -62v-10q2 -27 58 -33h8q6 -2 32 -2t62 31q70 59 72 210 q0 40 -38 102q-22 37 -78 61t-122 24t-67 24q0 31 49 35q110 7 180 59t70 158v15q0 49 -24 87q-43 70 -167 70q-20 0 -52 -14t-34 -37v-8q0 -23 27 -27l14 -2l21 -6q40 -13 47 -78v-16q0 -55 -36 -94t-99 -39h-11q-86 6 -126 55t-40 111q0 81 111 153t242 72l30 -2 q89 -4 176 -43q168 -76 167 -207t-125 -186q-4 -2 -64 -19q-8 -2 -8 -13z"},timeSig4:{codepoint:"U+E084",description:"Time signature 4",bBoxNE:[1.728,1.004],bBoxSW:[.008,-1],path:"M426 -152v172q0 25 18 48l195 235q16 18 41 19q25 0 25 -35v-439h149q31 0 31 -38t-31 -39h-149v-121q0 -42 20 -60t43 -18q45 0 45 -42t-41 -42h-436q-39 0 -39 41t47 41q82 0 82 72v129h-381q-41 0 -41 34q0 17 4 22t4 7l13 16q262 367 262 625q0 39 47 39l145 -4 l139 4q31 0 31 -29q-4 -22 -92 -146t-211 -276t-196 -215h276z"},timeSig5:{codepoint:"U+E085",description:"Time signature 5",bBoxNE:[1.452,.984],bBoxSW:[0,-1.004],
path:"M359 262q-103 0 -195 19h-8q-27 0 -31 -27l-10 -133v-8q0 -14 8 -15q6 0 10 2q100 59 273 60q139 0 238 -100t99 -240q0 -142 -101 -238q-102 -96 -284 -96t-270 62t-88 192q0 88 44 138t115 50t117 -46t48 -124q0 -78 -78 -127q-47 -26 0 -57q14 -6 57 -6t85 33 q79 62 79 217q0 154 -68 212t-145 58t-151 -83q-7 -9 -12 -17t-19 -8q-41 0 -41 30v4l22 455q4 35 49 35q174 -20 277 -21l252 19q29 0 29 -33q-1 -58 -39 -119q-25 -40 -92 -64t-170 -24z"},timeSig6:{codepoint:"U+E086",description:"Time signature 6",bBoxNE:[1.572,1.004],bBoxSW:[-.004,-.996],path:"M412 4q-49 0 -84 -68t-35 -161q0 -94 35 -162t84 -68t85 68t35 162q0 94 -35 162q-36 67 -85 67zM418 -510q-98 0 -164 29q-111 49 -193 196q-59 109 -63 283v8q0 139 80 291q53 103 154 159t210 57t165 -21q138 -55 138 -166q0 -49 -40 -103t-111 -53q-70 0 -113 43 q-31 35 -31 76t10 57q9 16 33 44t23 44q0 31 -67 31q-164 0 -170 -389q0 -49 18 -49q8 0 12 4q83 71 183 71t186 -63q113 -84 125 -205l2 -29q0 -147 -119 -241q-92 -74 -268 -74z"},timeSig7:{codepoint:"U+E087",description:"Time signature 7",bBoxNE:[1.604,.996],bBoxSW:[0,-1],path:"M483 125q-53 0 -153 77t-132 77t-54 -12t-44 -52q-22 -39 -41 -93t-36 -54t-23 24v346q0 25 18 25t27 -14q9 -17 25 -33t34 -15t57 42q39 42 79 54q39 13 102 13q64 0 132 -44t112 -87q46 -43 66 -43q36 0 74 96q15 41 20 49t21 13q17 6 19 6q25 0 30 -18t5 -64v-8 q0 -84 -60 -226q-59 -142 -121 -308q-62 -167 -62 -312q0 -76 -33 -76l-168 18l-133 -18q-27 0 -33 13t-6 60t40 129t94 143q54 62 130 136t117 119t41 70q-5 18 -13 18t-20 -8q-57 -43 -111 -43z"},timeSig8:{codepoint:"U+E088",description:"Time signature 8",bBoxNE:[1.56,1.036],bBoxSW:[-.024,-1.036],path:"M633 295q0 67 -49 109q-78 68 -172 67q-94 0 -160 -35t-66 -92t30 -83q55 -49 100 -67q46 -18 70 -26t68 -24t70 -23q109 63 109 174zM362 -463q104 0 154 43q51 43 51 106q-1 63 -27 91q-26 29 -42 43q-31 28 -232 112q-70 -28 -116 -80t-46 -112q0 -96 77 -150t181 -53 zM799 -166q0 -190 -124 -277t-294 -87t-282 66t-111 194q0 158 188 247q-178 100 -178 273q0 129 110 205t289 75q76 0 170 -32q187 -63 187 -205q0 -141 -123 -219q168 -86 168 -240z"},timeSig9:{codepoint:"U+E089",description:"Time signature 9",bBoxNE:[1.576,1],bBoxSW:[0,-1],path:"M393 -2q49 0 84 68t35 162t-35 161q-35 68 -84 68t-85 -68t-36 -162q0 -93 36 -161t85 -68zM387 512q98 0 164 -29q111 -49 192 -196q59 -109 64 -283v-8q0 -139 -80 -291q-53 -103 -155 -159t-210 -57t-164 21q-138 55 -139 166q0 52 33 94t73 53t56 11q55 0 103 -43 q30 -33 30 -76t-9 -59t-33 -44t-23 -44q0 -31 67 -31q164 0 170 389v11q0 41 -18 40q-8 0 -12 -4q-82 -71 -182 -71t-187 63q-113 84 -125 203l-2 29q0 147 119 241q92 74 268 74z"},timeSigCommon:{alternateCodepoint:"U+1D134",codepoint:"U+E08A",description:"Common time",bBoxNE:[1.696,1.004],bBoxSW:[.02,-.996],path:"M512 186q0 66 36 115t93 49q37 0 37 45q0 32 -65 57q-36 13 -84 13q-48 1 -90 -17q-177 -74 -177 -391q0 -500 254 -499q70 0 169 63q52 33 87 101t35 161q0 29 10 33t21 4q30 0 30 -35q-1 -78 -35 -154q-35 -75 -76 -123q-42 -48 -121 -83t-179 -35q-201 0 -324 149 t-123 323t74 314t205 197q92 41 200 41t226 -74q45 -29 78 -86t33 -133t-40 -120q-39 -44 -77 -50l-39 -6q-55 0 -107 38q-51 37 -51 103z"},timeSigCutCommon:{alternateCodepoint:"U+1D135",codepoint:"U+E08B",description:"Cut time",bBoxNE:[1.672,1.444],bBoxSW:[0,-1.436],path:"M815 -82h8q31 0 32 -33q2 -72 -33 -150q-36 -77 -77 -124t-117 -83t-175 -38q-23 -10 -23 -29v-161q0 -35 -37 -35q-12 0 -23 10t-12 25v157q0 11 -13 29t-26 22q-109 29 -184 119q-135 158 -135 353q0 156 74 294t205 197l55 21q4 0 14 11t10 21v181q0 12 12 23t25 11 q15 0 25 -11t10 -23v-150q0 -9 7 -27t16 -20h10l2 2q73 0 186 -44q68 -26 115 -90t47 -149q0 -84 -39 -128t-78 -50l-39 -6q-55 0 -106 37q-51 36 -51 102t36 115t93 49q37 0 37 39t-52 57q-76 27 -133 17q-10 -1 -30 -21t-21 -30v-811q0 -27 23 -32t49 -5q111 0 209 96 q35 35 59 94q25 59 25 133q0 35 20 35zM358 -334v674q0 12 -11 27t-17 2q-78 -111 -78 -316q0 -287 84 -405q4 -6 10 -6q12 -1 12 24z"},noteheadWhole:{codepoint:"U+E0A2",description:"Whole (semibreve) notehead",bBoxNE:[1.688,.5],bBoxSW:[0,-.5],path:"M221 80q0 -100 72 -182q16 -24 52 -54q63 -54 140 -53q133 0 154 107q4 25 4 39q0 98 -76 186t-178 88q-135 0 -162 -82q-6 -25 -6 -49zM0 1q0 109 122 182t296 73q176 0 311 -74t135 -178q0 -260 -442 -260q-215 0 -319 74q-103 74 -103 183z"},noteheadHalf:{alternateCodepoint:"U+1D157",codepoint:"U+E0A3",description:"Half (minim) notehead",bBoxNE:[1.18,.5],bBoxSW:[0,-.5],splitStemDownNE:[.956,-.3],splitStemDownNW:[.128,-.428],splitStemUpSE:[1.108,.372],splitStemUpSW:[.328,.38],stemDownNW:[0,-.168],stemUpSE:[1.18,.168],path:"M541 80q0 24 -19 58t-79 34t-197 -80q-186 -109 -187 -182q0 -16 13 -41q27 -47 92 -47t190 84q187 122 187 174zM393 256q99 0 155 -46t56 -126t-74 -192q-40 -62 -128 -105q-86 -43 -188 -43t-159 45q-55 45 -55 132t86 203q43 56 126 94t181 38z"},noteheadBlack:{alternateCodepoint:"U+1D158",codepoint:"U+E0A4",description:"Black notehead",bBoxNE:[1.18,.5],bBoxSW:[0,-.5],splitStemDownNE:[.968,-.248],splitStemDownNW:[.12,-.416],splitStemUpSE:[1.092,.392],splitStemUpSW:[.312,.356],stemDownNW:[0,-.168],stemUpSE:[1.18,.168],path:"M199 -256q-86 0 -143 46q-56 46 -56 124q0 134 120 238t286 104q88 0 143 -46t55 -124q0 -126 -132 -234t-273 -108z"},noteheadSlashWhiteWhole:{codepoint:"U+E102",description:"White slash whole",bBoxNE:[3.92,1],bBoxSW:[0,-1],path:"M881 512h1126l-881 -1024h-1126zM1731 451h-717l-758 -902h717z"},noteheadSlashWhiteHalf:{codepoint:"U+E103",description:"White slash half",bBoxNE:[3.12,1],bBoxSW:[0,-1],stemDownNW:[0,-1],stemUpSE:[3.12,1],path:"M881 512h716l-880 -1024h-717zM1321 451h-307l-758 -902h307z"},noteheadSlashHorizontalEnds:{alternateCodepoint:"U+1D10D",codepoint:"U+E101",description:"Slash with horizontal ends",bBoxNE:[2.12,1],bBoxSW:[0,-1],stemDownNW:[0,-1],stemUpSE:[2.12,1],path:"M881 512h204l-880 -1024h-205z"},noteheadXWhole:{codepoint:"U+E0A7",description:"X notehead whole",bBoxNE:[1.508,.5],bBoxSW:[0,-.5],path:"M549 -201h100l-223 201l223 201h-100l-162 -138l-164 138h-98l223 -201l-223 -201h98l164 138zM225 -256h-180q-18 0 -31 13q-12 13 -12 33t14 34l172 176l-172 176q-16 16 -16 34t13 32t30 14h182q16 0 29 -12l133 -111l131 111q12 12 29 12h182q17 0 29 -14t12 -32 t-14 -34l-170 -176l170 -176q16 -16 16 -34t-13 -32t-32 -14h-180q-16 0 -29 12l-131 109l-133 -109q-12 -12 -29 -12z"},noteheadXHalf:{codepoint:"U+E0A8",description:"X notehead half",bBoxNE:[1.336,.5],bBoxSW:[0,-.5],stemDownNW:[0,-.412],stemUpSE:[1.336,.412],path:"M51 211l242 -205l-193 -217h109l143 162l195 -162h86l-244 203l195 219h-109l-143 -164l-197 164h-84zM420 256h217q19 0 33 -13t14 -34t-10 -29l-189 -211l177 -147q18 -12 18 -30t-15 -32q-15 -16 -32 -16h-86q-10 0 -31 12l-131 103l-88 -101q-12 -14 -35 -14h-217 q-18 0 -32 13q-13 13 -13 33t10 30l189 211l-179 145q-14 16 -14 34t13 32t32 14h84q16 0 29 -12l133 -105l88 103q15 14 35 14z"},noteheadXBlack:{alternateCodepoint:"U+1D143",codepoint:"U+E0A9",description:"X notehead black",bBoxNE:[1.16,.5],bBoxSW:[0,-.5],stemDownNW:[0,-.44],stemUpSE:[1.16,.444],path:"M594 -227q0 -29 -27 -29q-8 0 -14 6l-258 215l-254 -215q-6 -6 -14 -6q-27 0 -27 31q0 14 10 22l244 203l-244 205q-10 10 -10 24q0 27 25 27q8 0 16 -4l254 -215l258 215q8 4 16 4q9 0 17 -8t8 -22t-10 -21l-244 -205l244 -203q10 -10 10 -24z"},noteheadDiamondWhole:{codepoint:"U+E0D8",description:"Diamond whole notehead",bBoxNE:[1.08,.5],bBoxSW:[0,-.5],path:"M174 256q8 0 10 -2l361 -264q8 -4 8 -10t-4 -13l-162 -217q-2 -6 -12 -6l-2 2h-6l-361 264q-6 12 -6 15l164 227q2 4 10 4zM392 -158q3 0 69 92q0 8 -6 13l-287 211l-4 2h-5q-3 0 -3 -2l-68 -90q0 -5 6 -11l287 -211q8 -4 11 -4z"},noteheadDiamondHalfWide:{codepoint:"U+E0DA",description:"Diamond half notehead (wide)",bBoxNE:[1.404,.5],bBoxSW:[0,-.5],stemDownNW:[0,0],stemUpSE:[1.404,0],path:"M360 -256q-8 0 -16 4l-336 240q-8 6 -8 10t8 10l338 244q4 4 13 4t14 -4l342 -244q4 -8 4 -12t-4 -8l-340 -240q-7 -4 -15 -4zM174 -37q0 -16 19 -33q27 -32 83 -32t132 39q123 59 122 98q0 15 -26 41t-80 26q-53 0 -123 -36q-127 -66 -127 -103z"},noteheadDiamondBlackWide:{codepoint:"U+E0DC",description:"Diamond black notehead (wide)",bBoxNE:[1.4,.5],bBoxSW:[0,-.5],stemDownNW:[0,0],stemUpSE:[1.4,0],path:"M356 -256q-8 0 -14 6l-336 242q-6 0 -6 8t6 12l332 238q10 6 20 6t19 -6l334 -238q6 -6 6 -11t-6 -9l-336 -242q-11 -6 -19 -6z"},noteheadCircleXWhole:{codepoint:"U+E0B1",description:"Circle X whole",bBoxNE:[.996,.5],bBoxSW:[0,-.5],path:"M254 -197q66 0 121 39l-119 119l-119 -119q51 -39 117 -39zM96 121q27 -92 27 -125q-1 -33 -13 -69t-14 -44l119 119zM254 199q-64 0 -113 -39l115 -115l117 115q-55 39 -119 39zM383 5q0 42 31 114l-117 -117l117 -115q-31 76 -31 118zM255 256q105 0 180 -75t75 -181 t-75 -181t-180 -75t-180 75t-75 181t75 181t180 75z"},noteheadCircleXHalf:{codepoint:"U+E0B2",description:"Circle X half",bBoxNE:[1,.5],bBoxSW:[0,-.5],stemDownNW:[0,0],stemUpSE:[1,0],path:"M255 256q105 0 181 -75t76 -181t-76 -181t-181 -75t-180 75t-75 181t75 181t180 75zM214 -176q52 0 114 49l-80 80l-111 -111q25 -18 77 -18zM80 -44q0 -50 16 -73l111 109l-80 82q-47 -68 -47 -118zM313 176q-72 0 -127 -45l78 -78l109 107q-25 16 -60 16zM432 59 q0 31 -18 60l-109 -109l80 -80q47 63 47 129z"},noteheadCircleX:{alternateCodepoint:"U+1D145",codepoint:"U+E0B3",description:"Circle X notehead",bBoxNE:[.996,.5],bBoxSW:[0,-.5],stemDownNW:[0,0],stemUpSE:[.996,0],path:"M256 -197q66 0 117 39l-117 119l-121 -119q55 -39 121 -39zM57 -2q0 -70 39 -117l119 121l-117 117q-41 -51 -41 -121zM256 197q-62 0 -117 -37l117 -117l115 117q-53 37 -115 37zM451 0q0 66 -37 119l-117 -117l119 -119q35 51 35 117zM255 256q105 0 180 -75t75 -181 t-75 -181t-180 -75t-180 75t-75 181t75 181t180 75z"},noteheadTriangleUpWhole:{codepoint:"U+E0BB",description:"Triangle notehead up whole",bBoxNE:[1.276,.5],bBoxSW:[0,-.5],path:"M242 -195h168q12 -1 21 19t9 42t-10 70t-35 96q-26 48 -48 83t-23 39q0 -2 -27 -45t-51 -92t-31 -86q-8 -36 -8 -60q-1 -24 11 -45t24 -21zM633 -256h-613q-20 0 -20 20v7l307 475q5 10 17 10t16 -10l311 -471v-4q2 -4 2 -7q0 -20 -20 -20z"},noteheadTriangleUpHalf:{codepoint:"U+E0BC",description:"Triangle notehead up half",bBoxNE:[1.14,.5],bBoxSW:[0,-.5],stemDownNW:[0,-.46],stemUpSE:[1.14,-.46],path:"M303 256q10 0 21 -10l258 -471q2 -4 2 -11q0 -20 -21 -20h-543q-20 0 -20 20q0 4 4 13l283 469q6 10 16 10zM350 -197l72 144l-92 162l-166 -306h186z"},noteheadTriangleUpBlack:{alternateCodepoint:"U+1D149",codepoint:"U+E0BE",description:"Triangle notehead up black",bBoxNE:[1.172,.5],bBoxSW:[0,-.5],stemDownNW:[0,-.5],stemUpSE:[1.172,-.5],path:"M600 -256h-600l295 512z"},noteheadSlashedBlack2:{codepoint:"U+E0D0",description:"Slashed black notehead (top left to bottom right)",bBoxNE:[1.504,.672],bBoxSW:[-.316,-.656],stemDownNW:[0,-.172],stemUpSE:[1.18,.164],path:"M770 -304q0 -32 -31 -32q-12 0 -18 4l-250 178q-129 -102 -272 -102q-86 0 -143 45q-56 45 -56 123q0 115 88 209l-238 170q-12 6 -12 18q0 35 29 35q10 0 18 -6l246 -176q121 94 275 94q88 0 143 -47t55 -137t-88 -183l240 -174q14 -6 14 -19z"},noteheadSlashedHalf2:{codepoint:"U+E0D2",description:"Slashed half notehead (top left to bottom right)",bBoxNE:[1.52,.672],bBoxSW:[-.292,-.536],stemDownNW:[0,-.164],stemUpSE:[1.172,.168],path:"M161 -176q62 0 191 82q10 8 28 19t26 18l-199 127q-147 -92 -148 -160q0 -16 13 -41q27 -45 89 -45zM441 172q-56 0 -179 -70l191 -122q84 68 84 110q-1 21 -15 41q-25 41 -81 41zM778 -242q0 -12 -6 -18q-6 -14 -16 -14t-23 4l-223 145q-109 -131 -313 -131 q-86 0 -142 46q-55 46 -55 126q0 121 98 225l-233 152q-21 9 -10 39q10 12 22 12t17 -4l249 -160q109 76 256 76q89 0 145 -46t56 -124t-55 -168l219 -139q14 -9 14 -21z"},noteheadSlashedWhole2:{codepoint:"U+E0D4",description:"Slashed whole notehead (top left to bottom right)",bBoxNE:[1.744,.604],bBoxSW:[-.072,-.616],path:"M893 -282q0 -32 -29 -33q-10 0 -14 4l-152 98q-109 -43 -300 -43t-295 74q-103 74 -103 180t106 174l-129 86q-14 8 -14 18q0 32 29 33q10 0 14 -4l156 -100q118 51 272 51t288 -75t134 -187t-100 -176l123 -82q14 -6 14 -18zM635 -68q0 98 -75 188t-179 89 q-104 0 -141 -55l393 -256q2 12 2 34zM219 82q0 -96 70 -184l45 -45q47 -39 94 -54q38 -8 56 -8t59 8q47 14 67 45l-391 254v-16z"},noteheadParenthesis:{alternateCodepoint:"U+1D156",codepoint:"U+E0CE",description:"Parenthesis notehead",bBoxNE:[1.472,.728],bBoxSW:[-.292,-.72],path:"M680 13q0 128 -33 203t-117 142l9 15q78 -51 123 -105q92 -114 92 -268t-109 -281q-43 -49 -102 -88l-13 15q53 41 77 70q73 91 73 297zM-150 1q0 155 93 267q41 49 123 105l8 -15q-82 -68 -115 -140t-33 -203q0 -210 71 -299q24 -29 77 -70l-11 -15q-59 37 -104 88 q-109 127 -109 282z"},stringsDownBow:{alternateCodepoint:"U+1D1AA",codepoint:"U+E610",description:"Down bow",bBoxNE:[1.248,1.272],bBoxSW:[0,0],path:"M53 651h533q20 0 36 -16t17 -37v-573q0 -25 -25 -25h-26q-27 0 -27 25v335q0 35 -242 35t-241 -35v-335q0 -25 -25 -25h-28q-25 0 -25 25v573q0 20 16 37q17 16 37 16z"},stringsDownBowTurned:{codepoint:"U+E611",description:"Turned down bow",bBoxNE:[1.248,1.272],bBoxSW:[0,0],path:"M586 0h-533q-20 0 -37 16q-16 16 -16 37v574q0 25 25 24h28q25 0 25 -24v-336q0 -35 242 -35t241 35v336q0 25 27 24h26q25 0 25 -24v-574q0 -20 -16 -37q-17 -16 -37 -16z"},stringsUpBow:{alternateCodepoint:"U+1D1AB",codepoint:"U+E612",description:"Up bow",bBoxNE:[.996,1.98],bBoxSW:[.004,.004],path:"M256 2q-31 0 -37 29l-215 940q-2 4 -2 10q0 27 29 33h8q27 0 37 -27l180 -788l182 788q6 27 35 27h8q29 -6 29 -35v-8l-217 -940q-6 -29 -37 -29z"},stringsUpBowTurned:{codepoint:"U+E613",description:"Turned up bow",bBoxNE:[.996,1.98],bBoxSW:[.004,.004],path:"M256 1014q31 0 37 -29l217 -940v-8q0 -29 -29 -35h-8q-29 0 -35 27l-182 788l-180 -788q-10 -27 -37 -27h-8q-29 6 -29 33q0 6 2 10l215 940q6 29 37 29z"},articAccentAbove:{alternateCodepoint:"U+1D17B",codepoint:"U+E4A0",description:"Accent above",bBoxNE:[1.356,.98],bBoxSW:[0,.004],path:"M33 2q-17 0 -25 22t-8 27q0 18 29 31q438 150 457 156t20 14q0 12 -14 14l-463 158q-29 10 -29 29q0 5 7 27t28 22q2 0 18 -4l615 -209q27 -8 27 -38t-27 -36l-627 -211q-2 -2 -8 -2z"},articAccentBelow:{codepoint:"U+E4A1",description:"Accent below",bBoxNE:[1.356,0],bBoxSW:[0,-.976],path:"M33 -500q-17 0 -25 22t-8 27q0 18 29 31q438 150 457 156t20 14q0 12 -14 14l-463 158q-29 10 -29 29q0 5 7 27t28 22q2 0 18 -4l615 -209q27 -8 27 -38t-27 -36l-627 -211q-2 -2 -8 -2z"},articMarcatoAbove:{alternateCodepoint:"U+1D17F",codepoint:"U+E4AC",description:"Marcato above",bBoxNE:[.94,1.012],bBoxSW:[-.004,-.004],path:"M23 -2q-25 0 -25 25q0 6 2 10l217 473q5 12 19 12t22 -12l221 -473q2 -2 2 -10q0 -18 -22 -23h-140q-12 0 -22 12q-115 244 -117 252q-6 6 -11 6t-9 -6l-115 -252q-6 -14 -22 -14z"},articMarcatoBelow:{codepoint:"U+E4AD",description:"Marcato below",bBoxNE:[.94,0],bBoxSW:[-.004,-1.016],path:"M457 0q24 0 24 -25q0 -6 -2 -10l-217 -473q-6 -12 -20 -12t-21 12l-221 473q-2 2 -2 10q0 18 22 23h140q12 0 22 -12q115 -244 117 -252q6 -6 11 -6t9 6l115 252q6 14 23 14z"},articStaccatoAbove:{alternateCodepoint:"U+1D17C",codepoint:"U+E4A2",description:"Staccato above",bBoxNE:[.336,.336],bBoxSW:[0,0],path:"M172 86q0 -34 -26 -60t-60 -26t-60 26t-26 60t26 60t60 26t60 -26t26 -60z"},articStaccatoBelow:{codepoint:"U+E4A3",description:"Staccato below",bBoxNE:[.336,0],bBoxSW:[0,-.336],path:"M172 -86q0 -34 -26 -60t-60 -26t-60 26t-26 60t26 60t60 26t60 -26t26 -60z"},articMarcatoStaccatoAbove:{alternateCodepoint:"U+1D180",codepoint:"U+E4AE",description:"Marcato-staccato above",bBoxNE:[.94,1.772],bBoxSW:[-.004,0],path:"M328 86q0 -34 -26 -60t-60 -26t-61 26q-25 26 -25 60t26 60t60 26t60 -26t26 -60zM23 387q-25 0 -25 25q0 6 2 10l217 473q5 12 19 12t22 -12l221 -473q2 -2 2 -10q0 -18 -22 -23h-140q-12 0 -22 12q-115 244 -117 252q-6 6 -11 6t-9 -6l-115 -252q-6 -14 -22 -14z"},articMarcatoStaccatoBelow:{codepoint:"U+E4AF",description:"Marcato-staccato below",bBoxNE:[.94,0],bBoxSW:[-.004,-1.812],path:"M324 -86q0 -34 -26 -60t-60 -26t-61 26q-25 26 -25 60t26 60t60 26t60 -26t26 -60zM457 -408q24 0 24 -24q0 -6 -2 -10l-217 -473q-6 -13 -19 -13t-22 13l-221 473q-2 2 -2 10q-1 18 22 22h140q12 0 22 -12q115 -244 117 -252q6 -6 11 -6t9 6l115 252q6 14 23 14z"},articAccentStaccatoAbove:{alternateCodepoint:"U+1D181",codepoint:"U+E4B0",description:"Accent-staccato above",bBoxNE:[1.356,1.68],bBoxSW:[0,0],path:"M436 86q0 -34 -26 -60t-60 -26t-60 26t-26 60t26 60t60 26t60 -26t26 -60zM33 360q-17 0 -25 22t-8 28q0 18 29 30q438 150 457 156t20 14q0 12 -14 15l-463 157q-29 10 -29 29q0 5 7 27t28 22q2 0 18 -4l615 -209q27 -8 27 -38t-27 -36l-627 -211q-2 -2 -8 -2z"},articAccentStaccatoBelow:{codepoint:"U+E4B1",description:"Accent-staccato below",bBoxNE:[1.352,0],bBoxSW:[-.004,-1.644],path:"M434 -86q0 -34 -26 -60t-60 -26t-60 26t-26 60t26 60t60 26t60 -26t26 -60zM31 -842q-17 0 -25 22t-8 27q0 18 29 31q438 150 457 156t20 14q0 12 -15 14l-462 158q-29 10 -29 29q0 5 7 27t28 22q2 0 18 -4l615 -209q27 -8 27 -38t-27 -36l-627 -211q-2 -2 -8 -2z"},articTenutoAbove:{alternateCodepoint:"U+1D17D",codepoint:"U+E4A4",description:"Tenuto above",bBoxNE:[1.352,.192],bBoxSW:[-.004,0],path:"M643 0h-596q-33 0 -41 12t-8 32t2 30q6 24 47 24h596q33 0 41 -12t8 -37t-8 -37t-41 -12z"},articTenutoBelow:{codepoint:"U+E4A5",description:"Tenuto below",bBoxNE:[1.352,0],bBoxSW:[-.004,-.192],path:"M643 -98h-596q-33 0 -41 12t-8 39q0 47 49 47h596q33 0 41 -12t8 -37t-8 -37t-41 -12z"},articMarcatoTenutoAbove:{codepoint:"U+E4BC",description:"Marcato-tenuto above",bBoxNE:[1.352,1.708],bBoxSW:[-.004,0],path:"M643 0h-596q-33 0 -41 12t-8 32t2 30q6 24 47 24h596q33 0 41 -12t8 -37t-8 -37t-41 -12zM109 379q0 6 2 10l217 473q6 12 20 12t21 -12l221 -473q2 -2 2 -10q0 -18 -23 -23h-139q-12 0 -22 13q-115 244 -117 252q-6 6 -11 6t-10 -6l-114 -252q-6 -14 -23 -15 q-24 0 -24 25z"},articMarcatoTenutoBelow:{codepoint:"U+E4BD",description:"Marcato-tenuto below",bBoxNE:[1.352,0],bBoxSW:[-.004,-1.716],path:"M350 -878q-14 0 -22 12l-222 473q-2 2 -2 10q0 18 23 23h139q12 0 23 -13q115 -244 117 -252q6 -6 11 -6t9 6l115 252q6 14 22 15q24 0 25 -25q0 -6 -2 -10l-217 -473q-5 -12 -19 -12zM643 -98h-596q-33 0 -41 12t-8 39q0 47 49 47h596q33 0 41 -12t8 -37t-8 -37t-41 -12 z"},articTenutoAccentAbove:{codepoint:"U+E4B4",description:"Tenuto-accent above",bBoxNE:[1.356,1.38],bBoxSW:[-.004,0],path:"M643 0h-596q-33 0 -41 12t-8 32t2 30q6 24 47 24h596q33 0 41 -12t8 -37t-8 -37t-41 -12zM33 207q-17 -1 -25 21t-8 28q0 18 29 31q438 149 457 155t20 15q0 12 -14 14l-463 158q-29 10 -29 28q0 4 7 27t28 23q2 0 18 -5l615 -208q27 -8 27 -38t-27 -36l-627 -211 q-2 -2 -8 -2z"},articTenutoAccentBelow:{codepoint:"U+E4B5",description:"Tenuto-accent below",bBoxNE:[1.356,0],bBoxSW:[-.004,-1.38],path:"M643 -98h-596q-33 0 -41 12t-8 39q0 47 49 47h596q33 0 41 -12t8 -37t-8 -37t-41 -12zM33 -707q-17 -1 -25 21t-8 29q0 18 29 30q438 150 457 156t20 14q0 12 -14 15l-463 157q-29 10 -29 29q0 4 7 26t28 23q2 0 18 -4l615 -209q27 -8 27 -38t-27 -36l-627 -211 q-2 -2 -8 -2z"},articStaccatissimoAbove:{alternateCodepoint:"U+1D17E",codepoint:"U+E4A6",description:"Staccatissimo above",bBoxNE:[.4,1.172],bBoxSW:[.004,-.008],path:"M102 600q102 0 103 -47q0 -73 -35 -315t-67 -242t-66 249q-35 249 -35 310q2 21 30 33t70 12z"},articStaccatissimoBelow:{codepoint:"U+E4A7",description:"Staccatissimo below",bBoxNE:[.4,0],bBoxSW:[.004,-1.18],path:"M102 -604q-42 0 -70 12t-30 33q0 61 35 310t67 249t66 -242q35 -242 35 -315q-1 -47 -103 -47z"},articTenutoStaccatoAbove:{alternateCodepoint:"U+1D182",codepoint:"U+E4B2",description:"Louré (tenuto-staccato) above",bBoxNE:[1.352,.96],bBoxSW:[-.004,0],path:"M438 86q0 -34 -26 -60t-60 -26t-60 26t-26 60t26 60t60 26t60 -26t26 -60zM643 393h-596q-33 1 -41 13t-8 32t2 28q6 24 47 26h596q33 0 41 -12t8 -38q0 -25 -8 -37t-41 -12z"},articTenutoStaccatoBelow:{codepoint:"U+E4B3",description:"Louré (tenuto-staccato) below",bBoxNE:[1.352,0],bBoxSW:[-.004,-.968],path:"M428 -86q0 -34 -26 -60t-60 -26t-60 26t-26 60t26 60t60 26t60 -26t26 -60zM643 -496h-596q-33 0 -41 12t-8 34q0 20 2 28q6 23 47 25h596q33 -1 41 -13t8 -36t-8 -38q-8 -12 -41 -12z"},fermataAbove:{alternateCodepoint:"U+1D110",codepoint:"U+E4C0",description:"Fermata above",bBoxNE:[2.42,1.316],bBoxSW:[.012,-.012],path:"M733 106q0 -44 -33 -78q-32 -34 -78 -34t-79 34t-33 78t33 78q33 33 78 33t79 -33t33 -78zM618 453q-422 0 -538 -398q-15 -61 -45 -61q-29 0 -29 26q0 14 2 23q67 347 275 511q104 82 197 101q94 19 137 19t81 -4t127 -39q88 -35 159 -94q70 -59 144 -189t109 -305 q2 -8 2 -20q0 -29 -29 -29q-23 0 -43 43q-4 4 -13 50t-59 125q-49 79 -102 124t-153 81t-222 36z"},fermataBelow:{alternateCodepoint:"U+1D111",codepoint:"U+E4C1",description:"Fermata below",bBoxNE:[2.42,0],bBoxSW:[.012,-1.328],path:"M622 0q46 0 78 -33t33 -79q0 -46 -34 -78q-35 -32 -79 -33q-44 0 -77 33q-33 34 -33 78t33 78t79 34zM618 -459q122 0 222 36t153 81t94 112q41 68 53 100t18 54q5 21 9 33q20 43 43 43q29 0 29 -29q0 -12 -2 -20q-35 -176 -109 -305t-144 -189q-71 -59 -159 -94 t-127 -39q-40 -4 -70 -4q-125 0 -236 50q-48 22 -109 70q-208 164 -275 511q-2 8 -2 22q0 27 25 27q34 0 49 -61q116 -398 538 -398z"},flag8thUp:{alternateCodepoint:"U+1D16E",codepoint:"U+E240",description:"Combining flag 1 (8th) above",bBoxNE:[1.056,.036],bBoxSW:[0,-3.244],graceNoteSlashNE:[1.284,-.796],graceNoteSlashSW:[-.644,-2.456],stemUpNW:[0,-.04],path:"M397 -1597q0 12 6 30q49 131 49 305t-56 302t-179 285t-217 173v490q0 31 20 30q53 0 62 -45q43 -254 223 -534q236 -375 236 -703q0 -143 -41 -301l-13 -53q-6 -25 -26 -35t-31 -4q-33 23 -33 60z"},flag8thDown:{codepoint:"U+E241",description:"Combining flag 1 (8th) below",bBoxNE:[1.224,3.236],bBoxSW:[0,-.056],graceNoteSlashNW:[-.596,2.168],graceNoteSlashSE:[1.328,.628],stemDownSW:[0,.132],path:"M23 -29q-23 0 -23 31v481q186 63 286 169q159 169 222 433q27 109 27 225t-43 246q-23 63 18 91t59 -23q57 -229 58 -371q0 -303 -254 -702q-99 -141 -153 -225q-115 -178 -138 -310q-6 -45 -59 -45z"},flag16thUp:{alternateCodepoint:"U+1D16F",codepoint:"U+E242",description:"Combining flag 2 (16th) above",bBoxNE:[1.116,.008],bBoxSW:[0,-3.252],stemUpNW:[0,-.088],path:"M450 -948q16 0 18 7q17 40 17 120q0 81 -55 162q-145 215 -303 215h-16q-13 0 -21 -8t-8 -12q0 -5 2 -7q20 -76 51 -125t132 -149t161 -195q6 -8 22 -8zM571 -1360v-45q0 -207 -14 -225q-16 -35 -41 -35q-4 0 -16 4q-29 8 -29 49q0 10 9 64t9 137q0 167 -53 277 q-86 178 -172 248q-85 69 -254 75h-10v813q23 2 35 2q37 0 41 -27q12 -76 42 -134t58 -86q28 -29 80 -73q51 -44 128 -127t128 -161t51 -201q0 -124 -35 -232q-10 -34 -14 -42t-4 -17l2 -18q59 -123 59 -246z"},flag16thDown:{codepoint:"U+E243",description:"Combining flag 2 (16th) below",bBoxNE:[1.164,3.252],bBoxSW:[0,-.036],stemDownSW:[0,.128],path:"M470 934q-16 0 -21 -8q-79 -124 -204 -233q-65 -56 -104 -108t-57 -128q-2 -2 -2 -6q0 -20 29 -21h16q86 0 176 66q203 149 203 331q0 27 -7 57t-10 36q-3 14 -19 14zM0 795h10q174 7 266 75t168 222q103 209 48 518q-8 49 34 53q27 0 36 -11t13 -34q61 -303 -43 -518 l-2 -19q0 -10 4 -17t14 -41q52 -168 30 -290q-26 -164 -186 -305q-66 -58 -132 -118q-158 -143 -184 -302q-4 -27 -41 -26l-35 2v811z"},flag32ndUp:{alternateCodepoint:"U+1D170",codepoint:"U+E244",description:"Combining flag 3 (32nd) above",bBoxNE:[1.044,.596],bBoxSW:[0,-3.248],stemUpNW:[0,.376],path:"M453 -885q0 88 -52 164q-133 199 -297 199q-8 -2 -17 -14t-9 -13q18 -72 49 -119t89 -103l91 -93q59 -70 94 -121q1 -8 17 -8t20 10q4 9 6 27t6 36q3 18 3 35zM426 -371q-141 240 -346 240q22 -126 90 -203q25 -27 95 -91t161 -177q20 70 25 90l6 43q0 43 -31 98zM0 -866 v1147q12 25 25 24q10 0 24 -13t17 -26q22 -133 97 -208q28 -28 76 -70q47 -42 117 -117q70 -76 119 -150t49 -181t-41 -226q43 -88 43 -179t-18 -159t-24 -83q-6 -16 -7 -26q0 -10 2 -14q47 -112 53 -231l3 -58q1 -166 -17 -196t-39 -31q-4 0 -12 4q-27 12 -27 49 q18 138 19 189q1 154 -55 264q-56 109 -105 169q-77 93 -194 114q-34 6 -95 8h-10z"},flag32ndDown:{codepoint:"U+E245",description:"Combining flag 3 (32nd) below",bBoxNE:[1.092,3.248],bBoxSW:[0,-.688],stemDownSW:[0,-.448],path:"M469 498q-27 100 -29 104q-79 -103 -159 -177q-80 -73 -107 -101q-71 -73 -94 -215q0 -4 4 -7q211 0 358 250q33 57 33 103zM106 522h11q88 0 166 60t133 145q55 84 55 174q0 19 -3 37t-5 36t-6 27q-3 11 -19 11t-22 -8q-65 -102 -158 -193q-94 -90 -127 -139t-51 -123 q0 -27 26 -27zM473 1663q25 0 43 -33q10 -16 26 -97t17 -149v-22q-8 -141 -53 -219q-6 -8 -6 -15l6 -18q41 -102 41 -221t-47 -201q45 -134 45 -204t-4 -89q-15 -92 -57 -154t-158 -190q-25 -27 -99 -89q-75 -62 -109 -120t-50 -153q-2 -13 -18 -27t-23 -14q-18 0 -23 20 l-4 6v1207q63 2 98 8q117 20 204 118q54 61 114 167t59 174q0 68 -20 153t-23 107q0 41 29 53q4 2 12 2z"},flag64thUp:{alternateCodepoint:"U+1D171",codepoint:"U+E246",description:"Combining flag 4 (64th) above",bBoxNE:[1.044,1.388],bBoxSW:[0,-3.248],stemUpNW:[0,1.172],path:"M453 -885q0 88 -52 164q-133 199 -297 199q-8 -2 -17 -14t-9 -13q18 -72 49 -119t89 -103l91 -93q59 -70 94 -121q1 -8 17 -8t20 10q4 9 6 27t6 36q3 18 3 35zM426 -371q-141 240 -346 240q22 -126 90 -203q25 -27 95 -91t161 -177q20 70 25 90l6 43q0 43 -31 98z M451 -106l6 43q0 43 -31 98q-143 240 -346 239q2 -2 8 -41t33 -94t49 -81t91 -87q68 -61 163 -178zM0 -866v1552q12 25 24 25q12 1 25 -13q14 -14 17 -26q22 -133 97 -208q28 -28 76 -70q47 -42 117 -118t109 -134q39 -60 55 -148q4 -37 4 -55q0 -102 -45 -228 q45 -79 45 -179q0 -99 -41 -218q43 -88 43 -179t-18 -159t-24 -83q-6 -16 -7 -26q0 -10 2 -14q47 -112 53 -231l3 -58q1 -166 -17 -196t-39 -31q-4 0 -12 4q-27 12 -27 49q18 138 19 189q1 154 -55 264q-56 109 -105 169q-77 93 -194 114q-34 6 -95 8h-10z"},flag64thDown:{codepoint:"U+E247",description:"Combining flag 4 (64th) below",bBoxNE:[1.092,3.248],bBoxSW:[0,-1.504],stemDownSW:[0,-1.244],path:"M469 498q-27 100 -29 104q-79 -103 -159 -177q-80 -73 -107 -101q-71 -73 -94 -215q0 -4 4 -7q211 0 358 250q33 57 33 103zM469 80l-27 102q-103 -124 -178 -195t-99 -98q-23 -27 -49 -82t-36 -122q215 0 362 249q33 57 33 103zM106 522h11q88 0 166 60t133 145 q55 84 55 174q0 19 -3 37t-5 36t-6 27q-3 11 -19 11t-22 -8q-65 -102 -158 -193q-94 -90 -127 -139t-51 -123q0 -27 26 -27zM473 1663q25 0 43 -33q10 -16 26 -97t17 -149v-22q-8 -141 -53 -219q-6 -8 -6 -15l6 -18q41 -102 41 -221t-47 -201q45 -135 45 -235t-45 -185 q47 -123 47 -229q0 -31 -6 -62q-15 -92 -57 -154t-158 -190q-25 -27 -99 -89q-75 -62 -109 -119t-50 -154q-2 -13 -18 -27t-23 -14q-18 0 -23 20l-4 7v1624q63 2 98 8q117 20 204 118q54 61 114 167t59 174q0 68 -20 153t-23 107q0 41 29 53q4 2 12 2z"},flag128thUp:{alternateCodepoint:"U+1D172",codepoint:"U+E248",description:"Combining flag 5 (128th) above",bBoxNE:[1.044,2.132],bBoxSW:[0,-3.248],stemUpNW:[0,1.9],path:"M453 -885q0 88 -52 164q-133 199 -297 199q-8 -2 -17 -14t-9 -13q18 -72 49 -119t89 -103l91 -93q59 -70 94 -121q1 -8 17 -8t20 10q4 9 6 27t6 36q3 18 3 35zM426 -371q-141 240 -346 240q22 -126 90 -203q25 -27 95 -91t161 -177q20 70 25 90l6 43q0 43 -31 98z M451 -106l6 43q0 43 -31 98q-143 240 -348 239q2 -2 8 -41t33 -94t51 -81t91 -87q68 -61 163 -178zM426 416q-141 240 -348 239q16 -86 47 -137t125 -133t178 -192q14 47 23 81l6 43q0 44 -31 99zM0 -866v1933q12 25 24 25t25 -14q14 -14 17 -25q22 -133 97 -208 q28 -28 76 -70q47 -41 117 -117t119 -151t49 -183q0 -109 -39 -218q39 -80 39 -174q0 -95 -45 -221q45 -79 45 -179q0 -99 -41 -218q43 -88 43 -179t-18 -159t-24 -83q-6 -16 -7 -26q0 -10 2 -14q47 -112 53 -231l3 -58q1 -166 -17 -196t-39 -31q-4 0 -12 4q-27 12 -27 49 q18 138 19 189q1 154 -55 264q-56 109 -105 169q-77 93 -194 114q-34 6 -95 8h-10z"},flag128thDown:{codepoint:"U+E249",description:"Combining flag 5 (128th) below",bBoxNE:[1.092,3.248],bBoxSW:[0,-2.32],stemDownSW:[0,-2.076],path:"M469 498q-27 100 -29 104q-79 -103 -159 -177q-80 -73 -107 -101q-71 -73 -94 -215q0 -4 4 -7q211 0 358 250q33 57 33 103zM469 80l-27 102q-103 -124 -178 -195t-99 -98q-23 -27 -49 -82t-36 -122q215 0 362 249q33 57 33 103zM469 -338l-27 102q-103 -124 -178 -195 t-99 -97q-23 -26 -49 -82q-26 -55 -36 -123q215 0 362 250q33 57 33 102zM106 522h11q88 0 166 60t133 145q55 84 55 174q0 19 -3 37t-5 36t-6 27q-3 11 -19 11t-22 -8q-65 -102 -158 -193q-94 -90 -127 -139t-51 -123q0 -27 26 -27zM473 1663q25 0 43 -33q10 -16 26 -97 t17 -149v-22q-8 -141 -53 -219q-6 -8 -6 -15l6 -18q41 -102 41 -221t-47 -201q45 -135 45 -235t-45 -185q47 -123 47 -226t-47 -192q47 -123 47 -229q0 -31 -6 -61q-15 -92 -57 -154t-158 -190q-25 -27 -99 -89q-75 -61 -109 -119t-50 -155q-2 -13 -18 -27t-23 -14 q-18 0 -23 21l-4 6v2042q63 2 98 8q117 20 204 118q54 61 114 167t59 174q0 68 -20 153t-23 107q0 41 29 53q4 2 12 2z"},flag256thUp:{codepoint:"U+E24A",description:"Combining flag 6 (256th) above",bBoxNE:[1.056,2.816],bBoxSW:[0,-3.248],stemUpNW:[0,2.592],path:"M457 -879q1 86 -53 168q-54 81 -130 141t-157 60h-13q-25 0 -24 -27q16 -73 45 -117t93 -108t104 -108t79 -109q7 -8 21 -8t18 14q3 4 10 42t7 52zM459 662q0 34 -33 86q-139 244 -346 243q18 -80 49 -130t101 -119t87 -87l113 -125q2 10 8 28t9 30t7 26t5 48zM459 278 q0 33 -31 87q-141 244 -348 243q18 -80 49 -130t101 -119t87 -87l113 -125q2 9 8 27t9 30t7 27q4 14 5 47zM459 -100q0 34 -31 86q-141 240 -348 239q18 -80 49 -130t101 -119t87 -87l113 -125q2 10 8 28t9 30l7 28t5 50zM459 -486q0 35 -31 87q-141 238 -348 241 q18 -74 51 -120t96 -100t90 -81q86 -94 119 -137q2 8 12 42t11 68zM485 -1663q-8 0 -16 4q-27 8 -27 47q0 10 9 62t10 131q-1 154 -51 258q-81 168 -170 241q-62 51 -158 62q-27 2 -74 4h-8v2277q0 7 13 13t21 6t12 -1q17 -3 17 -36q12 -70 42 -127t56 -86t80 -79t76 -75 l37 -39q94 -102 140 -170t45 -179q0 -112 -37 -222q37 -69 37 -171t-37 -212q37 -69 37 -171t-37 -212q39 -73 39 -165q0 -93 -35 -210q24 -73 24 -155t-47 -246q-2 -2 -2 -8t2 -13v-6q50 -112 56 -231l2 -58q0 -178 -17 -198q-16 -35 -39 -35z"},flag256thDown:{codepoint:"U+E24B",description:"Combining flag 6 (256th) below",bBoxNE:[1.196,3.252],bBoxSW:[0,-3.004],stemDownSW:[0,-2.812],path:"M526 -256l-2 51q0 12 -8 58q-122 -164 -254 -266q-70 -54 -115 -106t-67 -128q256 8 414 280q33 57 32 111zM526 -637l-2 51q0 10 -8 56q-37 -47 -151 -175q-33 -37 -103 -91t-115 -106t-67 -128q254 8 414 280q33 57 32 113zM106 512h17q154 0 295 209q55 82 55 168 q0 46 -14 104q-3 13 -19 13t-22 -9q-71 -103 -147 -178t-100 -101q-64 -68 -95 -179q0 -7 8 -17t22 -10zM526 510l-2 51q0 29 -20 107v4l-2 4q-35 -63 -174 -217q-27 -29 -76 -71t-77 -70q-75 -75 -97 -199q254 0 416 280q33 57 32 111zM526 127l-2 51q0 12 -8 58 q-122 -164 -254 -266q-70 -54 -115 -106t-67 -128q256 8 414 280q33 57 32 111zM28 -1538q-11 0 -28 29v2379q161 6 244 75q83 68 170 218q63 113 63 205q1 49 -21 139q-22 91 -22 105q0 39 29 51l10 2q29 0 45 -33q10 -16 26 -99t17 -151v-22q-6 -94 -14 -125t-26 -71 q-19 -40 -19 -44q0 -6 4 -14q43 -131 43 -291v-2q2 -2 2 -4l2 -8q59 -156 59 -263t-34 -194q34 -123 34 -210t-34 -173q34 -123 34 -209t-34 -174q34 -122 34 -184q-1 -166 -68 -267q-46 -69 -179 -214q-31 -33 -89 -82t-89 -81q-33 -32 -65 -97t-44 -148q-4 -15 -22 -29 t-28 -14z"},flag512thUp:{codepoint:"U+E24C",description:"Combining flag 7 (512th) above",bBoxNE:[1.06,3.564],bBoxSW:[-.004,-3.248],stemUpNW:[0,3.324],path:"M459 -879q0 86 -56 168q-53 81 -129 141t-157 60h-13q-25 0 -24 -27q22 -99 87 -173q23 -26 67 -68q116 -111 169 -201q7 -8 21 -8t18 14q3 4 10 42t7 52zM461 1035q0 40 -33 95q-143 244 -348 244q18 -80 50 -131t128 -143t172 -187q31 82 31 122zM461 654q0 42 -31 94 q-145 244 -350 243q18 -80 50 -131t125 -140t175 -190q31 82 31 124zM461 271q0 42 -31 94q-145 244 -350 243q18 -80 50 -131t125 -140t175 -190q31 82 31 124zM461 -111q0 43 -31 95q-143 242 -350 241q18 -80 50 -131t125 -140t175 -190q31 82 31 125zM461 -488 q0 33 -33 89q-141 238 -348 241q18 -74 51 -121t114 -114t193 -203l17 55q6 20 6 53zM487 -1663q-8 0 -16 4q-27 8 -27 47q0 10 9 60t10 133q0 230 -146 417q-43 54 -91 94t-144 50q-27 2 -74 4h-10v391l2 375v1894q0 8 13 14t21 5q8 0 12 -1q17 -3 17 -36q17 -90 51 -148 t108 -126q74 -69 95 -93l33 -35q98 -104 144 -173t47 -171q0 -102 -37 -231q37 -80 37 -167t-37 -216q37 -80 37 -167t-37 -216q37 -80 37 -167t-37 -216q37 -80 37 -166t-35 -209q26 -81 26 -159t-47 -242q-2 -2 -2 -8v-13l2 -6q50 -112 56 -231l2 -58q0 -178 -17 -198 q-18 -35 -39 -35z"},flag512thDown:{codepoint:"U+E24D",description:"Combining flag 7 (512th) below",bBoxNE:[1.2,3.248],bBoxSW:[0,-3.756],stemDownSW:[0,-3.608],
path:"M530 -254l-2 47q0 20 -10 57q-47 -63 -137 -157l-14 -15q-35 -37 -104 -91t-113 -107t-68 -129q258 8 416 280q33 61 32 115zM530 -637l-2 49q0 18 -10 56q-39 -53 -151 -173q-35 -37 -104 -91t-113 -107t-68 -129q256 8 414 280q35 59 34 115zM530 -1020l-2 49 q0 18 -10 56q-38 -53 -110 -130q-85 -91 -205 -187q-89 -71 -123 -183q258 8 416 280q35 59 34 115zM109 510h16q156 0 297 209q55 82 55 168q0 46 -14 104q-3 13 -19 13t-22 -9q-74 -107 -148 -180q-75 -73 -100 -99q-65 -69 -96 -179q0 -7 8 -17t23 -10zM530 510l-2 49 q1 33 -24 115q-37 -70 -172 -217q-24 -25 -96 -86t-106 -113t-48 -141q252 0 414 280q35 59 34 113zM530 129l-2 47q0 20 -10 57q-23 -33 -133 -155l-16 -19q-33 -35 -104 -90t-115 -107t-68 -128q258 8 416 280q33 61 32 115zM29 -1923q-12 0 -29 29v2762q66 4 100 10 t94 32q108 47 224 251q63 113 63 205q1 49 -21 139q-22 91 -22 105q0 39 29 51l10 2q29 1 41 -25t28 -109t17 -149v-22q-9 -152 -47 -209q-10 -23 -10 -30t4 -15l6 -23q37 -106 37 -174q0 -67 -4 -90q2 0 17 -43q48 -138 48 -242t-32 -190q62 -216 0 -383q62 -216 0 -383 q62 -216 0 -383q46 -160 28 -272q-18 -111 -64 -181t-125 -154t-164 -156q-85 -74 -123 -138t-54 -172q-4 -14 -22 -28t-29 -15z"},flag1024thUp:{codepoint:"U+E24E",description:"Combining flag 8 (1024th) above",bBoxNE:[1.06,4.316],bBoxSW:[0,-3.248],stemUpNW:[0,4.064],path:"M459 -879q0 86 -56 168q-53 81 -129 141t-157 60h-13q-23 0 -22 -27q16 -71 44 -117t92 -108t108 -110q43 -48 77 -107q7 -8 21 -8t18 14q3 4 10 42t7 52zM461 1420q0 41 -33 96q-141 242 -348 241q18 -80 50 -131t128 -143t172 -187q31 83 31 124zM461 1045q0 34 -31 85 q-145 244 -350 244q18 -80 50 -131t100 -117t106 -106q36 -41 96 -107l23 78q6 20 6 54zM461 654q0 42 -31 94q-145 244 -350 243q18 -80 50 -131q32 -50 100 -116t87 -89q70 -72 113 -125q31 82 31 124zM461 280q0 35 -31 87q-143 242 -350 241q18 -80 50 -131t100 -117 t106 -106q36 -41 96 -107l23 78q6 20 6 55zM461 -111q0 43 -31 95q-143 242 -350 241q18 -80 50 -131q32 -50 100 -116t87 -89q70 -72 113 -125q31 82 31 125zM461 -486q0 35 -31 87q-141 238 -350 241q18 -74 52 -121t115 -115t191 -202l17 55q6 20 6 55zM487 -1663 q-8 0 -16 4q-27 8 -27 47q0 10 9 60t10 133q0 230 -146 417q-43 54 -91 93t-143 51q-26 2 -73 4h-10v3045q0 7 13 13t21 6t14 -1q16 -3 25 -65q9 -60 42 -118t109 -130t93 -92l31 -32q70 -76 100 -111q76 -90 89 -184q4 -37 4 -58q0 -96 -37 -225q37 -67 37 -160 q0 -94 -37 -223q37 -67 37 -160q0 -94 -37 -223q37 -67 37 -160q0 -94 -37 -223q37 -69 37 -162q0 -92 -37 -221q37 -69 37 -161q0 -91 -35 -214q26 -76 26 -157q0 -80 -47 -244q-2 -2 -2 -8v-13l2 -6q50 -112 56 -231l2 -58q0 -178 -17 -198q-18 -35 -39 -35z"},flag1024thDown:{codepoint:"U+E24F",description:"Combining flag 8 (1024th) below",bBoxNE:[1.204,2.972],bBoxSW:[0,-4.808],stemDownSW:[0,-4.684],path:"M528 -399l-2 53q0 25 -8 55q-62 -83 -151 -172q-49 -55 -164 -144q-89 -71 -123 -184q258 8 418 281q31 55 30 111zM528 -782l-2 53q0 25 -8 55q-39 -53 -121 -141t-194 -175q-89 -71 -123 -184q258 8 418 281q31 55 30 111zM528 -1165l-2 53q0 25 -8 55 q-39 -53 -121 -141t-194 -175q-89 -71 -123 -183q258 8 418 280q31 55 30 111zM528 -1563l-2 54q0 25 -10 65q-29 -37 -133 -149l-16 -19q-33 -37 -105 -93q-72 -55 -116 -111t-66 -138q256 8 418 281q31 55 30 110zM109 369h16q156 0 297 209q55 82 55 167q0 47 -14 105 q-3 12 -19 12t-22 -8q-74 -107 -148 -180q-75 -72 -100 -99q-66 -71 -96 -180q0 -8 8 -17t23 -9zM528 365l-2 53q1 38 -22 114q-37 -70 -172 -217q-24 -25 -96 -86t-106 -113t-48 -141q252 0 416 281q31 55 30 109zM528 -18l-2 53q0 27 -8 57q-23 -33 -133 -155l-16 -19 q-35 -35 -106 -90q-71 -56 -116 -108t-67 -128q260 8 418 281q31 55 30 109zM418 1020q61 113 61 185q-1 72 -21 162q-20 89 -20 101q0 39 29 52l10 2q27 0 43 -33q10 -16 26 -99t17 -151v-22q-6 -95 -15 -131t-34 -80l-6 -13l-4 -16l4 -14q0 -4 2 -7q43 -102 43 -213 q0 -45 -4 -67q2 0 17 -43q48 -138 48 -242t-32 -190q62 -216 0 -383q62 -216 0 -383q62 -216 0 -383q32 -115 32 -205t-34 -184q52 -168 32 -279q-20 -112 -66 -181t-179 -212q-25 -27 -110 -99t-123 -138q-38 -65 -54 -173q-4 -14 -22 -28q-18 -15 -30 -15q-13 0 -28 29 v3160q66 4 100 10t94 32q108 48 224 251z"},augmentationDot:{alternateCodepoint:"U+1D16D",codepoint:"U+E1E7",description:"Augmentation dot",bBoxNE:[.4,.2],bBoxSW:[0,-.2],path:"M205 0q0 -43 -30 -73q-30 -29 -73 -29q-42 0 -72 30t-30 72q0 43 30 73q30 29 72 29t73 -30q30 -30 30 -72z"},accidentalFlat:{alternateCodepoint:"266D",codepoint:"U+E260",description:"Flat",bBoxNE:[.904,1.756],bBoxSW:[0,-.7],cutOutNE:[.252,.656],cutOutSE:[.504,-.476],path:"M63 899q39 0 39 -35q0 -262 -14 -577q0 -25 23 -35q4 -2 12 -2t43 29q57 34 122 32t120 -56t55 -138q0 -174 -246 -346q-18 -13 -87 -71t-83 -58t-22 9q-17 19 -23 898l-2 293q2 27 22 42t41 15zM119 -197q8 0 20 7q98 61 148 153q35 61 35 121t-33 98q-18 23 -59 23 q-41 -1 -85 -43q-45 -42 -50 -58t-5 -65l6 -205q0 -31 23 -31z"},accidentalDoubleFlat:{alternateCodepoint:"U+1D12B",codepoint:"U+E264",description:"Double flat",bBoxNE:[1.644,1.748],bBoxSW:[0,-.7],cutOutNE:[.988,.644],cutOutSE:[1.336,-.396],path:"M496 -197q6 0 18 7q107 65 150 153q32 63 32 121t-30 100q-18 20 -58 21t-87 -42q-46 -43 -50 -55t-4 -53l6 -219q0 -33 23 -33zM322 84q0 62 -26 90q-61 71 -165 -26q-31 -28 -36 -45t-5 -66l6 -201q0 -33 23 -33q8 0 18 7q103 65 152 153q33 59 33 121zM498 250 q14 0 44 24q44 35 101 35h12q76 -2 131 -55t56 -137q0 -174 -250 -348q-12 -7 -80 -67t-92 -60q-8 0 -16 8t-15 278q-66 -84 -172 -157q-6 -5 -78 -67t-89 -62t-24 9q-16 21 -22 898l-4 293q2 25 22 39t41 14q39 0 39 -33l-14 -575q0 -29 23 -35q4 -2 12 -2q9 0 53 30 q45 30 90 29h13q55 0 104 -33l-6 566q2 25 21 39t42 14q39 0 39 -33l-12 -575q0 -37 31 -37z"},accidentalNatural:{alternateCodepoint:"266E",codepoint:"U+E261",description:"Natural",bBoxNE:[.672,1.364],bBoxSW:[0,-1.34],cutOutNE:[.192,.776],cutOutSW:[.476,-.828],path:"M328 383q16 0 16 -16v-1029q0 -25 -25 -24h-26q-25 0 -25 24v306q0 22 -47 22t-190 -61l-6 -2h-5l-4 -2q-16 0 -16 18v1055q0 25 25 24h26q25 0 25 -24v-342q0 -10 38 -10t132 34l35 13h2q4 2 6 2l30 10q2 2 9 2zM76 80v-211q0 -12 34 -12q34 1 96 29t62 55v211 q0 10 -28 10t-96 -31t-68 -51z"},accidentalSharp:{alternateCodepoint:"266F",codepoint:"U+E262",description:"Sharp",bBoxNE:[.996,1.4],bBoxSW:[0,-1.392],cutOutNE:[.84,.896],cutOutNW:[.144,.568],cutOutSE:[.84,-.596],cutOutSW:[.144,-.896],path:"M164 -406v-284q0 -23 -31 -23t-31 23v252q0 10 -7 21t-14 11t-9 -2l-47 -18h-5l-4 -2q-16 0 -16 18v146q0 27 25 33q43 18 61 26t16 43v203q0 13 -8 25t-18 12h-2l-49 -23l-5 -2h-4q-16 0 -16 19v145q0 27 25 33q41 16 53 22q25 12 24 56v276q0 23 31 23t31 -23v-246 q0 -41 24 -41q70 16 129 52q23 14 27 59v266q0 23 31 23t31 -23v-250q0 -27 28 -26l51 18q4 2 11 2q14 0 14 -16v-146q0 -24 -25 -34l-53 -21q-10 -4 -18 -24t-8 -35v-191q0 -37 26 -37l53 21q4 2 11 2q14 0 14 -16v-146q0 -25 -25 -35q-43 -16 -61 -24t-18 -45v-291 q0 -23 -31 -23t-31 23v256q0 10 -8 23t-19 14l-133 -53q-20 -8 -20 -46zM352 40q0 95 -8 116q-6 12 -39 12t-86 -27t-55 -51q-6 -25 -6 -133q0 -107 5 -119t35 -12t84 26t62 56q8 37 8 132z"},accidentalDoubleSharp:{alternateCodepoint:"U+1D12A",codepoint:"U+E263",description:"Double sharp",bBoxNE:[.988,.508],bBoxSW:[0,-.5],path:"M293 2q0 -15 96 -68h21q68 0 82 -16t14 -78t-17 -78q-17 -18 -75 -18t-82 20q-10 8 -10 78q-8 27 -30 61t-40 34q-27 0 -64 -87q-4 -4 -4 -38t-17 -50q-17 -18 -75 -18t-82 20q-10 6 -10 76t13 82t85 12h21q29 10 61 30t33 40q0 14 -96 68l-21 -2q-61 0 -86 20 q-10 10 -10 80t13 80t77 10t78 -14q16 -12 16 -80q8 -29 30 -63t40 -33q25 0 68 96q0 72 12 83t78 11t80 -16t14 -78t-14 -76q-25 -20 -78 -20l-25 2q-96 -35 -96 -70z"},accidentalParensLeft:{codepoint:"U+E26A",description:"Accidental parenthesis, left",bBoxNE:[.564,.988],bBoxSW:[0,-.992],path:"M289 471q0 -6 -4 -10q-86 -78 -124 -186q-38 -107 -38 -277t37 -278t125 -185q4 -4 4 -8v-31q0 -4 -6 -4q-283 180 -283 508q0 158 72 294t215 212q2 0 2 -6v-29z"},accidentalParensRight:{codepoint:"U+E26B",description:"Accidental parenthesis, right",bBoxNE:[.564,.988],bBoxSW:[0,-.992],path:"M0 471v29q0 6 2 6q143 -76 215 -212t72 -294q0 -328 -283 -508q-6 0 -6 4v31q0 4 4 8q88 77 125 185t37 278t-38 278t-124 185q-4 4 -4 10z"},restWhole:{alternateCodepoint:"U+1D13B",codepoint:"U+E4E3",description:"Whole (semibreve) rest",bBoxNE:[1.128,.036],bBoxSW:[0,-.54],path:"M578 -223q0 -23 -16 -38t-38 -15h-471q-23 0 -38 15t-15 38v188q0 23 15 38t38 15h471q23 0 38 -15t16 -38v-188z"},restHalf:{alternateCodepoint:"U+1D13C",codepoint:"U+E4E4",description:"Half (minim) rest",bBoxNE:[1.128,.568],bBoxSW:[0,-.008],path:"M578 49q0 -21 -16 -37t-38 -16h-471q-23 0 -38 15t-15 38v189q0 24 15 38t38 15h471q23 1 38 -15t16 -38v-189z"},restQuarter:{alternateCodepoint:"U+1D13D",codepoint:"U+E4E5",description:"Quarter (crotchet) rest",bBoxNE:[1.08,1.492],bBoxSW:[.004,-1.5],path:"M236 -248q24 0 24 19q0 5 -24 45t-76 106l-101 123q-20 20 -20 50t29 59q122 129 122 253t-91 237q-33 42 -37 51t-5 26q0 43 41 43q20 0 37 -16l338 -396q8 -18 8 -36t-6 -29q-6 -10 -29 -46q-22 -35 -30 -49t-28 -48t-34 -84t-16 -78l-2 -27q0 -95 67 -192 q23 -32 74 -93q76 -82 76 -116q1 -8 -11 -8t-15 1q-3 2 -5 2q-92 35 -138 35t-54 -2q-47 -8 -72 -51t-25 -85t9 -64q4 -20 19 -48t34 -26q33 -29 33 -49q0 -3 -4 -15t-32 -12t-52 18q-238 182 -238 318q0 80 50 138t118 58l33 -6q25 -6 33 -6z"},rest8th:{alternateCodepoint:"U+1D13E",codepoint:"U+E4E6",description:"Eighth (quaver) rest",bBoxNE:[.988,.696],bBoxSW:[0,-1.004],path:"M274 219v-20q47 0 112 62q24 22 48 46l25 27q12 8 22 8q25 -12 25 -33q0 -3 -8 -31t-111 -398t-108 -374q-25 -20 -78 -20t-54 27q31 112 110 336q79 225 81 235t2 26t-8 17q-8 0 -30 -11q-72 -36 -134 -36t-113 35q-55 45 -55 103t40 98t97 40t97 -40t40 -97z"},rest16th:{alternateCodepoint:"U+1D13F",codepoint:"U+E4E7",description:"16th (semiquaver) rest",bBoxNE:[1.28,.716],bBoxSW:[0,-2],path:"M317 -385q-80 -43 -147 -43q-68 0 -119 39t-51 99t41 100t98 40t99 -40q41 -41 41 -99q0 -12 -3 -20q25 0 57 18t44 44t64 183t53 179q2 22 -4 22q-6 -1 -59 -25q-52 -24 -117 -24t-115 39q-51 39 -51 98t40 101t98 41t99 -41t41 -99v-20q59 0 162 112l24 25q12 8 23 8 q20 -10 20 -22v-2q-2 -4 -2 -6l-55 -207q-39 -137 -92 -312l-238 -780q-16 -47 -78 -47t-63 37v2q2 2 2 4l195 580v2q2 2 2 4q0 10 -9 10z"},rest32nd:{alternateCodepoint:"U+1D140",codepoint:"U+E4E8",description:"32nd (demisemiquaver) rest",bBoxNE:[1.452,1.704],bBoxSW:[0,-2],path:"M567 641q-5 0 -21 -8q-76 -39 -143 -39q-20 0 -55 9t-55 28q-57 43 -57 101t40 99q42 41 100 41t98 -41t40 -98v-18q58 0 162 109q23 24 30 29t17 5q20 0 20 -22l-2 -5v-4l-53 -206q-352 -1577 -358 -1597t-10 -26q-14 -22 -70 -22q-55 0 -55 33l147 598q0 12 -12 12 q-4 1 -48 -23q-44 -23 -111 -24q-68 0 -119 39q-52 39 -52 98t41 101t98 40q57 0 99 -39q41 -40 41 -100q0 -12 -3 -20q29 2 64 22t41 49l82 336q0 27 -14 27q-4 1 -51 -23q-48 -24 -90 -24q-92 0 -130 37q-57 43 -57 101t40 99t98 41t99 -41t41 -98q0 -12 -2 -18 q25 1 64 25t47 48l82 336q0 33 -23 33z"},rest64th:{alternateCodepoint:"U+1D141",codepoint:"U+E4E9",description:"64th (hemidemisemiquaver) rest",bBoxNE:[1.692,1.72],bBoxSW:[0,-3.012],path:"M0 -790q0 58 41 100q41 41 98 41t99 -40t41 -99q0 -12 -3 -19q25 0 55 16t37 38q7 21 44 171t39 162v6q2 6 2 23t-13 16q-6 1 -46 -23t-101 -24t-115 37q-57 43 -57 102t41 101t98 41q57 0 98 -41t41 -99v-20q79 0 109 88q18 51 48 185t30 141q0 18 -13 18q-4 0 -13 -4 q-92 -41 -160 -41q-67 0 -117 39q-51 39 -51 98t40 101t98 41q58 0 99 -41t41 -99v-20q27 1 70 27t50 48t46 175l37 151q4 16 4 21q0 23 -19 22q-6 -1 -63 -25t-114 -24t-109 40t-52 99t41 101t99 41q58 0 98 -41q41 -41 41 -99q0 -14 -2 -20q58 0 163 110q24 25 31 30t17 5 q18 -4 18 -30l-55 -209l-190 -820q-45 -203 -50 -202q-215 -920 -241 -1015t-25 -97q-13 -35 -73 -35t-60 29q0 8 2 14l148 571l2 13q0 23 -17 22q-4 0 -8 -2q-95 -48 -186 -25q-35 10 -56 29q-57 43 -57 101z"},rest128th:{alternateCodepoint:"U+1D142",codepoint:"U+E4EA",description:"128th (semihemidemisemiquaver) rest",bBoxNE:[1.94,2.756],bBoxSW:[0,-3],path:"M590 115q0 18 -12 18q-4 -1 -57 -25q-53 -25 -114 -24q-62 0 -113 40q-52 40 -52 99t41 101t98 41q57 0 98 -41t41 -99v-20q27 1 67 27t48 55l80 319q4 16 4 36t-7 20q-8 0 -48 -19t-66 -28t-78 -9q-54 0 -108 39t-54 98t41 101t99 41q58 0 98 -41q41 -41 41 -99v-20 q29 0 77 35t54 57q82 283 82 338q0 27 -25 27q-9 0 -31 -11t-53 -22l-2 -2q-3 0 -23 -7t-52 -7q-82 0 -121 36q-57 43 -57 101t40 100q42 41 100 41t98 -40t40 -99v-21q47 0 114 64t72 74q12 8 23 8q20 -10 20 -23l-2 -2v-6l-55 -207l-608 -2662q-6 -21 -20 -27t-68 -6 q-53 0 -54 33q2 6 76 303t76 300t2 11t-10 8h-2q-38 -19 -56 -25q-18 -5 -53 -18t-85 -1q-50 11 -77 32q-57 47 -57 105t41 98q41 41 98 41t99 -40t41 -99l6 -21q68 4 94 74q10 24 48 183t38 168t-12 9q-6 1 -55 -23q-49 -23 -110 -24q-61 0 -113 40t-52 99t41 101t98 41 q57 0 98 -41t41 -99l-2 -20q29 0 64 20q35 21 44 51t46 179q37 148 37 166z"},rest256th:{codepoint:"U+E4EB",description:"256th rest",bBoxNE:[2.164,2.784],bBoxSW:[0,-4],path:"M498 379q58 0 98 -41q41 -41 41 -98q0 -14 -2 -21q33 -1 72 23t49 65l78 322q2 8 2 24q0 29 -38 9q-79 -41 -149 -41q-69 1 -122 39q-52 38 -52 98t41 100q41 41 98 41q56 0 98 -41t42 -98q0 -14 -2 -21q34 0 78 29t55 68q4 11 40 158q35 147 40 159l2 12q0 31 -27 31 l-82 -33h-2q-32 -16 -93 -16t-104 37q-57 43 -57 101t41 99t98 41t99 -41t41 -98q0 -12 -2 -20q50 0 114 64q25 24 49 48l25 25q12 8 23 8q18 -10 18 -22v-9l-55 -206l-736 -3173q-4 -14 -9 -23q-14 -26 -70 -26q-55 0 -56 31q0 10 5 22q5 13 72 297t67 294t-11 7 q-11 -2 -30 -12q-84 -45 -172 -23q-29 8 -56 29q-57 43 -57 103t41 100q41 41 98 41t99 -41t41 -98q0 -14 -3 -21q72 0 93 78q6 23 35 139t47 184v5q4 4 4 24q1 21 -7 21t-57 -22t-109 -23q-60 0 -108 34q-57 47 -57 105t40 98q40 41 99 41t99 -41t40 -98q0 -12 -2 -21 q86 6 109 86l73 297q16 52 -4 54q-2 0 -53 -24t-112 -26q-61 -1 -114 40q-54 40 -54 100t41 100q41 41 98 41t98 -41t41 -98v-21q29 0 64 22t44 49t26 96l55 224l2 17q0 27 -15 26q-2 0 -57 -24t-94 -24q-78 -1 -130 39q-53 40 -53 100t41 100q41 41 99 41z"},rest512th:{codepoint:"U+E4EC",description:"512th rest",bBoxNE:[2.416,3.776],bBoxSW:[0,-4],path:"M958 1159q0 27 -22 27q-6 0 -28 -12q-62 -34 -133 -35q-70 0 -121 39q-52 39 -52 98t41 100t98 41t99 -41t41 -98v-21q31 0 73 29q42 30 50 54t25 100t35 146t18 75q1 3 1 23t-18 20q-4 0 -52 -24t-114 -25q-66 0 -118 39t-52 98t41 100t98 41q56 0 98 -41t42 -98 q0 -12 -2 -20q53 0 163 110l25 27q12 8 23 8q20 -10 20 -23v-4q-2 -2 -2 -4l-55 -207q-846 -3658 -852 -3677t-10 -27q-14 -25 -71 -25q-56 0 -57 39l144 592q0 12 -8 12t-18 -6q-10 -5 -54 -21q-42 -16 -74 -16q-82 0 -123 37q-57 43 -57 101t41 100t98 41q57 0 99 -40 t41 -100v-18q80 0 94 59l88 369q0 25 -15 25q-4 0 -26 -13t-58 -23q-114 -32 -180 17q-65 49 -65 109t41 100q41 41 99 41t98 -41t40 -98v-21q29 0 66 25t47 65l74 312q2 6 2 19t-13 13q-6 0 -53 -23t-90 -23q-91 -2 -131 36q-57 43 -57 103t40 99q40 40 98 40t99 -41 t41 -98q0 -12 -2 -19q31 -1 65 19t46 57q43 154 80 340q0 18 -13 18l-84 -35q-43 -14 -92 -14t-103 39q-55 39 -55 99t41 102t99 41q58 0 98 -41q41 -41 41 -99l-2 -20q31 0 67 20q36 21 44 57q80 309 81 328l2 13q0 31 -20 30q-4 0 -54 -24q-122 -58 -225 12 q-55 45 -55 103t41 100q41 41 98 41q56 0 98 -41t42 -98l-2 -21q34 0 74 25t51 65q79 311 79 338z"},rest1024th:{codepoint:"U+E4ED",description:"1024th rest",bBoxNE:[2.672,4.788],bBoxSW:[0,-3.972],path:"M852 2311q0 54 44 97t103 43t97 -46t39 -119q55 0 121 68t92 79q20 -10 20 -31l-213 -792q-101 -464 -467 -2030t-366 -1575q-8 -23 -22 -31t-58 -8q-12 0 -35 20t-23 27q10 15 77 285t68 284t-18 13l-69 -18q-27 -20 -76 -21l-60 8l-55 31q-51 33 -51 95t40 106 q40 43 95 43t95 -45t40 -121q70 0 101 67q2 8 40 181t48 178q0 8 -7 19t-16 12q-12 -8 -78 -31q-29 -18 -75 -19l-58 9l-59 30q-49 31 -49 95t40 106q40 43 95 43t96 -45t41 -121q92 27 117 94q10 39 39 167t29 140t-8 24q-7 11 -13 11q-11 -14 -36 -20t-32 -8 q-41 -23 -77 -23l-60 12l-55 29q-59 39 -59 97t41 101q43 42 97 42t98 -44t44 -120q88 29 106 77q27 70 54 197q26 127 26 134t-7 17t-15 11q-10 -6 -76 -29q-41 -18 -78 -18l-57 10l-59 29q-60 43 -60 100t45 99t91 43q46 0 78 -41t52 -82t27 -41q86 23 109 86l73 321 q0 37 -26 37l-78 -28q-29 -8 -98 -9h-37l-60 29q-57 61 -57 111t43 91q43 40 102 40q58 0 98 -42t40 -114q32 0 70 24t52 62l78 330q0 29 -30 28l-78 -28q-18 -8 -66 -8t-67 8q-14 0 -60 20q-57 57 -57 111t43 92q43 39 102 39t97 -42t38 -112q33 0 73 28t54 69l78 301 q6 27 6 38t-6 11l-108 -39q-17 -10 -67 -10t-66 10q-12 0 -30 7t-28 9q-59 59 -59 113t43 93q43 38 102 38q60 0 98 -41t37 -115q31 0 75 30q44 29 51 55t47 147t40 194q0 20 -28 21l-78 -29q-37 -20 -78 -20l-59 8l-58 29q-59 59 -59 113z"},tuplet0:{codepoint:"U+E880",description:"Tuplet 0",bBoxNE:[1.276,1.5],bBoxSW:[-.004,-.032],path:"M223 37q119 0 226 340q37 118 41 195q7 143 -64 143q-115 0 -223 -340q-71 -223 -31 -305q16 -33 51 -33zM414 768q121 0 179 -65t58 -157t-28 -196q-55 -172 -161 -269t-226 -97q-122 0 -179 64t-57 157q0 92 29 196q53 172 158 270q106 97 227 97z"},tuplet1:{codepoint:"U+E881",description:"Tuplet 1",bBoxNE:[1.024,1.488],bBoxSW:[.04,0],path:"M524 741q0 -2 -4 -22l-198 -627q-6 -27 8 -29l69 -6q27 -1 27 -29t-31 -28h-344q-31 0 -31 27t29 30l72 6q16 2 24 21l140 436q4 20 4 25q0 12 -12 12t-25 -18l-76 -82q-18 -23 -34 -23t-25 10q-10 10 -10 22t16 34l217 245q16 16 33 17l63 -19l70 19q18 0 18 -21z"},tuplet2:{codepoint:"U+E882",description:"Tuplet 2",bBoxNE:[1.316,1.5],bBoxSW:[.04,-.024],path:"M427 768q119 0 183 -47t64 -129q0 -223 -305 -293q-133 -31 -195 -100q-31 -35 -8 -35l33 12q35 14 75 14t96 -18t97 -18t76 45q14 23 30 22q31 0 31 -24q0 -10 -8 -29q-29 -92 -72 -136q-44 -44 -118 -44t-152 44t-111 44t-48 -41t-42 -41q-33 0 -33 31q0 8 7 32 q29 103 92 179t186 124q205 82 205 263q0 88 -107 88q-49 -1 -79 -19t-29 -36q-1 -18 23 -41t24 -63t-28 -71t-70 -31t-65 26q-22 26 -21 63q0 93 76 161t193 68z"},tuplet3:{codepoint:"U+E883",description:"Tuplet 3",bBoxNE:[1.224,1.5],bBoxSW:[.04,-.032],path:"M250 424h22q88 0 139 51q50 51 50 135q0 39 -26 67q-25 28 -87 28t-61 -29q0 -6 24 -27q19 -23 19 -57t-27 -63q-27 -27 -63 -27t-60 24q-23 24 -20 64q2 80 70 129q69 49 167 49t164 -47t66 -115q0 -127 -156 -192q-25 -12 -25 -20t23 -17q80 -41 80 -127 q0 -119 -92 -193q-92 -73 -210 -73t-172 46q-55 46 -55 104t29 92t68 34q82 0 82 -74q0 -66 -52 -88q-27 -12 -26 -24q0 -16 21 -27q22 -10 53 -10q86 1 137 69t51 132q0 126 -113 124h-20q-41 0 -41 31t41 31z"},tuplet4:{codepoint:"U+E884",description:"Tuplet 4",bBoxNE:[1.252,1.488],bBoxSW:[.04,0],path:"M348 268q14 0 21 17l37 116q6 20 22 39l131 142q25 26 51 26t25 -18q0 -6 -8 -39l-84 -266q-2 -17 10 -17h59q29 0 29 -28t-31 -29h-69q-16 0 -21 -16l-33 -103q-6 -27 9 -29l69 -6q27 -1 27 -29t-31 -28h-344q-31 0 -31 27t29 30l72 6q16 2 24 21l35 113q2 14 -10 14 h-279q-37 0 -37 27q0 14 21 34q131 131 207 241t110 226q8 23 27 23l98 -19l97 19q23 0 22 -17q0 -12 -10 -24q-74 -96 -194 -214t-185 -170t-66 -58q0 -10 17 -11h184z"},tuplet5:{codepoint:"U+E885",description:"Tuplet 5",bBoxNE:[1.308,1.492],bBoxSW:[.04,-.032],path:"M264 758q26 0 68 -13t125 -13q82 0 143 18l51 14q19 0 19 -18t-27 -46q-123 -115 -276 -114q-13 0 -61 6t-56 -17l-31 -92q-4 -16 1 -23t40 3t84 10q215 0 215 -168q0 -143 -92 -232t-236 -89q-102 0 -156 46q-55 46 -55 104t29 92t67 34t60 -19t23 -55q0 -66 -52 -88 q-27 -12 -26 -24q0 -16 21 -27q22 -10 53 -10q90 0 144 88t54 184t-94 97q-61 0 -123 -62q-20 -20 -39 -20q-33 0 -33 30q1 12 9 39l112 330q13 35 39 35z"},tuplet6:{codepoint:"U+E886",description:"Tuplet 6",bBoxNE:[1.256,1.5],bBoxSW:[.04,-.032],path:"M396 471q87 0 135 -50t49 -126q0 -147 -96 -229t-220 -82q-123 0 -184 66t-58 164q3 99 35 214q55 168 155 254t237 86q90 0 142 -41t52 -98t-28 -89q-27 -32 -67 -32t-66 22t-25 56q0 61 55 88q29 12 29 21q1 9 -21 17t-51 5q-152 -8 -242 -260q-8 -27 1 -34t24 5 q57 43 144 43zM338 397q-53 0 -97 -54t-61 -134q-35 -172 76 -172q61 0 110 77q48 77 48 180t-76 103z"},tuplet7:{codepoint:"U+E887",description:"Tuplet 7",bBoxNE:[1.332,1.488],bBoxSW:[.12,-.016],path:"M428 559q-52 -1 -120 19q-67 20 -93 20q-59 0 -92 -98q-8 -27 -35 -27t-27 21q1 4 5 16l69 221q10 25 37 25t27 -19l-9 -41q0 -8 6 -8t27 23q59 51 115 51t116 -42q62 -42 100 -42t56 51q10 27 41 27t31 -23q0 -10 -4 -31q-47 -156 -166 -293t-159 -266q-15 -49 -34 -129 q-4 -23 -26 -22l-88 18l-94 -18q-31 0 -15 35q66 213 244 352q14 12 59 47t85 69t61 67q22 32 16 39t-18 -1q-63 -41 -115 -41z"},tuplet8:{codepoint:"U+E888",description:"Tuplet 8",bBoxNE:[1.292,1.5],bBoxSW:[.04,-.032],path:"M428 719q-55 0 -90 -31t-35 -76q0 -46 22 -74t81 -71q27 -20 49 -8q80 55 80 151q-1 109 -107 109zM150 162q0 -53 32 -91t96 -38q66 0 106 36t40 84q0 49 -25 77t-108 92q-27 22 -47 10q-94 -57 -94 -170zM145 559q0 89 79 149t201 60t179 -48t58 -124q0 -111 -125 -176 q-13 -8 -21 -13q-14 -10 12 -42q54 -59 54 -157t-88 -161t-215 -63t-193 54t-66 140q0 137 148 197q29 12 31 21t-15 28q-39 45 -39 135z"},tuplet9:{codepoint:"U+E889",description:"Tuplet 9",bBoxNE:[1.256,1.5],bBoxSW:[.04,-.032],path:"M268 281q-88 0 -136 50t-48 126q0 147 96 229t219 82t185 -66t58 -164q-3 -98 -36 -214q-55 -168 -155 -254t-236 -86q-90 0 -142 41q-53 41 -53 98t28 89t68 32t66 -22t25 -56q0 -61 -55 -88q-29 -12 -29 -22q-1 -10 21 -16q22 -7 51 -5q152 8 241 260q8 27 -1 34 t-23 -5q-56 -43 -144 -43zM326 354q53 0 97 54t60 135q35 172 -75 172q-62 0 -110 -77q-48 -76 -48 -180t76 -104z"},tupletColon:{codepoint:"U+E88A",description:"Tuplet colon",bBoxNE:[.484,1.072],bBoxSW:[.04,.232],path:"M164 381q-35 -1 -55 23q-21 24 -21 60t25 60t59 25q34 0 54 -24q22 -25 22 -59t-24 -60t-60 -25zM96 119q-35 -1 -55 23q-21 24 -21 60t25 60t59 25q34 0 55 -24q21 -25 21 -59t-24 -60q-25 -25 -60 -25z"},dynamicPiano:{alternateCodepoint:"U+1D18F",codepoint:"U+E520",description:"Piano",bBoxNE:[1.464,1.096],bBoxSW:[-.356,-.568],opticalCenter:[1.22,0],path:"M506 485q-35 -1 -72 -37t-59 -92l-41 -100q-39 -98 -39 -141q0 -66 51 -66q68 0 138 137t69 218q0 81 -47 81zM252 35q-6 0 -16 -25l-93 -229q-4 -12 -4 -16t19 -5h82q25 0 24 -24q0 -27 -26 -27h-396q-25 0 -24 25q0 27 26 26h64q23 0 31 21l251 625q32 77 -10 75 q-47 0 -137 -155q-16 -31 -33 -31q-23 0 -22 22q0 11 34 75q90 166 230 167q94 0 109 -71q7 -30 20 -17q4 4 13 15q61 75 158 75t147 -47t51 -135q0 -150 -106 -275t-251 -124q-80 0 -114 34l-16 16q-5 5 -11 5z"},dynamicMezzo:{alternateCodepoint:"U+1D190",codepoint:"U+E521",description:"Mezzo",bBoxNE:[1.784,1.096],bBoxSW:[-.08,-.04],opticalCenter:[.872,0],path:"M740 561q122 -1 122 -119q0 -52 -59 -188t-59 -160t16 -24q35 0 104 110q16 27 32 27t17 -19q0 -12 -18 -43q-100 -166 -215 -165q-92 0 -92 81q0 45 63 189t63 177q0 32 -30 32q-70 0 -113 -103l-133 -331q-10 -25 -32 -25h-101q-23 0 -22 12q0 8 6 23l129 319 q20 47 20 76t-30 29q-70 0 -113 -103l-133 -331q-10 -25 -33 -25h-100q-23 0 -23 10t6 25l150 371q12 28 12 52t-22 23q-45 0 -140 -159q-16 -27 -30 -27q-23 0 -23 22q1 11 35 75t88 116t124 51q71 0 89 -62q2 -7 2 -17t5 -11q5 0 34 29q59 63 133 63t96 -49q8 -12 8 -28 q-1 -16 5 -15q6 0 34 29q60 63 128 63z"},dynamicForte:{alternateCodepoint:"U+1D191",codepoint:"U+E522",description:"Forte",bBoxNE:[1.456,1.776],bBoxSW:[-.564,-.608],opticalCenter:[1.256,0],path:"M-183 -61q93 1 93 -89q0 -58 -62 -81l-24 -9q-4 -2 -4 -8q0 -18 48 -18t84 56t81 210l129 449l4 20q0 8 -16 8h-119q-31 0 -31 32t33 32h119q24 0 28 4t13 26q117 338 376 338q176 0 176 -137q-1 -53 -29 -82q-28 -28 -70 -28q-93 1 -93 94q0 55 55 73q6 3 9 5t7 3t5 9 q0 16 -33 16q-72 0 -114 -70t-74 -217l-5 -19v-5q0 -10 21 -10h123q31 0 31 -32t-33 -32h-133q-6 0 -16 -9t-11 -13v-2q-2 -2 -2 -4q-72 -252 -157 -428t-167 -254t-194 -78q-68 0 -111 36t-43 92t31 89t75 33z"},dynamicRinforzando:{alternateCodepoint:"U+1D18C",codepoint:"U+E523",description:"Rinforzando",bBoxNE:[1.108,1.096],bBoxSW:[-.08,0],opticalCenter:[.612,0],path:"M-41 317q-1 11 33 75t88 116t128 51q73 1 90 -75q1 -4 1 -10q0 -5 5 -5t17 13q61 79 140 79q53 0 80 -31q27 -30 27 -80t-24 -80t-60 -30q-76 0 -76 66q0 34 22 56t23 25q0 13 -27 13t-69 -45t-62 -99l-133 -331q-10 -25 -33 -25h-100q-23 0 -23 10t6 25l150 371 q12 28 12 52t-22 23q-47 0 -140 -159q-12 -27 -32 -27t-21 22z"},dynamicSforzando:{alternateCodepoint:"U+1D18D",codepoint:"U+E524",description:"Sforzando",bBoxNE:[.916,1.092],bBoxSW:[0,-.04],opticalCenter:[.444,0],path:"M96 404q0 66 56 110q56 45 142 45q85 0 130 -33t45 -77q0 -91 -76 -91q-31 0 -51 18t-20 49q0 32 13 42t29 18q3 2 3 7q-1 22 -55 22q-98 -1 -97 -68q0 -28 19 -50t79 -66q101 -74 101 -161t-67 -138t-157 -51t-140 38t-50 86t24 76t58 27t54 -19q22 -18 22 -57t-44 -58 q-8 -3 -14 -4t-6 -12q0 -10 25 -19t67 -9q42 -1 70 27q29 28 29 74q-1 46 -69 93t-94 81t-26 100z"},dynamicZ:{alternateCodepoint:"U+1D18E",codepoint:"U+E525",description:"Z",bBoxNE:[.976,1.072],bBoxSW:[-.12,-.04],opticalCenter:[.5,0],path:"M281 165q0 30 19 50q19 21 49 21q29 0 51 -23t22 -79t-43 -106q-43 -48 -111 -48t-130 32q-60 32 -83 31t-51 -23t-39 -22q-27 0 -26 25q0 16 24 40l316 320q47 47 41 47t-32 -7q-28 -7 -70 -7t-60 3t-21 3q-10 0 -22 -25l-21 -43q-14 -31 -31 -30q-23 0 -22 20 q0 12 6 31l49 143q8 27 37 27l68 -8q148 -22 208 -5t64 17q27 -1 27 -21t-27 -47l-328 -323l-24 -35q28 12 58 12t74 -36t73 -36q29 -1 39 19t10 25t-6 6l-33 -11q-23 0 -39 16t-16 47z"},dynamicNiente:{codepoint:"U+E526",description:"Niente",bBoxNE:[1.232,1.096],bBoxSW:[-.092,-.04],opticalCenter:[.616,0],path:"M458 561q122 -1 122 -119q0 -52 -60 -188t-59 -160q0 -24 16 -24q35 0 105 110q16 27 32 27q36 0 -2 -62q-100 -166 -215 -165q-92 0 -92 81q-1 45 63 189t64 177q0 32 -31 32q-70 0 -112 -103l-133 -331q-10 -25 -33 -25h-100q-23 0 -23 10t6 25l150 371q12 28 12 52 t-23 23q-45 0 -139 -159q-16 -27 -31 -27q-23 0 -22 22q1 11 35 75t88 116t118 51q66 0 89 -47q8 -16 8 -30t5 -13q5 0 34 29q60 63 128 63z"},dynamicPPPPPP:{codepoint:"U+E527",description:"pppppp",bBoxNE:[8.512,1.096],bBoxSW:[-.408,-.568],opticalCenter:[4.248,0],path:"M4114 485q-36 -1 -72 -37t-59 -92l-41 -100q-39 -98 -39 -141q0 -66 52 -66q67 0 137 137t70 218t-48 81zM3387 485q-35 -1 -71 -37t-60 -92l-41 -100q-39 -98 -39 -141q0 -66 52 -66q68 0 138 137t68 218q0 81 -47 81zM2660 485q-36 -1 -72 -37t-59 -92l-41 -100 q-39 -98 -39 -141q0 -66 52 -66q67 0 137 137t70 218t-48 81zM1933 485q-35 -1 -71 -37t-60 -92l-41 -100q-39 -98 -39 -141q0 -66 52 -66q68 0 138 137t68 218q0 81 -47 81zM1206 485q-36 -1 -72 -37t-59 -92l-41 -100q-39 -98 -39 -141q0 -66 52 -66q67 0 137 137t70 218 t-48 81zM479 485q-35 -1 -71 -37t-60 -92l-41 -100q-39 -98 -39 -141q0 -66 51 -66q68 0 138 137q69 137 69 218t-47 81zM4358 379q0 -150 -106 -275t-250 -124q-88 0 -130 50q-5 5 -11 5t-17 -25l-92 -229q-4 -12 -4 -16t18 -5h82q25 0 25 -26t-27 -25h-395q-25 0 -25 26 t27 25h63q23 0 31 21l252 625q12 28 12 52t-30 23t-78 -73q-18 -25 -33 -25q-23 0 -23 20q0 14 17 39q82 117 186 117t120 -71q5 -21 11 -21t22 19q61 75 158 75t147 -47t50 -135zM3631 379q0 -150 -106 -275t-250 -124q-88 0 -130 50q-5 5 -11 5t-17 -25l-92 -229 q-4 -12 -4 -16t18 -5h82q25 0 25 -26t-27 -25h-395q-25 0 -25 26t27 25h63q23 0 31 21l252 625q12 28 12 52t-30 23t-78 -73q-18 -25 -33 -25q-23 0 -23 20q0 14 17 39q82 117 186 117t120 -71q7 -29 19 -17q4 4 14 15q61 75 158 75t147 -47t50 -135zM2904 379 q0 -150 -106 -275t-250 -124q-88 0 -130 50q-6 5 -12 5t-16 -25l-92 -229q-4 -12 -4 -16t18 -5h82q25 0 25 -26t-27 -25h-395q-25 0 -25 26t27 25h63q23 0 31 21l252 625q12 28 12 52t-30 23t-78 -73q-18 -25 -33 -25q-23 0 -23 20q0 14 17 39q82 117 186 117t120 -71 q7 -29 19 -17q4 4 14 15q61 75 158 75t147 -47t50 -135zM2177 379q0 -150 -106 -275t-250 -124q-88 0 -130 50q-5 5 -11 5t-17 -25l-92 -229q-4 -12 -4 -16t18 -5h82q25 0 25 -26t-27 -25h-395q-25 0 -25 26t27 25h63q23 0 31 21l252 625q12 28 12 52t-30 23t-78 -73 q-18 -25 -33 -25q-23 0 -23 20q0 14 17 39q82 117 186 117t120 -71q7 -29 19 -17q4 4 14 15q61 75 158 75t147 -47t50 -135zM1450 379q0 -150 -106 -275t-250 -124q-88 0 -130 50q-6 5 -12 5t-16 -25l-92 -229q-4 -12 -4 -16t18 -5h82q25 0 25 -26t-27 -25h-395 q-25 0 -25 26t27 25h63q23 0 31 21l252 625q12 28 12 52t-30 23t-78 -73q-18 -25 -33 -25q-23 0 -23 20q0 14 17 39q82 117 186 117t120 -71q7 -29 19 -17q4 4 14 15q61 75 158 75t147 -47t50 -135zM526 561q97 0 147 -47t50 -135q-1 -150 -107 -275t-249 -124 q-88 0 -130 50q-5 5 -11 5t-17 -25l-92 -229q-4 -12 -4 -16t18 -5h82q25 0 25 -26t-27 -25h-395q-25 0 -25 26t27 25h63q23 0 31 21l252 625q12 28 12 52t-22 23q-47 0 -138 -155q-16 -31 -32 -31q-23 0 -23 22q1 11 35 75q90 166 229 167q95 0 110 -71q7 -29 19 -17 q4 4 14 15q61 75 158 75z"},dynamicPPPPP:{codepoint:"U+E528",description:"ppppp",bBoxNE:[7.092,1.096],bBoxSW:[-.408,-.568],opticalCenter:[3.552,0],path:"M3387 485q-35 -1 -71 -37t-60 -92l-41 -100q-39 -98 -39 -141q0 -66 52 -66q68 0 138 137t68 218q0 81 -47 81zM2660 485q-36 -1 -72 -37t-59 -92l-41 -100q-39 -98 -39 -141q0 -66 52 -66q67 0 137 137t70 218t-48 81zM1933 485q-35 -1 -71 -37t-60 -92l-41 -100 q-39 -98 -39 -141q0 -66 52 -66q68 0 138 137t68 218q0 81 -47 81zM1206 485q-36 -1 -72 -37t-59 -92l-41 -100q-39 -98 -39 -141q0 -66 52 -66q67 0 137 137t70 218t-48 81zM479 485q-35 -1 -71 -37t-60 -92l-41 -100q-39 -98 -39 -141q0 -66 51 -66q68 0 138 137 q69 137 69 218t-47 81zM3631 379q0 -150 -106 -275t-250 -124q-88 0 -130 50q-5 5 -11 5t-17 -25l-92 -229q-4 -12 -4 -16t18 -5h82q25 0 25 -26t-27 -25h-395q-25 0 -25 26t27 25h63q23 0 31 21l252 625q12 28 12 52t-30 23t-78 -73q-18 -25 -33 -25q-23 0 -23 20 q0 14 17 39q82 117 186 117t120 -71q7 -29 19 -17q4 4 14 15q61 75 158 75t147 -47t50 -135zM2904 379q0 -150 -106 -275t-250 -124q-88 0 -130 50q-6 5 -12 5t-16 -25l-92 -229q-4 -12 -4 -16t18 -5h82q25 0 25 -26t-27 -25h-395q-25 0 -25 26t27 25h63q23 0 31 21l252 625 q12 28 12 52t-30 23t-78 -73q-18 -25 -33 -25q-23 0 -23 20q0 14 17 39q82 117 186 117t120 -71q7 -29 19 -17q4 4 14 15q61 75 158 75t147 -47t50 -135zM2177 379q0 -150 -106 -275t-250 -124q-88 0 -130 50q-5 5 -11 5t-17 -25l-92 -229q-4 -12 -4 -16t18 -5h82 q25 0 25 -26t-27 -25h-395q-25 0 -25 26t27 25h63q23 0 31 21l252 625q12 28 12 52t-30 23t-78 -73q-18 -25 -33 -25q-23 0 -23 20q0 14 17 39q82 117 186 117t120 -71q7 -29 19 -17q4 4 14 15q61 75 158 75t147 -47t50 -135zM1450 379q0 -150 -106 -275t-250 -124 q-88 0 -130 50q-6 5 -12 5t-16 -25l-92 -229q-4 -12 -4 -16t18 -5h82q25 0 25 -26t-27 -25h-395q-25 0 -25 26t27 25h63q23 0 31 21l252 625q12 28 12 52t-30 23t-78 -73q-18 -25 -33 -25q-23 0 -23 20q0 14 17 39q82 117 186 117t120 -71q7 -29 19 -17q4 4 14 15 q61 75 158 75t147 -47t50 -135zM526 561q97 0 147 -47t50 -135q-1 -150 -107 -275t-249 -124q-88 0 -130 50q-5 5 -11 5t-17 -25l-92 -229q-4 -12 -4 -16t18 -5h82q25 0 25 -26t-27 -25h-395q-25 0 -25 26t27 25h63q23 0 31 21l252 625q12 28 12 52t-22 23q-47 0 -138 -155 q-16 -31 -32 -31q-23 0 -23 22q1 11 35 75q90 166 229 167q95 0 110 -71q7 -29 19 -17q4 4 14 15q61 75 158 75z"},dynamicPPPP:{codepoint:"U+E529",description:"pppp",bBoxNE:[5.672,1.096],bBoxSW:[-.408,-.568],opticalCenter:[3.004,0],path:"M2660 485q-36 -1 -72 -37t-59 -92l-41 -100q-39 -98 -39 -141q0 -66 52 -66q67 0 137 137t70 218t-48 81zM1933 485q-35 -1 -71 -37t-60 -92l-41 -100q-39 -98 -39 -141q0 -66 52 -66q68 0 138 137t68 218q0 81 -47 81zM1206 485q-36 -1 -72 -37t-59 -92l-41 -100 q-39 -98 -39 -141q0 -66 52 -66q67 0 137 137t70 218t-48 81zM479 485q-35 -1 -71 -37t-60 -92l-41 -100q-39 -98 -39 -141q0 -66 51 -66q68 0 138 137q69 137 69 218t-47 81zM2904 379q0 -150 -106 -275t-250 -124q-88 0 -130 50q-6 5 -12 5t-16 -25l-92 -229 q-4 -12 -4 -16t18 -5h82q25 0 25 -26t-27 -25h-395q-25 0 -25 26t27 25h63q23 0 31 21l252 625q12 28 12 52t-30 23t-78 -73q-18 -25 -33 -25q-23 0 -23 20q0 14 17 39q82 117 186 117t120 -71q7 -29 19 -17q4 4 14 15q61 75 158 75t147 -47t50 -135zM2177 379 q0 -150 -106 -275t-250 -124q-88 0 -130 50q-5 5 -11 5t-17 -25l-92 -229q-4 -12 -4 -16t18 -5h82q25 0 25 -26t-27 -25h-395q-25 0 -25 26t27 25h63q23 0 31 21l252 625q12 28 12 52t-30 23t-78 -73q-18 -25 -33 -25q-23 0 -23 20q0 14 17 39q82 117 186 117t120 -71 q7 -29 19 -17q4 4 14 15q61 75 158 75t147 -47t50 -135zM1450 379q0 -150 -106 -275t-250 -124q-88 0 -130 50q-6 5 -12 5t-16 -25l-92 -229q-4 -12 -4 -16t18 -5h82q25 0 25 -26t-27 -25h-395q-25 0 -25 26t27 25h63q23 0 31 21l252 625q12 28 12 52t-30 23t-78 -73 q-18 -25 -33 -25q-23 0 -23 20q0 14 17 39q82 117 186 117t120 -71q7 -29 19 -17q4 4 14 15q61 75 158 75t147 -47t50 -135zM526 561q97 0 147 -47t50 -135q-1 -150 -107 -275t-249 -124q-88 0 -130 50q-5 5 -11 5t-17 -25l-92 -229q-4 -12 -4 -16t18 -5h82q25 0 25 -26 t-27 -25h-395q-25 0 -25 26t27 25h63q23 0 31 21l252 625q12 28 12 52t-22 23q-47 0 -138 -155q-16 -31 -32 -31q-23 0 -23 22q1 11 35 75q90 166 229 167q95 0 110 -71q7 -29 19 -17q4 4 14 15q61 75 158 75z"},dynamicPPP:{codepoint:"U+E52A",description:"ppp",bBoxNE:[4.292,1.096],bBoxSW:[-.368,-.568],opticalCenter:[2.368,0],
path:"M1954 485q-35 -1 -72 -37t-59 -92l-41 -100q-39 -98 -39 -141q0 -66 51 -66q68 0 138 137t69 218q0 81 -47 81zM1227 485q-35 -1 -72 -37t-59 -92l-41 -100q-39 -98 -39 -141q0 -66 51 -66q67 0 137 137t70 218t-47 81zM500 485q-35 -1 -72 -37t-59 -92l-41 -100 q-39 -98 -39 -141q0 -66 51 -66q68 0 138 137t69 218q0 81 -47 81zM1700 35q-6 0 -17 -25l-92 -229q-4 -12 -4 -16t19 -5h82q25 0 24 -24q0 -27 -26 -27h-396q-25 0 -24 25q0 27 26 26h64q23 0 30 21l252 625q32 77 -10 75q-37 0 -86 -73q-18 -25 -33 -25q-23 0 -22 20 q0 14 16 39q82 117 186 117t120 -71q7 -30 20 -17q4 4 13 15q61 75 158 75t147 -47t51 -135q0 -150 -106 -275t-251 -124q-88 0 -130 50q-5 5 -11 5zM1470 379q0 -150 -106 -275t-250 -124q-88 0 -130 50q-5 5 -11 5t-17 -25l-92 -229q-4 -12 -4 -16t19 -5h82q25 0 24 -24 q0 -27 -27 -27h-395q-25 0 -24 25q0 27 26 26h64q23 0 30 21l252 625q32 77 -10 75q-37 0 -86 -73q-18 -25 -33 -25q-23 0 -22 20q0 14 16 39q82 117 186 117t120 -71q7 -30 20 -17q4 4 13 15q61 75 158 75t147 -47t50 -135zM546 561q97 0 147 -47t50 -135q0 -150 -106 -275 t-250 -124q-88 0 -130 50q-5 5 -11 5t-17 -25l-92 -229q-4 -12 -4 -16t19 -5h81q25 0 25 -26t-27 -25h-395q-25 0 -24 25q0 27 26 26h64q23 0 30 21l252 625q32 77 -10 75q-47 0 -137 -155q-16 -31 -33 -31q-23 0 -22 22q0 11 34 75q90 166 230 167q94 0 109 -71 q7 -30 20 -17q4 4 13 15q61 75 158 75z"},dynamicPP:{codepoint:"U+E52B",description:"pp",bBoxNE:[2.912,1.096],bBoxSW:[-.328,-.568],opticalCenter:[1.708,0],path:"M1247 485q-35 -1 -71 -37t-60 -92l-41 -100q-39 -98 -39 -141q0 -66 51 -66q68 0 138 137q69 137 69 218t-47 81zM520 485q-36 -1 -72 -37t-59 -92l-41 -100q-39 -98 -39 -141q0 -66 51 -66q68 0 138 137t70 218t-48 81zM1491 379q-1 -150 -107 -275t-249 -124 q-88 0 -130 50q-5 5 -11 5t-17 -25l-92 -229q-4 -12 -4 -16t18 -5h82q25 0 25 -26t-27 -25h-395q-25 0 -25 26t27 25h63q23 0 31 21l252 625q12 28 12 52t-30 23t-78 -73q-18 -25 -33 -25q-23 0 -23 20q0 14 17 39q82 117 186 117t120 -71q7 -29 19 -17q4 4 14 15 q61 75 158 75t147 -47t50 -135zM567 561q97 0 147 -47t50 -135q0 -150 -106 -275t-250 -124q-88 0 -130 50q-6 5 -12 5t-16 -25l-92 -229q-4 -12 -4 -16t18 -5h82q25 0 25 -26t-27 -25h-395q-25 0 -25 26t27 25h63q23 0 31 21l252 625q12 28 12 52t-22 23q-47 0 -138 -155 q-16 -31 -32 -31q-23 0 -23 22q0 11 34 75q90 166 230 167q95 0 110 -71q7 -29 19 -17q4 4 14 15q62 75 158 75z"},dynamicMP:{codepoint:"U+E52C",description:"mp",bBoxNE:[3.3,1.096],bBoxSW:[-.08,-.568],opticalCenter:[1.848,0],path:"M1286 49q68 0 138 137q70 136 69 218q0 82 -47 81q-35 -1 -72 -37t-59 -92l-41 -100q-39 -98 -39 -141q0 -66 51 -66zM740 561q124 -1 122 -119q0 -52 -59 -188t-59 -160t16 -24q57 -1 149 200l15 33q84 191 170 235q43 22 115 21t93 -71q7 -29 19 -17q4 4 13 15 q61 75 158 75t147 -47t51 -135q0 -150 -106 -275t-251 -124q-80 0 -114 34l-16 16q-5 5 -11 5t-16 -25l-93 -229q-4 -12 -4 -16t19 -5h82q25 0 24 -24q0 -27 -26 -27h-396q-25 0 -24 25q0 27 26 26h64q23 0 31 21l251 625q32 77 -8 75q-61 -1 -171 -251t-271 -250 q-92 0 -92 81q0 45 63 189t63 177q0 32 -30 32q-70 0 -113 -103l-133 -331q-10 -25 -32 -25h-101q-23 0 -22 12q0 8 6 23l129 319q20 47 20 76t-30 29q-70 0 -113 -103l-133 -331q-10 -25 -33 -25h-100q-23 0 -23 10t6 25l150 371q12 28 12 52t-22 23q-45 0 -140 -159 q-16 -27 -30 -27q-23 0 -23 22q1 11 35 75t88 116t124 51q71 0 89 -62q2 -7 2 -17t5 -11q5 0 34 29q59 63 133 63t96 -49q8 -12 8 -28q-1 -16 5 -15q6 0 34 29q59 63 128 63z"},dynamicMF:{codepoint:"U+E52D",description:"mf",bBoxNE:[3.272,1.724],bBoxSW:[-.08,-.66],opticalCenter:[1.796,0],path:"M747 -88q93 0 93 -90q0 -58 -62 -80q-10 -4 -19 -6t-9 -10q0 -18 48 -18t84 55q36 56 81 210l129 449l4 20q0 8 -17 9h-118q-31 -1 -31 31t33 32h118q23 0 28 4t13 27q117 338 377 338q176 0 176 -138q-1 -53 -29 -81t-70 -29q-42 1 -68 23t-25 74t55 71q6 2 9 4q3 1 7 3 t5 9q0 16 -33 17q-72 0 -117 -74q-45 -75 -76 -233v-5q0 -10 21 -10h123q31 0 30 -31q0 -33 -32 -32h-134q-6 1 -16 -9t-10 -14v-2l-2 -4q-72 -252 -157 -428t-167 -254t-194 -78q-68 0 -111 36t-43 92t31 89t75 33zM740 561q122 -1 122 -119q0 -52 -59 -188t-59 -160 t16 -24q35 0 104 110q16 27 32 27t17 -19q0 -12 -18 -43q-100 -166 -215 -165q-92 0 -92 81q0 45 63 189t63 177q0 32 -30 32q-70 0 -113 -103l-133 -331q-10 -25 -32 -25h-101q-23 0 -22 12q0 8 6 23l129 319q20 47 20 76t-30 29q-70 0 -113 -103l-133 -331 q-10 -25 -33 -25h-100q-23 0 -23 10t6 25l150 371q12 28 12 52t-22 23q-45 0 -140 -159q-16 -27 -30 -27q-23 0 -23 22q1 11 35 75t88 116t124 51q71 0 89 -62q2 -7 2 -17t5 -11q5 0 34 29q59 63 133 63t96 -49q8 -12 8 -28q-1 -16 5 -15q6 0 34 29q60 63 128 63z"},dynamicPF:{codepoint:"U+E52E",description:"pf",bBoxNE:[3.08,1.776],bBoxSW:[-.288,-.608],opticalCenter:[1.68,0],path:"M981 477h-119q-31 0 -31 32t33 32h119q23 0 28 4t13 26q117 338 377 338q176 0 176 -137q0 -53 -29 -82q-28 -28 -70 -28t-68 22t-26 76q0 53 56 69q6 3 9 5t7 3t4 9q0 16 -33 16q-72 0 -115 -72t-77 -234v-5q0 -10 20 -10h123q31 0 31 -32t-33 -32h-133q-6 0 -16 -9 t-10 -13v-2q-2 -2 -3 -4q-72 -252 -156 -428t-167 -254q-82 -78 -195 -78q-68 0 -110 36t-43 92q0 56 30 89q31 33 75 33t69 -23t24 -73t-61 -74l-25 -9q-4 -2 -4 -8q0 -18 48 -18t84 56t81 210l129 449l4 20q0 8 -16 8zM45 295q-23 0 -22 22q1 11 35 75q90 167 229 167 q94 0 109 -71q7 -30 20 -17q4 4 13 15q61 75 158 75t147 -47t50 -135q0 -150 -106 -275t-250 -124q-88 0 -130 50q-5 5 -11 5t-17 -25l-92 -229q-4 -12 -4 -16t19 -5h81q25 0 25 -26t-27 -25h-395q-25 0 -24 25q0 27 26 26h64q22 1 30 21l252 625q32 77 -10 75 q-47 0 -137 -155q-16 -31 -33 -31zM330 115q0 -66 51 -66q67 0 137 137q70 136 70 218t-47 81q-35 0 -72 -36q-36 -38 -59 -93l-41 -100q-39 -98 -39 -141z"},dynamicFF:{codepoint:"U+E52F",description:"ff",bBoxNE:[2.44,1.776],bBoxSW:[-.54,-.608],opticalCenter:[1.852,0],path:"M571 862q-91 0 -137 -224q-18 -85 -18 -87q0 -10 20 -10h219q23 0 28 4t13 26q117 338 377 338q176 0 176 -137q-1 -53 -29 -82q-28 -28 -70 -28t-68 22t-25 75q1 52 55 70q6 3 9 5t7 4t5 8q0 16 -33 16q-72 0 -115 -72t-78 -234v-5q0 -10 21 -10h123q31 0 30 -31 q0 -33 -32 -33h-134q-6 0 -16 -9t-10 -13v-2q-2 -2 -2 -4q-72 -252 -157 -428t-167 -254t-194 -78q-66 -1 -107 33t-41 88t27 84q27 28 69 28q41 0 65 -22t24 -64q0 -43 -33 -64q-33 -22 -33 -30t20 -8q59 0 96 56q36 56 81 210l129 449l4 20q0 8 -17 8h-229q-6 0 -16 -9 t-11 -13v-2q-2 -2 -2 -4q-73 -252 -157 -428t-166 -254t-195 -78q-69 0 -111 36t-42 92t30 89q31 33 75 33t69 -23q24 -22 24 -66q-1 -61 -77 -87q-13 -3 -13 -11q0 -18 48 -18t84 56t81 210l129 449l4 20q0 8 -16 8h-119q-31 0 -31 32t33 32h119q24 0 28 4t13 26 q55 164 139 251t225 87q80 1 119 -33t39 -79q0 -104 -90 -105q-86 0 -86 84q0 32 18 54q19 22 19 27t-17 5z"},dynamicFFF:{codepoint:"U+E530",description:"fff",bBoxNE:[3.32,1.776],bBoxSW:[-.62,-.608],opticalCenter:[2.472,0],path:"M1022 862q-92 0 -139 -226q-17 -83 -17 -89t21 -6h219q23 0 28 4t13 26q117 338 377 338q176 0 176 -137q0 -53 -29 -82q-29 -28 -71 -28q-93 1 -93 94q0 57 56 73q6 3 9 5t7 3t4 9q0 16 -33 16q-72 0 -115 -72t-77 -234v-5q0 -10 20 -10h123q31 0 31 -32t-33 -32h-133 q-6 0 -16 -9t-11 -13v-2q-2 -2 -2 -4q-73 -252 -157 -428t-166 -254t-195 -78q-67 -1 -107 33t-40 88t26 84q27 28 69 28t66 -22q23 -22 23 -64q0 -43 -33 -64q-60 -38 -12 -38q59 0 95 56t81 210l129 449l4 20q0 8 -16 8h-230q-6 0 -16 -9t-10 -13v-2q-2 -2 -2 -4 q-72 -252 -157 -428t-167 -254t-194 -78q-66 -1 -107 33t-41 88t27 84q27 28 69 28t66 -22t23 -64q0 -43 -33 -64q-33 -22 -33 -30t20 -8q59 0 96 56q36 56 81 210l129 449l4 20q0 8 -17 8h-229q-6 0 -16 -9t-11 -13v-2q-2 -2 -2 -4q-72 -252 -156 -428t-167 -254 q-82 -78 -195 -78q-68 0 -110 36t-43 92q0 56 30 89q31 33 75 33t69 -23q25 -22 25 -66q-1 -61 -78 -87q-13 -3 -13 -11q0 -18 48 -18t84 56t81 210l129 449l4 20q0 8 -16 8h-119q-31 0 -31 32t33 32h119q23 0 28 4t13 26q55 164 139 251t225 87q80 1 119 -33t39 -79 q0 -104 -90 -105q-86 0 -86 84q0 32 18 54t18 27t-16 5q-55 0 -87 -70t-50 -154q-18 -85 -18 -87q0 -10 20 -10h219q23 0 28 4t13 26q55 164 139 251t226 87q80 1 119 -33t39 -79q0 -105 -88 -105t-89 84q1 32 19 54t18 27t-16 5z"},dynamicFFFF:{codepoint:"U+E531",description:"ffff",bBoxNE:[4.28,1.776],bBoxSW:[-.62,-.608],opticalCenter:[2.824,0],path:"M1513 862q-91 0 -137 -224q-18 -85 -18 -87q0 -10 20 -10h219q23 0 28 4t13 26q117 338 377 338q176 0 176 -137q-1 -53 -29 -82q-28 -28 -70 -28t-68 22t-25 75q1 52 55 70q6 3 9 5t7 3t5 9q0 16 -33 16q-72 0 -115 -72t-78 -234v-5q0 -10 21 -10h123q31 0 30 -31 q0 -33 -32 -33h-133q-6 0 -16 -9t-11 -13v-2q-2 -2 -2 -4q-72 -252 -157 -428t-167 -254t-194 -78q-66 -1 -107 33t-41 88t27 84q27 28 69 28q41 0 65 -22t24 -64q0 -43 -33 -64q-33 -22 -33 -30t21 -8q59 0 95 56t81 210l129 449l4 20q0 8 -17 8h-229q-6 0 -16 -9t-11 -13 v-2q-2 -2 -2 -4q-73 -252 -157 -428t-166 -254t-195 -78q-67 -1 -107 33t-40 88t26 84q27 28 69 28t66 -22q23 -22 23 -64q0 -43 -33 -64q-60 -38 -12 -38q59 0 95 56t81 210l129 449l4 20q0 8 -16 8h-230q-6 0 -16 -9t-10 -13v-2q-2 -2 -2 -4q-72 -252 -157 -428t-167 -254 t-194 -78q-66 -1 -107 33t-41 88t27 84q27 28 69 28t66 -22t23 -64q0 -43 -33 -64q-33 -22 -33 -30t20 -8q59 0 96 56q36 56 81 210l129 449l4 20q0 8 -17 8h-229q-6 0 -16 -9t-11 -13v-2q-2 -2 -2 -4q-72 -252 -156 -428t-167 -254q-82 -78 -195 -78q-68 0 -110 36t-43 92 q0 56 30 89q31 33 75 33t69 -23q25 -22 25 -66q-1 -61 -78 -87q-13 -3 -13 -11q0 -18 48 -18t84 56t81 210l129 449l4 20q0 8 -16 8h-119q-31 0 -31 32t33 32h119q23 0 28 4t13 26q55 164 139 251t225 87q80 1 119 -33t39 -79q0 -104 -90 -105q-86 0 -86 84q0 32 18 54 t18 27t-16 5q-55 0 -87 -70t-50 -154q-18 -85 -18 -87q0 -10 20 -10h219q23 0 28 4t13 26q55 164 139 251t226 87q80 1 119 -33t39 -79q0 -105 -88 -105t-89 84q1 32 19 54t18 27t-16 5q-92 0 -139 -226q-17 -83 -17 -89t21 -6h219q23 0 28 4t13 26q55 164 139 251t225 87 q80 1 119 -33t39 -79q0 -104 -90 -105q-86 0 -86 84q0 32 18 54q19 22 19 27t-17 5z"},dynamicFFFFF:{codepoint:"U+E532",description:"fffff",bBoxNE:[5.24,1.776],bBoxSW:[-.62,-.608],opticalCenter:[2.976,0],path:"M2005 862q-92 0 -139 -226q-16 -83 -16 -89t20 -6h219q23 0 28 4t13 26q117 338 377 338q176 0 176 -137q0 -53 -29 -82q-28 -28 -70 -28t-68 22t-26 76q0 53 56 69q6 3 9 5t7 3t4 9q0 16 -33 16q-72 0 -115 -72t-77 -234v-5q0 -10 20 -10h123q31 0 31 -32t-33 -32h-133 q-6 0 -16 -9t-11 -13v-2q-2 -2 -2 -4q-72 -252 -156 -428t-167 -254q-82 -78 -195 -78q-66 -1 -106 33t-41 88q0 54 26 84q27 28 69 28t66 -22t24 -64q0 -43 -34 -64q-60 -38 -12 -38q59 0 95 56t81 210l129 449l4 20q0 8 -16 8h-229q-6 0 -16 -9t-11 -13v-2q-2 -2 -2 -4 q-72 -252 -157 -428t-167 -254t-194 -78q-66 -1 -107 33t-41 88t27 84q27 28 69 28q41 0 65 -22t24 -64q0 -43 -33 -64q-33 -22 -33 -30t21 -8q59 0 95 56t81 210l129 449l4 20q0 8 -17 8h-229q-6 0 -16 -9t-11 -13v-2q-2 -2 -2 -4q-73 -252 -157 -428t-166 -254t-195 -78 q-67 -1 -107 33t-40 88t26 84q27 28 69 28t66 -22q23 -22 23 -64q0 -43 -33 -64q-60 -38 -12 -38q59 0 95 56t81 210l129 449l4 20q0 8 -16 8h-230q-6 0 -16 -9t-10 -13v-2q-2 -2 -2 -4q-72 -252 -157 -428t-167 -254t-194 -78q-66 -1 -107 33t-41 88t27 84q27 28 69 28 t66 -22t23 -64q0 -43 -33 -64q-33 -22 -33 -30t20 -8q59 0 96 56q36 56 81 210l129 449l4 20q0 8 -17 8h-229q-6 0 -16 -9t-11 -13v-2q-2 -2 -2 -4q-72 -252 -156 -428t-167 -254q-82 -78 -195 -78q-68 0 -110 36t-43 92q0 56 30 89q31 33 75 33t69 -23q25 -22 25 -66 q-1 -61 -78 -87q-13 -3 -13 -11q0 -18 48 -18t84 56t81 210l129 449l4 20q0 8 -16 8h-119q-31 0 -31 32t33 32h119q23 0 28 4t13 26q55 164 139 251t225 87q80 1 119 -33t39 -79q0 -104 -90 -105q-86 0 -86 84q0 32 18 54t18 27t-16 5q-55 0 -87 -70t-50 -154 q-18 -85 -18 -87q0 -10 20 -10h219q23 0 28 4t13 26q55 164 139 251t226 87q80 1 119 -33t39 -79q0 -105 -88 -105t-89 84q1 32 19 54t18 27t-16 5q-92 0 -139 -226q-17 -83 -17 -89t21 -6h219q23 0 28 4t13 26q55 164 139 251t225 87q80 1 119 -33t39 -79q0 -104 -90 -105 q-86 0 -86 84q0 32 18 54q19 22 19 27t-17 5q-55 0 -87 -70t-50 -154q-18 -85 -18 -87q0 -10 20 -10h219q23 0 28 4t13 26q56 164 140 251t225 87q80 1 119 -33t39 -79q0 -104 -90 -105q-86 0 -86 84q0 32 18 54t18 27t-16 5z"},dynamicFFFFFF:{codepoint:"U+E533",description:"ffffff",bBoxNE:[6.2,1.776],bBoxSW:[-.62,-.608],opticalCenter:[3.504,0],path:"M2497 862q-92 0 -138 -224q-18 -85 -18 -87q0 -10 20 -10h219q23 0 28 4t13 26q117 338 377 338q176 0 176 -137q0 -53 -28 -82q-28 -28 -71 -28q-42 0 -68 22t-25 75q1 52 55 70q6 3 9 5q4 2 8 3t4 9q0 16 -33 16q-72 0 -115 -72t-78 -234v-5q0 -10 21 -10h123 q31 0 30 -31q0 -33 -32 -33h-133q-7 0 -17 -9t-10 -13v-2q-2 -2 -2 -4q-72 -252 -157 -428t-167 -254t-194 -78q-66 -1 -107 33t-41 88t27 84q27 28 69 28t66 -22t23 -64q0 -43 -33 -64q-33 -22 -33 -30t21 -8q59 0 95 56t81 210l129 449l4 20q0 8 -17 8h-229q-6 0 -16 -9 t-11 -13v-2q-2 -2 -2 -4q-72 -252 -156 -428t-167 -254q-82 -78 -195 -78q-66 -1 -106 33t-41 88q0 54 26 84q27 28 69 28t66 -22t24 -64q0 -43 -34 -64q-60 -38 -12 -38q59 0 95 56t81 210l129 449l4 20q0 8 -16 8h-229q-6 0 -16 -9t-11 -13v-2q-2 -2 -2 -4 q-72 -252 -157 -428t-167 -254t-194 -78q-66 -1 -107 33t-41 88t27 84q27 28 69 28q41 0 65 -22t24 -64q0 -43 -33 -64q-33 -22 -33 -30t21 -8q59 0 95 56t81 210l129 449l4 20q0 8 -17 8h-229q-6 0 -16 -9t-11 -13v-2q-2 -2 -2 -4q-73 -252 -157 -428t-166 -254t-195 -78 q-67 -1 -107 33t-40 88t26 84q27 28 69 28t66 -22q23 -22 23 -64q0 -43 -33 -64q-60 -38 -12 -38q59 0 95 56t81 210l129 449l4 20q0 8 -16 8h-230q-6 0 -16 -9t-10 -13v-2q-2 -2 -2 -4q-72 -252 -157 -428t-167 -254t-194 -78q-66 -1 -107 33t-41 88t27 84q27 28 69 28 t66 -22t23 -64q0 -43 -33 -64q-33 -22 -33 -30t20 -8q59 0 96 56q36 56 81 210l129 449l4 20q0 8 -17 8h-229q-6 0 -16 -9t-11 -13v-2q-2 -2 -2 -4q-72 -252 -156 -428t-167 -254q-82 -78 -195 -78q-68 0 -110 36t-43 92q0 56 30 89q31 33 75 33t69 -23q25 -22 25 -66 q-1 -61 -78 -87q-13 -3 -13 -11q0 -18 48 -18t84 56t81 210l129 449l4 20q0 8 -16 8h-119q-31 0 -31 32t33 32h119q23 0 28 4t13 26q55 164 139 251t225 87q80 1 119 -33t39 -79q0 -104 -90 -105q-86 0 -86 84q0 32 18 54t18 27t-16 5q-55 0 -87 -70t-50 -154 q-18 -85 -18 -87q0 -10 20 -10h219q23 0 28 4t13 26q55 164 139 251t226 87q80 1 119 -33t39 -79q0 -105 -88 -105t-89 84q1 32 19 54t18 27t-16 5q-92 0 -139 -226q-17 -83 -17 -89t21 -6h219q23 0 28 4t13 26q55 164 139 251t225 87q80 1 119 -33t39 -79q0 -104 -90 -105 q-86 0 -86 84q0 32 18 54q19 22 19 27t-17 5q-55 0 -87 -70t-50 -154q-18 -85 -18 -87q0 -10 20 -10h219q23 0 28 4t13 26q56 164 140 251t225 87q80 1 119 -33t39 -79q0 -104 -90 -105q-86 0 -86 84q0 32 18 54t18 27t-16 5q-92 0 -139 -226q-17 -83 -17 -89t21 -6h219 q23 0 28 4t13 26q55 164 139 251t225 87q80 1 119 -33t39 -79q0 -104 -90 -105q-86 0 -86 84q0 32 18 54t18 27t-15 5z"},dynamicFortePiano:{codepoint:"U+E534",description:"Forte-piano",bBoxNE:[2.476,1.776],bBoxSW:[-.564,-.608],opticalCenter:[1.5,0],path:"M1024 485q-35 -1 -72 -37t-59 -92l-41 -100q-39 -98 -39 -141q0 -66 51 -66q68 0 138 137t69 218q0 81 -47 81zM1070 561q98 0 148 -47t50 -135q0 -150 -106 -275t-251 -124q-80 0 -114 34l-16 16q-5 5 -11 5t-16 -25l-92 -229q-4 -12 -4 -16t18 -5h82q25 0 24 -24 q0 -27 -26 -27h-396q-25 0 -24 25q0 27 26 26h64q23 0 31 21l252 625q12 28 12 52t-23 23q-47 0 -137 -155q-16 -31 -33 -31q-23 0 -22 22q0 11 34 75q90 166 230 167q90 0 110 -71q7 -29 19 -17q4 4 13 15q61 75 158 75zM-183 -61q93 1 93 -89q0 -58 -62 -81l-24 -9 q-4 -2 -4 -8q0 -18 48 -18t84 56t81 210l129 449l4 20q0 8 -16 8h-119q-31 0 -31 32t33 32h119q24 0 28 4t13 26q117 338 376 338q176 0 176 -137q-1 -53 -29 -82q-28 -28 -70 -28q-93 1 -93 94q0 55 55 73q6 3 9 5t7 3t5 9q0 16 -33 16q-72 0 -114 -70t-74 -217l-5 -19v-5 q0 -10 21 -10h123q31 0 31 -32t-33 -32h-133q-6 0 -16 -9t-11 -13v-2q-2 -2 -2 -4q-72 -252 -157 -428t-167 -254t-194 -78q-68 0 -111 36t-43 92t31 89t75 33z"},dynamicForzando:{codepoint:"U+E535",description:"Forzando",bBoxNE:[1.988,1.776],bBoxSW:[-.564,-.608],opticalCenter:[1.352,0],path:"M559 344q0 12 6 31l49 143q8 27 37 27l66 -8q151 -22 210 -5q60 17 64 17q27 -1 27 -21t-27 -47l-327 -323l-25 -35q28 12 58 12t74 -36t73 -36q29 -1 39 19t10 25q0 10 -25 -4t-47 9t-22 53t19 50q19 21 49 21t52 -23q21 -23 21 -79t-43 -106q-43 -48 -111 -48t-130 32 q-60 32 -83 31t-51 -23t-39 -22q-27 0 -26 25q0 16 24 40l316 320q47 47 41 47t-33 -7t-47 -7l-103 6q-10 0 -22 -25l-21 -43q-14 -31 -30 -30q-23 0 -23 20zM-183 -61q93 1 93 -89q0 -58 -62 -81l-24 -9q-4 -2 -4 -8q0 -18 48 -18t84 56t81 210l129 449l4 20q0 8 -16 8 h-119q-31 0 -31 32t33 32h119q24 0 28 4t13 26q117 338 376 338q176 0 176 -137q-1 -53 -29 -82q-28 -28 -70 -28q-93 1 -93 94q0 55 55 73q6 3 9 5t7 3t5 9q0 16 -33 16q-72 0 -114 -70t-74 -217l-5 -19v-5q0 -10 21 -10h123q31 0 31 -32t-33 -32h-133q-6 0 -16 -9t-11 -13 v-2q-2 -2 -2 -4q-72 -252 -157 -428t-167 -254t-194 -78q-68 0 -111 36t-43 92t31 89t75 33z"},dynamicSforzando1:{codepoint:"U+E536",description:"Sforzando 1",bBoxNE:[2.416,1.776],bBoxSW:[0,-.608],opticalCenter:[1.3,0],path:"M641 477h-119q-31 0 -30 31q-1 33 32 33h119q23 0 28 4t13 26q117 338 377 338q176 0 176 -137q0 -53 -29 -82q-28 -28 -70 -28t-68 22t-26 76q0 53 56 69q6 3 9 5t7 3t4 9q0 16 -33 16q-72 0 -115 -72t-77 -234v-5q0 -10 20 -10h123q31 0 31 -32t-33 -32h-133 q-6 0 -16 -9t-10 -13v-2q-2 -2 -3 -4q-72 -252 -156 -428t-167 -254q-82 -78 -195 -78q-68 0 -110 36t-43 92q0 56 30 89q31 33 75 33t69 -23t24 -73t-61 -74l-25 -9q-4 -2 -4 -8q0 -18 48 -18t84 56t81 210l129 449l4 20q0 8 -16 8zM96 404q0 66 56 110q56 45 142 45 q85 0 130 -33t45 -77q0 -91 -76 -91q-31 0 -51 18t-20 49q0 32 13 42t29 18q3 2 3 7q-1 22 -55 22q-98 -1 -97 -68q0 -28 19 -50t79 -66q101 -74 101 -161t-67 -138t-157 -51t-140 38t-50 86t24 76t58 27t54 -19q22 -18 22 -57t-44 -58q-8 -3 -14 -4t-6 -12q0 -10 25 -19 t67 -9q42 -1 70 27q29 28 29 74q-1 46 -69 93t-94 81t-26 100z"},dynamicSforzandoPiano:{codepoint:"U+E537",description:"Sforzando-piano",bBoxNE:[3.38,1.776],bBoxSW:[0,-.608],opticalCenter:[1.904,0],path:"M1487 485q-35 -1 -72 -37t-59 -92l-41 -100q-39 -98 -39 -141q0 -66 51 -66q67 0 137 137t70 218t-47 81zM1233 35q-6 0 -16 -25l-93 -229q-4 -12 -4 -16t19 -5h82q25 0 24 -24q0 -27 -26 -27h-396q-25 0 -24 25q0 27 26 26h64q23 0 31 21l251 625q32 77 -10 75 q-47 0 -137 -155q-16 -31 -33 -31q-23 0 -22 22q1 11 35 75q90 166 229 167q94 0 109 -71q7 -30 20 -17q4 4 13 15q61 75 158 75t147 -47t51 -135q-1 -150 -107 -275t-250 -124q-80 0 -114 34l-16 16q-5 5 -11 5zM288 -61q93 1 93 -89q0 -58 -62 -81l-24 -9q-4 -2 -4 -8 q0 -18 48 -18t84 56t81 210l129 449l4 20q0 8 -16 8h-119q-31 0 -31 32t33 32h119q23 0 27 4t14 26q117 338 376 338q176 0 177 -137q0 -53 -29 -82q-29 -28 -71 -28q-93 1 -93 94q0 55 55 73q5 3 9 5t8 3t4 9q0 16 -33 16q-72 0 -114 -70t-74 -217l-5 -28q0 -6 21 -6h123 q31 0 31 -32t-33 -32h-133q-7 0 -17 -9t-10 -13v-2q-2 -2 -2 -4q-72 -252 -157 -428t-167 -254t-194 -78q-68 0 -111 36t-43 92t31 89t75 33zM96 404q0 66 56 110q56 45 142 45q85 0 130 -33t45 -77q0 -91 -76 -91q-31 0 -51 18t-20 49q0 32 13 42t29 18q3 2 3 7 q-1 22 -55 22q-98 -1 -97 -68q0 -28 19 -50t79 -66q101 -74 101 -161t-67 -138t-157 -51t-140 38t-50 86t24 76t58 27t54 -19q22 -18 22 -57t-44 -58q-8 -3 -14 -4t-6 -12q0 -10 25 -19t67 -9q42 -1 70 27q29 28 29 74q-1 46 -69 93t-94 81t-26 100z"},dynamicSforzandoPianissimo:{codepoint:"U+E538",description:"Sforzando-pianissimo",bBoxNE:[4.796,1.776],bBoxSW:[0,-.608],opticalCenter:[1.972,0],path:"M1090 862q-72 0 -115 -72t-78 -234v-5q0 -10 21 -10h90q31 0 30 -31q1 -33 -32 -33h-101q-6 0 -16 -9t-10 -13l-2 -2v-4q-72 -252 -157 -428t-167 -254t-195 -78q-68 0 -110 36t-43 92q0 56 31 89q30 33 74 33t69 -23t24 -73t-61 -74l-25 -9q-4 -2 -4 -8q0 -18 48 -18 t84 56t81 210l129 449l4 20q0 8 -16 8h-119q-31 0 -30 31q0 33 32 33h119q23 0 28 4t13 26q117 338 381 338q88 0 130 -38t42 -95t-29 -86q-28 -28 -70 -28t-68 22t-25 75q1 52 55 70q6 3 9 5t7 3t4 9q0 16 -32 16zM989 295q-23 0 -22 22q1 11 35 75q90 166 229 167 q94 0 109 -71q7 -30 20 -17q4 4 13 15q61 75 158 75t147 -47t51 -135q-1 -150 -107 -275t-250 -124q-88 0 -130 50q-5 5 -11 5t-17 -25l-92 -229q-4 -12 -4 -16t19 -5h82q25 0 24 -24q0 -27 -26 -27h-396q-25 0 -24 25q0 27 26 26h64q23 1 31 21l251 625q32 77 -10 75 q-47 0 -137 -155q-16 -31 -33 -31zM1767 383q-23 0 -22 20q0 14 16 39q82 117 186 117t120 -71q7 -30 20 -17q4 4 13 15q61 75 158 75t147 -47t51 -135q0 -150 -106 -275t-251 -124q-80 0 -114 34l-16 16q-5 5 -11 5t-16 -25l-93 -229q-4 -12 -4 -16t19 -5h82q25 0 24 -24 q0 -27 -26 -27h-396q-25 0 -24 25q0 27 26 26h64q23 1 31 21l251 625q32 77 -10 75q-37 0 -86 -73q-18 -25 -33 -25zM414 169q0 -87 -67 -138t-157 -51t-140 38t-50 86t24 76t58 27t54 -19q22 -18 22 -57t-44 -58q-8 -3 -14 -4t-6 -12q0 -10 25 -19t67 -9q42 -1 70 27 q29 28 29 74q-1 46 -69 93t-94 81t-26 100t56 110q56 45 142 45q85 0 130 -33t45 -77q0 -91 -76 -91q-31 0 -51 18t-20 49q0 32 13 42t29 18q3 2 3 7q-1 22 -55 22q-98 -1 -97 -68q0 -28 19 -50t79 -66q101 -74 101 -161zM1274 115q0 -66 51 -66q67 0 137 137q70 136 70 218 t-47 81q-35 0 -72 -36q-36 -38 -59 -93l-41 -100q-39 -98 -39 -141zM2001 115q0 -66 51 -66q68 0 138 137q70 136 69 218q0 82 -47 81q-35 0 -72 -36q-36 -38 -59 -93l-41 -100q-39 -98 -39 -141z"},dynamicSforzato:{codepoint:"U+E539",description:"Sforzato",bBoxNE:[2.932,1.776],bBoxSW:[0,-.608],opticalCenter:[1.76,0],path:"M1042 344q0 12 7 31l49 143q8 27 37 27l65 -8q151 -22 211 -5t64 17q27 0 26 -23q0 -18 -26 -45l-328 -323l-25 -35q30 12 59 12t73 -36t73 -36q29 -1 39 19t10 25q0 10 -25 -4t-47 9t-22 53t20 50q20 21 49 21t51 -23t22 -79t-44 -106q-44 -48 -112 -48t-128 32t-83 31 t-51 -23t-39 -22q-27 0 -27 25q0 16 25 40l315 320q47 47 41 47t-33 -7t-47 -7l-102 6q-10 0 -23 -25l-20 -43q-14 -31 -31 -30q-23 0 -23 20zM631 477h-119q-31 0 -31 32t33 32h119q23 0 27 4t14 26q117 338 377 338q176 0 176 -137q0 -53 -29 -82q-29 -28 -71 -28 q-93 1 -93 94q0 57 56 73q6 3 9 5t7 3t4 9q0 16 -33 16q-72 0 -115 -72t-77 -234v-5q0 -10 20 -10h123q31 0 31 -32t-33 -32h-133q-6 0 -16 -9t-11 -13l-2 -2v-4q-72 -252 -156 -428t-167 -254q-82 -78 -195 -78q-68 0 -110 36t-43 92q0 56 30 89q31 33 75 33t69 -23 q25 -22 25 -66q-1 -61 -78 -87q-13 -3 -13 -11q0 -18 48 -18t84 56t81 210l129 449l4 20q0 8 -16 8zM96 404q0 66 56 110q56 45 142 45q85 0 130 -33t45 -77q0 -91 -76 -91q-31 0 -51 18t-20 49q0 32 13 42t29 18q3 2 3 7q-1 22 -55 22q-98 -1 -97 -68q0 -28 19 -50t79 -66 q101 -74 101 -161t-67 -138t-157 -51t-140 38t-50 86t24 76t58 27t54 -19q22 -18 22 -57t-44 -58q-8 -3 -14 -4t-6 -12q0 -10 25 -19t67 -9q42 -1 70 27q29 28 29 74q-1 46 -69 93t-94 81t-26 100z"},dynamicSforzatoPiano:{codepoint:"U+E53A",description:"Sforzato-piano",bBoxNE:[4.304,1.776],bBoxSW:[0,-.608],opticalCenter:[1.848,0],path:"M1960 485q-35 -1 -72 -37t-59 -92l-41 -100q-39 -98 -39 -141q0 -66 51 -66q68 0 138 137t69 218q0 81 -47 81zM1706 35q-6 0 -16 -25l-93 -229q-4 -12 -4 -16t19 -5h82q25 0 24 -24q0 -27 -26 -27h-396q-25 0 -24 25q0 27 26 26h64q23 0 31 21l252 625q12 28 12 52 t-23 23q-47 0 -137 -155q-16 -31 -33 -31q-23 0 -22 22q0 11 34 75q90 166 230 167q90 0 110 -71q7 -29 19 -17q4 4 13 15q61 75 158 75t147 -47t51 -135q0 -150 -106 -275t-251 -124q-80 0 -114 34l-16 16q-5 5 -11 5zM1487 549q27 0 26 -23q0 -18 -26 -45l-328 -323 l-24 -35q28 12 58 12t74 -36q45 -36 73 -36q28 -1 38 19t11 24q0 6 -7 7l-32 -11q-23 0 -39 16q-17 16 -17 47q0 30 20 50q20 21 49 21t51 -23t22 -79t-43 -106q-43 -48 -111 -48t-130 32q-60 32 -83 31t-51 -23t-39 -22q-27 0 -27 25q0 16 25 40l315 320q47 47 41 47 t-33 -7t-47 -7l-102 6q-10 0 -23 -25l-20 -43q-14 -31 -31 -30q-23 0 -22 20q0 12 6 31l49 143q8 27 37 27l65 -8q151 -22 211 -5t64 17zM641 477h-119q-31 0 -30 31q-1 33 32 33h119q23 0 28 4t13 26q117 338 377 338q176 0 176 -137q0 -53 -29 -82q-28 -28 -70 -28t-68 22 t-26 76q0 53 56 69q6 3 9 5t7 3t4 9q0 16 -33 16q-72 0 -115 -72t-77 -234v-5q0 -10 20 -10h123q31 0 31 -32t-33 -32h-133q-6 0 -16 -9t-10 -13v-2q-2 -2 -3 -4q-72 -252 -156 -428t-167 -254q-82 -78 -195 -78q-68 0 -110 36t-43 92q0 56 30 89q31 33 75 33t69 -23t24 -73 t-61 -74l-25 -9q-4 -2 -4 -8q0 -18 48 -18t84 56t81 210l129 449l4 20q0 8 -16 8zM96 404q0 66 56 110q56 45 142 45q85 0 130 -33t45 -77q0 -91 -76 -91q-31 0 -51 18t-20 49q0 32 13 42t29 18q3 2 3 7q-1 22 -55 22q-98 -1 -97 -68q0 -28 19 -50t79 -66q101 -74 101 -161 t-67 -138t-157 -51t-140 38t-50 86t24 76t58 27t54 -19q22 -18 22 -57t-44 -58q-8 -3 -14 -4t-6 -12q0 -10 25 -19t67 -9q42 -1 70 27q29 28 29 74q-1 46 -69 93t-94 81t-26 100z"},dynamicSforzatoFF:{codepoint:"U+E53B",description:"Sforzatissimo",bBoxNE:[3.856,1.776],bBoxSW:[0,-.608],opticalCenter:[2.276,0],path:"M1581 862q-72 0 -115 -71t-77 -235v-5q0 -10 20 -10h90q31 0 31 -32t-33 -32h-100q-7 0 -17 -9t-10 -13l-2 -2v-4q-72 -252 -157 -428t-167 -254t-194 -78q-66 -1 -107 33t-41 88t27 84q27 28 69 28t66 -22t23 -64q0 -43 -33 -64q-33 -22 -33 -30t21 -8q59 0 95 56 t81 210l129 449l4 20q0 8 -16 8h-230q-6 0 -16 -9t-10 -13l-2 -2v-4q-72 -252 -157 -428t-167 -254t-195 -78q-68 0 -110 36t-43 92q0 56 31 89q30 33 74 33t69 -23t24 -73t-61 -74l-25 -9q-4 -2 -4 -8q0 -18 48 -18t84 56t81 210l129 449l4 20q0 8 -16 8h-119q-31 0 -30 31 q0 33 32 33h119q23 0 28 4t13 26q55 164 139 251t226 87q81 1 119 -33t38 -79q0 -104 -90 -105q-86 0 -86 84q0 32 18 54t19 27q0 5 -16 5q-92 0 -139 -226q-17 -83 -17 -89t21 -6h219q23 0 27 4t14 26q117 338 381 338q88 0 130 -38t42 -95t-29 -86q-29 -28 -71 -28 q-93 1 -93 94q0 55 55 73q5 3 9 5t8 3t4 9q0 16 -33 16zM414 169q0 -87 -67 -138t-157 -51t-140 38t-50 86t24 76t58 27t54 -19q22 -18 22 -57t-44 -58q-8 -3 -14 -4t-6 -12q0 -10 25 -19t67 -9q42 -1 70 27q29 28 29 74q-1 46 -69 93t-94 81t-26 100t56 110q56 45 142 45 q85 0 130 -33t45 -77q0 -91 -76 -91q-31 0 -51 18t-20 49q0 32 13 42t29 18q3 2 3 7q-1 22 -55 22q-98 -1 -97 -68q0 -28 19 -50t79 -66q101 -74 101 -161zM1654 135q29 0 73 -36t73 -36q29 -1 39 19t10 25q0 10 -25 -4t-47 9q-21 23 -21 53t18 50q20 21 50 21t52 -23 t20 -79q0 -56 -43 -106q-43 -48 -111 -48t-128 32t-84 31t-52 -23t-38 -22q-27 0 -27 25q0 16 25 40l315 320q47 47 42 47t-32 -7t-49 -7l-102 6q-10 0 -23 -25l-20 -43q-14 -31 -31 -30q-23 0 -22 20q0 12 6 31l49 143q8 27 37 27l67 -8q149 -23 223 0q45 12 50 12 q27 0 26 -23q1 -18 -26 -45l-328 -323l-25 -35q30 12 59 12z"},dynamicRinforzando1:{codepoint:"U+E53C",description:"Rinforzando 1",bBoxNE:[2.5,1.776],bBoxSW:[-.08,-.608],opticalCenter:[1.564,0],path:"M684 477h-66q-31 0 -30 31q0 33 33 33h65q23 0 28 4t13 26q117 338 377 338q176 0 176 -137q0 -53 -29 -82q-29 -28 -71 -28t-67 22q-26 22 -26 76q0 53 56 69q6 3 9 5t7 3t4 9q0 16 -33 16q-72 0 -115 -72t-77 -234v-5q0 -10 20 -10h123q31 0 31 -32t-33 -32h-133 q-6 0 -16 -9t-10 -13l-2 -2v-4q-72 -252 -157 -428t-167 -254t-195 -78q-69 0 -111 36t-42 92t30 89q31 33 75 33t69 -23t24 -73t-61 -74l-25 -9q-4 -2 -4 -8q0 -18 48 -18t84 56t81 210l129 449l4 20q0 8 -16 8zM-41 317q-1 11 33 75t88 116t128 51q73 1 90 -75q1 -4 1 -10 q0 -5 5 -5t17 13q61 79 140 79q53 0 80 -31q27 -30 27 -80t-24 -80t-60 -30q-76 0 -76 66q0 34 22 56t23 25q0 13 -27 13t-69 -45t-62 -99l-133 -331q-10 -25 -33 -25h-100q-23 0 -23 10t6 25l150 371q12 28 12 52t-22 23q-47 0 -140 -159q-12 -27 -32 -27t-21 22z"},dynamicRinforzando2:{codepoint:"U+E53D",description:"Rinforzando 2",bBoxNE:[2.976,1.776],bBoxSW:[-.08,-.608],opticalCenter:[2.084,0],path:"M1130 862q-72 0 -115 -72t-77 -234v-5q0 -10 20 -10h91q31 0 30 -31q0 -33 -32 -33h-101q-6 0 -16 -9t-10 -13l-2 -2v-4q-72 -252 -157 -428t-167 -254t-195 -78q-69 0 -111 36t-42 92t30 89q31 33 75 33t69 -23t24 -73t-61 -74l-25 -9q-4 -2 -4 -8q0 -18 48 -18t84 56 t81 210l129 449l4 20q0 8 -16 8h-66q-31 0 -30 31q0 33 33 33h65q23 0 28 4t13 26q117 338 381 338q88 0 130 -38t42 -95t-29 -86q-29 -28 -71 -28t-67 22q-26 22 -26 76q0 53 56 69q6 3 9 5t7 3t4 9q0 16 -33 16zM-41 317q-1 11 33 75t88 116t128 51q73 1 90 -75 q1 -4 1 -10q0 -5 5 -5t17 13q61 79 140 79q53 0 80 -31q27 -30 27 -80t-24 -80t-60 -30q-76 0 -76 66q0 34 22 56t23 25q0 13 -27 13t-69 -45t-62 -99l-133 -331q-10 -25 -33 -25h-100q-23 0 -23 10t6 25l150 371q12 28 12 52t-22 23q-47 0 -140 -159q-12 -27 -32 -27 t-21 22zM1203 135q30 0 74 -36t73 -36q29 -1 39 19t10 25t-6 6l-33 -11q-23 0 -39 16t-16 47q0 30 19 50q19 21 49 21q29 0 51 -23t22 -79t-43 -106q-43 -48 -111 -48t-130 32q-60 32 -83 31t-51 -23t-39 -22q-27 0 -26 25q0 16 24 40l316 320q47 47 41 47t-32 -7t-68 -7 t-62 3q-18 3 -21 3q-10 0 -22 -25l-21 -43q-14 -31 -31 -30q-23 0 -22 20q0 12 6 31l49 143q8 27 37 27l68 -8q148 -22 208 -5t64 17q27 -1 27 -21t-27 -47l-328 -323l-24 -35q28 12 58 12z"},metNoteWhole:{codepoint:"U+ECA2",description:"Whole note (semibreve)",bBoxNE:[1.836,.592],bBoxSW:[0,-.5],path:"M424 252q-184 0 -184 -143q0 -104 77 -197q53 -74 152 -109q27 -8 61 -8q142 0 164 117q4 25 4 41q0 107 -83 203t-191 96zM0 24q0 120 132 200t322 79q190 0 338 -82t148 -194q0 -283 -481 -283q-233 0 -346 80t-113 200z"},metNoteHalfUp:{codepoint:"U+ECA3",description:"Half note (minim) stem up",bBoxNE:[1.364,2.752],bBoxSW:[0,-.564],path:"M698 1409v-1303q0 -78 -43 -155q-43 -76 -92 -124t-136 -82t-193 -34t-170 52t-64 153t98 236q50 66 146 110t212 43q116 0 181 -55v1159h61zM70 -96q0 -23 14 -47q30 -53 106 -53t208 86q132 88 179 137q48 49 48 77t-15 54q-29 49 -97 49t-228 -92q-215 -123 -215 -211 z"},metNoteQuarterUp:{codepoint:"U+ECA5",description:"Quarter note (crotchet) stem up",bBoxNE:[1.328,2.752],bBoxSW:[0,-.564],path:"M618 1409h62v-1313q0 -143 -150 -264t-307 -121q-96 0 -160 52q-63 52 -63 141q0 152 134 268t321 117q104 0 163 -53v1173z"},metNote8thUp:{codepoint:"U+ECA7",description:"Eighth note (quaver) stem up",bBoxNE:[2.132,2.784],bBoxSW:[0,-.564],path:"M637 1425h12q31 0 41 -34q39 -193 195 -408q195 -272 207 -547v-14q0 -127 -45 -262q-16 -33 -39 -33q-4 0 -13 4q-29 10 -28 45q0 8 6 25q41 102 41 224t-41 232q-90 252 -293 293v-854q0 -143 -150 -264t-307 -121q-96 0 -160 52q-63 52 -63 141q0 152 134 268t321 117 q104 0 163 -53v1175q1 14 19 14z"},metNote16thUp:{codepoint:"U+ECA9",description:"16th note (semiquaver) stem up",bBoxNE:[2.084,2.8],bBoxSW:[0,-.564],path:"M1067 360v-34q0 -164 -10 -179q-12 -27 -33 -26q-2 0 -14 4q-23 4 -23 39q0 8 8 53t9 105q0 127 -54 239q-102 213 -270 230v-695q0 -143 -150 -264t-307 -121q-96 0 -160 52q-63 52 -63 141q0 152 134 268t321 117q104 0 163 -53v1196q16 2 35 2t25 -21v-2h2v-10 q12 -72 40 -116t84 -92q127 -109 207 -224q50 -72 50 -176q-1 -104 -19 -155q-18 -50 -21 -56t-3 -13l2 -16q47 -98 47 -193zM719 1079h-14q-20 0 -21 -10v-8q16 -61 40 -99t102 -117t128 -153q2 -8 16 -8t21 16q8 16 8 83t-43 128q-112 168 -237 168z"},metNote32ndUp:{codepoint:"U+ECAB",description:"32nd note (demisemiquaver) stem up",bBoxNE:[2.152,3.692],bBoxSW:[0,-.564],path:"M1051 119q-2 0 -11 4q-29 14 -22 57q14 74 14 184t-62 236q-62 127 -132 176q-72 49 -158 58v-738q0 -143 -150 -264t-307 -121q-96 0 -160 52q-63 52 -63 141q0 152 134 268t321 117q104 0 163 -53l3 1634q10 20 20 20q9 0 23 -11t16 -24q14 -84 44 -133t94 -103 q137 -115 221 -240q97 -146 16 -380q36 -85 38 -174q1 -88 -42 -217v-24q43 -98 49 -207l2 -53q0 -150 -16 -178t-35 -27zM998 723q15 0 16 10q4 7 6 23t5 32t3 31q0 82 -47 148q-121 180 -266 180q-9 -2 -17 -12t-8 -13q16 -63 45 -106t81 -93l81 -85q61 -74 73 -94t28 -21 zM1026 1155l6 39q0 37 -28 88q-127 217 -312 217q18 -116 80 -183q23 -24 90 -87t142 -154q14 43 22 80z"},metNote64thUp:{codepoint:"U+ECAD",description:"64th note (hemidemisemiquaver) stem up",bBoxNE:[2.148,4.392],bBoxSW:[0,-.564],path:"M1030 1552q0 37 -29 88q-127 215 -311 215q2 -2 7 -37q5 -36 30 -84t45 -72t64 -64t62 -59q17 -19 39 -44t37 -41t25 -31l25 90q6 37 6 39zM1030 1190q0 36 -29 86q-127 215 -311 215q19 -119 80 -183q23 -24 66 -63t65 -63q14 -16 50 -55t50 -60q29 87 29 123zM1026 813 q0 78 -47 148q-121 178 -266 178q-9 -3 -17 -13t-8 -12q16 -63 45 -106q29 -44 80 -94l82 -83q61 -74 84 -108q2 -8 16 -8q13 0 17 9q4 10 6 24t5 32t3 33zM1051 1350q76 -136 2 -359q34 -63 39 -172q0 -88 -31 -184l-10 -35q-2 -2 -2 -11t2 -11q41 -105 47 -209l2 -52 q0 -139 -13 -176q-20 -29 -30 -29q-49 2 -41 62q16 86 16 156q0 135 -62 262t-133 177t-157 58v-731q0 -143 -150 -264t-307 -121q-96 0 -160 52q-63 52 -63 141q0 152 134 268t321 117q104 0 163 -53v1990q10 23 20 23q10 1 24 -11t16 -24q14 -84 44 -133t95 -106 q66 -56 84 -74q102 -113 137 -165t49 -132l3 -50q0 -98 -39 -204z"},metAugmentationDot:{codepoint:"U+ECB7",description:"Augmentation dot",bBoxNE:[.4,.2],bBoxSW:[0,-.2],path:"M205 0q0 -43 -30 -73q-30 -29 -73 -29q-42 0 -72 30t-30 72q0 43 30 73q30 29 72 29t73 -30q30 -30 30 -72z"},csymDiminished:{alternateCodepoint:"U+1D1A9",codepoint:"U+E870",description:"Diminished",bBoxNE:[1.892,1.892],bBoxSW:[0,0],path:"M483 838q-145 0 -249 -104t-103 -248q0 -146 103 -250q102 -104 248 -104t250 104t106 249q0 145 -105 249t-250 104zM484 0q-200 0 -342 142t-142 341t141 342t344 143t340 -141q143 -143 143 -343t-142 -342t-342 -142z"},csymAugmented:{codepoint:"U+E872",description:"Augmented",bBoxNE:[1.9,1.9],bBoxSW:[0,0],path:"M553 0h-131v420h-422v131h422v422h131v-422h420v-131h-420v-420z"},csymHalfDiminished:{codepoint:"U+E871",description:"Half-diminished",bBoxNE:[1.948,1.94],bBoxSW:[-.076,-.06],path:"M485 836q-145 0 -248 -104t-104 -249q0 -106 60 -194l491 485q-90 62 -199 62zM283 195q95 -63 221 -63t230 102q103 103 104 249q0 109 -62 199zM2 483q0 199 142 341t324 142t310 -100l127 127l92 -94l-127 -125q98 -128 98 -308t-140 -323q-142 -143 -328 -143 t-312 102l-135 -133l-92 94l135 134q-94 125 -94 286z"},csymParensLeftTall:{codepoint:"U+E875",description:"Double-height left parenthesis",bBoxNE:[1.484,7.976],bBoxSW:[.012,0],
path:"M760 135v-110q0 -25 -8 -25t-13 4q-733 715 -733 2040q0 635 182 1154t551 882q5 4 13 4t8 -33v-86q0 -45 -12 -66q-242 -317 -363 -758t-121 -1093t122 -1090q122 -440 357 -774q17 -16 17 -49z"},csymParensRightTall:{codepoint:"U+E876",description:"Double-height right parenthesis",bBoxNE:[1.484,7.976],bBoxSW:[.012,0],path:"M6 25v110q0 33 17 49q236 334 357 773q122 439 122 1091t-121 1092q-121 442 -363 759q-12 16 -12 54v98q0 33 10 33l11 -4q369 -362 551 -882t182 -1154q0 -1325 -733 -2040q-5 -4 -13 -4t-8 25z"},ornamentTrill:{alternateCodepoint:"U+1D196",codepoint:"U+E566",description:"Trill",bBoxNE:[2.084,1.56],bBoxSW:[0,-.04],path:"M386 342q-6 0 -36 -76l-55 -135q-16 -41 -16 -65t22 -23q45 0 80 52t35 120q0 18 -9 56t-10 55q-6 16 -11 16zM272 463q0 13 -32 31t-79 18q-48 0 -77 -26t-29 -58q0 -61 91 -61t110 49l8 20q8 20 8 27zM0 422q0 57 47 97t108 40t129 -34q5 -3 10 -3t15 25l74 180 q10 25 35 33l100 33q19 6 29 6q10 -1 10 -11t-6 -24l-102 -254q-10 -27 -11 -31q0 -6 7 -6t49 23q120 63 194 63t98 -45q13 -26 13 -36t5 -9q6 0 16 13q61 79 141 79q53 0 79 -31q26 -30 27 -80q0 -50 -24 -80t-62 -30q-72 0 -74 66q0 34 23 56t22 25q0 13 -26 13t-69 -45 q-42 -45 -62 -99l-133 -331q-10 -25 -33 -25h-101q-23 0 -22 12q0 8 6 23l150 371q12 30 12 60t-34 30t-153 -72q-57 -28 -57 -47q0 -4 6 -21q27 -66 27 -157q-1 -91 -63 -155t-146 -64q-55 0 -86 28t-31 73q0 44 39 140l23 55q6 14 6 20t-6 7l-64 -4q-67 0 -101 33t-34 90z "},caesura:{alternateCodepoint:"U+1D113",codepoint:"U+E4D1",description:"Caesura",bBoxNE:[1.536,2.128],bBoxSW:[0,-.004],path:"M385 -2q-12 0 -18 4q-39 12 -39 53q0 12 2 19l346 977q12 39 53 39q8 0 21 -5q37 -14 36 -53q0 -12 -2 -18l-346 -977q-12 -39 -53 -39zM57 -2q-12 0 -18 4q-39 12 -39 51q0 8 4 21l344 977q12 39 53 39q8 0 21 -5q37 -14 37 -53q0 -12 -2 -18l-346 -977q-13 -39 -54 -39 z"},breathMarkComma:{alternateCodepoint:"U+1D112",codepoint:"U+E4CE",description:"Breath mark (comma)",bBoxNE:[.608,1.004],bBoxSW:[.004,.008],path:"M178 205q0 65 -61 65q-51 0 -83 32t-32 85t40 90t102 37t114 -39t53 -121v-14q0 -113 -53 -195q-30 -45 -94 -93t-111 -48q-12 0 -14 16l-2 3v4q0 10 39 33t71 66q31 42 31 79z"},tremolo1:{alternateCodepoint:"U+1D167",codepoint:"U+E220",description:"Combining tremolo 1",bBoxNE:[.6,.376],bBoxSW:[-.6,-.372],path:"M307 -63l-614 -127v256l614 127v-256z"},tremolo2:{alternateCodepoint:"U+1D168",codepoint:"U+E221",description:"Combining tremolo 2",bBoxNE:[.596,.748],bBoxSW:[-.604,-.748],path:"M305 2v-256l-614 -129v256zM305 127l-614 -127v256l614 127v-256z"},tremolo3:{alternateCodepoint:"U+1D169",codepoint:"U+E222",description:"Combining tremolo 3",bBoxNE:[.6,1.112],bBoxSW:[-.6,-1.12],path:"M307 -190v-256l-614 -127v256zM307 186v-256l-614 -127v256zM307 313l-614 -129v256l614 129v-256z"},tremolo4:{codepoint:"U+E223",description:"Combining tremolo 4",bBoxNE:[.6,1.496],bBoxSW:[-.6,-1.48],path:"M307 510l-614 -127v256l614 127v-256zM307 -375v-256l-614 -127v256zM307 2v-256l-614 -127v256zM307 129l-614 -129v256l614 129v-256z"},tremolo5:{codepoint:"U+E224",description:"Combining tremolo 5",bBoxNE:[.6,1.88],bBoxSW:[-.604,-1.84],path:"M305 582v-256l-614 -129v256zM305 707l-614 -127v256l614 127v-256zM307 -559v-256l-614 -127v256zM307 -182v-256l-614 -127v256zM307 -55l-614 -129v256l614 129v-256z"},buzzRoll:{codepoint:"U+E22A",description:"Buzz roll",bBoxNE:[.624,.464],bBoxSW:[-.62,-.464],path:"M319 -238h-636v101l442 274h-442v101h636v-101l-450 -274h450v-101z"},"6stringTabClef":{codepoint:"U+E06D",description:"6-string tab clef",bBoxNE:[1.632,3.056],bBoxSW:[-.012,-2.992],path:"M651 -1256q0 72 -44 118t-128 46h-301v-331h301q82 0 127 47t45 120zM608 -829q0 154 -192 153h-238v-307h238q192 0 192 154zM774 -1255q0 -121 -78 -199t-207 -78h-434v965h391q133 0 209 -69t76 -177q0 -147 -133 -209q176 -67 176 -233zM565 -74l-149 439l-158 -439 h307zM836 -467h-138l-100 289h-371l-102 -289h-131l344 963h160zM793 1456h-316v-856h-123v856h-317v109h756v-109z"},"4stringTabClef":{codepoint:"U+E06E",description:"4-string tab clef",bBoxNE:[1.088,2.016],bBoxSW:[-.012,-2.032],path:"M434 -856q0 49 -30 80t-85 31h-202v-222h202q55 0 85 31t30 80zM406 -570q0 103 -130 103h-159v-207h159q130 1 130 104zM516 -856q0 -82 -52 -133t-138 -51h-291v645h262q90 0 140 -45t50 -130t-88 -130q117 -43 117 -156zM377 -66l-101 295l-106 -295h207zM557 -328 h-92l-66 195h-249l-68 -195h-88l231 645h107zM528 961h-211v-574h-81v574h-213v71h505v-71z"},luteItalianFret0:{codepoint:"U+EBE0",description:"Open string (0)",bBoxNE:[1.124,1.2],bBoxSW:[.096,-.004],path:"M311 575q-41 1 -78 -77t-37 -182t38 -183q36 -80 77 -80t79 80t38 183t-38 181t-79 78zM575 305q-1 -127 -77 -217t-186 -90t-186 90t-77 217q0 127 77 218q76 91 186 91t186 -91t77 -218z"},luteItalianFret1:{codepoint:"U+EBE1",description:"First fret (1)",bBoxNE:[.648,1.2],bBoxSW:[.096,0],path:"M272 82q0 -14 14 -28t25 -15l21 -21q0 -18 -21 -18h-202q-31 0 -31 19t20 19t35 13q14 12 14 33v346q0 18 -6 18t-12 -10q-6 -12 -47 -133q-10 -10 -14 -10t-13 4q-6 6 -6 16l2 17l74 258q21 24 35 22t43 -2l45 4q25 0 24 -28v-504z"},luteItalianFret2:{codepoint:"U+EBE2",description:"Second fret (2)",bBoxNE:[1.052,1.2],bBoxSW:[.096,-.012],path:"M352 4q-44 0 -92 33t-65 33q-43 0 -75 -38t-40 -38t-10 4q-20 8 -21 43q33 127 135 188q8 6 84 44t108 80t32 110q0 35 -39 79t-101 44t-87 -14q-23 -14 -23 -27q0 -12 30 -35t29 -55q0 -84 -67 -84q-55 0 -80 51q-14 46 -14 66t34 62q36 42 86 53t143 11t156 -53 t63 -127t-46 -113q-48 -39 -113 -47q-31 -10 -97 -48t-83 -66q21 6 67 6t109 -29l37 -12q6 -2 14 -2q49 0 76 78q4 14 17 14t13 -18q-12 -132 -70 -167q-28 -18 -47 -22t-63 -4z"},luteItalianFret3:{codepoint:"U+EBE3",description:"Third fret (3)",bBoxNE:[.976,1.2],bBoxSW:[.096,0],path:"M205 457q0 -61 -73 -61q-74 2 -76 86q0 38 50 85q52 47 142 47h20q66 -4 136 -41t69 -110q0 -49 -27 -78q-8 -10 -47 -35l-39 -12q-8 0 -8 -7t4 -9l27 -11l12 -2l15 -4l26 -14q41 -37 52 -64t12 -57q0 -76 -74 -123t-170 -47h-14q-88 2 -140 43q-51 41 -52 107t67 81h10 q51 0 68 -41q6 -25 6 -28q-10 -61 -11 -82v-14q3 -28 72 -16t91 53q63 125 -35 179q-38 22 -87 22t-49 13q0 20 35 21q154 16 154 127q0 41 -39 75t-123 33q-11 0 -29 -10t-22 -26q0 -23 14 -29q33 -15 33 -43v-8z"},luteItalianFret4:{codepoint:"U+EBE4",description:"Fourth fret (4)",bBoxNE:[1.028,1.204],bBoxSW:[.096,.004],path:"M293 219v100q0 20 12 29l72 141q10 12 24 13q14 0 15 -21v-262h90q20 -1 20 -25t-20 -24h-90v-70q0 -47 39 -47q27 0 26 -24q0 -27 -24 -27h-209q-27 0 -27 25t33 24q39 0 39 43v76h-219q-25 0 -25 25q0 10 10 20q158 221 158 377q0 25 29 24l47 -4l84 4q18 0 18 -16 q-58 -115 -137 -230q-79 -114 -125 -151h160z"},luteItalianFret5:{codepoint:"U+EBE5",description:"Fifth fret (5)",bBoxNE:[.952,1.2],bBoxSW:[.092,0],path:"M274 408q94 0 154 -60q59 -60 59 -146t-60 -144t-169 -58t-160 44t-51 116v16q2 26 28 50q25 24 59 24t58 -23t23 -51q0 -28 -19 -50t-41 -22t-22 -11t13 -29t55 -17h14q70 0 112 47t42 123q1 76 -49 112t-89 36q-39 -1 -75 -15t-50 -26q-23 -27 -24 -27q-25 -1 -25 22 l15 277q0 18 28 18l166 -12l156 12q16 0 16 -16t-2 -24q-18 -76 -176 -76l-127 12q-18 0 -18 -16l-9 -111q0 -12 13 -12q61 37 155 37z"},luteItalianFret6:{codepoint:"U+EBE6",description:"Sixth fret (6)",bBoxNE:[1.036,1.2],bBoxSW:[.096,0],path:"M296 309q-50 0 -80 -33t-30 -92t30 -104t80 -45t80 45t30 103t-30 92t-80 34zM336 498q0 24 5 31t8 15l9 23q0 19 -46 19t-80 -40t-39 -120l-5 -37q0 -53 29 -53l8 4l21 4l12 2q74 20 117 20t77 -18q34 -20 46 -49q31 -47 32 -92v-14q0 -89 -63 -141t-168 -52 q-57 0 -109 22t-96 102q-44 79 -45 181v10q0 74 47 168q66 127 218 129t163 -82v-10q0 -61 -61 -76l-13 -2q-22 1 -47 21q-20 11 -20 35z"},luteItalianFret7:{codepoint:"U+EBE7",description:"Seventh fret (7)",bBoxNE:[1.068,1.204],bBoxSW:[.1,0],path:"M51 414v159q0 14 12 15q10 0 15 -8q18 -31 28 -30t37 21q51 45 109 45t124 -53q67 -53 78 -53q21 0 35 42q15 42 19 49t22 7t17 -16v-35q0 -55 -74 -227t-74 -285q0 -45 -20 -45l-64 10l-61 -10q-16 0 -20 7q-3 7 -3 30q0 78 86 174q51 61 85 133t34 109q-6 12 -11 12 t-9 -4q-29 -29 -68 -29t-99 47t-84 47q-40 0 -66 -63t-36 -64q-12 0 -12 15z"},luteItalianFret8:{codepoint:"U+EBE8",description:"Eighth fret (8)",bBoxNE:[1.016,1.204],bBoxSW:[.096,0],path:"M422 488q0 46 -47 70t-92 24t-95 -20t-49 -56q0 -35 39 -66t79 -47t103 -39q30 14 46 52q16 36 16 82zM266 39q62 0 103 26q41 27 41 63t-36 71t-70 52t-93 42q-39 -14 -67 -56t-28 -89t44 -78t106 -31zM520 186q0 -186 -246 -186q-94 0 -160 39t-65 103q0 64 32 109 q32 46 79 68q-106 55 -107 158q0 139 234 139q88 0 147 -43q96 -70 39 -183q-20 -41 -51 -64q98 -49 98 -140z"},luteItalianFret9:{codepoint:"U+EBE9",description:"Ninth fret (9)",bBoxNE:[1.036,1.2],bBoxSW:[.096,0],path:"M284 305q50 0 78 33t29 92q0 58 -29 104q-28 46 -78 46t-80 -45t-30 -103t30 -93q30 -34 80 -34zM100 94q0 65 76 78q18 0 42 -17t26 -39q0 -22 -8 -34q-8 -11 -11 -29l-4 -6q0 -18 46 -18t75 32q43 43 43 134l2 36q0 47 -25 48l-8 -5q-14 -2 -59 -14t-90 -12 q-88 0 -127 67q-27 53 -29 93v20q0 90 70 141q55 45 135 45t121 -16q70 -33 113 -112q42 -79 42 -172t-47 -183q-66 -127 -217 -129t-166 82v10z"},segno:{alternateCodepoint:"U+1D10B",codepoint:"U+E047",description:"Segno",bBoxNE:[2.2,3.036],bBoxSW:[.016,-.108],path:"M104 -6q0 24 7 37q295 531 308 555t13 36t-12 17q-16 6 -90 55t-167 132t-124 154t-31 148q0 148 97 264t197 116t182 -32q81 -32 104 -98q16 -53 16 -96q0 -98 -82 -127q-29 -10 -59 -10q-104 0 -150 176l-4 14q-8 27 -33 27h-12q-111 -18 -110 -127q0 -55 30 -111 t201 -138q170 -83 199 -83q8 0 18 17l338 606q26 46 78 22q31 -16 31 -40t-9 -40q-317 -571 -324 -583t-7 -17q1 -12 29 -28t73 -46t117 -86t128 -136t63 -138q7 -59 7 -78q0 -125 -74 -220t-198 -138q-43 -14 -86 -14q-96 0 -172 72t-76 161q0 98 146 133q16 4 24 4 q43 0 76 -39t33 -96v-22q-1 -45 21 -69t52 -24q132 16 130 150q0 64 -63 126q-62 62 -148 102q-176 82 -230 89q-4 0 -24 -10l-324 -586q-16 -31 -51 -30q-14 0 -36 12q-22 13 -22 37zM287 540q0 -48 -34 -82t-82 -34t-83 34t-35 82t35 83t83 35t82 -36q34 -34 34 -82z M850 955q0 48 35 82t83 34t82 -34t34 -82t-34 -83q-34 -34 -82 -34t-83 34t-35 83z"},dalSegno:{alternateCodepoint:"U+1D109",codepoint:"U+E045",description:"Dal segno",bBoxNE:[4.328,1.768],bBoxSW:[.044,-.036],path:"M1229 636q0 118 88 194t222 75q134 0 228 -65l66 55h55l15 -317h-64q-113 264 -303 264q-72 0 -119 -36t-47 -93q0 -76 84 -107q17 -7 41 -9q24 -3 84 -19l59 -15q160 -33 233 -103t73 -192q0 -123 -92 -205q-92 -81 -232 -81q-141 0 -254 81l-76 -71h-63v348h63 q51 -139 137 -217q87 -78 179 -78t141 40q49 41 49 107t-55 95q-29 12 -86 26l-29 6l-18 5l-76 16q-143 26 -223 102t-80 194zM2216 97q0 -48 -34 -82q-34 -33 -82 -33t-82 34t-34 81q0 48 34 82t82 34t82 -34t34 -82zM1056 213q48 0 82 -34t33 -82q1 -48 -33 -82 q-34 -33 -82 -33t-82 34t-34 81q0 48 34 82t82 34zM729 457q0 365 -252 364h-31q-45 0 -59 -14t-14 -59v-603q0 -49 14 -64t59 -15h25q137 0 198 93q60 93 60 298zM975 450q0 -255 -170 -374q-109 -76 -330 -76h-452v66h18q84 0 102 18q8 10 9 92v535q0 82 -14 96t-97 14 h-18v66h438q240 0 338 -66q176 -116 176 -371z"},daCapo:{alternateCodepoint:"U+1D10A",codepoint:"U+E046",description:"Da capo",bBoxNE:[4.328,1.768],bBoxSW:[.044,-.036],path:"M2216 97q0 -48 -34 -82q-34 -33 -82 -33t-82 34t-34 81q0 48 34 82t82 34t82 -34t34 -82zM1056 213q48 0 82 -34t33 -82q1 -48 -33 -82q-34 -33 -82 -33t-82 34t-34 81q0 48 34 82t82 34zM1155 444q0 194 131 328q131 133 334 133q117 0 225 -65l66 61h53l12 -352l-65 -6 q-80 299 -281 299q-231 0 -231 -392t246 -393q106 0 177 71t97 198l76 -19q-70 -326 -389 -325q-213 0 -332 134t-119 328zM729 457q0 365 -252 364h-31q-45 0 -59 -14t-14 -59v-603q0 -49 14 -64t59 -15h25q137 0 198 93q60 93 60 298zM975 450q0 -255 -170 -374 q-109 -76 -330 -76h-452v66h18q84 0 102 18q8 10 9 92v535q0 82 -14 96t-97 14h-18v66h438q240 0 338 -66q176 -116 176 -371z"},wiggleArpeggiatoUp:{codepoint:"U+EAA9",description:"Arpeggiato wiggle segment, upwards",bBoxNE:[1.168,.476],bBoxSW:[-.132,0],repeatOffset:[1.02,0],path:"M84 224q45 20 108 20t183 -63q50 -24 68 -27q19 -2 39 -2t52 23t48 23t16 -10q0 -18 -28 -62t-86 -85t-139 -41t-155 45t-112 45t-72 -15q-74 -34 -74 1q0 8 10 17t31 39q23 30 45 52q22 20 66 40z"},wiggleArpeggiatoDown:{codepoint:"U+EAAA",description:"Arpeggiato wiggle segment, downwards",bBoxNE:[1.168,.476],bBoxSW:[-.132,0],repeatOffset:[1.02,0],path:"M347 244q54 0 99 -20t67 -41q23 -21 45 -51t31 -39t9 -17q0 -16 -20 -16t-54 15q-32 15 -71 15t-113 -45t-155 -45t-139 41t-86 86t-28 58t16 13t52 -26q37 -27 78 -18q41 5 110 43q105 47 159 47z"},wiggleArpeggiatoUpSwash:{codepoint:"U+EAAB",description:"Arpeggiato upward swash",bBoxNE:[2.108,.56],bBoxSW:[-.2,0],repeatOffset:[2.116,0],path:"M23 133q-14 0 -37 -13l-39 -20q-17 -14 -33 -14t-16 7q0 16 23 54q84 140 224 140q68 0 148 -47q79 -48 147 -96t115 -48t131 54q160 104 354 120q14 0 26 -9t13 -21q0 -12 -24 -19q-98 -19 -207 -77q-108 -58 -208 -101t-189 -43t-138 20t-90 35q-41 16 -67 33 q-10 4 -48 22t-55 21q-16 2 -30 2z"},wiggleArpeggiatoDownSwash:{codepoint:"U+EAAC",description:"Arpeggiato downward swash",bBoxNE:[1.784,.48],bBoxSW:[-.172,-.1],repeatOffset:[1.784,0],path:"M668 208q145 -48 239 -224q6 -12 6 -19q0 -16 -19 -16t-34 20q-59 95 -132 139t-189 44q-41 0 -167 -76t-198 -76q-127 0 -194 79q-52 61 -66 103v6l-2 2q0 10 15 10t38 -18q55 -35 92 -26q28 3 65 21q36 17 58 27t105 26q81 16 175 16t208 -38z"},wiggleArpeggiatoUpArrow:{codepoint:"U+EAAD",description:"Arpeggiato arrowhead up",bBoxNE:[2.064,.62],bBoxSW:[-.188,-.32],repeatOffset:[2.064,0],path:"M388 0q-83 0 -178 27t-151 34q-49 0 -106 -43q-17 -14 -33 -14t-16 7q0 23 29 62t87 75t138 36t207 -45t165 -45h37q-10 164 -73 223l563 -231l-563 -250q63 61 73 182q-96 -18 -179 -18z"},wiggleArpeggiatoDownArrow:{codepoint:"U+EAAE",description:"Arpeggiato arrowhead down",bBoxNE:[2.064,.68],bBoxSW:[-.188,-.26],repeatOffset:[2.064,0],path:"M530 90q-40 0 -166 -45t-206 -45t-138 36t-88 76q-28 40 -28 54t15 14t34 -14q57 -43 106 -43q49 6 148 34q98 27 181 27t179 -18q-10 121 -73 182l563 -250l-563 -231q63 59 73 223h-37z"},wiggleGlissando:{codepoint:"U+EAAF",description:"Glissando wiggle segment",bBoxNE:[1.14,1.176],bBoxSW:[-.084,.732],repeatOffset:[1.032,0],path:"M564 541q20 0 20 -13q0 -23 -41 -63q-101 -90 -187 -90t-149 54t-113 54q-20 0 -37 -12q-49 -49 -88 -49q-12 0 -12 16t27 45l41 37q102 82 178 82t139 -54t113 -54q18 0 43 12q46 35 66 35z"},keyboardPedalPed:{alternateCodepoint:"U+1D1AE",codepoint:"U+E650",description:"Pedal mark",bBoxNE:[4.076,2.22],bBoxSW:[0,-.032],path:"M1999 176q39 0 63 -24t25 -64q0 -40 -25 -64q-26 -24 -64 -24t-63 25t-25 63t25 64q25 24 64 24zM1159 573q-84 0 -84 -172q0 -90 9 -91t26 12q96 78 96 164t-47 87zM600 1137q229 0 350 -131q62 -68 62 -154t-42 -134t-121 -48t-137 70t-58 107q0 38 20 38q16 1 26 -13 q41 -54 103 -55q29 1 47 19t18 51q0 70 -47 123q-66 76 -164 75q-49 1 -91 -69t-42 -128t115 -179q55 -61 71 -93q15 -32 15 -66q-1 -34 -29 -96t-58 -104t-32 -48q0 -6 3 -6q3 -1 13 -3q66 -13 128 -74q61 -61 103 -61t89 32q12 10 12 19v8q-8 43 -8 92q0 168 82 262 q63 74 172 74q61 0 97 -33t36 -90t-34 -107q-35 -50 -65 -76t-95 -73l-21 -14q-18 -12 -18 -18q0 -26 24 -66q41 -70 92 -70t125 74q31 31 38 48t7 50v37q0 236 168 328q31 16 48 16q23 0 22 -22q0 -12 -14 -27q-84 -84 -84 -276q0 -106 32 -188t80 -83q100 0 101 260 q0 305 -217 473q-145 115 -412 179q-47 9 -47 33t27 24q16 0 36 -4q252 -51 447 -154q317 -166 317 -514q0 -166 -76 -262t-176 -96q-145 0 -213 133q-14 25 -20 25t-59 -58q-104 -106 -202 -106t-155 118q-10 20 -14 21q-8 0 -25 -16l-53 -52q-154 -145 -246 44 q-52 110 -100 110q-14 0 -35 -25l-29 -34q-77 -92 -121 -131t-79 -39t-57 16t-21 41q0 57 92 128q91 71 147 91t65 28t41 50q32 43 32 81t-12 67t-40 64q-28 36 -32 42t-29 37q-84 104 -84 138q0 76 111 241q30 51 30 63t-28 12q-143 1 -260 -79t-121 -216v-8q0 -98 74 -98 t100 113q6 23 10 31t14 8q23 0 23 -80t-49 -150t-126 -70t-122 62t-45 156t78 179t196 143t314 63h12z"},keyboardPedalUp:{alternateCodepoint:"U+1D1AF",codepoint:"U+E655",description:"Pedal up mark",bBoxNE:[1.8,1.8],bBoxSW:[0,0],path:"M461 385q35 1 55 21t21 55q-1 35 -21 55t-55 20t-55 -20t-20 -55t20 -55t55 -21zM662 483q32 0 72 40t89 40q49 1 74 -29t25 -73t-25 -73t-74 -30t-89 40t-72 40h-11q-29 0 -40 -5t-18 -22t-7 -32t28 -41t85 -26q55 0 87 -32q32 -30 32 -72t-32 -73q-30 -31 -72 -31 t-73 31t-31 87t-28 86q-28 28 -41 28q-37 0 -47 -18q-11 -18 -11 -48v-10q0 -33 40 -73t40 -89q1 -50 -29 -74t-73 -24t-73 25t-30 73t40 89q40 40 40 73v10q0 29 -6 40q-6 10 -22 18t-28 8t-42 -28q-28 -28 -28 -86q0 -56 -32 -87q-30 -31 -72 -31t-73 31t-31 73t31 72 t87 31q56 0 85 29t29 41q0 11 -7 29t-19 23t-40 5h-10q-33 0 -73 -40t-89 -40q-50 0 -74 30t-24 73t25 73t73 30t89 -41q40 -40 73 -40h10q29 0 40 5q10 4 18 22t8 30t-28 42q-28 28 -86 28q-56 0 -87 31t-31 73t31 72t73 31q42 -1 72 -31t31 -86q0 -56 27 -86 q27 -29 41 -29q15 1 31 8t22 18t6 40v11q0 32 -40 72t-40 89t30 74t73 25t73 -25t30 -74t-41 -89q-40 -40 -40 -72v-11q0 -29 6 -40q14 -25 41 -25t54 28q26 28 26 85q0 55 31 87t73 32t72 -32q30 -30 31 -72q-1 -42 -31 -73t-86 -31t-86 -27q-29 -27 -29 -40q2 -42 20 -51 q17 -9 46 -9h11z"},ornamentMordent:{codepoint:"U+E56C",description:"Mordent",bBoxNE:[2.9,.98],bBoxSW:[0,0],path:"M496 0q-27 0 -37 13t-92 99q-81 86 -95 102q-27 29 -69 -13q-53 -45 -92 -82t-75 -37t-36 20q0 6 25 50l247 280q6 6 32 37t61 33q37 -4 63 -39l205 -238q62 81 182 207q37 43 52 55q42 33 91 -16q12 -10 90 -102q78 -93 91 -107q14 -14 29 -14q14 0 30 14t99 114t99 113 q36 26 77 -4q12 -10 12 -19t-26 -42q-25 -33 -197 -219q-172 -185 -184 -195t-40 -10q-27 0 -39 14q-41 51 -178 189q-18 25 -32 25t-55 -36q-42 -36 -66 -61q-43 -37 -47 -39l-84 -82q-14 -10 -41 -10z"},ornamentMordentInverted:{codepoint:"U+E56D",description:"Inverted mordent",bBoxNE:[2.916,1.276],bBoxSW:[.004,-.292],path:"M1176 250q16 0 33 15t99 113t98 111q34 28 77 -4q10 -8 10 -21t-25 -38q-8 -12 -189 -208q-181 -198 -193 -208t-38 -10t-35 10t-94 101t-99 110q-13 19 -46 -4v-367h-65v312q-168 -146 -176 -154t-35 -8t-39 14l-178 191q-19 25 -31 25t-50 -30q-38 -29 -81 -73 q-43 -43 -80 -43t-37 20t27 48l73 86q117 139 172 194q53 68 93 70q29 -2 48 -22t93 -109q74 -88 131 -150q8 12 14 17l60 69v346h63v-276l49 55q39 45 55 57q16 13 36 13t42 -20t100 -112q77 -92 90 -106q12 -14 28 -14z"},ornamentTremblement:{codepoint:"U+E56E",description:"Tremblement",bBoxNE:[3.94,.976],bBoxSW:[.004,0],path:"M1700 248q16 0 32 14t98 114q83 100 97 111q34 29 78 -2q12 -10 12 -19t-28 -48q-23 -27 -195 -213q-172 -185 -184 -195t-38 -10t-40 14l-178 189q-18 25 -30 25t-46 -27l-205 -191q-14 -10 -41 -10t-36 10t-52 56t-83 89q-39 41 -53 57t-29 15t-40 -26q-23 -16 -45 -43 q-24 -23 -62 -60q-38 -36 -64 -60t-34 -31t-35 -7q-26 0 -38 14q-158 158 -178 189q-23 25 -32 25t-25 -12q-16 -11 -18 -13q-1 -2 -3 -2l-78 -70q-53 -49 -89 -49t-36 20q0 6 25 50l247 280q6 6 22 23t28 26q18 17 47 17t59 -35q4 -4 201 -234l178 203q6 6 32 36t59 30 q34 0 65 -35l202 -236l181 205q35 39 51 53q38 33 92 -14q10 -10 88 -102q78 -93 92 -107q13 -14 29 -14z"},ornamentPrecompTrillWithMordent:{codepoint:"U+E5BD",description:"Trill with mordent",bBoxNE:[3.96,1.332],bBoxSW:[0,-.248],path:"M1708 250q16 0 32 15t101 115q84 100 99 111q33 27 75 -4q13 -10 13 -21t-24 -39t-198 -217q-176 -189 -188 -202q-14 -10 -41 -10t-37 12t-93 100t-95 104q-12 14 -26 14t-40 -21q-27 -21 -39 -35t-15 -16t-9 -11v-272h-62v213q-15 -14 -35 -34t-38 -36q-18 -18 -46 -18 q-29 0 -38 10t-92 98t-96 106t-25 18t-46 -27l-49 -43q-24 -23 -62 -60q-38 -36 -65 -62t-35 -33t-35 -7q-26 0 -35 10t-92 98t-96 106q-14 18 -26 18t-36 -20q-24 -18 -82 -72q-60 -54 -96 -55t-36 20t46 73t106 122q59 70 110 125q51 56 68 68q18 11 46 11t56 -35 q4 -6 203 -238l168 194q51 56 69 68q52 36 101 -24q14 -23 188 -219v434h62v-395l129 147q6 6 22 24t34 31q18 15 37 15t41 -20t102 -113q79 -93 92 -107q12 -14 28 -14z"},ornamentPrecompSlideTrillDAnglebert:{codepoint:"U+E5B5",description:"Slide-trill (D'Anglebert)",bBoxNE:[4.6,.98],bBoxSW:[.008,-1.468],path:"M4 -205q0 127 123 324q57 86 176 209q53 55 140 108t153 53q152 0 278 -155l93 -107q44 60 180 205q39 45 55 57q16 11 44 11t44 -21t215 -252l181 205q6 6 31 37t52 32t49 -19t101 -112q78 -92 91 -106q12 -14 28 -14t32 15t100 113q83 98 98 111q33 27 75 -4 q12 -10 12 -21t-23 -39q-22 -28 -196 -215t-186 -200q-14 -10 -41 -10t-37 12t-92 100t-94 102t-26 14q-27 -1 -122 -97q-27 -27 -43 -37q-78 -78 -89 -86t-37 -8t-35 10t-53 58t-84 89t-51 57t-28 15t-41 -24t-38 -35t-62 -58q-47 -46 -74 -72t-34 -33t-33 -7t-37 11 t-67 69t-83 88q-27 29 -45 44q-18 16 -56 32t-81 16q-106 0 -205 -123q-164 -201 -164 -338t116 -286q26 -33 44 -50l18 -18q147 -139 439 -152h16q53 -2 53 -16q0 -8 -17 -16t-36 -9l-80 -4q-143 0 -301 66q-299 123 -344 446q-2 12 -2 35z"},ornamentPrecompMordentUpperPrefix:{codepoint:"U+E5C6",description:"Mordent with upper prefix",bBoxNE:[4.892,1.564],bBoxSW:[0,0],path:"M2186 252q16 0 32 15t100 115t100 112t33 12t35 -14t18 -24q0 -11 -25 -41q-26 -30 -200 -218t-184 -199q-14 -10 -41 -10t-37 12t-93 100t-95 104q-11 14 -25 14t-41 -21q-27 -20 -49 -47q-24 -23 -62 -60q-38 -36 -65 -62t-36 -33t-35 -7t-34 10q-9 10 -92 96t-96 106 q-14 20 -32 19t-50 -33t-48 -46t-53 -50q-39 -36 -65 -62t-35 -33t-35 -7t-35 10t-92 98t-96 106t-25 18t-36 -20q-24 -19 -90 -79q-6 -2 -8 -8l-68 -82h-18q-352 0 -461 170q-43 61 -47 147v21q0 106 47 221t103 195q10 4 12 4q0 -9 -22 -59q-94 -217 -93 -323 q0 -107 55 -167q56 -60 144 -82q88 -20 252 -25q4 4 4 7q68 78 128 148t110 125q50 56 68 68q18 11 46 11t55 -35q4 -6 203 -238q2 6 8 9q183 217 215 241q65 50 115 -12q4 -6 59 -69t142 -167l178 203q6 6 22 24t34 31q18 15 37 15q20 0 42 -20t101 -113t92 -107t29 -14z "},ornamentPrecompSlideTrillBach:{codepoint:"U+E5B8",description:"Slide-trill with two-note suffix (J.S. Bach)",bBoxNE:[4.192,1.324],bBoxSW:[0,-1.468],path:"M0 -205q0 174 166 379q78 94 171 198t109 117q16 12 37 13h9q35 -2 63 -37q16 -29 203 -236l8 9q92 109 152 174t76 77q16 11 44 11t56 -35q12 -20 202 -238l97 111v340h84v-246q6 6 31 37t52 32q28 1 50 -19t100 -112t91 -106t29 -14t32 15t99 113t98 111q33 27 75 -4 q12 -10 12 -21t-23 -39t-197 -215t-185 -200q-14 -10 -41 -10t-37 12t-92 100l-96 103v-340h-82v315q-23 -18 -60 -55t-47 -41q-78 -78 -89 -86t-37 -8t-35 10t-53 58t-84 89t-51 57t-23 16t-36 -20q-24 -19 -59 -50t-46 -42t-17 -16l-94 -92q-14 -10 -40 -10t-35 10t-53 58 t-84 89t-51 57t-27 15t-104 -79q-174 -199 -174 -365q0 -93 50 -179t89 -122l39 -39q147 -139 439 -152h16q53 -2 53 -16q0 -8 -17 -16t-36 -9l-80 -4q-143 0 -301 66q-299 123 -344 446q-2 12 -2 35z"},ornamentPrecompInvertedMordentUpperPrefix:{codepoint:"U+E5C7",description:"Inverted mordent with upper prefix",bBoxNE:[4.888,1.56],bBoxSW:[0,-.248],path:"M2184 250q16 0 32 15t100 115t100 111q34 26 74 -4q12 -10 12 -21t-22 -39q-24 -28 -200 -218t-185 -201q-14 -10 -41 -10t-36 10t-53 58t-84 90q-40 44 -52 58q-11 14 -25 14t-43 -23q-29 -22 -49 -45l-14 -15v-272h-62v213l-80 -78q-14 -10 -40 -10t-36 10 q-9 10 -93 99t-95 106q-12 17 -23 17t-48 -27l-50 -43l-61 -61q-87 -85 -98 -93q-10 -8 -37 -8t-36 10t-53 58t-84 90t-51 58t-25 16t-36 -20q-24 -19 -90 -79l-74 -88h-18q-354 0 -463 168q-41 63 -45 147v21q0 106 46 222t101 194q10 4 13 4q0 -9 -22 -59 q-94 -217 -93 -324q0 -107 55 -167q56 -61 144 -81t254 -25q0 1 5 7t32 38t79 96q52 63 138 150q40 45 56 57q16 11 44 11t50 -31q23 -31 210 -242l6 9q88 109 174 196q40 45 56 57q16 11 44 11t56 -35l188 -219v434h62v-395l131 147q6 6 31 37t52 32q28 1 50 -19t101 -113 t92 -107t29 -14z"},ornamentPrecompTrillLowerSuffix:{codepoint:"U+E5C8",description:"Trill with lower suffix",bBoxNE:[3.436,.984],bBoxSW:[0,-.888],path:"M1325 -422q162 0 256 115q63 74 64 162v18q0 178 -107 279q-47 44 -106 76t-78 32q-20 0 -82 -62l-98 -99q-83 -81 -96 -91t-40 -10t-36 10t-53 58t-84 90t-51 58t-22 16t-49 -27l-49 -43l-61 -61q-81 -79 -94 -90q-14 -11 -41 -11t-36 10t-53 58t-84 90t-51 58 q-10 16 -24 16t-38 -20q-24 -19 -57 -50q-34 -31 -43 -40q-10 -10 -16 -14t-19 -14t-45 -10t-32 21t16 37t42 48q123 151 216 246q39 45 56 57q16 11 44 11t51 -31t210 -242l6 9q88 109 174 196q39 45 55 57q16 11 44 11t46 -23t102 -117q83 -95 109 -129q20 14 119 111 q100 98 128 120t33 28q5 8 15 8q30 0 92 -68t97 -123q61 -106 83 -180t22 -211t-112 -244q-136 -129 -318 -129q-48 1 -114 17t-77 28q-12 12 -13 31l21 -6q139 -37 178 -37z"},ornamentPrecompTrillSuffixDandrieu:{codepoint:"U+E5BB",description:"Trill with two-note suffix (Dandrieu)",bBoxNE:[3.796,1.524],bBoxSW:[0,0],path:"M1944 446q0 -137 -187 -292q-143 -138 -153 -146t-36 -8t-35 10t-53 58t-84 89t-51 57t-28 15t-41 -24t-32 -30t-26 -23q-16 -16 -53 -51t-63 -61t-36 -33q-9 -7 -35 -7t-35 10t-53 58t-84 89t-51 57q-12 16 -24 16t-45 -27l-49 -43q-26 -23 -62 -59q-36 -35 -63 -61 t-35 -33t-35 -7q-26 0 -35 10t-53 58t-84 89t-51 57q-12 16 -24 16t-36 -20q-24 -19 -57 -50q-34 -31 -43 -40q-10 -10 -16 -14t-19 -14t-45 -10t-32 21t16 37t76 91q61 75 180 201q40 45 56 57q16 11 44 11t52 -32t207 -239q32 48 178 203q39 45 55 57q16 11 44 11t57 -35 q20 -29 202 -236q57 74 179 203q40 45 56 57q16 11 44 11t45 -24q18 -24 100 -117q82 -92 107 -123q170 136 182 229q2 12 2 35q0 131 -121 192q-78 43 -227 47q-18 1 -18 13q0 28 59 28q106 0 203 -39q166 -96 166 -295z"},ottavaAlta:{alternateCodepoint:"U+1D136",codepoint:"U+E511",description:"Ottava alta",bBoxNE:[3.54,1.852],bBoxSW:[0,-.04],path:"M154 672q0 128 97 202t249 74t221 -59q70 -59 70 -154q0 -137 -154 -217q-35 -18 -35 -28t25 -39q66 -72 65 -181q0 -135 -108 -213q-108 -77 -266 -77t-238 68t-80 173q0 168 182 242q37 15 37 27t-16 32q-49 59 -49 150zM319 41q81 0 130 44q49 45 49 105t-30 93 t-94 83t-74 52q-10 0 -26 -8q-115 -72 -114 -211q0 -66 39 -112t120 -46zM635 754q1 57 -31 95t-101 38t-112 -38q-43 -37 -43 -93t27 -90t100 -91q23 -16 37 -16t25 8q98 68 98 187zM995 924q39 0 63 -31t24 -79t-40 -134q-39 -86 -38 -123q0 -55 57 -55q51 0 101 72 t50 126q0 56 -40 84t-39 61q0 31 19 53t52 22q32 0 54 -36t22 -87q0 -147 -73 -251t-171 -104q-57 0 -97 33t-40 88t44 149t44 120t-18 26q-43 0 -82 -129q-6 -18 -23 -18q-23 0 -22 20q0 12 8 35q57 158 145 158zM1448 442q-57 0 -94 42t-37 142t75 201q75 100 171 101 q51 0 70 -31t25 -31t12 29q7 29 30 29h49q23 0 23 -15q-1 -2 -5 -18l-104 -332q-6 -14 -6 -31q0 -27 22 -26q37 0 88 127q8 18 23 18q23 0 22 -20l-10 -37q-61 -145 -139 -146q-61 0 -76 58q-6 30 -11 30q-10 -1 -24 -22q-47 -68 -104 -68zM1573 866q-61 0 -109 -100 t-47 -181q0 -81 46 -81q47 0 101 112t54 182q0 68 -45 68z"},ottavaBassaBa:{codepoint:"U+E513",description:"Ottava bassa (ba)",bBoxNE:[3.5,1.852],bBoxSW:[0,-.04],path:"M154 672q0 128 97 202t249 74t221 -59q70 -59 70 -154q0 -137 -154 -217q-35 -18 -35 -28t25 -39q66 -72 65 -181q0 -135 -108 -213q-108 -77 -266 -77t-238 68t-80 173q0 168 182 242q37 15 37 27t-16 32q-49 59 -49 150zM319 41q81 0 130 44q49 45 49 105t-30 93 t-94 83t-74 52q-10 0 -26 -8q-115 -72 -114 -211q0 -66 39 -112t120 -46zM635 754q1 57 -31 95t-101 38t-112 -38q-43 -37 -43 -93t27 -90t100 -91q23 -16 37 -16t25 8q98 68 98 187zM1092 672q0 -6 -5 -19l-51 -170q-4 -16 -11 -37q-7 -20 -7 -26t5 -6t21 11t37 24 q29 12 72 12t75 -40t32 -97q0 -140 -79 -242t-188 -102q-63 0 -102 40t-39 98t14 107l103 375q4 16 4 21q0 12 -27 12h-39q-31 0 -30 22q-1 25 32 27l158 10q25 0 25 -20zM1110 408q-62 0 -114 -108t-52 -206q0 -63 47 -63q66 1 116 115t50 188t-47 74zM1642 -18 q-61 0 -75 57q-6 31 -13 31t-22 -23q-46 -67 -104 -67t-95 42t-37 142t75 200t171 101q50 0 70 -31t25 -31t13 29t29 29h50q23 0 22 -15q0 -2 -4 -18l-105 -332q-6 -16 -6 -30q0 -27 23 -27q37 0 88 127q8 18 22 18q23 0 23 -20l-10 -37q-61 -145 -140 -145zM1552 403 q-61 0 -108 -100t-47 -181t46 -81t100 113t54 181t-45 68z"},quindicesimaAlta:{alternateCodepoint:"U+1D138",codepoint:"U+E515",description:"Quindicesima alta",bBoxNE:[5.26,1.844],bBoxSW:[0,-.04],path:"M502 33q0 -33 -39 -33h-424q-39 0 -39 33t35 37l88 8q23 2 31 26l172 539q6 17 6 31t-14 14t-33 -22l-92 -103q-40 -47 -74 -15q-12 11 -12 28t20 40l268 304q19 20 37 20t41 -11t39 -11l86 22q25 0 25 -25q0 -10 -7 -28l-243 -774l-6 -23q0 -10 14 -12l86 -8 q35 -4 35 -37zM805 580q0 -16 18 -17q4 0 39 10t101 11q266 0 266 -207q0 -176 -115 -287t-291 -110q-127 0 -193 56t-67 128q0 72 35 116q35 42 83 42t76 -24t27 -69q0 -80 -63 -108q-33 -17 -33 -33t26 -30t64 -13q114 0 180 109t66 219q0 129 -117 129q-76 0 -151 -76 q-27 -27 -49 -27q-39 0 -39 39q0 16 10 47l139 408q14 43 55 43q18 0 78 -16t164 -17t194 32q23 9 33 9q25 0 25 -24t-35 -56q-154 -141 -340 -141l-117 10q-18 0 -26 -22l-39 -115q-4 -12 -4 -16zM1863 838q5 0 45 44t92 46q52 0 75 -29t23 -78t-43 -159q-42 -110 -42 -138 q0 -27 23 -26q33 0 67 86q7 20 25 20t18 -18q0 -12 -6 -27q-45 -117 -138 -117t-93 80q0 42 40 146t40 137t-29 33q-37 0 -72 -45t-57 -111l-70 -209q-6 -18 -24 -18h-62q-18 0 -18 9t2 15l92 281q8 25 8 43q0 35 -35 35q-36 0 -70 -45t-57 -111l-69 -209q-6 -18 -25 -18 h-61q-18 0 -19 10q0 8 2 14l97 293q12 43 12 57q0 25 -21 25q-49 0 -102 -129q-8 -18 -22 -18q-23 0 -23 20q0 12 10 37q72 162 170 162q63 0 76 -60q2 -8 2 -18t5 -10t36 34q47 55 109 56q80 0 84 -80q0 -10 5 -10zM2328 442q-58 0 -94 42q-37 42 -36 124q0 119 74 219 q75 100 171 101q51 0 71 -31t24 -31t12 29t30 29h50q23 0 22 -15q0 -2 -4 -18l-104 -332q-6 -14 -6 -36t22 -21q37 0 88 127q8 18 23 18q23 0 22 -20l-10 -37q-61 -145 -139 -146q-61 0 -76 58q-6 30 -11 30q-10 -1 -24 -22q-47 -68 -105 -68zM2454 866q-60 0 -108 -100 t-48 -181t46 -81t100 112t54 182q0 68 -44 68z"},quindicesimaBassa:{alternateCodepoint:"U+1D139",codepoint:"U+E516",description:"Quindicesima bassa",bBoxNE:[5.14,1.844],bBoxSW:[0,-.04],path:"M502 33q0 -33 -39 -33h-424q-39 0 -39 33t35 37l88 8q23 2 31 26l172 539q6 17 6 31t-14 14t-33 -22l-92 -103q-40 -47 -74 -15q-12 11 -12 28t20 40l268 304q19 20 37 20t41 -11t39 -11l86 22q25 0 25 -25q0 -10 -7 -28l-243 -774l-6 -23q0 -10 14 -12l86 -8 q35 -4 35 -37zM805 580q0 -16 18 -17q4 0 39 10t101 11q266 0 266 -207q0 -176 -115 -287t-291 -110q-127 0 -193 56t-67 128q0 72 35 116q35 42 83 42t76 -24t27 -69q0 -80 -63 -108q-33 -17 -33 -33t26 -30t64 -13q114 0 180 109t66 219q0 129 -117 129q-76 0 -151 -76 q-27 -27 -49 -27q-39 0 -39 39q0 16 10 47l139 408q14 43 55 43q18 0 78 -16t164 -17t194 32q23 9 33 9q25 0 25 -24t-35 -56q-154 -141 -340 -141l-117 10q-18 0 -26 -22l-39 -115q-4 -12 -4 -16zM1940 475q96 -1 96 -107q0 -48 -42 -159t-42 -137t22 -27q33 0 68 86 q8 20 22 21q31 0 15 -46q-45 -116 -138 -116t-94 80q0 43 40 146t40 136t-29 33q-38 0 -72 -45t-57 -111l-69 -209q-6 -18 -25 -18h-61q-18 0 -19 10q0 8 2 15l93 280q8 25 8 43q0 35 -35 35t-70 -45t-57 -111l-70 -209q-6 -18 -24 -18h-62q-18 0 -18 10t2 15l96 292 q12 43 13 58q0 25 -21 24q-49 0 -102 -129q-8 -18 -23 -18q-23 0 -22 20q0 12 10 37q72 162 170 162q55 0 71 -45q7 -21 7 -32t5 -11t36 35q47 55 107 55t79 -47q6 -18 6 -30t5 -13q5 0 46 45t93 45zM2476 76q0 -27 23 -27q37 0 88 127q9 18 27 18t18 -20q0 -6 -5 -19 t-6 -18q-61 -145 -139 -145q-61 0 -76 57q-6 31 -12 31t-22 -23q-46 -67 -104 -67t-95 42t-37 142t75 201q75 100 171 100q50 0 70 -31q20 -30 25 -30t12 28t30 29h49q23 0 23 -14q0 -3 -4 -19l-105 -332q-6 -16 -6 -30zM2392 414q-61 0 -108 -100q-48 -100 -48 -182 q0 -81 46 -81t101 113q54 114 54 182t-45 68z"},ventiduesimaAlta:{codepoint:"U+E518",description:"Ventiduesima alta",bBoxNE:[5.712,1.852],bBoxSW:[.016,-.028],path:"M178 666q0 114 94 198t237 84q144 0 225 -58t81 -159q0 -276 -379 -362q-164 -39 -239 -123q-34 -43 -13 -43q8 0 49 16q88 35 206 -7q69 -24 106 -24q66 0 106 58q18 26 47 26t29 -28q0 -12 -8 -37q-39 -115 -90 -168t-145 -53t-189 54q-96 54 -136 54q-39 0 -59 -51 t-53 -51q-39 0 -39 39q0 10 6 39q35 131 114 222t230 152q254 102 254 324q0 109 -133 109q-59 0 -96 -22t-37 -44t29 -51t29 -78t-34 -88t-87 -39t-79 32t-26 79zM899 666q-1 114 93 198t238 84t225 -58t81 -159q0 -276 -379 -362q-164 -39 -239 -123q-34 -43 -13 -43 q8 0 49 16q88 35 206 -7q69 -24 106 -24q66 0 106 58q18 26 47 26t29 -28q0 -12 -8 -37q-39 -115 -90 -168q-50 -53 -144 -53t-190 54t-136 54t-60 -51t-52 -51q-39 0 -39 39q0 10 6 39q35 131 114 222t230 152q254 102 254 324q0 109 -133 109q-59 0 -96 -22t-37 -44 t29 -51q28 -29 28 -78t-34 -88t-86 -39q-53 0 -79 32t-26 79zM2089 850q0 -12 5 -12t46 44t92 46q51 0 74 -29t23 -78t-42 -159t-42 -138q0 -27 22 -26q33 0 68 86q8 20 22 20q20 0 21 -18q0 -12 -6 -27q-44 -117 -138 -117t-94 80q0 42 40 146t40 137t-29 33q-37 0 -71 -45 t-58 -111l-69 -209q-6 -18 -25 -18h-61q-18 0 -19 10q0 8 2 14l92 281q8 25 9 43q0 35 -35 35t-70 -45t-57 -111l-70 -209q-6 -18 -24 -18h-62q-18 0 -18 9t2 15l96 293q12 43 12 57q0 25 -20 25q-49 0 -103 -129q-8 -18 -22 -18q-23 0 -23 20q0 12 11 37q72 162 170 162 q62 0 75 -60q2 -8 2 -18q-1 -10 5 -10t36 34q48 56 108 56t79 -47q6 -19 6 -31zM2560 442q-57 0 -94 42t-37 142t76 201q76 100 170 101q51 0 70 -31t25 -31t12 29q7 29 30 29h49q23 0 23 -15q-1 -2 -5 -18l-104 -332q-6 -14 -6 -31q0 -27 22 -26q37 0 88 127q8 18 23 18 q23 0 23 -20l-11 -37q-61 -145 -139 -146q-61 0 -76 58q-6 30 -11 30q-6 -1 -24 -22q-47 -68 -104 -68zM2685 866q-61 0 -109 -100t-47 -181q0 -81 46 -81q47 0 101 112t54 182q0 68 -45 68z"},ventiduesimaBassa:{codepoint:"U+E519",description:"Ventiduesima bassa",bBoxNE:[5.512,1.852],bBoxSW:[.016,-.028],
path:"M178 666q0 114 94 198t237 84q144 0 225 -58t81 -159q0 -276 -379 -362q-164 -39 -239 -123q-34 -43 -13 -43q8 0 49 16q88 35 206 -7q69 -24 106 -24q66 0 106 58q18 26 47 26t29 -28q0 -12 -8 -37q-39 -115 -90 -168t-145 -53t-189 54q-96 54 -136 54q-39 0 -59 -51 t-53 -51q-39 0 -39 39q0 10 6 39q35 131 114 222t230 152q254 102 254 324q0 109 -133 109q-59 0 -96 -22t-37 -44t29 -51t29 -78t-34 -88t-87 -39t-79 32t-26 79zM899 666q-1 114 93 198t238 84t225 -58t81 -159q0 -276 -379 -362q-164 -39 -239 -123q-34 -43 -13 -43 q8 0 49 16q88 35 206 -7q69 -24 106 -24q66 0 106 58q18 26 47 26t29 -28q0 -12 -8 -37q-39 -115 -90 -168q-50 -53 -144 -53t-190 54t-136 54t-60 -51t-52 -51q-39 0 -39 39q0 10 6 39q35 131 114 222t230 152q254 102 254 324q0 109 -133 109q-59 0 -96 -22t-37 -44 t29 -51q28 -29 28 -78t-34 -88t-86 -39q-53 0 -79 32t-26 79zM2130 473q98 -1 96 -107q0 -48 -42 -159t-42 -137t23 -27q33 0 67 86q8 20 23 21q20 0 20 -19q0 -12 -6 -27q-45 -116 -138 -116t-93 80q0 43 40 146t40 136t-29 33q-37 0 -72 -45t-57 -111l-70 -209 q-6 -18 -24 -18h-62q-18 0 -18 9t2 16l92 280q8 25 8 43q0 35 -35 35t-69 -45t-58 -111l-69 -209q-6 -18 -25 -18h-61q-18 0 -19 10q0 9 2 15l97 292q12 43 12 58q0 25 -21 24q-49 0 -102 -129q-8 -18 -22 -18q-23 0 -23 20q0 12 10 37q72 162 170 162q61 0 76 -59 q2 -8 2 -18t5 -11q5 0 36 35q48 55 108 55t78 -47q7 -21 7 -32t5 -11t46 45t92 45zM2673 -10q-61 0 -76 57q-6 31 -13 31t-22 -23q-46 -67 -104 -67t-95 42t-36 124q0 119 75 219q76 100 170 100q50 0 70 -31q20 -30 25 -30t13 28t30 29h49q23 0 22 -14q0 -3 -4 -19 l-104 -332q-6 -14 -7 -30q0 -27 23 -27q37 0 88 127q8 18 23 19q23 0 22 -21l-10 -37q-61 -145 -139 -145zM2583 412q-61 0 -109 -100t-47 -182q0 -81 46 -81t100 113q55 114 55 182t-45 68z"},brassScoop:{codepoint:"U+E5D0",description:"Scoop",bBoxNE:[1.28,1.532],bBoxSW:[.004,-.012],path:"M37 -6q-23 0 -29 10t-6 35v33q0 43 10 57q10 15 26 21t61 19q44 13 79 27q125 52 179 104q55 52 101 110q93 118 126 335q6 39 39 39t32 -43q0 -141 -62 -278q-113 -250 -353 -395q-105 -64 -191 -74h-12z"},brassDoitMedium:{codepoint:"U+E5D5",description:"Doit, medium",bBoxNE:[1.956,1.544],bBoxSW:[0,0],path:"M47 0h-12q-23 0 -29 10t-6 35v33q0 43 10 57q10 13 28 21t91 23q318 66 525 202q87 57 164 155t112 216q10 39 41 39t30 -43q-14 -188 -188 -368t-389 -280t-377 -100z"},brassFallRoughShort:{codepoint:"U+E5DD",description:"Rough fall, short",bBoxNE:[1.692,1.86],bBoxSW:[0,0],path:"M70 913q0 -41 14 -53q29 -24 107 -39q79 -14 113 -49t34 -94q0 -16 -4 -41q4 -31 14 -41q29 -24 107 -39q79 -14 113 -49t34 -94q0 -16 -4 -41q0 -27 12 -41q38 -25 112 -39q76 -14 110 -50q34 -35 34 -81t-14 -92l-12 -45q-7 -25 -21 -25t-22 25q-7 45 -27 64t-90 25 t-111 46q-41 41 -41 104q0 25 2 35q-6 33 -25 53t-88 26t-111 47q-42 40 -42 105q0 23 2 33q-8 37 -27 55t-88 24t-110 46t-41 114t43 140l2 4q0 6 10 6q14 -18 15 -28v-11z"},brassPlop:{codepoint:"U+E5E0",description:"Plop",bBoxNE:[1.172,1.528],bBoxSW:[.004,-.02],path:"M31 782h14q80 -10 175 -74q220 -150 323 -396q57 -138 57 -279q0 -43 -30 -43t-35 39q-28 211 -118 338t-171 172q-81 46 -139 63q-58 18 -61 20t-16 7q-13 4 -20 17q-6 13 -8 59v40q0 37 29 37z"},graceNoteSlashStemUp:{codepoint:"U+E564",description:"Slash for stem up grace note",bBoxNE:[2.02,1.604],bBoxSW:[0,0],path:"M980 821q54 0 54 -65q0 -27 -22 -43l-914 -701q-18 -12 -42 -12t-40 20t-16 46t27 45l913 700q12 10 40 10z"},graceNoteSlashStemDown:{codepoint:"U+E565",description:"Slash for stem down grace note",bBoxNE:[2.02,0],bBoxSW:[0,-1.604],path:"M0 -66q0 28 16 47t40 19t42 -12l914 -701q22 -17 22 -43q-1 -67 -57 -65q-25 0 -37 10l-913 700q-27 17 -27 45z"},ornamentTurn:{alternateCodepoint:"U+1D197",codepoint:"U+E567",description:"Turn",bBoxNE:[1.84,.872],bBoxSW:[0,0],path:"M760 446q74 0 128 -54t54 -156t-57 -168t-153 -66t-168 47q-73 47 -158 141q-137 154 -222 154q-57 0 -95 -34t-38 -85q1 -51 21 -80q37 -52 93 -5q27 24 59 24t52 -20t20 -60t-31 -62q-33 -22 -95 -22t-116 54t-54 156t57 169q57 65 153 65t168 -47q73 -47 159 -141 q137 -154 221 -154q57 0 95 34t38 85q-1 51 -21 80t-44 29t-50 -24t-58 -24t-52 21q-20 20 -21 53q0 90 115 90z"},ornamentTurnSlash:{alternateCodepoint:"U+1D199",codepoint:"U+E569",description:"Turn with slash",bBoxNE:[1.84,1.224],bBoxSW:[0,-.36],path:"M473 627q33 0 33 -33v-264q0 -27 5 -37q5 -9 53 -63q117 -129 194 -130q57 0 95 34t38 85q-1 51 -21 80t-44 29t-50 -24t-58 -24t-52 21q-20 20 -20 59t31 62q33 22 95 22t116 -54t54 -156t-57 -168t-160 -66t-181 66q-23 18 -33 18q-9 0 -9 -31v-205q0 -32 -33 -32 t-33 32v265q0 27 -5 37t-53 63q-117 129 -194 129q-57 0 -95 -34t-38 -85q1 -51 21 -80q37 -52 93 -5q27 24 59 24t52 -20t20 -60q0 -39 -31 -62q-33 -22 -95 -22t-116 54t-54 156t57 169q57 66 157 65t184 -65q25 -19 33 -19q9 0 9 31v205q0 33 33 33z"},pluckedSnapPizzicatoAbove:{codepoint:"U+E631",description:"Snap pizzicato above",bBoxNE:[.8,1.2],bBoxSW:[0,0],path:"M55 200q0 -58 43 -102q44 -44 106 -43q62 0 106 43q44 42 44 100t-33 100q-34 42 -83 52v-145h-66v145q-51 -10 -84 -51t-33 -99zM0 200q0 81 49 138t123 68v208h66v-208q72 -10 122 -68t50 -138t-60 -140t-145 -60q-84 0 -145 59q-60 60 -60 141z"},pluckedSnapPizzicatoBelow:{alternateCodepoint:"U+1D1AD",codepoint:"U+E630",description:"Snap pizzicato below",bBoxNE:[.8,1.2],bBoxSW:[0,0],path:"M206 559q-62 0 -106 -43t-45 -101q0 -57 34 -99t83 -52v146h66v-146q51 10 84 51q32 41 32 99t-43 102q-43 43 -105 43zM204 614q84 0 146 -59q60 -59 60 -140t-50 -139t-122 -69v-207h-66v207q-74 12 -123 69q-49 56 -49 138t60 141t144 59z"},flag8thUpShort:{codepoint:"U+F410",bBoxNE:[1.068,.032],bBoxSW:[0,-2.192],stemUpNW:[0,-.2],path:"M0 -4q0 20 16 20h17q9 0 22 -10q14 -10 17 -26q44 -163 152 -304q36 -47 82 -101t59 -71q182 -238 182 -493q0 -133 -29 -133q-37 0 -37 63q0 365 -288 533q-97 53 -193 59v463z"},flag16thUpShort:{codepoint:"U+F413",bBoxNE:[1.056,.048],bBoxSW:[0,-2.496],stemUpNW:[0,-.26],path:"M463 -762q0 56 -35 111q-147 248 -350 262q22 -76 34 -97q13 -20 30 -48q18 -28 34 -56t95 -114t94 -103q53 -72 65 -90q18 37 26 58t7 77zM0 6q0 13 20 16t26 2q17 -3 17 -36q43 -111 89 -165q45 -55 94 -106t71 -77l33 -35q98 -104 144 -173t47 -173q0 -104 -54 -271 q49 -98 52 -172v-18q0 -76 -33 -76q-14 0 -22 1q-22 3 -22 65q-1 63 -64 195q-62 132 -177 212q-70 47 -221 66v745z"},flag32ndUpShort:{codepoint:"U+F416",bBoxNE:[1.056,.884],bBoxSW:[0,-2.452],stemUpNW:[0,.704],path:"M463 -748q0 64 -35 119q-147 248 -350 262q21 -74 34 -95q26 -42 58 -95q31 -52 195 -227q53 -72 65 -90q33 62 33 126zM438 -282q0 34 -28 83q-137 232 -344 232q-2 -2 -3 -8v-15q38 -104 79 -155q79 -98 175 -193l86 -92q3 18 19 66t16 82zM541 -717q0 -106 -54 -272 q49 -98 52 -172v-19q0 -76 -33 -75q-14 0 -22 1q-22 3 -22 65q-1 63 -64 195q-62 132 -177 212q-70 47 -221 65v1145q12 25 22 25q10 1 25 -13q14 -14 16 -26q15 -88 47 -140t102 -112q152 -129 235 -258q59 -88 59 -202q0 -113 -35 -214q70 -99 70 -205z"},flag64thUpShort:{codepoint:"U+F419",bBoxNE:[1.056,1.612],bBoxSW:[0,-2.496],stemUpNW:[0,1.392],path:"M463 -770q0 64 -35 119q-147 248 -350 262q22 -76 34 -97q13 -20 30 -48q18 -28 34 -56t95 -114t94 -103q53 -72 65 -90q33 63 33 127zM66 10q-2 -2 -3 -8v-14q43 -111 89 -165q45 -55 94 -106t71 -77l33 -35q20 -20 53 -58l31 97l6 43q0 39 -30 92q-137 231 -344 231z M434 39l6 43q1 39 -30 92q-137 231 -353 232q6 -6 13 -54q14 -100 132 -203t201 -206zM541 -737q0 -108 -54 -275q49 -98 52 -172v-18q0 -76 -33 -76q-14 0 -22 1q-22 3 -22 65q-1 63 -64 195q-62 132 -177 212q-70 47 -221 66v1540q12 25 25 24q10 0 23 -13t15 -26 q13 -88 47 -140t102 -111t91 -82q107 -117 155 -190t48 -186t-39 -231q41 -73 41 -169q0 -95 -35 -212q68 -94 68 -202z"},flag128thUpShort:{codepoint:"U+F41C",bBoxNE:[1.056,2.364],bBoxSW:[0,-2.492],stemUpNW:[0,2.076],path:"M541 -738q0 -105 -54 -272q49 -98 52 -172v-18q0 -76 -33 -76q-14 0 -22 1q-22 3 -22 65q-1 63 -64 195q-62 132 -177 212q-69 48 -221 66v1923q12 25 25 24q8 0 22 -13t16 -26q15 -88 47 -140t102 -111q152 -129 235 -258q59 -88 59 -205t-37 -217q37 -76 37 -178 t-39 -214q39 -73 39 -176q0 -104 -35 -204q70 -101 70 -206zM80 801q-16 0 -17 -13q15 -88 47 -140t123 -129t173 -183q4 10 18 60t14 82t-34 92q-35 60 -156 145q-121 86 -168 86zM410 176q-139 231 -353 232q6 -12 6 -15q15 -88 47 -140t101 -112q71 -59 111 -103t81 -93 q3 18 19 66t16 82t-28 83zM438 -302q0 34 -28 83q-137 231 -344 231q-2 -2 -3 -8v-14q38 -104 79 -155q79 -98 175 -193l86 -93q3 19 19 67t16 82zM463 -768q0 64 -35 119q-147 248 -350 262q22 -78 35 -97q12 -19 29 -47q18 -28 34 -56q16 -29 95 -115t94 -103 q53 -72 65 -90q33 63 33 127z"},flag256thUpShort:{codepoint:"U+F41F",bBoxNE:[1.056,3.152],bBoxSW:[0,-2.456],stemUpNW:[0,2.836],path:"M463 -749q0 63 -35 118q-147 248 -350 262q21 -74 34 -95q26 -42 58 -95q31 -52 195 -227q53 -72 65 -91q33 65 33 128zM438 -306q0 48 -28 95q-137 231 -342 231q-4 -2 -5 -12q42 -109 110 -191q24 -28 73 -79t71 -78l89 -94q32 80 32 128zM410 184q-137 231 -353 232 q6 -6 13 -54q15 -104 124 -197t209 -212q3 18 19 66t16 83t-28 82zM403 346q35 109 35 145q0 37 -28 84q-137 231 -351 232q4 -4 4 -10q15 -89 47 -141t111 -119q80 -68 182 -191zM410 963q-137 231 -349 231q2 -2 2 -6q15 -88 47 -140t120 -127t176 -184q4 16 18 63t14 81 q0 35 -28 82zM541 -716q0 -109 -54 -275q49 -98 52 -172v-19q0 -76 -33 -75q-14 0 -22 1q-22 3 -22 65q-1 63 -64 195q-62 132 -177 212q-70 47 -221 65v2308q12 25 24 25t24 -13q13 -13 15 -26q15 -88 47 -140t101 -112q151 -128 236 -258q59 -88 59 -201q0 -112 -37 -223 q37 -82 37 -187q0 -104 -39 -204q39 -70 39 -176t-39 -217q39 -73 39 -175t-33 -200q68 -89 68 -198z"},flag512thUpShort:{codepoint:"U+F422",bBoxNE:[1.056,3.796],bBoxSW:[0,-2.464],stemUpNW:[0,3.54],path:"M463 -753q0 63 -35 118q-147 248 -350 262q21 -74 34 -95t30 -49q18 -27 34 -55t95 -115t94 -104q53 -72 65 -90q33 65 33 128zM438 -292q0 28 -28 77q-137 231 -340 231l-7 -12q44 -114 110 -191q24 -28 73 -79t71 -78l89 -94q6 18 15 48t13 40q4 30 4 58zM410 180 q-137 231 -353 232q6 -6 13 -54q15 -103 132 -204q118 -101 201 -205l31 96q4 29 4 57t-28 78zM410 571q-137 231 -351 232q4 -4 4 -10q15 -89 47 -141t113 -122t180 -188q3 16 19 58t16 82t-28 89zM410 958q-137 231 -349 232q2 -2 2 -6q15 -88 47 -140t120 -129 q88 -76 176 -182q7 28 28 90q4 29 4 57t-28 78zM416 1106q48 95 -6 186q-135 227 -336 232q18 -70 52 -115t92 -94t85 -78q98 -111 113 -131zM541 -722q0 -107 -54 -273q49 -98 52 -172v-19q0 -76 -33 -76q-14 0 -22 1q-22 3 -22 65q-2 64 -64 196t-177 212q-70 47 -221 65 v2642q12 25 24 25t24 -14q13 -14 15 -25q15 -89 47 -141t102 -111q144 -121 235 -256q61 -92 61 -216q0 -125 -31 -175q29 -72 29 -165t-37 -204q37 -82 37 -181t-37 -210q37 -76 37 -179t-39 -214q39 -73 39 -170t-31 -205q66 -93 66 -200z"},flag1024thUpShort:{codepoint:"U+F425",bBoxNE:[1.056,4.464],bBoxSW:[0,-2.456],stemUpNW:[0,4.256],path:"M463 -749q0 63 -35 118q-147 248 -350 262q21 -74 34 -95q26 -42 58 -95q31 -52 195 -227q53 -72 65 -91q33 65 33 128zM438 -307q0 47 -28 96q-137 231 -342 231q-4 -2 -5 -12q38 -104 79 -155q79 -98 175 -193l89 -94q32 80 32 127zM410 184q-139 231 -353 232 q6 -6 13 -54q15 -104 124 -197t209 -212q3 18 19 66t16 82t-28 83zM403 346q35 109 35 144q0 36 -28 85q-137 231 -351 232q4 -4 4 -10q15 -89 47 -141t111 -119q80 -68 182 -191zM410 963q-137 231 -349 231q2 -2 2 -6q15 -88 47 -140t120 -127t176 -184q4 16 18 63t14 80 q0 34 -28 83zM410 1634q-135 227 -338 232q18 -72 52 -118t120 -119t172 -185q2 8 12 38q26 78 -18 152zM438 1214q0 33 -28 82q-135 227 -336 232q18 -70 51 -115t119 -118t172 -185q22 71 22 104zM541 -717q0 -108 -54 -274q49 -98 52 -172v-19q0 -76 -33 -75q-14 0 -22 1 q-22 3 -22 65q-1 63 -64 195q-62 132 -177 212q-70 47 -221 65v2980q12 25 22 25t25 -14q14 -14 16 -25q15 -89 47 -141t102 -111q152 -129 224 -239t72 -231q0 -120 -33 -179q33 -68 33 -177t-31 -159q29 -80 29 -169t-37 -200q37 -82 37 -187q0 -104 -39 -204 q39 -70 39 -176t-39 -217q39 -73 39 -175t-33 -200q68 -91 68 -199z"}},engravingDefaults:{arrowShaftThickness:.16,barlineSeparation:.4,beamSpacing:.25,beamThickness:.5,bracketThickness:.5,dashedBarlineDashLength:.5,dashedBarlineGapLength:.25,dashedBarlineThickness:.16,hairpinThickness:.16,legerLineExtension:.4,legerLineThickness:.16,lyricLineThickness:.16,octaveLineThickness:.16,pedalLineThickness:.16,repeatBarlineDotSeparation:.16,repeatEndingLineThickness:.16,slurEndpointThickness:.1,slurMidpointThickness:.22,staffLineThickness:.13,stemThickness:.12,subBracketThickness:.16,textEnclosureThickness:.16,thickBarlineThickness:.5,thinBarlineThickness:.16,tieEndpointThickness:.1,tieMidpointThickness:.22,tupletBracketThickness:.16},fontName:"Bravura",fontVersion:1.18,meta:{"font-family":"Bravura","font-weight":"400","font-stretch":"normal","units-per-em":"2048","panose-1":"5 6 0 0 0 0 0 0 0 0",ascent:"1638",descent:"-410",bbox:"-889 -4080 4749 4096","underline-thickness":"102","underline-position":"-102","unicode-range":"U+0020-1D1DD"}}}).call(this);
//# sourceMappingURL=adagio.min.js.map